<?php 
$errors = '';
$myemail = 'matthew.nutter@kiwidebt.co.nz';//<-----Put Your email address here.
if(empty($_POST['pictitle'])  || 
   empty($_POST['locatn'])	||
   empty($_POST['name']) || 
   empty($_POST['email']))
   
{
    $errors .= "\n Error: all fields are required";
}

//Uploader
$target_path = "./uploads/";

//change filename to date-time stamp
$fxdate = Date("Ymd-His");
//echo $fxdate;


/* Add the original filename to our target path.  
Result is "uploads/filename.extension" */
$target_path = $target_path . $fxdate . basename( $_FILES['uploadedfile']['name']); 

if(move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target_path)) {
    echo "The file ".  basename( $_FILES['uploadedfile']['name']). 
    " has been uploaded";
} else{
    echo "There was an error uploading the file, please try again!";
}
//end uploader

//set mail notify.

$pictitle = $_POST['pictitle']; 
$locatn = $_POST['locatn']; 
$name = $_POST['name']; 
$email_address = $_POST['email']; 
$filename = basename( $_FILES['uploadedfile']['name']);
$ipaddress = $_SERVER["REMOTE_ADDR"];
$dsubmit = Date("d/m/Y-H:i:s");
if (!preg_match(
"/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/i", 
$email_address))
{
    $errors .= "\n Error: Invalid email address";
}

if( empty($errors))
{
	$to = $myemail; 
	$email_subject = "photo submission from arklesbay.co.nz: $pictitle";
	$email_body = "photo submission".
	"\n Pic Title: $pictitle". 
	"\n Location: $locatn". 
	"\n Photographer: $name". 
	"\n Email: $email_address". 
	"\n filename: $filename". 
	"\n IP Address: $ipaddress".
	"\n Date Submitted: $dsubmit";
	
	$headers = "From: $myemail\n"; 
	$headers .= "Reply-To: $email_address";
	
	mail($to,$email_subject,$email_body,$headers);
	//redirect to the 'thank you' page
	header('Location: upload_pics.html');
} 
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html>
<head>
	<title>Photo form handler</title>
</head>

<body>
<!-- This page is displayed only if there is some error -->
<?php
echo nl2br($errors);
?>


</body>
</html>