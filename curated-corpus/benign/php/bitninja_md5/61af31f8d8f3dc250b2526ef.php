<?
include_once("config.php");
$user_name =  get_session('ss_mb_login');

$page_title = "Admin - Add Slide";

@extract($_GET);
@extract($_POST);
@extract($_SERVER); 

?>
<?if($user_name == "") {?>
<script language="javascript">
	alert("Please Log In First");
	//window.location="admin.php";
</script>
<?}else{
	$tmp_file  = $_FILES[picField][tmp_name];
	$filename  = $_FILES[picField][name];
	$filesize  = $_FILES[picField][size];

	@mkdir("images/banner", 0707);
	@chmod("images/banner", 0707);

	if (is_uploaded_file($tmp_file)) 
	{
		if($mode == "biz")
			$bo_table = "prop_biz_picture";
		else $bo_table = "prop_picture";

		$upload[source] = $filename;
		$upload[filesize] = $filesize;

		$filename = preg_replace("/\.(php|phtm|htm|cgi|pl|exe|jsp|asp|inc)/i", "$0-x", $filename);

		$upload[file] = abs(ip2long($_SERVER[REMOTE_ADDR])).'_'.substr(md5(uniqid($g4[server_time])),0,8).'_'.str_replace('%', '', urlencode($filename)); 

		$dest_file = "images/banner/" . $upload[file];

		// 업로드가 안된다면 에러메세지 출력하고 죽어버립니다.
		$error_code = move_uploaded_file($tmp_file, $dest_file) or die($_FILES[bf_file][error]);

		// 올라간 파일의 퍼미션을 변경합니다.
		chmod($dest_file, 0606);

		$upload_file_size = @getimagesize($dest_file);

		$sql = "insert into main_slide set filename='$dest_file', upload_date='".date('Y-m-d H:i:s')."', upload_by='$user_name'";
		sql_query($sql);
/*
		$sql = "insert into $bo_table set
				file_path='$dest_file',
				file_width=$upload_file_size[0],
				file_height=$upload_file_size[1]";
			
		sql_query($sql);
*/
	}
}?>

<script type="text/javascript">
<!--
	opener.location.href = 'http://www.jjrealty.com.au/mainSlides.php';
	self.close();
//-->
</script>