<? session_start();
include "config.php";
if($_SESSION['unm']=="")
{
	header("Location:index.php");
}
if(isset($_REQUEST['id']))
{
		$rs=mysql_query("select * from homeslider where id='".$_REQUEST['id']."'");
		$r= mysql_fetch_array($rs);
}		
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Admin Panel</title>
<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="css/ddsmoothmenu.css" type="text/css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/ddsmoothmenu.js"></script>
<script>
function chk()
{
	var catname = document.cat.cname.value;
	if(document.cat.cname.value == "")
	{
		alert('Please Enter Category Name.');
		document.cat.cname.focus();
		return false;
	}
	return true;
}
function canl()
{
	window.location="homesliderlist.php";
}
</script>
</head>

<body>
<? include "header.php"; ?>
<div class="main_centerpart" >  
<div class="main_centerpart_text" >
<br /><br /><br />
<form action="" method="post" enctype="multipart/form-data" name="cat" >
<table width="30%" border="0" align="center" bordercolor="#999999" style="border-collapse:collapse; " >
	<tr><td><? echo $_REQUEST['msg']; ?></td></tr>
  <tr style="background-image:url(images_admin/menu_bg.gif);">
    <td colspan="5" align="center"><strong><font size="3" color="#FFFFFF">Update Image</font></strong></td>
  </tr>
  <tr><td colspan="2" align="right"><font color="#CC0000">* indicates require field</font></td></tr>
  <tr height="15"></tr>
  <tr>
   <td width="40%"><strong>Image : <span class="red">*</span></strong></td><td><input type="file" name="image"  value="<? echo $image; ?>"/> only jpg, png or webp file</td>
  </tr>
  <tr height="20"></tr>
  <tr style="background-image:url(images_admin/menu_bg.gif);"><td></td><td>
		<input type="submit" name="submit" value="Save" onclick="return chk()"/>
		<input type="button" name="cancel" value="Cancel" onclick="return canl()" /></td></tr>
</table>
</form>
<p><br /><br /><br /><br /></p>
</div>
</div>

<? include "footer.php"; ?>

<?
if(isset($_POST['submit']))
{
	
		//$rnd = rand(00000000,99999999);
		$allowed_image_extension = array(
			"png",
			"jpg",
			"jpeg",
			"webp",
			"jpeg2000"
		);
	
		$file_extension = pathinfo($_FILES["image"]["name"], PATHINFO_EXTENSION);
		if (! in_array($file_extension, $allowed_image_extension) && $_FILES['image']['name']!="") {
			$response = array(
				"type" => "error",
				"message" => "Upload valiid images. Only PNG and JPEG are allowed."
			);
			//echo $result;
			echo "<script>alert('Please upload valide file format in image. file error.');</script>";
		} 
		/*else if (($_FILES["image"]["size"] > 91000)) {
			$response = array(
				"type" => "error",
				"message" => "Image size exceeds 90KB"
			);
			echo "<script>alert('Please upload valide file size in photo. file error.');</script>";
		}*/
		else { 

			$photo = $_FILES['image']['name'];
			if($photo!="")
			{
				//$nm = "b".$_REQUEST['id'].".jpg";
				$path = "../images/".$_FILES['image']['name'];
				move_uploaded_file($_FILES['image']['tmp_name'],$path);
		/*$path = "../images/".pathinfo($_FILES['image']['name'], PATHINFO_FILENAME).".webp";
		$file = $_FILES['image']['tmp_name'];
		$image = imagecreatefromstring(file_get_contents($file));
		ob_start();
		imagejpeg($image,NULL,100);
		$cont = ob_get_contents();
		ob_end_clean();
		imagedestroy($image);
		$content = imagecreatefromstring($cont);
		//$output = 'webp/output.webp';
		$output = $path;
		imagewebp($content,$output);
		imagedestroy($content);*/
				
			}
			else
			{
				$path = $image;
			}
			$path2 = "images/".$_FILES['image']['name'];
			//$path2 = "images/".pathinfo($_FILES['image']['name'], PATHINFO_FILENAME).".webp";

			//image resize
			//include("resize-class.php");					// *** Include the class
			//$resizeObj = new resize($path); 			// *** 1) Initialise / load image
			//$resizeObj -> resizeImage(1300, 500, 'exact');	// *** 2) Resize image (options: exact, portrait, landscape, auto, crop)
			//$resizeObj -> saveImage($path, 100);		// *** 3) Save image

			if(isset($_REQUEST['id']))
			{
				$insert=(mysql_query("update homeslider set image='".$path2."' where id='".$_REQUEST['id']."'"));
				if($insert)
					$msg='Image has been updated successfully';
				else
					$msg='Image has not been updated successfully';
			}
			else
			{
				$insert=(mysql_query("insert into homeslider(image) values('".$path2."')"));
				if($insert)
					$msg='Image has been inserted successfully';
				else
					$msg='Image has not been inserted successfully';			
			}	
			header("Location:homesliderlist.php?msg=$msg");
		
		}
}
?>