<?
include ("includes/surya.dream.php");  
 #header("location: registration_stop.php");
 #exit; 
  //print_r($_POST);
 //@extract($_POST);
//and  u_status!='Banned' and  u_status='Active' 
if ($username=='guest' && $password=='123456') {
	$_SESSION['sess_guest'] = $username;
 	if ($_SESSION['sess_back']!='') {
		header("location: ".$_SESSION['sess_back']);
		$_SESSION['sess_back']='';	
		exit;	
	} else {
		 header("location: index.php");
		 exit;	
	}
}   
 if ($_POST['conf_num2']!=$_POST['conf_num1']){ 
		$arr_error_msgs[] ="Security Code does not match"; 
		$_SESSION['arr_error_msgs'] = $arr_error_msgs;
		header("Location: login.php");
		exit;
	}



	// if ($_POST['conf_num2']!=$_SESSION['conf_num1']){ 
	//	$arr_error_msgs[] ="Captcha string does not match"; 
		//$_SESSION['arr_error_msgs'] = $arr_error_msgs;
		//header("Location: login.php");
	//	exit;
	//}
 
 
/* 
$arr_error_msgs[] =  "We are upgrading system, you can't login right now please try to login later!";
$_SESSION['arr_error_msgs'] = $arr_error_msgs;
header("location:login.php");
exit;*/
			
			
 	/*if ($confirmation_code1 !=$confirmation_code2) { 
	 		$arr_error_msgs[] =  "Not a valid confirmation code!";
			$_SESSION['arr_error_msgs'] = $arr_error_msgs;
			header("location:login.php");
			exit;
			
	}
		*/  
		  
		 
  $sql = "select * from ngo_users where  u_username = '$u_username' OR u_id = '$u_username'  "; 
	$result = db_query($sql);
	if ($line= mysqli_fetch_array($result)) {
		@extract($line);
		
     	if ($u_password==$password ) {
			if($u_status=='Banned') {
			$_SESSION['sess_blocked_msg'] = $u_blocked_msg;
			header("location: blocked_account.php");
			exit;
		}
			$_SESSION['sess_uid'] 		= $u_id;
			$_SESSION['sess_username'] 	= $u_username;
			$_SESSION['sess_username2'] = $u_username2;
			$_SESSION['sess_email']		= $u_email;
			$_SESSION['sess_fname']		= $u_fname;
			$_SESSION['sess_date']		= $u_date;
			$_SESSION['sess_u_last_login'] = $u_last_login; 
			
			 $_SESSION['sess_security_code'] = $u_password2;   
 			///$sql = "update ngo_users set u_last_login=now() where u_id = '$username'  ";
			///$ip =  gethostbyaddr($_SERVER['REMOTE_ADDR']);
			$ip =  gethostbyaddr($_SERVER['REMOTE_ADDR']);
			$sql = "update ngo_users set u_last_login_ip='$ip', u_last_login=ADDDATE(now(),INTERVAL 630 MINUTE) where u_id = '$u_id'  ";
			$result = db_query($sql);
			
			////////total login count
			 $total_visit_count = db_scalar("select u_count_view from ngo_users where  u_username = '$username'");
 			 $cur_visit_count=$total_visit_count+1;
  			$sql_count = "update ngo_users set u_last_login=now(), u_count_view='$cur_visit_count' where u_username = '$username'  "; 
 			$result_count = db_query($sql_count);
 			
			
			/*$total_topup = db_scalar("select sum(topup_amount) from ngo_users_recharge where  topup_userid ='$_SESSION[sess_uid]' ")+0;
 			if ($total_topup==0) {
			header("location: myaccount.php");
				// commented by sk         header("Location: mypinno_topup.php");
				exit();
 			} 
			
			if ($u_bank_acc_holder=='') {
				$arr_error_msgs[] ="Please update your bank account details."; 
				$_SESSION['arr_error_msgs'] = $arr_error_msgs;
				header("location: profile_edit.php");
				exit();
 			} 
			*/
			
 			if ($_SESSION['sess_back']!='') {
			 	header("location: ".$_SESSION['sess_back']);
				$_SESSION['sess_back']='';	
				exit;	
			} else {
 				 header("location: userpanel/myaccount?b=home");
				 exit;	
 			}
			
		} else {
 		$arr_error_msgs[] =  "Something went wrong! Please try again later." ;
		$_SESSION['arr_error_msgs'] = $arr_error_msgs;
			//header("Location: login?b=login-now");
			header("Location: login.php");
	        exit;
		}
 	} else { 
		$arr_error_msgs[] =  "Something went wrong! Please try again later." ;
		$_SESSION['arr_error_msgs'] = $arr_error_msgs;
		//header("Location: login?b=login-now");
		header("Location: login.php");
		exit;
}
 
?>
