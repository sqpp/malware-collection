<?



if($_POST['action_order'] == 'update'){

	try {
	// start method try{}catch{} for validate errors in conection of DB
		require_once('../includes/connection.php');
		require_once('../includes/functions.php');

		$id_order = $_POST['id_order'];
		
		$type = $_POST['type'];

		$validation = intval(preg_replace('/[^0-9]+/', '', $type), 10);

		$date = $_POST['date'];

		$conn = new mysqli($host, $user, $pass, $db);
		switch ($type) {

			case 'cb'.$validation:
			if ($date == 0) {
				$stmt = $conn->prepare("DELETE FROM order_checklist_items where id_order = ? AND id_item = ?");
				$stmt->bind_param("ii", $id_order, $validation);
			}else{
				$stmt = $conn->prepare("INSERT INTO order_checklist_items (id_order, id_item, order_item_check) VALUES (?,?,?)");
				$stmt->bind_param("iii", $id_order, $validation, $date);
			}
			break;


			default:
			$response = 'fucking error';
			break;

		}
		$stmt->execute();

		if ($stmt->affected_rows == 1) {
			$response = array(
				'response' => 'success'
			);
		}else{
			$response = array(
				'response' => 'error'
			);
		}
		$stmt->close();
		$conn->close();
		
	} catch(Exception $e) {

		$response = array(
			'error' => $e-> getMessage()
		);

	} 

	echo json_encode($response);


}