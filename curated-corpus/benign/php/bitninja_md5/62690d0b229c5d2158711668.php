<?

require_once("backend/functions.php");
dbconn();
loggedinonly();

stdhead("Dashboard Anda");

?>
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Carter+One&display=swap" rel="stylesheet">
<?

if ($_GET['mode'] == "premium") {

    begin_frame("Sahabat Premium");

    echo "<div class='container'><div class='row'><div class='col-md-4'>";
    echo "<div style='margin-bottom:30px' align='center'><img src='images/icons/premium.png'></div></div><div class='col-md-8'>";
    muah("Laman yang anda lawati adalah laman untuk <b>sahabat PREMIUM</b> sahaja. Untuk menjadi <b>sahabat PREMIUM</b> sila hubungi admin.");

    echo "<div style='margin-bottom:10px'><b>KELEBIHAN SAHABAT PREMIUM</b></div><ul class='bulletu'>
    <li>Akses kepada Aplikasi Rekod Tunai dan Inventori Panitia</li>
    <li>Akses kepada Bank BBM Pendidikan Islam & Bahasa Arab</li>
    <li>Akses kepada Aplikasi Gamifikasi Pendidikan Islam & Bahasa Arab</li>
    <li>Pilihan tema dan stail paparan cetakan RPH</li>
    <li>dan banyak lagi aplikasi yang akan datang, Insya-Allah..</li>
    </ul>";

    echo "</div></div></div>";

    end_frame();
    stdfoot();
    exit;
}

function profile()
{

    global $CURUSER, $con;

    echo "<div class='row'><div class='col-md-7 col-lg-7'>";

    begin_kad("Profil Anda");

    if ($CURUSER['company'] == "") {

        iyah("Sila kemaskini maklumat sekolah anda pada ruangan Kemaskini Maklumat.");
    }

    if ($CURUSER["avatar"] == "") {

        $gmbr = "photo.jpg";
    } else {

        $gmbr = $CURUSER["avatar"];
    }

    echo "<div class='row'><div class='col-md-3 col-lg-3'>";

    echo "<div style=\"text-align:center\"><img class='img-thumbnail' width=\"150\" src=\"images/avatars/" . $gmbr . "\"></div>";

    echo "</div><div class='col-md-9 col-lg-9'>";

    sayang("User ID", "<b>" . $CURUSER["username"] . "</b>");
    sayang("Nama Penuh", "" . $CURUSER["namapenuh"] . "");
    sayang("Tarikh Pendaftaran", formatDate($CURUSER["added"]));
    if ($CURUSER["class"] > 1) {
        sayang("E-mel", $CURUSER["email"]);
        sayang("No. Telefon", $CURUSER["notel"]);
    } else {
        $sekolah = infoSekolah($CURUSER["company"], "nama");
        $darjah = $CURUSER["tahun"];
        $namakelas = infoMurid($CURUSER["kid"], "namakelas");
        sayang("Sekolah", "$sekolah");
        sayang("Darjah", "$darjah");
        sayang("Nama Kelas", "$namakelas");
    }

    echo "</div></div>";

    ebloku();

    ?>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Iklan Dua -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2615259845845804" data-ad-slot="9289505692"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<?

    if ($CURUSER["class"] > 1) {

        bloku("Panduan Pengguna!");

        echo "<ul class='list-group'>";
        $ko = mysqli_query($con, "SELECT * FROM blog WHERE kat NOT IN (7) ORDER BY tarikh DESC LIMIT 6");
        while ($ku = mysqli_fetch_array($ko)) {

            $id = $ku["id"];
            $tajuk = $ku["tajuk"];
            $tarikh = formatDate($ku['tarikh']);
            $status = $ku["status"];

            if ($status) {
                $lab = "<span class='badge badge-danger'>$status</span>";
            } else {
                $lab = "";
            }

            echo "<li class='list-group-item'><i class='text-danger pli-book icon-lg'></i> <a class='text-bold' href='blog.php?go=papar&id=$id'>$tajuk</a> <span style='font-size:11px'>$tarikh</span> $lab</li>";
        }

        echo "</ul>";

        ebloku();

        bloku("Sahabat GPI");

        echo "<div style='overflow:auto;height:250px'>";
        $id = $CURUSER['id'];
        $sek = infoUser($id, "company");
        $gr = mysqli_query($con, "SELECT * FROM users WHERE class != 1 AND company = '$sek'");
        if (mysqli_num_rows($gr) == 0) {
            info("Tiada guru di sekolah sama.");
        } else {
            $i = 0;
            echo "<div class='row'>";
            while ($gt = mysqli_fetch_array($gr)) {

                extract($gt);

                if ($avatar == "") {

                    $gmbr = "avatar5.png";
                } else {

                    $gmbr = $avatar;
                }
                $ids = $gt["id"];

                echo "<div class='col-md-4 col-lg-4'>";

                echo "<div class='panel panel-default text-center'><div class='panel-body'>";
                echo "<img class='img-thumbnail img-circle' width='100' height='100' src='images/avatars/$gmbr'>";
                echo "<div style='margin-top:10px;font-size:20px'><a href='details.php?id=$ids'>$username</a></div>";
                echo "<div>$namapenuh</div>";
                echo "<div style='font-size:11px;color:#969696'>" . infoSekolah($sek, "nama") . "</div>
                </div>
                </div>";
                $i++;
                echo "</div>";

                if ($i % 3 == 0) {

                    echo "</div><div class='row'>";
                }

            }
            echo "</div>";
        }

        echo "</div>";

        ebloku();
    }

    bloku("Buku Saya");

    $kid = $CURUSER['id'];

    $jo = mysqli_query($con, "SELECT * FROM sripi_buku WHERE pembina = '$kid'");
    if (mysqli_num_rows($jo) == 0) {
        amaran("Tiada rekod aktiviti.");
    } else {
        while ($ju = mysqli_fetch_array($jo)) {
            extract($ju);

            if ($jenis == "1") {

                $jns = "<img width='100' src='images/icons/nota.svg'>";
                $jonis = "nota";
            } else {

                $jns = "<img width='100' src='images/icons/latihan.svg'>";
                $jonis = "latihan";
            }

            echo "<div class='col-md-4' style='position:relative;text-align:center'>";

            begin_kad();

            echo "<div>$jns</div>
            <div style='padding-top:10px'><a target='_blank' style='font-size:15px' href='buku.php?mode=baca&id=$id'>$tajuk</a></div>";

            if ($share == 1) {
                echo "<span style='position:absolute;top:2px;left:18px' class='label label-default'>shared</span>";
            }
            echo "<span style='position:absolute;top:10px;right:25px'>
            <a class='dropdown-toggle' type='button' id='dropdownMenu$id' data-toggle='dropdown' aria-haspopup='true' aria-expanded='true'>
            <i class=\"fas fa-ellipsis-v\"></i>
            </a>
            <ul class='dropdown-menu' aria-labelledby='dropdownMenu$id'>
            <li><a href='buku.php?mode=share&id=$id'><i class=\"fas fa-share-alt-square\"></i> <b>Kongsi Bahan</b></a></li>
            <li><a href='cetakbuku.php?mode=$jonis&id=$id'> <i class=\"fas fa-print\"></i> <b>Cetak Bahan</b></a></li>
            </ul>
            </span>";

            echo "<div style='margin-top:5px;font-size:11px'>" . TarikhCun($tarikh) . "</div>";

            end_kad();

            echo "</div>";
        }
    }

    ebloku();

    echo "</div><div class='col-md-5 col-lg-5'>";

    if ($CURUSER["class"] == 1) {

        $mtahun = infoMurid($CURUSER["kid"], "tahun");

        bloku("Eksplorasi Aqeel");

        $usrid = $CURUSER['id'];
        $idmurid = $CURUSER['kid'];

        $brpsp = get_row_count("sripi_sp", "WHERE tahun = '$mtahun'");
        $brpdah = get_row_count("sripi_rekodx", "WHERE user = '$usrid' AND sp != '0'");

        echo "<div style='position:relative;font-family:Carter One'><div style='position:absolute;top:10px;color:white;right:10px'>
        <span style='padding:3px;background:#00c853;border-radius:10px 0px 0px 10px;'>" . sprintf('%03d', $brpdah) . "</span><span style='padding:3px;background:#304ffe;border-radius:0px 10px 10px 0px'>$brpsp</span></div><img width='100%' style='max-width:452px' src='images/eahead.jpg'></div>";

        echo "<div style='overflow:auto;height:570px'><table class='table table-striped vercell jawimuslim'>";

        $ju = mysqli_query($con, "SELECT * FROM sripi_sk WHERE item != '0' AND subjek = '1' AND tahun = '$mtahun' ORDER BY bidang ASC") or die(mysqli_error($con));
        while ($ji = mysqli_fetch_array($ju)) {

            $sk = $ji['nama'];
            $idsk = $ji['id'];
            $bidang = $ji["bidang"];
            $tahun = $ji["tahun"];
            $item = $ji["item"];

            $rk = mysqli_query($con, "SELECT * FROM sripi_sp WHERE item != '0' AND sk = '$idsk' ORDER BY bidang ASC") or die(mysqli_error($con));
            while ($rt = mysqli_fetch_array($rk)) {

                $sp = $rt['nama'];
                $item = $rt["item"];
                $idsp = $rt["id"];

                $usrid = $CURUSER['id'];

                $markah = infoMarkahSP($idsp);

                $siap = get_row_count("sripi_rekodx", "WHERE user = '$usrid' AND sp = '$idsp'");

                if ($siap == 0) {
                    $ciap = "<img width='16' src='images/icons/taklaksana.png'>";
                    $bgc = "red";
                } else {
                    $ciap = "$markah%";
                    $bgc = "#00c853";
                }

                if (get_row_count("sripi_exam", "WHERE sp = '$idsp'") == 0) {
                    $link = "#";
                } else {
                    $link = "myexam.php?mode=buat&sp=$idsp";
                }

                echo "<tr><td><a href='$link'><div class='jawimuslim' colspan='3'>" . formatfont($sp) . "</div></a></td><td width='80' style='background:$bgc;text-align:center;color:white;font-family:Carter One'>$ciap</td></tr>";
            }
        }

        echo "</table>";

        echo "</div>";

        ebloku();
    } else {

        bloku("Sosial");

        echo "<div class='row'>

        <div class='col-md-4'><div style='border-radius:10px; text-align:center; padding:30px 10px; height:100px; background-color:#00a1f1'>";

?>

<div style="margin-top:5px; text-align:center; background-color:#00a1f1" id="fb-root"></div>
<script>
(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src =
        'https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.12&appId=234140739935190&autoLogAppEvents=1';
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-like" data-href="https://facebook.com/gomysripi" data-layout="button_count" data-action="like"
    data-size="large" data-show-faces="true" data-share="false"></div>

<?

        echo "</div></div>

        <div class='col-md-4'><div style='border-radius:10px; text-align:center; padding:20px 10px; height:100px; background-color:#7cbb00'>

        <div style='color:white; font-size:20px'><i class='fab fa-telegram fa-lg'></i>
        <div style='margin-top:10px'><a style='color:white;font-size:13px' href='https://t.me/joinchat/ASVIxhD0dBksjHRrsJRpEw'><span style='font-size:12pt'>Telegram</span></a></div></div>

        </div></div>

        <div class='col-md-4'><div style='border-radius:10px; text-align:center; padding:25px 10px; height:100px; background-color:#ffbb00'>

        <a href='#donation' style='color:black' rel='facebox'><div style='font-size:30px; font-weight:bold'><i class='fas fa-hand-holding-usd'></i><div style='font-size:12pt'>Sumbangan</div></div></a>

        </div></div>

        </div>

        ";

        ebloku();

        bloku("Papan Notis");
        $usrr = $CURUSER['id'];
        echo "<div style='overflow:auto;max-height:200px'><ul class='list-group' style='margin-bottom:3px'>";
        if ($CURUSER["class"] == "7") {
            $ko = mysqli_query($con, "SELECT * FROM sripi_aduan WHERE balas = '0' ORDER BY added DESC LIMIT 6");
        } else {
            $ko = mysqli_query($con, "SELECT * FROM sripi_aduan WHERE user = '$usrr' AND balas = '0' ORDER BY added DESC LIMIT 6");
        }
        while ($ku = mysqli_fetch_array($ko)) {

            $id = $ku["id"];
            $aduan = $ku["aduan"];
            $added = formatDate($ku['added']);
            $balas = $ku["balas"];
            $jawapan = $ku["jawapan"];

            echo "<li class='list-group-item bg-gray'><i class='text-danger pli-mail-send icon-lg'></i> <a class='text-bold' onclick='paparaduan(\"$id\")'>$aduan</a> <span style='font-size:11px'>$added</span>
            </li>";
        }

        echo "</ul></div>";
        echo "<button type='button' onclick='aduan()' class='btn btn-success btn-block' style='margin-bottom:15px'><i class='pli-mail-add icon-lg'></i> Aduan</button>";

        echo "<ul class='list-group'>";
        $ko = mysqli_query($con, "SELECT * FROM blog WHERE kat IN (7) ORDER BY tarikh DESC LIMIT 6");
        while ($ku = mysqli_fetch_array($ko)) {

            $id = $ku["id"];
            $tajuk = $ku["tajuk"];
            $tarikh = formatDate($ku['tarikh']);
            $status = $ku["status"];

            if ($status) {
                $lab = "<span class='badge badge-danger'>$status</span>";
            } else {
                $lab = "";
            }

            echo "<li class='list-group-item'><i class='text-danger pli-data-signal icon-lg'></i> <a class='text-bold' href='blog.php?go=papar&id=$id'>$tajuk</a> <span style='font-size:11px'>$tarikh</span> $lab</li>";
        }

        echo "</ul>";

        ebloku();
    }

    echo "</div></div>";
}

function editInfo($id)
{

    global $CURUSER, $con;

    begin_kad("Setting Akaun");

    $ok = mysqli_query($con, "SELECT * FROM users WHERE id = $id");
    $oo = mysqli_fetch_assoc($ok);

    $namapenuh = $oo["namapenuh"];
    $notel = $oo["notel"];
    $emel = $oo["email"];
    $nokp = $oo["nokp"];
    $impak = $oo["impak"];

    $opt = array("0" => "TIDAK", "1" => "YA");

    $impak = select_menu("impak", $opt, $impak);

    echo "<div class='row'>";

    echo "<div class='col-md-6'>";

    $e5 = $CURUSER['5e'];

    $opt5e = array("0" => "Tidak", "1" => "Ya");
    $papar5e = select_menu("5e", $opt5e, $e5);

    function pilihpenilai() {

        global $CURUSER;

        $sek = $CURUSER['company'];
        $penilai = $CURUSER['penilai'];

        $pgb = infoSekolah($sek,"pgb");
        $pk1 = infoSekolah($sek,"pk1");
        $pkhem = infoSekolah($sek,"pkhem");
        $pkkoku = infoSekolah($sek,"pkkoku");
        $pkptg = infoSekolah($sek,"pkptg");

        $pl = "<select name='penilai' id='penilai' class='form-control'>";
        $pl .= "<option value='".infoSekolah($sek,"pgb")."'"; if ($pgb == $penilai) $pl .= 'selected'; $pl .= ">".infoSekolah($sek,"pgb")." (GURU BESAR)</option>";
        $pl .= "<option value='".infoSekolah($sek,"pk1")."'"; if ($pk1 == $penilai) $pl .= 'selected'; $pl .= ">".infoSekolah($sek,"pk1")." (GPK PENTADBIRAN)</option>";
        $pl .= "<option value='".infoSekolah($sek,"pkhem")."'"; if ($pkhem == $penilai) $pl .= 'selected'; $pl .= ">".infoSekolah($sek,"pkhem")." (GPK HEM)</option>";
        $pl .= "<option value='".infoSekolah($sek,"pkkoku")."'"; if ($pkkoku == $penilai) $pl .= 'selected'; $pl .= ">".infoSekolah($sek,"pkkoku")." (GPK KOKURIKULUM)</option>";
        $pl .= "<option value='".infoSekolah($sek,"pkptg")."'"; if ($pkptg == $penilai) $pl .= 'selected'; $pl .= ">".infoSekolah($sek,"pkptg")." (GPK PETANG)</option>";
        $pl .= "</select>";
        return $pl;
    }

    input("Nama Penuh", "namapenuh", $namapenuh, "Nama penuh anda");
    input("E-mel", "emel", $emel, "Emel anda");
    input("No. Telefon", "notel", $notel, "No. telefon anda");
    input0("Penilai RPH", "penilai", pilihpenilai());
    input0("Papar Model Pembelajaran 5E", "papar5e", $papar5e);
    input0("Papar impak di cetakan RPH", "impak", $impak);

    echo "<div align='right'><button class=\"btn btn-success\" onclick=\"editInfo('$id')\">Simpan</button></div>";

    echo "</div>";

    echo "<div class='col-md-6'>";

    echo "<h5 style='font-size:15px;margin-bottom:10px;font-weight:bold'>Logo Sekolah</h5>";
    echo "<p style='font-size:11px'>Saiz gambar ideal 300 x 300px</p>";

    $logosek = infoSekolah($CURUSER["company"],"logo");

    if (infoSekolah($CURUSER["company"], "logo") == "") {

        echo "<div style='background:#ccc; text-align:center; padding:20px'>
        <button id=\"uploadLogo\" style='font-size:20px' class=\"btn btn-danger\"><i class='fa fa-image'></i> Upload</button>
        <div id='upLogo'></div>
        </div>";

    } else {

        $sekolah = $CURUSER['company'];
        echo "<div style='position:relative;text-align:center;border:2px dashed green;padding:20px'><img src='images/logo/$logosek' width='100'><a href='akaun.php?action=edit&id=$sekolah&b=clearlogo'><span style='position:absolute;top:10px;right:10px'><i class='fa fa-times-circle fa-2x' style='color:red'></i></span></a></div>";

    }

    echo "<h5 style='font-size:15px;margin-top:20px;margin-bottom:10px;font-weight:bold'>Header RPH</h5>";

    if ($CURUSER["headerrph"] == "") {

        echo "<div style='background:#ccc; text-align:center; padding:20px'><i style='color:white' class='fa fa-image fa-4x'></i></div>";

    } else {

        echo "<div style='border:2px dashed black; padding:10px'><img width='100%' src='$CURUSER[headerrph]'></div>";
    }

    echo "<form action='akaun.php' method='POST' enctype=\"multipart/form-data\">";

    echo "<div style='background:#FFFFC0;padding:10px;margin-bottom:10px'>";
    inputreset("Pilih Fail:", "headerrph", "", "", "file");
    echo "</div>";

    echo "<div align='right'>
    <button type='submit' name='uploadheaderrph' class='btn btn-success'>UPLOAD</button>
    <a href='akaun.php?action=edit&b=clearheader&id=$id' name='clearheader' class='btn btn-purple'>BUANG HEADER</a>
    </div>";

    echo "</form>";

    echo "</div>";

    echo "</div>";

    end_kad();
}

function pic()
{

    ?>

<script type="text/javascript">
$(document).ready(function() {

    ///upload gambar///
    var button = $("#uploadAvatar"),
        interval;
    new AjaxUpload(button, {
        action: 'ajax/uploadAvatar.php',
        name: 'image',
        onSubmit: function(file, ext) {
            // change button text, when user selects file
            button.text('*');

            // If you want to allow uploading only 1 file at time,
            // you can disable upload button
            this.disable();

            // Uploding -> Uploading. -> Uploading...
            interval = window.setInterval(function() {
                var text = button.text();
                if (text.length < 13) {
                    button.text(text + '*');
                } else {
                    button.text('*');
                }
            }, 200);

        },

        onComplete: function(file, response) {

            button.text('Upload');

            window.clearInterval(interval);

            // enable upload button
            this.enable();

            // add file to the list
            $("#upAvatar").html(response);
            $("#fieldAvatar").attr('value', file);

        }
    });
});
</script>

<?

    begin_kad("Upload Gambar Profil");

    echo "<div style='border:2px dashed blue;text-align:center;padding:20px'>";

    echo "<input type=\"hidden\" name=\"action\" value=\"tkrpass\">
    <input type=\"hidden\" name=\"do\" value=\"newpassword\">";

    echo "<button id=\"uploadAvatar\" style='font-size:20px' class=\"btn btn-danger\"><i class='fa fa-image'></i> Upload</button>";
    ah("<div id=\"upAvatar\"></div>", "");
    echo "</div>";

    ebloku();
}

function navmenu()
{

    global $CURUSER;

    $aks = $_GET['action'];

    if (!$aks) {

        $part = "1";
    } elseif ($aks == "edit") {

        $part = "2";
    } elseif ($aks == "gambar") {

        $part = "3";
    } elseif ($aks == "tkrpass") {

        $part = "4";
    }

    function warna($no, $part)
    {

        if ($no == $part) {

            return "class='activez'";
        } else {

            return "";
        }
    }

    echo "<div class='icon-bar'>
    <a " . warna("1", $part) . " href='akaun.php'><i class='fas fa-home'></i></a>
    <a " . warna("2", $part) . " href='akaun.php?action=edit'><i class='fas fa-pen-square'></i></a>
    <a " . warna("3", $part) . " href='akaun.php?action=gambar'><i class='fas fa-image'></i></a>
    <a " . warna("4", $part) . " href='akaun.php?action=tkrpass'><i class='fas fa-lock'></i></a>
    </div>";
}

function murid($id)
{
    global $CURUSER, $con;

    $kl = mysqli_query($con, "SELECT * FROM sripi_murid WHERE user = '$id'");
    $ko = mysqli_fetch_assoc($kl);

    $kid = $ko["id"];
    $namakelas = $ko["nama"];

    $bilmurid = get_row_count("sripi_murid", "WHERE user = $id");

    if ($bilmurid > 0) {

        begin_kad("Senarai Murid");

        $e = 1;
        echo "<table class=\"table table-bordered table-hover\" cellpadding=5 cellspacing=\"0\" align=center width=100%>";
        echo "<thead><tr>
        <th width=\"1%\">Bil.</th>
        <th width='60%'>Nama</th>
        <th width=10%>Tahun</th>
        <th width=10%>Kelas</th>
        <th align=\"center\"><span class='glyphicon glyphicon-menu-hamburger'></span></th></tr></thead>";

        $sk = mysqli_query($con, "SELECT * FROM sripi_murid WHERE user = $id ORDER BY tahun, nama ASC");
        while ($row = mysqli_fetch_array($sk)) {

            $id = $row["id"];
            $nama = $row["nama"];
            $nokp = $row["nokp"];
            $kelas = $row["namakelas"];
            $tahun = $row["tahun"];

            echo "<tr id=\"senarai" . $id . "\"><td>$e</td>";

            echo "<td width='270' style='text-align:left'><a href=murid.php?mode=detail&id=$id>$nama</a>
            <td align=\"center\">$tahun</td>
            <td align=\"center\">$kelas</td>
            <td width=50 align=center><a href=kemaskini.php?id=$id><img src=images/edit.png></a></td></tr>";
            $e++;
        }

        echo "</tbody></table>";

        ebloku();
    } else {

        begin_kad("Senarai Murid");

        muah("Tiada data murid.");

        ebloku();
    }
}

function rphanda($id)
{

    global $CURUSER, $con;

    $year = date('Y');

    begin_kad("5 RPH Terkini");

    $e = 1;
    echo "<table class=\"table table-striped table-bordered\" cellpadding=5 cellspacing=\"0\" align=center width=100%>";
    echo "<thead><tr>
    <th width=\"10\">Bil.</th>
    <th width='15' >Minggu</th>
    <th>Tarikh</th>
    <th>Masa</th>
    <th>Kelas</th>
    <th>Tajuk</th>
    <th align=\"center\"><span class='glyphicon glyphicon-menu-hamburger'></span></th></tr></thead>";

    $rqq = "SELECT * FROM sripi_rph WHERE user = '$id' ORDER BY tarikh DESC LIMIT 5";
    $resqq = mysqli_query($con, $rqq);
    while ($row = mysqli_fetch_array($resqq)) {

        $id = $row["id"];
        $minggu = $row["minggu"];
        $tarikh = $row["tarikh"];
        $masa = $row["masa"];
        $kelas = kolasapp($row["kelas"]);
        $tajuk = formatfont(infoUtil($row["tajuk"], "sripi_tajuk"));
        $subjek = $row["subjek"];

        if ($subjek == "1") {
            $t = "jenis=pi&";
        } else {
            $t = "jenis=ba&";
        }

        echo "<tr><td>$e</td>
        <td align='center' style='font-size:20px'>$minggu</td>
        <td align='center'>$tarikh</td>
        <td align='center'>$masa</td>
        <td align='center'>$kelas</td>
        <td class='jawis'><div style='font-size:20px'>$tajuk</div></td>
        <td align='center'><a href=\"rph.php?mode=editrph&id=" . $row["id"] . "\"><img width='32' src='images/icons/pencil.png'></a> -
        <a href=\"cetakrph.php?" . $t . "id=" . $row["id"] . "\"><img width='32' src='images/icons/printer.png'></a> -
        <a href=\"rph.php?mode=padam&id=" . $row["id"] . "\"><img width='32' src='images/icons/bin.png'></a></td></tr>";
        $e++;
    }

    echo "</tbody></table>";

    ebloku();
}

if (isset($_POST['uploadheaderrph'])) {

    require 'backend/SimpleImage.php';

    if ($_FILES["headerrph"]["name"] != "") {

        $target_dir = "images/headerrph/";
        $target_file = $target_dir . basename($_FILES["headerrph"]["name"]);
        $uploadOk = 1;
        $imageFileType = strtolower(pathinfo($target_file, PATHINFO_EXTENSION));

        if (
            $imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg"
            && $imageFileType != "gif"
        ) {
            bahaya("Maaf hanya file GIF, JPG dan PNG sahaja dibenarkan.");
            $uploadOk = 0;
        }

        if ($uploadOk == 0) {
            bahaya("Maaf, file anda tidak boleh diupload.");
            // if everything is ok, try to upload file
        } else {
            $tempfile = safehtml($filedata['tmp_name']);
            $namafile = safehtml($filedata['name']);

            $temp = explode(".", $_FILES["headerrph"]["name"]);
            $newfilename = round(microtime(true)) . '.' . end($temp);
            $destfile = "images/headerrph/" . $newfilename . "";
            move_uploaded_file($_FILES['headerrph']['tmp_name'], $destfile);

            try {
                // Create a new SimpleImage object
                $image = new \claviska\SimpleImage();

                // Magic!
                $image
                    ->fromFile($destfile)                     // load image.jpg
                    ->autoOrient()                              // adjust orientation based on exif data
                    ->resize(755, null)                          // resize to 320x200 pixels
                    ->toFile($destfile);      // convert to PNG and save a copy to new-image.png

                // And much more!
            } catch (Exception $err) {
                // Handle errors
                echo $err->getMessage();
            }
            $userid = $CURUSER['id'];
            mysqli_query($con, "UPDATE users SET headerrph = '$destfile' WHERE id = '$userid'");

            jaya("Fail anda telah berjaya diupload.");
        }
    } else {

        bahaya("Sila pilih fail untuk upload.");
    }
}

if (!$_GET['action']) {

    if ($CURUSER) {

        $kodsekolah = infoUser($CURUSER["id"], "company");
        $adamurid = mysqli_query($con, "SELECT id, user, kodsekolah FROM sripi_murid WHERE user = '$CURUSER[id]'");

        if (mysqli_num_rows($adamurid) > 0) {

            $chckmurid = mysqli_query($con, "SELECT user, kodsekolah FROM sripi_murid WHERE user = '$CURUSER[id]' AND kodsekolah = ''");

            if (mysqli_num_rows($chckmurid) > 0) {

                if ($kodsekolah != "") {

                    $bohkod = mysqli_query($con, "UPDATE sripi_murid SET kodsekolah = '$kodsekolah' WHERE user = '$CURUSER[id]'");
                }
            }
        }
    }

    begin_frame("Dashboard Anda", "", "", "#F0F0F0");

    navmenu();

    echo "<div class='row'>";

    if ($CURUSER["class"] == "7") {
        echo "<div class='col-md-2'>";
        begin_kad2("Guru");
        $sekolah = $CURUSER['company'];
        $guru = get_row_count("users", "WHERE company = '$sekolah' AND class > 1");
        echo "<div style='font-size:1cm'>$guru</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-2'>";
        begin_kad2("Murid");
        $user = $CURUSER['id'];
        $kodsek = infoSekolah($sekolah, "kod");
        $murid = get_row_count("sripi_murid", "WHERE kodsekolah = '$kodsek'");
        echo "<div style='font-size:1cm'>$murid</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-2'>";
        begin_kad2("Kelas");
        $kls = get_row_count("sripi_kelas", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$kls</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-2'>";
        begin_kad2("RPH");
        $rp = get_row_count("sripi_rph", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$rp</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-2'>";
        begin_kad2("Aduan");
        $adu = get_row_count("sripi_aduan");
        echo "<a target='_blank' href='staf.php?mode=aduan'><div style='font-size:1cm'>$adu</div></a>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-2'>";
        begin_kad2("Ahli");
        $ahli = get_row_count("users", "WHERE id IN (SELECT user FROM sripi_rph)");
        echo "<div style='font-size:1cm'>$ahli</div>";
        end_kad();
        echo "</div>";
    } elseif ($CURUSER["class"] == "1") {

        echo "<div class='col-md-3'>";
        begin_kad2("Al-Quran");
        $user = $CURUSER['kid'];
        $kodsek = infoSekolah($sekolah, "kod");
        $bacann = infoUtil(bacaanmurid($user), "sripi_bacaan");
        $ms = msmurid($user);
        $bacan = bacaanmurid($user);

        if ($bacan == "1" || $bacan == "8") {
            $prq = ($ms / 604) * 100;

            $prog = "<div class='progress' style='margin-top:5px;margin-bottom:0px'>
            <div class='progress-bar progress-bar-success progress-bar-striped active' role='progressbar' aria-valuenow='$prq' aria-valuemin='0' aria-valuemax='100' style='width: $prq%'>
            <span>" . floor($prq) . "%</span>
            </div>
            </div>";
        } else {
            if ($bacaan == "2") {
                $bacan = "1";
            } elseif ($bacaan == "3") {
                $bacan = "2";
            } elseif ($bacaan == "4") {
                $bacan = "3";
            } elseif ($bacaan == "5") {
                $bacan = "4";
            } elseif ($bacaan == "6") {
                $bacan = "5";
            } elseif ($bacaan == "7") {
                $bacan = "6";
            }

            $msss = 30 * ($bacan - 1);
            $mss = $msss + $ms;

            $prqq = ($mss / 360) * 100;

            $prog = "<div class='progress' style='margin-top:5px;margin-bottom:0px'>
            <div class='progress-bar progress-bar-info progress-bar-striped active' role='progressbar' aria-valuenow='$prqq' aria-valuemin='0' aria-valuemax='100' style='width: $prqq%'>
            <span>" . floor($prqq) . "%</span>
            </div>
            </div>";
        }

        echo "<div style='text-align:left;font-size:12px'><div style='margin-bottom:10px'><div class='label label-warning' style='font-size:15px'>$bacann</div> <span class='label label-primary' style='font-size:15px'>MS: $ms</span></div>$prog</div>";

        end_kad();
        echo "</div>";
        echo "<div class='col-md-3'>";
        begin_kad2("Pendidikan Islam");
        $kls = get_row_count("sripi_kelas", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$kls</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-3'>";
        begin_kad2("Bahasa Arab");
        $rp = get_row_count("sripi_rph", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$rp</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-3'>";
        begin_kad2("Jawi");
        $rp = get_row_count("sripi_rph", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$rp</div>";
        end_kad();
        echo "</div>";
    } else {
        echo "<div class='col-md-3'>";
        begin_kad2("Guru");
        $sekolah = $CURUSER['company'];
        $guru = get_row_count("users", "WHERE company = '$sekolah' AND class > 1");
        echo "<div style='font-size:1cm'>$guru</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-3'>";
        begin_kad2("Murid");
        $user = $CURUSER['id'];
        $kodsek = infoSekolah($sekolah, "kod");
        $murid = get_row_count("sripi_murid", "WHERE kodsekolah = '$kodsek'");
        echo "<div style='font-size:1cm'>$murid</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-3'>";
        begin_kad2("Kelas");
        $kls = get_row_count("sripi_kelas", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$kls</div>";
        end_kad();
        echo "</div>";
        echo "<div class='col-md-3'>";
        begin_kad2("RPH");
        $rp = get_row_count("sripi_rph", "WHERE user = '$user'");
        echo "<div style='font-size:1cm'>$rp</div>";
        end_kad();
        echo "</div>";
    }

    echo "</div>";

    profile();

    if ($CURUSER["class"] > 1) {
        rphanda($user);
    }

    end_frame();
}

if ($_GET['action'] == "gambar") {

    begin_frame("Gambar Anda");

    navmenu();

    pic();

    end_frame();
}

if ($_GET['action'] == "tkrpass") {

    if (isset($_POST['tukarpass'])) {

        $chpassword = $_POST['chpassword'];
        $passagain = $_POST['passagain'];

        if ($chpassword != "") {
            $res = mysqli_query($con, "SELECT id, password, secret, enabled FROM users WHERE id = " . $CURUSER["id"] . " AND status = 'confirmed'");
            $row = mysqli_fetch_array($res);

            if (strlen($chpassword) < 6)
                $message = "Katalaluan terlalu pendek!";
            if ($chpassword != $passagain)
                $message = "Katalaluan tidak sama!";
            $chpassword = md5($chpassword);
        }

        if ((!$chpassword) || (!$passagain))
            $message = "Sila isi ruang yang berkenaan!";

        begin_frame("Tukar Katalaluan");

        navmenu();

        if (!$message) {
            mysqli_query($con, "UPDATE users SET password = " . sqlesc($chpassword) . "  WHERE id = " . $CURUSER["id"] . "") or die(mysqli_connect_error());
            echo "<p><center><b>Katalaluan telah ditukar. Anda diminta log masuk semula.</b></center></p>";
    ?>
<script>
window.location.replace("signout.php");
</script>
<?
            //logoutcookie();
        } else {

            show_error_msg("Error", $message, 1);
        }

        end_frame();

        stdfoot();

        die();
    }

    begin_frame("Tukar Katalaluan");

    navmenu();

    begin_kad("Tukar Katalaluan");

    echo "<form method='post' action='akaun.php?action=tkrpass'>";

    echo "<div class='container-fluid' style='margin-top:15px; padding:10px'><div class='row'>
    <div class='col-md-2 col-lg-2' style='padding:10px; text-align:center'>";

    echo "<i class='fas fa-lock fa-7x'></i>";

    echo "</div><div class='col-md-10 col-lg-10' style='color:black'>";

    echo "<input type=\"hidden\" name=\"action\" value=\"tkrpass\">";
    sayang("Katalaluan Baru", "<input type=\"password\" class='form-control' name=\"chpassword\" />");
    sayang("Ulang Katalaluan Baru", "<input type=\"password\" class='form-control' name=\"passagain\" />");
    sayang("", "<button type=\"submit\" name='tukarpass' class=\"btn btn-primary pull-right\">Simpan</button>");

    echo "</div></div></div>";

    echo "</form>";

    ebloku();

    end_frame();
}

if ($_GET['action'] == "edit") {

    ?>

<script>
jQuery(document).trigger('close.facebox');
</script>

<?

    begin_frame("Kemaskini Maklumat", "<li><a href='akaun.php'>Dashboard Anda</a></li><li><a href='akaun.php?action=edit'>Kemaskini Maklumat</a></li>");

    navmenu();

    if ($_GET['b'] == "clearheader") {
        $id = mysqli_real_escape_string($con, $_GET['id']);
        mysqli_query($con, "UPDATE users SET headerrph = '' WHERE id = '$id'");
    }

    if ($_GET['b'] == "clearlogo") {
        $id = mysqli_real_escape_string($con, $_GET['id']);
        mysqli_query($con, "UPDATE sripi_sekolah SET logo = '' WHERE id = '$id'");
    }

    echo "<ul class=\"nav nav-pills nav-primary nav-justified\" style='padding:10px;background:url(images/bulang.png) repeat;font-weight:bold' role=\"tablist\">
    <li role=\"presentation\" class=\"active\"><a href=\"#editprofil\" aria-controls=\"home\" role=\"tab\" data-toggle=\"tab\"><i class='fa fa-id-card' style='margin-bottom:5px'></i> Profil</a></li>
    <li role=\"presentation\"><a href=\"#editsekolah\" aria-controls=\"profile\" role=\"tab\" data-toggle=\"tab\"><i class='fa fa-building' style='margin-bottom:5px'></i> Sekolah</a></li>
    </ul>";

    echo "<div class=\"tab-content\">";
    echo "<div role=\"tabpanel\" class=\"tab-pane active\" id=\"editprofil\">";

    editInfo($CURUSER["id"]);

    echo "</div>";
    echo "<div role=\"tabpanel\" class=\"tab-pane\" id=\"editsekolah\">";

    begin_kad("Edit Maklumat Sekolah");

    info("Sila klik TAMBAH SEKOLAH jika sekolah anda tiada dalam senarai sekolah.");

    $id = $CURUSER["id"];

    $sks = mysqli_query($con, "SELECT * FROM users WHERE id = $id");
    $sr = mysqli_fetch_assoc($sks);

    $sekolah = $sr['company'];

    function infoPPD($id)
    {

        global $con;

        if ($id != 0) {

            $ho = mysqli_query($con, "SELECT * FROM sripi_sekolah WHERE id = '$id'");
            $hu = mysqli_fetch_assoc($ho);
            extract($hu);
            return $ppd;
        }
    }

    function infoNegeri($id)
    {

        global $con;

        if ($id != "") {

            $ho = mysqli_query($con, "SELECT * FROM sripi_ppd WHERE nama = '$id'");
            $hu = mysqli_fetch_assoc($ho);
            extract($hu);
            return $negeri;
        }
    }

    $jnssek = infoSekolah($sekolah, "jenis");

    $pilihjns = "<select onchange='jenissekolah(\"$sekolah\")' id='jnssek' name='jnssek' class='form-control'>";
    $pilihjns .= "<option value='0'>--Sila Pilih Jenis Sekolah--</option>";
    $pilihjns .= "<option value='sk'";
    if ($jnssek == 'sk') $pilihjns .= 'selected';
    $pilihjns .= ">SK</option>";
    $pilihjns .= "<option value='sjk'";
    if ($jnssek == 'sjk') $pilihjns .= 'selected';
    $pilihjns .= ">SJK</option>";
    $pilihjns .= "<option value='sjkb'";
    if ($jnssek == 'sjkb') $pilihjns .= 'selected';
    $pilihjns .= ">SJKB</option>";
    $pilihjns .=  "</select>";

    $pipd = infoPPD($CURUSER["company"]);
    $nog = infoNegeri($pipd);

    $neg = pilihan("negeri", "sripi_negeri", $nog, "id", "browseppd(\"negeri\")");
    sayang("Negeri", $neg);
    sayang("Daerah", "<span id='divvppd'>" . pilihan("ppd", "sripi_ppd", $pipd, "nama", "browsesek(\"ppd\")", "WHERE negeri = '$nog'") . "</span>");
    echo "<div id='updatesek'>";
    echo "<div id='divvsek'>";
    sayang("Nama Sekolah", pilihsekolah($sekolah));
    echo "</div>";
    sayang("Jenis Sekolah", $pilihjns);
    echo "</div>";
    sayang("Nama Guru Besar", "<input type='text' id='pgb' value='".infoSekolah($sekolah,"pgb")."' class='form-control'>");
    sayang("Nama GPK Pentadbiran", "<input type='text' value='".infoSekolah($sekolah,"pk1")."' id='pk1' class='form-control'>");
    sayang("Nama GPK HEM", "<input type='text' id='pkhem' value='".infoSekolah($sekolah,"pkhem")."' class='form-control'>");
    sayang("Nama GPK Kokurikulum", "<input type='text' value='".infoSekolah($sekolah,"pkkoku")."' id='pkkoku' class='form-control'>");
    sayang("Nama GPK Petang", "<input type='text' id='pkptg' value='".infoSekolah($sekolah,"pkptg")."' class='form-control'>");
    sayang("", "<span id=\"loading\"></span> <button class=\"btn btn-success\" onclick=\"editsekolah('$id')\">Simpan</button> <button class=\"btn btn-info\" onclick=\"tambahsekolah()\">Tambah Sekolah</button>");

    ebloku();

    echo "</div></div>";

    end_frame();
}



stdfoot();
?>