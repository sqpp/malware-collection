<?
$NomePagina="lista_fotogallery";
// includo file inizializzazione pagina
include("../cfg/start.inc.php");
include("../inc/".$NomePagina.".inc.php");

// inizializzo classe pagina
$Pagina=new Pagina($tpl,$DB,$NomePagina);

if($SessionGEST_AGENZIE[_AUT_TABELLA_]!=""){
	$MainFile="main_strutture.html";
}else{
	$MainFile="main.html";
}

// setto i file di template utilizzati nella pagina
$aFile=array(
	"main"=>$MainFile,
	"tabella"=>"tabella.html",
	"riga"=>"riga.html",
	"cella"=>"cella.html",
	"button_delete"=>"button_delete.html",
	"button_modifica"=>"button_modifica.html",
	"button_visualizza"=>"button_visualizza.html",
	"button_documenti"=>"button_documenti.html",
	"ceck_pulsante"=>"check_pulsante.html",
	"ceck_pulsante_copia"=>"check_pulsante_copia_nascosta.html",
	"ins_radio"=>"ins_radio.html",
	"link"=>"link.html",
	"FrecciaAsc"=>"FrecciaAsc.html",
	"FrecciaDesc"=>"FrecciaDesc.html",
	"confirm_box"=>"conferma_cancellazione.html",
	"ancora"=>"ancora.html",
	"box_paginazione"=>"box_paginazione.html",
	"modello_lista"=>"modello_lista.html",
	"lista"=>$NomePagina.".html"
);

$Pagina->tpl_set_file($aFile);
$Sezione="Fotogallery";
$Pagina->ColoreSezione($Sezione);

// Carico tutte le variabili inviate alla pagina

$Pagina->set_GETVARS($_GET);
$Pagina->set_POSTVARS($_POST);
$Pagina->set_SESSION($_SESSION);

$Pagina->ConfigLista();

$Aut=new Autenticate(TRUE,$Pagina,'login.php');
// ************************************ EFFETTUO LE PROCEDURE DELLA PAGINA *****************************//
if($Pagina->GET_VARS["IMAM"]){
	unset($Pagina->SessionGEST_AGENZIE[_FRM_FOTOGALLERY_ID_]);
	$Pagina->PulisciFiltro();

	Header("Location: ".$NomePagina.".php");
	exit();
}

if(isset($Pagina->POST_VARS["cambiaOrdinamento"])){
	$Pagina->CambiaOrdinamento();
}

if($Pagina->GET_VARS["tabella"]){
	$Pagina->PulisciFiltro();
	$Pagina->SetTipoGallery();

	Header("Location: ".$NomePagina.".php");
	exit();
}


if($Pagina->POST_VARS["Filtro"]){
	// avere il filtro in session permette di evitare messaggio "Avviso: la pagina  scaduta"
	$Pagina->FiltroInSession();
}

if(isset($Pagina->POST_VARS["Type"])){
	
	switch($Pagina->POST_VARS["Type"]){
		case "Del":
			$Pagina->ConfermaCancellazione(0);
			// visualizzo la pagina
			$Pagina->OUTPUT("confirm_box");
			break;
		case "Mod":
			// $Pagina->PulisciFiltro();
			$Pagina->ChiamaForm();
			break;
		case "Ins":
			// $Pagina->PulisciFiltro();
			$Pagina->ChiamaForm();
			break;
		case "Eco":
			// $Pagina->PulisciFiltro();
			$Pagina->ChiamaForm();
			break;
	}
}elseif(isset($Pagina->POST_VARS["aDel"])){
	$Pagina->ConfermaCancellazione(1);
	$Pagina->OUTPUT("confirm_box");
}elseif(isset($Pagina->POST_VARS["cDel"])){
	$Pagina->Cancella();

	Header("Location: ".$NomePagina.".php");
	exit();
}else{
	$Pagina->DisegnaLista();

	// visualizzo la pagina
	$tpl->parse("_TABELLA_LISTA_","modello_lista");
	$Pagina->OUTPUT("lista");
}


// ************************************ FINE PROCEDURE DELLA PAGINA ***********************************//

?>