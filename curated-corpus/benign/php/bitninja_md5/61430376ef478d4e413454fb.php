<? 
session_start();
if(!isset($_SESSION['user'])) {
echo "<script language=\"JavaScript\">";
echo "document.location.href=\"index.php\"";
echo "</script>";
}

error_reporting(0);
include_once 'parametri.inc.php';
include_once 'gestioneFile.inc.php';
include_once 'funzioni.inc.php';

// connessione al DB
$conn = mysql_connect( $db_host, $db_user, $db_pass) or die("Impossibile connettersi al server MYSQL");

// selezione del DB
mysql_select_db( $db_name, $conn) or die ("Impossibile selezionare il database $db_name.");

$link = "notizie.php";

if ($_POST['id'] > 0) {$xxID = $_POST['id'];} else {$xxID = 0;};
if ($_POST['txtCod'] > 0) {$xxID = $_POST['txtCod'];} else {$xxID = 0;};
if ($_POST['az'] > 0) {$xxAZ = $_POST['az'];} else {$xxAZ = 0;};


// nuovo record
if ($xxAZ == 0) {
$link = $link . "?id=99999";
}

// fine nuovo record

// elimina record
if ($xxAZ == 3) {

$strSQL = "DELETE FROM notizie WHERE id_not = '$xxID'";

$rsCont = mysql_query($strSQL,$conn) or die ("Impossibile eseguire il comando SQL1a.");
$dsCont = mysql_fetch_row($rsCont);

$file1Name = sprintf("%06d", $xxID);
$file1Ext = "jpg";
deleteFile($PATH, $file1Name, $file1Ext);

$link = $link . "?id=0";
}

// fine elimina record

// immissione nuovo record

if ($xxAZ == 1) {
$xxTitolo = str_replace("<p>","",$_POST['txtTitolo']);
$xxTitolo = str_replace("</p>","",$xxTitolo);
$xxSottot = str_replace("<p>","",$_POST['txtSottotit']);
$xxSottot = str_replace("</p>","",$xxSottot);

$strSQL = "INSERT INTO notizie (titolo, sottotit, testo, tipo, id_zona, id_cat, flag_home, arch, datarif, videourl) VALUES (" . 
"'" . str_replace("'","´",$xxTitolo) . "'," . 
"'" . str_replace("'","´",$xxSottot) . "'," . 
"'" . str_replace("'","´",$_POST['txtTesto']) . "'," . 
"'" . str_replace("'","´",$_POST['selTipo']) . "'," . 
"'" . str_replace("'","´",$_POST['selZona']) . "'," . 
"'" . str_replace("'","´",$_POST['selCat']) . "'," . 
"'" . str_replace("'","´",$_POST['selHome']) . "'," . 
"'" . str_replace("'","´",$_POST['selArc']) . "'," . 
"'" . dateAMG($_POST['txtData']) . "'," . 
"'" . str_replace("'","´",$_POST['txtVideo']) . "'" . 
")";

//echo $strSQL;

$rsCont = mysql_query($strSQL,$conn) or die ("Impossibile eseguire il comando SQL1b.");
//$dsCont = mysql_fetch_row($rsCont);

$xxUltimoCod = mysql_insert_id();

$link = $link . "?id=$xxUltimoCod";

}

// - fine INSERT -----------------------

// UPDATE  record

if ($xxAZ == 2) {
$xxTitolo = str_replace("<p>","",$_POST['txtTitolo']);
$xxTitolo = str_replace("</p>","",$xxTitolo);
$xxSottot = str_replace("<p>","",$_POST['txtSottotit']);
$xxSottot = str_replace("</p>","",$xxSottot);

$strSQL = "UPDATE notizie SET " . 
" titolo = '" . str_replace("'","´",$xxTitolo) . "'," . 
" sottotit = '" . str_replace("'","´",$xxSottot) . "'," . 
" testo = '" . str_replace("'","´",$_POST['txtTesto']) . "'," . 
" tipo = '" . str_replace("'","´",$_POST['selTipo']) . "'," . 
" id_cat = '" . str_replace("'","´",$_POST['selCat']) . "'," . 
" id_zona = '" . str_replace("'","´",$_POST['selZona']) . "'," . 
" flag_home = '" . str_replace("'","´",$_POST['selHome']) . "'," .
" arch = '" . str_replace("'","´",$_POST['selArc']) . "'," .
" datarif = '" . dateAMG($_POST['txtData']) . "'," . 
" videourl = '" . str_replace("'","´",$_POST['txtVideo']) . "'" . 
" WHERE id_not = $xxID";
//echo $strSQL;
$rsCont = mysql_query($strSQL,$conn) or die ("Impossibile eseguire il comando SQL2c.");
//$dsCont = mysql_fetch_row($rsCont);

$link = $link . "?id=$xxID";


}

// -- FINE UPDATE----------------------


lancio($link);

?>
