<?php
error_reporting (E_ALL ^ E_NOTICE);
include_once 'assets/libs/class.database.php';
include_once 'assets/libs/class.session.php';
include_once 'assets/libs/class.commen.php';
include_once 'assets/libs/functions.php';
include_once 'assets/libs/tables.config.php';
session_start();
$session= new Session();
global $database, $db;
$query1='';
if($_POST["length"] != -1)
{
	$query1 = 'LIMIT ' . $_POST['start'] . ', ' . $_POST['length'];
}
       
		$qry="SELECT * FROM `".PATIENT."` WHERE `status`=1 AND `hospital_id`='".$_SESSION['id']."' ORDER BY `created_dt` DESC $query1";
		
		$result = $database->query( $qry );
        
        $totalnumrows=$database->num_rows($result);
        
        $count="SELECT * FROM `".PATIENT."` WHERE `status`=1 AND `hospital_id`='".$_SESSION['id']."' ORDER BY `created_dt` DESC";
        
        $countqry=$database->query($count);
        $numrows=$database->num_rows($countqry);
        $i=$_POST['start']+1;
while($data=$database->fetch_array($result)){
  
    $sub_array = array();
   $url=urlencode( base64_encode( $data['patient_id'] ) );
	$sub_array[] = $i;
	$sub_array[] ='<a href="update_data.php?id='.$url.'&flag=1" class="btn btn-sm btn-icon btn-pure btn-default on-default edit-row" data-toggle="tooltip" data-original-title="Edit"><i class="icon md-edit" aria-hidden="true"></i></a>';
	$sub_array[] = jetz::date_order($data['assigned_dt']);
	$sub_array[] = jetz::date_order($data['conducted_dt']);
	$sub_array[] = jetz::request_type_name($data['request_type_id']);
	$sub_array[] = $data['patient_name'];
	$sub_array[] = $data['crm_no'];
	$sub_array[] = $data['eid_no'];
	$sub_array[] = $data['phone_no'];
	$sub_array[] = jetz::get_sex_name($data['sex']);
	$sub_array[] = $data['age'];
	$data1[] = $sub_array;
		$i++; 
		    
		}
	$output = array(
    "draw"		=>	intval($_POST["draw"]),
	"recordsTotal"	=>	$totalnumrows ?: 0,
	"recordsFiltered"	=>	$numrows ?: 0,
	"data"	=>$data1 ?: "",
	"query"=>$count
);

echo json_encode($output);
		
		
		
		