<?php

require_once('bootstrap.php');

$starttimer = time() + microtime();
$price = $config->get('price');
$keszlet = $config->get('keszlet');
if ( $price && $keszlet ) {
	// Inkább adjuk át a filet, hogy ne csak a CHShez tudjuk felhasználni
	// Szabi 2011.03.23
	$importFile = $_REQUEST['import_file'];
	if ( $importFile == "" ) {
		die('Nincs importFile');
	}

	$sqlPath = C::getOption('DIR_BASE').'/admin/import/'.$importFile.'.sql';
	if ( !is_file($sqlPath) ) {
		die('Nincs SQL: '.$sqlPath);
	}
	$command = 'mysql -u ' . ShopAdmin::gVar('mosConfig_user').
		' --password=' . ShopAdmin::gVar('mosConfig_password').
		' ' . C::getOption('DB_DATABASE').' < '.$sqlPath;
	
//	echo "<hr>$command<hr>";
	$ret = exec($command, $output, $retval);
//	var_dump($ret, $output, $retval); die;
	// Adjunk vissza 1et, hogy sikerült
	return 1;
	/*
	ob_start();
	var_dump($ret,$output,$retval);
	$qwe = ob_get_clean();
	/* */
	/*
	$f = fopen(C::getOption('DIR_BASE').'/admin/import/raktarkeszlet_import_log.txt',"a");
	fwrite($f,$ocShop->name." - ".date("Y-m-d H:i:s")."\n");
	fclose($f);
	/**/
}
$stoptimer = time() + microtime();
$timer = round($stoptimer - $starttimer, 4);
if ( !($price && $keszlet) ) {
	error_reporting(0);
	echo 'ár- és raktárkészlet frissítés nincs engedélyezve: '.$ocShop->name.'<br />';
	error_reporting(E_ERROR);
	// Hiba volt, adjunk vissza -1-et
	return -1;
}
//echo "Page created in $timer seconds.";

?>
