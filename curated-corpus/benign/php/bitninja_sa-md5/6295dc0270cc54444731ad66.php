<?php
	require_once("session.php");
	require_once("../conn.php");
	require_once("../config.php");

	$msg="";

	if(isset($_POST['add'])){
		$cat_id=filter_input(INPUT_POST, "cat_id");
		$subcat_id=filter_input(INPUT_POST, "subcat_id");
		$name=filter_input(INPUT_POST, "name");
		$price=filter_input(INPUT_POST, "price");
		$currency=filter_input(INPUT_POST, "currency");
		$shipping_charge=filter_input(INPUT_POST, "shipping_charge");
		$description=filter_input(INPUT_POST, "description");

		$photo=$_FILES['photo']['name'];
		$photo_1=$_FILES['photo_1']['name'];
		$photo_2=$_FILES['photo_2']['name'];
		$photo_3=$_FILES['photo_3']['name'];
		$photo_4=$_FILES['photo_4']['name'];
		
		$photo=time()."_".$photo;
		$photo_1=time()."_".$photo_1;
		$photo_2=time()."_".$photo_2;
		$photo_3=time()."_".$photo_3;
		$photo_4=time()."_".$photo_4;
	
		$path="../assets/images/products/$photo";
		$path1="../assets/images/products/$photo_1";
		$path2="../assets/images/products/$photo_2";
		$path3="../assets/images/products/$photo_3";
		$path4="../assets/images/products/$photo_4";
		
		$sql="select * from products where name='$name' and cat_id=$cat_id and subcat_id=$subcat_id";
		$query=mysqli_query($conn, $sql);
		if(mysqli_num_rows($query)>0){
			$msg="Product Name already exist";
		}else{
			$sql="insert into products 
			(cat_id, subcat_id, name, price, shipping_charge, currency, description, photo, photo_1, photo_2, photo_3, photo_4) 
			values ('$cat_id', '$subcat_id', '$name', '$price', '$shipping_charge', '$currency', '$description', '$photo', '$photo_1', '$photo_2', '$photo_3', '$photo_4')";
			$query=mysqli_query($conn, $sql);

			move_uploaded_file($_FILES['photo']['tmp_name'], $path);
			move_uploaded_file($_FILES['photo_1']['tmp_name'], $path1);
			move_uploaded_file($_FILES['photo_2']['tmp_name'], $path2);
			move_uploaded_file($_FILES['photo_3']['tmp_name'], $path3);
			move_uploaded_file($_FILES['photo_4']['tmp_name'], $path4);


			$id = mysqli_insert_id($conn);
			$size =implode(",", $_POST['size']);
			$color = implode(",", $_POST['color']);

			$sql = "insert into product_sizes (pro_id, price, currency, size, color) values ('$id', '$price', '$currency', '$size', '$color')";
			$query = mysqli_query($conn, $sql);

		
			
			header("location:products.php");
		}
	}
	

?>
<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Add Product</title>

  <?php include("links.php"); ?>

</head>

<body id="page-top">

  <?php include("navbar.php"); ?> 

  <div id="wrapper">

    <?php include("sidebar.php"); ?>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="index.php">Dashboard</a>
          </li>
		  <li class="breadcrumb-item">
            <a href="products.php">Products</a>
          </li>
          <li class="breadcrumb-item active">Add Product</li>
        </ol>

        

        <!-- DataTables Example -->
        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-table"></i>
            Add Product
			  
		  </div>
          <div class="card-body">
			<form action=" " method="post" enctype="multipart/form-data">  
			<div class="row">
				<div class="col-lg-4">
					<img src="../assets/images/products/default.png" class="img-fluid"> 
					<div class="form-group">
						  <label>Product Photo</label><strong></strong>
						<input name="photo" type="file" class="form-control" required="required">
					  </div>
						
					  <div style="padding-top:10px;">
					  
				<span style="float:left;"><b>Choose Color</b>
							<select multiple name="color[]" class="form-control">
								<option value="red" style=" background-color:red; border-radius:50%; margin-bottom:3px;  width:20px;"></option>
								<option value="blue" style=" background-color:blue; border-radius:50%; margin-bottom:3px; width:20px;"></option>
								<option value="green" style=" background-color:green; border-radius:50%; margin-bottom:3px; width:20px;"></option>
								<option value="yellow" style=" background-color:yellow; border-radius:50%; margin-bottom:3px; width:20px;"></option>
								<option value="orange" style=" background-color:orange; border-radius:50%; margin-bottom:3px; width:20px;"></option>
								<option value="cyan" style=" background-color:cyan; border-radius:50%; width:20px;"></option>
							</select>
						</span>
						<span style="float:right;"><b>Choose Size</b>
							<select multiple name="size[]" class="form-control">
								<option name="sm" >Sm</option>
								<option value="m" >M</option>
								<option value="r" >R</option>
								<option value="l" >L</option>
								<option value="xl" >Xl</option>
								<option value="xxl" >XXL</option>
							</select>
						</span>
					</div>
				</div>
				<div class="col-lg-8"> 
					  <div class="row">
						  <div class="col-lg-12">
						  		<div class="form-group">
									  <label>Product Name</label>
									<input name="name" type="text" class="form-control" required="required">
								  </div>
						  </div>
					
					  </div>	
					
					
					 <div class="row">
						  <div class="col-lg-6">
						  		<div class="form-group">
									<label>Category</label>
									<select name="cat_id" class="form-control" required="required">
										<option value="">Select Category...</option>
										<?php 
												$sql="select * from categories";
												$query=mysqli_query($conn, $sql);
												while($result=mysqli_fetch_assoc($query)){	

										?>
											<option value="<?php echo $result['id']; ?>"><?php echo $result['name'];  ?></option>
										<?php } ?>
									</select>
								  </div>	
						  </div>
						 <div class="col-lg-6">
						  		<div class="form-group">
									<label>Sub Category</label>
									<select name="subcat_id" class="form-control" required="required">
										<option value="">Select Subcategory...</option>
										<?php 
												$sql="select * from subcategories";
												$query=mysqli_query($conn, $sql);
												while($result=mysqli_fetch_assoc($query)){	

										?>
											<option value="<?php echo $result['id']; ?>"><?php echo $result['name'];  ?></option>
										<?php } ?>
									</select>
								  </div>	
						  </div>
					  </div>
					
					  
					  <div class="row">
						<div class="col-lg-4">
						  	<div class="form-group">
								  <label>Product Price</label>
								<input name="price" type="number" class="form-control" required="required">
							  </div>
						 </div>
						 
						 <div class="col-lg-4">
						  	<div class="form-group">
								  <label>Shipping charges </label>
								<input name="shipping_charge" type="number" class="form-control" required="required">
							  </div>
						 </div>
						  
						  <div class="col-lg-4">
						  	<div class="form-group">
								  <label>Currency</label>
								<select name="currency" class="form-control" required="required">
									<option value="INR">INR</option>
									<option value="USD">USD</option>
									<option value="EUR">EUR</option>
								</select>
							  </div>
						 </div>
					  </div>				  

					  	
					 <div class="row">
					
						<div class="col-lg-12"> 
							<div class="form-group">
								  <label>Product Description</label>
								<textarea name="description" id="ckeditor" class="form-control" required="required"></textarea>
							  </div>
						</div>
					</div>
					  

					  
					
				</div>
				
				
				
			</div>
				<div class="row">
					<div class="col-md-3">
					<img src="../assets/images/products/default.png" class="img-fluid"> 
					<div class="form-group">
						  <label>Product Photo</label><strong></strong>
						<input name="photo_1" type="file" class="form-control" >
					  </div>
					</div>
					<div class="col-md-3">
					<img src="../assets/images/products/default.png" class="img-fluid"> 
					<div class="form-group">
						  <label>Product Photo</label><strong></strong>
						<input name="photo_2" type="file" class="form-control" >
					  </div>
					</div>
					<div class="col-md-3">
					<img src="../assets/images/products/default.png" class="img-fluid"> 
					<div class="form-group">
						  <label>Product Photo</label><strong></strong>
						<input name="photo_3" type="file" class="form-control" >
					  </div>
					</div>
					<div class="col-md-3">
					<img src="../assets/images/products/default.png" class="img-fluid"> 
					<div class="form-group">
						  <label>Product Photo</label><strong></strong>
						<input name="photo_4" type="file" class="form-control" >
					  </div>
					</div>
				</div>
				<button type="submit" name="add" class="btn btn-primary">Submit</button>	
				<a href="products.php" class="btn btn-dark">Cancel</a>
				

				
			
			</form> 
			
          </div>
          <div class="card-footer small text-muted"></div>
        </div>
	

      </div>
      <!-- /.container-fluid -->

      

    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->
<?php include("footer.php"); ?>

<script>
	CKEDITOR.replace( 'ckeditor' );
</script>	
	
</body>

</html>
