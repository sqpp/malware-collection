<?php
session_start();

$uploaddir = '../ftp/pic_temp/'; 
$uploaddir_2 = '../ftp/pic_temp/thumb/'; 

if(ISSET($_GET['sid'])){
		$userID = $_GET['sid'];

		$file = $userID."_".strtolower(basename($_FILES['uploadfile']['name'])); 


		$size = $_FILES['uploadfile']['size'];

		if($size>1048576)
		{
			echo "error file size > 1 MB";
			unlink($_FILES['uploadfile']['tmp_name']);
			exit;
		}

		if (move_uploaded_file($_FILES['uploadfile']['tmp_name'], $uploaddir.$file) ) {
		copy($uploaddir.$file, $uploaddir_2.$file);

		$imgdir = $uploaddir_2;
		$img = $file;
		$tndir=$uploaddir_2;
		$img_uj=$file;
		$tn_w="140"; //uj szelesseg

		#-+ Beolvassa az tmretezend file-t
		$src_img_src=$imgdir.$img;
		$src_img = ImageCreateFromJPEG($src_img_src);

		#-+ Beolvassa az eredeti magassgot, szlessget
		$org_h = imagesy($src_img);
		$org_w = imagesx($src_img);

		#-+ Kiszmolja az uj kp magassgt
		$tn_h = floor($tn_w * $org_h / $org_w);

		#-+ Elksziti az uj kpet
		$dst_img = ImageCreateTrueColor($tn_w,$tn_h);

		#-+ tmretezi
		ImageCopyResampled($dst_img, $src_img, 0, 0, 0, 0, $tn_w, $tn_h, $org_w, $org_h);

		#-+ Elmenti...
		$imgjpg_dst=$tndir.$img_uj;
		ImageJPEG($dst_img, $imgjpg_dst, 100);

		echo "success,".$userID; 
		  
		  
		} else {
			echo "error ".$_FILES['uploadfile']['error']." --- ".$_FILES['uploadfile']['tmp_name']." %%% ".$file."($size)";
		}
}
?>