<?php
$_SERVER['DOCUMENT_ROOT'] = realpath(dirname(__FILE__) . '/../');
include $_SERVER['DOCUMENT_ROOT'] . '/models/Funcionario.php';
//session_start();

$mod = new Funcionario();

switch ($_SERVER["REQUEST_METHOD"]) {

    case "GET":

        $res = false;
        $obj = $mod->select('do', $_REQUEST["hdn_ndo"]);


        //$datws = $mod->DatosWebSimex($_REQUEST["hdn_ndo"]);
        //echo json_encode(array( 'tipoimpo' => $tipoimpo, 'modalidad' => $modalidad, 'prioridad'=>$prioridad, 'data'=>$obj));
        echo json_encode(array('error' =>  $res, 'data' => $obj));

        break;

    case "POST":

        $obj = $mod->DatosWebSimex($_REQUEST["hdn_ndo"]); 
        if( count($obj)>0 ){
            if( $obj->do != null ){
                $obj->usuario_registro    = $_REQUEST["hdn_user_bitacora"]; //$_SESSION['user_bitacora'];
                $obj->fecha_registro      = date("Y-m-d h:m:s");
                $obj->usuario_modifica    = $_REQUEST["hdn_user_bitacora"]; //$_SESSION['user_bitacora'];
                $obj->fecha_modificacion  = date("Y-m-d h:m:s");
                $res = $obj->saved();
            }
        }
        if($obj=="si existe"){
            $res=$obj;
        }

        echo json_encode(array('error' =>  !$res, 'data' => $res));

        break;

    case "PUT":
        $obj = $mod->DatosWebSimex($_REQUEST["hdn_ndo"]); 
        if( count($obj)>0  ){
            if( $obj->do != null ){
                $obj->usuario_modifica    = $_REQUEST["hdn_user_bitacora"]; //$_SESSION['user_bitacora'];
                $obj->fecha_modificacion  = date("Y-m-d h:m:s");
                $res = $obj->saved();
            }
        }

        echo json_encode(array('error' =>  !$res, 'data' => $res));
        break;

    case "DELETE":
        $res = $mod->delete($_REQUEST["id"], $_REQUEST["hdn_user_bitacora"]); //$_SESSION['user_bitacora']);
        return $res;
        break;
}

//session_write_close();
