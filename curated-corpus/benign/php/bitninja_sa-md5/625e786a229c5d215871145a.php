<?php include("include/config.php");?>
<?php include("include/cDatabase.php");?>
<?php if(isset($_REQUEST['cid']) && $_REQUEST['cid'] =='') { ?>
<script type="text/javascript" language="javascript">window.location = 'Workshop-Category-List.php';</script>
<?php } ?>
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--><html lang="en"><!--<![endif]-->

<head>
<meta charset="utf-8">
<!-- Viewport Metatag -->
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<?php include("include/stylesheet.php");?>
<title>Workshop Category - Update</title>
<script src="js/jquery-1.3.2.min.js"></script>
</head>
<body>
<!-- Header -->
<?php include("include/header.php");?>
<!-- Start Main Wrapper -->
<div id="mws-wrapper"> 
  <!-- Necessary markup, do not remove -->
  <div id="mws-sidebar-stitch"></div>
  <div id="mws-sidebar-bg"></div>
  <!-- Sidebar Wrapper -->
  <?php include("include/sidebar.php");?>
  <!-- Main Container Start -->
  <div id="mws-container" class="clearfix"> 
    <!-- Inner Container Start -->
    <div class="container"> 
      <!-- Panels Start -->
      <div class="mws-panel grid_8">
        <div class="mws-panel-header"><span>Workshop Category - Update</span></div>
        <div class="mws-panel-body no-padding">
          <?php  
	
			$cDB = new cDatabase();	
			$result = $cDB->ExecuteReader("SELECT * FROM workshop_category WHERE category_id='". $_REQUEST['cid'] ."'");
	
				$row = mysql_fetch_assoc($result);
				?>
          <form class="mws-form" enctype="multipart/form-data" action="Workshop-Category-Update.php" method="post" id="feedback">
            <div class="mws-form-inline">
              <div class="mws-form-row">
                <label class="mws-form-label">Category Name *</label>
                <div class="mws-form-item">
                  <input type="text" id="name" name="name" class="small"  value="<?php echo $row['name'];?>">
                </div>
              </div>
              <div class="mws-form-row">
                <label class="mws-form-label">Description</label>
                <div class="mws-form-item">
                  <textarea rows="" cols="" name="description"  id="description" class="large"><?php echo $row['description'];?></textarea>
                </div>
              </div>
              <div class="mws-form-row">
                <label class="mws-form-label">Image</label>
                <div class="mws-form-item">
                  <input type="file"  id="image" name="image">
                </div>
              </div>
              <div style="height:100px; width:100px;  margin-left:180px;">
                <label class="mws-form-label"></label>
                <img src=<?php echo "images/workshop/". $row['image']; ?> style="border:1px solid #cccccc;" width="100"  height="80"/> </div>
              <div class="mws-form-row">
                <label class="mws-form-label">Sort Order</label>
                <div class="mws-form-item">
                  <input type="text" id="sort" min="1" maxlength="3"  value="<?php echo $row['sort_order'];?>" name="sort">
                </div>
              </div>
              <div class="mws-form-row">
                <label class="mws-form-label">Status</label>
                <div class="mws-form-item">
                  <select class="small" name="status" id="status">
                    <?php 
				  if($row['status'] == 1){
					  ?>
                    <option value="1" selected="selected">Active</option>
                    <option value="0">Inactive</option>
                    <?php }
					else{ ?>
                    <option value="0" selected="selected">Inactive</option>
                    <option value="1">Active</option>
                    <?php } ?>
                  </select>
                </div>
              </div>
            </div>
            <div class="mws-button-row">
              <input type="submit" value="Submit" class="btn btn-danger" name="btnsave">
              <input type="hidden"  name="category_id" id="category_id" value="<?php echo $row['category_id'];?>" />
            </div>
          </form>
        </div>
      </div>
      <!-- Panels End --> 
    </div>
    <!-- Inner Container End --> 
    <!-- Footer -->
    <?php include("include/footer.php");?>
  </div>
  <!-- Main Container End --> 
</div>
<!-- JavaScript Plugins -->
<?php include("include/jscript.php");?>
</body>
</html><?php
if(isset($_POST['btnsave']))
	  	{ 
			try
			{
					/* If New File Selected */
            if($_FILES['image']['size'] > 0){
               $file=$_FILES['image']['tmp_name'];
				$file= addslashes(file_get_contents($_FILES['image']['tmp_name']));
				$file_name = preg_replace('/\s+/', '',$_FILES['image']['name']);
				$file_name_array = explode('.',$file_name);
				$newfilename = $file_name_array[0].'-'.time().".".$file_name_array[1];
				move_uploaded_file($_FILES["image"]["tmp_name"],"images/workshop/".$newfilename);
                
                $names1 = array('image');
                $values1 = array($newfilename);
                 $where="WHERE category_id='".$_POST['category_id']."'";
                 $result1 = $cDB->sqlUpdate($names1, $values1,"workshop_category",$where);
            }

			$cDB = new cDatabase();	
			$names1 = array('name','description','sort_order','status','date_modified');	
	$values1 =array(($_POST['name']),($_POST['description']),$_POST['sort'],$_POST['status'],date("Y-m-d H:i:s"));
			  
			$where="WHERE category_id='".$_REQUEST['category_id']."'";
			$result1 = $cDB->sqlUpdate($names1, $values1,"workshop_category",$where);
		
			  ?>
<script type="text/javascript" language="javascript">window.location = 'Workshop-Category-List.php';</script>
<?php 
			  } catch (Exception $e) {
			echo 'Caught exception: ',  $e->getMessage(), "\n";
		}
		}
	
		?>
