<?php include 'header.php';

// Inialize session

// Check, if username session is NOT set then this page will jump to login page
if ((!isset($_SESSION['aujscitech'])) || (!isset($_SESSION['submit_id'])) ){
        header("Location: step1.php?type=$_GET[type]");
}
$id=$_SESSION['submit_id'];
include 'config.inc';
$corr=mysql_query("SELECT * FROM authors WHERE submit_id='$id' AND corres='yes'");
$cc=mysql_fetch_array($corr);
$corr_name=$cc['author_name'];
$corr_email=$cc['email'];
$author_id=$cc['author_id'];
$up=mysql_query("UPDATE temporary SET corr_author='$corr_name', corr_email='$corr_email', id='$author_id' WHERE submit_id='$id'");
echo"
<a><input STYLE='border-radius:8px;  height:30px; color: #000; font-family: Verdana; font-weight: bold; font-size: 12px; background-color: #F5ECCE;' type='button' title='Cannot go back as session started!' value='Step0: Login'></a>

<a href='step2.php?type=$_GET[type]'><input STYLE='border-radius:8px;  height:30px; color: #000; font-family: Verdana; font-weight: bold; font-size: 12px; background-color: #F5ECCE;' type='button' value='Step1: Indexing'></a>


<a href='step3.php?type=$_GET[type]'><input type='button' STYLE='border-radius:8px;  height:30px; color: #000; font-family: Verdana; font-weight: bold; font-size: 12px; background-color: #F5ECCE;' value='Step2: Authors'></a>

<a href='step4.php?type=$_GET[type]'><input type='button' STYLE='border-radius:8px;  height:30px; color: #000; font-family: Verdana; font-weight: bold; font-size: 12px; background-color: #58FAF4;' width='20%' value='Step3: File Upload' ></a>

<a href='step5.php?type=$_GET[type]'><input STYLE='border-radius:8px;  height:30px; color: #000; font-family: Verdana; font-weight: bold; font-size: 12px; background-color: #F5ECCE;' type='button' value='Step4: Verify'></a>

<a><input STYLE='border-radius:8px;  height:30px; color: #000; font-family: Verdana; font-weight: bold; font-size: 12px; background-color: #F5ECCE;' type='button' value='Step5: Finish' title='Untill verification you cannot enter this zone'></a>

<center><div style='width:700px;'><h3>Upload Required Files One By One::</h3>
<br><br>
";
if(!(isset($_POST['file'])))
{
?>
<table width="100%" border='0' cellpadding="3" cellspacing="1" >
<tr><td colspan='4'>Files Uploaded:</td></tr>
<tr><td>File name</td><td>Path:</td><td>Type:</td><td>Remove</td></tr>
<tr><td colspan=4><hr/></td></tr>
<?php
include 'config.inc';
$sqlf=mysql_query("SELECT * FROM `file` WHERE submit_id='$_SESSION[submit_id]' AND (file_type!='Figure' AND file_type!='supplementary')");
if(mysql_num_rows($sqlf)==0)
{
echo"<tr><td colspan=4 align=center style='color:blue;'>".mysql_num_rows($sqlf)." File Uploaded</td></tr>";
}
else{
while($s=mysql_fetch_array($sqlf))
{
echo"<tr><td>$s[file_name]</td><td>$s[file_path]</td><td>$s[file_type]</td><td><a onclick=\"return confirm('Are you sure to remove file?')\" href='author_proceed.php?file=$s[file_path]&con=$s[con_type]&action=remove&submit_id=$_SESSION[submit_id]&type=$_GET[type]'><img src='file/del.png'></a></td></tr>";
}}

?>

<?php
}
else{
if($_FILES['ufile1']['size']>1048756)
{
echo"Upload File below 1MB size";}
if (file_exists("pdf/$id")) {
$path1= "pdf/$id/".$_FILES['ufile1']['name'];
}
else{
mkdir("pdf/$id", 0700);
$path1= "pdf/$id/".$_FILES['ufile1']['name'];
}
//copy file to where you want to store file
$copied=copy($_FILES['ufile1']['tmp_name'], $path1);

///////////////////////////////////////////////////////
// Use this code to display the error or success.
if($copied)
{
include 'config.inc';
$file_name=$_FILES['ufile1']['name'];
mysql_query("INSERT INTO  `file` (`submit_id`, `file_name`,`file_path` ,`file_type`)VALUES ('$id', '$file_name', '$path1', '$_POST[type]')");
$ext=end(explode('.', $file_name));
$ext = strtolower($ext);
if($ext=='pdf')
{
if (file_exists("pdf/$id/proof")) {
$new_path="pdf/$_SESSION[submit_id]/proof/$file_name";
}
else{
mkdir("pdf/$id/proof", 0700);
$new_path="pdf/$_SESSION[submit_id]/proof/$file_name";
}
$cope=copy($path1,$new_path);
mysql_query("UPDATE `file` SET `con_type`='$new_path' WHERE file_path='$path1'");
header("location:step4.php?type=$_GET[type]");
}
else if($ext=='doc'||$ext=='docx')
{
include "pdf/file.php";
}
else if($ext=='jpeg'||$ext=='jpg'||$ext=='png'||$ext=='tif'||$ext=='tiff')
{
include "pdf/image.php"; //New file for fpdf
}
else if($_POST['type']=='supplementary')
{
mysql_query("UPDATE `file` SET `con_type`='$path' WHERE file_path='$path1'");
header("location:step4.php?type=$_GET[type]");

}
else
{
echo"Please remove the file and upload file in specified format";
header("refresh:3; url=step4.php?type=$_GET[type]");
}
?>
<?php
}
else
{
echo"Corrupted File! Upload Again";
header("refresh:2; url=step4.php?type=$_GET[type]");
}}
?>
<tr><td colspan=4><br><br><hr/><br><br></td></tr>

<?php
include 'config.inc';
$sq=mysql_query("SELECT * FROM file WHERE submit_id='$_SESSION[submit_id]' AND file_type='cover letter'");
$cover=mysql_num_rows($sq);
$sq1=mysql_query("SELECT * FROM file WHERE submit_id='$_SESSION[submit_id]' AND file_type='Graphical abstract'");
$ga=mysql_num_rows($sq1);
$sq2=mysql_query("SELECT * FROM file WHERE submit_id='$_SESSION[submit_id]' AND file_type='Manuscript'");
$manu=mysql_num_rows($sq2);
$sq3=mysql_query("SELECT * FROM file WHERE submit_id='$_SESSION[submit_id]' AND file_type='Blind Review'");
$blind=mysql_num_rows($sq3);

if($cover==0)
{
$error1='1';
echo"
<form action='step4.php?type=$_GET[type]' method='post' enctype='multipart/form-data' name='form1' id='form1'>
<tr><td colspan='4'><hr/></td></tr>
<tr><td colspan='4'><strong>Maximum size per file should be less than 1MB</strong></td>
</tr>
<tr>
<td><select STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #F5ECCE;' name='type'>
<option value='cover letter'>1. Cover Letter*</option>
</select></td><td colspan=2>
<input name='ufile1' type='file' id='ufile1' /></td>
<td><input name='file' type='submit' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'value='Upload'></td><td></td>
</tr>
</form>
";
}
else
{
$error1='0';
echo"";
}

if($ga==0)
{
$error2='1';
echo"
<form action='step4.php?type=$_GET[type]' method='post' enctype='multipart/form-data' name='form1' id='form1'>
<tr><td colspan='4'><hr/></td></tr>
<tr><td colspan='4'><strong>Maximum size per file should be less than 1MB</strong></td>
</tr>
<tr>
<td><select STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #F5ECCE;' name='type'>
<option value='Graphical abstract'>2. Graphical Abstract*</option>
</select></td><td colspan=2>
<input name='ufile1' type='file' id='ufile1' /></td>
<td><input name='file' type='submit' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'value='Upload'></td><td></td>
</tr>
</form>
";
}
else
{
$error2='0';
echo"";
}
if($manu==0)
{
$error3='1';
echo"
<form action='step4.php?type=$_GET[type]' method='post' enctype='multipart/form-data' name='form1' id='form1'>
<tr><td colspan='4'><hr/></td></tr>
<tr><td colspan='4'><strong>Maximum size per file should be less than 1MB</strong></td>
</tr>
<tr>
<td><select STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #F5ECCE;' name='type'>
<option value='Manuscript'>3. Manuscript*</option>
</select></td><td colspan=2>
<input name='ufile1' type='file' id='ufile1' /></td>
<td><input name='file' type='submit' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'value='Upload'></td><td></td>
</tr>
</form>
";
}
else
{
$error3='0';
echo"";
}
if($blind==0)
{
$error4='1';
echo"
<form action='step4.php?type=$_GET[type]' method='post' enctype='multipart/form-data' name='form1' id='form1'>
<tr><td colspan='4'><hr/></td></tr>
<tr><td colspan='4'><strong>Maximum size per file should be less than 1MB</strong></td>
</tr>
<tr>
<td><select STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #F5ECCE;' name='type'>
<option value='Blind Review'>4. Blind Review File*</option>
</select></td><td colspan=2>
<input name='ufile1' type='file' id='ufile1' /></td>
<td><input name='file' type='submit' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'value='Upload'></td><td></td>
</tr>
</form>
";
}
else
{
$error4='0';
echo"";
}
echo"<tr><td colspan=4><hr/></td></tr></table><br>";
$all=$error1+$error2+$error3+$error4;
if($all!=0){
echo"
<a href='step3.php?type=$_GET[type]' "; ?>onclick="return confirm('Are you sure to go back?')"><input type='button' value='Back' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a onclick="return alert('Cannot proceed as required files are left to upload!')"><input type='button' value='Proceed' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #fff;'></a><?php
}
else
{
echo"
 <a href='step3.php?type=$_GET[type]' "; ?>onclick="return confirm('Are you sure to go back?')"><input type='button' value='Back' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?php echo"<a href='step4a.php?type=$_GET[type]' "; ?>onclick="return confirm('Are you sure to proceed?')"><input type='button' value='Proceed' STYLE='border-radius:8px; height:30px; color: #000; font-family: Verdana; font-weight: bold; background-color: #2EFEF7;'></a>
<?php
}
?>
<br></div><br>
<?php
include 'footer.php';
?>