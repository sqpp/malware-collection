<?php
include('function.php');

if(isset($_POST["cataid"]))
{
	                      $cataid=$_POST["cataid"];
                           $sql = "SELECT * FROM sub_catagory WHERE cata_id='$cataid'"; 
                            $result = $conn->query($sql);
							echo '<option value="0">Select Sub Category</option>';
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<option value='.$row["id"].'>'.$row["cata_name"].'</option> ';
						  }
}


if(isset($_POST["cataidups"]))
{
	                      $cataid=$_POST["cataidups"];
	                      $subcataids=$_POST["subcataidups"];
						 
                           $sql = "SELECT * FROM sub_catagory WHERE cata_id='$cataid'"; 
                            $result = $conn->query($sql);
							echo '<option value="0">Select Sub Sub Category</option>';
							while($row = $result->fetch_assoc()) 
	                      {
							if($row["id"]==$subcataids)
							{  
							  echo '<option value='.$row["id"].' selected="selected">'.$row["cata_name"].'</option> ';
							}
							else
							{
								echo '<option value='.$row["id"].' >'.$row["cata_name"].'</option> ';
							}
						  }
}


if(isset($_POST["subcataidup"]))
{
	                      $cataid=$_POST["subcataidup"];
						  $subsubcataidup=$_post["subsubcataidup"];
                        echo   $sql = "SELECT * FROM sub_sub_category WHERE sub_cata_id='$cataid'"; 
                            $result = $conn->query($sql);
							echo '<option value="0">Select Sub Sub Catagory</option>';
							while($row = $result->fetch_assoc()) 
	                      {
							if($row["id"]==$subsubcataidup)
							{  
							  echo '<option value='.$row["id"].'>'.$row["cata_name"].'</option> ';
							}
							else
							{
								echo '<option value='.$row["id"].' selected="selected">'.$row["cata_name"].'</option> ';
							}
						  }
}




if(isset($_POST["subcataid"]))
{
	                       $cataid=$_POST["subcataid"];
                          echo $sql = "SELECT * FROM sub_sub_category WHERE sub_cata_id='$cataid'"; 
                            $result = $conn->query($sql);
							echo '<option value="0">Select Sub Sub Catagory</option>';
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<option value='.$row["id"].'>'.$row["cata_name"].'</option> ';
						  }
}
if(isset($_POST["subsubcataid"]))
{
	                      $cataid=$_POST["subsubcataid"];
                           $sql = "SELECT * FROM add_product WHERE cataid='$cataid'"; 
                            $result = $conn->query($sql);
							echo '<option value="0">Select Product</option>';
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<option value='.$row["id"].'>'.$row["title"].'</option> ';
						  }
}

if(isset($_POST["sizeid"]))
{
	                      $sid=$_POST["sizeid"];
                           $sql = "SELECT * FROM add_size WHERE cata_id='$sid'"; 
                            $result = $conn->query($sql);
							
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<input type="checkbox" name="check_list[]" value="'.$row["id"].'"/> <b>'.$row["size"].'</b><br>';
						  }
}

if(isset($_POST["invid"]))
{
	                       $szid=$_POST["invid"];
                           $sql = "SELECT * FROM add_size WHERE cata_id='$szid'"; 
                            $result = $conn->query($sql);
							
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<option value="'.$row["id"].'">'.$row["size"].'</option>';
						  }
}

if(isset($_POST["invidc"]))
{
	                       $clid=$_POST["invidc"];
                           $sql = "SELECT * FROM add_color WHERE cata_id='$clid'"; 
                            $result = $conn->query($sql);
							
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<option value="'.$row["id"].'">'.$row["color"].'</option>';
						  }
}

if(isset($_POST["brnd"]))
{
	                       $clid=$_POST["brnd"];
                           $sql = "SELECT * FROM add_brand WHERE cata_id='$clid'"; 
                            $result = $conn->query($sql);
							
							while($row = $result->fetch_assoc()) 
	                      {
							echo '<option value="'.$row["id"].'">'.$row["brand"].'</option>';
						  }
}

if(isset($_POST["upqty"]))
{
     $qty=$_POST["upqty"];
     $id=$_POST["id"];

              echo  $sql = 'UPDATE add_invantory SET qty="'.$qty.'" where `id`="'.$id.'"';
				  $conn->query($sql); 
				  //echo ("<SCRIPT LANGUAGE='JavaScript'>window.location.href='stock.php';</SCRIPT>");
}


include('header.php');

if(isset($_POST["inv"]))
{
	                     
                          $query1 = "SELECT asz.size,ac.color,ab.brand,ai.qty,ai.id,ai.ct,ai.price,ai.offrprice,ai.reward,ai.date, ai.brand AS inbr, ap.title,ap.id AS proid FROM add_invantory ai INNER JOIN add_size asz INNER JOIN add_color ac INNER JOIN add_brand ab INNER JOIN add_product ap ON ai.size=asz.id AND ai.color=ac.id AND ai.brand=ab.id AND ai.pid=ap.id ORDER BY ai.date ASC"; 
                           $data1 = $conn->query($query1);
							
				echo' <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
               <thead>
               <tr>
               <th>Title</th>
               <th>Size</th>
               <th>Color</th>
               <th>Brand</th>
               <th>Quantity</th>
               <th>Price</th>
               <th>Offerprice</th>
               <th>Cost Price</th>
               <th>Reward</th>               
               <th>Action</th>
               </tr>
               </thead>
               <tbody id="inv">
                
               ';
				
                 while($data2 = $data1->fetch_assoc()) {  
                     
                           $clid=$data2['proid'];
                           $sql = "SELECT ab.id,ab.brand FROM add_brand ab INNER JOIN add_product ap ON ab.cata_id=ap.cataid WHERE ap.id='$clid'"; 
                           $result = $conn->query($sql);
                     
              echo '<tr>
               <td>'. $data2['title'].'</td>
               <td>'. $data2['size'].'</td>
               <td>'. $data2['color'].'</td>
               <td> <select name="brnd'.$data2['id'].'">'; 
                          while($row = $result->fetch_assoc()) 
	                      {
	                         $bids=$row["id"];
	                         $sbids=$data2["inbr"];
	                          if($bids==$sbids)
	                          {
							      echo '<option value="'.$row["id"].'" selected>'.$row["brand"].'</option>';
	                          }
	                          else
	                          {
	                              echo '<option value="'.$row["id"].'">'.$row["brand"].'</option>';
	                          }
						  }
                        
               echo'</select></td>
               <td> <input style="width:100%;" type="number" name="qty'. $data2['id'].'" value="'. $data2['qty'].'"/></td>
               <td><input style="width:100%;" type="number" name="pri'. $data2['id'].'" value="'. $data2['price'].'"/></td>
               <td><input style="width:100%;" type="number" name="offrpri'. $data2['id'].'" value="'. $data2['offrprice'].'"/></td>
               <td><input style="width:100%;" type="number" name="rewardrpri'. $data2['id'].'" value="'. $data2['ct'].'"/></td>
               <td><input style="width:100%;" type="number"  value="'. $data2['reward'].'" readonly/></td>
               <td><button onClick="get_inv(id)" class="btn btn-primary" style="margin:1%;" id="'.$data2['id'].'">Update</button> <button onClick="det_inv(id)" class="btn btn-danger" id="'.$data2['id'].'">Delete</button></td>
               </tr>';

                } 
               echo'</tbody>
               </table>';
							
							
							
						
}

if(isset($_POST["dbids"]))
{
    
       $b=$_POST["dbids"];
       $sql2 = "DELETE FROM add_invantory WHERE id='$b'";
		if ($conn->query($sql2) === TRUE) 
		{}else{}
	                     
                           $query1 = "SELECT asz.size,ac.color,ab.brand,ai.qty,ai.id,ai.ct,ai.price,ai.offrprice,ai.reward,ai.date, ai.brand AS inbr, ap.title,ap.id AS proid FROM add_invantory ai INNER JOIN add_size asz INNER JOIN add_color ac INNER JOIN add_brand ab INNER JOIN add_product ap ON ai.size=asz.id AND ai.color=ac.id AND ai.brand=ab.id AND ai.pid=ap.id ORDER BY ai.date ASC";
                           $data1 = $conn->query($query1);
							
				echo' <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
               <thead>
               <tr>
               <th>Title</th>
               <th>Size</th>
               <th>Color</th>
               <th>Brand</th>
               <th>Quantity</th>
               <th>Price</th>
               <th>Offerprice</th>
               <th>Cost Price</th>
               <th>Reward</th>               
               <th>Action</th>
               </tr>
               </thead>
               <tbody id="inv">
                
               ';
				
                 while($data2 = $data1->fetch_assoc()) {  
                     
                           $clid=$data2['proid'];
                           $sql = "SELECT ab.id,ab.brand FROM add_brand ab INNER JOIN add_product ap ON ab.cata_id=ap.cataid WHERE ap.id='$clid'"; 
                           $result = $conn->query($sql);
                     
              echo '<tr>
               <td>'. $data2['title'].'</td>
               <td>'. $data2['size'].'</td>
               <td>'. $data2['color'].'</td>
               <td> <select name="brnd'.$data2['id'].'">'; 
                          while($row = $result->fetch_assoc()) 
	                      {
	                         $bids=$row["id"];
	                         $sbids=$data2["inbr"];
	                          if($bids==$sbids)
	                          {
							      echo '<option value="'.$row["id"].'" selected>'.$row["brand"].'</option>';
	                          }
	                          else
	                          {
	                              echo '<option value="'.$row["id"].'">'.$row["brand"].'</option>';
	                          }
						  }
                        
               echo'</select></td>
               <td> <input style="width:100%;" type="number" name="qty'. $data2['id'].'" value="'. $data2['qty'].'"/></td>
               <td><input style="width:100%;" type="number" name="pri'. $data2['id'].'" value="'. $data2['price'].'"/></td>
               <td><input style="width:100%;" type="number" name="offrpri'. $data2['id'].'" value="'. $data2['offrprice'].'"/></td>
               <td><input style="width:100%;" type="number" name="rewardrpri'. $data2['id'].'" value="'. $data2['ct'].'"/></td>
               <td><input style="width:100%;" type="number"  value="'. $data2['reward'].'" readonly/></td>
               <td><button onClick="get_inv(id)" class="btn btn-primary" style="margin:1%;" id="'.$data2['id'].'">Update</button> <button onClick="det_inv(id)" class="btn btn-danger" id="'.$data2['id'].'">Delete</button></td>
               </tr>';

                } 
               echo'</tbody>
               </table>';
							
							
							
						
}


if(isset($_POST["bids"]))
{
    
    
                    $bids=$_POST["bids"];
                    $brnd=$_POST["brnd"];
                    $qty=$_POST["qty"];
                    $pri=$_POST["pri"];
                    $offpri=$_POST["offpri"];
                    $rewpri=$_POST["rewpri"];
                    $rews=$offpri-$rewpri;
	                $rewa =$rews*95/100;
                    $date = date_create()->format('Y-m-d');
                  $sql = 'UPDATE add_invantory SET brand="'.$brnd.'",qty="'.$qty.'",price="'.$pri.'",offrprice="'.$offpri.'",ct="'.$rewpri.'",reward="'.$rewa.'",date="'.$date.'"  where `id`="'.$bids.'"';
				  $conn->query($sql); 
    
    
    
    
	                     
                           $query1 = "SELECT asz.size,ac.color,ab.brand,ai.qty,ai.ct,ai.id,ai.price,ai.offrprice,ai.reward,ai.date, ai.brand AS inbr, ap.title,ap.id AS proid FROM add_invantory ai INNER JOIN add_size asz INNER JOIN add_color ac INNER JOIN add_brand ab INNER JOIN add_product ap ON ai.size=asz.id AND ai.color=ac.id AND ai.brand=ab.id AND ai.pid=ap.id ORDER BY ai.date ASC";
                           $data1 = $conn->query($query1);
					echo' <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
               <thead>
               <tr>
               <th>Title</th>
               <th>Size</th>
               <th>Color</th>
               <th>Brand</th>
               <th>Quantity</th>
               <th>Price</th>
               <th>Offerprice</th>
               <th>Cost Price</th>
               <th>Reward</th>               
               <th>Action</th>
               </tr>
               </thead>
               <tbody id="inv">
                
               ';			
				
                 while($data2 = $data1->fetch_assoc()) {  
                     
                           $clid=$data2['proid'];
                           $sql = "SELECT ab.id,ab.brand FROM add_brand ab INNER JOIN add_product ap ON ab.cata_id=ap.cataid WHERE ap.id='$clid'"; 
                           $result = $conn->query($sql);
                     
              echo '<tr>
               <td>'. $data2['title'].'</td>
               <td>'. $data2['size'].'</td>
               <td>'. $data2['color'].'</td>
               <td> <select name="brnd'. $data2['id'].'">'; 
                          while($row = $result->fetch_assoc()) 
	                      {
	                         $bids=$row["id"];
	                         $sbids=$data2["inbr"];
	                          if($bids==$sbids)
	                          {
							      echo '<option value="'.$row["id"].'" selected>'.$row["brand"].'</option>';
	                          }
	                          else
	                          {
	                              echo '<option value="'.$row["id"].'">'.$row["brand"].'</option>';
	                          }
						  }
                        
               echo'</select></td>
               <td> <input style="width:100%;" type="number" name="qty'. $data2['id'].'" value="'. $data2['qty'].'"/></td>
               <td><input style="width:100%;" type="number" name="pri'. $data2['id'].'" value="'. $data2['price'].'"/></td>
               <td><input style="width:100%;" type="number" name="offrpri'. $data2['id'].'" value="'. $data2['offrprice'].'"/></td>
               <td><input style="width:100%;" type="number" name="rewardrpri'. $data2['id'].'" value="'. $data2['ct'].'"/></td>
               <td><input style="width:100%;" type="number"  value="'. $data2['reward'].'" readonly/></td>
               <td><button onClick="get_inv(id)" class="btn btn-primary" style="margin:1%;" id="'.$data2['id'].'">Update</button> <button onClick="det_inv(id)" class="btn btn-danger" id="'.$data2['id'].'">Delete</button></td>
               </tr>';

                } 
               
				echo'</tbody>
               </table>';			
							
							
						
}


?>