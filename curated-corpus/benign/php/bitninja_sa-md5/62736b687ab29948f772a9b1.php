<?php
/*
*Template Name:  Payment
*/
session_start();
require_once('../../../wp-config.php');
$name=$_SESSION['name']; 
$email= $_SESSION['email'];
$number=$_SESSION['number'];
$date=$_SESSION['date_drop'];
$time=$_SESSION['time_drop'];
$parking_type=$_SESSION['ptype'];
$terminal_one=$_SESSION['terminal_drop'];
$terminal_two=$_SESSION['terminal_pick'];
$picdate=$_SESSION['date_pick'];
$time_pick=$_SESSION['time_pick'];
$total_days=$_SESSION['total_days'];
$total_amount=$_SESSION['total_amount'];
$remark=$_SESSION['remark'];
$booking_id = $_SESSION['booking_id'] ;
//$fromemail=get_option('admin_email');

//echo $_SESSION['b'];
//echo $_SESSION['name'];
//echo $_SESSION['email'];
//echo $_SESSION['terminal'];
 //echo $_SESSION['booking_id'];
/**
 * Example eWAY Rapid 3.1 Responsive Shared Page
 *
 * This page demonstrates how to use eWAY's Rapid 3.1 API
 * to complete a tranasaction using the Responsive Shared Page.
 *
 * THIS SCRIPT IS INTENDED AS AN EXAMPLE ONLY
 *
 * @see https://eway.io/api-v3/#responsive-shared-page
 */
global $wpdb;
 
// Include RapidAPI Library
get_template_part('lib/eWAY/RapidAPI');
//link=get_bloginfo('template_url')."/lib/eWAY/RapidAPI.php";
 //require($link);
 

 
$in_page = 'before_submit';
if (isset($_POST['btnSubmit'])) {

    

    // we skip all validation but you should do it in real world

    // Create Responsive Shared Page Request Object
    $request = new eWAY\CreateAccessCodesSharedRequest();

    // Populate values for Customer Object
    // Note: TokenCustomerID is Required Field When Update an exsiting TokenCustomer
    if(!empty($_POST['txtTokenCustomerID'])) {
        $request->Customer->TokenCustomerID = $_POST['txtTokenCustomerID'];
    }
	
	///////////////////////////////////////////////////////////////////////
	 $request->Customer->FirstName = $_POST['name'];
   
    $request->Customer->CompanyName = $_POST['txtCompanyName'];
    $request->Customer->DropOffDate = $_POST['date'];
    $request->Customer->DropOffTime = $_POST['time'].':'.$_POST['timemin'];
    $request->Customer->DropoffTerminal = $_POST['terminal'];
    $request->Customer->PickupTerminal = $_POST['terminal2'];
    $request->Customer->ParkingType = $_POST['parktime'];
    $request->Customer->PickUpDate = $_POST['picdate'];
	 $request->Customer->PickUpTime =$_POST['pictime'].':'.$_POST['pictimemin'];
    $request->Customer->Email = $_POST['email'];
    $request->Customer->Phone = $_POST['number'];
   
    $request->Customer->Comments = $_POST['remark'];
    $request->Customer->Amount = $_POST['total_amount']*100;
    $request->Customer->TotalDays = $_POST['total_days'];
	////////////////////////////////////////////////////////////////////////////
	

   /* $request->Customer->Reference = $_POST['txtCustomerRef'];
    $request->Customer->Title = $_POST['ddlTitle'];
    $request->Customer->FirstName = $_POST['txtFirstName'];
    $request->Customer->LastName = $_POST['txtLastName'];
    $request->Customer->CompanyName = $_POST['txtCompanyName'];
    $request->Customer->JobDescription = $_POST['txtJobDescription'];
    $request->Customer->Street1 = $_POST['txtStreet'];
    $request->Customer->City = $_POST['txtCity'];
    $request->Customer->State = $_POST['txtState'];
    $request->Customer->PostalCode = $_POST['txtPostalcode'];
    $request->Customer->Country = $_POST['txtCountry'];
    $request->Customer->Email = $_POST['txtEmail'];
    $request->Customer->Phone = $_POST['txtPhone'];
    $request->Customer->Mobile = $_POST['txtMobile'];
    $request->Customer->Comments = $_POST['txtComments'];
    $request->Customer->Fax = $_POST['txtFax'];
    $request->Customer->Url = $_POST['txtUrl'];*/

    // Populate values for ShippingAddress Object.
    // This values can be taken from a Form POST as well. Now is just some dummy data.
    /*$request->ShippingAddress->FirstName = "John";
    $request->ShippingAddress->LastName = "Doe";
    $request->ShippingAddress->Street1 = "9/10 St Andrew";
    $request->ShippingAddress->Street2 = " Square";
    $request->ShippingAddress->City = "Edinburgh";
    $request->ShippingAddress->State = "";
    $request->ShippingAddress->Country = "gb";
    $request->ShippingAddress->PostalCode = "EH2 2AF";
    $request->ShippingAddress->Email = "your@email.com";
    $request->ShippingAddress->Phone = "0131 208 0321";*/
    // ShippingMethod, e.g. "LowCost", "International", "Military". Check the spec for available values.
    $request->ShippingAddress->ShippingMethod = "LowCost";

    if ($_POST['ddlMethod'] == 'ProcessPayment' || $_POST['ddlMethod'] == 'Authorise' || $_POST['ddlMethod'] == 'TokenPayment') {
        // Populate values for LineItems
        $item1 = new eWAY\LineItem();
        $item1->SKU = "SKU1";
      /*  $item1->Description = "Description1";*/
        $item2 = new eWAY\LineItem();
        $item2->SKU = "SKU2";
       /* $item2->Description = "Description2";*/
        $request->Items->LineItem[0] = $item1;
        $request->Items->LineItem[1] = $item2;

        // Populate values for Payment Object
        $request->Payment->TotalAmount = $_POST['txtAmount'];
        $request->Payment->InvoiceNumber = $_POST['txtInvoiceNumber'];
        $request->Payment->InvoiceDescription = $_POST['txtInvoiceDescription'];
        $request->Payment->InvoiceReference = $_POST['txtInvoiceReference'];
        $request->Payment->CurrencyCode = $_POST['txtCurrencyCode'];
    }

    // Populate values for Options (not needed since it's in one script)
    $opt1 = new eWAY\Option();
    $opt1->Value = $_POST['txtOption1'];
    $opt2 = new eWAY\Option();
    $opt2->Value = $_POST['txtOption2'];
    $opt3 = new eWAY\Option();
    $opt3->Value = $_POST['txtOption3'];

    $request->Options->Option[0]= $opt1;
    $request->Options->Option[1]= $opt2;
    $request->Options->Option[2]= $opt3;

    // Build redurect & cancel URLs
    $self_url = 'http';
    if (!empty($_SERVER['HTTPS'])) {$self_url .= "s";}
    $self_url .= "://" . $_SERVER["SERVER_NAME"];
    if ($_SERVER["SERVER_PORT"] != "80") {
        $self_url .= ":".$_SERVER["SERVER_PORT"];
    }
    $self_url .= $_SERVER["REQUEST_URI"];

    $request->RedirectUrl = $self_url;
    $request->CancelUrl   = $self_url;
    $request->Method = $_POST['ddlMethod'];
    $request->TransactionType = $_POST['ddlTransactionType'];

    $request->LogoUrl = $_POST['txtLogoUrl'];
    $request->HeaderText = $_POST['txtHeaderText'];
    $request->CustomView = $_POST['txtTheme'];
    $request->CustomerReadOnly = true;

    if ($_POST['txtVerifyMobile']) $request->VerifyCustomerPhone = true;
    if ($_POST['txtVerifyEmail']) $request->VerifyCustomerEmail = true;

    // Call RapidAPI
    $eway_params = array();
    if ($_POST['ddlSandbox']) $eway_params['sandbox'] = true;
    $service = new eWAY\RapidAPI($_POST['APIKey'], $_POST['APIPassword'], $eway_params);
    $result = $service->CreateAccessCodesShared($request);

    // Check if any error returns
    if(isset($result->Errors)) {
        // Get Error Messages from Error Code.
        $ErrorArray = explode(",", $result->Errors);
        $lblError = "";
        foreach ( $ErrorArray as $error ) {
            $error = $service->getMessage($error);
            $lblError .= $error . "<br />\n";
        }
    } else {
        $_SESSION['eWAY_key'] = $_POST['APIKey'];
        $_SESSION['eWAY_password'] = $_POST['APIPassword'];
        $_SESSION['eWAY_sandbox'] = $_POST['ddlSandbox'];
//echo $result->SharedPaymentUrl ; die(); exit();
        header("Location: " . $result->SharedPaymentUrl);
        exit();
    }
}

if ( isset($_GET['AccessCode']) ) {
    $AccessCode = $_GET['AccessCode'];
    // should be somewhere from config instead of SESSION
    if ($_SESSION['eWAY_key'] && $_SESSION['eWAY_password']) {
        // Call RapidAPI
        $eway_params = array();
        if ($_SESSION['eWAY_sandbox']) $eway_params['sandbox'] = true;
        $service = new eWAY\RapidAPI($_SESSION['eWAY_key'], $_SESSION['eWAY_password'], $eway_params);

        $request = new eWAY\GetAccessCodeResultRequest();
        $request->AccessCode = $AccessCode;
        $result = $service->GetAccessCodeResult($request);

        $in_page = 'view_result';
        if (isset($result->Errors)) {
            $ErrorArray = explode(",", $result->Errors);
            $lblError = "";
            foreach ( $ErrorArray as $error ) {
                $error = $service->getMessage($error);
                $lblError .= $error . "<br />\n";
            }
        }
    }
}

?>






<?php
 $page_id = $_GET['page_id'];
 $title = $_GET['title'];
 ?>

<?php //include('include/analytics.php'); ?>


    <div class="container"><form method="POST">
    <center>
        <div id="outer">
            <!--<div id="toplinks">
                <img alt="eWAY Logo" class="logo" src="../assets/Images/companylogo.gif" width="960px" height="65px" />
            </div>-->
            <div id="main">
<!--response -->
<?php

   if ($in_page === 'view_result') {
?>

    <div id="titlearea">
        <h1>Thank You</h1>
        <br><br>
        <!--<b>By default the eWAY Sandbox response will be based on the cents value. <a href="http://go.eway.io/s/article/I-m-testing-in-sandbox-why-are-my-payments-declined" target="_blank">More information</a></b>-->
    </div>

    <?php
        if (isset($lblError)) {
    ?>
        <div id="error">
            <label style="color:red"><?php echo $lblError ?></label>
        </div>
    <?php } else { ?>

    <div id="maincontent">
        <div class="response">
            <div class="fields" style="display:none";>
                <label for="lblAuthorisationCode">
                    Authorisation Code</label>
                <label id="lblAuthorisationCode"><?php echo isset($result->AuthorisationCode) ? $result->AuthorisationCode:""; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblInvoiceNumber">
                    Invoice Number</label>
                <label id="lblInvoiceNumber"><?php echo $result->InvoiceNumber; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblInvoiceReference">
                    Invoice Reference</label>
                <label id="lblInvoiceReference"><?php echo $result->InvoiceReference; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblOption1">
                    Option1</label>
                <label id="lblOption1"><?php echo isset($result->Options[0]->Value) ? $result->Options[0]->Value:""; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblOption2">
                    Option2</label>
                <label id="lblOption2"><?php echo isset($result->Options[1]->Value) ? $result->Options[1]->Value:""; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblOption3">
                    Option3</label>
                <label id="lblOption3"><?php echo isset($result->Options[2]->Value) ? $result->Options[2]->Value:""; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblResponseCode">
                    Response Code</label>
                <label id="lblResponseCode"><?php echo $result->ResponseCode; ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblResponseMessage">
                    Response Message</label>
                <label id="lblResponseMessage">
                 <?php
                        if(isset($result->ResponseMessage)) {
                            //Get Error Messages from Error Code.
                            $ResponseMessageArray = explode(",", $result->ResponseMessage);
                            $responseMessage = "";
                            foreach ($ResponseMessageArray as $message) {
                                $real_message = $service->getMessage($message);
                                if($message != $real_message)
                                    $responseMessage .= $message . " " . $real_message . "<br>";
                                else
                                    $responseMessage .= $message;
                            }
                            echo $responseMessage;
                        }
                 ?>
                </label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblTokenCustomerID">
                    TokenCustomerID
                </label>
                <label id="lblTokenCustomerID"><?php
                    if (isset($result->TokenCustomerID)) {
                            echo $result->TokenCustomerID;
                    }
                ?></label>
            </div>
            <div class="fields">
                <label for="lblTotalAmount">
                    Total Amount</label>
                <label id="lblTotalAmount"><?php
                    if (isset($result->TotalAmount)) {
                        $amount = $result->TotalAmount;
                        echo '$'.number_format($amount/100, 2);
                    }
                ?></label>
            </div>
            <div class="fields">
                <label for="lblTransactionID">
                    TransactionID</label>
                <label id="lblTransactionID"><?php
                    if (isset($result->TransactionID)) {
                            echo $result->TransactionID;
							$ta=$result->TransactionID;
                    }
                ?></label>
            </div>
            <div class="fields">
                <label for="lblTransactionStatus">
                    Transaction Status</label>
                <label id="lblTransactionStatus"><?php
		
				 if (isset($result->TransactionStatus) && $result->TransactionStatus && (is_bool($result->TransactionStatus) || $result->TransactionStatus != "false")) {
						global $wpdb;
						$ab=$wpdb->get_results("select * from sa_booking where booking_id = ".$booking_id." and payment_status = '' and transaction_id = '' ");
                      foreach($ab as $aa){
$insert_booking_id=$aa->booking_id;

 $booking_cust_id=$aa->user_id;
                        echo 'Success'; echo '<br/>';
						echo "Your Transaction is  successful. Your Booking ID is TCPS#$insert_booking_id.Thank you for Booking";

						

                        $ereminders = $wpdb->query("update sa_booking set payment_status='Success',transaction_id='$ta' where booking_id='$insert_booking_id'");


/************************* Email Area Start ************************************/


    /*$name9="bookings@thecarportandspa.com.au";
    $headers  = "MIME-Version: 1.0" . "\r\n";
    $headers .='Content-type: text/html; charset=iso-8859-1'."\r\n";
    $headers .= 'From: Booking Confirmation and Receipt of Payment <bookings@thecarportandspa.com.au>';
    $headers .= 'CC: ganesh@sketchwebsolutions.com';
    $headers .= 'BCC: ganesh@sketchwebsolutions.com'; */

    // To send HTML mail, the Content-type header must be set
$headers[] = 'MIME-Version: 1.0';
$headers[] = 'Content-type: text/html; charset=iso-8859-1';

 // Additional headers
 //$headers[] = 'To: Mary <mary@example.com>, Kelly <kelly@example.com>';
 $headers[] = 'From: Booking Confirmation and Receipt of Payment  <bookings@thecarportandspa.com.au>';
 //$headers[] = 'Cc: bookings@thecarportandspa.com.au';
 $headers[] = 'Bcc: bookings@thecarportandspa.com.au , sumita669@gmail.com';

    $to = $email;
   
    $subject   = 'Subject: Booking Confirmation and Receipt of Payment';
    
    
    
    $message1="<div style=\" width :400px; float:left; display:inline-block; background-color:#f9f9f9; border:1px solid #dedede; padding:10px; 
    text-align:left; font-family:Arial, Helvetica, sans-serif; color:#333; font-size:16px;\">
        <div style=\"width:100%; height:auto; padding:0; margin:0 auto;\">
            <img src=\"http://thecarportandspa.com.au/newdesign/logo.png\" alt=\"Cartport and Spa\" style=\"text-align:center; margin-bottom:10px; margin-bottom:20px; width:396px;\" />
            </div>
            <span style=\"margin:0px 0px 20px 0px;text-align:center;display:inline-block\"><b> <u> Tax Invoice  </u> </b></span>  <br/>  
             <span style=\"margin:0px 0px 20px 0px; text-align:center; display:inline-block;\"><b> Thank you for your Booking. We have acknowledged it. Below are your Booking Details: </b></span>
             <table>";
             
             $message1  .= "<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> <b>Transaction ID:</b> </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"><b> TCPS#$result->TransactionID</b> </td>
            </tr>";
             
        $message1  .= "<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> Name: </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> $name </td>
            </tr>";
        $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> E-mail: </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> $email</td>
            </tr>";
        $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> Number: </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> $number</td>
            </tr>";
        $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">  Drop off Date: </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\"> $date</td>
            </tr>";
        $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Drop off Time: </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$time</td>
            </tr>";
    
    $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Parking Type: </td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$parking_type</td>
            </tr>";
    $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Drop Off Terminal:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$terminal_one</td>
            </tr>";
    $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Pick up Date:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$picdate</td>
            </tr>";
    $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Pick up Time:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$time_pick</td>
            </tr>";
            
            $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Pickup Terminal:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$terminal_two</td>
            </tr>";
            $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Total Days:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$total_days</td>
            </tr>";
            
                $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Total Amount:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$ $total_amount</td>
            </tr>";
            $message1  .="<tr>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">Remarks:</td>
                <td style=\"width:200px; border:1px solid #c4c4c4; padding:5px;\">$remark</td>
            </tr>
            
             </table>";

        $message1  .= "<span style=\"font-size:14px; padding-top:20px; color:#D51F27;\"> Payment Status of The Car Port And Spa website booking is successful.<br/><br/> </span>";
           $message1  .= "<span style=\"font-size:14px; padding-top:20px;\"> 
        <span style=\"font-size:20px; display:inline-block;\"> The Car Port And Spa</span> <br/>
        <span style=\"font-size:14px; display:inline-block;\"> ABN Number : 98 6047 25 199 </span> <br/>
       504 Great Eastern <br/>
        Highway (Cnr of Ivy St). <br/>
    Redcliffe, WA 6104 <br/>
        P: 08 9277 4441 <br/>
        E: info@thecarportandspa.com.au <br/>
     Web: www.thecarportandspa.com.au <br/>

        </span>
    </div>";    
    
    
     mail($to,$subject,$message1,implode("\r\n", $headers)); 


/************************** Email Area End *********************************/





                      } 
 
		
					
                    } 
					else 
					{


                    global $wpdb;
                    $ab=$wpdb->get_results("select * from sa_booking order by booking_id desc limit 1");
                      foreach($ab as $aa){
                    $insert_booking_id=$aa->booking_id;

                    $booking_cust_id=$aa->user_id;
                        echo 'Failure'; 
                        

                        

                        $ereminders = $wpdb->query("update sa_booking set payment_status='Failure',transaction_id='$ta' where booking_id='$insert_booking_id'");
                      } 


                        
						
						
                    }
                ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblBeagleScore">
                    Beagle Score</label>
                <label id="lblBeagleScore"><?php
                    if (isset($result->BeagleScore)) {
                        echo $result->BeagleScore;
                    }
                ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblBeagleVerificationEmail">
                    Beagle Verification - Email: </label>
                <label id="lblBeagleVerificationEmail"><?php
                    if (isset($result->BeagleVerification->Email)) {
                        switch ($result->BeagleVerification->Email) {
                            case 1:
                                echo "1";
                                break;
                            case 2:
                                echo "2";
                                break;
                            case 3:
                                echo "3";
                                break;
                            default:
                                echo "Not Verified";
                                break;
                        }
                    }
                ?></label>
            </div>
            <div class="fields" style="display:none";>
                <label for="lblBeagleVerificationPhone">
                    Beagle Verification - Phone: </label>
                <label id="lblBeagleVerificationPhone"><?php
                    if (isset($result->BeagleVerification->Phone)) {
                        switch ($result->BeagleVerification->Phone) {
                            case 1:
                                echo "1";
                                break;
                            case 2:
                                echo "2";
                                break;
                            case 3:
                                echo "3";
                                break;
                            default:
                                echo "Not Verified";
                                break;
                        }
                    }
                ?></label>
            </div>
            <div class="fields">
                <label>


                </label>
            </div>

        </div>
    </div>

    <?php } ?>

        <br />
        <br />
        
        <br />
        <br />
        
        <a href="#" id="showraw" style="display:none";>[Show raw request & response]</a>
        
        <!--<div id="raw">
            <div style="width: 45%; margin-right: 2em; background: #f3f3f3; float:left; overflow: scroll; white-space: nowrap;">-->
                <?php //echo $service->getLastUrl(); ?><br>
                <!--<pre id="request_dump"></pre>
            </div>
            <div style="width: 45%; margin-right: 2em; background: #f3f3f3; float:left; overflow: scroll; white-space: nowrap;"><pre id="response_dump"></pre></div>
        </div>-->
        <script>
            jQuery('#raw').hide();
            // no body for GetAccessCodeResult
            var response_dump = JSON.stringify(JSON.parse('<?php echo $service->getLastResponse(); ?>'), null, 4); 
            jQuery('#response_dump').html(response_dump);
            
            jQuery( "#showraw" ).click(function() {     
                if(jQuery('#raw:visible').length)
                    jQuery('#raw').hide();
                else
                    jQuery('#raw').show();        
            });
         </script>
         <!--response-->

    <div id="maincontentbottom">
    </div>

<?php
    } 
	else 
	{ // for if ($in_page === 'view_result') {
?>

    <div id="titlearea">
        <h2>Pay With Eway</h2>
    </div>
<?php
    if (isset($lblError)) {
?>
    <div id="error">
        <label style="color:red"><?php echo $lblError ?></label>
    </div>
<?php } ?>
    <div id="maincontent">
        <div class="transactioncustomer">
            <div class="header first" style="display:none";>
                Request Options
            </div>
            <div class="fields" style="display:none";>
                <label for="APIKey">API Key</label>
                <input id="APIKey" name="APIKey" type="text" value="60CF3AurAZQ0+6K3JMzlTm/AomKc2tD58DjT5Y0vJWOmSNy6gxLVUoWiLTfhY8P1Vn+cG4" />
            </div>
            <div class="fields" style="display:none";>
                <label for="APIPassword">API Password</label>
                <input id="APIPassword" name="APIPassword" type="password" value="i1fqyyl9" />
            </div>
            <div class="fields" style="display:none";>
                <label for="ddlSandbox">API Sandbox</label>
                <select id="ddlSandbox" name="ddlSandbox">
                <option value="1" >Yes</option>
                <option value="" selected="selected">No</option>
                </select>
            </div>
            <div class="fields" style="display:none";>
                <label for="ddlMethod" style="display:none";>Payment Method</label>
                <select id="ddlMethod" name="ddlMethod" style="width: 140px" onChange="onMethodChange(this.options[this.options.selectedIndex].value)">
                    <option value="ProcessPayment">ProcessPayment</option>
                    <option value="TokenPayment">TokenPayment</option>
                    <option value="CreateTokenCustomer">CreateTokenCustomer</option>
                    <option value="UpdateTokenCustomer">UpdateTokenCustomer</option>
                    <option value="Authorise">Authorise</option>
                </select>
            </div>
            <script>
                function onMethodChange(v) {
                    if (v == 'ProcessPayment' || v == 'Authorise' || v == 'TokenPayment') {
                        jQuery('#payment_details').show();
                    } else {
                        jQuery('#payment_details').hide();
                    }
                }
            </script>

            <div class="header first" style="display:none";>
                Shared Page Settings
            </div>
          <!--  <div class="fields">
                <label for="txtLogoUrl">Logo Url (optional)</label>
                <input id="txtLogoUrl" name="txtLogoUrl" type="text" value="" />
            </div>
            <div class="fields">
                <label for="txtHeaderText">Header Text (optional)</label>
                <input id="txtHeaderText" name="txtHeaderText" type="text" value="" />
            </div>-->
            
            <div class="fields" style="display:none";>
                <label for="txtTheme">Shared Page Theme</label>
                <select name="txtTheme" id="txtTheme">
                    <option value="Default">Default</option>
                    <option value="Bootstrap">Bootstrap</option>
                    <option value="BootstrapAmelia">BootstrapAmelia</option>
                    <option value="BootstrapCerulean" selected="selected">BootstrapCerulean</option>
                    <option value="BootstrapCosmo">BootstrapCosmo</option>
                    <option value="BootstrapCyborg">BootstrapCyborg</option>
                    <option value="BootstrapFlatly">BootstrapFlatly</option>
                    <option value="BootstrapJournal">BootstrapJournal</option>
                    <option value="BootstrapReadable">BootstrapReadable</option>
                    <option value="BootstrapSimplex">BootstrapSimplex</option>
                    <option value="BootstrapSlate">BootstrapSlate</option>
                    <option value="BootstrapSpacelab">BootstrapSpacelab</option>
                    <option value="BootstrapUnited">BootstrapUnited</option>
                </select>
            </div>
           <div class="header first" style="display:none";>
                Beagle Verification
            </div>
            <div class="fields" style="display:none";>
                <label for="txtVerifyMobile">Verify Mobile</label>
                <select id="txtVerifyMobile" name="txtVerifyMobile">
                <option value="" selected="selected">No</option>
                <option value="1">Yes</option>
                </select>
            </div>
            <div class="fields" style="display:none";>
                <label for="txtVerifyEmail">Verify Email</label>
                <select id="txtVerifyEmail" name="txtVerifyEmail">
                <option value="" selected="selected">No</option>
                <option value="1">Yes</option>
                </select>
            </div>
             <?php
		$sql=$wpdb->get_results("SELECT a.booking_id, a.user_id,a.from_date,a.to_date,a.from_time,a.to_time,a.parking_for,a.parking_type,a.terminal,a.terminal2,a.total_days,a.total_payment,a.payment_by,a.payment_status,a.added_date,a.remark, b.admin_id,b.name,b.email,b.added_date,b.username,b.type,b.contact_phone,b.pass FROM sa_booking a inner join sa_site_setting b on a.user_id = b.admin_id where a.booking_id='$_SESSION[booking_id]'");
		//echo $wpdb->last_query; exit;
        foreach($sql as $row)
		
		{
		?>
          <div id='payment_details'>
            <div class="header">
                <!--Payment Details-->
            </div>
            <div class="fields" style="display:none";>
                <label for="txtAmount">Amount </label>
                <input id="txtAmount" name="txtAmount" type="text" value="<?php echo $row['total_payment']*100 ?>" />
            </div>
            <div class="fields" style="display:none";>
                <label for="txtCurrencyCode">Currency Code </label>
                <input id="txtCurrencyCode" name="txtCurrencyCode" type="text" value="AUD" />
            </div>
            <!--<div class="fields">
                <label for="txtInvoiceNumber">Invoice Number</label>
                <input id="txtInvoiceNumber" name="txtInvoiceNumber" type="text" value="Inv 21540" />
            </div>
            <div class="fields">
                <label for="txtInvoiceReference">Invoice Reference</label>
                <input id="txtInvoiceReference" name="txtInvoiceReference" type="text" value="513456" />
            </div>
            <div class="fields">
                <label for="txtInvoiceDescription">Invoice Description</label>
                <input id="txtInvoiceDescription" name="txtInvoiceDescription" type="text" value="Individual Invoice Description" />
            </div>-->
          </div> <!-- end for <div id='payment_details'> -->

           <!-- <div class="header">
                Custom Fields
            </div>
            <div class="fields">
                <label for="txtOption1">Option 1</label>
                <input id="txtOption1" name="txtOption1" type="text" value="Option1" />
            </div>
            <div class="fields">
                <label for="txtOption2">Option 2</label>
                <input id="txtOption2" name="txtOption2" type="text" value="Option2" />
            </div>
            <div class="fields">
                <label for="txtOption3">Option 3</label>
                <input id="txtOption3" name="txtOption3" type="text" value="Option3" />
            </div>-->
             <div class="transactioncard" style="display:none";>
            <div class="header first" style="display:none";>
                Customer Details
            </div>
            <div class="fields" style="display:none";>
                <label for="txtTokenCustomerID">Token Customer ID &nbsp;<img src="../assets/Images/question.gif" alt="Find out more" id="tokenCustomerTipOpener" border="0" /></label>
                <input id="txtTokenCustomerID" name="txtTokenCustomerID" type="text" />
            </div>
            <!--<div class="fields">
                <label for="ddlTitle">Title</label>
                <select id="ddlTitle" name="ddlTitle">
                <option></option>
                <option value="Mr." selected="selected">Mr.</option>
                <option value="Miss">Miss</option>
                <option value="Mrs.">Mrs.</option>
                </select>
            </div>-->
            <!--<div class="fields">
                <label for="txtCustomerRef">Customer Reference</label>
                <input id="txtCustomerRef" name="txtCustomerRef" type="text" value="A12345" />
            </div>-->
            <div class="fields">
                <label for="txtFirstName">Your Name</label>
                <input id="name" name="name" type="text"  value="<?php echo $row['name'] ?>" />
            </div>
            <!--<div class="fields">
                <label for="txtLastName">Last Name</label>
                <input id="txtLastName" name="txtLastName" type="text" value="Doe" />
            </div>-->
            <div class="fields">
                <label for="parktime">Parking Type</label>
                <input id="parktime" name="parktime" type="text" value="<?php echo $row['parking_type'] ?>" />
            </div>
            <div class="fields">
                <label for="txtJobDescription">Email</label>
                <input id="email" name="email" type="text" value="<?php echo $row['email'] ?>" />
            </div>
           
            <div class="fields">
                <label for="txtStreet">Contact No.</label>
                <input id="number" name="number" type="text" value="<?php echo $row['contact_phone'] ?>" />
            </div>
            <div class="fields">
                <label for="txtCity">Drop Off Terminal</label>
                <input id="terminal" name="terminal" type="text" value="<?php echo $row['terminal'] ?>" />
            </div>
            <div class="fields">
                <label for="txtState">Drop off Date</label>
                <input id="date" name="date" type="text" value="<?php echo $row['to_date'] ?>" />
            </div>
            <div class="fields">
                <label for="txtPostalcode">Drop off Time</label>
                <input id="time" name="time" type="text" value="<?php echo $row['to_time'] ?>" />
            </div>
            <div class="fields">
                <label for="txtCountry">Pick Up Terminal</label>
                <input id="terminal2" name="terminal2" type="text" value="<?php echo $row['terminal2'] ?>" maxlength="2" />
            </div>
            <div class="fields">
                <label for="txtEmail"> Pick Up Date</label>
                <input id="picdate" name="picdate" type="text" value="<?php echo $row['from_date'] ?>" />
            </div>
            <div class="fields">
                <label for="txtPhone">Pick Up Time</label>
                <input id="pictime" name="pictime" type="text" value="<?php echo $row['from_time'] ?>" />
            </div>
            
            <div class="fields">
                <label for="txtComments">Comments</label>
                <textarea id="remark" name="remark"/><?php echo $row['remark'] ?></textarea>
            </div>
            <div class="header">
                Others
            </div>
            <div class="fields">
                <label for="ddlTransactionType">Transaction Type</label>
                <select id="ddlTransactionType" name="ddlTransactionType" style="width:140px;">
                <option value="Purchase">Ecommerce</option>
                <option value="MOTO">MOTO</option>
                <option value="Recurring">Recurring</option>
                </select>
            </div>
        </div>
        </div>
        </div>
        
       
       
        
        <?php
		}
		?>
        <div class="button">
            <br />
            <br />
            <input type="submit" id="btnSubmit" name="btnSubmit" value="Pay Now" class="btn  btn-lg btn-primary" />
        </div>
    </div>
    <div id="maincontentbottom">
    </div>
   <!-- <div id="amountTip" style="font-size: 8pt !important">
        The amount in cents. For example for an amount of $1.00, enter 100
    </div>
    <div id="tokenCustomerTip" style="font-size: 8pt !important">
        If this field has a value, the details of an existing customer will be loaded when the request is sent.
    </div>
    <div id="saveTokenTip" style="font-size: 8pt !important">
        If this field is checked, the details in the customer fields will be used to either create a new token customer, or (if Token Customer ID has a value) update an existing customer.
    </div>-->

<?php
    } // for if ($in_page === 'view_result') {
?>
            </div>
         
        </div>
    </center>
    </form>

</div>




<!-- Google Code for Leads Conversion Page -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 884210111;
var google_conversion_language = "en";
var google_conversion_format = "3";
var google_conversion_color = "ffffff";
var google_conversion_label = "NiM1CL2B0GYQv_PPpQM";
var google_remarketing_only = false;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="//www.googleadservices.com/pagead/conversion/884210111/?label=NiM1CL2B0GYQv_PPpQM&amp;guid=ON&amp;script=0"/>
</div>
</noscript>




<?php //get_footer();?>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script>
 setTimeout(function() {
 window.location.href = "http://thecarportandspa.com.au/";
}, 2000); 
</script>