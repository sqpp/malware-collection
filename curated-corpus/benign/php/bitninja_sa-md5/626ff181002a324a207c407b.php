<?php include_once("auth/header.php");

ini_set('upload_max_filesize', '20M');
ini_set('post_max_size', '30M');
//ini_set('max_execution_time', 1800);
ini_set('max_execution_time', 1200);
ini_set('memory_limit', '128M');
ini_set('max_input_time', 1800); 

?>

<div class="tt-breadcrumb">
	<div class="container">
		<ul>
			<li><a href="index.php">Home</a></li>
			<li>Create An Account</li>
		</ul>
	</div>
</div>
<div id="tt-pageContent">
	<div class="container-indent">
		<div class="container">
			<h1 class="tt-title-subpages noborder">CREATE AN ACCOUNT</h1>
			<div class="tt-login-form">
				<div class="row justify-content-center">
					<div class="col-md-8 col-lg-6">
						<div class="tt-item">
							<h2 class="tt-title">PERSONAL INFORMATION</h2>
							<div class="form-default">

							<?php
							if ((isset($_POST["submitted_form"])) && ($_POST["submitted_form"] == "image_upload_form")) {
	
								if (($_FILES["image_upload_box"]["type"] == "image/jpeg" || $_FILES["image_upload_box"]["type"] == "image/pjpeg" || $_FILES["image_upload_box"]["type"] == "image/gif" || $_FILES["image_upload_box"]["type"] == "image/png"))
								{
									
										$max_upload_width = 300;  $img_file=str_replace("'","-",$_FILES['image_upload_box']['name']);
									
									if($_FILES["image_upload_box"]["type"] == "image/jpeg" || $_FILES["image_upload_box"]["type"] == "image/pjpeg"){	
										$image_source = imagecreatefromjpeg($_FILES["image_upload_box"]["tmp_name"]);
									}		
									if($_FILES["image_upload_box"]["type"] == "image/gif"){	
										$image_source = imagecreatefromgif($_FILES["image_upload_box"]["tmp_name"]);
									}	
									if($_FILES["image_upload_box"]["type"] == "image/bmp"){	
										$image_source = imagecreatefromwbmp($_FILES["image_upload_box"]["tmp_name"]);
									}			
									if($_FILES["image_upload_box"]["type"] == "image/png"){
										$image_source = imagecreatefrompng($_FILES["image_upload_box"]["tmp_name"]);
									}
							
									$remote_file = "upload/".time().$img_file;
									imagejpeg($image_source,$remote_file,100);
									chmod($remote_file,0644);
							
								// get width and height of original image
									list($image_width, $image_height) = getimagesize($remote_file);
							
											$new_width = $max_upload_width;
											$new_height = ($image_height/$image_width)*$max_upload_width;	
							
							if(isset($_POST["btnsub"]))
							{
								//$q_off="";
								//$promo="";
								$name=mysqli_real_escape_string($con,$_POST["fname"]);
								$lname=mysqli_real_escape_string($con,$_POST["lname"]);
								$phno=mysqli_real_escape_string($con,$_POST["phno"]);
								$email=mysqli_real_escape_string($con,$_POST["email"]);
								$pass=mysqli_real_escape_string($con,$_POST['pass']);
								$password=md5($pass);
								$promo=$_POST['promo'];
								$email_exp = '/^[A-Za-z0-9._-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/';
								
								$q=mysqli_query($con,"select * from `register` where `email`='$email' or `phone_no`='$phno'");
								if(mysqli_num_rows($q)>0)
								{
									$err="This Email or Phone No is Already There";
								}
								else
								{
									if(!preg_match($email_exp,$email)) {
										$err = 'The Email Address you entered does not appear to be valid.';
									  }		
									  else{
										$q_reg="insert into `register`(`firstname`,`lastname`,`phone_no`,`email`,`password`,`id_proof`) values ('$name','$lname','$phno','$email','$password','$remote_file')";
										if($promo==1)
										{
											$q_off=mysqli_query($con,"insert into `newsletter`(`mail`) values('$email')");
										}
									  }							

								$res=mysqli_query($con,$q_reg);
							    if($res)
							    {
								  echo "<script>self.location='login.php';</script>";
							    } 
								}
								

								$new_image = imagecreatetruecolor($new_width, $new_height);
								$image_source = imagecreatefromjpeg($remote_file);

								imagecopyresampled($new_image, $image_source, 0, 0, 0, 0, $new_width, $new_height, $image_width, $image_height);
								imagejpeg($new_image,$remote_file,100);

								imagedestroy($new_image);

								imagedestroy($image_source);

								}
								}
								else { echo "<script>alert('Please Insert Correct Image Format');</script>";}
						    }
							?>
								

								<form method="post" enctype="multipart/form-data">
								<?php if(isset($err) && $err!="") { ?>
									<div class="alert alert-danger text-drak"> <?php echo $err; ?> </div> 
								<?php } ?>
									<div class="form-group">
										<label for="loginInputName">FIRST NAME *</label>
										<div class="tt-required">* Required Fields</div>
										<input type="text" name="fname" class="form-control" required placeholder="Enter First Name">
									</div>
									<div class="form-group">
										<label for="loginLastName">LAST NAME *</label>
										<input type="text" name="lname" class="form-control" required placeholder="Enter Last Name">
									</div>
									<div class="form-group">
										<label for="loginLastName">PHONE NO *</label>
										<input type="number" name="phno" class="form-control" required placeholder="Enter Phone No">
									</div>
									<div class="form-group">
										<label for="loginInputEmail">E-MAIL *</label>
										<input type="email" name="email" class="form-control" required placeholder="Enter E-mail Id">
									</div>
									<div class="form-group">
										<label for="loginInputPassword">PASSWORD *</label>
										<input type="password" name="pass" class="form-control" required placeholder="Enter Password">
									</div>
									<div class="form-group">
										<label for="loginInputPassword">ID PROOF IMAGE *</label> (png, jpeg formats only) 
										<input type="file" name="image_upload_box" class="form-control" required>
									</div>
									<div class="form-group">
										<input type="checkbox" name="promo" value="1">
										<label for="loginLastName">If you want kushonroad offers check this box</label>
									</div>
									<div class="row">
										<div class="col-auto">
											<div class="form-group">
											<input name="submitted_form" type="hidden" id="submitted_form" value="image_upload_form" />
												<button class="btn btn-border" type="submit" name="btnsub">CREATE</button>
											</div>
										</div>
										<div class="col-auto align-self-center">
											<div class="form-group">
												<ul class="additional-links"> <li>or <a href="index.php">Return to Store</a></li> </ul>
											</div>
										</div>
									</div>

								</form>
                             
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<?php include_once("auth/footer.php"); ?>
