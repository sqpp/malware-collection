<?php include("header.php");?>


				<div class="page-content">
					<div class="page-header position-relative">
						<h1>
							Add Product Images Here
							<small>
								<i class="icon-double-angle-right"></i>
								 
							</small>
						</h1>
					</div><!--/.page-header-->

					<div class="row-fluid">
						<div class="span12">
							<!--PAGE CONTENT BEGINS-->
 
							<form class="form-horizontal" action="" method="post" enctype="multipart/form-data" >
                               <div class="control-group">
									<label class="control-label" for="form-field-2">Product Code</label>
									<div class="span4">
  
							<input  name="product_code"  type="text" id="id-input-file-3" />
 
									</div>
								</div>
							 
								 
								<div class="control-group">
									<label class="control-label" for="form-field-2">Images</label>

									<div class="span4">
  
									<input multiple="" name="files[]" multiple="" type="file" id="id-input-file-3" />
 
									</div>
								</div>
								<div class="form-actions">
									<button class="btn btn-info" name="submit" type="submit">
										<i class="icon-ok bigger-110"></i>
										Submit
									</button>
 				 
</form>
 &nbsp; &nbsp; &nbsp;
									 <button class="btn" type="submit" name="submit1" >
										<i class="icon-undo bigger-110"></i>
										Show All
									</button> 
								</div>

							<?php
							 include("config.php");
 				             if(isset($_POST['submit'])) 
 {
if(isset($_FILES['files'])){
		//This function reads the extension of the file. It is used to determine if the file  is an image by checking the extension.
 function getExtension($str) {
         $i = strrpos($str,".");
         if (!$i) { return ""; }
         $l = strlen($str) - $i;
         $ext = substr($str,$i+1,$l);
         return $ext;
 }
//$fn = $_POST['fn'];
    $errors= array();
	foreach($_FILES['files']['tmp_name'] as $key => $tmp_name ){
		$file_name = $key.$_FILES['files']['name'][$key];
		$file_size =$_FILES['files']['size'][$key];
		$file_tmp =$_FILES['files']['tmp_name'][$key];
		$file_type=$_FILES['files']['type'][$key];	
		if($file_size > 2222097152){
			$errors[]='File size must be less than 2 MB';
			
        }	
			//get the extension of the file in a lower case format
  		 $extension = getExtension($file_name);
 		$extension = strtolower($extension);
 	//if it is not a known extension, we will suppose it is an error and will not  upload the file,  
	//otherwise we will do more tests
 if (($extension != "jpg") && ($extension != "jpeg") && ($extension != "png") && ($extension != "gif")) 
 		{
		//print error message
 			
 		 $errors=1;
 		}
		
		else
		{
        $desired_dir="product";
        if(empty($errors)==true){
            if(is_dir($desired_dir)==false){
                mkdir("$desired_dir", 0700);		// Create directory if it does not exist
            }
            if(is_dir("$desired_dir/".$file_name)==false){
                move_uploaded_file($file_tmp,"Product/".$file_name);
            }else{									//rename the file if another one exist
                $new_dir="product/".$file_name.time();
                 rename($file_tmp,$new_dir) ;				
            }
            
        }
        $product_code=$_POST['product_code'];
        
		$query="INSERT into tbl_product_images (`id`,
`p_id`,
`img`) 
VALUES (Null,'".$product_code."','".$file_name."')";
if (!mysqli_query($con,$query)) 
{
  echo "Error Inserting Data";
  }			
		
		else{
                //print_r($errors);
        }
    }
	}
	if(!$errors){
		echo "<script language='javascript'>
{
  alert(' Added Successfully.');	
   
}
</script>";
	}
	else
	{
	echo "<script language='javascript'>
{
  alert(' Choose only image files.');	
   
}
</script>";
	}
}
 }
 

//show data 
 	if(isset($_POST['submit1'])) 
 {
 $id=$_GET['id'];
 $sqlfetch="SELECT * FROM `tbl_product_images` order by id DESC";
$resultfetch = mysqli_query($con,$sqlfetch);
echo"
 <table id='sample-table-1' class='table table-striped table-bordered table-hover'>
										<thead>
											<tr>
												  
												<th>Product Id</th>
												 
												 
												<th>Image</th>
												<th>Action</th>
											</tr>
										</thead><tbody>
";
while($rowfetch = mysqli_fetch_array($resultfetch)) 
{
 
echo"

<tr>

												<td>
													".$rowfetch['p_id']."
												</td>
												  <td>
													<img src='Product/".$rowfetch['img']."' style='width:100px;height:100px;'>
												</td>
												<td>
													<div class='hidden-phone visible-desktop btn-group'>
														 

														<!--<a href='edit_college_images.php?folder=".$rowfetch['folder']."'><button class='btn btn-mini btn-info'>
															<i class='icon-edit bigger-120'></i>
														</button>
														</a>-->

														<a href='delete_product_images.php?id=".$rowfetch['id']."&p_id=".$rowfetch['p_id']."'><button class='btn btn-mini btn-danger'>
															<i class='icon-trash bigger-120'></i>
														</button>
														</a>

														 
													</div>

													<div class='hidden-desktop visible-phone'>
														<div class='inline position-relative'>
															<button class='btn btn-minier btn-primary dropdown-toggle' data-toggle='dropdown'>
																<i class='icon-cog icon-only bigger-110'></i>
															</button>

															<ul class='dropdown-menu dropdown-icon-only dropdown-yellow pull-right dropdown-caret dropdown-close'>
																 
																<!--<li>
																	<a href='edit_college_images.php?folder=".$rowfetch['folder']."' class='tooltip-success' data-rel='tooltip' title='Edit'>
																		<span class='green'>
																			<i class='icon-edit bigger-120'></i>
																		</span>
																	</a>
																</li>-->

																<li>
																	<a href='delete_product_images.php?id=".$rowfetch['id']."&p_id=".$rowfetch['p_id']."' class='tooltip-error' data-rel='tooltip' title='Delete'>
																		<span class='red'>
																			<i class='icon-trash bigger-120'></i>
																		</span>
																	</a>
																</li>
															</ul>
														</div>
													</div>
												</td>
											</tr>

		   ";
		   
 }
 }
 mysqli_close($con);
 ?>
											</tbody>
											</table>
 					
											 
 
 

						 
						</div><!--/.span-->
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->

				<?php include("footer.php");?>