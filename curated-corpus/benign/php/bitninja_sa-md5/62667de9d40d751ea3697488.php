<?php
include 'connect.php';
$api = !empty($_POST['android_api']);
if ($api && $api == API ) {
$userid = $_POST['android_id'];
$name = $_POST['android_name'];
$email = $_POST['android_email'];
$pass = $_POST['android_password'];
$refer = $_POST['android_refer'];
$date_time = date("Y-m-d");
$imie = $_POST['android_imie'];
$message = array();
$countemail = mysqli_num_rows(mysqli_query($connect, "SELECT * FROM user_signup WHERE `user_email` = '$email' "));
$countimie = mysqli_num_rows(mysqli_query($connect, "SELECT * FROM user_signup WHERE `user_imie` = '$imie' "));
$countrefer = mysqli_num_rows(mysqli_query($connect, "SELECT * FROM user_signup WHERE user_id = '$refer' "));
$refer_point = mysqli_fetch_array(mysqli_query($connect, "SELECT * FROM user_signup WHERE user_id = '$refer' "));
$getAdminUservalue = mysqli_fetch_array(mysqli_query($connect,"SELECT * FROM `admin_interface` "));
if ($_SERVER['REQUEST_METHOD'] == "POST") {

if($countemail != 0){
  $message['error'] = false ;
  $message['message'] = "User email Already Registered !!";
}else if($countimie != 0){
  $message['error'] = false ;
  $message['message'] = "User Device Already Registered !!";
}else{
if($countrefer != 0){
//signup with refer
$add_data = mysqli_query($connect,"INSERT INTO `user_signup` (`id`, `user_name`, `user_email`, `user_password`, `user_amount`, `user_id`, `refer_count`, `user_status`, `user_date`, `user_imie`, `refer_id`) VALUES (NULL, '$name', '$email', '$pass', 0, '$userid', 0, 'ACTIVE','$date_time','$imie','$refer')");
if ($add_data) {
	
	$getrefer_count = $refer_point['refer_count']+1;
	$a = mysqli_query($connect,"UPDATE `user_signup` SET `refer_count` = '$getrefer_count' WHERE `user_signup`.`user_id` = '$refer' ;");
    $b = mysqli_query($connect,"INSERT INTO `user_task` (`id`, `app_install`, `scratch_install`, `spin_install`, `game_install`, `user_id`, `video_own_imp`, `math_own_imp`, `spin_own_imp`, `scratch_own_imp`, `watch_limit`, `duration_watch`, `spin_limit`, `duration_spin`, `math_limit`, `duration_math`, `scratch_limit`, `duration_scratch`,`lifetime_spin`, `lifetime_game`, `lifetime_scratch`, `lifetime_watch`) VALUES (NULL, '0', '0', '0', '0', '$userid', '0', '0', '0', '0', 'false', '0', 'false', '0', 'false', '0', 'false', '0', '0', '0', '0', '0')");
    if($a && $b){
      $message['error'] = true ;
	  $message['message'] = "Successfully Registered" ;  
    }
    
}else{
	$message['error'] = false ;
	$message['message'] = "Failed" ;
}
//signup with refer
}else{
	$message['error'] = false ;
	$message['message'] = "Refer code Doesn't match" ;
}

}

}
echo json_encode($message);
}else{
	echo "Fake Request";
}
?>