<?php
if (session_id() == '') {
    session_start();
}
if (!$_SESSION['is_logged']) {
    header("Location: ./index.php");
} 
$upload_directory = '../image/';
require_once 'lib_head.php';
$query=mysql_query("select country_id, category_name from tbl_country where isActive=1 and isDelete=0");
$query2=mysql_query("select * from tbl_user_type where isActive=1 and isDelete=0");
$query3=mysql_query("select * from tbl_category");  
if(isset($_POST['edittechnology']))
{
  $sub_cat_name=$_POST['sub_cat_name'];
	$sub_cat_name_hindi=$_POST['sub_cat_name_hindi'];
	$sub_cat_name_marathi=$_POST['sub_cat_name_marathi'];	
	$cat_id=$_POST['cat_id'];	 
	$id=$_GET["id"];
	mysql_query("SET character_set_results='utf8', character_set_client='uf8', character_set_connection='uf8', character_set_database='uf8', character_set_server='uf8'", $con);
	
		
	if(mysql_query("update tbl_sub_category set `cat_id` ='".$cat_id."', `sub_cat_name`='".$sub_cat_name."', `sub_cat_name_hindi`='".$sub_cat_name_hindi."',`sub_cat_name_marathi`='".$sub_cat_name_marathi."' where sub_cat_id='".$id."' limit 1")){		
		header("Location: http://farmerapp.in/krishi/newbackend/sub_category.php");
	}
 
}
if(isset($_POST['addtechnology']))
{
	//cat_id 	sub_cat_name 	sub_category_image 	sub_cat_name_hindi 	sub_cat_name_marathi
	move_uploaded_file ($_FILES['sub_category_image']['tmp_name'], $upload_directory . $_FILES['sub_category_image']['name']);
	$technology_image=$_FILES['sub_category_image']['name'];
	$sub_cat_name=$_POST['sub_cat_name'];
	$sub_cat_name_hindi=$_POST['sub_cat_name_hindi'];
	$sub_cat_name_marathi=$_POST['sub_cat_name_marathi'];	
	$cat_id=$_POST['cat_id'];	 
	$extra_text=date('Y-m-d H:i:s');
	$isActive=isset($_POST['is_Active'])? 1 : 0;
	
	mysql_query("SET character_set_results='utf8', character_set_client='uf8', character_set_connection='uf8', character_set_database='uf8', character_set_server='uf8'", $con);
	
	
	if(mysql_query("insert into tbl_sub_category (`cat_id`,`sub_cat_name`,`sub_category_image`,`sub_cat_name_hindi`,`sub_cat_name_marathi`) values('".$cat_id."','".$sub_cat_name."','".$technology_image."','".$sub_cat_name_hindi."','".$sub_cat_name_marathi."')")){	
	
		/*$query=mysql_query("select phonekey from tbl_user_phone_key 		
		where tbl_user_phone_key.isActive=1 and tbl_user_phone_key.isDelete=0");		
		if(mysql_num_rows($query) > 0){	
			$url = 'https://android.googleapis.com/gcm/send';
			while($res=mysql_fetch_array($query)){
				$phonekey[] = $res["phonekey"];
			}
			
			//'registration_ids'  => array($_POST['registrationIDs']),
			$fields = array(
							'registration_ids'  => $phonekey,
							'data'              => array( "title" =>  $technology_text, "message" => $short_description, "image" => $technology_image, "type" => 2),
							);
			//'Authorization: key=' . $_POST['apiKey'],
			$headers = array( 
								'Authorization: key=AIzaSyBbHgOZRnL8R8UF2TS05AKw0at3f2crbCY',
								'Content-Type: application/json'
							);
 
			// Open connection
			$ch = curl_init();
			 
			// Set the url, number of POST vars, POST data
			curl_setopt( $ch, CURLOPT_URL, $url );			 
			curl_setopt( $ch, CURLOPT_POST, true );
			curl_setopt( $ch, CURLOPT_HTTPHEADER, $headers);
			curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );			 
			curl_setopt( $ch, CURLOPT_POSTFIELDS, json_encode( $fields ) );
			 
			// Execute post
			$result = curl_exec($ch);			 
			// Close connection
			curl_close($ch);
		}*/
	
	
}}
?>
<!-- Content -->
<div id="content">

    <h3 class="heading-mosaic">List of technology</h3>

    <div class="row-fluid innerLR">
		<div class=" span2" data-toggle="collapse-widget" id="divAddbuttontechnology">
			<div class="row-fluid">
                <button type="button" class="btn btn-success offset1 pull-right" id="addnewtechnology" name="">Add technology</button>
            </div>
			<br/>
		</div>
		<?php
		    if(isset($_GET["action"]) && $_GET["action"]=="edit"){
		        $sub_cat = $db->getSubCategory($_GET["id"]);
						$i=1;
                        foreach ($sub_cat as $key => $value) {
		 ?>
		 <!-- Widget -->
        <div class=" span6 widget" data-toggle="collapse-widget" id="divEdittechnology">

            <!-- Widget heading -->
            <div class="widget-head">
                <h4 class="heading">Edit Category</h4>
            </div>
            <!-- // Widget heading END -->

            <div class="widget-body">
                <form action="" id="catform" method="POST" enctype="multipart/form-data">
                    <div class="row-fluid">
						<h6 class="heading">Sub Category Name</h6>
						<!--<textarea class="ckeditor" cols="80" id="technology_text" name="technology_text" rows="10" placeholder="technology Name"></textarea> sub_cat_name 	sub_category_image 	sub_cat_name_hindi 	sub_cat_name_marathi-->
                        <input type="text" class="span12" name="sub_cat_name" id="sub_cat_name" value="<?php echo $value['sub_cat_name']; ?>" placeholder="Sub Category Name"/>
                    </div>					
                    <div class="row-fluid padding">
						<h6 class="heading">Sub Category Hindi Name</h6>
						<!--<textarea class="ckeditor" cols="80" id="short_description" name="short_description" rows="10" placeholder="Short Description"></textarea>-->
                        <input type="text" class="span12" name="sub_cat_name_hindi" id="sub_cat_name_hindi" value="<?php echo $value['sub_cat_name_hindi']; ?>" placeholder="Sub Category Name"/>
                    </div>
					<div class="row-fluid padding">
						<h6 class="heading">Sub Category Marathi Name</h6>
						<!--<textarea class="ckeditor" cols="80" id="long_description" name="long_description" rows="10" placeholder="Long Description"></textarea>-->
                       <input type="text" class="span12" name="sub_cat_name_marathi" id="sub_cat_name_marathi" value="<?php echo $value['sub_cat_name_marathi']; ?>" placeholder="Sub Category Marathi Name"/>
                    </div>
					
					
					<div class="row-fluid">
						<h6 class="heading">Category</h6>
                        <select class="span6" name="cat_id" id="cat_id">
							<option value="">All Category</option>
							<?php
								while($res=mysql_fetch_array($query3))
								{ 
									echo '<option '.(($value['cat_id']==$res['cat_id'])? 'selected="selected"': '').'value="'.$res['cat_id'].'">'.$res['category_name'].'</option>';
								}
							?>
						</select>
                    </div>
					
                    <div class="row-fluid">
                        <button type="submit" class="btn btn-success offset1 pull-right" id="addtechnology" name="edittechnology">Save</button>
                        <button type="reset" class="btn btn-warning pull-right" name="">Reset</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- // Widget END -->
		 <?php
		 $i++;
		  if($i > 1)
		  	break;
           }
		    }
		?>
        <!-- Widget -->
        <div class=" span6 widget" data-toggle="collapse-widget" id="divAddtechnology" style="display:none">

            <!-- Widget heading -->
            <div class="widget-head">
                <h4 class="heading">Add Category</h4>
            </div>
            <!-- // Widget heading END -->

            <div class="widget-body">
                <form action="" id="catform" method="POST" enctype="multipart/form-data">
                    <div class="row-fluid">
						<h6 class="heading">Sub Category Name</h6>
						<!--<textarea class="ckeditor" cols="80" id="technology_text" name="technology_text" rows="10" placeholder="technology Name"></textarea> sub_cat_name 	sub_category_image 	sub_cat_name_hindi 	sub_cat_name_marathi-->
                        <input type="text" class="span12" name="sub_cat_name" id="sub_cat_name" value="" placeholder="Sub Category Name"/>
                    </div>					
                    <div class="row-fluid padding">
						<h6 class="heading">Sub Category Hindi Name</h6>
						<!--<textarea class="ckeditor" cols="80" id="short_description" name="short_description" rows="10" placeholder="Short Description"></textarea>-->
                        <input type="text" class="span12" name="sub_cat_name" id="sub_cat_name" value="" placeholder="Sub Category Name"/>
                    </div>
					<div class="row-fluid padding">
						<h6 class="heading">Sub Category Marathi Name</h6>
						<!--<textarea class="ckeditor" cols="80" id="long_description" name="long_description" rows="10" placeholder="Long Description"></textarea>-->
                       <input type="text" class="span12" name="sub_cat_name_marathi" id="sub_cat_name_marathi" value="" placeholder="Sub Category Marathi Name"/>
                    </div>
					<div class="row-fluid padding">
						<h6 class="heading">Category Image</h6>
						<input type="file" class="span12" name="sub_category_image" value="" placeholder="Sub Category Image"/>
                    </div>
					
					<div class="row-fluid">
						<h6 class="heading">Category</h6>
                        <select class="span6" name="cat_id" id="cat_id">
							<option value="">All Category</option>
							<?php
								while($res=mysql_fetch_array($query3))
								{ 
									echo '<option value="'.$res['cat_id'].'">'.$res['category_name'].'</option>';
								}
							?>
						</select>
                    </div>
					
					<div class="row-fluid">
						<h6 class="heading">Is_Active</h6>
						<div class="toggle-button" data-toggleButton-style-enabled="danger">
							<input type="checkbox" name="is_Active" checked=checked class="mCatActive"/>
						</div>					
					</div>
                    <div class="row-fluid">
                        <button type="submit" class="btn btn-success offset1 pull-right" id="addtechnology" name="addtechnology">Save</button>
                        <button type="reset" class="btn btn-warning pull-right" name="">Reset</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- // Widget END -->

    </div>
    <div class="innerLR">

        <div class="widget" data-toggle="collapse-widget">

            <!-- Widget heading -->
            <div class="widget-head">
                <h4 class="heading">Categories</h4>
            </div>
            <!-- // Widget heading END -->

            <div class="widget-body">
                <table class="dynamicTable table table-striped table-bordered table-condensed">

                    <!-- Table heading -->
                    <thead>
                        <tr>
							<th>#</th>
                            <!--<th>School Id.</th>-->
                            <th>Category Name</th>
                            <th>Sub Category Name</th>
							<th>Sub Category Name Hindi</th>
							<th>Sub Category Name Marathi</th>						
                            <th>Ismage</th>							
                            <th>Action</th>
                            <!--<th>Last Update</th>-->
                        </tr>
                    </thead>
                    <!-- // Table heading END -->

                    <!-- Table body -->
                    <tbody class="bodycat">
                        <?php
                        $sub_cat = $db->getSubCategory();
						$i=1;
                        foreach ($sub_cat as $key => $value) {
                            ?>
                            <!-- Table row -->
							<tr class="gradeX" id="c<?php echo ($i); ?>">
								<td><?php echo ($i == NULL) ? "-" : $i; ?></td>
                                <td><?php echo $value['category_name']; ?></td>                                
                                <td><?php echo $value['sub_cat_name']; ?></td>
                                <td><?php echo $value['sub_cat_name_hindi']; ?></td>
                                <td><?php echo $value['sub_cat_name_marathi']; ?></td>
                                
								<td><img src="<?php echo ($value['sub_category_image'] == NULL) ? "../image/avatar.jpg" : "../image/".$value['sub_category_image']; ?>" width="30px" height="30px"></td>                                
                                <td style="display:inline-flex"><button type="button" class="btn btn-danger btn-mini deleteCat" id="<?php echo ($value['sub_cat_id']); ?>">delete</button>&nbsp;
                                    <a type="button" class="btn btn-success  btn-mini editCat" href="http://farmerapp.in/krishi/newbackend/sub_category.php?id=<?php echo ($value['sub_cat_id']); ?>&action=edit">edit</button></td>
                                <?php /*<td><?php echo ($value['last_update'] == NULL) ? "-" : $value['last_update']; ?></td>*/ ?>
                            </tr>
                            <!-- // Table row END -->
                        <?php $i++; } ?>
                        <!-- Table row -->

                        <!-- // Table row END -->

                    </tbody>
                    <!-- // Table body END -->

                </table>
            </div>
        </div>
    </div>

    <div class="modal hide fade" id="modal-cat" role="dialoge">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3>Modal header</h3>
        </div>
        <div class="modal-body">
            <div class="span6">

                <!-- Widget -->
                <div class="widget" data-toggle="collapse-widget">

                    <!-- Widget heading -->
                    <div class="widget-head">
                        <h4 class="heading">Edit Categories</h4>

                    </div>
                    <!-- // Widget heading END -->

                    <div class="widget-body">
                        <form action="" id="catsaveform" method="POST">


                            <input type="hidden" name="cat_id" id="cat_id" value=""/>
                            <div class="row-fluid">
                                <input type="text" name="cat_name" placeholder="Name" class="span12 mTitle black" />
                            </div>
                            <div class="row-fluid mMessage">
                                <input type="text" name="cat_desc" placeholder="Description" class="span12 mMsg black" />
                            </div>


                        </form>
                    </div>
                </div>
                <!-- // Widget END -->

            </div>


        </div>
        <div class="modal-footer">
            <a href="#" data-dismiss="modal" class="btn btn-default">Close</a>
            <a href="#" class="btn btn-primary" id="saveCat">Save changes</a>
        </div>
    </div>
</div>


</div>
<!-- // Content END -->



<script type="text/javascript">
    //alert($("#dashboard").html());
    //	$(".categories").addClass('active');
	function getCity()
	{
		if($("#state").val()!='')
		{
			$.ajax({
				url: "./helper.php",
				type: 'POST',
				data: "action=getCity&state=" + $("#state").val(),
				success: function (data, textStatus, xhr) {
					$("#divCity").html(data);
				},
				error: function (xhr, textStatus, errorThrown) {
					$.gritter.add({
						title: "Error",
						text: "Please try later!!!"
					});
					return false;
				}
			});
			return false;
		}        
    }
	function getTaluka()
	{
		if($("#city").val()!='')
		{
			$.ajax({
				url: "./helper.php",
				type: 'POST',
				data: "action=getTaluka&city=" + $("#city").val(),
				success: function (data, textStatus, xhr) {
					$("#divTaluka").html(data);
				},
				error: function (xhr, textStatus, errorThrown) {
					$.gritter.add({
						title: "Error",
						text: "Please try later!!!"
					});
					return false;
				}
			});
			return false;
		}        
    }
	
</script>
<?php
require_once 'lib_footer.php';
?>