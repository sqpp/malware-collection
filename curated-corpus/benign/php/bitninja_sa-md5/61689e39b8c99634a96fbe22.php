<?php 
$page = "uploads";

require_once('global_functions.php'); 

$message = $_GET["message"];


if ( $_POST["act"] == "upload" ) {
	
	$target_path = $_REQUEST['folder'].'/';
	$target_path = $target_path . basename( $_FILES['img']['name']); 
		
	if(move_uploaded_file($_FILES['img']['tmp_name'], $target_path)) {
		$message = "The file ".  basename( $_FILES['img']['name']). 
		" has been uploaded to the ".$_REQUEST['folder']." directory";
	} else{
		$message = "There was an error uploading the file, please try again!";
	};
	
};

if ( $_GET["act"] == "deleteFile" ) {

	$target_path = 'documents/';
	$target_path = $target_path . $_GET['file']; 
	unlink($target_path);
	
	$message = "The file ".urlencode($_GET['file'])." was deleted";
	$goTo = '/'.$page."/?act=deleted&message=".$message;
  	header(sprintf("Location: %s", $goTo));
}



?>

<?php include('header.php'); ?>

<h2>Uploads</h2>




<form enctype="multipart/form-data" METHOD="POST" action="/<?php echo $page ?>/" name="uploadform" id="uploadform" onSubmit="if(this.folder.value == ''){alert('Please select a destination folder');return false;}">
<input type="hidden" name="act" value="upload" />


<div id="poststuff" class="postbox">
<div class="postboxTitle"><h3>UPLOAD A FILE</h3></div>
<div class="inside">

<table class="input_form" cellspacing="0">
<thead><tr><th>FILE TO UPLOAD</th></tr></thead>
<tbody>
<tr class="iedit">
<td> 
<select id="folder" name="folder" class="postform">
<option value="">Destination folder</option>
<option value="image_library">Image Library</option>
<option value="documents">Documents Library</option>
</select>
</td>
</tr> 
<tr class="iedit">
<td> 
<input name="img" type="file" class="postform2" >
</td>
</tr> 
</tbody>
</table>

<input type="submit" id="post-query-submit" value="UPLOAD IT" class="button-secondary" id="uploadit" />

<?php echo '<p>'.$message.'</p>'; ?>

<p class="clear"></p></div>
<p class="clear"></p></div> 

</form>



<table class="widefat page fixed" cellspacing="0">

<thead>
  <tr>
	<th>DOCUMENTS</th>
    <th>LINK</th>
    <th width="125"></th>
  </tr>
</thead>
<tbody>

<?php  


$dir = opendir('documents');        // Open the sucker

$files = array();
while ($files[] = readdir($dir));
sort($files);
closedir($dir);

foreach ($files as $file) {

		if ($file != "" && $file != "." && $file != "..") {
					 
?>			
<tr>
<td><?php echo $file; ?></td>
<td>../documents/<?php echo $file; ?></td>		
<td><a href="<?php echo $siteurl.'/documents/'.$file; ?>" target="_blank">View</a> | <a href="/<?php echo $page.'/?act=deleteFile&file='.urlencode($file); ?>">Delete</a></td>
</tr>  			
<?php 			
	}
}



?>
</tbody>

</table>



<?php include('footer.php'); ?>


