<?php include "../connection/conn.php" ?>
<?php
if(empty($_SESSION['userid'])){
	header("location:login.php?msg=Please login first.");
}
// for Add event
if($_POST['addEvent']){
    $title = $_REQUEST['title'];
    $type = $_REQUEST['type'];
    $video_url=$_REQUEST['video_url'];
    $video_platform = $_REQUEST['video_platform'];
    $video_time = $_REQUEST['video_time'];
    $image = $_FILES["image"]["name"];
    if (!file_exists('images/event')) {
                    mkdir('images/event', 0777, true);
                }
    if($image!=''){
        move_uploaded_file($_FILES["image"]["tmp_name"] , "images/event/".$image);	
        }
    mysqli_query($conn,"insert into apex_event set title='$title', type='$type', video_url='$video_url', video_platform='$video_platform', video_time='$video_time', image='$image'");
    header("location:event.php?message=Event Added Successfully");
}

// for edit event
if($_POST['editEvent']){
    $id = $_REQUEST['id'];
    $title = $_REQUEST['title'];
    $type = $_REQUEST['type'];
    $video_url=$_REQUEST['video_url'];
    $video_platform = $_REQUEST['video_platform'];
    $video_time = $_REQUEST['video_time'];
    $image = $_FILES["image"]["name"];
    if (!file_exists('images/event')) {
                    mkdir('images/event', 0777, true);
                }
    if($image!=''){
        move_uploaded_file($_FILES["image"]["tmp_name"] , "images/event/".$image);	
        }
    else{
        $image=$_REQUEST['tempImageName'];
    }
    mysqli_query($conn,"update apex_event set title='$title', type='$type', video_url='$video_url', video_platform='$video_platform', video_time='$video_time', image='$image' where id='$id'");
    header("location:event.php?message=Event Updated Successfully");
}

// for delete event
if(!empty($_GET['del_id'])){
    $id = $_REQUEST['del_id'];
    // echo "<script>"
        mysqli_query($conn,"update apex_event set is_active='0' where id='$id'");
        header("location:event.php?message=Event Deleted Successfully");
    }

?>