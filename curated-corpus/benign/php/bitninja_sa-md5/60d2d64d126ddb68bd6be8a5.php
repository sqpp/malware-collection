<?php
ob_start();
include "connection.php";
?>
<!DOCTYPE html>
<html lang="en">
		<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<?php require_once "header.php"; ?>
        <meta name="robots" content="index, follow" />
	   <meta name="rating" content="General" />
	   <meta name="distribution" content="Global" />
	   <meta name="resource-type" content="document">
	   <meta name="revisit-after" content="20 days">
	   <meta name="language" content="English, Hindi">

		<link href="css/bootstrap.css" rel="stylesheet">
		<link href="css/custom.css" rel="stylesheet">
		<link href="css/font-awesome.css" rel="stylesheet" media="screen">
		<link rel="stylesheet" href="styles.css">
		<link rel="stylesheet" href="style.css">
		<script src="js/jquery.min.js" type="text/javascript"></script>
		<script src="script.js"></script>
		<!--<script src="js/jquery.min.js"></script>-->
		<script type="text/javascript" src="js/bootstrap.js"></script>

		<!--Horizontal Tabs-->
		<link type="text/css" rel="stylesheet" href="css/responsive-tabs.css" />
		<link type="text/css" rel="stylesheet" href="css/tab.css" />

		<!-- Responsive Tabs JS -->
		<script src="js/jquery.responsiveTabs.js" type="text/javascript"></script>
		<script type="text/javascript">
        $(document).ready(function () {
            $('#horizontalTab').responsiveTabs({
                rotate: false,
                startCollapsed: 'accordion',
                collapsible: 'accordion',
                setHash: true,
               
            });

        });
		
    </script>

		<!-- Owl Carousel Assets -->
		<link href="css/owl.carousel.css" rel="stylesheet">
		<script src="js/owl.carousel.js"></script>
		<script>
			$(document).ready(function() {

				$("#owl-demo").owlCarousel({
					items : 4,
					lazyLoad : true,
					autoPlay : true,
					navigation : true,
					navigationText : ["", ""],
					rewindNav : true,
					scrollPerPage : true,
					pagination : false,
					paginationNumbers : false,
				});

			});
		</script>
		<!-- //Owl Carousel Assets -->

		<script src="js/marquee-scroller.js"></script>
		<!--Banner CSS-->
		<link rel="stylesheet" href="default/default.css" type="text/css" media="screen"/>
		<link rel="stylesheet" href="css/nivo-slider.css" type="text/css" media="screen"/>
		<script type="text/javascript" src="js/jquery.nivo.slider.js"></script>
		<script type="text/javascript">$(window).load(function(){$('#slider').nivoSlider();});</script>

		<!-- Web Fonts  -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css">
		</head>

		<body>
        <div class="container-fluid">
          <div class="row top-header" style="border-top:2px solid #FF0000;">
            <?php require_once "logo.php"; ?>
          </div>
		  		  
          <div class="row menubar" style="border-top:2px solid #FF0000;">
            <div class="container">
              <div id='cssmenu'>
                  <?php require_once "menu.php"; ?>
                </div>
            </div>
          </div>
		  

    <div class="clearfix"></div>

		  <div class="row page-top" style="margin-top:1px;">
            <div class="container">
                <ul class="breadcrumb">
                  <li><a href="#">Home</a> </li>
                  <li class="active" style="color:#FFFFFF;">Online Admission</li>
                </ul>
                <h2 style="color:#FFFFFF;">Online Admission</h2>
              </div>
          </div>

          <div class="row page-content">
            <div class="container" style="background-color:#FFFFFF;">
              <div class="row" style="margin-top:20px;">
                <div class="col-md-12">
                  <div class="col-md-12">
                    <div class="col-md-12  col-left text-justify">
                      <form action="" method="post" enctype="multipart/form-data" class="myform">
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <label>कोर्स का नाम</label>
                        </div>
                        <div class="col-md-6">
                          <select name="course" id="course" class="form-control">
                            <option>-- Choose --</option>
                            <?php
                            $q = "select DISTINCT class from fees";
                            $query = $con->prepare($q);
                            $query->execute();
                            $results=$query->fetchAll(PDO::FETCH_ASSOC);
                            foreach($results as $res)
                            {
                              ?>
                              <option value="<?php echo $res['class']; ?>">
                                  <?php echo $res['class']; ?>
                              </option>
                              <?php
                            }
                              ?>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>विषय</label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <div id="dynamic">--</div>
                        </div>
                      </div>
                      <div class="col-md-12">
                          <div class="col-md-4">
                            <br />
                            <label>Fees</label>
                          </div>
                          <div class="col-md-6">
                            <br />
                            <input type="text" name="fees" class="form-control" id="dynamic_fees" readonly="">
                          </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>छात्र का नाम</label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="text" name="cname" class="form-control" required />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>पिता का नाम</label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="text" name="fname" class="form-control" required />
                        </div>
                      </div>
                       <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>माता का नाम</label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="text" name="mname" class="form-control" required />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>मोबाइल </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="text" name="cmob" class="form-control" required />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>पता </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <textarea name="caddress" required="" class="form-control"></textarea>
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>आधार न०</label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="text" name="cadhar" class="form-control" required />
                        </div>
                      </div>
                       <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>लिंग</label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <select name="cgender" class="form-control">
                            <option>-- Select --</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                          </select>
                        </div>
                      </div>
					  
					  <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>  आरक्षित श्रेणी  </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <select name="category" class="form-control">
						   <option value="">--Select Category--</option>
						   <option value="General">General</option>
						   <option value="O.B.C.">O.B.C.</option>
						   <option value="S.C.">S.C.</option>
						   <option value="S.T.">S.T.</option>
						  </select>
                        </div>
                      </div>
					  
					  <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>  विकलांगता / विशेष आरक्षण  </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="text" required name="hres" placeholder="Disability / Special Reservations" class="form-control">
                        </div>
                      </div>
					  
					  <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>  सत्र वर्ष  </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <select name="yearsch" class="form-control">
						   <option value="">--Select Session--</option>
						   <option value="2020-21">2020-21</option>
						   <option value="2021-22">2021-22</option>
						   <option value="2022-23">2022-23</option>
						   <option value="2023-24">2023-24</option>
						   <option value="2024-25">2024-25</option>
						   <option value="2025-26">2025-26</option>
						  </select>
                        </div>
                      </div>
					  
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>हाई स्कूल मार्कशीट </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="file" name="high_school_mksht" required class="form-control" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>इंटरमीडिएट मार्कशीट </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="file" name="inter_mksht" required class="form-control" />
                        </div>
                      </div>
                       <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>ग्रेजुएशन मार्कशीट </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="file" name="grad_mksht" />
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="col-md-4">
                          <br />
                          <label>अभ्यर्थी फोटो </label>
                        </div>
                        <div class="col-md-6">
                          <br />
                          <input type="file" name="cphoto" class="form-control" />
                        </div>
                      </div>
                      
                      
                      <div class="col-md-12" style="margin-top:20px; width:100%;">
                       <table class="table table-bordered" width="100">
								<tr>
									<td style="height:60px">परीक्षा</td>
									<td style="height:60px">बोर्ड/विश्वविद्यालय नाम</td>
									<td style="height:60px">कालेज का नाम</td>
									<td style="height:60px">उत्तीर्ण वर्ष</td>
									<td style="height:60px">पूर्णांक</td>
									<td style="height:60px">प्रप्तान्क</td>
									<td style="height:60px"> प्रतिशत   </td>
									</tr>
								<tr>
                                  <td>हाईस्कूल</td>
                                <td>
                                   <input type="text" required name="b_name"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="b_college"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="b_prapt"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="b_purnank" class="form-control" style="width:100px;">
                                </td>
                                </td>
								<td>
                                   <input type="text" required name="b_btain" class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="b_total" class="form-control" style="width:100px;">
                                </td>
								</tr>
								<tr>
                                  <td>इंटरमीडिएट</td>
                                <td>
                                   <input type="text" required name="i_name"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="i_college"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="i_prapt"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="i_purnank" class="form-control" style="width:100px;">
                                </td>
                                </td>
								<td>
                                   <input type="text" required name="i_btain" class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" required name="i_total" class="form-control" style="width:100px;">
                                </td>
								</tr>
								<tr>
                                  <td>स्नातक</td>
                                 <td>
                                   <input type="text" name="ca_name"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" name="ca_college"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" name="ca_prapt"  class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" name="ca_purnank" class="form-control" style="width:100px;">
                                </td>
                                </td>
								<td>
                                   <input type="text" name="ca_btain" class="form-control" style="width:100px;">
                                </td>
								<td>
                                   <input type="text" name="ca_total" class="form-control" style="width:100px;">
                                </td>
								</tr>
								</table>
                        
                      </div>  
                      
                      
                      
                      <div class="col-md-12">
                        <div class="col-md-4"></div>
                        <div class="col-md-6">
                          <br />
                          <input type="submit" name="sbtbtn" class="btn btn-primary">
                        </div>
                      </div>
                  </form>
                    </div>
                  
                  <?php
                    if(isset($_POST['sbtbtn']))
                    {
                      include "inc/input_validation.php";
                      $course = $_POST['course'];
                      $cname = test_input($_POST['cname']);
                      $fname = test_input($_POST['fname']);
                      $mname = test_input($_POST['mname']);
                      $cmob = test_input($_POST['cmob']);
                      $subject = $_POST['subject'];

                      $fees = test_input($_POST['fees']);
                      $caddress = test_input($_POST['caddress']);
                      $cgender = test_input($_POST['cgender']);
                      $cadhar = test_input($_POST['cadhar']);
					  $category = test_input($_POST['category']);
					  $hres = test_input($_POST['hres']);
					  $yearsch = test_input($_POST['yearsch']);
					  
					  $b_name = test_input($_POST['b_name']);
					  $b_college = test_input($_POST['b_college']);
					  $b_prapt = test_input($_POST['b_prapt']);
					  $b_purnank = test_input($_POST['b_purnank']);
					  $b_btain = test_input($_POST['b_btain']);
					  $b_total = test_input($_POST['b_total']);
					  $i_name = test_input($_POST['i_name']);
					  $i_college = test_input($_POST['i_college']);
					  $i_prapt = test_input($_POST['i_prapt']);
					  $i_purnank = test_input($_POST['i_purnank']);
					  $i_btain = test_input($_POST['i_btain']);
					  $i_total = test_input($_POST['i_total']);
					  $ca_name = test_input($_POST['ca_name']);
					  $ca_college = test_input($_POST['ca_college']);
					  $ca_prapt = test_input($_POST['ca_prapt']);
					  $ca_purnank = test_input($_POST['ca_purnank']);
					  $ca_btain = test_input($_POST['ca_btain']);
					  $ca_total = test_input($_POST['ca_total']);
					  
                      $dir = "uploads/student/";
                      // photo
                      $cphoto = $_FILES['cphoto']['name'];
                      $cphoto_tmpname = $_FILES['cphoto']['tmp_name'];
                      $photo_path = $dir.$cphoto;
                      // high school
                      $hschool = $_FILES['high_school_mksht']['name'];
                      $hschool_tmpname = $_FILES['high_school_mksht']['tmp_name'];
                      $hschool_path = $dir.$hschool;
                      // inter school
                      $ischool = $_FILES['inter_mksht']['name'];
                      $ischool_tmpname = $_FILES['inter_mksht']['tmp_name'];
                      $ischool_path = $dir.$ischool;
                      // graduation
                      $gschool = $_FILES['grad_mksht']['name'];
                      $gschool_tmpname = $_FILES['grad_mksht']['tmp_name'];
                      $gschool_path = $dir.$gschool;
                      //$admissionno = random_bytes(10);
                    $query2 = $con->prepare("SELECT AUTO_INCREMENT
                      FROM information_schema.TABLES
                      WHERE TABLE_SCHEMA = 'mahabbi1_mybansdihcollege'
                      AND TABLE_NAME = 'admissions'");
                    
                    $query2->execute();
                    $rows = $query2->fetchAll(PDO::FETCH_ASSOC);
                    $admission_no = $rows[0]['AUTO_INCREMENT'];
                      $date = date('d/m/Y');
                      $result2 = $con->prepare("INSERT into admissions(admissionno, name, mobile, class, subject, fees, father, mother, address, high_school, inter, graduation, photo, adhar, gender, category, hres, yearsch, b_name, b_college, b_prapt, b_purnank, b_btain, b_total, i_name, i_college, i_prapt, i_purnank, i_btain, i_total, ca_name, ca_college, ca_prapt, ca_purnank, ca_btain, ca_total, date) values(:admissiono, :name, :mobile, :class, :subject, :fees, :father, :mother, :address, :high_school, :inter, :graduation, :photo, :adhar, :gender,  :category, :hres, :yearsch, :b_name, :b_college, :b_prapt, :b_purnank, :b_btain, :b_total, :i_name, :i_college, :i_prapt, :i_purnank, :i_btain, :i_total, :ca_name, :ca_college, :ca_prapt, :ca_purnank, :ca_btain, :ca_total, :date)");
                      $result2->bindParam(':admissiono', $admission_no);
                      $result2->bindParam(':name', $cname);
                      $result2->bindParam(':mobile', $cmob);
                      $result2->bindParam(':class', $course);
                      $result2->bindParam(':fees', $fees);
                      $result2->bindParam(':subject', $subject);
                      $result2->bindParam(':father', $fname);
                      $result2->bindParam(':mother', $mname);
                      $result2->bindParam(':address', $caddress);
                      $result2->bindParam(':adhar', $cadhar);
                      $result2->bindParam(':gender', $cgender);
					  $result2->bindParam(':category', $category);
					  $result2->bindParam(':hres', $hres);
					  $result2->bindParam(':yearsch', $yearsch);
                      $result2->bindParam(':address', $caddress);
					   $result2->bindParam(':b_name', $b_name);
					   $result2->bindParam(':b_college', $b_college);
					   $result2->bindParam(':b_prapt', $b_prapt);
					  $result2->bindParam(':b_purnank', $b_purnank);
					  $result2->bindParam(':b_btain', $b_btain);
					  $result2->bindParam(':b_total', $b_total);
					  $result2->bindParam(':i_name', $i_name);
					  $result2->bindParam(':i_college', $i_college);
					  $result2->bindParam(':i_prapt', $i_prapt);
					  $result2->bindParam(':i_purnank', $i_purnank);
					  $result2->bindParam(':i_btain', $i_btain);
					  $result2->bindParam(':i_total', $i_total);
					  $result2->bindParam(':ca_name', $ca_name);
					  $result2->bindParam(':ca_college', $ca_college);
					  $result2->bindParam(':ca_prapt', $ca_prapt);
					  $result2->bindParam(':ca_purnank', $ca_purnank);
					  $result2->bindParam(':ca_btain', $ca_btain);
					  $result2->bindParam(':ca_total', $ca_total);
                      $result2->bindParam(':high_school', $hschool_path);
                      $result2->bindParam(':inter', $ischool_path);
                      $result2->bindParam(':graduation', $gschool_path);
                      $result2->bindParam(':photo', $photo_path);					  
                      $result2->bindParam(':date', $date);
                      $result2->execute();
                      move_uploaded_file($cphoto_tmpname, $photo_path);
                      move_uploaded_file($hschool_tmpname, $hschool_path);
                      move_uploaded_file($ischool_tmpname, $ischool_path);
                      move_uploaded_file($gschool_tmpname, $gschool_path);
                      // gen otp
                      $otp = rand(100,9999);
                      // del otp
                      $result3 = $con->prepare("DELETE from otps where mobile=:mob");
                      $result3->bindParam(':mob', $cmob);
                      $result3->execute();
                      // ins otp
                      $result4 = $con->prepare("INSERT into otps(mobile,otp) values(:mob,:otp)");
                      $result4->bindParam(':mob', $cmob);
                      $result4->bindParam(':otp', $otp);
                      $result4->execute();
                      // send otp
                      $msg = "Your OTP is $otp.";
                        $ch = curl_init();
                        curl_setopt($ch, CURLOPT_URL, "http://skylabsms.in/api/mt/SendSMS?user=websit&password=websit&senderid=WEBSIT&channel=Trans&DCS=0&flashsms=0&number=".urlencode($cmob)."&text=".urlencode($msg)."&route=22");
                        curl_setopt($ch, CURLOPT_HEADER, 0);
                        curl_setopt($ch, CURLOPT_RETURNTRANSFER,2);
                        curl_exec($ch);
                        curl_close($ch);
                      ?>
                      <style type="text/css">
                        .myform{display:none;}
                      </style>
                      <form action="" method="post">
                        <label>Enter OTP (received on your mobile) :</label>
                        <input type="text" name="otp" class="form-control" required />
                        <br /><br />
                        <input type="hidden" name="cmobile" class="form-control" value="<?php echo $cmob; ?>" required />
                        <input type="submit" name="verify" value="Verify" />
                      </form>
                      <?php
                    }
                  ?>
                  <?php
                  if(isset($_POST['verify']))
                  {
                    $otp = $_POST['otp'];
                    $mob = $_POST['cmobile'];
                    $result4 = $con->prepare("SELECT * from otps where mobile=:mob and otp=:otp");
                    $result4->bindParam(':mob', $mob);
                    $result4->bindParam(':otp', $otp);
                    $result4->execute();
                    $rows = $result4->fetchAll(PDO::FETCH_ASSOC);
                    if(count($rows)==0)
                    {
                      $result5 = $con->prepare("DELETE from admissions where mobile=:mob");
                      $result5->bindParam(':mob', $mob);
                      $result5->execute();
                      echo "<script>alert('Invalid OTP');</script>";
                    }
                    else
                    {
                      // fetch
                      $result4 = $con->prepare("SELECT * from admissions where mobile=:mob");
                      $result4->bindParam(':mob', $mob);
                      $result4->execute();
                      $rows = $result4->fetchAll(PDO::FETCH_ASSOC);
                      foreach($rows as $k)
                      {
                        $admission_no = $k['admissionno'];
                        $name = $k['name'];
                        $class = $k['class'];
                        $fees = $k['fees'];
                      }
                      // send sms
                      $msg = "Dear $name, Congrats! Your Admission No. is $admission_no. You have enrolled for $class. and Fees $fees Please contact us for college Website No ";
                      $ch = curl_init();
                      curl_setopt($ch, CURLOPT_URL, "http://skylabsms.in/api/mt/SendSMS?user=websit&password=websit&senderid=WEBSIT&channel=Trans&DCS=0&flashsms=0&number=".urlencode($mob)."&text=".urlencode($msg)."&route=22");
                      curl_setopt($ch, CURLOPT_HEADER, 0);
                      curl_setopt($ch, CURLOPT_RETURNTRANSFER,2);
                      curl_exec($ch);
                      curl_close($ch);
                      session_start();
                      $_SESSION['mycoursession'] = $mob;
                      header("location:print.php");
                    }
                  }
                  ?> 
                    </div>
					
                  </div>
                </div>
              </div>
            </div>
          </div>
		  <div class="row section2">
				   <div class="container" style="background-color:#FFFFFF;">
					<?php require_once "midsection.php"; ?>
					</div>
					 </div>
					 
<div class="row footer" style="border-top:5px dashed; color:#D500D5;">
      <div class="container">
        <?php require_once "footer.php"; ?>
   </div>
  </div>
    <script type="text/javascript" src="http://arrow.scrolltotop.com/arrow13.js"></script> 
 </div>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
  $(function(){
    $("#course").change(function(){
        var course = $(this).val();
        $.ajax({
            type : "GET",
            url : "fetch-subject.php",
            data : {"course":course},
            success : function(output){
              $("#dynamic").html(output);
            }
        });
         $.ajax({
            type : "GET",
            url : "fetch-fees.php",
            data : {"course":course},
            success : function(output2){
              $("#dynamic_fees").val(output2);
            }
        });
    });
  });
</script>
</body>
</html>