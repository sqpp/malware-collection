
<?php
	session_start();
	include 'includes/conn.php';

	if(isset($_POST['verify'])){
		$birth = $_POST['birth_date'];
		$newDate = date("Y-m-d", strtotime($birth));
		$mName = strtoupper($_POST['middleName']);
		$sAccount = $_POST['shareAccount'];
		$id = $_POST['id'];


			$sql = "SELECT `birth_date`, `share_account`, `middle_name`, `unique_num`, `class`, `referendum`  FROM `voters_info` WHERE `unique_num` = '$id'";
			$query = $conn->query($sql);
			$row = $query->fetch_assoc();

			if ($row['class'] == "MIGS" && $row['referendum'] == "0") {


		if (($birth != ""  || $birth != null)) {
			# code...

				if($query->num_rows < 1){
					$_SESSION['error'] = 'System Error!';
				}
				else{
					
					if( ($newDate == $row['birth_date'] && $row['birth_date'] != ""))
					{
						$_SESSION['voter'] = $row['unique_num'];
					}
					else
					{
						$_SESSION['error'] = 'Incorrect Verification! Please try again.';
					}
				}
		}
		else if(($mName != ""  || $mName != null)){

				if($query->num_rows < 1){
					$_SESSION['error'] = 'System Error!';
				}
				else
				{
					$middlename = strtoupper($row['middle_name']);
					$middle = str_replace("\t", "", $middlename);
					if($mName == $middle)
					{
						$_SESSION['voter'] = $row['unique_num'];
					}
					else
					{
						$_SESSION['error'] = 'Incorrect Verification! Please try again.'. $middle ."-". $mName;
					}
				}
					
		}
		else if(($sAccount != ""  || $sAccount != null)){

				if($query->num_rows < 1){
					$_SESSION['error'] = 'System Error!';
				}
				else
				{
					$share_account = $row['share_account'];
					$ShareAccount = substr($share_account, -4);

					if(($sAccount == $ShareAccount && $ShareAccount != ""))
					{
						$_SESSION['voter'] = $row['unique_num'];
					}
					else
					{
						$_SESSION['error'] = 'Incorrect Verification! Please try again.';
					}
				}
		}
		else{
			$_SESSION['error'] = 'Try again! Please answer at least two(2) verification type';
		}
	} else {
		$_SESSION['error'] = 'Sorry you cannot proceed';
	}
		
	}
	else{
		$_SESSION['error'] = 'Error 404 Page not found!';
	}

	header('location: index.php');

?>