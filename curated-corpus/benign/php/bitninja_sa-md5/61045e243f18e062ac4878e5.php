<?php
/**
 * Login page
 * leggimenu Admin
 *
 * Copyright 2020, WEBSELF S.r.l.
 *
*/

// Config
require_once( 'inc/config.php' );

// Session
session_start();

// Redirect action if user is already logged in
if( !$_GET && !$_POST && isset($_SESSION['loggedin']) ){
    $access->redirect( ROOT_URL.'/index.php' );
}

// Logout Action
if( isset($_GET['logout']) ) {
    $access->logout( ROOT_URL.'/login.php' );
}

// Login Action
if ( isset($_POST['username'], $_POST['password']) ) {
	$login_result = $access->login( $_POST['username'], $_POST['password'], ROOT_URL.'/index.php' );
}

// Header Options
$meta_title = 'leggimenu Admin - Login';
$custom_assets = '
<!--begin::Page Custom Styles(used by this page) -->
<link href="'.ROOT_URL.'/assets/css/login.css" rel="stylesheet" type="text/css" />
<!--end::Page Custom Styles -->';
$nochat = true;
?>

<!DOCTYPE html>
<html lang="it">

<?php include_once( ROOT_PATH.'/parts/head.php'); ?>

<!-- begin::Body -->
<body class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header-mobile--fixed kt-subheader--fixed kt-subheader--enabled kt-subheader--solid kt-aside--enabled kt-aside--fixed kt-page--loading">

<!-- begin:: Page -->
<div class="kt-grid kt-grid--ver kt-grid--root">
    <div class="kt-grid kt-grid--hor kt-grid--root  kt-login kt-login--v3 kt-login--signin" id="kt_login">
        <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" style="background-image: url(/assets/media/app/bg-login.jpg);">
            <div class="kt-grid__item kt-grid__item--fluid kt-login__wrapper">
                <div class="kt-login__container">

                    <div class="kt-login__signin">
                        <div class="kt-login__head mb-4">

                            <div class="kt-login__logo mb-0">
                                <img src="/assets/media/app/logo-login.png">
                            </div>

                            <?php if( $helper->isMobileDevice() ){ ?>
                                <div class="alert alert-solid-danger alert-bold" role="alert">
                                    <div class="alert-text">
                                        Attenzione: stai utilizzando un dispositivo mobile (Smartphone o Tablet).<br>
                                        Alcune opzioni del gestionale potrebbero non funzionare (es. scaricare il QR Code o riordinare le categorie).<br>
                                        <u>Per ora</u> si consiglia di utilizzare un <b>Computer</b> per utilizzare il gestionale menù.
                                    </div>
                                </div>
                            <?php } ?>

                            <?php if( DEBUG ){ ?>
                                <div class="alert alert-solid-danger alert-bold" role="alert">
                                    <div class="alert-text">
                                        Attenzione: il gestionale è in manutenzione, il login sarà disponibile solo per l'Amministratore.
                                    </div>
                                </div>
                            <?php } ?>

                        </div>
                        <form class="kt-form" action="<?php echo ROOT_URL; ?>/login.php" method="post" autocomplete="on">
                            <?php
                            if( isset($login_result) && $login_result ) {
                                echo
                                '<div class="alert alert-danger" role="alert">
                                    <div class="alert-text">'.$login_result.'</div>
                                </div>';
                            }
                            ?>
                            <div class="input-group">
                                <input class="form-control" type="text" placeholder="Email" name="username" autocomplete="username">
                            </div>
                            <div class="input-group">
                                <input class="form-control" type="password" placeholder="Password" name="password" autocomplete="current-password">
                            </div>
                            <div class="row kt-login__extra">

                                <div class="col align-center">
                                    <label class="kt-checkbox">
                                        <input type="checkbox" name="remember"> Ricordami
                                        <span></span>
                                    </label>
                                </div>

                            </div>
                            <div class="kt-login__actions">
                                <button id="kt_login_signin_submit" class="btn btn-brand btn-elevate kt-login__btn-primary">Accedi</button>
                            </div>
                            <div class="row kt-login__extra">

                                <div class="col align-center">
                                    <a href="https://www.leggimenu.it/profilo/password-dimenticata/" class="kt-login__link" target="_blank">Hai dimenticato la Password?</a>
                                </div>

                                <div class="col align-center">
                                    <!--<a href="https://www.leggimenu.it/login.php?action=logout&redirect_to=https://www.leggimenu.it/registrazione/" class="kt-login__link" target="_blank">Registra un nuovo Account</a>-->
                                    <a href="https://www.leggimenu.it/registrazione/" class="kt-login__link" target="_blank">Registra un nuovo Account</a>
                                </div>

                            </div>
                        </form>
                    </div>

                </div>
            </div>

            <!-- begin:: Footer -->
            <div class="kt-footer kt-grid__item kt-grid kt-grid--desktop kt-grid--ver-desktop" id="kt_footer" style="background: transparent;">
                <div class="kt-footer__copyright">
                    <?php echo date('Y'); ?>&nbsp;&copy;&nbsp;<a href="https://www.kirweb.it" target="_blank" class="kt-link">KiRweb</a>
                </div>
                <div class="kt-footer__menu">
                    Versione: <?php echo VERSION; ?>
                </div>
            </div>
            <!-- end:: Footer -->

        </div>
    </div>
</div>
<!-- end:: Page -->

<?php
// Footer Options
$custom_scripts = '
<!--begin::Page Scripts(used by this page) -->
<script src="'.ROOT_URL.'/assets/js/login.js?v='.rand().'" type="text/javascript"></script> 
<!--end::Page Scripts -->';

// Footer inclusion
include_once( ROOT_PATH.'/parts/foot.php' );