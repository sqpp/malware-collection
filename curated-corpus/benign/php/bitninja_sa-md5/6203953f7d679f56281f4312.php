<?php

// header('Content-Type: application/json');
// header('Content-Type: text/html; charset=utf-8');

// require 'simple_html_dom.php';

include_once 'config.php';



if($_SERVER['REQUEST_METHOD'] == "POST" && isset($_POST['limit'])){

    // echo '<pre>';



    // print_r($_POST);



    // creating query

    $sql = "select * from wp_resource_data";

    if(isset($_POST['resource_type']) && $_POST['resource_type'] !="All"){

        $sql .=  " where res_type='".mysqli_real_escape_string($conn,$_POST['resource_type'])."' and (res_status='1' and ET='1')";

        if(isset($_POST['search_input'])  && $_POST['search_input'] != ""){

      

            $sql .=  " and (res_target_url LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%' or res_title LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%' or res_topics LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%' or res_type LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%') and (res_status='1' and ET='1')";

        }

        

    }

    else if(isset($_POST['search_input']) && $_POST['search_input'] != ""){

      

        $sql .=  " where (res_target_url LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%' or res_title LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%' or res_topics LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%' or res_type LIKE '%".mysqli_real_escape_string($conn,$_POST['search_input'])."%') and (res_status='1' and ET='1')";

    }

    else if($_POST['resource_type'] =="All" && $_POST['search_input'] == ""){
        $sql .= " where (res_status='1' and ET='1')";
    }



    $totalSearchQuery = $sql.";";   

    $results =dbQuery($sql);

    $totalCount = mysqli_num_rows($results);



    // echo $totalCount;







    if($_POST['limit'] == 0){

        $sql .= " ORDER BY id DESC LIMIT 0,12;";

    }

    else{

        // for uploaded file view data limit is set to 50

        $sql .= " ORDER BY id DESC LIMIT ".mysqli_real_escape_string($conn,$_POST['limit']).",4;";

    }

    

    // echo $sql;

    $rows = array();

    $rows[] = array('totalCount' => $totalCount);

    $results = dbQuery($sql);



    while($row = dbFetchAssoc($results)){

        $rows[] = $row;

    }

    

    

                // echo json_encode($rows);
                echo  json_encode($rows, JSON_INVALID_UTF8_IGNORE);

} 

// if($_POST['limit'] == 0){
//     $sql .= " ORDER BY id DESC LIMIT 0,12;";
//     }   

// else{
//     // for uploaded file view data limit is set to 50
//     $sql .= " ORDER BY id DESC LIMIT ".mysqli_real_escape_string($conn,$_POST['limit']).",4;";
// }



// // echo $sql;

// $rows = array();

// $rows[] = array('totalCount' => $totalCount);

// $results = dbQuery($sql);

// while($row = dbFetchAssoc($results)){
//     $rows[] = $row;
// }
//            // echo json_encode($rows);
// echo  json_encode($rows, JSON_INVALID_UTF8_IGNORE);




// **************************************

// $sql = "select * from wp_resource_data LIMIT 12";

// $results = dbQuery($sql);

// $rows = array();


// $totalCount = mysqli_num_rows($results);
// // echo "total count from db ".$totalCount;

// while($row = dbFetchAssoc($results)){

//     $rows[] = $row;
//     // echo "row data";
//     // print_r($row);
// }

// //    echo json_encode($row);
// echo  json_encode($rows, JSON_INVALID_UTF8_IGNORE);


  
?>