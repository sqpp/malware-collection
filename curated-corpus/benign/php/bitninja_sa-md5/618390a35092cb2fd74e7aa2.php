<?php
include './connection.php';

$pass = $_SESSION['instantupdate']['pass'];
$status = $_SESSION['instantupdate']['status'];
$myid = $_SESSION['instantupdate']['id'];

if (!iu_is_admin()) { err('Access denied! You need to <a href="login.php">log in</a> as admin first.', true);  }

//šta? žđšđčć

?>

<?php include "iu-header.php"; ?>

<?php
if (isset($_GET['dir']))
{
	$dir = realpath($_GET['dir']);
}
else
{
	$dir = realpath($backpath);
}
?>

<div class="navigation">

             <span> WELCOME <?php echo strtoupper($_SESSION['instantupdate']['user']); ?></span>
        - Here you can edit source files.</div>

<br />
<p>Browsing directory: <?php echo $dir; ?></p>
                <table cellspacing="0" summary="table" class="iu_table" border='1'>
                <thead>
                     	    <tr>
                     	    	<th scope="col" width='5%'>Type</th>
                                <th scope="col" width='80%'>File name</th>
                                <th scope="col" width='15%'>Manage</th>
                      		</tr>
                     </thead>
                  <tbody>

<?php

$fileicons = array("html", "php", "css", "js", "htm");
$imgicons = array("jpg", "gif", "png", "ico", "psd");
$noedit = array("exe", "zip", "gz", "7zip", "rar", "bin", "dat", "swf", "flv", "avi", "3g", "3gp", "mp3", "ogg");

if ($dir != realpath($backpath))
{
$upperdir = realpath($dir.'/..');
echo <<<TABLEROW
	<tr class="even">
		<td style="text-align: right;"><img src="images/icons/folder.png" /></td>
		<td><a href="editfiles.php?dir=$upperdir">[ level up ]</a></td>
		<td><a href="editfiles.php?dir=$upperdir" class="table_edit" title="browse">browse</a></td>
	</tr>
TABLEROW;
}

$dirs = dir_list($dir);

$br = 0;
foreach($dirs as $file)
{


	if ($file == "manage")
	{
		$icon = "manage.png";
		$editable = false;
	}
	else
	{
		$icon = "folder.png";
		$editable = true;
	}

	if ($editable == true)
	{
		$link = "editfiles.php?dir=" . realpath($dir . '/' . $file);
	}
	else
	{
		$link = "javascript:alert('For security reasons, folder \'$file\' can not be listed.');";
	}

	$br++;
	$evenodd = ($br % 2 == 1) ? "even" : "odd";
	echo <<<TABLEROW
	<tr class="$evenodd">
		<td style="text-align: right;"><img src="images/icons/$icon" /></td>
		<td><a href="$link">$file</a></td>
		<td><a href="$link" class="table_edit" title="browse">browse</a></td>
	</tr>
TABLEROW;
}

$files = file_list($dir);

foreach($files as $file)
{

	if (in_array(filext($file), $imgicons))
	{
		$icon = "image.png";
		$editable = false;
	}
	elseif (in_array(filext($file), $fileicons))
	{
		$icon = filext($file) . ".png";
		$editable = true;
	}
	elseif (in_array(filext($file), $noedit))
	{
		$icon = "noedit.png";
		$editable = false;
	}
	else
	{
		$icon = "page.png";
		$editable = true;
	}


	if ($editable == true)
	{
		$link = "editpage.php?name=" . realpath($dir . '/' . $file);
	}
	else
	{
		$link = "javascript:alert('$file is not editable due to it\'s file type.');";
	}

	$br++;
	$evenodd = ($br % 2 == 1) ? "even" : "odd";
	echo <<<TABLEROW
	<tr class="$evenodd">
		<td style="text-align: right;"><img src="images/icons/$icon" /></td>
		<td><a href="$link">$file</a></td>
		<td><a href="$link" class="table_edit" title="edit">edit</a></td>
	</tr>
TABLEROW;
}

if ($br == 0)
{
echo <<<TABLEROW
	<tr class="even">
		<td>&nbsp;</td>
		<td>No editable files found!</td>
		<td>&nbsp;</td>
	</tr>
TABLEROW;
}

?>
                  </tbody>
                </table>
<br />
<br />

   <div class="right_subpic_box">

    			<div class="right_subpic_box_text_wide">
                	<div class="right_subpic_box_title"><img src="images/help.png" alt="help icon" width="16" height="16" align="texttop" /> Help Box</div>
<p style="padding:15px 25px 15px 15px;">  <strong>HINT:</strong><br />
  Above this box you can see listed PHP files in the root of your web site which are editable. If you see "No editable files found!" message, that means no editable (chmod 777) files are found. <br />
</p>

                </div>



            </div>


<?php include "iu-footer.php"; ?>