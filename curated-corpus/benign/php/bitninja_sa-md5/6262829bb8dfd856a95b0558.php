<?php

add_action('wp_head', 'sworks');
function sworks()
{
?>
    <script type="text/javascript">
        //<![CDATA[
        document.ondragstart = function() {
            return false;
        }

        function nocontext(e) {
            return false;
        }
        document.oncontextmenu = nocontext;
        //]]>
    </script>


    <script type="text/javascript">
        document.onkeydown = function(e) {
            if (e.ctrlKey &&
                (e.keyCode === 67 ||
                    e.keyCode === 86 ||
                    e.keyCode === 85 ||
                    e.keyCode === 83 ||
                    e.keyCode === 117)) {
                alert('Kopyalamanıza izin verilmiyor.');
                return false;
            } else {
                return true;
            }
        };
    </script>

<?php
};


function flutter_news_rest_prepare_post($data, $post, $request)
{
    $_data = $data->data;
    $video = get_post_meta($post->ID, 'td_post_video', true);
    if ($video) {
        $_data["custom"] = get_post_meta(
            $post->ID,
            'td_post_video',
            true
        );
    } else {
        $_data["custom"]["td_video"] = "";
    }
    $featured_image_id = $_data['featured_media'];
    $featured_image_url = get_the_post_thumbnail_url(
        $post->ID,
        "original"
    );
    if ($featured_image_url) {
        $_data['custom']["featured_image"] = $featured_image_url;
    } else {
        $_data['custom']["featured_image"] = "";
    }
    $_data['custom']["author"]["name"] = get_author_name($_data['author']);
    $_data['custom']["author"]["avatar"] = get_avatar_url($_data['author']);
    $categories = get_the_category($_data["id"]);
    $_data['custom']["categories"] = $categories;
    $data->data = $_data;
    return $data;
}
add_filter(
    'rest_prepare_post',
    'flutter_news_rest_prepare_post',
    10,
    3
);
// Enable comment without being loggedin
function filter_rest_allow_anonymous_comments()
{
    return true;
}
add_filter('rest_allow_anonymous_comments', 'filter_rest_allow_anonymous_comments');

add_action('after_setup_theme', 'remove_admin_bar');

function remove_admin_bar()
{
    if (!current_user_can('administrator') && !is_admin()) {
        show_admin_bar(false);
    }
}

function yakuphoca_yonetim_paneli_engelle()
{
    if (false !== strpos(strtolower($_SERVER['REQUEST_URI']), '/wp-admin') && !current_user_can('edit_posts'))
        wp_redirect(home_url());
}
add_action('init', 'yakuphoca_yonetim_paneli_engelle', 0);

function custom_loginlogo()
{
    echo '<style type="text/css"> 
body.login div#login h1 a {
background-image: url(https://arkipedya.com/wp-content/uploads/2021/10/cropped-arkipedya-rankmath.png);
}
.login h1 a {
background-size: 128px;
width: 128px;
height:128px;
</style>';
}
add_action('login_head', 'custom_loginlogo');

//İçerik sağlayıcı rolüne sahip kullanıcılara ön uçtan resim yükleme yetkisi verme
if (current_user_can('contributor') && !current_user_can('upload_files')) :
    add_action('init', 'allow_contributor_media');
    function allow_contributor_media()
    {
        $contributor = get_role('contributor');
        $contributor->add_cap('upload_files');
    }
endif;

?>