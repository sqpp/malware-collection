
<?php                   
                        
                        include 'includes/functions.inc.php'; 
                        // header('Content-Type: application/json');
                        $fileloc = "cache/todaymovies/";

                        $gettmschedule = sanitizeget($_GET['language']);
                        
        $p_title = ucwords($gettmschedule)." Latest Movies schedule on Tv Directly.";
        $p_desc = "Not just the ".ucwords($gettmschedule)." Movies Names but the movie starting time and the channel where it will be shown, also you can further check that channel's schedule.";

        include 'includes/navbar.inc.php'; 
?>
<div class="text-center pt-10 font-sans">
    <h1 class="text-4xl font-semibold px-2">Today's - <?= $gettmschedule ?> Movies on TV</h1>
    <p class="px-4">Get all the movies from today's schedule also to view the channel schedule directly, click on the channel name.<br/> Now you can get various movies that will be shown on TV from various channels<br/> but restricted to the language you select.</p>
    <p class="font-medium mt-2">According to Indian Time</p>
</div>

<?php

                            

                            if(file_exists($fileloc."todaymovies".$gettmschedule.".txt") && filemtime($fileloc."todaymovies".$gettmschedule.".txt") > time() - 10800){
                                $tmovieresponse = file_get_contents($fileloc."todaymovies".$gettmschedule.".txt");
                            }else{
                            $tmoviecurl = curl_init();

                            curl_setopt_array($tmoviecurl, [
                                CURLOPT_URL => "https://indian-tv-schedule.p.rapidapi.com/GetTodaysMovies?lang=".str_replace(' ', '%20', $gettmschedule),
                                CURLOPT_RETURNTRANSFER => true,

                                CURLOPT_HTTPHEADER => [
                                    "x-rapidapi-host: ".$api_name,
                                    "x-rapidapi-key: ".$api_key
                                ],
                            ]);

                            $tmovieresponse = curl_exec($tmoviecurl);

                            if(!str_contains($tmovieresponse, "Internal Server Error")){
                                if($tmovieresponse !== ''){
                                    file_put_contents($fileloc."todaymovies".$gettmschedule.".txt", $tmovieresponse);
                                }
                            }
                            

                            curl_close($tmoviecurl);
                        }

                            $separatedbr = explode("<br>", $tmovieresponse);

                $j=0;$i=0;   
                foreach ($separatedbr as $key => $value) {
                    $separated = explode(":", $separatedbr[$key]);
                    $data = explode(' (',$separated[4]);
                    
                    $fulltime = $separated[0].":".$separated[1].":".$separated[2];
                    $arrcast = explode(',', str_replace(')','',$data[1]));
                    $channelname = str_replace("-", "",$separated[3]);
                    $chnamespace = str_replace(' ','_',trim($channelname));
                    if(!empty($fulltime) && !empty($separated[3]) && !empty($separated[4] && !empty($data[0]))){

?>


<div class="w-full flex justify-center">
<div class="flex flex-col mt-10 lg:w-2/4 w-11/12 justify-center">
    <div class="flex flex-row border-2 border-green-400 justify-center space-x-2 md:space-x-10 lg:space-x-20">
        <div class="bg-green-200 py-1 px-1 flex items-center w-1/5 text-xs md:text-base lg:text-lg text-center justify-center text-green-600 flex-col"><div class="text-sm bg-green-300 rounded px-0.5">Starts</div><?= date("h:i a", strtotime($fulltime)) ?></div>
        <div class="bg-green-200 py-1 px-1 flex items-center w-5/12 text-sm md:text-base lg:text-lg text-center justify-center text-green-600 flex-col"><div class="text-sm bg-green-300 rounded px-0.5">Channel</div><a href="<?= "/channel/".$chnamespace ?>" class="hover:text-blue-500"><?= $channelname ?></a></div>
        <div class="bg-green-200 py-1 px-1 flex items-center w-2/6 text-sm md:text-base lg:text-lg text-center justify-center text-green-600 flex-col break-all"><div class="text-sm bg-green-300 rounded px-0.5">Movie</div><?= $data[0] ?></div>
    </div>
    <div class="bg-green-100 flex flex-col justify-center items-center py-2 text-center hidden " id="casttab<?= $i=$i+1; ?>">
        <h3 class="text-xl font-medium">Cast</h3>
        <div class="grid grid-cols-2 lg:grid-cols-4 justify-start gap-x-5 gap-y-4 ml-4">
            <?php foreach ($arrcast as $singlearr) { ?>
                <div><p class="text-left"><?php if(!empty($singlearr)){echo $singlearr;}else{echo "No Cast Available.";} ?></p></div>
            <?php } ?>
        </div>
    </div>
    <div class="bg-green-200 rounded-b-lg flex justify-center cursor-pointer" onclick="opencasttab(<?= $j=$j+1; ?>)">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </div>
</div>
</div>
<?php
    // }else if(empty($fulltime) && empty($separated[3]) && empty($separated[4] && empty($data[0]))){ ?>

        <!-- <div class="h-screen flex justify-center items-center px-5 text-center">
            <p class="text-2xl font-bold text-green-800 leading-loose">Movies Not Available on this Language Right Now !</p>
        </div>-->
<?php 
    }
}
?>



<?php include 'includes/footer.inc.php'; ?>