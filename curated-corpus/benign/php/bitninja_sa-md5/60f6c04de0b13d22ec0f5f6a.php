<?php
if (!isset($_SESSION)) {
  session_start();
}
$MM_authorizedUsers = "";
$MM_donotCheckaccess = "true";

// *** Restringir el acceso a la página: otorgar o denegar el acceso a esta página
function isAuthorized($strUsers, $strGroups, $UserName, $UserGroup) { 
  // Por seguridad, comience suponiendo que el visitante NO está autorizado. 
  $isValid = False; 

  // Cuando un visitante ha iniciado sesión en este sitio, la variable de sesión MM_Username se iguala a su nombre de usuario. 
  // Por lo tanto, sabemos que un usuario NO ha iniciado sesión si esa variable de Sesión está en blanco. 
  if (!empty($UserName)) { 
    // Además de iniciar sesión, puede restringir el acceso solo a ciertos usuarios en función de una ID establecida al iniciar sesión. 
    // Analizar las cadenas en arrays. 
    $arrUsers = Explode(",", $strUsers); 
    $arrGroups = Explode(",", $strGroups); 
    if (in_array($UserName, $arrUsers)) { 
      $isValid = true; 
    } 
    // O bien, puede restringir el acceso solo a ciertos usuarios según su nombre de usuario. 
    if (in_array($UserGroup, $arrGroups)) { 
      $isValid = true; 
    } 
    if (($strUsers == "") && true) { 
      $isValid = true; 
    } 
  } 
  return $isValid; 
}

$MM_restrictGoTo = "index.php";
if (!((isset($_SESSION['MM_Username'])) && (isAuthorized("",$MM_authorizedUsers, $_SESSION['MM_Username'], $_SESSION['MM_UserGroup'])))) {   
  $MM_qsChar = "?";
  $MM_referrer = $_SERVER['PHP_SELF'];
  if (strpos($MM_restrictGoTo, "?")) $MM_qsChar = "&";
  if (isset($_SERVER['QUERY_STRING']) && strlen($_SERVER['QUERY_STRING']) > 0) 
  $MM_referrer .= "?" . $_SERVER['QUERY_STRING'];
  $MM_restrictGoTo = $MM_restrictGoTo. $MM_qsChar . "accesscheck=" . urlencode($MM_referrer);
  header("Location: ". $MM_restrictGoTo); 
  exit;
}
// fin de validaciones de usuario. 


// coneccion a la base de datos.
require_once('Connections/conex.php'); 


if (!function_exists("GetSQLValueString")) {
function GetSQLValueString($theValue, $theType, $theDefinedValue = "", $theNotDefinedValue = "") 
{
  if (PHP_VERSION < 6) {
    $theValue = get_magic_quotes_gpc() ? stripslashes($theValue) : $theValue;
  }

global $conex;
$theValue = function_exists("mysqli_real_escape_string") ? mysqli_real_escape_string($conex, $theValue) : mysqli_escape_string($conex,$theValue);
  switch ($theType) {
    case "text":
      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";
      break;    
    case "long":
    case "int":
      $theValue = ($theValue != "") ? intval($theValue) : "NULL";
      break;
    case "double":
      $theValue = ($theValue != "") ? doubleval($theValue) : "NULL";
      break;
    case "date":
      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";
      break;
    case "defined":
      $theValue = ($theValue != "") ? $theDefinedValue : $theNotDefinedValue;
      break;
  }
  return $theValue;
}
}
// FIN coneccion a la base de datos.


$editFormAction = $_SERVER['PHP_SELF'];
if (isset($_SERVER['QUERY_STRING'])) {
  $editFormAction .= "?" . htmlentities($_SERVER['QUERY_STRING']);
}


    if ((isset($_POST["MM_update"])) && ($_POST["MM_update"] == "form1")) {
	

	$imagen_01 = $_FILES["str_imagen"] ["name"];
	move_uploaded_file($_FILES["str_imagen"] ["tmp_name"], "../assets/imagenes/banner/" .$imagen_01);
	
	if (isset($imagen_01)&&($imagen_01!=""))
	{
	    $nuevaimagen_01 = $imagen_01;
	}
	else {
	    $nuevaimagen_01 = $_POST["str_imagen_nueva"];	
	}
	
	
	
  $updateSQL = sprintf("UPDATE tbl_banner SET str_imagen=%s WHERE id_banner=%s",

					   GetSQLValueString($nuevaimagen_01, "text"),
                       GetSQLValueString($_POST['id_banner'], "int"));
	

  $Result1 = mysqli_query($conex, $updateSQL) or die(mysqli_error($conex));

  $updateGoTo = "edit_carrusel.php";
  if (isset($_SERVER['QUERY_STRING'])) {
    $updateGoTo .= (strpos($updateGoTo, '?')) ? "&" : "?";
    $updateGoTo .= $_SERVER['QUERY_STRING'];
  }
  header(sprintf("Location: %s", $updateGoTo));
}

$varID_banner = "0";
if (isset($_GET["id"])) {
  $varID_banner = $_GET["id"];
}
$query_banner = sprintf("SELECT * FROM tbl_banner WHERE tbl_banner.id_banner = %s", GetSQLValueString($varID_banner, "int"));
$banner = mysqli_query($conex, $query_banner) or die(mysqli_error($conex));
$row_banner = mysqli_fetch_assoc($banner);
$totalRows_banner = mysqli_num_rows($banner);


/* indica variable para dejar clase activa del menu */
$mi_pagina="ver_banner";


?>

<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->
		
		<!-- Titulo de la pagina -->
		<?php include("includes/titulo.php"); ?>
		
		<meta name="description" content="">
		<meta name="author" content="">
			
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<!-- Basic Styles -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/font-awesome.min.css">

		<!-- SmartAdmin Styles : Caution! DO NOT change the order -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-production-plugins.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-production.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-skins.min.css">

		<!-- SmartAdmin RTL Support  -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-rtl.min.css">

		<!-- Demo purpose only: goes with demo.js, you can delete this css when designing your own WebApp -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/demo.min.css">

		<!-- FAVICONS -->
		<link rel="shortcut icon" href="img/favicon/favicon.ico" type="image/x-icon">
		<link rel="icon" href="img/favicon/favicon.ico" type="image/x-icon">

		<!-- GOOGLE FONT -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700">

		<!-- Specifying a Webpage Icon for Web Clip 
			 Ref: https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html -->
		<link rel="apple-touch-icon" href="img/splash/sptouch-icon-iphone.png">
		<link rel="apple-touch-icon" sizes="76x76" href="img/splash/touch-icon-ipad.png">
		<link rel="apple-touch-icon" sizes="120x120" href="img/splash/touch-icon-iphone-retina.png">
		<link rel="apple-touch-icon" sizes="152x152" href="img/splash/touch-icon-ipad-retina.png">

	</head>
	

	<body class="">

		<!-- HEADER -->
		<?php include("includes/cabecera.php"); ?>
		<!-- END HEADER -->

		<!-- Left panel : Navigation area -->
		<!-- Note: This width of the aside area can be adjusted through LESS variables -->
		<aside id="left-panel">

			<!-- informacion del usuario -->
			<?php include("includes/usuario.php"); ?>
			<!-- fin informacion del usuario -->

			<!-- MENU : esta navegacion tambien es responsiva-->
			<?php include("includes/menu.php"); ?>
			

			<span class="minifyme" data-action="minifyMenu"> 
				<i class="fa fa-arrow-circle-left hit"></i> 
			</span>

		</aside>
		<!-- FIN MENU -->

		<!-- Panel central -->
		
<!-- INICIO PANEL -->
<!-- INICIO PANEL -->
<!-- INICIO PANEL -->
<!-- INICIO PANEL -->
<!-- INICIO PANEL -->
<!-- INICIO PANEL -->
		
<div id="main" role="main">
	
	
	
	
	<?php
	//funciones migas de pan
	$txt_01= 'Nobel químicos';
	$txt_02= 'Edición';
	$txt_03= 'Agregar imágenes';
	$txt_04= '';
	$txt_05='';
	?>

<!-- RIBBON -->
<div id="ribbon">
	<span class="ribbon-button-alignment">
		<span id="refresh" class="btn btn-ribbon" data-action="resetWidgets" data-title="refresh"  rel="tooltip" data-placement="bottom" data-original-title="<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings." data-html="true">
			<i class="fa fa-refresh"></i>
		</span>
	</span>
<!-- direccionamiento LLamado comunmente MIGAS DE PAN "breadcrumb"-->
	<ol class="breadcrumb">
		<li>
			<?php echo $txt_01 ?>
		</li>
		<li>
			<?php echo $txt_02 ?>
		</li>
		<li>
			<?php echo $txt_04 ?>
		</li>
	</ol>
<!-- FIN direccionamiento -->
</div>
<!-- END RIBBON -->
	

<!-- MAIN CONTENT -->
	<div id="content">
		<div class="row">
			<div class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
				<h1 class="page-title txt-color-blueDark">
					<!-- PAGE HEADER -->
					<i class="fa-fw fa fa-pencil-square-o"></i><?php echo $txt_01 ?> <span>> <?php echo $txt_03 ?></span>
				</h1>
			</div>
		</div>

		<!-- widget grid -->
		<section id="widget-grid" class="">
			<!-- START ROW -->
			<div class="row">
				<!-- NEW COL START -->
				<article class="col-sm-12 col-md-12 col-lg-12">
					<div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
						<header>
							<span class="widget-icon"> <i class="fa fa-edit"></i> </span>
							<h2><?php echo $txt_02 ?> ,  paso 01</h2>
						</header>
						<!-- widget div-->
						<div>
							<!-- widget edit box -->
							<div class="jarviswidget-editbox">
								<!-- This area used as dropdown edit box -->
							</div>
							<!-- end widget edit box -->
							<!-- widget content -->
							<div class="widget-body no-padding">


<!-- Formulario ingreso Peliculas -->
<form action="<?php echo $editFormAction; ?>" role="form" method="POST" name="form_ingreso" class="smart-form" enctype="multipart/form-data">
	<fieldset>
		<section>
			<label class="label">Seleccione tu imagen</label>

			<div class="input input-file">
				<span class="button">
					<input type="file" id="str_imagen" name="str_imagen" onchange="this.parentNode.nextSibling.value = this.value">Explorar
				</span><input type="text" placeholder="busque su archivo" readonly="">
			</div>

			<div class="note">
			<strong>Nota:</strong> Solo admite imágenes .jpg o .png.
			</div>

		</section>
	<fieldset>
		<output id="list"></output>
	</fieldset>

	</fieldset>

	<fieldset>
		<output id="list"></output>
	</fieldset>

	<footer>
		<input type="hidden" name="MM_update" value="form1">
		<input type="hidden" name="id_banner" id="id_banner" value="<?php $row_banner['id_banner']; ?>">
		<input name="str_imagen_nueva" type="hidden" value="<?php echo $row_banner['str_imagen']; ?>">
		<input name="submit" type="submit" id="submit" class="btn btn-primary" value="Continuar">
	</footer>
</form>
<!-- FIN Formulario ingreso peliculas -->
							</div>
							<!-- end widget content -->
						</div>
						<!-- end widget div -->
					</div>
					<!-- end widget -->
				</article>
				<!-- END COL -->
			</div>
			<!-- END ROW -->
		</section>
		<!-- end widget grid -->
</div>
<!-- END MAIN CONTENT -->
</div>
		
<!-- Scrip para mostrar la imagen antes de subirla -->	  
<!-- Scrip para mostrar la imagen antes de subirla -->
<!-- Scrip para mostrar la imagen antes de subirla -->	
	  
<script>
function archivo(evt) {
var files = evt.target.files; // FileList object
             
// Obtenemos la imagen del campo "file".
for (var i = 0, f; f = files[i]; i++) {
//Solo admitimos imágenes.
if (!f.type.match('image.*')) {
	continue;
}
             
var reader = new FileReader();
	
	reader.onload = (function(theFile) {
		return function(e) {

// Insertamos la imagen con este valor ajusto la imagen a un tamaño //// width="450" ////
			document.getElementById("list").innerHTML = ['<img class="thumb" width="700" src="', e.target.result,'" title="', escape(theFile.name), '"/>'].join('');
		};
	})(f);
	
	reader.readAsDataURL(f);
}
}
	document.getElementById('str_imagen').addEventListener('change', archivo, false);
	
</script>
	  
	  	  
<!-- FIN Scrip para mostrar la imagen antes de subirla -->	  
<!-- FIN Scrip para mostrar la imagen antes de subirla -->
<!-- FIN Scrip para mostrar la imagen antes de subirla -->
		
<!-- FIN PANEL -->
<!-- FIN PANEL -->
<!-- FIN PANEL -->
<!-- FIN PANEL -->
<!-- FIN PANEL -->
<!-- FIN PANEL -->
		
		
		
		
		
		
		
		<!-- FIN Panel central -->

		<!-- PAGE FOOTER -->
		<?php include("includes/footer.php"); ?>
		<!-- END PAGE FOOTER -->



		<!--================================================== -->

		<!-- PACE LOADER - turn this on if you want ajax loading to show (caution: uses lots of memory on iDevices)-->
		<script data-pace-options='{ "restartOnRequestAfter": true }' src="js/plugin/pace/pace.min.js"></script>

		<!-- Link to Google CDN's jQuery + jQueryUI; fall back to local -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script>
			if (!window.jQuery) {
				document.write('<script src="js/libs/jquery-3.2.1.min.js"><\/script>');
			}
		</script>

		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<script>
			if (!window.jQuery.ui) {
				document.write('<script src="js/libs/jquery-ui.min.js"><\/script>');
			}
		</script>

		<!-- IMPORTANT: APP CONFIG -->
		<script src="js/app.config.js"></script>

		<!-- JS TOUCH : include this plugin for mobile drag / drop touch events-->
		<script src="js/plugin/jquery-touch/jquery.ui.touch-punch.min.js"></script> 

		<!-- BOOTSTRAP JS -->
		<script src="js/bootstrap/bootstrap.min.js"></script>

		<!-- CUSTOM NOTIFICATION -->
		<script src="js/notification/SmartNotification.min.js"></script>

		<!-- JARVIS WIDGETS -->
		<script src="js/smartwidgets/jarvis.widget.min.js"></script>

		<!-- EASY PIE CHARTS -->
		<script src="js/plugin/easy-pie-chart/jquery.easy-pie-chart.min.js"></script>

		<!-- SPARKLINES -->
		<script src="js/plugin/sparkline/jquery.sparkline.min.js"></script>

		<!-- JQUERY VALIDATE -->
		<script src="js/plugin/jquery-validate/jquery.validate.min.js"></script>

		<!-- JQUERY MASKED INPUT -->
		<script src="js/plugin/masked-input/jquery.maskedinput.min.js"></script>

		<!-- JQUERY SELECT2 INPUT -->
		<script src="js/plugin/select2/select2.min.js"></script>

		<!-- JQUERY UI + Bootstrap Slider -->
		<script src="js/plugin/bootstrap-slider/bootstrap-slider.min.js"></script>

		<!-- browser msie issue fix -->
		<script src="js/plugin/msie-fix/jquery.mb.browser.min.js"></script>

		<!-- FastClick: For mobile devices -->
		<script src="js/plugin/fastclick/fastclick.min.js"></script>

		<!--[if IE 8]>

		<h1>Your browser is out of date, please update your browser by going to www.microsoft.com/download</h1>

		<![endif]-->

		<!-- Demo purpose only -->
		

		<!-- MAIN APP JS FILE -->
		<script src="js/app.min.js"></script>

		<!-- ENHANCEMENT PLUGINS : NOT A REQUIREMENT -->
		<!-- Voice command : plugin -->
		<script src="js/speech/voicecommand.min.js"></script>

		<!-- SmartChat UI : plugin -->
		<script src="js/smart-chat-ui/smart.chat.ui.min.js"></script>
		<script src="js/smart-chat-ui/smart.chat.manager.min.js"></script>
		
		<!-- PAGE RELATED PLUGIN(S) -->
		
		<!-- Flot Chart Plugin: Flot Engine, Flot Resizer, Flot Tooltip -->
		<script src="js/plugin/flot/jquery.flot.cust.min.js"></script>
		<script src="js/plugin/flot/jquery.flot.resize.min.js"></script>
		<script src="js/plugin/flot/jquery.flot.time.min.js"></script>
		<script src="js/plugin/flot/jquery.flot.tooltip.min.js"></script>
		
		<!-- Vector Maps Plugin: Vectormap engine, Vectormap language -->
		<script src="js/plugin/vectormap/jquery-jvectormap-1.2.2.min.js"></script>
		<script src="js/plugin/vectormap/jquery-jvectormap-world-mill-en.js"></script>
		
		<!-- Full Calendar -->
		<script src="js/plugin/moment/moment.min.js"></script>
		<script src="js/plugin/fullcalendar/fullcalendar.min.js"></script>


		<!-- Your GOOGLE ANALYTICS CODE Below -->

	</body>

</html>