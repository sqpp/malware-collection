<?php

require_once 'connection.php';
 if(isset($_FILES['uploaduser'])){
 $files = $_FILES['uploaduser'];
 $name = $files['name'];
 $tmpName = $files['tmp_name'];
 $size = $files['size'];
 $extension = explode('.', $files['name']);
 $extension = strtolower(end($extension));

$key = md5(uniqid());
 $tmp_file_name = "{$key}.{$extension}";
 $tmp_file_path = "files/{$tmp_file_name}";

move_uploaded_file($tmpName, $tmp_file_path);

try{
 $s3->putObject([
 'Bucket' => $config['bucket'],
 'Key' => "uploads-azeez/{$name}",
 'Body' => fopen($tmp_file_path, 'rb'),
 'ACL' => 'public-read'
 ]);
 //remove the file from local folder
 unlink($tmp_file_path);

} catch (\Aws\S3\Exception\S3Exception $ex){
 die("Error uploading the file to S3");
 }

header("Location: start.php");
 exit();

}else if(isset($_POST) && !empty($_POST)){
 $name = $_POST['key'];
 // Delete an object from the bucket.
 $s3->deleteObject([
 'Bucket' => $config['bucket'],
 'Key' => "$name"
 ]);
 }