<?php
require_once('dbconnection.php');
if(isset($_SESSION['user_id'])=='')
 {
   header("Location:login.php");
 } 
$id = $_GET['id'];
$sql = "SELECT * FROM video_gallery WHERE id='$id'";
$result_set =$conn->query($sql)->fetch(PDO::FETCH_ASSOC);
if($_SERVER['REQUEST_METHOD'] == 'POST')
{
   
   extract($_POST);
   $title = $_POST['title'];
   $video_link = $_POST['video_link'];
   $updateddate = date('Y-m-d');
   $file_name = $_FILES['filename']['name'];
   $im='';
   $image_upload='';
   if($file_name !='')
   {
         // print_r($_FILES);
         $filename  = time().basename($_FILES['filename']['name']);
         $file_size = $_FILES['filename']['size'];
         $file_tmp  = $_FILES['filename']['tmp_name'];
         $file_ext= pathinfo($filename, PATHINFO_EXTENSION);
         $extension  = array("jpeg","jpg","png");
        
          if(in_array($file_ext,$extension) === False)
          {
             echo "<script>alert('extension not allowed')</script>";
                echo "<script>window.location.href ='/balajigroup/admin/video_update.php?id=".$id ."';</script>";
                die;
             }
         
        
         
         if($file_size >= 20000000)
         {
            $error[] = "Please check your file size is large";
            echo "<script>alert('Please check your file size is large')</script>";
               echo "<script>window.location.href ='/balajigroup/admin/video_update.php?id=".$id ."';</script>";
               die;
            }
         $file_name= time()."_".$file_name; 
         move_uploaded_file($file_tmp,"uploads/".$file_name);
               
               if(isset($file_name) && $file_name!=='')
               {
                  $im =$file_name;
               }
            
      
   }
   if(empty($im)){
      echo "old_image:$old_image";
      $image_upload = $old_image;
      echo "image_upload:$image_upload";
   }else{
      $image_upload = $im;
      echo "im:$image_upload";
   }
   
   if(isset($image_upload))
         {
               $sql = "UPDATE video_gallery SET  `image`='$image_upload',title='$title',video_link='$video_link',updated_at='$updateddate' WHERE id='$id'";
               	$statement = $conn->prepare($sql);
                  
           if ($statement->execute() === TRUE)
               {
                        $_SESSION['message']= "updated successfully";
                         header("Location:video_table.php");
                        die();
               } 
                     
               $conn->close();
         }
          else
          {
               
            echo "<script>alert('".$error[0]."')</script>";
            
          }

}

?>

<?php include 'includes/header.php'; ?>
<section>
   <div class="container-fluid">
     
      <div class="row justify-content-center">
         <div class="col-md-10">

            <div class="card mb-12">
               <div><a style="margin-left:900px;margin-top:13px;"class="btn btn-outline-secondary" href="video_table.php"><i class="fal fa-chevron-left mr-1"></i>Back</a>
                  <div class="card-header">Video update</div>
               <div class="card-body">
                  <form action="" method="post" enctype="multipart/form-data">
                     <div class="row">
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Title</label>
                              <input type="hidden" name="old_image" value="<?php echo $result_set['image'];?>">
                              <input type="text" class="form-control" name="title" placeholder="Title name comes here" value="<?php echo $result_set["title"] ;?>">
                           </div>
                        </div>
                         <div class="col-md-12">
                           <div class="form-group">
                              <label>Image</label>
                              <img style="width:80px;height:80px;" src="uploads/<?php echo $result_set["image"];?>">
                              <input type="file" name="filename" class="form-control" id="filename" >
                             
                              <label><i>Note: file size should be(350*262) and 
                                          file Extension should be(jpg,jpeg,png)</i>
                              </label>
                           </div>
                        </div>
                       <div class="col-md-12">
                           <div class="form-group">
                              <label>Video</label>
                              <input type="text" name="video_link" id="video_link" placeholder="Title video text here" class="form-control" value="<?php echo $result_set["video_link"] ;?>"> <!-- <label><i>Note:please follow the image <img src="vhcoa/images/youtube.gif"></i>
                              </label> -->
                           </div>
                        </div>
                       
                        <div class="col-12">
                           <button type="reset" class="btn btn-secondary">Reset</button>
                           <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                     </div>
                  </form>
               </div>
           </div>
      </div>
   </div>
</section>

<?php include 'includes/footer.php'; ?>