<?php
include("topbit.php");

include("header.php");

?>

<script language="JavaScript">
function ValidateForm(){

	var fnameID=document.myName.firstname
	
	if ((fnameID.value==null)||(fnameID.value=="")||(fnameID.value=="First")){
		alert("Please add your childs first name")
		fnameID.focus()
		return false
	}
	
	var lnameID=document.myName.lastname
	
	if ((lnameID.value==null)||(lnameID.value=="")||(lnameID.value=="Last")){
		alert("Please add your childs last name")
		lnameID.focus()
		return false
	}

	
	
if(!document.myName.agree.checked){alert("Please confirm you are happy with the quanitites entered before adding to cart");
return false; }

return true
}

</script>


	
<script language="JavaScript">

  function ondalikSayiKontrol( alan ) {

    var msg=alan.value;
    var w;
    var nokta=msg.indexOf( "." );
    var ind;
  
    for ( w=0; w<msg.length; w++ )  {

      ind=msg.substring(w,w+1);
      if ( ind<"0" || ind>"9" )  {
    
           if ( nokta>0 )
             if ( w==nokta )  continue;    
       
           msg=msg.substring(0,w);
           alan.value=msg;
           break;           
      }

    }

  }
</script>


<SCRIPT LANGUAGE="JavaScript"><!--
function cent(amount) {
     return (amount == Math.floor(amount)) ? amount + '.00' : (  (amount*10 == Math.floor(amount*10)) ? amount + '0' : amount);
}

function total(what,number) {
    var grandTotal = 0;
    for (var i=0;i<number;i++) {
        if (what.elements['price' + i].value == '')
            what.elements['price' + i].value == '0.00'; // fix for Opera.
        grandTotal += (what.elements['price' + i].value - 0) * (what.elements['quantity' + i].value - 0);
    }
    what.grandTotal.value = cent(Math.round(grandTotal*Math.pow(10,2))/Math.pow(10,2));
}
//-->
</SCRIPT>

<?php

$theschoolsgradesid = $_POST["schoolsgradesid"];

$sql = "SELECT * FROM schoolsgrades where ID = '$theschoolsgradesid'";
$result = mysql_query($sql,db());

if ($myrow = mysql_fetch_array($result)) {
$thegradeid = $myrow["gradeid"];
$theschoolid = $myrow["schoolid"];
}

if ($thegradeid == 0) {
$thegradeid = "Prep";
}

if ($thegradeid == 13) {
$thegradeid = "7h";
}

$thepage = "";

include("topcode.php");
?>

<p>

<?php




$sql = "SELECT * FROM schools where ID = '$theschoolid'";
$result = mysql_query($sql,db());

if ($myrow = mysql_fetch_array($result)) {
$theschoolname = $myrow["name"];
$thegeneraltext = $myrow["generaltext"];

$answer1 = $thegeneraltext;
$answer2 = ereg_replace(  "\n", "<BR>", $answer1);
$thegeneraltext = $answer2;
}

$lines = 0;

$theclass = "Current Class";

if ($thegradeid == 0) {
$theclass = "Sibling Class";
}


echo "<h1>" . $theschoolname . " - Year Level " . $thegradeid . " " . $thesubject . "</h1>";

echo "<p>" . $thegeneraltext . "<br><br></p>";

$sql9 = "SELECT * FROM booklists where schoolgradeid = " . $theschoolsgradesid;
$result9 = mysql_query($sql9,db());

if ($myrow9 = mysql_fetch_array($result9)) {

?>
					
<form action=savehighschoolbookist.php method=post NAME="myName" onSubmit="return ValidateForm()">
	
<?php

if ($thegradeid == "Prep") {
$thegradeid = 0;
}

if ($thegradeid == "7h") {
$thegradeid = 13;
}


echo "<input type=hidden name=schoolid value=" . $theschoolid . ">";
echo "<input type=hidden name=gradeid value=" . $thegradeid . ">";

$theclass = "Current Class";

if ($thegradeid == 0) {
$theclass = "Sibling Class";
}

echo "<br><p><b><font color=" . $lineheader . ">Add Students Name</font></b></p><br>";
?>


<table>
<tr><td align=left valign=top width=180><p><b>First Name</b></p></td><td width=180 align=left valign=top><p><b>Last Name</b></p></td>
<td width=60 align=left valign=top></td><td width=160 align=center valign=top rowspan=2><img src=images/printer.gif border=0><br><p><b>

<?php

$extralink = "";

$sql = "SELECT * FROM subjects order by subject asc";
$result = mysql_query($sql,db());

if ($myrow = mysql_fetch_array($result)) {
do
{
$id=$myrow["ID"];

$thesubject = $_POST["subjectid" .$id];

if ($thesubject == "Y") {
$extralink = $extralink . "&subjectid" . $id . "=" . $thesubject;
}

}
while ($myrow = mysql_fetch_array($result));
}

?>

<a href=printerfriendlyversionhigh.php?schoolid=<?php echo $theschoolid . "&gradeid=" . $thegradeid . $extralink . " target=_blank>Printer Friendly Version</b></p></a><br><br></td></tr>";?>
</tr>

<tr><td align=left valign=top><INPUT TYPE=TEXT NAME="firstname" SIZE=20><br><br></td><td align=left valign=top><INPUT TYPE=TEXT NAME="lastname" SIZE=20></td>

<?php

	//echo "<td width=140 align=left valign=top><INPUT TYPE=TEXT NAME=currentclass SIZE=5 maxlength=8></td>";

?>
</tr>
</table>

<?php

$sql = "SELECT * FROM subjects order by subject asc";
$result = mysql_query($sql,db());

if ($myrow = mysql_fetch_array($result)) {
do
{
$thename=$myrow["subject"];
$id=$myrow["ID"];

$thesubject = $_POST["subjectid" .$id];

if ($thesubject == "Y") {

$sql5 = "SELECT * FROM booklists where schoolgradeid = " . $theschoolsgradesid . " and subjectid=" . $id;
$result5 = mysql_query($sql5,db());

//$sql5 = "SELECT * FROM booklists where schoolgradeid = " . $theschoolsgradesid;
//$result5 = mysql_query($sql5,db());

if ($myrow5 = mysql_fetch_array($result5)) {
do
{
// count the lines

$lines = $lines + 1;

}
while ($myrow5 = mysql_fetch_array($result5));
}

}

}
while ($myrow = mysql_fetch_array($result));
}



$linestotal = $lines;
$totalprice = 0;
$countlines = 0;
$lines = 0;

echo "<table width=662 border=0 cellpadding=3 cellspacing=0>";
echo "<tr bgcolor=" . $lineheader . "><td width=480 align=left valign=top><p><b>Item</b></p></td><td align=left valign=top><p><b>Qty</b></td><td width=80 align=right valign=top><p><b>Item Price</b></p></td></tr>";

$sql = "SELECT * FROM subjects order by subject asc";
$result = mysql_query($sql,db());

if ($myrow = mysql_fetch_array($result)) {
do
{
$thename=$myrow["subject"];
$id=$myrow["ID"];


$thesubject = $_POST["subjectid" .$id];

if ($thesubject == "Y") {
	
$sql5 = "SELECT * FROM booklists where schoolgradeid = " . $theschoolsgradesid . " and carryover = 'No' and subjectid=" . $id . " order by listorder,ID asc";
$result5 = mysql_query($sql5,db());



echo "<tr  bgcolor=#ababab><td align=left valign=top colspan=3><p><b>" . $thename . "</b></p></td></tr>";

if ($myrow5 = mysql_fetch_array($result5)) {
do
			{
			$theproductid = $myrow5["productid"];
			$theid = $myrow5["ID"];
			$theqty = $myrow5["qty"];
			$thecarryover = $myrow5["carryover"];

$sql4 = "SELECT * FROM products where ID = " . $theproductid;
$result4 = mysql_query($sql4,db());

if ($myrow4 = mysql_fetch_array($result4)) {
	$theproductname = $myrow4["producttitle"];
	$theprice = $myrow4["price"];
}

if ($countlines == 1) {
	$bgcolor = "#FFFFFF";
	$countlines = 0;
} else {
	$bgcolor = $linealternate;
	$countlines = $countlines + 1;
}

$lineprice = $theqty * $theprice;

$totalprice = $totalprice + $lineprice;

?>
<tr bgcolor=<?php echo $bgcolor ?>><td width=480 align=left valign=top><p><?php echo $theproductname ?></p></td><td align=left valign=top><input type=text name="quantity<?php echo $lines ?>" size=3 value="<?php echo $theqty ?>"  onChange="total(this.form, <?php echo $linestotal ?>)"  onKeyUp='ondalikSayiKontrol(this)' maxlength=2></td><td width=80 align=right valign=top><p><b><input type=hidden NAME="price<?php echo $lines ?>" VALUE="<?php echo number_format($theprice,2) ?>" ><input type=hidden NAME="prodid<?php echo $lines ?>" VALUE="<?php echo $theproductid ?>" ><input type=hidden NAME="subject<?php echo $lines ?>" VALUE="<?php echo $id ?>" > $<?php echo number_format($theprice,2) ?></b></p></td></tr>
<?php

$lines = $lines + 1;

}
while ($myrow5 = mysql_fetch_array($result5));
}


} // subjects

}
while ($myrow = mysql_fetch_array($result));
} else {

echo "No Products have been assigned to this subject.";
}



//carry over items

echo "<tr><td width=662 align=left valign=top colspan=3><p><b><br></b></p></td></tr>";


$sql = "SELECT * FROM subjects order by subject asc";
$result = mysql_query($sql,db());

if ($myrow = mysql_fetch_array($result)) {
do
{
$thename=$myrow["subject"];
$id=$myrow["ID"];

$thesubject = $_POST["subjectid" .$id];

if ($thesubject == "Y") {
	
$sql5 = "SELECT * FROM booklists where schoolgradeid = " . $theschoolsgradesid . " and carryover = 'Yes' and subjectid=" . $id . " order by listorder,ID asc";
$result5 = mysql_query($sql5,db());

if ($myrow5 = mysql_fetch_array($result5)) {
	
echo "<tr  bgcolor=#ababab><td align=left valign=top colspan=3><p><b>" . $thename . "</b></p></td></tr>";
do
			{
			$theproductid = $myrow5["productid"];
			$theid = $myrow5["ID"];
			$theqty = $myrow5["qty"];
			$thecarryover = $myrow5["carryover"];

$sql4 = "SELECT * FROM products where ID = " . $theproductid;
$result4 = mysql_query($sql4,db());

if ($myrow4 = mysql_fetch_array($result4)) {
	$theproductname = $myrow4["producttitle"];
	$theprice = $myrow4["price"];
}

if ($countlines == 1) {
	$bgcolor = "#FFFFFF";
	$countlines = 0;
} else {
	$bgcolor = $linealternate;
	$countlines = $countlines + 1;
}

$lineprice = $theqty * $theprice;

$totalprice = $totalprice + $lineprice;

?>
<tr bgcolor=<?php echo $bgcolor ?>><td width=480 align=left valign=top><p><?php echo $theproductname ?></p></td><td align=left valign=top><input type=text name="quantity<?php echo $lines ?>" size=3 value="<?php echo $theqty ?>"  onChange="total(this.form, <?php echo $linestotal ?>)"  onKeyUp='ondalikSayiKontrol(this)' maxlength=2></td><td width=80 align=right valign=top><p><b><input type=hidden NAME="price<?php echo $lines ?>" VALUE="<?php echo number_format($theprice,2) ?>" ><input type=hidden NAME="prodid<?php echo $lines ?>" VALUE="<?php echo $theproductid ?>" ><input type=hidden NAME="subject<?php echo $lines ?>" VALUE="<?php echo $id ?>" > $<?php echo number_format($theprice,2) ?></b></p></td></tr>

<?php

$lines = $lines + 1;

}
while ($myrow5 = mysql_fetch_array($result5));
}


} // subjects

}
while ($myrow = mysql_fetch_array($result));
}




?>
<tr bgcolor=<?php echo $lineheader; ?>><td width=480 align=left valign=top></td><td align=left valign=top><p><b>Total</b></p></td><td width=80 align=right valign=top><INPUT TYPE=TEXT NAME="grandTotal" SIZE=6 value="<?php echo number_format($totalprice,2) ?>" READONLY></td></tr>
</table>

<br><br>

<table>
<tr><td align=left colspan=3 valign=top><p>
<input type=checkbox name=agree value=Yes> I am happy with the quantities I have entered above.<br><br>
<?php

echo "<input type=hidden name=totallines value=" . $lines . ">";
?>
<INPUT TYPE="SUBMIT" VALUE="Add to Cart" NAME="submit" class='btn' ></td></tr>

</table>
</form>

<?php
} else {
	
echo "<br><p>This school and grade are not currently available.<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>";
}
?>

</p>
<?php

include("sidebar.php");

include("footer.php");

?>