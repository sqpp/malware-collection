<?php
session_start();
define( '_JEXEC', 1 );
define( 'JPATH_BASE', realpath(dirname(__FILE__).'/..' ));
require_once ( JPATH_BASE. '/includes/defines.php' );
require_once ( JPATH_BASE. '/includes/framework.php' );
header ('Content-type: text/html; charset=utf-8');
header ('Content-type: multipart/form-data');
require_once("class/csCompania.php");
require_once("class/csCategorias.php");
require_once("class/csSubcategorias.php");
require_once("class/csReportes.php");
require_once("class/csReporteParametros.php");
require_once("class/csSolicitudReportes.php");
require_once("class/csReportesGenerados.php");
require_once("class/csPeticiones.php");
require_once("class/csUsuariosJoomla.php");
require_once("class/csMultiCompania.php");
require_once("class/csConfParametros.php");
require_once("class/csGrupos.php");
require_once("class/csCategSubcate.php");
require_once("class/csIdiomaTexto.php");
require_once("class/csComentarios.php");
require_once("class/csReportesCargados.php");
require_once("class/csDatosEstadisticos.php");
require_once("class/csEncriptarDesencriptar.php");
require_once("class/csDashboardMiPortalSap.php");
require_once("class/BasedeDatos.php");
require_once("class/PHPMailer.php");

$mainframe = JFactory::getApplication('site');
$mainframe->initialise();
$session = JFactory::getSession();
$user = JFactory::getUser();
$lang = JFactory::getLanguage();
$variable = $lang->getTag();
//ini_set( 'display_errors', true );
//error_reporting(E_ALL);

$languageName = "";
if(isset($_SESSION["IdiomaCode"])){
  $languageName = $_SESSION["IdiomaCode"];
}
$Idioma = "";
switch($languageName){
  case "en":
    $Idioma = "EN";					
    break;
  case "es":
    $Idioma = "ES";
    break;
  default:
    $Idioma = "ES";
    break;
}

$oTraducir = new IdiomaTexto();
$oTraducir->IdPagina = "Funciones";
$oTraducir->IdIdioma = $Idioma;

$Opc = $_POST["opc"];

switch($Opc)
{
  case 'CargarMenu':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["cia"];
    $TipUsua = $_POST["tipus"];
    $Grp = $_POST["grp"];
    $Rep = $_POST["rep"];
    $oCate = new CategSubcate();
    $oSubCate = new CategSubcate();
    $oRepo = new Reportes();
    $oCate->IdCia = $IdCia;
    $oCate->getCateReportes($TipUsua, $Grp);
    if($oCate->Error == false){
      if($oCate->Cant > 0){
        $salida .= "<ul>";
        for($i = 0; $i < $oCate->Cant; $i++){
          $salida .= "<li class='lstReportes'>";
          $salida .= $oCate->lstCategorias[$i]["CategoriaDescripcion"];
          $oSubCate->IdCia = $IdCia;
          $oSubCate->CategoriaCodigo = $oCate->lstCategorias[$i]["CategoriaCodigo"];
          $oSubCate->getSubCateReportes($TipUsua, $Grp);
          if($oSubCate->Error == false){
            if($oSubCate->Cant > 0){
              //$salida .= "<ul>";
              for($j=0; $j < $oSubCate->Cant; $j++){
                //$salida .= "<li class='lstReportes'>";
                //$salida .= $oSubCate->lstCategorias[$j]["SubCategoriaDescripcion"];
                $oRepo->IdCia = $IdCia;
                $oRepo->TipoUsuario = $TipUsua;
                $oRepo->Grupo = $Grp;
                $oRepo->CodCategoria = $oCate->lstCategorias[$i]["CategoriaCodigo"];
                $oRepo->CodSubCategoria = $oSubCate->lstCategorias[$j]["SubCategoriaCodigo"];
                $oRepo->getReportesTipoUsGrupoCateSubc();
                if($oRepo->Error == false){
                  if($oRepo->Cant > 0){
                    $salida .= "<ul>";
                    for($r = 0; $r < $oRepo->Cant; $r++){
                      $salida .= "<li><a href='#Rep_".$oCate->lstCategorias[$i]["CategoriaCodigo"]."_".$oSubCate->lstCategorias[$j]["SubCategoriaCodigo"]."_".$oRepo->lstReportes[$r]["IdReporte"]."' class='csReporte' rep='".$oRepo->lstReportes[$r]["IdReporte"]."' data-toggle='modal' data-target='#ModalParametros'>&nbsp;&nbsp;&nbsp;&nbsp;<div class='glyphicon glyphicon-list-alt' aria-hidden='true'></div>&nbsp;".$oRepo->lstReportes[$r]["NomReporte"]."</a></li>";
                    }
                    $salida .= "</ul>";
                  }
                  else{
                    $salida .= $oTraducir->Traducir("Fun01")." ".$oRepo->Msg;
                  }
                }
                else{
                  $salida .= $oTraducir->Traducir("Fun02");
                }
                //$salida .= "</li>";
              }
              //$salida .= "</ul>";
            }
            else{
              $salida .= $oTraducir->Traducir("Fun03");
            }
          }
          else{
            $salida .= $oTraducir->Traducir("Fun04");
          }
          $salida .= "</li>";
        }
        $salida .= "</ul>";
      }
      else{
        $salida = $oTraducir->Traducir("Fun05");
      }
    }
    else{
      $salida = $oTraducir->Traducir("Fun06");
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
    
  case 'CargarMenu_NuevoPortalSAP':
    $response = array();
    
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["cia"];
    $TipUsua = $_POST["tipus"];
    $Grp = $_POST["grp"];
    $Rep = $_POST["rep"];
    $oCate = new CategSubcate();
    $oSubCate = new CategSubcate();
    $oRepo = new Reportes();
    $oCate->IdCia = $IdCia;
    $oCate->getCateReportes($TipUsua, $Grp);
    if($oCate->Error == false){
      if($oCate->Cant > 0){
        for($i = 0; $i < $oCate->Cant; $i++){
          //$salida .= "<li class='lstReportes'>";
          //$salida .= $oCate->lstCategorias[$i]["CategoriaDescripcion"];
          
          $categoria = new stdClass();
          $categoria->categoria = $oCate->lstCategorias[$i]["CategoriaDescripcion"];
          
          $reportes = array();
          
          $oSubCate->IdCia = $IdCia;
          $oSubCate->CategoriaCodigo = $oCate->lstCategorias[$i]["CategoriaCodigo"];
          $oSubCate->getSubCateReportes($TipUsua, $Grp);
          if($oSubCate->Error == false){
            if($oSubCate->Cant > 0){
              for($j=0; $j < $oSubCate->Cant; $j++){
                $oRepo->IdCia = $IdCia;
                $oRepo->TipoUsuario = $TipUsua;
                $oRepo->Grupo = $Grp;
                $oRepo->CodCategoria = $oCate->lstCategorias[$i]["CategoriaCodigo"];
                $oRepo->CodSubCategoria = $oSubCate->lstCategorias[$j]["SubCategoriaCodigo"];
                $oRepo->getReportesTipoUsGrupoCateSubc();
                if($oRepo->Error == false){
                  if($oRepo->Cant > 0){
                    for($r = 0; $r < $oRepo->Cant; $r++){
                        $report = new stdClass();
                        $report->CategoriaCodigo = $oCate->lstCategorias[$i]["CategoriaCodigo"];
                        $report->SubCategoriaCodigo = $oSubCate->lstCategorias[$j]["SubCategoriaCodigo"];
                        $report->IdReporte = $oRepo->lstReportes[$r]["IdReporte"];
                        $report->NomReporte = $oRepo->lstReportes[$r]["NomReporte"];
                        
                        array_push($reportes, $report);
                    }
                    
                  }
                  else{
                    //$salida .= $oTraducir->Traducir("Fun01")." ".$oRepo->Msg;
                  }
                }
                else{
                  //$salida .= $oTraducir->Traducir("Fun02");
                }
                //$salida .= "</li>";
              }
              //$salida .= "</ul>";
            }
            else{
              //$salida .= $oTraducir->Traducir("Fun03");
            }
          }
          else{
            //$salida .= $oTraducir->Traducir("Fun04");
          }
          $categoria->reportes =  $reportes;
          array_push($response, $categoria);
        }
        //$salida .= "</ul>";
      }
      else{
        //$salida = $oTraducir->Traducir("Fun05");
      }
    }
    else{
      //$salida = $oTraducir->Traducir("Fun06");
    }
    //$arrResultado[0] = "OK";
    //$arrResultado[1] = $salida;
    echo json_encode($response);
    break;
    
    
  case 'CargarMenu_Ant':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["cia"];
    $TipUsua = $_POST["tipus"];
    $Grp = $_POST["grp"];
    $oCate = new Categorias();
    $oSubCate = new Subcategorias();
    $oRepo = new Reportes();
    
    $oCate->IdCia = $IdCia;
    $oCate->getReportes($TipUsua, $Grp);
    if($oCate->Error == false){
      if($oCate->Cant > 0){
        $salida .= "<ul>";
        for($i = 0; $i < $oCate->Cant; $i++){
          $salida .= "<li class='lstReportes'>";
          $salida .= $oCate->lstCategorias[$i]["Descripcion"];
          $oSubCate->IdCia = $IdCia;
          $oSubCate->CodCategoria = $oCate->lstCategorias[$i]["CodCategoria"];
          $oSubCate->getCateCia();
          if($oSubCate->Error == false){
            if($oSubCate->Cant > 0){
              $salida .= "<ul>";
              for($j=0; $j < $oSubCate->Cant; $j++){
                $salida .= "<li class='lstReportes'>";
                $salida .= $oSubCate->lstSubCategorias[$j]["Descripcion"];
                $oRepo->IdCia = $IdCia;
                $oRepo->TipoUsuario = $TipUsua;
                $oRepo->Grupo = $Grp;
                $oRepo->CodCategoria = $oCate->lstCategorias[$i]["CodCategoria"];
                $oRepo->CodSubCategoria = $oSubCate->lstSubCategorias[$j]["CodSubCategoria"];
                $oRepo->getReportesTipoUsGrupoCateSubc();
                if($oRepo->Error == false){
                  if($oRepo->Cant > 0){
                    $salida .= "<ul>";
                    for($r = 0; $r < $oRepo->Cant; $r++){
                      $salida .= "<li><a href='#Rep_".$oCate->lstCategorias[$i]["CodCategoria"]."_".$oSubCate->lstSubCategorias[$j]["CodSubCategoria"]."_".$oRepo->lstReportes[$r]["IdReporte"]."' class='csReporte' rep='".$oRepo->lstReportes[$r]["IdReporte"]."'>&nbsp;&nbsp;&nbsp;&nbsp;<div class='glyphicon glyphicon-list-alt' aria-hidden='true'></div>&nbsp;".$oRepo->lstReportes[$r]["NomReporte"]."</a></li>";
                    }
                    $salida .= "</ul>";
                  }
                }
                $salida .= "</li>";
              }
              $salida .= "</ul>";
            }
          }
          $salida .= "</li>";
        }
        $salida .= "</ul>";
      }
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'CargarParamReporte':
    $arrResultado = array();
    $salida = "";
    $salidaTab = "";
    $IdCia = $_POST["cia"];
    $Rep = $_POST["rep"];
    $iParam = 0;
    $vlPrueba = "";
    $oUser = new Usuario();
    $oUser->IdUsuario = $_POST["idus"];
    $oUser->getActivo();
    $NomBtnGen = $oTraducir->Traducir("Fun55");
    $TxtParam = $oTraducir->Traducir("Fun54");
    $oParamR = new ReporteParametros();
    $oParamR->IdCia = $IdCia;
    $oParamR->IdReporte = $Rep;
    if($_POST["prb"] == 0){
      $oParamR->getParamNoForzados();
    }else{
      $oParamR->getAllReporte();
    }
    if($oParamR->Error == false){
      if($oParamR->Cant > 0){
        for($i = 0; $i < $oParamR->Cant; $i++){
          if($_POST["prb"] == 0){
            $vlPrueba = "";
          }else{
            $vlPrueba = "value='".$oParamR->lstParametros[$i]["VlrPrueba"]."'";
          }
          $salida .= "<div class='form-group'>";
          $salidaTab .= "<div class='form-group'>";
          $salida .= "<label class='control-label col-md-2'>".$oParamR->lstParametros[$i]["Descripcion"]."</label>";
          $salidaTab .= "<label class='control-label col-md-2'>".$oParamR->lstParametros[$i]["Descripcion"]."</label>";
          $salida .= "<div class='col-md-8'>";
          $salidaTab .= "<div class='col-md-8'>";
          switch($oParamR->lstParametros[$i]["TipoCampo"]){
            case "F":
              $salida .= "<input type='date' class='form-control' id='Param_".$i."' idParam='".$oParamR->lstParametros[$i]["IdParametro"]."' />";
              $salidaTab .= "<input type='date' class='form-control' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
              break;
            case "C":
              $salida .= "<input type='text' class='form-control' id='Param_".$i."' idParam='".$oParamR->lstParametros[$i]["IdParametro"]."' />";
              $salidaTab .= "<input type='text' class='form-control' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
              break;
            case "N":
              $salida .= "<input type='number' class='form-control' id='Param_".$i."' idParam='".$oParamR->lstParametros[$i]["IdParametro"]."' />";
              $salidaTab .= "<input type='number' class='form-control' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
              break;
            default:
              $salidaTab .= "<input type='text' class='form-control' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
          }
          $salida .= "</div></div>";
          $salidaTab .= "</div></div>";
          $iParam = $oParamR->Cant;
        }
      }
      else{
        $salida .= "<div class='form-group'><p class='form-control-static'>".$TxtParam."</p></div>";
        $salidaTab .= "<div class='form-group'><p class='form-control-static'>".$TxtParam."</p></div>";
      }
    }
    $salida .= "<div class='form-group'><div class='col-md-2 col-md-offset-2'><input type='button' class='btn btn-default' value='".$NomBtnGen."' id='btnGenerar' cantParam='".$iParam."' rep='".$Rep."' /></div></div>";
    $salidaTab .= "<div class='form-group'><div class='col-md-2 col-md-offset-2'><input type='button' class='btn btn-default' value='".$NomBtnGen."' id='TabbtnGenerar' TabcantParam='".$iParam."' Tabrep='".$Rep."' /></div></div>";

    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = $salidaTab;
    $arrResultado[3] = $iParam;
    echo json_encode($arrResultado);
    break;
  case 'GenerarSolicitudReporte':
    $arrResultado = array();
    $arrCpos = array();
    $arrDtos = array();
    $salida = "";
    $IdCia = $_POST["cia"];
    $Usua = $_POST["us"];
    $Repo = $_POST["rep"];
    $Cpos = $_POST["cpos"];
    $Dtos = $_POST["dtos"];
    if($Cpos != ""){
      $arrCpos = explode(";", $Cpos);
      $arrDtos = explode(";", $Dtos);
      $CantP = count($arrCpos);
    }
    else{
      $CantP = 0;
    }
    $oSolicRep = new SolicitudReportes();
    $oSolicRep->sigId();
    $nSolicitud = $oSolicRep->Cant;
    $oSolicRep->IdSolicitud = $oSolicRep->Cant;
    $oSolicRep->IdCia = $IdCia;
    $oSolicRep->IdUsuario = $Usua;
    $oSolicRep->IdReporte = $Repo;
    $oSolicRep->CantParametros = $CantP;
    $oSolicRep->Parametro0 = ($CantP > 0) ? $arrDtos[0] : "";
    $oSolicRep->Parametro1 = ($CantP > 1) ? $arrDtos[1] : "";
    $oSolicRep->Parametro2 = ($CantP > 2) ? $arrDtos[2] : "";
    $oSolicRep->Parametro3 = ($CantP > 3) ? $arrDtos[3] : "";
    $oSolicRep->Parametro4 = ($CantP > 4) ? $arrDtos[4] : "";
    $oSolicRep->Parametro5 = ($CantP > 5) ? $arrDtos[5] : "";
    $oSolicRep->Parametro6 = ($CantP > 6) ? $arrDtos[6] : "";
    $oSolicRep->Parametro7 = ($CantP > 7) ? $arrDtos[7] : "";
    $oSolicRep->Parametro8 = ($CantP > 8) ? $arrDtos[8] : "";
    $oSolicRep->Parametro9 = ($CantP > 9) ? $arrDtos[9] : "";
    $oSolicRep->Estado = 0;
    $oSolicRep->add();
    if($oSolicRep->Error == false){
      $oCia = new Compania();
      $oCia->IdCia = $IdCia;
      $oCia->get();
      $oPeti = new Peticiones();
      $oPeti->sigId();
      $oPeti->IdPeticion = $oPeti->Cant;
      $oPeti->NitCia = $oCia->NitCia;
      $oPeti->CodVerificacion = $oCia->CodVerificacion;
      $oPeti->TipoPeticion = 2; 
      $oPeti->add();
      if($oPeti->Error == false){
        $salida = $oTraducir->Traducir("Fun07");
      }
      else{
        $salida = $oTraducir->Traducir("Fun08")." ".$oPeti->Msg;
      }
    }
    else{
      $salida = $oTraducir->Traducir("Fun09");
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = $nSolicitud;
    echo json_encode($arrResultado);
    break;
  case 'CargarRepPend':
    $arrResultado = array();
    $salida = "";
    $salidaTab = "";
    $iContRep = 1;
    $IdCia = $_POST["cia"];
    $Usua = $_POST["us"];
    $oUser = new Usuario();
    $oUser->IdUsuario = $Usua;
  	$oUser->getActivo();
    if($Idioma == "ES"){
      $Estado1 = "Solicitud Enviada";
      $Estado2 = "En Proceso";
    }
    else{
      $Estado1 = "Request sent";
      $Estado2 = "In process";
    }
    $oRepo = new Reportes();
    $oRepo->IdCia = $IdCia;
    $oSolicRep = new SolicitudReportes();
    $oSolicRep->IdCia = $IdCia;
    $oSolicRep->IdUsuario = $Usua;
    $oSolicRep->getUsEnProceso();
    if($oSolicRep->Error == false){
      if($oSolicRep->Cant > 0){
        for($i = 0; $i < $oSolicRep->Cant; $i++){
          $salida .= "<tr>";
          $salidaTab .= "<tr>";
          $salida .= "<td>".$iContRep."</td>";
          $salidaTab .= "<td>".$iContRep."</td>";
          $salida .= "<td>".$oSolicRep->lstSolicitudes[$i]["FechaSolicitud"]."</td>";
          $salidaTab .= "<td>".$oSolicRep->lstSolicitudes[$i]["FechaSolicitud"]."</td>";
          $oRepo->IdReporte = $oSolicRep->lstSolicitudes[$i]["IdReporte"];
          $oRepo->get();
          $salida .= "<td>".$oRepo->NomReporte."</td>";
          $salidaTab .= "<td>".$oRepo->NomReporte."</td>";
          if($oSolicRep->lstSolicitudes[$i]["Estado"] == 0){
            $salida .= "<td>".$Estado1."&nbsp;&nbsp;&nbsp;";
            $salidaTab .= "<td>".$Estado1."&nbsp;&nbsp;&nbsp;";
          }
          else{
            $salida .= "<td>".$Estado2."&nbsp;&nbsp;&nbsp;";
            $salidaTab .= "<td>".$Estado2."&nbsp;&nbsp;&nbsp;";
          }
          $salida .= "<button id='Rep_".$i."' rep='".$oRepo->NomReporte."' idRep='".$oSolicRep->lstSolicitudes[$i]["IdReporte"]."' tipRep='C' class='btn btn-default csBtnEliminarP'><img src='../img/icon_delete.png' /></button></td>";
          $salidaTab .= "<button id='TabRep_".$i."' Tabrep='".$oRepo->NomReporte."' TabidRep='".$oSolicRep->lstSolicitudes[$i]["IdSolicitud"]."' TabtipRep='C' class='btn btn-default csBtnEliminarP'><img src='../img/icon_delete.png' /></button></td>";
          $salida .= "</tr>";
          $salidaTab .= "</tr>";
          $iContRep++;
        }
      }
    }

    $oReportes = new Reportes();
    $oReportes->IdCia = $IdCia;

    $oSolicitud = new SolicitudReportes();
    $oSolicitud->IdCia = $IdCia;
    
    $pruebahora = "";

    $oRepGen = new ReportesGenerados();
    $oRepGen->IdCia = $IdCia;
    $oRepGen->IdUsuario = $Usua;
    $oRepGen->getCiaUsua();
    if($oRepGen->Error == false){
      if($oRepGen->Cant > 0){
        for($i = 0; $i < $oRepGen->Cant; $i++){
          $salida .= "<tr>";
          $salidaTab .= "<tr>";
          $salida .= "<td>".$iContRep."</td>";
          $salidaTab .= "<td>".$iContRep."</td>";
          $salida .= "<td><b>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</b></td>";
          $salidaTab .= "<td><b>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</b></td>";
          $salida .= "<td><b>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</b></td>";
          $salidaTab .= "<td><b>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</b></td>";
          $salida .= "<td><button id='Rep_".$i."' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png' /></button>";
          $salidaTab .= "<td><a href='https://www.miportalsap.com/app_portal/pags/detalle_reporte_generado.php?nomFile=".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."&IdCia=".$IdCia."&IdUsuario=".$Usua."' target='_blank' id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png' /></a>";
          $salida .= "<button id='Rep_".$i."' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnEliminar'><img src='../img/icon_delete.png' /></button></td>";
          $salidaTab .= "<button id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnEliminar'><img src='../img/icon_delete.png' /></button></td>";

          $fecha_generacion = $oRepGen->lstSolicitudes[$i]["FechaGenerado"];
          $fecha_actual = date('Y-m-d H:i:s');
          $dteStart = new DateTime($fecha_generacion); 
          $dteEnd   = new DateTime($fecha_actual); 
          $dteDiff  = $dteStart->diff($dteEnd); 
          $pruebahora += $dteDiff->format("%Y");
          $pruebahora += $dteDiff->format("%M");
          $pruebahora += $dteDiff->format("%D");
          $pruebahora += $dteDiff->format("%H"); //la hora del servidor php esta 5 horas adelantada con la hora de colombia 
          $pruebahora += $dteDiff->format("%I");
          
          $idSolicitud = $oRepGen->lstSolicitudes[$i]["IdSolicitud"];
          $oSolicitud->IdSolicitud = $idSolicitud;
          $oSolicitud->get();
          $oReportes->IdReporte = $oSolicitud->IdReporte;
          $oReportes->get();
          //menor que 10 porque el servidor php esta adelantado 5 horas, para que se cumplan los minutos DFC 09/03/18
          if($oReportes->EsPayU == 1 && $pruebahora <= 10 ) 
          {
            // Espacio Columna Comentarios
            $salida .= "<td></td>";
            $salidaTab .= "<td></td>";

            $salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            if($oUser->IdUsuario == 1057 || $oUser->IdUsuario == 1166)
            {
              // Carga botón PayPal    
              $salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              
              // Carga botón Paymentez
              //$salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'>Pagar con Paymentez</button></td>";
              //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'>Pagar con Paymentez</button></td>";
            }
          }
          
          if($oReportes->EsPaymentez == 1 && $pruebahora <= 10 ) {
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            
            // Carga botón PayPal    
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";

            // Carga botón Paymentez
            $salidaTab .= "<td></td>";
            // Carga botón Paymentez
            $salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/Boton-Seleccionar.png' /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/Boton-Seleccionar.png'/></button></td>";
          }
          
          $salida .= "</tr>";
          $salidaTab .= "</tr>";
          $iContRep++;
        }
      }
    }

    $oReportes = new Reportes();
    $oReportes->IdCia = $IdCia;

    $oSolicitud = new SolicitudReportes();
    $oSolicitud->IdCia = $IdCia;

    $oRepGen = new ReportesGenerados();
    $oRepGen->IdCia = $IdCia;
    $oRepGen->IdUsuario = $Usua;
    $oRepGen->getCiaUsuaGdos();
    if($oRepGen->Error == false){
      if($oRepGen->Cant > 0){
        for($i = 0; $i < $oRepGen->Cant; $i++){
          $salida .= "<tr>";
					$salidaTab .= "<tr>";
					$salida .= "<td>".$iContRep."</td>";
					$salidaTab .= "<td>".$iContRep."</td>";
					$salida .= "<td>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</td>";
					$salidaTab .= "<td>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</td>";
					$salida .= "<td>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</td>";
					$salidaTab .= "<td>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</td>";
					$salidaTab .= "<td><a href='https://www.miportalsap.com/app_portal/pags/detalle_reporte_generado.php?nomFile=".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."&IdCia=".$IdCia."&IdUsuario=".$Usua."' target='_blank' id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png' /></a><button id='TabDescRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' imgBtn='imgBtn_".$i."'  class='btn btn-azul csBtnDescargar'><img src='../img/descargar.png' class='styleimgBtn' id='imgBtn_".$i."' /></button>";
					// if ($oRepGen->lstSolicitudes[$i]["TipoReporte"] == "C") {
					// 	$salidaTab .= "<button id='TabExcelRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' imgBtn='imgBtnExcel_".$i."'  class='csBtnDescExcel' title='Descargalo en Excel'><img src='../img/iconoExcel.png' class='styleimgBtn' id='imgBtnExcel_".$i."' /></button>";
          // }
					$salidaTab .= "</td>";
          $salidaTab .= "<td><a class='IconoComment' href='#' data-toggle='modal' data-target='#ModalComentarios' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' NomRep='".$oRepGen->lstSolicitudes[$i]["NomReporte"]."' ><img src='../img/iconoComment2.png'></a></td>";
          
          $fecha_generacion = $oRepGen->lstSolicitudes[$i]["FechaGenerado"];
          $fecha_actual = date('Y-m-d H:i:s');

          $dteStart = new DateTime($fecha_generacion); 
          $dteEnd   = new DateTime($fecha_actual); 
          
          $dteDiff  = $dteStart->diff($dteEnd); 
          
          $pruebahora += $dteDiff->format("%Y");
          $pruebahora += $dteDiff->format("%M");
          $pruebahora += $dteDiff->format("%D");
          $pruebahora += $dteDiff->format("%H"); //la hora del servidor php esta 5 horas adelantada con la hora de colombia 
          $pruebahora += $dteDiff->format("%I");
          

          $idSolicitud = $oRepGen->lstSolicitudes[$i]["IdSolicitud"];
          $oSolicitud->IdSolicitud = $idSolicitud;
          $oSolicitud->get();
          $oReportes->IdReporte = $oSolicitud->IdReporte;
          $oReportes->get();
          //menor que 10 porque el servidor php esta adelantado 5 horas, para que se cumplan los minutos DFC 09/03/18
          
          if($oReportes->EsPayU == 1 && $pruebahora <= 10 ) 
          {
            $salidaTab .= "<td></td>";
            $salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
          
            if($oUser->IdUsuario == 1057 || $oUser->IdUsuario == 1166)
            {
              // Carga botón PayPal       
              // $salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              // $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              
              // Carga botón Paymentez
              // $salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/mastercard.png' width=100 height=25 /></button></td>";
              // $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/mastercard.png' width=100 height=25 /></button></td>";
            }
          }
          
          if($oReportes->EsPaymentez == 1 && $pruebahora <= 10 ) 
          {
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
          
            // Carga botón PayPal       
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              
            // Carga botón Paymentez
            $salidaTab .= "<td></td>";
            $salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/BotonMasteCard.png' /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/BotonMasteCard.png' /></button></td>"; 
          }
          

          $salida .= "</tr>";
          $salidaTab .= "</tr>";
          $iContRep++;
        }
      }
      else{
        $salida .= "<tr><td>&nbsp;</td><td colspan='3'>2 ".$TxtNoList."</td></tr>";
        $salidaTab .= "<tr><td>&nbsp;</td><td colspan='3'>2 ".$TxtNoList."</td></tr>";
      }
    }
  
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = $salidaTab;
    echo json_encode($arrResultado);
  	break;
  
  case 'CargarRepPendPr':
    $arrResultado = array();
    $salidaTab = "";
    $iContRep = 1;
    $IdCia = $_POST["cia"];
    $Usua = $_POST["us"];
    $numVrPr = $_POST["nvpr"];
    $idReporte = 0;
    $estadoSol = 0;
    $oUser = new Usuario();
    $oUser->IdUsuario = $Usua;
    $oUser->getActivo();
    if($Idioma == "ES"){
      $TxtNoList = "No hay reportes pendientes por visualizar";
      $Estado1 = "Solicitud Enviada";
      $Estado2 = "En Proceso";
    }
    else{
      $TxtNoList = "There isn’t pending reports to visualized";
      $Estado1 = "Request sent";
      $Estado2 = "In process";
    }
    $oRepo = new Reportes();
    $oRepo->IdCia = $IdCia;
    $oSolicRep = new SolicitudReportes();
    $oSolicRep->IdSolicitud = $numVrPr;
    $oSolicRep->get();
    if($oSolicRep->Error == false){
      if($oSolicRep->Cant > 0){
      if($oSolicRep->Estado < 2){
      $idSolicitud = 0;
      $salidaTab .= "<tr>";
      $salidaTab .= "<td>".$iContRep."</td>";
      $salidaTab .= "<td>".$oSolicRep->FechaSolicitud."</td>";
      $oRepo->IdReporte = $oSolicRep->IdReporte;
      $oRepo->get();
      $salidaTab .= "<td>".$oRepo->NomReporte."</td>";
      if($oSolicRep->Estado == 0){
        $salidaTab .= "<td>".$Estado1."&nbsp;&nbsp;&nbsp;";
      }
      else{
        $salidaTab .= "<td>".$Estado2."&nbsp;&nbsp;&nbsp;";
      }
      $salidaTab .= "<button id='TabRepElimP_0' Tabrep='".$oRepo->NomReporte."' TabidRep='".$oSolicRep->IdSolicitud."' TabtipRep='C' class='btn btn-default csBtnEliminarP'><img src='../img/icon_delete.png' /></button></td>";
      $salidaTab .= "</tr>";
      }else{
      $idSolicitud = $numVrPr;
      $estadoSol = $oSolicRep->Estado;
      }
      if($idSolicitud != 0){
      $oReportes = new Reportes();
      $oReportes->IdCia = $IdCia;
    
      $oSolicitud = new SolicitudReportes();
      $oSolicitud->IdCia = $IdCia;
      
      $pruebahora = "";

      $oRepGen = new ReportesGenerados();
      $oRepGen->IdSolicitud = $idSolicitud;
      $oRepGen->getSolicitud();
      if($oRepGen->Error == false){
        if($oRepGen->Cant > 0){
          if($oRepGen->Estado < 3){
            $salidaTab .= "<tr>";
            $salidaTab .= "<td>".$iContRep."</td>";
            $salidaTab .= "<td><b>".$oRepGen->FechaGenerado."</b></td>";
            $salidaTab .= "<td><b>".$oRepGen->NomReporte."</b></td>";
            $salidaTab .= "<td><button id='TabRepVis_0' Tabrep='".$oRepGen->NomArchivo."' TabidRep='".$oRepGen->IdRepGenerado."' TabtipRep='".$oRepGen->TipoReporte."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png' /></button>";
            $salidaTab .= "<button id='TabRepElim_0' Tabrep='".$oRepGen->NomArchivo."' TabidRep='".$oRepGen->IdRepGenerado."' TabtipRep='".$oRepGen->TipoReporte."' class='btn btn-default csBtnEliminar'><img src='../img/icon_delete.png' /></button></td>"; 
          }

          $fecha_generacion = $oRepGen->FechaGenerado;
          $fecha_actual = date('Y-m-d H:i:s');
          $dteStart = new DateTime($fecha_generacion); 
          $dteEnd   = new DateTime($fecha_actual); 
          $dteDiff  = $dteStart->diff($dteEnd); 
          $pruebahora += $dteDiff->format("%Y");
          $pruebahora += $dteDiff->format("%M");
          $pruebahora += $dteDiff->format("%D");
          $pruebahora += $dteDiff->format("%H"); //la hora del servidor php esta 5 horas adelantada con la hora de colombia 
          $pruebahora += $dteDiff->format("%I");
          
          $idSolicitud = $oRepGen->IdSolicitud;
          $oSolicitud->IdSolicitud = $idSolicitud;
          $oSolicitud->get();
          $oReportes->IdReporte = $oSolicitud->IdReporte;
          $oReportes->get();
          //menor que 10 porque el servidor php esta adelantado 5 horas, para que se cumplan los minutos DFC 09/03/18
          if($oReportes->EsPayU == 1 && $pruebahora <= 10 ) 
          {
            $salidaTab .= "<td></td>";
            $salidaTab .= "<td><button id='TabRepPayu_0' tipoPago='payU' Tabrep='".$oRepGen->NomArchivo."' TabidRep='".$oRepGen->IdRepGenerado."' TabtipRep='".$oRepGen->TipoReporte."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            
            if($oUser->IdUsuario == 1057 || $oUser->IdUsuario == 1166)
            {
              $salidaTab .= "<td><button id='TabRepPayu_0' tipoPago='payPal' Tabrep='".$oRepGen->NomArchivo."' TabidRep='".$oRepGen->IdRepGenerado."' TabtipRep='".$oRepGen->TipoReporte."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
                
            }
          }
          
          if($oReportes->EsPaymentez == 1 && $pruebahora <= 10 ) 
          {
            $salidaTab .= "<td></td>";
            //$salidaTab .= "<td><button id='TabRepPayu_0' tipoPago='payPal' Tabrep='".$oRepGen->NomArchivo."' TabidRep='".$oRepGen->IdRepGenerado."' TabtipRep='".$oRepGen->TipoReporte."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
            $salidaTab .= "<td><button id='TabRepPayu_0' tipoPago='paymentez' Tabrep='".$oRepGen->NomArchivo."' TabidRep='".$oRepGen->IdRepGenerado."' TabtipRep='".$oRepGen->TipoReporte."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/BotonMasterCard.png' /></button></td>";  
          }
          
          $salidaTab .= "</tr>";
          $iContRep++;
        }
        else{
        if($salida == ""){
          $salidaTab .= "<tr><td>&nbsp;</td><td colspan='3'>1 ".$TxtNoList."</td></tr>";
        }
        }
      }
      }
        }
      }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $estadoSol; 
    $arrResultado[2] = $salidaTab;
    echo json_encode($arrResultado);
    break;   

  case 'CargarRepGdos':
    $arrResultado = array();
    $salida = "";
    $salidaTab = "";
    $IdCia = $_POST["cia"];
    $Usua = $_POST["us"];
    $oRepGen = new ReportesGenerados();
    $oRepGen->IdCia = $IdCia;
    $oRepGen->IdUsuario = $Usua;
    $oRepGen->getCiaUsuaGdos();
    if($oRepGen->Error == false){
      if($oRepGen->Cant > 0){
        for($i = 0; $i < $oRepGen->Cant; $i++){
          $salida .= "<tr>";
          $salidaTab .= "<tr>";
          $salida .= "<td>".($i + 1)."</td>";
          $salidaTab .= "<td>".($i + 1)."</td>";
          //$salida .= "<td>".$oRepGen->lstSolicitudes[$i]["IdSolicitud"]."</td>";
          $salida .= "<td>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</td>";
          $salidaTab .= "<td>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</td>";
          $salida .= "<td>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</td>";
          $salidaTab .= "<td>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</td>";
          $salida .= "<td><button id='Rep_".$i."' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png' /></button><button id='DescRep_".$i."' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-azul csBtnDescargar'><img src='../img/descargar.png' /></button></td>";
          $salidaTab .= "<td><button id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png' /></button><button id='TabDescRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-azul csBtnDescargar'><img src='../img/descargar.png' /></button></td>";
          $salida .= "</tr>";
          $salidaTab .= "</tr>";
        }
      }
      else{
        $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun10")."</td></tr>";
        $salidaTab .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun11")."</td></tr>";
      }
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = $salidaTab;
    echo json_encode($arrResultado);
    break;
  case 'EstadoReporteVisualizado':
    $arrResultado = array();
    $salida = "";
    $Rep = $_POST["irep"];
    $oRepGen = new ReportesGenerados();
    $oRepGen->IdRepGenerado = $Rep;
    $oRepGen->Estado = 1;
    $oRepGen->updateEstado();
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'EstadoReporteEliminado':
    $arrResultado = array();
    $salida = "";
    $Rep = $_POST["irep"];
    $oRepGen = new ReportesGenerados();
    $oRepGen->IdRepGenerado = $Rep;
    $oRepGen->Estado = 3;
    $oRepGen->updateEstado();
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'EstadoSolReporteEliminado':
    $arrResultado = array();
    $salida = "";
    $Rep = $_POST["irep"];
    $oSolicRep = new SolicitudReportes();
    $oSolicRep->IdSolicitud = $Rep;
    $oSolicRep->Estado = 3;
    $oSolicRep->updateEstado();
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'MostrarReporteTxt':
    $arrResultado = array();
    $arrNomb = array();
    $arrInfo = array();
    $arrCabecs = array();
    $arrCabec = array();
    $arrDatos = array();
    $arrDato = array();
    $encabezado = "";
    $registros = "";
    $iCantCols = 0;
    $iCantFil = 0;
    $uploads_dir = './archivos_pdf';
    $rutaTxt = $uploads_dir."/".$_POST["NomArch"];
    if (file_exists($rutaTxt)) {
      $InfoTxt = file_get_contents($rutaTxt);
      if($InfoTxt != ""){
        $arrInfo = json_decode($InfoTxt, true);
        
        $arrNomb = array_keys($arrInfo[0]);
        $encabezado = "<tr>";
        foreach ($arrNomb as $key => $value) {
          $encabezado .= "<th>$value</th>";
          $iCantCols++;
        }
        $encabezado .= "</tr>";
        foreach ($arrInfo as $value) {
          $registros .= "<tr>";
          for ($i=0; $i < $iCantCols; $i++) { 
            $registros .= "<td>".$value[$arrNomb[$i]]."</td>";
          }
          $registros .= "</tr>";
        }
      }
    }

    $arrResultado[0] = "OK";
    $arrResultado[1] = $encabezado;
    $arrResultado[2] = $registros;
    //$arrResultado[2] = $arrInfo;
    $arrResultado[3] = $rutaTxt;
    echo json_encode($arrResultado);
    break;
  case 'VerificarCia':
    $arrResultado = array();
    $Resp = "OK";
    $NomCia = "";
    $IdCia = "";
    $IdUsua = "";
    $NitCiaSDV = $_POST["nit"];
    $CodVeri = $_POST["codv"];
    $Correo = $_POST["us"];

    $NitCia = $NitCiaSDV; //.'-'.calcularDV($NitCiaSDV);
    if($Correo != ""){
      $oUsua = new Usuario();
      $oUsua->Correo = $Correo;
      $oUsua->NitCia = $NitCia;
      $oUsua->CodVerificacion = $CodVeri;
      $oUsua->getCorreoNitCodVer();
      if($oUsua->Error == false){
        if($oUsua->Cant == 1){
          if($oUsua->NitCia == $NitCia && $oUsua->CodVerificacion == $CodVeri){
            $Resp = $oTraducir->Traducir("Fun12");
            $IdUsua = "";
          }
          else{
            $oUsua->Correo = $Correo;
            $oUsua->getCorreo();
            $IdUsua = $oUsua->IdUsuario;
          }
        }
        else{
          $oUsua->Correo = $Correo;
          $oUsua->getCorreo();
          $IdUsua = $oUsua->IdUsuario;
        }
      }
    }
    else{
      $IdUsua = "N";
    }
    if($IdUsua != ""){
      $oCia = new Compania();
      $oCia->NitCia = $NitCia;
      $oCia->CodVerificacion = $CodVeri;
      $oCia->getCiaNitCodV();
      if($oCia->Error == false){
        if($oCia->Cant == 1){
          if($oCia->Estado == 1){
            $NomCia = $oCia->NomCia;
            $IdCia = $oCia->IdCia;
          }
          else{
        $oUsua2 = new Usuario();
            $oUsua2->IdCia = $oCia->IdCia;
            $oUsua2->Estado = 1;
            $oUsua2->getAllIdCia();
            if($oUsua2->Cant == 0){
          $Resp = "RegistrarAdm";
          $IdCia = $oCia->IdCia;
          $NomCia = $oCia->NomCia;
            }
            else{
              $Resp = $oTraducir->Traducir("Fun13");
              $IdCia = "";
            }
          }
        }
        else{
          $Resp = $oTraducir->Traducir("Fun14")." ".$NitCia;
          $IdCia = "";
        }
      }
    }
    if($IdCia != ""){
      $oMulti = new MultiCompania();
      $oMulti->IdUsua = $IdUsua;
      $oMulti->IdCia = $IdCia;
      $oMulti->getUsCia();
      if($oMulti->Error == false){
        if($oMulti->Cant == 1){
          $Resp = $oTraducir->Traducir("Fun12");
        }
      }
    }

    $arrResultado[0] = $Resp;
    $arrResultado[1] = $NomCia;
    $arrResultado[2] = $IdUsua;
    $arrResultado[3] = $IdCia;
    $arrResultado[4] = $IdUsua;
    //$arrResultado[1] = $oUsua->Msg;
    echo json_encode($arrResultado);
    break;
  case 'VerificarUsuario':
    $arrResultado = array();
    $Resp = "OK";
    $Usuario = $_POST["usu"];
    $oUsua = new Usuario();
    $oUsua->Usuario = $Usuario;
    $oUsua->verificarUsuario();
    if($oUsua->Error == false){
      if($oUsua->Cant == 1){
        $Resp = $oTraducir->Traducir("Fun15");
      }
      else{
        $Resp = "OK";
      }
    }
    else{
      $Resp = $oTraducir->Traducir("Fun16");
    }

    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'VerificarCorreo':
    $arrResultado = array();
    $Resp = "OK";
    $IdUs = 0;
    $Nom = "";
    $Correo = $_POST["cor"];
    $oUsua = new Usuario();
    $oUsua->Correo = $Correo;
    $oUsua->verificarCorreo();
    if($oUsua->Error == false){
      if($oUsua->Cant == 1){
        $IdUs = $oUsua->IdUsuario;
        $Nom = $oUsua->Nombre;
        $Resp = $oTraducir->Traducir("Fun17");
      }
      else{
        $Resp = "OK";
      }
    }
    else{
      $Resp = $oTraducir->Traducir("Fun16");
    }

    $arrResultado[0] = $Resp;
    $arrResultado[1] = $IdUs;
    $arrResultado[2] = $Nom;
    echo json_encode($arrResultado);
    break;
  case 'ObtenerDatosUsuario':
      $arrresultado = array();
      $Correo = $_POST["cor"];
      $oUsua = new Usuario();
      $oUsua->Correo = $Correo;
      $oUsua->getCorreo();
      $arrResultado[0] = $oUsua->Cant;
      $arrResultado[1] = $oUsua->Registros;
      $arrResultado[3] = $oUsua->Msg;
      $oEncDec = new EncriptarDesencriptar();
      $arrResultado[2] = $oEncDec->decryptIt($oUsua->Clave);
      echo json_encode($arrResultado);
      break;
  case 'ValidarUsuMultiCia':
    $arrResultado = array();
    $Resp = "OK";
    $idUsu = $_POST["idUsu"];
    $idCia = $_POST["idCia"];
    $UsuMultiCia = new MultiCompania();
    $UsuMultiCia->IdUsuario = $idUsu;
    $UsuMultiCia->IdCia = $idCia;
    $UsuMultiCia->getUsCia();
    if ($UsuMultiCia->Cant == 1) {
      $Resp = $oTraducir->Traducir("Fun56");
    }else{
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'AgregarCia':
    $arrResultado = array();
  	$Resp = "OK";
  	$grpUsu = "-1";
    $IdUsua = $_POST["idusu"];
    $IdCia = $_POST["idcia"];

  	if($_POST["codv"] == "0"){
			$grpUsu = $_POST["grpUsu"];
			$oCia = new Compania();
			$oCia->IdCia = $IdCia;
      $oCia->get();
      
			if ($oCia->Cant == 1) {
        $CodVeri = $oCia->CodVerificacion;
        $NitCiaSDV = $oCia->NitCia;
        
			} else{
        $CodVeri = 0;
        $NitCiaSDV = "";
      }
      
		}else{
			$CodVeri = $_POST["codv"];
			$NitCiaSDV = $_POST["nit"];
		}
			$IdClie = $_POST["idecl"];
			$NomClie = $_POST["nomcl"];
			$NroIdent = $_POST["nroid"];
			$TipoUs = $_POST["tipusu"];
			$InSitu = $_POST["insitu"];
			$NitCia = $NitCiaSDV; //.'-'.calcularDV($NitCiaSDV);
			$oMulti = new MultiCompania();
			$oMulti->IdUsuario = $IdUsua;
			$oMulti->IdCia = $IdCia;
			$oMulti->IdCliente = $IdClie;
			$oMulti->NomCliente = $NomClie;
			$oMulti->NroIdentificacion = $NroIdent;
			$oMulti->TipoUsuario = $TipoUs;
			$oMulti->InSitu = $InSitu;
		  $oMulti->Grupo = $grpUsu;
		  $oMulti->Cargo = $_POST["cargo"];
		  $oMulti->DescrpCargo = $_POST["descrpCargo"];
			$oMulti->add();
			if($oMulti->Error == true){
				$Resp = $oTraducir->Traducir("Fun18")." ".$oMulti->Msg;
			}
			else{
			if ($_POST["codv"] == "0") {
			$oMulti->Estado = "4";
			$oMulti->usoAppSoliTras = 0;
			$oMulti->Param0 = $_POST["param0"];
			$oMulti->Param1 = $_POST["param1"];
			$oMulti->Param2 = $_POST["param2"];
			$oMulti->Param3 = $_POST["param3"];
			$oMulti->Param4 = $_POST["param4"];
			$oMulti->Param5 = $_POST["param5"];
			$oMulti->Param6 = $_POST["param6"];
			$oMulti->Param7 = $_POST["param7"];
			$oMulti->Param8 = $_POST["param8"];
			$oMulti->Param9 = $_POST["param9"];
			$oMulti->UsuarioActualiza = 0;
			$oMulti->update();
			if($oMulti->Error == true){
				$Resp = $oTraducir->Traducir("NO SE PUDIERON AGREGAR LOS PARAMETROS ")." ".$oMulti->Msg;
			}
    }
      $oCia = new Compania();
      $oCia->IdCia = $IdCia;
      $oCia->get();
      if($oCia->Cant == 1){
        if($oCia->UsuarioReg == $IdUsua){
          $oMulti->IdUsuario = $IdUsua;
          $oMulti->IdCia = $IdCia;
          $oMulti->Estado = 1;
          $oMulti->updateEstado();
        }
      }
      $oPeti = new Peticiones();
      $oPeti->sigId();
      $oPeti->IdPeticion = $oPeti->Cant;
      $oPeti->NitCia = $NitCia;
      $oPeti->CodVerificacion = $CodVeri;
      $oPeti->TipoPeticion = 1;
      $oPeti->add();

    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'agregarMasiva':
		$arrResultado = array();
		$Resp = "OK";
		$IdCia = $_POST["idcia"];
    $Idioma = $_POST['idioma'];
		$arrString = $_POST["datosJson"];
		$Salida = "";
		$contError = 0;
			$contCant = 0;
			$cantProcess = 0;
		$arrayRespuesta = array();

		$oCia = new Compania();
		$oCia->IdCia = $IdCia;
		$oCia->get();
		if ($oCia->Cant == 1) {
			$CodVeri = $oCia->CodVerificacion;
			$NitCiaSDV = $oCia->NitCia;
		}
		$objDatos = json_decode($arrString, true);

		foreach ($objDatos["arrayDatos"] as $key => $value) {
			$arrayRespuesta[$contCant][0] = $value["email"];
			$arrayRespuesta[$contCant][1] = "";
			$email = $value["email"];
			$nomUs = $value["nomUs"];
			$NomCia = $value["nomCia"];
			$NitCia = $value["NitCia"];
			$TipoUs = $value["TipoUs"];
			$grpUs = $value["grpUs"];
			$coSoNeg = $value["coSoNeg"];
			$nit = $value["nit"];
			$empVem = $value["empVen"];
			$almacen = $value["almacen"];
			$ifrs = $value["ifrs"];
			$ciudad = $value["ciudad"];
			$telef = $value["telef"];
			$Param7 = $value["Param7"];
			$Param8 = $value["Param8"];
			$Param9 = $value["Param9"];
			$clave = rand();

			$oUsua = new Usuario();
			$oUsua->Correo = $email;
			$oUsua->verificarCorreo();
			if($oUsua->Error == false){
			if($oUsua->Cant == 1){
				$IdUsu = $oUsua->IdUsuario;
			}
			else{
				$Resp = "OK";
				$oUsua->Nombre = $nomUs;
				$oUsua->Usuario = $email;
				$oUsua->Correo = $email;
				$oUsua->Clave = $clave;
				$oUsua->AdicionarJoomla();
				if ($oUsua->Error == true) {
					$IdUsu = "";
					$arrayRespuesta[$contCant][1] .= " (".$oTraducir->Traducir("ErrIngreUser") .".),";  
					$contError ++;
				}else{
					$IdUsu = $oUsua->IdUsuario;
				}
				}
				$oMulti = new MultiCompania();
				$oMulti->IdUsuario = $IdUsu;
				$oMulti->IdCia = $IdCia;
				$oMulti->getUsCia();
				if ($oMulti->Cant == 1) {
				$arrayRespuesta[$contCant][1] .= " (".$oTraducir->Traducir("ErrExisUser") .".),";
				$contError ++;
				}else{
				$NomClie = $NomCia;
				$NroIdent = "";
				$TipoUs = $TipoUs;
				$InSitu = "";
				$NitCia = $NitCia;
				$oMulti = new MultiCompania();
				$oMulti->IdUsuario = $IdUsu;
				$oMulti->IdCia = $IdCia;
				$oMulti->IdCliente = $NitCia;
				$oMulti->NomCliente = $nomUs;
				$oMulti->NroIdentificacion = $NroIdent;
				$oMulti->TipoUsuario = $TipoUs;
				$oMulti->InSitu = $InSitu;
				$oMulti->Grupo = $grpUs;
				$oMulti->add();
				if($oMulti->Error == true){
					$Resp = $oTraducir->Traducir("Fun18")." ".$oMulti->Msg;
					$arrayRespuesta[$contCant][1] .= " (".$oTraducir->Traducir("ErrInserUser") .".),"; 
					$contError ++;
				}
				else{
					$oMulti->Estado = "0";
					$oMulti->Param0 = $coSoNeg;
					$oMulti->Param1 = $nit;
					$oMulti->Param2 = $empVem;
					$oMulti->Param3 = $almacen;
					$oMulti->Param4 = $ifrs;
					$oMulti->Param5 = $ciudad;
					$oMulti->Param6 = $telef;
					$oMulti->Param7 = $Param7;
					$oMulti->Param8 = $Param8;
          $oMulti->Param9 = $Param9;
          $oMulti->usoAppSoliTras = "0";
          $oMulti->usoAppConsensus = "0";
					$oMulti->UsuarioActualiza = 0;
					$oMulti->update();
					if($oMulti->Error == true){
					$arrayRespuesta[$contCant][1] .= " (".$oTraducir->Traducir("ErrUpdateUser") .".),"; 
					$contError ++;
					}else{
					$Resp = "si se pudo";
					}
					$oCia = new Compania();
					$oCia->IdCia = $IdCia;
					$oCia->get();
					if($oCia->Cant == 1){
					if($oCia->UsuarioReg == $IdUsu){
						$oMulti->IdUsuario = $IdUsu;
						$oMulti->IdCia = $IdCia;
						$oMulti->Estado = 1;
						$oMulti->updateEstado();
						if($oMulti->Error == true){
						$arrayRespuesta[$contCant][1] .= " (".$oTraducir->Traducir("ErrUpdateEstado") .".),";  
						$contError ++;
						}
					}
					}
				}
				if ($contError == 0) {
					$UsuMultiCia = new MultiCompania();
					$UsuMultiCia->IdUsuario = $IdUsu;
					$UsuMultiCia->IdCia = $IdCia;
					$UsuMultiCia->updateToken();
					$UsuMultiCia->getUsCia();
					$token = $UsuMultiCia->token;

					$ObjDatosCia = new Compania();
					$ObjDatosCia->IdCia = $IdCia;
					$ObjDatosCia->get();

					$mail = new PHPMailer();

					$mail->CharSet = 'UTF-8';

					$mail->setFrom('noresponder@miportalsap.com', 'MiPortalSap ');

					$mail->addAddress($email, 'Correo: ');

					$mail->Subject  = $oTraducir->Traducir("ActivaCuentaMiPortal");  

					$mail->IsHTML(true);

					$cuerpo = '<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
          <head>
            <meta charset="UTF-8">
            <meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <style type="text/css">
            #IdBody{
              background-image: url(https://www.miportalsap.com/app_portal/img/css30anios.jpg);
              background-position: center;
              background-size: cover;
              background-repeat: no-repeat;
              background-color: #cfd6e4;
              font-family: Arial, Helvetica, sans-serif;
            }
            .contendorInfo{
              box-shadow: 14px 15px 69px -10px #d0c1c1;
              background-color: rgba(255,255,255,0.9);
              max-width: 968px;
              margin: auto;
            }
            .contendorInfo h1{
              background-color: #111f3e;
              color: #fff;
              padding: 14px 25px;
              text-align: center;
            }
            .infoEmail img{
              width: 200px;
            }
            .infoEmail{
              padding: 25px 95px;
            }
            .infoEmail p{
              font-size: 18px;
              letter-spacing: 1px;
              line-height: 28px;
            }
            .aBtnActivar{
              background-color: #efbd3d;
              border-color: #111f3e;
              padding: 9px 22px;
              font-size: 14px;
              font-weight: 700;
              color: #111f3e;
              border-radius: 9px;
              text-decoration: none;
              text-transform: uppercase;
              box-shadow: -1px 4px 3px 0px #e6e6;
            }
            .aBtnActivar:hover{
              box-shadow: 0px 0px 0px 0px #e6e6;
          
            }
            .footerInfo{
              background-color: #111f3e;
              color: #fff;
              padding: 2px 25px 14px;
              text-align: center;
            }
            .footerInfo p a{
              color: #cfd6e4;
              text-decoration: none;
            }
          
            /*****  @medias Querys responsive **************/ 
            @media(max-width:992px){
              .contendorInfo{
              max-width: 75%;
              }
              .infoEmail {
              padding: 25px 30px;
              }
            }
            @media(max-width:620px){
              .contendorInfo{
              max-width: 95%;
              }
            }
            </style>
          </head>
          <body id="IdBody">
            <div class="contendorInfo">
            <h1>'.$oTraducir->Traducir("ActivaCuentaMiPortal").'</h1>
            <div class="infoEmail">
              <!--<img src="https://www.miportalsap.com/images/logo-css-sap-pq.png" style="width: 200px;">-->
              <h2>'.$oTraducir->Traducir("h2Email").' : </h2>
              <h3>'.$oTraducir->Traducir("h3Email_P1").' '.$ObjDatosCia->NomCia.' '.$oTraducir->Traducir("h3Email_P2").' '.$ObjDatosCia->NitCia.' '.$oTraducir->Traducir("h3Email_P3").'</h3>
              <h3>'.$oTraducir->Traducir("h3Email_P4").'.</h3><br><br>
              <a href="https://www.miportalsap.com/app_portal/pags/reg_activa_usuario.php?tok='.$token.'" target="_blank" class="aBtnActivar">'.$oTraducir->Traducir("ActivCuenta").'</a> <br> 
              <p>'.$oTraducir->Traducir("pEmail_P1").' (loT)</p>
            </div>
            <div class="footerInfo">
              <p>'.$oTraducir->Traducir("pEmail_P2").':  <a href="http://www.consensussap.com/">www.consensussap.com</a></p>
              <em>&copy;2020 - Consensus S.A.S - '.$oTraducir->Traducir("AllReserEmail").'.</em> 
            </div>
            </div>	
          </body>
          </html>';

					$mail->Body = $cuerpo;
				
					if ($mail->send()) {
					$arrayRespuesta[$contCant][1] .= $oTraducir->Traducir("SuccessProceExito");  
					}
					else{
					$arrayRespuesta[$contCant][1] .= $oTraducir->Traducir("ErrSendEmail");  
					}
				}
				}
				$contCant ++;
				$contError = 0;
			}
			else{
			$Resp = $oTraducir->Traducir("Fun16");
				}
				$arrResultado[1] = $cantProcess++;
		}

		for ($i=0; $i < $contCant; $i++) { 
			$Salida .= "<tr>";
			$Salida .= "<td>".($i + 1)."</td>";
			$Salida .= "<td>".$arrayRespuesta[$i][0]."</td>";
			$Salida .= "<td>".$arrayRespuesta[$i][1]."</td>";
			$Salida .= "</tr>";
		}

		$arrResultado[0] = $Salida;
			echo json_encode($arrResultado);
			break;
  case 'GetTotalUser':
    $arrResultado = array();
    $IdCia = $_POST["IdCia"];
    $ObjTotUser = new MultiCompania();
    $ObjTotUser->IdCia = $IdCia;
    $ObjTotUser->getTotalUser();
    $arrResultado[0] = $ObjTotUser->cantUser;
    echo json_encode($arrResultado);
    break;
  case 'AgregarUsuario':
    $arrResultado = array();
    $Resp = "Algo Pasa";
    $IdUsu = "";
    $NomUsua = $_POST["nom"];
    $Usua = $_POST["usu"];
    $Correo = $_POST["cor"];
    $Clave = $_POST["psw"];
    $oUsua = new Usuario();
    $oUsua->Nombre = $NomUsua;
    $oUsua->Usuario = $Usua;
    $oUsua->Correo = $Correo;
    $oUsua->Clave = $Clave;
    if (isset($_POST["tipoportal"])) {
        $oEncDec = new EncriptarDesencriptar();
        $oUsua->Clave = $oEncDec->encryptIt($Clave);
        $oUsua->AdicionarJoomla2();
    } else {
        $oUsua->AdicionarJoomla();
    }
    if($oUsua->Error == true){
      $Resp = $oTraducir->Traducir("Fun19")." ".$oUsua->Msg;
    }
    else{
      $Resp = "OK";
      $IdUsu = $oUsua->IdUsuario;
    }
    $arrResultado[0] = $Resp;
    $arrResultado[1] = $IdUsu;
    echo json_encode($arrResultado);
    break;
  case 'AgregarUsuarioNuevo':
    $arrResultado = array();
    $Resp = "Algo Pasa";
    $IdUsu = "";
    $NomUsua = $_POST["nom"];
    $Usua = $_POST["usu"];
    $Correo = $_POST["cor"];
    $Clave = $_POST["psw"];
    $oUsua = new Usuario();
    $oUsua->Nombre = $NomUsua;
    $oUsua->Usuario = $Usua;
    $oUsua->Correo = $Correo;
    $oUsua->Clave = $Clave;
    $oEncDec = new EncriptarDesencriptar();
    $oUsua->Clave = $oEncDec->encryptIt($Clave);
    $oUsua->AdicionarJoomla2();
    if($oUsua->Error == true){
      $Resp = $oTraducir->Traducir("Fun19")." ".$oUsua->Msg;
    }
    else{
      $Resp = "OK";
      $IdUsu = $oUsua->IdUsuario;
    }
    $arrResultado[0] = $Resp;
    $arrResultado[1] = $IdUsu;
    echo json_encode($arrResultado);
    break;
  case 'ComboCias':
    $arrResultado = array();
    $salida = "<option value='-1'>Seleccione Compañía</option>";
    $Correo = $_POST["us"];
    $oCia = new Compania();
    $oUsua = new Usuario();
    $oUsua->Correo = $Correo;
    $oUsua->getAllCorreo();
    if($oUsua->Error == false){
      for($i = 0; $i < $oUsua->Cant; $i++){
        $oCia->NitCia = $oUsua->lstUsuario[$i]["NitCia"];
        $oCia->CodVerificacion = $oUsua->lstUsuario[$i]["CodVerificacion"];
        $oCia->getCiaNitCodV();
        if($oCia->Error == false){
          if($oCia->Cant == 1){
            $IdCia = $oCia->IdCia;
            $salida .= "<option value='".$oCia->IdCia."'>".$oCia->NomCia."</option>";
          }
        }
      }
    }

    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = "Algo pasa ".$oUsua->Msg;
    echo json_encode($arrResultado);
    break;
  case 'ConsultarCia':
    $arrResultado = array();
    $Result = "OK";
    $IdCia = $_POST["idcia"];
    $IdUsua = $_POST["idus"];
    $TipoUs = "-1";
    $Grupo = "-1";
    $NomCia = "nnnnnn";
    $LogoCia = "";
    $BannerCia = "";
    $checkPayU = 0;
    $NitPay = "";
    $Dominio = "";
    $AcepInsert = 0;
    $AcepUpdate = 0;
    $AcepDelete = 0;
    $oMulti = new MultiCompania();
    $oMulti->IdUsuario = $IdUsua;
    $oMulti->IdCia = $IdCia;
    $oMulti->getUsCia();
    if($oMulti->Error == false){
      if($oMulti->Cant == 1){
        $TipoUs = $oMulti->TipoUsuario;
        $Grupo = $oMulti->Grupo;
        $oCia = new Compania();
        $oCia->IdCia = $IdCia;
        $oCia->get();
        if($oCia->Error == false){
          $NomCia = $oCia->NomCia;
          $LogoCia = $oCia->LogoCia;
          $BannerCia = $oCia->Banner;
          $checkPayU = $oCia->checkPayU;
          $NitPay = $oCia->NitCia;
          $Dominio = $oCia->Dominio;
          $AcepInsert = $oCia->AcepInsert;
          $AcepUpdate = $oCia->AcepUpdate;
          $AcepDelete = $oCia->AcepDelete;
          $_SESSION["Dominio"] = $oCia->Dominio;
          $_SESSION["IdCSS"] = $oCia->Estilos;
          $oMulti->predeterminarCia();
        }
        else{
          $Result = $oTraducir->Traducir("Fun20");
        }
      }
      else{
        $Result = $oTraducir->Traducir("Fun21");
      }
    }
    else{
      $Result = $oTraducir->Traducir("Fun21");
    }

    $arrResultado[0] = $Result;
    $arrResultado[1] = $IdCia;
    $arrResultado[2] = $TipoUs;
    $arrResultado[3] = $Grupo;
    $arrResultado[4] = $NomCia;
    $arrResultado[5] = "../img/".$LogoCia;
    $arrResultado[6] = $checkPayU;
    $arrResultado[7] = $NitPay;
    $arrResultado[8] = "../img/".$BannerCia;
    $arrResultado[9] = $Dominio;
    $arrResultado[10] = $AcepInsert;
    $arrResultado[11] = $AcepUpdate;
    $arrResultado[12] = $AcepDelete;
    echo json_encode($arrResultado);
    break;
  case 'ExportarTXT':
    $arrResultado = array();
    $arrNomb = array();
    $arrInfo = array();
    $arrCabecs = array();
    $arrCabec = array();
    $arrDatos = array();
    $arrDato = array();
    $encabezado = "nn";
    $registros = "mm";
    $Texto = "";
    $iCantCols = 0;
    $iCantFil = 0;
    $uploads_dir = './archivos_pdf';
    $rutaTxt = $uploads_dir."/".$_POST["NomArch"];
    $InfoTxt = file_get_contents($rutaTxt);
    $arrInfo = json_decode($InfoTxt, true);
    $arrNomb = array_keys($arrInfo[0]);
    $nombre_archivo = "./archivos_txt/".$_POST["NomArch"];
    unlink($nombre_archivo);
    if($archivo = fopen($nombre_archivo, "a"))
    {
      $encabezado = "";
      foreach ($arrNomb as $key => $value) {
        if($encabezado != "")
          $encabezado .= ", ";
        $encabezado .= $value;
        $iCantCols++;
      }
      //$Texto .= "Encabezado: ".$iCantCols.". ";
      fwrite($archivo, $encabezado."\r\n");
      foreach ($arrInfo as $value) {
        $registros = "";
        for ($i=0; $i < $iCantCols; $i++) { 
          if($registros != "")
            $registros .= ", ";
          $registros .= $value[$arrNomb[$i]];
        }
        $Texto .= "Registro ".$registros." - ";
        fwrite($archivo, $registros."\r\n");
      }
      $encabezado = $oTraducir->Traducir("Fun22");
   
      fclose($archivo);
    }
    else{
      $encabezado = $oTraducir->Traducir("Fun23");
    }
    //print $xml->asXML();

    $arrResultado[0] = "OK";
    $arrResultado[1] = $encabezado;
    $arrResultado[2] = $registros;
    echo json_encode($arrResultado);
    break;
  case 'CambiarIdioma':
    $arrResultado = array();
    $Idioma = $_POST["idioma"];
    $Idiomacode = "es";
    switch($Idioma){
      case "EN":
        $Idiomacode = "en";					
        break;
      case "ES":
        $Idiomacode = "es";
        break;
    }
    $_SESSION["IdiomaCode"] = $Idiomacode;
    $arrResultado[0] = "OK";
    echo json_encode($arrResultado);
    break;
  case 'ConsultarUsuario':
      $arrResultado = array();
      $oBasedeDatos1 = new BasedeDatos();
      $id_user = $_POST['idusua'];
      $SqlGetUser = "SELECT T0.id, T0.name, T0.username, T0.email, T1.in_uso_appsolitras_ruscia as usoAppST, T1.id_cia_ruscia as idCia, T2.tx_nit_cia as nitCia, T2.tx_nombre_cia as nombreCia, T2.tx_logo_cia as logoCia, T2.tx_dominio_cia as dominio, T2.id_usuareg_cia as idUsuaRegCia, T1.in_estado_ruscia as estado, T2.in_estado_payu as estPayU, T2.in_estado_paymentez_cia as estaPaymentez, T1.id_player_user_ruscia as PlayerId, IFNULL(T1.tx_tipusua_ruscia, '-1') AS TipoUsuario FROM portal_users T0 INNER JOIN app_r_usua_cia T1 ON T1.id_usua_ruscia = T0.id INNER JOIN app_compania T2 ON T2.id_cia = T1.id_cia_ruscia WHERE id = ".$id_user;
	  $oBasedeDatos1->Sql = $SqlGetUser;
	  $oBasedeDatos1->blRegs = 1;					
	  $oBasedeDatos1->ConsultarBD();
	  if ($oBasedeDatos1->nCantReg > 0) {	
		$idCias = array();
		for($i = 0; $i < $oBasedeDatos1->nCantReg; $i++ ){
			array_push($idCias, array(
				"idcia" => $oBasedeDatos1->Regs[$i][5],
				"nitcia" => $oBasedeDatos1->Regs[$i][6],
				"nombrecia" => $oBasedeDatos1->Regs[$i][7],                 
				"logoCia" => $oBasedeDatos1->Regs[$i][8],                  
				"dominio" => $oBasedeDatos1->Regs[$i][9],
				"idUsuaRegCia" => $oBasedeDatos1->Regs[$i][10],
				"estPayU" => $oBasedeDatos1->Regs[$i][12],
				"estPaymentez" => $oBasedeDatos1->Regs[$i][13],
			));
		}
		
		$ObjEstado = new dashboardMiPortalSap();
        $ObjEstado->idUser = $oBasedeDatos1->Regs[0][0];
        $ObjEstado->getEstadoUsoAppSoliTras();
        $estaSoliTras = $ObjEstado->Registros;
		
		$User = array(
			"status" => true,
			"id" => $oBasedeDatos1->Regs[0][0],
			"name" => $oBasedeDatos1->Regs[0][1],
			"username" => $oBasedeDatos1->Regs[0][2],
			"email" => $oBasedeDatos1->Regs[0][3],
			"usoapp" => $oBasedeDatos1->Regs[0][4],
			"estado" => $oBasedeDatos1->Regs[0][11],
			"PlayerId" => $oBasedeDatos1->Regs[0][14],
			"TipoUsuario" => $oBasedeDatos1->Regs[0][15],
			'cantcias' => $oBasedeDatos1->nCantReg,
			'estaSoliTras' => $estaSoliTras,
			'arraycias' => $idCias
		);	

		echo json_encode($User, JSON_PRETTY_PRINT);
	  } else {
	      $User = array(
	          "status" => "false",
	          "msg" => "No se encontro el usuario"
	          );
	         
	      echo json_encode($User, JSON_PRETTY_PRINT);
	  }
      break;
  case 'AutorizarCia':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["idCia"];
    $IdUsua = $_POST["idUsu"];
    $Dominio = $_POST["dominio"]; 
    $oCia = new Compania();
    $oCia->IdCia = $IdCia;
    $oCia->Estado = 1;
    $oCia->UsuarioReg = $IdUsua;
    $oCia->Dominio = $Dominio;
    $oCia->updateEstado();
    if($oCia->Error == false){
      $arrResultado[0] = "OK";
      $ObjUpEstUser = new MultiCompania();
      $ObjUpEstUser->IdCia = $IdCia;
      $ObjUpEstUser->IdUsuario = $IdUsua;
      $ObjUpEstUser->getUsCia();
      if ($ObjUpEstUser->Estado == 0) {
        $ObjUpEstUser->Estado = 1;
        $ObjUpEstUser->updateEstado();
      }
    }
    else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun24")." ".$oCia->Msg;
    }		
    echo json_encode($arrResultado);
    break;
  case 'ActualizarCia':
    $arrResultado = array();
    $salida = "";
    $oCia = new Compania();
    $oCia->IdCia = $_POST["idCia"];
    $oCia->LogoCia = $_POST["logo"];
    $oCia->SugerirParametros = $_POST["sugerir"];
    $oCia->Estilos = $_POST["style"];
    $oCia->Banner = $_POST["banner"];
    $oCia->Dominio = $_POST["dominio"];
    $oCia->EsFrame = $_POST["esframe"];
    $oCia->ImgFrame = $_POST["frame"];
    $oCia->checkPayU = $_POST["payu"];
    $oCia->ChkInsitu = $_POST["insitu"];
    $oCia->ChkEbay = $_POST["ebay"];
    $oCia->ChkRepzio = $_POST["repzio"];
    $oCia->ChkShopify = $_POST["shopify"];
    $oCia->ChkVtex = $_POST["vtex"];
    $oCia->ChkMerqueo = $_POST["merqueo"];
    $oCia->chkRequisiciones = $_POST["requisiciones"];
    $oCia->ChkPaymentez = $_POST["paymentez"];
    $oCia->updateLogo();
    if($oCia->Error == false){
      $arrResultado[0] = "OK";
      $arrResultado[1] = $oTraducir->Traducir("Fun25");
    }
    else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun26");
    }								
    echo json_encode($arrResultado);
    break;    
  case 'ValidarCia':
    $arrResultado = array();
    $salida = "";
    $NitCia = $_POST["nit"];
    $IdUsu = $_POST["idus"];
    $oCia = new Compania();
    $oCia->NitCia = $NitCia;
    $oCia->getCiaNit();
    if($oCia->Error == false){
      if($oCia->Cant == 1){
        $arrResultado[0] = "OK";
        $arrResultado[1] = $oCia->IdCia;
        $arrResultado[2] = $oCia->NitCia;
        $arrResultado[3] = $oCia->NomCia;
        $arrResultado[4] = $oCia->FechaRegistro;
        $arrResultado[5] = $oCia->CodVerificacion;	
        $arrResultado[6] = $oCia->LogoCia;
        $arrResultado[7] = $oCia->SugerirParametros;
      }
      else{				
        $arrResultado[0] = "Error";
        $arrResultado[1] = $oTraducir->Traducir("Fun27");										
      }
    }
    else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun28");
    }		
    echo json_encode($arrResultado);
    break;
  case 'CargarCia':
    $arrResultado = array();
    $salida = "";
    $NitCia = $_POST["nit"];
    $CodV = $_POST["codv"];
    $IdUsua = $_POST["idus"];
    $oCia = new Compania();
    $oCia->NitCia = $NitCia;
    $oCia->CodVerificacion = $CodV;
    $oCia->getCiaNitCodV();
    if($oCia->Error == false){
      if($oCia->Cant == 1){
        $arrResultado[0] = "OK";
        if($oCia->Estado == "2"){
          $arrResultado[1] = "Autorizar";
          $arrResultado[2] = $oCia->IdCia;
          $arrResultado[3] = $oCia->NitCia;
          $arrResultado[4] = $oCia->NomCia;
          $arrResultado[5] = $oCia->FechaRegistro;
          $arrResultado[6] = $oCia->CodVerificacion;	
          $arrResultado[7] = $oCia->LogoCia;
          $arrResultado[8] = $oCia->SugerirParametros;
          $arrResultado[9] = $oCia->Dominio;
          $arrResultado[10] = $oCia->Banner;
          $arrResultado[11] = $oCia->Estilos;
          $arrResultado[12] = $oCia->EsFrame;
          $arrResultado[13] = $oCia->ImgFrame;
          $arrResultado[14] = $oCia->checkPayU;
          $arrResultado[15] = $oCia->ChkInsitu;
          $arrResultado[16] = $oCia->ChkEbay;
          $arrResultado[17] = $oCia->ChkRepzio;
          $arrResultado[18] = $oCia->FechaPolling;
          $arrResultado[19] = $oCia->ChkShopify;
          $arrResultado[20] = $oCia->ChkVtex;
          $arrResultado[21] = $oCia->ChkMerqueo;
          $arrResultado[22] = $oCia->chkRequisiciones;
          $arrResultado[23] = $oCia->ChkPaymentez;
        }
        else{
          if($oCia->UsuarioReg == $IdUsua){
            if($oCia->Estado == "0"){
              $arrResultado[1] = "Inactiva";
            }
            else{
              $arrResultado[1] = "Activa";
            }
            $arrResultado[2] = $oCia->IdCia;
            $arrResultado[3] = $oCia->NitCia;
            $arrResultado[4] = $oCia->NomCia;
            $arrResultado[5] = $oCia->FechaRegistro;
            $arrResultado[6] = $oCia->CodVerificacion;	
            $arrResultado[7] = $oCia->LogoCia;
            $arrResultado[8] = $oCia->SugerirParametros;
            $arrResultado[9] = $oCia->Dominio;
            $arrResultado[10] = $oCia->Banner;
            $arrResultado[11] = $oCia->Estilos;	
            $arrResultado[12] = $oCia->EsFrame;
            $arrResultado[13] = $oCia->ImgFrame;
            $arrResultado[14] = $oCia->checkPayU;
            $arrResultado[15] = $oCia->ChkInsitu;
            $arrResultado[16] = $oCia->ChkEbay;
            $arrResultado[17] = $oCia->ChkRepzio;
            $arrResultado[18] = $oCia->FechaPolling;
            $arrResultado[19] = $oCia->ChkShopify;
            $arrResultado[20] = $oCia->ChkVtex;
            $arrResultado[21] = $oCia->ChkMerqueo;
            $arrResultado[22] = $oCia->chkRequisiciones;
            $arrResultado[23] = $oCia->ChkPaymentez;
          }
          else{
            $arrResultado[1] = "Sin Permiso";
          }
        }
      }
      else{				
        $arrResultado[0] = "Error";
        $arrResultado[1] = $oTraducir->Traducir("Fun27");
      }
    }
    else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun28");
    }		
    //$arrResultado[0] = "Error";
    //$arrResultado[1] = "No se pudo consultar la compañía";
    echo json_encode($arrResultado);
    break;
  case 'CargarGrpCia':
    $arrResultado = array();
    $TypeUsu = "";		
    $salida = "";
    $IdCia = $_POST["cia"];		
    $oGrp = new Grupos();
    $oGrp->IdCia = $IdCia;		
		$oGrp->getCia();
			if($oGrp->Error == false){
			if($oGrp->Cant > 0){
					for($i = 0; $i < $oGrp->Cant; $i++){
				$nombres = $oGrp->lstGrupos[$i]["nomUsAdmin"];
						$salida .= "<tr>";					
						$salida .= "<td style='vertical-align: middle;text-align: center;'>".($i + 1)."</td>";
						$salida .= "<td style='vertical-align: middle;text-align: center;'>".$oGrp->lstGrupos[$i]["CodGrupo"]."</td>";					
						$salida .= "<td style='vertical-align: middle;text-align: center;'>".$oGrp->lstGrupos[$i]["Descripcion"]."</td>";					
						switch($oGrp->lstGrupos[$i]["TipoUsuario"]){
							case "E":
								$TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
								break;
							case "C":
								$TypeUsu = $oTraducir->Traducir("Fun29Cliente");
								break;
							case "S":
								$TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
								break;
						}
				$salida .= "<td style='vertical-align: middle;text-align: center;'>".$TypeUsu."</td>";
				$salida .= "<td style='vertical-align: middle;text-align: center;'>".$nombres."</td>";	
						$salida .= "<td style='vertical-align: middle;text-align: center;'><div id='Grp_".$i."' idcia='".$oGrp->lstGrupos[$i]["IdCia"]."' codgrp='".$oGrp->lstGrupos[$i]["CodGrupo"]."' class='btn btn-default csBtnEliminarGrp'><img src='../img/icon_delete.png' /></div></td>";
						//$salida .= "<td style='vertical-align: middle'><div id='btnDeleteGrp".$i."' class='csBtnEliminarGrp'><img src='../img/icon_delete.png' /></div></td>";	
						//$salida .= "<td style='vertical-align: middle'><div id='btnDeleteGrp".$i."' style='cursor:pointer;' onclick='EliminarGrp(".$i.",this);'><img src='../img/icon_delete.png' /></div></td>";	
						$salida .= "</tr>";					
					}
				}
				else{
					$salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun30")."</td></tr>";				
				}
			}
			$arrResultado[0] = "OK";
		$arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'CargarGrpCiaNuevoPortal':
    $arrResultado = array();
    $arrData = array();
    $TypeUsu = "";	
    $IdCia = $_POST["cia"];		
    $oGrp = new Grupos();
    $oGrp->IdCia = $IdCia;		
	$oGrp->getCia();
	if($oGrp->Error == false){
	    if($oGrp->Cant > 0){
			for($i = 0; $i < $oGrp->Cant; $i++){
		        $nombres = $oGrp->lstGrupos[$i]["nomUsAdmin"];				
				switch($oGrp->lstGrupos[$i]["TipoUsuario"]){
					case "E":
						$TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
						break;
					case "C":
						$TypeUsu = $oTraducir->Traducir("Fun29Cliente");
						break;
					case "S":
						$TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
						break;
				}	
				$arrData[$i] = array('idCia' => $oGrp->lstGrupos[$i]["IdCia"], 'codGrupo' => $oGrp->lstGrupos[$i]["CodGrupo"], 'descripcion' => $oGrp->lstGrupos[$i]["Descripcion"], 'tipo' => $oGrp->lstGrupos[$i]["TipoUsuario"], 'tipoDescr' => $TypeUsu, 'nombres' => $nombres);
			}
			$arrResultado[0] = "OK";
			$arrResultado[1] = $arrData;
		}
		else{
			$arrResultado[0] = "No se encontraron registros";
			$arrResultado[1] = $arrData;			
		}
	} else {
	    $arrResultado[0] = "Se presentó un error al consultar";
		$arrResultado[1] = $oGrp->Msg;
	}
	
    echo json_encode($arrResultado);
    break;
  case 'AgregarGrp':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["idcia"];
    $IdUsua = $_POST["idusu"];
    $CodeGrp = $_POST["codgrp"];
    $DesGrp = $_POST["desgrp"];
		$TypUsuGrp = $_POST["typusugrp"];	
		$adminGrp = $_POST["adminGrp"];
    $oGrp = new Grupos();
    $oGrp->IdCia = $IdCia;
    $oGrp->Usuario = $IdUsua;
    $oGrp->CodGrupo = $CodeGrp;
    $oGrp->Descripcion = $DesGrp;
		$oGrp->TipoUsuario = $TypUsuGrp;
		$oGrp->UserAdmin = $adminGrp;			
    $oGrp->add();
    if($oGrp->Error == true){
      $Resp = "Error";
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'ActualizarGrp':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["idcia"];		
    $CodeGrp = $_POST["codgrp"];
    $DesGrp = $_POST["desgrp"];
		$TypUsuGrp = $_POST["typusugrp"];	
		$adminGrp = $_POST["adminGrp"];	
    $oGrp = new Grupos();
    $oGrp->IdCia = $IdCia;		
    $oGrp->CodGrupo = $CodeGrp;
    $oGrp->Descripcion = $DesGrp;
		$oGrp->TipoUsuario = $TypUsuGrp;
		$oGrp->UserAdmin = $adminGrp;			
    $oGrp->update();
    if($oGrp->Error == true){
      $Resp = "Error";
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'EliminarGrp':
    $arrResultado = array();
    $Resp = "";
    $Existe = false;		
    $IdCia = $_POST["idcia"];				
    $CodeGrp = $_POST["codgrp"];
    $oUsua = new MultiCompania();		
    $oUsua->IdCia = $IdCia;
    $oUsua->Grupo = $CodeGrp;
    $oUsua->validarGrupo();
    if($oUsua->Cant > 0){
      $Existe = true;
      $Resp = $oTraducir->Traducir("Fun31").": ".$oUsua->NomCia;			
    }else{
      $oRep = new Reportes();			
      $oRep->IdCia = $IdCia;
      $oRep->Grupo = $CodeGrp;
      $oRep->validarGrupo();
      if($oRep->Cant > 0){
        $Existe = true;	
        $Resp = $oTraducir->Traducir("Fun32")." ".$oRep->NomCia;
      }else{
        $Existe = false;
      }
    }
    
    if($Existe == false){
      $oGrp = new Grupos();
      $oGrp->IdCia = $IdCia;		
      $oGrp->CodGrupo = $CodeGrp;		
      $oGrp->del();
      if($oGrp->Error == true){
        $Resp = "Error";
      }else{			
        $Resp = "OK";
      }
    }				
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'EliminarRPT':
    $arrResultado = array();
    $Resp = "";
    $Existe = false;		
    $IdCia = $_POST["idcia"];				
    $CodeRPT = $_POST["codRepo"];
    $oSolicRep = new SolicitudReportes();		
    $oSolicRep->IdCia = $IdCia;
    $oSolicRep->IdReporte = $CodeRPT;
    $oSolicRep->getCantCiaReport();
    if($oSolicRep->Cant > 0){
      $Existe = true;
      $Resp = $oTraducir->Traducir("Fun53");
      $oRep = new Reportes();			
      $oRep->IdCia = $IdCia;
      $oRep->IdReporte = $CodeRPT;
      $oRep->Estado = 0;
      $oRep->updateEstado();			
    }else{
      $oRep = new Reportes();			
      $oRep->IdCia = $IdCia;
      $oRep->IdReporte = $CodeRPT;
      $oRep->del();
      $oRepParam = new ReporteParametros();
      $oRepParam->IdCia = $IdCia;
      $oRepParam->IdReporte = $CodeRPT;
      $oRepParam->del();
      $Resp = "OK";
    }			
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'ValidarGrpCod':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["idcia"];
    $CodeGrp = $_POST["codgrp"];
    $oGrp = new Grupos();
    $oGrp->IdCia = $IdCia;		
    $oGrp->CodGrupo = $CodeGrp;
    $oGrp->get();
    if($oGrp->Cant == 1){
      $arrResultado[0] = "OK";				
      $arrResultado[1] = $oGrp->CodGrupo;
      $arrResultado[2] = $oGrp->Descripcion;
    $arrResultado[3] = $oGrp->TipoUsuario;
    if ($oGrp->UserAdmin == 0) {
    $arrResultado[4] = "";
    }else{
    $arrResultado[4] = $oGrp->UserAdmin.'-'.$oGrp->nomUsAdmin;				
    }
    }else{				
        $arrResultado[0] = "Error";
        $arrResultado[1] = $oTraducir->Traducir("Fun33");										
    }					
    echo json_encode($arrResultado);
    break;
  case 'CargarCategoCia':
    $arrResultado = array();
    $TypeUsu = "";		
    $salida = "";
    $IdCia = $_POST["cia"];		
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;		
    $oCate->getSubCategoriasCia();
    if($oCate->Cant > 0){
      for($i = 0; $i < $oCate->Cant; $i++){
        $salida .= "<tr>";					
        $salida .= "<td style='vertical-align: middle'>".($i + 1)."</td>";
        $salida .= "<td style='vertical-align: middle'>".$oCate->lstCategorias[$i]["CategoriaCodigo"]."</td>";					
        $salida .= "<td style='vertical-align: middle'>".$oCate->lstCategorias[$i]["CategoriaDescripcion"]."</td>";
        $salida .= "<td style='vertical-align: middle'>".$oCate->lstCategorias[$i]["SubCategoriaCodigo"]."</td>";					
        $salida .= "<td style='vertical-align: middle'>".$oCate->lstCategorias[$i]["SubCategoriaDescripcion"]."</td>";
        $salida .= "<td style='vertical-align: middle'><div id='Catego_".$i."' idcia='".$oCate->lstCategorias[$i]["IdCia"]."' codcatego='".$oCate->lstCategorias[$i]["CategoriaCodigo"]."' codsubcatego='".$oCate->lstCategorias[$i]["SubCategoriaCodigo"]."' class='btn btn-default csBtnEliminarCatego'><img src='../img/icon_delete.png' /></div></td>";
        $salida .= "</tr>";					
      }
    }
    else{
      $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun34")."</td></tr>";				
    }		
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
    break;
  case 'CargarCategoCiaNuevoPortal':
    $arrResultado = array();
    $arrData = array();
    $TypeUsu = "";
    $IdCia = $_POST["cia"];		
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;		
    $oCate->getSubCategoriasCia();
    if($oCate->Cant > 0){
      for($i = 0; $i < $oCate->Cant; $i++){
        $arrData[$i] = array('codCat' => $oCate->lstCategorias[$i]["CategoriaCodigo"], 'descrpCat' => $oCate->lstCategorias[$i]["CategoriaDescripcion"], 'codSub' => $oCate->lstCategorias[$i]["SubCategoriaCodigo"], 'descrpSub' => $oCate->lstCategorias[$i]["SubCategoriaDescripcion"]);
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $arrData;
    }
    else{
      $arrResultado[0] = "No se encontraron registros";
      $arrResultado[1] = $arrData;
    }
    
    echo json_encode($arrResultado);
    break;
  case 'AgregarCatego':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["idcia"];
    $IdUsua = $_POST["idusu"];		
    $CodeCatego = $_POST["codcatego"];
    $DesCatego = $_POST["descatego"];
    $CodeSubCatego = $_POST["codsubcatego"];
    $DesSubCatego = $_POST["dessubcatego"];					
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;	
    $oCate->Usuario = $IdUsua;	
    $oCate->CategoriaCodigo = $CodeCatego;
    $oCate->CategoriaDescripcion = $DesCatego;
    $oCate->SubCategoriaCodigo = $CodeSubCatego;
    $oCate->SubCategoriaDescripcion = $DesSubCatego;				
    $oCate->add();
    if($oCate->Error == true){
      $Resp = "Error";
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'ValidarCategoCod':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["idcia"];
    $CodeCatego = $_POST["codcatego"];
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;		
    $oCate->CategoriaCodigo = $CodeCatego;
    $oCate->getCategoria();
    if($oCate->Cant == 1){
      $arrResultado[0] = "OK";				
      $arrResultado[1] = $oCate->CategoriaCodigo;
      $arrResultado[2] = $oCate->CategoriaDescripcion;						
    }else{				
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun33");										
    }					
    echo json_encode($arrResultado);
    break;
  case 'ValidarSubCategoCod':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["idcia"];
    $CodeCatego = $_POST["codcatego"];
    $CodeSubCatego = $_POST["codsubcatego"];
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;		
    $oCate->CategoriaCodigo = $CodeCatego;
    $oCate->SubCategoriaCodigo = $CodeSubCatego;
    $oCate->getSubCategoria();
    if($oCate->Cant == 1){
      $arrResultado[0] = "OK";				
      $arrResultado[1] = $oCate->CategoriaCodigo;
      $arrResultado[2] = $oCate->CategoriaDescripcion;
      $arrResultado[3] = $oCate->SubCategoriaCodigo;
      $arrResultado[4] = $oCate->SubCategoriaDescripcion;

    }else{				
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun33");										
    }					
    echo json_encode($arrResultado);
    break;
  case 'ActualizarCatego':
    $arrResultado = array();
    $Resp = "";		
    $IdCia = $_POST["idcia"];
    $IdUsua = $_POST["idusu"];		
    $CodeCatego = $_POST["codcatego"];
    $DesCatego = $_POST["descatego"];
    $CodeSubCatego = $_POST["codsubcatego"];
    $DesSubCatego = $_POST["dessubcatego"];		
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;		
    $oCate->CategoriaCodigo = $CodeCatego;
    $oCate->CategoriaDescripcion = $DesCatego;				
    $oCate->updateCategoria();
    if($oCate->Error == true){
      $Resp = "Error";
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'ActualizarSubCatego':
    $arrResultado = array();
    $Resp = "";		
    $IdCia = $_POST["idcia"];
    $IdUsua = $_POST["idusu"];		
    $CodeCatego = $_POST["codcatego"];
    $DesCatego = $_POST["descatego"];
    $CodeSubCatego = $_POST["codsubcatego"];
    $DesSubCatego = $_POST["dessubcatego"];		
    $oCate = new CategSubcate();
    $oCate->IdCia = $IdCia;		
    $oCate->CategoriaCodigo = $CodeCatego;
    $oCate->SubCategoriaCodigo = $CodeSubCatego;
    $oCate->SubCategoriaDescripcion = $DesSubCatego;				
    $oCate->updateSubCategoria();
    if($oCate->Error == true){
      $Resp = "Error";
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'EliminarSubCatego':
    $arrResultado = array();
    $Resp = "";
    $Existe = false;		
    $IdCia = $_POST["idcia"];				
    $CodeCatego = $_POST["codcatego"];
    $CodeSubCatego = $_POST["codsubcatego"];
    $oRep = new Reportes();			
    $oRep->IdCia = $IdCia;
    $oRep->Categoria = $CodeCatego;
    $oRep->SubCategoria = $CodeSubCatego;
    $oRep->validarSubCategoria();
    if($oRep->Cant > 0){
      $Existe = true;	
      $Resp = $oTraducir->Traducir("Fun35");
    }		
    if($Existe == false){
      $oCate = new CategSubcate();
      $oCate->IdCia = $IdCia;		
      $oCate->CategoriaCodigo = $CodeCatego;	
      $oCate->SubCategoriaCodigo = $CodeSubCatego;	
      $oCate->del();
      if($oCate->Error == true){
        $Resp = "Error";
      }else{			
        $Resp = "OK";
      }
    }		
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'ComboGrupoUsua':
    $arrResultado = array();
    $arrData = array();
    $salida = "<option value='-1'>--------</option>";
    $IdCia = $_POST["cia"];
    $TipoUsu = $_POST["tipousu"];		
    $oGrp = new Grupos();
    $oGrp->IdCia = $IdCia;
    $oGrp->TipoUsuario = $TipoUsu;
    $oGrp->getTipoUs();
    if($oGrp->Cant != 0){
      for($i = 0; $i < $oGrp->Cant; $i++){
        $salida .= "<option value='".$oGrp->lstGrupos[$i]["CodGrupo"]."'>".$oGrp->lstGrupos[$i]["Descripcion"]."</option>";
        $arrData[$i] = array('codGrupo' => $oGrp->lstGrupos[$i]["CodGrupo"], 'Descripcion' => $oGrp->lstGrupos[$i]["Descripcion"]);
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $salida;
      $arrResultado[2] = $arrData;
    }else{
      $arrResultado[0] = "Error";	
      $arrResultado[1] = $salida;		
      $arrResultado[2] = "Error";
    }
    echo json_encode($arrResultado);
    break;
  case 'CargarUsuariosActivInac':
    $arrResultado = array();
    $arrData = array();
    $TypeUsu = "";
    $DesEstado = "";
    $DesGrp = "";
    $CodGrp = "";
    $salida = "";
    $IdCia = $_POST["cia"];		
		$Estado = $_POST["estado"];
		$TipoAdn = $_POST["tipoadn"];
		$IdUsu = $_POST["IdUsu"];
    $oCom = new Compania();
    $oCom->IdCia = $IdCia;
    $oCom->get();
    $NitCia = $oCom->NitCia;
    $UsuaRegCia = $oCom->UsuarioReg; 	
    $oUser = new Usuario();
    $oUser->IdCia = $IdCia;
		$oUser->Estado = $Estado;
		$oUser->IdUsuario = $IdUsu;
		if ($TipoAdn == 0) {
      $oUser->getAllIdCiaAdn();
      if($oUser->Cant != 0){
        for($i = 0; $i < $oUser->Cant; $i++){
          $salida .= "<tr>";					
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".($i + 1)."</td>";
          $salida .= "<td class='verUsuarioPre' style='vertical-align: middle; text-align: center;'><div id='User_".$i."' idcia='".$oUser->lstUsuario[$i]["IdCia"]."' iduser='".$oUser->lstUsuario[$i]["IdUsuario"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png'/></div></td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["IdUsuario"]."</td>";					
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["Correo"]."</td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["Nombre"]."</td>";					
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["NroIdentificacion"]."</td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["NombreCia"]."</td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["NitCia"]."</td>";
          switch($oUser->lstUsuario[$i]["TipoUsuario"]){
          case "E":
            $TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
            break;
          case "C":
            $TypeUsu = $oTraducir->Traducir("Fun29Cliente");						
            break;
          case "S":
            $TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
            break;
          }				
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeUsu."</td>";	
          $CodGrp = $oUser->lstUsuario[$i]["Grupo"];
          $oGrp = new Grupos();
          $oGrp->CodGrupo = $CodGrp;
          $oGrp->IdCia = $IdCia;
          $oGrp->get();
          $DesGrp = $oGrp->Descripcion;
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesGrp."</td>";
          switch($oUser->lstUsuario[$i]["Estado"]){
          case 0:
            $DesEstado = $oTraducir->Traducir("Fun43");					
            break;
          case 4:
            $DesEstado = $oTraducir->Traducir("Fun60");					
            break;
          default:
            $DesEstado = $oTraducir->Traducir("Fun44");					
            break;
          }					
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesEstado."</td>";
          $salida .= "</tr>";	
          $arrData[$i] = array('IdUsuario' => $oUser->lstUsuario[$i]["IdUsuario"], 'Correo' => $oUser->lstUsuario[$i]["Correo"], 'Nombre' => $oUser->lstUsuario[$i]["Nombre"], 'NroIdentificacion' => $oUser->lstUsuario[$i]["NroIdentificacion"], 'NombreCia' => $oUser->lstUsuario[$i]["NombreCia"], 'NitCia' => $oUser->lstUsuario[$i]["NitCia"], 'TipoUsuario' => $oUser->lstUsuario[$i]["TipoUsuario"], 'Grupo' => $DesGrp, 'Estado' => $oUser->lstUsuario[$i]["Estado"]);
        }
      }				
    } 
    else{
      $oUser->getAllIdCia();
      if($oUser->Cant != 0){		

        for($i = 0; $i < $oUser->Cant; $i++){
        $salida .= "<tr>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($i + 1)."</td>";
        $salida .= "<td class='verUsuarioPre' style='vertical-align: middle; text-align: center;'><div id='User_".$i."' idcia='".$oUser->lstUsuario[$i]["IdCia"]."' iduser='".$oUser->lstUsuario[$i]["IdUsuario"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png'/></div></td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["IdUsuario"]."</td>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["Correo"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["Nombre"]."</td>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["NroIdentificacion"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["NombreCia"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oUser->lstUsuario[$i]["NitCia"]."</td>";
        switch($oUser->lstUsuario[$i]["TipoUsuario"]){
        case "E":
          $TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
          break;
        case "C":
          $TypeUsu = $oTraducir->Traducir("Fun29Cliente");						
          break;
        case "S":
          $TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
          break;
        }				
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeUsu."</td>";	
        $CodGrp = $oUser->lstUsuario[$i]["Grupo"];
        $oGrp = new Grupos();
        $oGrp->CodGrupo = $CodGrp;
        $oGrp->IdCia = $IdCia;
        $oGrp->get();
        $DesGrp = $oGrp->Descripcion;
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesGrp."</td>";
        switch($oUser->lstUsuario[$i]["Estado"]){
        case 0:
          $DesEstado = $oTraducir->Traducir("Fun43");					
          break;
        case 4:
          $DesEstado = $oTraducir->Traducir("Fun60");					
          break;
        default:
          $DesEstado = $oTraducir->Traducir("Fun44");					
          break;
        }					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesEstado."</td>";
        $salida .= "</tr>";	
        $arrData[$i] = array('IdUsuario' => $oUser->lstUsuario[$i]["IdUsuario"], 'Correo' => $oUser->lstUsuario[$i]["Correo"], 'Nombre' => $oUser->lstUsuario[$i]["Nombre"], 'NroIdentificacion' => $oUser->lstUsuario[$i]["NroIdentificacion"], 'NombreCia' => $oUser->lstUsuario[$i]["NombreCia"], 'NitCia' => $oUser->lstUsuario[$i]["NitCia"], 'TipoUsuario' => $oUser->lstUsuario[$i]["TipoUsuario"], 'Grupo' => $DesGrp, 'Estado' => $oUser->lstUsuario[$i]["Estado"]);
      }
      }elseif ($Estado == 1) {
        $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun36")."</td></tr>";
      }else{
        $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun37")."</td></tr>";
      }			
    }
    
    //echo $oUser->Msg;
    //echo var_dump($oUser->Registros);
    // echo $salida;
    // exit;
    
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = $UsuaRegCia;		
    $arrResultado[3] = $oUser->Cant;		
    $arrResultado[4] = $oUser->Registros;
    $arrResultado[5] = $arrData;		
    echo json_encode($arrResultado);
    break;
  

  case 'ResulBusUsuario':
    $arrResultado = array();
    $arrData = array();
    $IdCia = $_POST["IdCia"];
    $dato = $_POST["dato"];
    $salida = "";
    $ObjBusUser = new Usuario();
    $ObjBusUser->IdCia = $IdCia;
    $ObjBusUser->Dato = $dato;
    $ObjBusUser->getBusUser();
    if($ObjBusUser->Cant != 0){
      for($i = 0; $i < $ObjBusUser->Cant; $i++){
        $salida .= "<tr>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($i + 1)."</td>";
        $salida .= "<td class='verUsuarioPre' style='vertical-align: middle; text-align: center;'><div id='User_".$i."' idcia='".$ObjBusUser->lstUsuario[$i]["IdCia"]."' iduser='".$ObjBusUser->lstUsuario[$i]["IdUsuario"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png'/></div></td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjBusUser->lstUsuario[$i]["IdUsuario"]."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjBusUser->lstUsuario[$i]["Correo"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjBusUser->lstUsuario[$i]["Nombre"]."</td>";			
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjBusUser->lstUsuario[$i]["NroIdentificacion"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjBusUser->lstUsuario[$i]["NombreCia"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjBusUser->lstUsuario[$i]["NitCia"]."</td>";
        switch($ObjBusUser->lstUsuario[$i]["TipoUsuario"]){
          case "E":
            $TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
            break;
          case "C":
            $TypeUsu = $oTraducir->Traducir("Fun29Cliente");						
            break;
          case "S":
            $TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
            break;
        }				
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeUsu."</td>";	
        $CodGrp = $ObjBusUser->lstUsuario[$i]["Grupo"];
        $oGrp = new Grupos();
        $oGrp->CodGrupo = $CodGrp;
        $oGrp->IdCia = $IdCia;
        $oGrp->get();
        $DesGrp = $oGrp->Descripcion;
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesGrp."</td>";
        switch($ObjBusUser->lstUsuario[$i]["Estado"]){
          case 0:
            $DesEstado = $oTraducir->Traducir("Fun43");					
            break;
          case 4:
            $DesEstado = $oTraducir->Traducir("Fun60");					
            break;
          default:
            $DesEstado = $oTraducir->Traducir("Fun44");					
            break;
        }					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesEstado."</td>";
        $salida .= "</tr>";	
        $arrData[$i] = array('IdUsuario' => $ObjBusUser->lstUsuario[$i]["IdUsuario"], 'Correo' => $ObjBusUser->lstUsuario[$i]["Correo"], 'Nombre' => $ObjBusUser->lstUsuario[$i]["Nombre"], 'NroIdentificacion' => $ObjBusUser->lstUsuario[$i]["NroIdentificacion"], 'NombreCia' => $ObjBusUser->lstUsuario[$i]["NombreCia"], 'NitCia' => $ObjBusUser->lstUsuario[$i]["NitCia"], 'TipoUsuario' => $ObjBusUser->lstUsuario[$i]["TipoUsuario"], 'Grupo' => $DesGrp, 'Estado' => $ObjBusUser->lstUsuario[$i]["Estado"]);
      }
    }
    $arrResultado[0] = $ObjBusUser->Cant;
    $arrResultado[1] = $salida;	
    $arrResultado[3] = $arrData;
    echo json_encode($arrResultado);	
    break;
  case 'GetCantidadUser':
    $arrResultado = array();
    $ObjCant = new Usuario();
    $ObjCant->IdCia = $_POST["IdCia"];
    $ObjCant->IdUsuario = $_POST["IdUsua"];
    $ObjCant->getCantUserCia();
    $arrResultado[0] = $ObjCant->Dato;
    echo json_encode($arrResultado);
    break;
  case 'GetRangoUser':
    $arrResultado = array();
    $salida = "";
    $TypeUsu = "";
    $ObjRango = new Usuario();
    $ObjRango->IdCia = $_POST["IdCia"];
    $ObjRango->ValorIni = $_POST["ValorIni"];
    $ObjRango->ValorFin = $_POST["ValorFin"];
    $ObjRango->getRangoUsers();
    if($ObjRango->Cant != 0){
      for($i = 0; $i < $ObjRango->Cant; $i++){
        $salida .= "<tr>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($i + 1)."</td>";
        $salida .= "<td class='verUsuarioPre' style='vertical-align: middle; text-align: center;'><div id='User_".$i."' idcia='".$ObjRango->lstUsuario[$i]["IdCia"]."' iduser='".$ObjRango->lstUsuario[$i]["IdUsuario"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png'/></div></td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjRango->lstUsuario[$i]["IdUsuario"]."</td>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjRango->lstUsuario[$i]["Correo"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjRango->lstUsuario[$i]["Nombre"]."</td>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjRango->lstUsuario[$i]["NroIdentificacion"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjRango->lstUsuario[$i]["NombreCia"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$ObjRango->lstUsuario[$i]["NitCia"]."</td>";
        switch($ObjRango->lstUsuario[$i]["TipoUsuario"]){
          case "E":
            $TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
            break;
          case "C":
            $TypeUsu = $oTraducir->Traducir("Fun29Cliente");						
            break;
          case "S":
            $TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
            break;
        }				
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeUsu."</td>";	
        $CodGrp = $ObjRango->lstUsuario[$i]["Grupo"];
        $oGrp = new Grupos();
        $oGrp->CodGrupo = $CodGrp;
        $oGrp->IdCia = $_POST["IdCia"];
        $oGrp->get();
        $DesGrp = $oGrp->Descripcion;
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesGrp."</td>";
        switch($ObjRango->lstUsuario[$i]["Estado"]){
          case 1:
            $DesEstado = $oTraducir->Traducir("Fun44");					
            break;
          case 2:
            $DesEstado = $oTraducir->Traducir("Fun60");					
            break;
          case 4:
            $DesEstado = $oTraducir->Traducir("Fun60");					
            break;
        }					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesEstado."</td>";
        $salida .= "</tr>";	
      }
    }
    $arrResultado[0] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'VisualizarUsuario':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["cia"];
    $IdUsu = $_POST["idus"];
    $oUser = new Usuario();
    $oUser->IdUsuario = $IdUsu;	
    $oUser->IdCia = $IdCia;		
    $oUser->getUsuaCia();
    if($oUser->Cant == 1){
      $arrResultado[0] = "OK";
      $arrResultado[1] = $oUser->IdUsuario;
      $arrResultado[2] = $oUser->Correo;
      $arrResultado[3] = $oUser->Nombre;
      $arrResultado[4] = $oUser->NroIdentificacion;
      $arrResultado[5] = $oUser->NombreCia;	
      $arrResultado[6] = $oUser->NitCia;
      $arrResultado[7] = $oUser->TipoUsuario;
      $arrResultado[8] = $oUser->Grupo;
      $arrResultado[9] = $oUser->Estado;
      
      $oCia = new MultiCompania();
      $oCia->IdUsuario = $IdUsu;
      $oCia->IdCia = $IdCia;
      $oCia->getUsCia();
      
      $arrResultado[10] = $oCia->Param0;
      $arrResultado[11] = $oCia->Param1;
      $arrResultado[12] = $oCia->Param2;
      $arrResultado[13] = $oCia->Param3;
      $arrResultado[14] = $oCia->Param4;
      $arrResultado[15] = $oCia->Param5;	
      $arrResultado[16] = $oCia->Param6;
      $arrResultado[17] = $oCia->Param7;
      $arrResultado[18] = $oCia->Param8;
      $arrResultado[19] = $oCia->Param9;
      $arrResultado[20] = $oUser->usoAppSoliTras;				
      $arrResultado[21] = $oUser->usoAppConsensus;				
      $arrResultado[22] = $oUser->Cargo;				
      $arrResultado[23] = $oUser->DescrpCargo;				

    }else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun38");
    }		
    echo json_encode($arrResultado);
    break;
  case 'ActualizarUsuario':
    $arrResultado = array();
    $Resp = "";		
    $IdCia = $_POST["cia"];
    $IdUsua = $_POST["idus"];
    $UserActualiza = $_POST["iduseractu"];		
    $TypeUser = $_POST["typeuser"];
    $Grupo = $_POST["grupo"];
    $Estado = $_POST["estado"];
    $Param0 = $_POST["param0"];
    $Param1 = $_POST["param1"];
    $Param2 = $_POST["param2"];
    $Param3 = $_POST["param3"];
    $Param4 = $_POST["param4"];
    $Param5 = $_POST["param5"];
    $Param6 = $_POST["param6"];	
    $Param7 = $_POST["param7"];
    $Param8 = $_POST["param8"];
    $Param9 = $_POST["param9"];			
    $oCia = new MultiCompania();
    $oCia->IdUsuario = $IdUsua;
    $oCia->UsuarioActualiza = $UserActualiza;		
    $oCia->IdCia = $IdCia;
    $oCia->TipoUsuario = $TypeUser;
    $oCia->Grupo = $Grupo;
    $oCia->Estado = $Estado;
    $oCia->usoAppSoliTras = $_POST["usoAppST"];		
    $oCia->usoAppConsensus = $_POST["usoAppCSS"];		
    $oCia->Cargo = $_POST["cargo"];		
    $oCia->DescrpCargo = $_POST["descrCargo"];		
    $oCia->Param0 = $Param0;
    $oCia->Param1 = $Param1;
    $oCia->Param2 = $Param2;
    $oCia->Param3 = $Param3;
    $oCia->Param4 = $Param4;
    $oCia->Param5 = $Param5;
    $oCia->Param6 = $Param6;
    $oCia->Param7 = $Param7;
    $oCia->Param8 = $Param8;
    $oCia->Param9 = $Param9;				
    $oCia->update();
    if($oCia->Error == true){
      $Resp = "Error";
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'ComboCategoria':
    $arrResultado = array();
    $salida = "<option value='-1'>--------</option>";
    $IdCia = $_POST["cia"];		
    $oCia = new CategSubcate();
    $oCia->IdCia = $IdCia;
    $oCia->getCategoriasCia();
    if($oCia->Cant > 0){
      for($i = 0; $i < $oCia->Cant; $i++){
        $salida .= "<option value='".$oCia->lstCategorias[$i]["CategoriaCodigo"]."'>".$oCia->lstCategorias[$i]["CategoriaDescripcion"]."</option>";
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $salida;
    }else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $salida;
    }
    echo json_encode($arrResultado);
    break;
  case 'ComboSubcategoria':
    $arrResultado = array();
    $salida = "<option value='-1'>--------</option>";
    $IdCia = $_POST["cia"];
    $CodCatego = $_POST["codcate"];	
    $oCia = new CategSubcate();
    $oCia->IdCia = $IdCia;
    $oCia->CategoriaCodigo = $CodCatego;
    $oCia->getSubCategorias();
    if($oCia->Cant > 0){
      for($i = 0; $i < $oCia->Cant; $i++){
        $salida .= "<option value='".$oCia->lstCategorias[$i]["SubCategoriaCodigo"]."'>".$oCia->lstCategorias[$i]["SubCategoriaDescripcion"]."</option>";
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $salida;
    }else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $salida;
    }
    echo json_encode($arrResultado);
    break;
  case 'CargarMaestroReportes':
    $arrResultado = array();
    $TypeUsu = "";
    $TypeRep = "";
    $DesCatego = "";
    $CodCatego = "";
    $Estado = "";
    $DesSubCatego = "";
    $CodSubCatego = "";
    $DesGrp = "";
    $CodGrp = "";
    $salida = "";
    $IdCia = $_POST["cia"];	
    $oRepo = new Reportes();
    $oRepo->IdCia = $IdCia;				
    $oRepo->getAllCia();
    if($oRepo->Cant != 0){
      for($i = 0; $i < $oRepo->Cant; $i++){
        $salida .= "<tr>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($i + 1)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'><div id='Repo_".$i."' idcia='".$oRepo->lstReportes[$i]["IdCia"]."' idreport='".$oRepo->lstReportes[$i]["IdReporte"]."' class='btn btn-default csBtnVisualizar'><img src='../img/ver.png'/></div></td>";
        if($oRepo->lstReportes[$i]["Estado"] == 0){
          $deshabilitar = "disabled='disabled'"; 
        }else{
          $deshabilitar = "";
        }
        $salida .= "<td style='vertical-align: middle'><div id='RPT_".$i."' idcia='".$oRepo->lstReportes[$i]["IdCia"]."' idRepo='".$oRepo->lstReportes[$i]["IdReporte"]."' class='btn btn-default csBtnEliminarRPT' ".$deshabilitar."><img src='../img/icon_delete.png' /></div></td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oRepo->lstReportes[$i]["IdReporte"]."</td>";					
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oRepo->lstReportes[$i]["NomReporte"]."</td>";
        
        switch($oRepo->lstReportes[$i]["TipoUsuario"]){
          case "E":
            $TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
            break;
          case "C":
            $TypeUsu = $oTraducir->Traducir("Fun29Cliente");						
            break;
          case "S":
            $TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
            break;
        }				
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeUsu."</td>";

        $CodGrp = $oRepo->lstReportes[$i]["Grupo"];
        $oGrp = new Grupos();
        $oGrp->CodGrupo = $CodGrp;
        $oGrp->IdCia = $IdCia;
        $oGrp->get();
        $DesGrp = $oGrp->Descripcion;

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesGrp."</td>";

        $CodCatego = $oRepo->lstReportes[$i]["Categoria"];
        $oCate = new CategSubcate();
        $oCate->IdCia = $IdCia;
        $oCate->CategoriaCodigo = $CodCatego;
        $oCate->getCategoria();
        $DesCatego = $oCate->CategoriaDescripcion;

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesCatego."</td>";

        $CodSubCatego = $oRepo->lstReportes[$i]["SubCategoria"];
        $oSubCate = new CategSubcate();
        $oSubCate->IdCia = $IdCia;
        $oSubCate->CategoriaCodigo = $CodCatego;
        $oSubCate->SubCategoriaCodigo = $CodSubCatego;
        $oSubCate->getSubCategoria();
        $DesSubCatego = $oSubCate->SubCategoriaDescripcion;

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$DesSubCatego."</td>";

        switch($oRepo->lstReportes[$i]["Estado"]){
          case "0":
            $Estado = $oTraducir->Traducir("Fun43");					
            break;
          case "1":
            $Estado = $oTraducir->Traducir("Fun44");						
            break;					
        }	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$Estado."</td>";
        
        switch($oRepo->lstReportes[$i]["TipoReporte"]){
          case "C":
            $TypeRep = $oTraducir->Traducir("Fun45");					
            break;
          case "R":
            $TypeRep = $oTraducir->Traducir("Fun46");						
            break;					
        }	
        
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeRep."</td>";
        $salida .= "</tr>";	
      }
    }else{
      $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun39")."</td></tr>";
    }						
        
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
    break;
  case 'MostrarLstReportes':
    $arrResultado = array();
    $IdCia = $_POST["idcia"];
    if($IdCia != -1){
      $iCantFil = 0;
      $uploads_dir = './archivos_pdf';
      $rutaTxt = $uploads_dir."/listado_".$_POST["idcia"].".txt";
      $salida = "<option value='-1'>--------</option>";
      if (file_exists($rutaTxt)) {
        $fil = fopen($rutaTxt, "r");
        while($Linea = fgets($fil)){
          $salida .= "<option value='".substr(trim($Linea), 0, -4)."'>".trim($Linea)."</option>";
        }
        fclose($fil);
      }
    }
    else{
      $salida = "<option value='-1'>--------</option>";
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'VisualizarReporte':
    $arrResultado = array();
    $salida = "";
    $NewSentencia = "";
    $IdCia = $_POST["cia"];
    $IdRep = $_POST["idrep"];
    $oRepo = new Reportes();
    $oRepo->IdCia = $IdCia;
    $oRepo->IdReporte = $IdRep;		
    $oRepo->get();
    if($oRepo->Cant == 1){
      $arrResultado[0] = "OK";
      $arrResultado[1] = $oRepo->IdReporte;
      $arrResultado[2] = $oRepo->NomReporte;
      $arrResultado[3] = $oRepo->TipoUsuario;
      $arrResultado[4] = $oRepo->Grupo;
      $arrResultado[5] = $oRepo->Categoria;	
      $arrResultado[6] = $oRepo->SubCategoria;
      $arrResultado[7] = $oRepo->TipoReporte;
      if($oRepo->Sentencia != ""){
        $NewSentencia = str_ireplace("&comi;", "'", $oRepo->Sentencia);
          $NewSentencia = str_ireplace("&comidob;", '"', $NewSentencia);
          $NewSentencia = str_ireplace("&arrob;", "@",  $NewSentencia);
      }
      $arrResultado[8] = $NewSentencia;
      $arrResultado[9] = $oRepo->ReporteCR;
      $arrResultado[10] = $oRepo->Estado;
      $arrResultado[11] = $oRepo->EsPayU;
      $arrResultado[12] = $oRepo->Correos;
      $arrResultado[13] = $oRepo->EsPaymentez;
    }else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun40");
    }
    echo json_encode($arrResultado);
    break;
  case 'CargarParametros_Ant':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $salida = "";
    $EsForzado = "";
    $TipoCampo = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $NomRpt = $_POST["nomrpt"];

    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;		
    $oParamR->IdReporte = $IdRepo;
    $oParamR->getAllReporte();

    if($oParamR->Cant == 0){
      $uploads_dir = './archivos_pdf';
      $rutaTxt = $uploads_dir."/param_".$_POST["nomrpt"]."_".$_POST["idcia"].".txt";
      $fil = fopen($rutaTxt, "r");
      $iCantFil = 0;
      while($Linea = fgets($fil)){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($iCantFil + 1)."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($Linea)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($Linea)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        //$salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";

        $oRepo = new Reportes();
        $oRepo->IdCia = $IdCia;
        $oRepo->IdReporte = $IdRepo;
        $oRepo->get();

        if($oRepo->Cant == 0){
          $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($Linea)."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit2'><img src='../img/icon_edit.png'/></div></td>";
        }else{
          $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($Linea)."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";	
        }

        $salida .= "</tr>";

        $iCantFil++;
      }
      fclose($fil);
      $arrResultado[0] = "OK";
    }else{
      $oConfParam = new ConfParametros();
      $oConfParam->IdCia = $IdCia;
      for($i = 0; $i < $oParamR->Cant; $i++){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["IdParametro"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["NomParametro"]."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["Descripcion"]."</td>";				

        switch($oParamR->lstParametros[$i]["EsForzado"]){
          case 0:
            $EsForzado = $oTraducir->Traducir("Fun41");					
            break;
          case 1:
            $EsForzado = $oTraducir->Traducir("Fun42");						
            break;					
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$EsForzado."</td>";

        if($oParamR->lstParametros[$i]["ParamForzado"] == "-1"){
          $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        }else{
          $oConfParam->CodParametro = $oParamR->lstParametros[$i]["ParamForzado"];
          $oConfParam->get();
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oConfParam->Descripcion."</td>";
        }							

        switch($oParamR->lstParametros[$i]["TipoCampo"]){
          case "0":
            $TipoCampo = "";					
            break;
          case "C":
            $TipoCampo = $oTraducir->Traducir("Fun47");						
            break;
          case "N":
            $TipoCampo = $oTraducir->Traducir("Fun48");						
            break;
          case "F":
            $TipoCampo = $oTraducir->Traducir("Fun49");						
            break;									
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TipoCampo."</td>";

        //$salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["VlrPrueba"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".$i."' idcia='".$oParamR->lstParametros[$i]["IdCia"]."' idreport='".$oParamR->lstParametros[$i]["IdReporte"]."' nomparam='".$oParamR->lstParametros[$i]["NomParametro"]."' descripcion='".$oParamR->lstParametros[$i]["Descripcion"]."' usaparamforza='".$oParamR->lstParametros[$i]["EsForzado"]."' paramforza='".$oParamR->lstParametros[$i]["ParamForzado"]."' tipocampo='".$oParamR->lstParametros[$i]["TipoCampo"]."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";
        $salida .= "</tr>";	
        $arrResultado[0] = "OK";
      }
    }		
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
    break;
  case 'CargarParametrosRptNuevo':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $arrData = array();
    $salida = "";
    $EsForzado = "";
    $TipoCampo = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $NomRpt = $_POST["nomrpt"];

    $uploads_dir = './archivos_pdf';
    $rutaTxt = $uploads_dir."/param_".$_POST["nomrpt"]."_".$_POST["idcia"].".txt";
    if (file_exists($rutaTxt)) {
      $fil = fopen($rutaTxt, "r");
      $iCantFil = 0;
      while($Linea = fgets($fil)){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($iCantFil + 1)."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($Linea)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($Linea)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
  
        $oRepo = new Reportes();
        $oRepo->IdCia = $IdCia;
        $oRepo->IdReporte = $IdRepo;
        $oRepo->get();
  
        if($oRepo->Cant == 0){
          $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($Linea)."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit2'><img src='../img/icon_edit.png'/></div></td>";
        }else{
          $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($Linea)."' descripcion='".trim($Linea)."' usaparamforza='0' paramforza='-1' tipocampo='0' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";	
        }
  
        $salida .= "</tr>";
        
        $arrData[$iCantFil] = array('nomParam' => trim($Linea), 'descripcion' => trim($Linea), 'idcia' => $IdCia, 'idreport' => $IdRepo, 'usaParamForzado' => '', 'paramForzado' => '', 'tipoCampo' => '', 'valorPrueba' => '', 'idTipoCampo' => '0', 'codParam' => '-1');
        $iCantFil++;
      }
      fclose($fil);
    }
    else{
      $salida = $rutaTxt;
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;	
    $arrResultado[2] = $arrData;
    echo json_encode($arrResultado);
    break;
  case 'CargarParametros':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $arrData = array();
    $salida = "";
    $EsForzado = "";
    $TipoCampo = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    //$NomRpt = $_POST["nomrpt"];

    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;		
    $oParamR->IdReporte = $IdRepo;
    $oParamR->getAllReporte();

    if($oParamR->Cant >= 0){
      $oConfParam = new ConfParametros();
      $oConfParam->IdCia = $IdCia;
      for($i = 0; $i < $oParamR->Cant; $i++){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["IdParametro"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["NomParametro"]."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["Descripcion"]."</td>";				

        switch($oParamR->lstParametros[$i]["EsForzado"]){
          case 0:
            $EsForzado = $oTraducir->Traducir("Fun41");					
            break;
          case 1:
            $EsForzado = $oTraducir->Traducir("Fun42");						
            break;					
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$EsForzado."</td>";

        if($oParamR->lstParametros[$i]["ParamForzado"] == "-1"){
            $descParamFor = '';
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$descParamFor."</td>";
        }else{
          $oConfParam->CodParametro = $oParamR->lstParametros[$i]["ParamForzado"];
          $oConfParam->get();
          $descParamFor = $oConfParam->Descripcion;
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$descParamFor."</td>";
        }							

        switch($oParamR->lstParametros[$i]["TipoCampo"]){
          case "0":
            $TipoCampo = "";					
            break;
          case "C":
            $TipoCampo = $oTraducir->Traducir("Fun47");						
            break;
          case "N":
            $TipoCampo = $oTraducir->Traducir("Fun48");						
            break;
          case "F":
            $TipoCampo = $oTraducir->Traducir("Fun49");						
            break;									
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TipoCampo."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["VlrPrueba"]."</td>";

        $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".$i."' idcia='".$oParamR->lstParametros[$i]["IdCia"]."' idreport='".$oParamR->lstParametros[$i]["IdReporte"]."' nomparam='".$oParamR->lstParametros[$i]["NomParametro"]."' descripcion='".$oParamR->lstParametros[$i]["Descripcion"]."' usaparamforza='".$oParamR->lstParametros[$i]["EsForzado"]."' paramforza='".$oParamR->lstParametros[$i]["ParamForzado"]."' tipocampo='".$oParamR->lstParametros[$i]["TipoCampo"]."' VlrPrueba='".$oParamR->lstParametros[$i]["VlrPrueba"]."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";
        $salida .= "</tr>";	
        $arrData[$i] = array('idParam' => $oParamR->lstParametros[$i]["IdParametro"], 'nomParam' => $oParamR->lstParametros[$i]["NomParametro"], 'descripcion' => $oParamR->lstParametros[$i]["Descripcion"], 'usaParamForzado' => $EsForzado, 'paramForzado' => $descParamFor, 'tipoCampo' => $TipoCampo, 'valorPrueba' => $oParamR->lstParametros[$i]["VlrPrueba"], 'idTipoCampo' => $oParamR->lstParametros[$i]["TipoCampo"], 'codParam' => $oParamR->lstParametros[$i]["ParamForzado"]);
        $arrResultado[0] = "OK";
      }
    }		
    $arrResultado[1] = $salida;		
    $arrResultado[2] = $arrData;
    echo json_encode($arrResultado);
    break;
  case 'ProbarSentencia':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $SenteSQL = $_POST["senten"];

    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;		
    $oParamR->IdReporte = $IdRepo;
    $oParamR->getAllReporte();

    if($oParamR->Cant >= 0){
      for($i = 0; $i < $oParamR->Cant; $i++){
        $nomInter = $oParamR->lstParametros[$i]["NomParametro"];
        $valPrueba = $oParamR->lstParametros[$i]["VlrPrueba"];
        $SenteSQL = str_replace($nomInter, $valPrueba, $SenteSQL);
      }
    }
    $arrResultado[0] = "OK";			
    $arrResultado[1] = $SenteSQL;		
    echo json_encode($arrResultado);
    break;

  case 'CrearReporte':
    $arrResultado = array();
    $Resp = "OK";
    $NewSentencia = "";
    $IdCia = $_POST["idcia"];			
    $NomRepo = $_POST["nombrerepo"];
    $TipoUsu = $_POST["tipousu"];
    $Grupo = $_POST["grupo"];
    $Categoria = $_POST["catego"];
    $SubCatego = $_POST["subcatego"];
    $TipoRepo = $_POST["tiporepo"];					
    $Sentencia = $_POST["sentencia"];
    $ReporteCR = $_POST["nomrpt"];
    $IdUsuario = $_POST["idusu"];
    $EsPayU = $_POST["payu"];
    $Correos = $_POST["correos"];
    $EsPaymentez = $_POST["paymentez"];
    if($Sentencia != ""){
      $NewSentencia = str_ireplace("'", "&comi;", $Sentencia);
        $NewSentencia = str_ireplace('"', "&comidob;", $NewSentencia);
        $NewSentencia = str_ireplace("@", "&arrob;", $NewSentencia);
    }
    $oRep = new Reportes();		
    $oRep->IdCia = $IdCia;		
    $oRep->NomReporte = $NomRepo;
    $oRep->TipoUsuario = $TipoUsu;
    $oRep->Grupo = $Grupo;
    $oRep->Categoria = $Categoria;	
    $oRep->SubCategoria = $SubCatego;
    $oRep->TipoReporte = $TipoRepo;
    $oRep->Sentencia = $NewSentencia;	
    $oRep->ReporteCR = $ReporteCR;
    $oRep->EsPayU = $EsPayU;
    $oRep->Correos = $Correos;
    $oRep->EsPaymentez = $EsPaymentez;
    $oRep->UsuarioRegistro = $IdUsuario;
    $oRep->add();
    if($oRep->Error == true){
      $Resp = "Error. ".$oRep->Msg;
    }
    else{			
      $Resp = "OK";
      $IdRepo = $oRep->IdReporte; 
    }

    if($Resp == "OK"){
      if($TipoRepo == "R"){
        $uploads_dir = './archivos_pdf';
        $rutaTxt = $uploads_dir."/param_".$_POST["nomrpt"]."_".$_POST["idcia"].".txt";
        if (file_exists($rutaTxt)) {
          $fil = fopen($rutaTxt, "r");
          $iCantFil = 0;
          while($Linea = fgets($fil)){
            $oParamR = new ReporteParametros();		
            $oParamR->IdCia = $IdCia;		
            $oParamR->IdReporte = $IdRepo;
            $oParamR->IdParametro = ($iCantFil +1);
            $oParamR->Descripcion = trim($Linea);
            $oParamR->NomParametro = trim($Linea);	
            $oParamR->EsForzado = 0;
            $oParamR->ParamForzado = "-1";
            $oParamR->TipoCampo = "0";	
            //$oParamR->VlrPrueba = "";					
            $oParamR->add();
            if($oParamR->Error == true){
              $Resp = "Error. ".$oParamR->Msg;
            }
            else{			
              $Resp = "OK";
            }
            $iCantFil++;
          }
          fclose($fil);
        }
      }else{
        $iCantFil = 0;
        for($i = 0; $i <= 19; $i++){
          $strPar = "[%".$i."]";
          $pos = strpos($Sentencia, $strPar);
          if($pos != false){
            $oParamR = new ReporteParametros();		
            $oParamR->IdCia = $IdCia;		
            $oParamR->IdReporte = $IdRepo;
            $oParamR->IdParametro = ($iCantFil + 1);
            $oParamR->Descripcion = trim($strPar);
            $oParamR->NomParametro = trim($strPar);	
            $oParamR->EsForzado = 0;
            $oParamR->ParamForzado = "-1";
            $oParamR->TipoCampo = "0";	
            //$oParamR->VlrPrueba = "";					
            $oParamR->add();
            if($oParamR->Error == true){
              $Resp = "Error. ".$oParamR->Msg;
            }
            else{			
              $Resp = "OK";
            }
            $iCantFil++;
          }
          $arrResultado[0] = "OK";
        }
      }			
    }
    $arrResultado[0] = $Resp;
    $arrResultado[1] = $IdRepo;
    $arrResultado[2] = $NewSentencia;
    echo json_encode($arrResultado);
    break;
  case 'ActualizarReporte':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["idcia"];
    $IdRep = $_POST["idrep"];			
    $NomRepo = $_POST["nombrerepo"];
    $TipoUsu = $_POST["tipousu"];
    $Grupo = $_POST["grupo"];
    $Categoria = $_POST["catego"];
    $SubCatego = $_POST["subcatego"];
    $TipoRepo = $_POST["tiporepo"];					
    $Sentencia = $_POST["sentencia"];
    $ReporteCR = $_POST["nomrpt"];
    $IdUsuario = $_POST["idusu"];
    $EsPayU = $_POST["payu"];	
    $nomFile = $_POST["nomfile"];	
    $Correos = $_POST["correos"];
    $EsPaymentez = $_POST["paymentez"];
    $oRep = new Reportes();		
    $oRep->IdCia = $IdCia;
    $oRep->IdReporte = $IdRep;		
    $oRep->NomReporte = $NomRepo;
    $oRep->TipoUsuario = $TipoUsu;
    $oRep->Grupo = $Grupo;
    $oRep->Categoria = $Categoria;	
    $oRep->SubCategoria = $SubCatego;
  $oRep->TipoReporte = $TipoRepo;
  $oRep->Correos = $Correos;
    if($Sentencia != ""){
      $NewSentencia = str_ireplace("'", "&comi;", $Sentencia);
        $NewSentencia = str_ireplace('"', "&comidob;", $NewSentencia);
        $oRep->Sentencia = str_ireplace("@", "&arrob;", $NewSentencia);
    }
    $oRep->ReporteCR = $ReporteCR;
    $oRep->EsPayU = $EsPayU;
    $oRep->nomFile = $nomFile;	
    $oRep->EsPaymentez = $EsPaymentez;
    $oRep->update();
    if($oRep->Error == true){
      $Resp = "Error. ".$oRep->Msg;
    }
    else{			
      $Resp = "OK";
      if($TipoRepo == "C"){
        $iCantFil = 0;
        for($i = 0; $i <= 19; $i++){
          $strPar = "[%".$i."]";
          $pos = strpos($Sentencia, $strPar);
          if($pos != false){
            $oParamR = new ReporteParametros();		
            $oParamR->IdCia = $IdCia;		
            $oParamR->IdReporte = $IdRep;
            $oParamR->IdParametro = ($iCantFil + 1);
            $oParamR->Descripcion = trim($strPar);
            $oParamR->NomParametro = trim($strPar);	
            $oParamR->EsForzado = 0;
            $oParamR->ParamForzado = "-1";
            $oParamR->TipoCampo = "0";	
            //$oParamR->VlrPrueba = "";	
            $oParamR->get();	
            if($oParamR->Cant == 0){			
              $oParamR->add();
              if($oParamR->Error == true){
                $Resp = "Error. ".$oParamR->Msg;
              }
              else{			
                $Resp = "OK";
              }
            }
            else{
              $Resp = "OK";
            }
            $iCantFil++;
          }
          $arrResultado[0] = "OK";
        }
      }
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'EditarParametros':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $salida = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $NomParam = $_POST["nomparam"];

    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;		
    $oParamR->IdReporte = $IdRepo;
    $oParamR->NomParametro = $NomParam;

    $oParamR->get();

    if($oParamR->Cant == 1){		
      $arrResultado[0] = "OK";
      $arrResultado[1] = $oParamR->IdReporte;
      $arrResultado[2] = $oParamR->IdParametro;
      $arrResultado[3] = $oParamR->Descripcion;
      $arrResultado[4] = $oParamR->NomParametro;
      $arrResultado[5] = $oParamR->EsForzado;	
      $arrResultado[6] = $oParamR->ParamForzado;
      $arrResultado[7] = $oParamR->TipoCampo;
      //$arrResultado[8] = $oParamR->VlrPrueba;	
      $arrResultado[9] = $oParamR->Msg;
    }else{
      $arrResultado[0] = "Error";
      $arrResultado[1] = $oTraducir->Traducir("Fun50");
    }	
    echo json_encode($arrResultado);
    break;
  case 'ActualizarParametros':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["idcia"];
    $IdRep = $_POST["idrep"];			
    $NomParam = $_POST["nomparam"];
    $Descrip = $_POST["descripc"];
    $EsForzado = $_POST["esforzado"];
    $ParamForza = $_POST["paramforza"];
    $TipoCampo = $_POST["tipocampo"];
    $VlrPrueba = $_POST["vlrprueba"];
    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;
    $oParamR->IdReporte = $IdRep;		
    $oParamR->NomParametro = $NomParam;
    $oParamR->Descripcion = $Descrip;
    $oParamR->EsForzado = $EsForzado;
    $oParamR->ParamForzado = $ParamForza;	
    $oParamR->TipoCampo = $TipoCampo;
    $oParamR->VlrPrueba = $VlrPrueba;					
    $oParamR->update();
    if($oParamR->Error == true){
      $Resp = "Error. ".$oParamR->Msg;
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'CargarLstReportes':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["idcia"];
    $uploads_dir = './archivos_pdf';
    $rutaTxt = $uploads_dir."/listado_".$_POST["idcia"].".txt";
    if (file_exists($rutaTxt)) {
      unlink($rutaTxt);
    }
    $oCia = new Compania();
    $oCia->IdCia = $_POST["idcia"];
    $oCia->get();
    $oPeti = new Peticiones();
    $oPeti->sigId();
    $oPeti->IdPeticion = $oPeti->Cant;
    $oPeti->NitCia = $oCia->NitCia;
    $oPeti->CodVerificacion = $oCia->CodVerificacion;
    $oPeti->TipoPeticion = 3; 
    $oPeti->add();
    $arrResultado[0] = "OK";
    $arrResultado[1] = $oPeti->IdPeticion;
    echo json_encode($arrResultado);
    break;
  case 'PeticionLstArchivos':
    $arrResultado = array();
    $salida = "";
    $IdCia = $_POST["idcia"];
    $uploads_dir = './archivos_pdf';
    $rutaTxt = $uploads_dir."/listado_".$_POST["idcia"].".txt";
    if (file_exists($rutaTxt)) {
      $arrResultado[0] = "OK";
    }
    else{
      $arrResultado[0] = "AUN NO";
    }
    echo json_encode($arrResultado);
    break;
  case 'ActualizarEstadoReporte':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["idcia"];
    $IdRep = $_POST["idrep"];			
    $Estado = $_POST["estado"];		
    $oRepo = new Reportes();		
    $oRepo->IdCia = $IdCia;
    $oRepo->IdReporte = $IdRep;		
    $oRepo->Estado = $Estado;
    $oRepo->updateEstado();
    if($oRepo->Error == true){
      $Resp = "Error. ".$oRepo->Msg;
    }
    else{			
      $Resp = "OK";
    }
    $arrResultado[0] = $Resp;
    echo json_encode($arrResultado);
    break;
  case 'CargarParametrosCons_Ant':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $salida = "";
    $EsForzado = "";
    $TipoCampo = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $TxtCons = $_POST["txtcons"];

    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;		
    $oParamR->IdReporte = $IdRepo;
    $oParamR->getAllReporte();

    if($oParamR->Cant == 0){
      $iCantFil = 0;
      for($i = 0; $i <= 19; $i++){
        $strPar = "[%".$i."]";
        $pos = strpos($TxtCons, $strPar);
        if($pos != false){
          $salida .= "<tr>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".($iCantFil + 1)."</td>";	
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($strPar)."</td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($strPar)."</td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
          $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";	
          $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
          //$salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";

          $oRepo = new Reportes();
          $oRepo->IdCia = $IdCia;
          $oRepo->IdReporte = $IdRepo;
          $oRepo->get();

          if($oRepo->Cant == 0){
            $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($Linea)."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit2'><img src='../img/icon_edit.png'/></div></td>";
          }else{
            $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($Linea)."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";	
          }

          $salida .= "</tr>";

          $iCantFil++;
        }
        $arrResultado[0] = "OK";
      }
    }else{
      $oConfParam = new ConfParametros();
      $oConfParam->IdCia = $IdCia;
      for($i = 0; $i < $oParamR->Cant; $i++){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["IdParametro"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["NomParametro"]."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["Descripcion"]."</td>";
        
        switch($oParamR->lstParametros[$i]["EsForzado"]){
          case 0:
            $EsForzado = $oTraducir->Traducir("Fun41");					
            break;
          case 1:
            $EsForzado = $oTraducir->Traducir("Fun42");						
            break;					
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$EsForzado."</td>";
        
        if($oParamR->lstParametros[$i]["ParamForzado"] == "-1"){
          $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        }else{
          $oConfParam->CodParametro = $oParamR->lstParametros[$i]["ParamForzado"];
          $oConfParam->get();
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oConfParam->Descripcion."</td>";
        }	
        
        switch($oParamR->lstParametros[$i]["TipoCampo"]){
          case "0":
            $TipoCampo = "";					
            break;
          case "C":
            $TipoCampo = $oTraducir->Traducir("Fun47");						
            break;
          case "N":
            $TipoCampo = $oTraducir->Traducir("Fun48");						
            break;
          case "F":
            $TipoCampo = $oTraducir->Traducir("Fun49");						
            break;									
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TipoCampo."</td>";
        
        //$salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["VlrPrueba"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".$i."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".$oParamR->lstParametros[$i]["NomParametro"]."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";
        $salida .= "</tr>";	
        $arrResultado[0] = "OK";		
      }
    }
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
    break;
  case 'CargarParametrosConsNueva':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $salida = "";
    $EsForzado = "";
    $TipoCampo = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $TxtCons = $_POST["txtcons"];

    $iCantFil = 0;
    for($i = 0; $i <= 19; $i++){
      $strPar = "[%".$i."]";
      $pos = strpos($TxtCons, $strPar);
      if($pos != false){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".($iCantFil + 1)."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($strPar)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".trim($strPar)."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";

        $oRepo = new Reportes();
        $oRepo->IdCia = $IdCia;
        $oRepo->IdReporte = $IdRepo;
        $oRepo->get();

        if($oRepo->Cant == 0){
          $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($strPar)."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit2'><img src='../img/icon_edit.png'/></div></td>";
        }else{
          $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".($iCantFil + 1)."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".trim($strPar)."' descripcion='".trim($strPar)."' usaparamforza='0' paramforza='-1' tipocampo='0' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";	
        }

        $salida .= "</tr>";

        $iCantFil++;
      }
      $arrResultado[0] = "OK";
    }
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
    break;
  /*case 'CargarParametrosCons':
    $arrResultado = array();
    $arrParam = array();
    $arrParametros = array();
    $salida = "";
    $EsForzado = "";
    $TipoCampo = "";
    $IdCia = $_POST["idcia"];
    $IdRepo = $_POST["idrepo"];
    $TxtCons = $_POST["txtcons"];

    $oParamR = new ReporteParametros();		
    $oParamR->IdCia = $IdCia;		
    $oParamR->IdReporte = $IdRepo;
    $oParamR->getAllReporte();

    if($oParamR->Cant > 0){
      $oConfParam = new ConfParametros();
      $oConfParam->IdCia = $IdCia;
      for($i = 0; $i < $oParamR->Cant; $i++){
        $salida .= "<tr>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["IdParametro"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["NomParametro"]."</td>";	
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["Descripcion"]."</td>";
        
        switch($oParamR->lstParametros[$i]["EsForzado"]){
          case 0:
            $EsForzado = "No";					
            break;
          case 1:
            $EsForzado = "Si";						
            break;					
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$EsForzado."</td>";
        
        if($oParamR->lstParametros[$i]["ParamForzado"] == "-1"){
          $salida .= "<td style='vertical-align: middle; text-align: center;'>&nbsp</td>";
        }else{
          $oConfParam->CodParametro = $oParamR->lstParametros[$i]["ParamForzado"];
          $oConfParam->get();
          $salida .= "<td style='vertical-align: middle; text-align: center;'>".$oConfParam->Descripcion."</td>";
        }	
        
        switch($oParamR->lstParametros[$i]["TipoCampo"]){
          case "0":
            $TipoCampo = "";					
            break;
          case "C":
            $TipoCampo = "Cadena";						
            break;
          case "N":
            $TipoCampo = "Númerico";						
            break;
          case "F":
            $TipoCampo = "Fecha";						
            break;									
        }

        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TipoCampo."</td>";
        
        //$salida .= "<td style='vertical-align: middle; text-align: center;'>".$oParamR->lstParametros[$i]["VlrPrueba"]."</td>";
        $salida .= "<td style='vertical-align: middle; text-align: center;'><div idparam ='".$i."' idcia='".$IdCia."' idreport='".$IdRepo."' nomparam='".$oParamR->lstParametros[$i]["NomParametro"]."' class='btn btn-default csBtnEditar' data-toggle='modal' data-target='#modalEdit'><img src='../img/icon_edit.png'/></div></td>";
        $salida .= "</tr>";	
        $arrResultado[0] = "OK";		
      }
    }
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
  break;*/
  case 'ComboCiasUsua':
    $arrResultado = array();
    $salida = "<option value='-1'>--------</option>";
    $IdUsu = $_POST["idusu"];				
    $Estado = 1;
    $oCia = new Compania();
    $oCia->UsuarioReg = $IdUsu;
    $oCia->getAllUs();
    if($oCia->Cant != 0){
      for($i = 0; $i < $oCia->Cant; $i++){
        $salida .= "<option value='".$oCia->lstCias[$i]["IdCia"]."'>".$oCia->lstCias[$i]["NomCia"]."</option>";
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $salida;
    }else{
      $arrResultado[0] = "Error";	
      $arrResultado[1] = $salida;		
    }
    echo json_encode($arrResultado);
    break;
  case 'ComboCiasUsuaAdn':
    $arrResultado = array();
    $arrData = array();
    $salida = "<option value='-1'>--------</option>";
    $IdUsu = $_POST["idusu"];				
    $Estado = 1;
    $oGrpUser = new Grupos();
    $oGrpUser->UserAdmin = $IdUsu;
    $oGrpUser->getCiaADN();
    if($oGrpUser->Cant != 0){
      for($i = 0; $i < $oGrpUser->Cant; $i++){
        $salida .= "<option tipoAdn='".$oGrpUser->lstGrupos[$i]["tipoADN"]."'  value='".$oGrpUser->lstGrupos[$i]["IdCiaGrp"]."'>".$oGrpUser->lstGrupos[$i]["NomCia"]."</option>";
        $arrData[$i] = array('value' => $oGrpUser->lstGrupos[$i]["IdCiaGrp"], 'tipoAdn' => $oGrpUser->lstGrupos[$i]["tipoADN"], 'nomCia' => $oGrpUser->lstGrupos[$i]["NomCia"]);
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $salida;
      $arrResultado[2] = $arrData;
    }else{
      $arrResultado[0] = "Error";	
      $arrResultado[1] = $salida;		
    }
    echo json_encode($arrResultado);
    break;
  case 'ComboParametros':
    $arrResultado = array();
    $IdCia = $_POST["cia"];
    $salida = "<option value='-1' desc='' selected>--------</option>";
    $oConfParam = new ConfParametros();
    $oConfParam->IdCia = $IdCia;
    $oConfParam->getCia();
    if($oConfParam->Cant != 0){
      for($i = 0; $i < $oConfParam->Cant; $i++){
        $salida .= "<option value='".$oConfParam->lstConParam[$i]["CodParametro"]."' desc='".$oConfParam->lstConParam[$i]["Descripcion"]."'>".$oConfParam->lstConParam[$i]["Descripcion"]."</option>";
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $salida;
    }else{
      $arrResultado[0] = "Error";	
      $arrResultado[1] = $salida;		
    }
    //$arrResultado[0] = "OK";
    //$arrResultado[1] = $salida;
    echo json_encode($arrResultado);
    break;
  case 'CargarLbParam':
    $arrResultado = array();
    $IdCia = $_POST["cia"];
    $oConfParam = new ConfParametros();
    $oConfParam->IdCia = $IdCia;
    $oConfParam->getCia();
    if($oConfParam->Cant != 0){
      $arrResultado[0] = "OK";
      for($i = 0; $i < $oConfParam->Cant; $i++){
        $arrResultado[($i+1)] = $oConfParam->lstConParam[$i]["Descripcion"];
      }
    }else{
      $arrResultado[0] = "Error";	
      $arrResultado[1] = $salida;		
    }
    echo json_encode($arrResultado);
    break;
  case 'CargarParamCia':
    $arrResultado = array();
    $TypeUsu = "";		
    $salida = "";
    $IdCia = $_POST["cia"];	
    $oConfParam = new ConfParametros();
    $oConfParam->IdCia = $IdCia;		
    $oConfParam->getCia();
    if($oConfParam->Error == false){
      if($oConfParam->Cant > 0){
        for($i = 0; $i < $oConfParam->Cant; $i++){
          $salida .= "<tr>";					
          $salida .= "<td style='vertical-align: middle'>".($i + 1)."</td>";
          //$salida .= "<td style='vertical-align: middle'>".$oConfParam->lstConParam[$i]["CodParametro"]."</td>";					
          $salida .= "<td style='vertical-align: middle'>".$oConfParam->lstConParam[$i]["Descripcion"]."</td>";					
          $salida .= "</tr>";					
        }
      }
      else{
        $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun51")."</td></tr>";				
      }
    }
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;		
    echo json_encode($arrResultado);
    break;
  case 'ActualizarParam':
    $arrResultado = array();
    $Resp = "OK";		
    $IdCia = $_POST["cia"];		
    $CodPar = $_POST["codpar"];
    $DesPar = $_POST["despar"];
    $oConfParam = new ConfParametros();
    $oConfParam->IdCia = $IdCia;
    $oConfParam->CodParametro = $CodPar;
    $oConfParam->Descripcion = $DesPar;
    $oConfParam->update();
    if($oConfParam->Error == false){
      $Resp = "OK";
    }
    else{			
      $Resp = "Error";
    }
    $arrResultado[0] = $Resp;
    $arrResultado[1] = $oConfParam->Msg;
    echo json_encode($arrResultado);
    break;
  case 'VerificarDominio':
      $arrResultado = array();
      $Resp = "OK";
      $NitCia = $_POST["nitcia"];
      $Dominio = $_POST["dominio"];
      $oCia = new Compania();
      $oCia->Dominio = $Dominio;
      $oCia->getCiaDominio();
      if($oCia->Cant == 1){
        if($oCia->NitCia == $NitCia){
          $Resp = "OK";					
        }else{
          $Resp = $oTraducir->Traducir("Fun52");
        }				
      }
      else{
        $Resp = "OK";
      }	
      $arrResultado[0] = $Resp;
      echo json_encode($arrResultado);
      break;
  case 'CargarMsgIdiomaPag':
    $arrResultado = array();
    $arrTraduccion = array();
    $salida = "";
    $IdPagina = $_POST["idpag"];
    $IdIdioma = $_POST["ididioma"];
    $oTraducir->IdIdioma = $IdIdioma;
    $oTraducir->IdPagina = $IdPagina;
    $oTraducir->cargarListado();
    if($oTraducir->nCant != 0){
      for($i = 0; $i < $oTraducir->nCant; $i++){
    $arrTraduccion[$oTraducir->lstIdiomaTexto[$i]["Texto"]] = $oTraducir->lstIdiomaTexto[$i]["Traduccion"];
      }
      $arrResultado[0] = "OK";
      $arrResultado[1] = $arrTraduccion;
    }else{
      $arrResultado[0] = "Error";	
      $arrResultado[1] = "Error";
    }
    echo json_encode($arrResultado);
    break;
  case 'BaseCase':
    $arrResultado = array();
    $salida = "";
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    echo json_encode($arrResultado);
  break;
  case 'CargarArchivoTxt':
  $arrResultado = array();
  $resp = "OK";
  $nomFile = $_POST["nomFile"];
    $salidaHTML = "";
    $contador = 0;
  $uploads_dir = 'archivos_txt';
    $rutaTxt = $uploads_dir."/".$nomFile; 
  $lineas = file($rutaTxt);

  foreach($lineas as $linea_num => $linea){
    $datos = explode("\t", $linea);
    $email = trim($datos[0]);
    $nomUs = trim($datos[1]);
    $nomCia = trim($datos[2]);
    $NitCia = trim($datos[3]);
    $TipoUs = trim($datos[4]);
    $grpUs = trim($datos[5]);
    $coSoNeg = trim($datos[6]);
    $nit = trim($datos[7]);
    $empVen = trim($datos[8]);
    $almacen = trim($datos[9]);
    $ifrs = trim($datos[10]);
    $ciudad = trim($datos[11]);
    $telef = trim($datos[12]);
    $Param7 = trim($datos[13]);
    $Param8 = trim($datos[14]);
    $Param9 = trim($datos[15]);

    $salidaHTML .= "<tr>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".($linea_num + 1)."</td>";	
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center; display:none;'><div id='User_".$linea_num ."' email='".$email."' nomUs='".$nomUs."' nomCia='".$nomCia."' NitCia='".$NitCia."' TipoUs='".$TipoUs."' grpUs='".$grpUs."' coSoNeg='".$coSoNeg."' nit='".$nit."' empVen='".$empVen."' almacen='".$almacen."' ifrs='".$ifrs."' ciudad='".$ciudad."' telef='".$telef."' Param7='".$Param7."' Param8='".$Param8."' Param9='".$Param9."' class='btn btn-default csBtnSendForm'><img src='../img/ver.png'/></div></td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$email."</td>";	
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$nomUs."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$nomCia."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$NitCia."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$TipoUs."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$grpUs."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$coSoNeg."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$nit."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$empVen."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$almacen."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$ifrs."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$ciudad."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$telef."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$Param7."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$Param8."</td>";
    $salidaHTML .= "<td style='vertical-align: middle; text-align: center;'>".$Param9."</td>";	
      $salidaHTML .= "</tr>";
      $contador++;
  }

    $arrResultado[0] = $salidaHTML;
    $arrResultado[1] = "<h3>".$oTraducir->Traducir("Fun64")." <span>".$contador."</span></h3>";
  echo json_encode($arrResultado);
  break;
  case 'EnviarEmail':
  $arrResultado = array();
  $resp = "OK";
  $idUsu = $_POST["idUsu"];
  $idCia = $_POST["idCia"];
  $nom = $_POST["nom"];
  $UsuMultiCia = new MultiCompania();
  $UsuMultiCia->IdUsuario = $idUsu;
  $UsuMultiCia->IdCia = $idCia;
  $UsuMultiCia->updateToken();
  $UsuMultiCia->getUsCia();
  $token = $UsuMultiCia->token;

  $ObjDatosCia = new Compania();
  $ObjDatosCia->IdCia = $idCia;
  $ObjDatosCia->get();

  $mail = new PHPMailer();

  $mail->CharSet = 'UTF-8';

  $mail->setFrom('noresponder@miportalsap.com', 'MiPortalSap ');

  $mail->addAddress($_POST["email"], 'Correo: ');

  $mail->Subject  = 'Activación de Cuenta en MiPortalSap';

  $mail->IsHTML(true);

  $cuerpo = '<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
      #IdBody{
      background-image: url(https://www.miportalsap.com/app_button/Phone/img/css30anios.jpg);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      background-color: #cfd6e4;
      font-family: Arial, Helvetica, sans-serif;
      }
      .contendorInfo{
      box-shadow: 14px 15px 69px -10px #d0c1c1;
      background-color: rgba(255,255,255,0.9);
      max-width: 968px;
      margin: auto;
      }
      .contendorInfo h1{
      background-color: #111f3e;
      color: #fff;
      padding: 14px 25px;
      text-align: center;
      }
      .infoEmail img{
      width: 200px;
      }
      .infoEmail{
      padding: 25px 95px;
      }
      .infoEmail p{
      font-size: 18px;
      letter-spacing: 1px;
      line-height: 28px;
      }
      .footerInfo{
      background-color: #111f3e;
      color: #fff;
      padding: 2px 25px 14px;
      text-align: center;
      }
      .footerInfo p a{
      color: #cfd6e4;
      text-decoration: none;
      }
  
      /*****  @medias Querys responsive **************/ 
      @media(max-width:992px){
      .contendorInfo{
        max-width: 75%;
      }
      .infoEmail {
        padding: 25px 30px;
      }
      }
      @media(max-width:620px){
      .contendorInfo{
        max-width: 95%;
      }
      }
    </style>
    </head>
    <body id="IdBody">
    <div class="contendorInfo">
      <h1>Activación de cuenta MiportalSap</h1>
      <div class="infoEmail">
      <img src="https://www.miportalsap.com/images/logo-css-sap-pq.png" style="width: 200px;">
      <h2>Este Correo electrónico es para la activación de su cuenta en MiPortalSap : </h2>
      <h3>La Compañía '.$ObjDatosCia->NomCia.' con el NIT '.$ObjDatosCia->NitCia.' le ha enviado la preactivación de su cuenta en MiPortalSap</h3>
      <h3> A continuaci&oacute;n de clic en el bot&oacute;n Activar Cuenta para continuar con el proceso.  </h3><br><br>
      <a href="https://www.miportalsap.com/app_portal/pags/reg_activa_usuario.php?tok='.$token.'" target="_blank" style="color: #fff;
      background-color: #337ab7; border-color: #2e6da4;padding: 6px 12px;font-size: 14px;">Activar Cuenta</a> <br>
      <p>Este es un servicio exclusivo de MiPortalSap usando Internet de las cosas (loT)</p>
      </div>
      <div class="footerInfo">
      <p>Genera y solicita tus reportes en cualquier momento desde el bot&oacute;n MiPortalSap. Mas informaci&oacute;n visitanos en:  <a href="http://www.consensussap.com/">www.consensussap.com</a></p>
      <em>&copy;2020 - Consensus S.A.S - Todos los derechos reservados.</em>
      </div>
    </div>	
    </body>
  </html>';

  $mail->Body = $cuerpo;
  
  if ($mail->send()) {
    $resp = "OK";
  }
  else{
    $resp = "No se pudo enviar el correo";
  }

  $arrResultado[0] = $resp;
  echo json_encode($arrResultado);
  break;
  case 'UpdateUsActivo':
  $arrResultado = array();
  $resp = "OK";
  $IdUser = $_POST['IdUser'];
  $IdCia = $_POST['IdCia'];
  $correo = $_POST['correo'];
  $nomCliente = $_POST['nomCliente'];
  $nunIden = $_POST['nunIden'];
  $pass = $_POST['pass'];
  $estado = "1";

  $oUser = new Usuario();
  $oUser->Nombre = $nomCliente;
  $oUser->Clave = $pass;
  $oUser->IdUsuario = $IdUser;
  $oUser->updateUserAc();
  
  $UsuMultiCia = new MultiCompania();
    $UsuMultiCia->IdUsuario = $IdUser;
  $UsuMultiCia->IdCia = $IdCia;
  $UsuMultiCia->NroIdentificacion = $nunIden;
  $UsuMultiCia->NomCliente = $nomCliente;
  $UsuMultiCia->Estado = $Estado;
  $UsuMultiCia->updateUsActivo();

  $arrResultado[0] = $resp;
  echo json_encode($arrResultado);
  break; 
  case 'ComboUserAdmin':
    $arrResultado = array();
  $salida = "<option value='-1'>------------</option>";
  $idcia = $_POST["idcia"];
  $tipoUsu = $_POST["tipoUsu"];
    $oUsAdm = new Usuario();
  $oUsAdm->IdCia = $idcia;
  $oUsAdm->TipoUsuario = $tipoUsu;
  $oUsAdm->getTipoGrupoUsua();
  $Estado = "";
    if($oUsAdm->Error == false){
    for($i = 0; $i < $oUsAdm->Cant; $i++){
    $Estado = $oUsAdm->CbGrupUser[$i]["Estado"];
    if ($Estado >= 1) {
      $salida .= "<option value='".$oUsAdm->CbGrupUser[$i]["IdUsuario"] ."'>".$oUsAdm->CbGrupUser[$i]["Nombre"]."</option>";
    }
      }
  }
    $arrResultado[0] = $salida;
    $arrResultado[1] = $oUsAdm->Cant;
    echo json_encode($arrResultado);
  break;
  case 'ingresarComentario':
  $arrResultado = array();
  $IdCia = $_POST['Idcia'];
  $IdUsua = $_POST['Idusua'];
  $IdReporte = $_POST['Idreporte'];
  $NomRepor = $_POST['Nomrepor'];
  $Comentario = $_POST['comentario'];
  $Estado = 0;

  $oUsDest = new Compania();
  $oUsDest->IdCia = $IdCia; 
  $oUsDest->get();
  $IdUsDest = $oUsDest->UsuarioReg; 
  
  $oComent = new Comentarios();
  $oComent->IdCia = $IdCia; 
  $oComent->IdUsua = $IdUsua;
  $oComent->IdUsuDes = $IdUsDest;
  $oComent->IdReporte = $IdReporte;
  $oComent->NomReporte = $NomRepor;
  $oComent->Comentario = $Comentario;
  $oComent->Estado = $Estado;
  $oComent->addComentario(); 
  if ($oComent->Error == false) {
    $arrResultado[0] = "OK";
  }else{
    $arrResultado[0] = "ERROR";
  }

  echo json_encode($arrResultado);
  break;
  case 'ingresarComentarioAdmin':
  $arrResultado = array();
  $IdCia = $_POST['Idcia'];
  $IdUsua = $_POST['Idusua'];
  $IdUsDest = $_POST['idusdest'];
  $IdReporte = $_POST['Idreporte'];
  $NomRepor = $_POST['Nomrepor'];
  $Comentario = $_POST['comentario'];
  $Estado = 0;
  
  $oComent = new Comentarios();
  $oComent->IdCia = $IdCia; 
  $oComent->IdUsua = $IdUsua;
  $oComent->IdUsuDes = $IdUsDest;
  $oComent->IdReporte = $IdReporte;
  $oComent->NomReporte = $NomRepor;
  $oComent->Comentario = $Comentario;
  $oComent->Estado = $Estado;
  $oComent->addComentario(); 
  if ($oComent->Error == false) {
    $arrResultado[0] = "OK";
  }else{
    $arrResultado[0] = "ERROR";
  }

  echo json_encode($arrResultado);
  break;
  case 'mostrarComentario':
  $arrResultado = array();
  $Salida = "";

  $oGetComm = new Comentarios();
  $oGetComm->IdCia = $_POST['Idcia']; 
  $oGetComm->IdUsua = $_POST['Idusua'];
  $oGetComm->IdReporte = $_POST['Idreporte'];
  $oGetComm->getComentPublicar();
    for ($i=0; $i < $oGetComm->Cant; $i++) { 
    $Salida .= "<div class='ContComentario'>";
    $Salida .= "<h2><i class='fas fa-user-tie'></i> ".$oGetComm->lstComent[$i]["NomUsua"]."<span class='fecha'><i class='far fa-calendar-alt'></i> ".$oGetComm->lstComent[$i]["FechaComm"]." </span></h2>";
    $Salida .= "<h3 class='compania'> ".$oGetComm->lstComent[$i]["NomCia"]."</h3>";
    $Salida .= "<h3 class='nomReporte'> ".$oGetComm->lstComent[$i]["NomReporte"]."</h3>";
    $Salida .= "<p>".$oGetComm->lstComent[$i]["Comentario"]."</p>";  
    $Salida .= "</div>";    
    }

  $arrResultado[0] = $Salida;
  echo json_encode($arrResultado);
  break;
  case 'enviarEmailUsDestino':
    $arrResultado = array();
    $IdCia = $_POST['Idcia'];

    $oUsDest = new Compania();
    $oUsDest->IdCia = $IdCia; 
    $oUsDest->get();
    $IdUsDest = $oUsDest->UsuarioReg; 

    $oCorreoDes = new Comentarios();
    $oCorreoDes->IdUsuDes = $IdUsDest;
    $oCorreoDes->getEmailUsDestino();
    
    $mail = new PHPMailer();

    $mail->CharSet = 'UTF-8';

    $mail->setFrom('noresponder@miportalsap.com', 'MiPortalSap ');

    $mail->addAddress($oCorreoDes->EmailDes, 'Correo: ');
    //$mail->addAddress('gtobonbarco@gmail.com', 'Correo: ');

    $mail->Subject  = 'Notificación de comentario a un reporte en MiPortalSap';

    $mail->IsHTML(true);

    $cuerpo = '<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style type="text/css">
          #IdBody{
            background-image: url(https://www.miportalsap.com/app_button/Phone/img/Fondo_Infinity_Goals.jpg);
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            background-color: #cfd6e4;
            font-family: Arial, Helvetica, sans-serif;
          }
          .contendorInfo{
            box-shadow: 14px 15px 69px -10px #d0c1c1;
            background-color: rgba(255,255,255,0.9);
            max-width: 968px;
            margin: auto;
          }
          .contendorInfo h1{
            background-color: #111f3e;
            color: #fff;
            padding: 14px 25px;
            text-align: center;
          }
          .contendorInfo h3{
            font-size: 23px;
          }
          .infoEmail img{
            width: 200px;
          }
          .infoEmail{
            padding: 25px 95px;
          }
          .infoEmail p{
            font-size: 18px;
            letter-spacing: 1px;
            line-height: 28px;
          }
          .footerInfo{
            background-color: #111f3e;
            color: #fff;
            padding: 2px 25px 14px;
            text-align: center;
          }
          .footerInfo p a{
            color: #cfd6e4;
            text-decoration: none;
          }
    
          /*****  @medias Querys responsive **************/ 
          @media(max-width:992px){
            .contendorInfo{
              max-width: 75%;
            }
            .infoEmail {
              padding: 25px 30px;
            }
          }
          @media(max-width:620px){
            .contendorInfo{
              max-width: 95%;
            }
          }
        </style>
      </head>
      <body id="IdBody">
        <div class="contendorInfo">
          <h1>Comentario Realizado a un Reporte en MiportalSAP</h1>
          <div class="infoEmail">
            <!--<img src="https://www.miportalsap.com/images/logo-css-sap-pq.png" style="width: 200px;">-->
            <h3>Este es un correo electrónico de notificación informandole de un comentario que se realizó en el reporte <strong> "'.$oCorreoDes->NomReporte.'" </strong> en MiPortalSap : </h3>
            <h3>A continuación de clic en el botón "Ir a MiPortalSap" para leer el comentario en la sesión Comentarios.  </h3><br><br>
            <a href="https://www.miportalsap.com/index.php/es/mi-portal-sap-acerca-es" target="_blank" style="color: #fff;background-color: #337ab7; border-color: #2e6da4;padding: 6px 12px;font-size: 14px;">Ir a MiPortalSap</a> <br>
            <p>Este es un servicio exclusivo de MiPortalSap usando Internet de las cosas (loT)</p>
          </div>
          <div class="footerInfo">
            <p>Genera y solicita tus reportes en cualquier momento desde el bot&oacute;n MiPortalSap. Mas informaci&oacute;n visitanos en:  <a href="http://www.consensussap.com/">www.consensussap.com</a></p>
            <em>&copy;2018 - Consensus S.A.S - Todos los derechos reservados.</em>
          </div>
        </div>	
      </body>
    </html>';

    $mail->Body = $cuerpo;
    $mail->send();
    
    break;  
  case 'mostrarUserComment':
  $arrResultado = array();
  $Salida = "<option value='-1'>------------</option>";
  $IdCia = $_POST['idcia'];
    $idUsua = $_POST['idusua'];
    $IdUsEsta = "";
    $Cont = 0;

    $oNomUsComm = new Comentarios();
    $oEstComm = new Comentarios();
  $oNomUsComm->IdCia = $IdCia;
  $oNomUsComm->getNomUserComment();
  for ($i=0; $i < $oNomUsComm->Cant; $i++) { 
      $oEstComm->IdUsua = $oNomUsComm->lstComent[$i]['IdUsua'];
      $oEstComm->getEstadoComment();
      for ($j=0; $j < $oEstComm->Cant; $j++) { 
        if ($oEstComm->lstComent[$j]['Estado'] == 0) {
          $Cont++;
        }
      }
    if ($oNomUsComm->lstComent[$i]['IdUsua'] != $idUsua) {
    $Salida .= "<option value=".$oNomUsComm->lstComent[$i]['IdUsua'].">".$oNomUsComm->lstComent[$i]['NomUsua']." (".$Cont.") </option>	";
    }else{
    $Salida .= "";
      }
      $Cont = 0;
  }
  $arrResultado[0] = $Salida;
  echo json_encode($arrResultado);
    break;
  case 'mostrarComentAdmin':
  $arrResultado = array();
  $IdUsua = $_POST['idusua']; 
  $IdUsAdm = $_POST['idusadm'];
  $IdReporte = "";
  $Estado = 0;
  $NoLeido = "";
  $Salida = "";
  $SalidaAd = "";
  $bandera = 0;
  $AsRight = "";

  $oGetComm = new Comentarios();
  $oGetComm->IdUsua = $IdUsua;
  $oGetComm->getComentForAdmin();
  if ($oGetComm->Cant > 0) {
    $IdReporte = $oGetComm->lstComent[0]["idReporte"];
    for ($i=0; $i < $oGetComm->Cant; $i++) { 
    $Estado = $oGetComm->lstComent[$i]["Estado"];
    $IdUsComm = $oGetComm->lstComent[$i]["IdUsComm"];
    if ($Estado == 0) {
      $NoLeido = "noLeido";
    }else{
      $NoLeido = "";
    }
    if ($bandera == 0) {
      $Salida .= "<div class='ContComentario ".$NoLeido." '>";
      $bandera = 1;
    }
    if ($IdUsComm == $IdUsAdm) {
      $AsRight = "AsRight";
    }else{
      $AsRight = "";
    }
    $Salida .= "<div class='ConComentarioAc ".$AsRight." '>";
    $Salida .= "<h2><i class='fas fa-user-tie'></i> ".$oGetComm->lstComent[$i]["NomUsua"]." <span class='fecha'><i class='far fa-calendar-alt'></i> ".$oGetComm->lstComent[$i]["FechaComm"]." </span></h2>";
    $Salida .= "<h3 class='compania'> ".$oGetComm->lstComent[$i]["NomCia"]."</h3>";
    $Salida .= "<h3 id='idNomRepor_".$i."' class='nomReporte'> ".$oGetComm->lstComent[$i]["NomReporte"]."</h3>";
    $Salida .= "<p>".$oGetComm->lstComent[$i]["Comentario"]."</p>";
    $Salida .= "</div>";
    if ($i+1 >= $oGetComm->Cant) {
      $bandera = 0;
    }else{
      if ($IdReporte != $oGetComm->lstComent[$i+1]["idReporte"]) {
        $bandera = 0;
        $IdReporte = $oGetComm->lstComent[$i+1]["idReporte"];
      }
    }
    if ($bandera == 0) {        
      $Salida .= "<form class='FormComments'>";
      $Salida .= "<div class='form-group'>";
      $Salida .= "</div>";
      $Salida .= "<div class='form-group'>";
      $Salida .= "<textarea name='textaComment' rows='2' class='form-control' id='TextaComment_".$i."' placeholder='".$oTraducir->Traducir("Fun57")."' ></textarea>";
      $Salida .= "</div>";
      $Salida .= "<button type='submit' class='btn btn-primary BtnComentar' idContBtn=".$i." idUsDestino=".$oGetComm->lstComent[$i]["IdUsComm"]."  value=".$oGetComm->lstComent[$i]["idReporte"].">".$oTraducir->Traducir("Fun58")."</button>";
      $Salida .= "</form>";  
      $Salida .= "</div>";
      }
    }
  }

  $arrResultado[0] = $Salida;
  echo json_encode($arrResultado);
  break;
  case 'enviarEmailUsDestinoAdm':
    $arrResultado = array();
    $IdCia = $_POST['Idcia'];
    $IdUsDest = $_POST['idusdest']; 

    $oCorreoDes = new Comentarios();
    $oCorreoDes->IdUsuDes = $IdUsDest;
    $oCorreoDes->getEmailUsDestino();		
    
    $mail = new PHPMailer();

    $mail->CharSet = 'UTF-8';

    $mail->setFrom('noresponder@miportalsap.com', 'MiPortalSap ');

    $mail->addAddress($oCorreoDes->EmailDes, 'Correo: ');
    //$mail->addAddress('gtobonbarco@gmail.com', 'Correo: ');

    $mail->Subject  = 'Respuesta al Comentario a un Reporte en MiPortalSap';

    $mail->IsHTML(true);

    $cuerpo = '<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
      <head>
        <meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style type="text/css">
          #IdBody{
            background-image: url(https://www.miportalsap.com/app_button/Phone/img/Fondo_Infinity_Goals.jpg);
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            background-color: #cfd6e4;
            font-family: Arial, Helvetica, sans-serif;
          }
          .contendorInfo{
            box-shadow: 14px 15px 69px -10px #d0c1c1;
            background-color: rgba(255,255,255,0.9);
            max-width: 968px;
            margin: auto;
          }
          .contendorInfo h1{
            background-color: #111f3e;
            color: #fff;
            padding: 14px 25px;
            text-align: center;
          }
          .contendorInfo h3{
            font-size: 23px;
          }
          .infoEmail img{
            width: 200px;
          }
          .infoEmail{
            padding: 25px 95px;
          }
          .infoEmail p{
            font-size: 18px;
            letter-spacing: 1px;
            line-height: 28px;
          }
          .footerInfo{
            background-color: #111f3e;
            color: #fff;
            padding: 2px 25px 14px;
            text-align: center;
          }
          .footerInfo p a{
            color: #cfd6e4;
            text-decoration: none;
          }
    
          /*****  @medias Querys responsive **************/ 
          @media(max-width:992px){
            .contendorInfo{
              max-width: 75%;
            }
            .infoEmail {
              padding: 25px 30px;
            }
          }
          @media(max-width:620px){
            .contendorInfo{
              max-width: 95%;
            }
          }
        </style>
      </head>
      <body id="IdBody">
        <div class="contendorInfo">
          <h1>Respuesta al Comentario Realizado a un Reporte en MiportalSAP</h1>
          <div class="infoEmail">
            <!--<img src="https://www.miportalsap.com/images/logo-css-sap-pq.png" style="width: 200px;">-->
            <h3>Este es un correo electrónico notificándole la respuesta del administrador a su comentario que realizó al reporte <strong> "'.$oCorreoDes->NomReporte.'" </strong> en MiPortalSap : </h3>
            <h3> A continuación de clic en el botón "Ir a MiPortalSap" para leer el comentario en la pagina Portal y buscar el reporte correspondiente al comentario. </h3><br><br>
            <a href="https://www.miportalsap.com/index.php/es/mi-portal-sap-acerca-es" target="_blank" style="color: #fff;background-color: #337ab7; border-color: #2e6da4;padding: 6px 12px;font-size: 14px;">Ir a MiPortalSap</a> <br>
            <p>Este es un servicio exclusivo de MiPortalSap usando Internet de las cosas (loT)</p>
          </div>
          <div class="footerInfo">
            <p>Genera y solicita tus reportes en cualquier momento desde el bot&oacute;n MiPortalSap. Mas informaci&oacute;n visitanos en:  <a href="http://www.consensussap.com/">www.consensussap.com</a></p>
            <em>&copy;2018 - Consensus S.A.S - Todos los derechos reservados.</em>
          </div>
        </div>	
      </body>
    </html>';

    $mail->Body = $cuerpo;
    $mail->send();

    break;
  case 'UpdateEstadoComm':
  $arrResultado = array();
  $IdReporte = $_POST['Idreporte'];
    
  $oUpdateEs = new Comentarios();
  $oUpdateEs->IdReporte = $IdReporte;
  $oUpdateEs->UpdateEstado();
    break;
  case 'VerificarNombreRPT':
    $arrResultado = array();
    $IdCia = $_POST['idcia'];
    $nomFile = $_POST['nomfile'];
    $Mensaje = "";

    $oNomRpt = new ReportesCargados();
    $oNomRpt->IdCia = $IdCia; 
    $oNomRpt->nomFile = $nomFile;
    $oNomRpt->getNomRpt();	
    if ($oNomRpt->Cant == 1) {
      $arrResultado[0] = $oNomRpt->nomFile;
    }else{
      $arrResultado[0] = "";
    }
    echo json_encode($arrResultado);
    break;
  case 'GuardarInfoRPT':
  $arrResultado = array();
    $IdCia = $_POST['idcia'];
    $IdUsua = $_POST['idusua'];
    $nomSimple = $_POST['nomsimple'];
    $nomFile = $_POST['nomfile'];
    $Estado = $_POST['estado'];
    $Mensaje = "";
    $Ruta = "archivos_rpt/";

    rename($Ruta.$nomSimple, 	$Ruta.$nomFile);

    $oCia = new Compania();
    $oCia->IdCia = $IdCia;
    $oCia->get();
    $oPeti = new Peticiones();
    $oPeti->sigId();
    $oPeti->IdPeticion = $oPeti->Cant;
    $oPeti->NitCia = $oCia->NitCia;
    $oPeti->CodVerificacion = $oCia->CodVerificacion;
    $oPeti->TipoPeticion = 4; 
    $oPeti->add();
    
  $oInfoRPT = new ReportesCargados();
    $oInfoRPT->IdCia = $IdCia; 
    $oInfoRPT->IdUsua = $IdUsua;
    $oInfoRPT->nomFile = $nomFile;
    $oInfoRPT->Estado = $Estado;
    $oInfoRPT->addInfoRPT();
    if ($oInfoRPT->Error == false) {
      $Mensaje = "OK";
    }else{
      $Mensaje = "";
    }

    $arrResultado[0] = $Mensaje;
    echo json_encode($arrResultado);
    break;
  case 'UpdateEstadoRPT':
    $arrResultado = array();
    $IdCia = $_POST['idcia'];
    $nomSimple = $_POST['nomsimple'];
    $nomFile = $_POST['nomfile'];
    $mensaje = "";
    $Ruta = "archivos_rpt/";

    rename($Ruta.$nomSimple, 	$Ruta.$nomFile);

    $oUpdateRpt = new ReportesCargados();
    $oUpdateRpt->IdCia = $IdCia;
  $oUpdateRpt->nomFile = $nomFile;
  $oUpdateRpt->Estado = 0;
    $oUpdateRpt->UpdateEstadoRPT();
    if ($oUpdateRpt->Error == false) {
      $mensaje = "OK";
    }else{
      $mensaje = "";
    }
    $arrResultado[0] = $mensaje;
    echo json_encode($arrResultado);
    break;
  case 'CargarLstRpt':
    $arrResultado = array();
    $IdCia = $_POST['idcia'];
    $Salida = "";

    $oLstRpt = new ReportesCargados();
    $oLstRpt->IdCia = $IdCia;
    $oLstRpt->getReporCrystal();
    if ($oLstRpt->Cant != 0) {
      for ($i=0; $i < $oLstRpt->Cant; $i++) { 
        $Salida .= "<tr>";					
        $Salida .= "<td style='vertical-align: middle; text-align: center;'>".($i + 1)."</td>";
        $Salida .= "<td style='vertical-align: middle; text-align: center;'>".$oLstRpt->lstReportes[$i]['nomFile']."</td>";
        if ($oLstRpt->lstReportes[$i]['Estado'] == 0) {
          $Salida .= "<td style='vertical-align: middle; text-align: center;'>".$oTraducir->Traducir("Fun61")."</td>";
        }else{
          $Salida .= "<td style='vertical-align: middle; text-align: center;'>".$oTraducir->Traducir("Fun62")."</td>";
        }
        $Salida .= "</tr>";
      }
    }
    $arrResultado[0] = $Salida;
    echo json_encode($arrResultado);
    break;
  case 'getEstadisCia':
    $arrResultado = array();
    $SalidaCias = array();
    $SalidasCant = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $y = 0;
    $objEstaCia = new DatosEstadisticos();
    $objEstaCia->fechaIni = $fechaIni;
    $objEstaCia->fechaFin = $fechaFin;
    $objEstaCia->getEstadisCias();

    if ($objEstaCia->Cant != 0) {
      for ($i=0; $i < $objEstaCia->Cant; $i++) { 
        $SalidaCias[$i] .= $objEstaCia->ListEstadisCia[$i]["nomCia"];
        $SalidasCant[$i] .= $objEstaCia->ListEstadisCia[$i]["cantidad"];
        $y++;
      }
    }

    $arrResultado[0] = $SalidaCias;
    $arrResultado[1] = $SalidasCant;

    echo json_encode($arrResultado);
    break;
  case 'getEstadisRepor':
    $arrResultado = array();
    $SalidaRepor = array();
    $SalidasCant = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $y = 0;
    $objEstaRep = new DatosEstadisticos();
    $objEstaRep->fechaIni = $fechaIni;
    $objEstaRep->fechaFin = $fechaFin;
    $objEstaRep->getEstadisRepor();
    if ($objEstaRep->Cant != 0) {
      for ($i=0; $i < $objEstaRep->Cant; $i++) { 
        $SalidaRepor[$i] .= $objEstaRep->ListaEstadiRepor[$i]["nomReporte"];
        $SalidasCant[$i] .= $objEstaRep->ListaEstadiRepor[$i]["cantidad"];
        $y++;
      }
    }

    $arrResultado[0] = $SalidaRepor;
    $arrResultado[1] = $SalidasCant;

    echo json_encode($arrResultado);
    break;
  case 'getEstadisUser':
    $arrResultado = array();
    $SalidaUser = array();
    $SalidasCant = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $usTable = "";
    $y = 0;

    $objEstaUser = new DatosEstadisticos();
    $objEstaUser->fechaIni = $fechaIni;
    $objEstaUser->fechaFin = $fechaFin;
    $objEstaUser->getEstadisUser();
    
    if ($objEstaUser->Cant != 0) {
      for ($i=0; $i < $objEstaUser->Cant; $i++) { 
        $SalidaUser[$i] .= $objEstaUser->ListEstadiUser[$i]["Usuario"];
        $SalidasCant[$i] .= $objEstaUser->ListEstadiUser[$i]["cantidad"];
        $y++;
        $usTable .= "<tr>";
        $usTable .= "<td>".$objEstaUser->ListEstadiUser[$i]["nomCia"]."</td>";
        $usTable .= "<td>".$objEstaUser->ListEstadiUser[$i]["Usuario"]."</td>";
        $usTable .= "<td>".$objEstaUser->ListEstadiUser[$i]["cantidad"]."</td>";
        $usTable .= "</tr>";
      }
    }

    $arrResultado[0] = $SalidaUser;
    $arrResultado[1] = $SalidasCant;
    $arrResultado[2] = $usTable;

    echo json_encode($arrResultado);
    break;
  case 'getEstadisPolling':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $SalidaPol = "";

    $objEstaPol = new DatosEstadisticos();
    $objEstaPol->fechaIni = $fechaIni;
    $objEstaPol->fechaFin = $fechaFin;
    $objEstaPol->getEstadisPolling();
    //echo $objEstaPol->Msg;
    if ($objEstaPol->Cant != 0) {
      for ($i=0; $i < $objEstaPol->Cant; $i++) { 
        $SalidaPol .= "<tr>";
        $SalidaPol .= "<th scope='row'>".($i + 1)."</th>"; 
        $SalidaPol .= "<td>".$objEstaPol->ListEstadiPolling[$i]["nomCia"]."</td>";
        $SalidaPol .= "<td>".$objEstaPol->ListEstadiPolling[$i]["fecha"]."</td>";	
        $SalidaPol .= "</tr>";						
      }
    }

    $arrResultado[0] = $SalidaPol;

    echo json_encode($arrResultado);
    break;
  case 'getUserRegistrados':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
    $objUserReg->fechaFin = $fechaFin;
    $objUserReg->getUserRegistrados();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->UserRegis;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
    break;
  case 'getCiasRegistradas':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
    $objUserReg->fechaFin = $fechaFin;
    $objUserReg->getCiasRegistradas();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->CiasRegis;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
    break;
  case 'getTotalReporGene':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
    $objUserReg->fechaFin = $fechaFin;
    $objUserReg->getTotalRepGene();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->ReporGene;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
    break;
  case 'getToUserGeneRep':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
    $objUserReg->fechaFin = $fechaFin;
    $objUserReg->getToUserGeneRep();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->Registros;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
    break;
  case 'getEstadisRepCia':
    $arrResultado = array();
    $SalidaRep = array();
    $SalidasCant = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $idCia = $_POST['idCia'];
    $y = 0;
    $objEstaCia = new DatosEstadisticos();
    $objEstaCia->fechaIni = $fechaIni;
    $objEstaCia->fechaFin = $fechaFin;
    $objEstaCia->idCia = $idCia;
    $objEstaCia->getEstaReporCia();

    if ($objEstaCia->Cant != 0) {
      for ($i=0; $i < $objEstaCia->Cant; $i++) { 
        $SalidaRep[$i] .= $objEstaCia->ListaEstadiRepor[$i]["nomReporte"];
        $SalidasCant[$i] .= $objEstaCia->ListaEstadiRepor[$i]["cantidad"];
        $y++;
      }
    }

    $arrResultado[0] = $SalidaRep;
    $arrResultado[1] = $SalidasCant;

    echo json_encode($arrResultado);
    break;
  case 'getEstadiUserCia':
    $arrResultado = array();
    $SalidaUser = array();
    $SalidasCant = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $idCia = $_POST['idCia'];
    $usTable = "";
    $y = 0;

    $objEstaUser = new DatosEstadisticos();
    $objEstaUser->fechaIni = $fechaIni;
    $objEstaUser->fechaFin = $fechaFin;
    $objEstaUser->idCia = $idCia;
    $objEstaUser->getEstadiUserCia();
    
    if ($objEstaUser->Cant != 0) {
      for ($i=0; $i < $objEstaUser->Cant; $i++) { 
        $SalidaUser[$i] .= $objEstaUser->ListEstadiUser[$i]["Usuario"];
        $SalidasCant[$i] .= $objEstaUser->ListEstadiUser[$i]["cantidad"];
        $y++;
        $usTable .= "<tr>";
        $usTable .= "<td>".$objEstaUser->ListEstadiUser[$i]["nomCia"]."</td>";
        $usTable .= "<td>".$objEstaUser->ListEstadiUser[$i]["Usuario"]."</td>";
        $usTable .= "<td>".$objEstaUser->ListEstadiUser[$i]["cantidad"]."</td>";
        $usTable .= "</tr>";
      }
    }

    $arrResultado[0] = $SalidaUser;
    $arrResultado[1] = $SalidasCant;
    $arrResultado[2] = $usTable;

    echo json_encode($arrResultado);
    break;
  case 'getEstaPollingCia':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
    $fechaFin = $_POST['fechaFin'];
    $idCia = $_POST['idCia'];
    $SalidaPol = "";

    $objEstaPol = new DatosEstadisticos();
    $objEstaPol->fechaIni = $fechaIni;
    $objEstaPol->fechaFin = $fechaFin;
    $objEstaPol->idCia = $idCia;
  $objEstaPol->getEstadiPollingCia();
  //echo $objEstaPol->Msg;
    if ($objEstaPol->Cant != 0) {
      for ($i=0; $i < $objEstaPol->Cant; $i++) { 
        $SalidaPol .= "<tr>";
        $SalidaPol .= "<th scope='row'>".($i + 1)."</th>"; 
        $SalidaPol .= "<td>".$objEstaPol->ListEstadiPolling[$i]["nomCia"]."</td>";
        $SalidaPol .= "<td>".$objEstaPol->ListEstadiPolling[$i]["fecha"]."</td>";	
        $SalidaPol .= "</tr>";						
      }
    }

    $arrResultado[0] = $SalidaPol;

    echo json_encode($arrResultado);
  break;
  case 'getUserRegisCia':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
  $fechaFin = $_POST['fechaFin'];
  $idCia = $_POST['idCia'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
  $objUserReg->fechaFin = $fechaFin;
  $objUserReg->idCia = $idCia;
    $objUserReg->getUserRegisCia();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->UserRegis;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
  break;
  case 'getTotalReporCia':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
  $fechaFin = $_POST['fechaFin'];
  $idCia = $_POST['idCia'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
  $objUserReg->fechaFin = $fechaFin;
  $objUserReg->idCia = $idCia;
    $objUserReg->getTotalRepCia();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->ReporGene;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
  break;
  case 'getToUserRepCia':
    $arrResultado = array();
    $fechaIni = $_POST['fechaIni'];
  $fechaFin = $_POST['fechaFin'];
  $idCia = $_POST['idCia'];

    $objUserReg = new DatosEstadisticos();
    $objUserReg->fechaIni = $fechaIni;
  $objUserReg->fechaFin = $fechaFin;
  $objUserReg->idCia = $idCia;
    $objUserReg->getToUserRepCia();
    
    if ($objUserReg->Cant > 0) {
      $arrResultado[0] = $objUserReg->Registros;
    }else{
      $arrResultado[0] = $oTraducir->Traducir("Fun63");
    }
    echo json_encode($arrResultado);
    break;
  case 'getCountCias':
    $arrResultado = array();
    $ObjCant = new MultiCompania();
    $ObjCant->IdUsuario = $_POST["IdUser"];
    $ObjCant->getCantUsersAdAso();
    $arrResultado[0] = $ObjCant->Cant;
    echo json_encode($arrResultado);
    break;
  case 'UpdateEstaUser':
    $arrResultado = array();
    $ObjUpdate = new MultiCompania();
    $ObjUpdate->Estado = 0;
    $ObjUpdate->IdUsuario = $_POST["IdUser"];
    $ObjUpdate->IdCia = $_POST["IdCia"];
    $ObjUpdate->updateEstado();
    $arrResultado[0] = $ObjUpdate->Error;
    echo json_encode($arrResultado); 
    break;
  case 'updateNuevoAdmin':
    $arrResultado = array();
    $ObjNueAdm = new MultiCompania();
    $ObjNueAdm->UsuarioActualiza = $_POST["IdUserNue"];
    $ObjNueAdm->IdUsuario = $_POST["IdUser"];
    $ObjNueAdm->IdCia = $_POST["IdCia"];
    $ObjNueAdm->updateNuevoAdmin();
    if ($ObjNueAdm->Error == false) {
      $ObjGetDat = new Usuario();
      $ObjGetDat->IdUsuario = $_POST["IdUserNue"];
      $ObjGetDat->get();

      $mail = new PHPMailer();

      $mail->CharSet = 'UTF-8';

      $mail->setFrom('noresponder@miportalsap.com', 'MiPortalSap ');

      $mail->addAddress($ObjGetDat->Correo, 'Correo: ');

      $mail->Subject  = 'Notificación cambio de Usuario Administrador MiPortalSap';

      $mail->IsHTML(true);

      $cuerpo = '<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
        <head>
          <meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
          <meta http-equiv="X-UA-Compatible" content="IE=edge">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <style type="text/css">
            #IdBody{
              background-image: url(https://www.miportalsap.com/app_button/Phone/img/Fondo_Infinity_Goals.jpg);
              background-position: center;
              background-size: cover;
              background-repeat: no-repeat;
              background-color: #cfd6e4;
              font-family: Arial, Helvetica, sans-serif;
            }
            .contendorInfo{
              box-shadow: 14px 15px 69px -10px #d0c1c1;
              background-color: rgba(255,255,255,0.9);
              max-width: 968px;
              margin: auto;
            }
            .contendorInfo h1{
              background-color: #111f3e;
              color: #fff;
              padding: 14px 25px;
              text-align: center;
            }
            .infoEmail img{
              width: 200px;
            }
            .infoEmail{
              padding: 25px 95px;
            }
            .infoEmail p{
              font-size: 18px;
              letter-spacing: 1px;
              line-height: 28px;
            }
            .footerInfo{
              background-color: #111f3e;
              color: #fff;
              padding: 2px 25px 14px;
              text-align: center;
            }
            .footerInfo p a{
              color: #cfd6e4;
              text-decoration: none;
            }
      
            /*****  @medias Querys responsive **************/ 
            @media(max-width:992px){
              .contendorInfo{
                max-width: 75%;
              }
              .infoEmail {
                padding: 25px 30px;
              }
            }
            @media(max-width:620px){
              .contendorInfo{
                max-width: 95%;
              }
            }
          </style>
        </head>
        <body id="IdBody">
          <div class="contendorInfo">
            <h1>Cambio de Usuario Administrador MiportalSAP</h1>
            <div class="infoEmail">
              <img src="https://www.miportalsap.com/images/logo-css-sap-pq.png" style="width: 200px;">
              <h2>Este Correo electrónico es para notificarlo sobre el nuevo Usuario Administrador en MiPortalSap : </h2>
              <h3>El actual usuario administrador de la Compañía "'.$ObjGetDat->NombreCia.'" ha decidido salir de esta Compañía, por tal motivo lo seleccionó para que a partir de este momento usted sea el nuevo Usuario Administrador.</h3>
              <h3> A continuación de clic en el botón Ir a MiPortalSAP e ingresa con los datos habituales.  </h3><br><br>
              <a href="https://www.miportalsap.com/index.php/es/mi-portal-sap-acerca-es" target="_blank" style="color: #fff;
              background-color: #337ab7; border-color: #2e6da4;padding: 6px 12px;font-size: 14px;">Ir a MiPortalSAP</a> <br>
              <h3>Si presenta alguna duda o inquietud comunícate con el Usuario anterior o en <a href="https://consensussap.com">www.consensussap.com</a> Chat Interactivo.</h3>
              <p>Este es un servicio exclusivo de MiPortalSap usando Internet de las cosas (loT)</p>
            </div>
            <div class="footerInfo">
              <p>Genera y solicita tus reportes en cualquier momento desde el bot&oacute;n MiPortalSap. Mas informaci&oacute;n visitanos en:  <a href="http://www.consensussap.com/">www.consensussap.com</a></p>
              <em>&copy;2018 - Consensus S.A.S - Todos los derechos reservados.</em>
            </div>
          </div>	
        </body>
      </html>';

      $mail->Body = $cuerpo;
      $mail->send();

      $arrResultado[0] = "OK";
    }
    else{
      $arrResultado[0] = "NOT";
    }
    echo json_encode($arrResultado);
    break;
    
    case 'CargarMaestroReportes2':
    $arrResultado = array();
    $arrData = array();
    $TypeUsu = "";
    $TypeRep = "";
    $DesCatego = "";
    $CodCatego = "";
    $Estado = "";
    $DesSubCatego = "";
    $CodSubCatego = "";
    $DesGrp = "";
    $CodGrp = "";
    $salida = "";
    $IdCia = $_POST["cia"];	
    $oRepo = new Reportes();
    $oRepo->IdCia = $IdCia;				
    $oRepo->getAllCia();
    if($oRepo->Cant != 0){
      for($i = 0; $i < $oRepo->Cant; $i++){
        $salida .= "<tr class='gradeX'>";					
        $salida .= "<td>".($i + 1)."</td>";
        $salida .= "<td>".$oRepo->lstReportes[$i]["NomReporte"]."</td>";
        
        switch($oRepo->lstReportes[$i]["TipoUsuario"]){
          case "E":
            $TypeUsu = $oTraducir->Traducir("Fun29Empleado");					
            break;
          case "C":
            $TypeUsu = $oTraducir->Traducir("Fun29Cliente");						
            break;
          case "S":
            $TypeUsu = $oTraducir->Traducir("Fun29Proveedor");
            break;
        }				
        $salida .= "<td>".$TypeUsu."</td>";

        $CodGrp = $oRepo->lstReportes[$i]["Grupo"];
        $oGrp = new Grupos();
        $oGrp->CodGrupo = $CodGrp;
        $oGrp->IdCia = $IdCia;
        $oGrp->get();
        $DesGrp = $oGrp->Descripcion;

        $salida .= "<td>".$DesGrp."</td>";

        $CodCatego = $oRepo->lstReportes[$i]["Categoria"];
        $oCate = new CategSubcate();
        $oCate->IdCia = $IdCia;
        $oCate->CategoriaCodigo = $CodCatego;
        $oCate->getCategoria();
        $DesCatego = $oCate->CategoriaDescripcion;

        $salida .= "<td>".$DesCatego."</td>";

        $CodSubCatego = $oRepo->lstReportes[$i]["SubCategoria"];
        $oSubCate = new CategSubcate();
        $oSubCate->IdCia = $IdCia;
        $oSubCate->CategoriaCodigo = $CodCatego;
        $oSubCate->SubCategoriaCodigo = $CodSubCatego;
        $oSubCate->getSubCategoria();
        $DesSubCatego = $oSubCate->SubCategoriaDescripcion;

        switch($oRepo->lstReportes[$i]["TipoReporte"]){
          case "C":
            $TypeRep = $oTraducir->Traducir("Fun45");					
            break;
          case "R":
            $TypeRep = $oTraducir->Traducir("Fun46");						
            break;					
        }	
        
        $salida .= "<td style='vertical-align: middle; text-align: center;'>".$TypeRep."</td>";
        
        switch($oRepo->lstReportes[$i]["Estado"]){
          case "0":
            $Estado = $oTraducir->Traducir("Fun43");					
            break;
          case "1":
            $Estado = $oTraducir->Traducir("Fun44");						
            break;					
        }	
        $salida .= "<td '>".$Estado."</td>";
        $salida .= "<td> <button class='btn btn-info btn-info btnTablaAcc' data-toggle='modal' data-target='#modalDetalleReporte'><i class='fa fa-eye' aria-hidden='true'></i></button>
                &nbsp;
                <button class='btn btn-info btn-danger btnTablaAcc'><i class='fa fa-trash' aria-hidden='true'></i></button>
              </td>";
        $salida .= "</tr>";	
        $arrData[$i] = array('idCia' => $oRepo->lstReportes[$i]["IdCia"], 'idRep' => $oRepo->lstReportes[$i]["IdReporte"], 'nombre' => $oRepo->lstReportes[$i]["NomReporte"], 'tipoUsu' => $TypeUsu, 'grupo' => $DesGrp, 'categoria' => $DesCatego, 'tipoRep' => $TypeRep, 'estado' => $Estado);
      }
    }else{
      $salida .= "<tr><td>1</td><td colspan='3'>".$oTraducir->Traducir("Fun39")."</td></tr>";
    }						
        
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;	
    $arrResultado[2] = $arrData;
    echo json_encode($arrResultado);
    break;
    
    case 'CargarRepPend2':
    $arrResultado = array();
    $arrayDatos = array();
    $salida = "";
    $salidaTab = "";
    $iContRep = 1;
    $IdCia = $_POST["cia"];
    $Usua = $_POST["us"];
    $oUser = new Usuario();
    $oUser->IdUsuario = $Usua;
  	$oUser->getActivo();
    if($Idioma == "ES"){
      $Estado1 = "Solicitud Enviada";
      $Estado2 = "En Proceso";
    }
    else{
      $Estado1 = "Request sent";
      $Estado2 = "In process";
    }
    $oRepo = new Reportes();
    $oRepo->IdCia = $IdCia;
    $oSolicRep = new SolicitudReportes();
    $oSolicRep->IdCia = $IdCia;
    $oSolicRep->IdUsuario = $Usua;
    $oSolicRep->getUsEnProceso();
    if($oSolicRep->Error == false){
      if($oSolicRep->Cant > 0){
        for($i = 0; $i < $oSolicRep->Cant; $i++){
          $salida .= "<tr>";
          $salidaTab .= "<tr>";
          $salida .= "<td>".$iContRep."</td>";
          $salidaTab .= "<td>".$iContRep."</td>";
          $salida .= "<td>".$oSolicRep->lstSolicitudes[$i]["FechaSolicitud"]."</td>";
          $salidaTab .= "<td>".$oSolicRep->lstSolicitudes[$i]["FechaSolicitud"]."</td>";
          $oRepo->IdReporte = $oSolicRep->lstSolicitudes[$i]["IdReporte"];
          $oRepo->get();
          $salida .= "<td>".$oRepo->NomReporte."</td>";
          $salidaTab .= "<td>".$oRepo->NomReporte."</td>";
          if($oSolicRep->lstSolicitudes[$i]["Estado"] == 0){
            $salida .= "<td>".$Estado1."&nbsp;&nbsp;&nbsp;";
            $salidaTab .= "<td>".$Estado1."&nbsp;&nbsp;&nbsp;";
          }
          else{
            $salida .= "<td>".$Estado2."&nbsp;&nbsp;&nbsp;";
            $salidaTab .= "<td>".$Estado2."&nbsp;&nbsp;&nbsp;";
          }
          $salida .= "<button id='Rep_".$i."' rep='".$oRepo->NomReporte."' idRep='".$oSolicRep->lstSolicitudes[$i]["IdReporte"]."' tipRep='C' class='btn btn-default csBtnEliminarP'><i style='background-color: #F31B1B; padding: 2px 6px; border: 1px solid #F31B1B; border-radius: 5px; color: white; cursor: pointer;' class='fa fa-trash' aria-hidden='true'></i></button></td>";
          $salidaTab .= "<button id='TabRep_".$i."' Tabrep='".$oRepo->NomReporte."' TabidRep='".$oSolicRep->lstSolicitudes[$i]["IdSolicitud"]."' TabtipRep='C' class='btn btn-default csBtnEliminarP'><i style='background-color: #F31B1B; padding: 2px 6px; border: 1px solid #F31B1B; border-radius: 5px; color: white; cursor: pointer;' class='fa fa-trash' aria-hidden='true'></i></button></td>";
          $salida .= "</tr>";
          $salidaTab .= "</tr>";
          $iContRep++;
          $arrayDatos[$i] = array('idreporte' =>$oSolicRep->lstSolcitudes[$i]["IdReporte"],'estado' =>$oSolicRep->lstSolcitudes[$i]["Estado"] );
        }
      }
    }

    $oReportes = new Reportes();
    $oReportes->IdCia = $IdCia;

    $oSolicitud = new SolicitudReportes();
    $oSolicitud->IdCia = $IdCia;
    
    $pruebahora = "";

    $oRepGen = new ReportesGenerados();
    $oRepGen->IdCia = $IdCia;
    $oRepGen->IdUsuario = $Usua;
    $oRepGen->getCiaUsua();
    if($oRepGen->Error == false){
      if($oRepGen->Cant > 0){
        for($i = 0; $i < $oRepGen->Cant; $i++){
          $salida .= "<tr>";
          $salidaTab .= "<tr>";
          $salida .= "<td>".$iContRep."</td>";
          $salidaTab .= "<td>".$iContRep."</td>";
          $salida .= "<td><b>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</b></td>";
          $salidaTab .= "<td><b>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</b></td>";
          $salida .= "<td><b>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</b></td>";
          $salidaTab .= "<td><b>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</b></td>";
          $salida .= "<td><button id='Rep_".$i."' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><i style='background-color: #f8ac59; padding: 2px 6px; border: 1px solid #f8ac59; border-radius: 5px; color: brown; cursor: pointer;' class='iVer fa fa fa-eye'></i></button>";
          $salidaTab .= "<td><a href='https://www.miportalsap.com/app_portal/pags/detalle_reporte_generado.php?nomFile=".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."&IdCia=".$IdCia."&IdUsuario=".$Usua."' target='_blank' id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><i style='background-color: #f8ac59; padding: 2px 6px; border: 1px solid #f8ac59; border-radius: 5px; color: brown; cursor: pointer;' class='iVer fa fa fa-eye'></i></a>";
          $salida .= "<button id='Rep_".$i."' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnEliminar'><i style='background-color: #F31B1B; padding: 2px 6px; border: 1px solid #F31B1B; border-radius: 5px; color: white; cursor: pointer;' class='fa fa-trash' aria-hidden='true'></i></button></td>";
          $salidaTab .= "<button id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnEliminar'><i style='background-color: #F31B1B; padding: 2px 6px; border: 1px solid #F31B1B; border-radius: 5px; color: white; cursor: pointer;' class='fa fa-trash' aria-hidden='true'></i></button></td>";

          $fecha_generacion = $oRepGen->lstSolicitudes[$i]["FechaGenerado"];
          $fecha_actual = date('Y-m-d H:i:s');
          $dteStart = new DateTime($fecha_generacion); 
          $dteEnd   = new DateTime($fecha_actual); 
          $dteDiff  = $dteStart->diff($dteEnd); 
          $pruebahora += $dteDiff->format("%Y");
          $pruebahora += $dteDiff->format("%M");
          $pruebahora += $dteDiff->format("%D");
          $pruebahora += $dteDiff->format("%H"); //la hora del servidor php esta 5 horas adelantada con la hora de colombia 
          $pruebahora += $dteDiff->format("%I");
          
          $idSolicitud = $oRepGen->lstSolicitudes[$i]["IdSolicitud"];
          $oSolicitud->IdSolicitud = $idSolicitud;
          $oSolicitud->get();
          $oReportes->IdReporte = $oSolicitud->IdReporte;
          $oReportes->get();
          //menor que 10 porque el servidor php esta adelantado 5 horas, para que se cumplan los minutos DFC 09/03/18
          if($oReportes->EsPayU == 1 && $pruebahora <= 10 ) 
          {
            // Espacio Columna Comentarios
            $salida .= "<td></td>";
            $salidaTab .= "<td></td>";

            $salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            if($oUser->IdUsuario == 1057 || $oUser->IdUsuario == 1166)
            {
              // Carga botón PayPal    
              $salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              
              // Carga botón Paymentez
              //$salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'>Pagar con Paymentez</button></td>";
              //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'>Pagar con Paymentez</button></td>";
            }
          }
          
          if($oReportes->EsPaymentez == 1 && $pruebahora <= 10 ) {
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            
            // Carga botón PayPal    
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";

            // Carga botón Paymentez
            $salidaTab .= "<td></td>";
            // Carga botón Paymentez
            $salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/Boton-Seleccionar.png' /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/Boton-Seleccionar.png'/></button></td>";
          }
          
          $salida .= "</tr>";
          $salidaTab .= "</tr>";
          $iContRep++;
        }
      }
    }

    $oReportes = new Reportes();
    $oReportes->IdCia = $IdCia;

    $oSolicitud = new SolicitudReportes();
    $oSolicitud->IdCia = $IdCia;

    $oRepGen = new ReportesGenerados();
    $oRepGen->IdCia = $IdCia;
    $oRepGen->IdUsuario = $Usua;
    $oRepGen->getCiaUsuaGdos();
    if($oRepGen->Error == false){
      if($oRepGen->Cant > 0){
        for($i = 0; $i < $oRepGen->Cant; $i++){
          $salida .= "<tr>";
					$salidaTab .= "<tr>";
					$salida .= "<td>".$iContRep."</td>";
					$salidaTab .= "<td>".$iContRep."</td>";
					$salida .= "<td>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</td>";
					$salidaTab .= "<td>".$oRepGen->lstSolicitudes[$i]["FechaGenerado"]."</td>";
					$salida .= "<td>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</td>";
					$salidaTab .= "<td>".$oRepGen->lstSolicitudes[$i]["NomReporte"]."</td>";
					$salidaTab .= "<td><a href='https://www.miportalsap.com/app_portal/pags/detalle_reporte_generado.php?nomFile=".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."&IdCia=".$IdCia."&IdUsuario=".$Usua."' target='_blank' id='TabRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizar'><i style='background-color: #f8ac59; padding: 2px 6px; border: 1px solid #f8ac59; border-radius: 5px; color: brown; cursor: pointer;' class='iVer fa fa fa-eye'></i></a><button id='TabDescRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' imgBtn='imgBtn_".$i."'  class='btn btn-azul csBtnDescargar'><i style='background-color: #2aa3da; padding: 2px 6px; border: 1px solid #2aa3da; border-radius: 5px; color: cornsilk; cursor: pointer;' class='iDow fa fa-cloud-download'></i></button>";
					// if ($oRepGen->lstSolicitudes[$i]["TipoReporte"] == "C") {
					// 	$salidaTab .= "<button id='TabExcelRep_".$i."' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' imgBtn='imgBtnExcel_".$i."'  class='csBtnDescExcel' title='Descargalo en Excel'><img src='../img/iconoExcel.png' class='styleimgBtn' id='imgBtnExcel_".$i."' /></button>";
          // }
					$salidaTab .= "</td>";
          
          $fecha_generacion = $oRepGen->lstSolicitudes[$i]["FechaGenerado"];
          $fecha_actual = date('Y-m-d H:i:s');

          $dteStart = new DateTime($fecha_generacion); 
          $dteEnd   = new DateTime($fecha_actual); 
          
          $dteDiff  = $dteStart->diff($dteEnd); 
          
          $pruebahora += $dteDiff->format("%Y");
          $pruebahora += $dteDiff->format("%M");
          $pruebahora += $dteDiff->format("%D");
          $pruebahora += $dteDiff->format("%H"); //la hora del servidor php esta 5 horas adelantada con la hora de colombia 
          $pruebahora += $dteDiff->format("%I");
          

          $idSolicitud = $oRepGen->lstSolicitudes[$i]["IdSolicitud"];
          $oSolicitud->IdSolicitud = $idSolicitud;
          $oSolicitud->get();
          $oReportes->IdReporte = $oSolicitud->IdReporte;
          $oReportes->get();
          //menor que 10 porque el servidor php esta adelantado 5 horas, para que se cumplan los minutos DFC 09/03/18
          
          if($oReportes->EsPayU == 1 && $pruebahora <= 10 ) 
          {
            $salidaTab .= "<td></td>";
            $salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
          
            if($oUser->IdUsuario == 1057 || $oUser->IdUsuario == 1166)
            {
              // Carga botón PayPal       
              // $salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              // $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              
              // Carga botón Paymentez
              // $salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/mastercard.png' width=100 height=25 /></button></td>";
              // $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/mastercard.png' width=100 height=25 /></button></td>";
            }
          }
          
          if($oReportes->EsPaymentez == 1 && $pruebahora <= 10 ) 
          {
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payU' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payU' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/logoPayU.PNG' width=100 height=25 /></button></td>";
          
            // Carga botón PayPal       
            //$salida .= "<td><button id='Rep_".$i."' tipoPago='payPal' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
            //$salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='payPal' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU'><img src='../pags/paypalbtn.jpg' width=100 height=25 /></button></td>";
              
            // Carga botón Paymentez
            $salidaTab .= "<td></td>";
            $salida .= "<td><button id='Rep_".$i."' tipoPago='paymentez' rep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' idRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' tipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/BotonMasteCard.png' /></button></td>";
            $salidaTab .= "<td><button id='TabRep_".$i."' tipoPago='paymentez' Tabrep='".$oRepGen->lstSolicitudes[$i]["NomArchivo"]."' TabidRep='".$oRepGen->lstSolicitudes[$i]["IdRepGenerado"]."' TabtipRep='".$oRepGen->lstSolicitudes[$i]["TipoReporte"]."' class='btn btn-default csBtnVisualizarPayU csMasterCard'><img src='../pags/BotonMasteCard.png' /></button></td>"; 
          }
          

          $salida .= "</tr>";
          $salidaTab .= "</tr>";
          $iContRep++;
        }
      }
      else{
        $salida .= "<tr><td>&nbsp;</td><td colspan='3'>2 ".$TxtNoList."</td></tr>";
        $salidaTab .= "<tr><td>&nbsp;</td><td colspan='3'>2 ".$TxtNoList."</td></tr>";
      }
    }
  
    $arrResultado[0] = "OK";
    $arrResultado[1] = $salida;
    $arrResultado[2] = $salidaTab;
    echo json_encode($arrResultado);
  	break;
  	
  	case 'CargarParamReporte_NuevoPort':
    $arrResultado = array();
    $arraynuevo = array();
    $salida = "";
    $salidaTab = "";
    $IdCia = $_POST["cia"];
    $Rep = $_POST["rep"];
    $iParam = 0;
    $vlPrueba = "";
    $oUser = new Usuario();
    $oUser->IdUsuario = $_POST["idus"];
    $oUser->getActivo();
    $NomBtnGen = $oTraducir->Traducir("Fun55");
    $TxtParam = $oTraducir->Traducir("Fun54");
    $oParamR = new ReporteParametros();
    $oParamR->IdCia = $IdCia;
    $oParamR->IdReporte = $Rep;
    if($_POST["prb"] == 0){
      $oParamR->getParamNoForzados();
    }else{
      $oParamR->getAllReporte();
    }
    if($oParamR->Error == false){
      if($oParamR->Cant > 0){
        for($i = 0; $i < $oParamR->Cant; $i++){
          if($_POST["prb"] == 0){
            $vlPrueba = "";
          }else{
            $vlPrueba = "value='".$oParamR->lstParametros[$i]["VlrPrueba"]."'";
          }
          $arraynuevo[$i] = array('idparametro' =>$oParamR->lstParametros[$i]["IdParametro"],'descripcion' =>$oParamR->lstParametros[$i]["Descripcion"],'tipocampo' =>$oParamR->lstParametros[$i]["TipoCampo"] );
          $salida .= "<div class='form-group'>";
          $salidaTab .= "<div class='form-group'>";
          $salida .= "<label>".$oParamR->lstParametros[$i]["Descripcion"]."</label>";
          $salidaTab .= "<label>".$oParamR->lstParametros[$i]["Descripcion"]."</label>";
          switch($oParamR->lstParametros[$i]["TipoCampo"]){
            case "F":
              $salida .= "<input type='date' class='form-control' id='Param_".$i."' idParam='".$oParamR->lstParametros[$i]["IdParametro"]."' />";
              $salidaTab .= "<input type='date' class='form-control' formControlName='Param_".$i."' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
              break;
            case "C":
              $salida .= "<input type='text' class='form-control' id='Param_".$i."' idParam='".$oParamR->lstParametros[$i]["IdParametro"]."' />";
              $salidaTab .= "<input type='text' class='form-control' formControlName='Param_".$i."' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
              break;
            case "N":
              $salida .= "<input type='number' class='form-control' id='Param_".$i."' idParam='".$oParamR->lstParametros[$i]["IdParametro"]."' />";
              $salidaTab .= "<input type='number' class='form-control' formControlName='Param_".$i."' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
              break;
            default:
              $salidaTab .= "<input type='text' class='form-control' formControlName='Param_".$i."' id='TabParam_".$i."' TabidParam='".$oParamR->lstParametros[$i]["IdParametro"]."' ".$vlPrueba." />";
          }
          $salida .= "</div>";
          $salidaTab .= "</div>";
          $iParam = $oParamR->Cant;
        }
      }
      else{
        $salida .= "<div class='form-group'><p class='form-control-static'>".$TxtParam."</p></div>";
        $salidaTab .= "<div class='form-group'><p class='form-control-static'>".$TxtParam."</p></div>";
      }
    }
    //$salida .= "<div class='form-group'><div class='col-md-2 col-md-offset-2'><input type='button' class='btn btn-default' value='".$NomBtnGen."' id='btnGenerar' cantParam='".$iParam."' rep='".$Rep."' /></div></div>";
    //$salidaTab .= "<div class='form-group'><div class='col-md-2 col-md-offset-2'><input type='button' class='btn btn-default' value='".$NomBtnGen."' id='TabbtnGenerar' TabcantParam='".$iParam."' Tabrep='".$Rep."' /></div></div>";

    $arrResultado[0] = "OK";
    // $arrResultado[1] = $salida;
    // $arrResultado[2] = $salidaTab;
    $arrResultado[1] = $iParam;
    $arrResultado[2] = $arraynuevo;
    echo json_encode($arrResultado);
    break;
}


function calcularDV($nit) {
  if (! is_numeric($nit)) {
      return false;
  }

  $arr = array(1 => 3, 4 => 17, 7 => 29, 10 => 43, 13 => 59, 2 => 7, 5 => 19, 
  8 => 37, 11 => 47, 14 => 67, 3 => 13, 6 => 23, 9 => 41, 12 => 53, 15 => 71);
  $x = 0;
  $y = 0;
  $z = strlen($nit);
  $dv = '';
  
  for ($i=0; $i<$z; $i++) {
      $y = substr($nit, $i, 1);
      $x += ($y*$arr[$z-$i]);
  }
  
  $y = $x%11;
  
  if ($y > 1) {
      $dv = 11-$y;
      return $dv;
  } else {
      $dv = $y;
      return $dv;
  }
  
}


//FUNCIÓN PARA GENERAR UN AUTOCOMPLETADOR
if (isset($_POST["query"])) {
  $data = array();
  $palabra = mysql_escape_string($_POST["query"]);
  $idcia = $_POST["idcia"];
  $idUser = $_POST["idUser"];
  $tipoUsu = $_POST["tipoUsu"];
  $oUsAdm = new Usuario();
  $oUsAdm->IdCia = $idcia;
  $oUsAdm->TipoUsuario = $tipoUsu;
  $oUsAdm->Dato = $palabra;
  $oUsAdm->getUsuaAutocom();
  for($i = 0; $i < $oUsAdm->Cant; $i++){
    $data[] = $oUsAdm->CbGrupUser[$i]["IdUsuario"].'-'.$oUsAdm->CbGrupUser[$i]["Nombre"];
  }
  echo json_encode($data);
}


?>