
<?php
	session_start();
	//display the data from page loing_1.php
	/*
	echo "<pre>";
	print_r($_REQUEST);
	echo "</pre>";
	*/
	
	                include('connect.php');
					$result = $db->prepare("SELECT * FROM sales order  by transaction_id desc");
					$result->execute();
					$row = $result->fetch();
					
				   $invo=$row['transaction_id'];

		
					$finalcode='DE-0000'.$invo;
	
	//connect the the MySQL db
	require 'db_connection.php';
	
	//building an SQL command and this will not allow
	//SQL or PHP injections - hack it if you CAN.!!
	
	$username=$_REQUEST[username];
	$passs=$_REQUEST[password];
	
	$sql ="select * from user where username='$username'";
	
	//execute the SQL command and check whether records are found
	
	$rs = $mysqli->query($sql);
	
	if(mysqli_num_rows($rs)>0){
		//echo "username correct password needs to be checked.!";
		
		$row = mysqli_fetch_assoc($rs);
		
		$pass=$row['password'];
		$pos=$row['position'];
		
		//lets check the password		
		if(($passs==$pass) && ($pos=='admin')){
			
			$_SESSION['SESS_MEMBER_ID'] = $row['id'];
			$_SESSION['SESS_FIRST_NAME'] = $row['username'];
			$_SESSION['SESS_LAST_NAME'] = $row['position'];
			$_SESSION['SESS_PASS'] = $row['password'];
						 
			header("location:main/index.php");
		
		}
		
		else if(($passs==$pass) && ($pos=='Cashier')){
			
			$_SESSION['SESS_MEMBER_ID'] = $row['id'];
			$_SESSION['SESS_FIRST_NAME'] = $row['username'];
			$_SESSION['SESS_LAST_NAME'] = $row['position'];
			$_SESSION['SESS_PASS'] = $row['password'];
						 
			header("location:main/index.php");
		
		}
		
		else if(($passs==$pass) && ($pos=='User')){
			
			$_SESSION['SESS_MEMBER_ID'] = $row['id'];
			$_SESSION['SESS_FIRST_NAME'] = $row['username'];
			$_SESSION['SESS_LAST_NAME'] = $row['position'];
			$_SESSION['SESS_PASS'] = $row['password'];
						 
			header("location:main/index.php");
			
		}
		
		
	   else if(($passs==$pass) && ($pos=='rapier')){
			
			$_SESSION['SESS_MEMBER_ID'] = $row['id'];
			$_SESSION['SESS_FIRST_NAME'] = $row['username'];
			$_SESSION['SESS_LAST_NAME'] = $row['position'];
			$_SESSION['SESS_PASS'] = $row['password'];
						 
			header("location:main/sales_1.php?invoice=$finalcode");
		
		}

		else if(($passs==$pass) && ($pos=='Stock Keeper')){
			
			$_SESSION['SESS_MEMBER_ID'] = $row['id'];
			$_SESSION['SESS_FIRST_NAME'] = $row['username'];
			$_SESSION['SESS_LAST_NAME'] = $row['position'];
			$_SESSION['SESS_PASS'] = $row['password'];
						 
			header("location:main/products.php");
		
		}
		
		else{
		   ?>
		       	<script>
					alert("Please try Again with Correct Username & Password");
				</script>
			<?php
			
			header("location:index.php");
		}
		
	}
	else{
		//no such username!!!
		//echo "No such username please retry..!";
		  ?>
		       	<script>
					alert("Invalid Login, Please try Again..");
				</script>
			<?php
			
			header("location:index.php");
	}	
	
	
	
	

?>