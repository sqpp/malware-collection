<?php include('header.php');?>
                  <div class="breadcrumbs">
                     <div class="col-sm-4">
                        <div class="page-header float-left">
                           <div class="page-title">
                              <h1>Dashboard</h1>
                           </div>
                        </div>
                     </div>
                     <div class="col-sm-8">
                        <div class="page-header float-right">
                           <div class="page-title">
                              <ol class="breadcrumb text-right">
                                 <li><a href="#">Dashboard</a></li>
                                 <li><a href="#">Add slider</a></li>
                                 
                              </ol>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="content mt-3">
                     <div class="animated fadeIn">
                        <div class="row">
                           
                           <div class="col-lg-6">
                              <div class="card">
                                 <div class="card-header">
                                    <strong>Add</strong> slider
                                 </div>
                                 <div class="card-body card-block">
                                    <?php

  include('db.php');
 
  if(isset($_POST['submit']))
  { 

       $slider_name=$_POST['slider_name'];
       
    $slider_comment=$_POST['slider_comment'];
     	if(isset($_FILES['files'])){
		//This function reads the extension of the file. It is used to determine if the file  is an image by checking the extension.
 function getExtension($str) {
         $i = strrpos($str,".");
         if (!$i) { return ""; }
         $l = strlen($str) - $i;
         $ext = substr($str,$i+1,$l);
         return $ext;
 }
//$fn = $_POST['fn'];
    $errors= array();
	foreach($_FILES['files']['tmp_name'] as $key => $tmp_name ){
		$file_name = $key.$_FILES['files']['name'][$key];
		$file_size =$_FILES['files']['size'][$key];
		$file_tmp =$_FILES['files']['tmp_name'][$key];
		$file_type=$_FILES['files']['type'][$key];	
		if($file_size > 2222097152){
			$errors[]='File size must be less than 2 MB';
			
        }	
			//get the extension of the file in a lower case format
  		 $extension = getExtension($file_name);
 		$extension = strtolower($extension);
 	//if it is not a known extension, we will suppose it is an error and will not  upload the file,  
	//otherwise we will do more tests
 if (($extension != "jpg") && ($extension != "jpeg") && ($extension != "png") && ($extension != "PNG") && ($extension != "JPEG") && ($extension != "PNG") && ($extension != "jfif") && ($extension != "JFIF")) 
 		{
		//print error message
 			
 		 $errors=1;
 		}
		
		else
		{
        $desired_dir="slider/";
        if(empty($errors)==true){
            if(is_dir($desired_dir)==false){
                mkdir("$desired_dir", 0700);		// Create directory if it does not exist
            }
            if(is_dir("$desired_dir/".$file_name)==false){
                move_uploaded_file($file_tmp,"slider/".$file_name);
            }else{									//rename the file if another one exist
                $new_dir="slider/".$file_name.time();
                 rename($file_tmp,$new_dir) ;				
            }
            
        }
        
       
        
	echo 	$query="insert into slider (slider_name,slider_comment,photo) values('$slider_name','$slider_comment','$file_name')";
if (!mysqli_query($con,$query)) 
{
  echo "Error Inserting Data";
  }	
		
		else{
                //print_r($errors);
        }
        
 
        
    }
	}
	if(!$errors){
		echo "<script language='javascript'>
{
  alert('Uploaded successfully');	
    window.location.href = 'add-slider.php';
}
</script>";
	}
	else
	{
	echo "<script language='javascript'>
{
  alert(' Choose only image files.');	
    window.location.href = 'add-slider.php';
}
</script>";
	}
}
  }
    ?>
                                    <form action="" method="post" enctype="multipart/form-data" class="form-horizontal">
                                      
                                       <div class="row form-group">
                                          <div class="col col-md-3"><label for="text-input" class=" form-control-label">slider Name</label></div>
                                          <div class="col-12 col-md-9"><input type="text" id="text-input" name="slider_name" placeholder="slider Name" class="form-control"></div>
                                       </div>
                                       <div class="row form-group">
                                          <div class="col col-md-3"><label for="text-input" class=" form-control-label">slider Comment</label></div>
                                          
                                          
                                          <div class="col-12 col-md-9">
                                             <!-- <textarea name="slider_comment" id="textarea-input" rows="9" placeholder="Content..." class="form-control"></textarea>-->
                                              <textarea name="slider_comment" id="editor1" rows="10" cols="80" class="form-control"></textarea>
                                              </div>
</div>
                                       <div class="row form-group">
              
                                          <div class="col-3">
                                          <label for="text-input" class=" form-control-label">Image</label>
                                       
                                       </div>
                                       
                                     <div class="col-12 col-md-9"><input type="file" id="text-input" name="files[]" placeholder="" class="form-control"></div>
                                       
                                    </div>
                                       <div class="card-footer">
                                    <button type="submit" class="btn btn-primary btn-sm" name="submit">
                                    <i class="fa fa-dot-circle-o"></i> Submit
                                    </button>
                                   
                                 </div>
                                    </form>
                                 </div>
                                 
                              </div>
                              
                           </div>
                           <div class="col-lg-6">
                          <div class="card">
<div class="card-header">
<strong class="card-title">Show All slider</strong>
</div>
<div class="card-body">
<table id="bootstrap-data-table" class="table table-striped table-bordered">
<thead>
<tr>
<th>S.no</th>

<th>slider Name</th>
<th>Image</th>
<th>Action</th>

</tr>
</thead>
<tbody>
   <?php
  include('db.php');
  $sql = "select * from slider";
$result = mysqli_query($con,$sql);
$i=1;
while ( $row=mysqli_fetch_array($result)) 
{
  
?>  
<tr>
<td><?php echo $i++;?></td>

<td><?php echo $row['slider_name'];?></td>
<td><img src="slider/<?php echo $row['photo'];?>" alt="" style="width: 100%;height: 100px;"></td>
<td><a href="slider_delete.php?id=<?= $row['slider_id']; ?>"><i class="fa fa-remove" style="color:red;"></i></a> </td>

</tr>
<?php } ?>

</tbody>
</table>
</div>
</div>
                              
                           </div>
                           
                        </div>
                     </div>
                  </div>
               </div>
               <script src="https://cdn.ckeditor.com/4.12.1/standard/ckeditor.js"></script>
              <script>
                  CKEDITOR.editorConfig = function (config) {
    config.language = 'es';
    config.uiColor = '#F7B42C';
    config.height = 300;
    config.toolbarCanCollapse = true;

};
CKEDITOR.replace('editor1');
              </script>
<?php include('footer.php');?>