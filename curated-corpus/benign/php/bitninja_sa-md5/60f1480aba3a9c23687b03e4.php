<?php

require "../config/conexion.php";



for ($j=1; $j < 8; $j++) {
	echo 'Pagina '.$j;
	$url = 'https://jcs.buk.cl/api/v1/employees?page_size=100&page='.$j;
	$ch = curl_init();///borrar
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_HTTPHEADER, array(
	    'Content-Type: application/json',
	    'auth_token: yjWX2nKZ66SuzoikszEhovLb'
	    ));
	$data = curl_exec($ch);
	$decoded = json_decode($data);
	$info = curl_getinfo($ch);
	curl_close($ch);

        //print_r($decoded);

			; print_r('<br>');
			; print_r('<br>');
			; print_r('<br>');
			; print_r('<br>');


	echo $decoded->data;		

	for ($i=0; $i < (sizeof($decoded->data)) ; $i++) {

		

		$id = $decoded->data[$i]->id; print_r('id: '.$id); print_r('<br>');

		$base = $decoded->data[$i]->current_job->custom_attributes->Base; print_r('base: '.$base); print_r('<br>');

		$rut =  trim(strrev(ucfirst(strrev((str_replace('.', '', $decoded->data[$i]->rut)))))); print_r('rut: '.$rut); print_r('<br>');
		$first_name = $decoded->data[$i]->first_name; print_r('first_name: '.$first_name); print_r('<br>');
		$surname = $decoded->data[$i]->surname; print_r('surname: '.$surname); print_r('<br>');
		$second_surname = $decoded->data[$i]->second_surname; print_r('second_surname: '.$second_surname); print_r('<br>');
		$civil_status = $decoded->data[$i]->civil_status; print_r('civil_status: '.$civil_status); print_r('<br>');
		$address = $decoded->data[$i]->address; print_r('address: '.$address); print_r('<br>');
		$district = $decoded->data[$i]->district; print_r('district: '.$district); print_r('<br>');
		$phone = $decoded->data[$i]->phone; print_r('phone: '.$phone); print_r('<br>');
		$gender = $decoded->data[$i]->gender; print_r('gender: '.$gender); print_r('<br>');
		$active_since = $decoded->data[$i]->active_since; print_r('active_since: '.$active_since); print_r('<br>');
		$health_company = $decoded->data[$i]->health_company; print_r('health_company: '.$health_company); print_r('<br>');
		$pension_fund = $decoded->data[$i]->pension_fund; print_r('pension_fund: '.$pension_fund); print_r('<br>');
		$account_number = $decoded->data[$i]->account_number; print_r('account_number: '.$account_number); print_r('<br>');

		$role_name = $decoded->data[$i]->current_job->role->name; print_r('role->name: '.$role_name); print_r('<br>');

		$bank = $decoded->data[$i]->bank; print_r('bank: '.$bank); print_r('<br>');
		$company_id = $decoded->data[$i]->current_job->company_id; print_r('company_id: '.$company_id); print_r('<br>');
		$birthday = $decoded->data[$i]->birthday; print_r('birthday: '.$birthday); print_r('<br>');
		$status = $decoded->data[$i]->status; print_r('status: '.$status); print_r('<br>');
		$email = $decoded->data[$i]->email; print_r('email: '.$email); print_r('<br>');
		$foto = $decoded->data[$i]->picture_url; 
		$foto = ($foto != '' || !(empty($foto)))? $foto : '../public/img/user2.png'; print_r('picture_url: '.$foto); print_r('<br>');

		// if ($role_name == 'Conductor Mecanico') {
		if ($role_name == 'Conductor Mecánico' || $role_name == 'Conductor Mecanico') {
			# code...
			print_r("ES conductor!!!!!! </br>");
			$sql =	"CALL sp_GuardarBukTrabajador(
		    			'$rut'
					,'$first_name'
		    			,'$surname'
					,'$second_surname'
					,'$civil_status'
					,'$address'
					,'$district'
					,'$phone'
					,'$active_since'
					,'$health_company'
					,'$pension_fund'
					,'$account_number'
					,'$role_name'
					,'$bank'
					,'$company_id'
					,'$birthday'
					,'$status'
					,'$gender'
					,'$email'
					,'$id'
					,'$foto'
				)";		
				$variable = ejecutarConsulta($sql);    		
				print_r($variable);
		}else{
			print_r("No Conductor!!!!!! </br>");
			$sql =	"CALL sp_GuardarBukTrabajador2(
		    			'$rut'
					,'$first_name'
		    			,'$surname'
					,'$second_surname'
					,'$civil_status'
					,'$address'
					,'$district'
					,'$phone'
					,'$active_since'
					,'$health_company'
					,'$pension_fund'
					,'$account_number'
					,'$role_name'
					,'$bank'
					,'$company_id'
					,'$birthday'
					,'$status'
					,'$gender'
					,'$email'
					,'$id'
					,'$foto'
					,'$base'
				)";
				$variable = ejecutarConsulta($sql);    		
				// print_r("Se ejecutó?: ".$variable." lalalala </br>");
			}

			; print_r('<br>');
			; print_r('<br>');
			; print_r('<br>');
	}//end For i

}//end For j


?>