<?php
session_start();
##================================================================
require_once("./_sql_handling2.php");
require_once("./_java.php");
require_once("./_bizonylat2.php");
require_once("./phpIN.php");
##================================================================
require_once("./_0.php");
if($_SESSION['path_0']!=""){
  require_once($_SESSION['path_0']);		
}
//================================================================
$tabla="termekek";
//================================================================
//combohoz feltöltés: ============================================
//================================================================


if(isset($_SESSION['tombok']['focsop'])){
  $focsop=$_SESSION['tombok']['focsop'];	
  $alcsop=$_SESSION['tombok']['alcsop'];
}else{
  $focsop=dbf2string($dbf,"focsop","WHERE 1 ORDER BY focsop","focsop");
  $_SESSION['tombok']['focsop']=$focsop;
  $alcsop=dbf2string($dbf,"alcsop","WHERE 1 ORDER BY focsop","alcsop");
  $_SESSION['tombok']['alcsop']=$alcsop;
}


if(sql_count($dbf,"_beallitas","WHERE mi LIKE 'armodositas'")==0){ 
  $beallitas['mi']="armodositas";
  $beallitas['beallitas']="true";
  sql_new($dbf,"_beallitas",$beallitas,$beallitas);  
}
if(sql_count($dbf,"_beallitas","WHERE mi LIKE 'aremlekezes'")==0){
  $beallitas['mi']="aremlekezes";
  $beallitas['beallitas']="true";
  sql_new($dbf,"_beallitas",$beallitas,$beallitas);  
}
if(sql_count($dbf,"_beallitas","WHERE mi LIKE 'aktualis_ar'")==0){
  $beallitas['mi']="aktualis_ar";
  $beallitas['beallitas']="1";
  sql_new($dbf,"_beallitas",$beallitas,$beallitas);  
}
if(sql_count($dbf,"_beallitas","WHERE mi LIKE 'tabBizTetel'")==0){
  $beallitas['mi']="tabBizTetel";
  $beallitas['beallitas']="15";
  sql_new($dbf,"_beallitas",$beallitas,$beallitas);  
}


//van ármodosítás? ----------------------------------------------------------
$beallitas=array("mi"=>"",  "beallitas"=>"",  "megj"=>"",);  
sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'armodositas'");
$armodositas=$beallitas['beallitas'];
sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'aremlekezes'");
$van_aremlekezes=$beallitas['beallitas'];
sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'gep_azonosito'");
$gep_azonosito=$beallitas['beallitas'];
sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'aktualis_ar'");
$aktualis_ar=$beallitas['beallitas'];

sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'bevetElar'");
$bevetElar=$beallitas['beallitas'];

//debug($bevetElar);

if($bevetElar=="true"){
  plusz_mezo($dbf,"tetel","elad1","14");
  plusz_mezo($dbf,"tetel","elad2","14");
  plusz_mezo($dbf,"tetel","elad3","14");
  plusz_mezo($dbf,"tetel","elad4","14");  
}

if(isset($_POST['tabBizTetel']) AND ($_POST['tabBizTetel']!="")){
  $tabBizTetel=$_POST['tabBizTetel'];
  sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'tabBizTetel'");
  $beallitas['beallitas']=$tabBizTetel;
  sql_edit($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'tabBizTetel'");
}else{
  sql_read($dbf,"_beallitas",$beallitas,$beallitas,"WHERE mi LIKE 'tabBizTetel'");
  $tabBizTetel=$beallitas['beallitas'];
  $_POST['tabBizTetel']=$tabBizTetel;
}
//---------------------------------------------------------------------------  	  	

if(isset($_SESSION['xfejid'])){
  $xfejid=$_SESSION['xfejid'];
}else{
  $xfejid=$_GET['xfejid'];	
  $_SESSION['xfejid']=$xfejid;
}

$back_link=$_GET['back_link'];

$vevok=array(
"vevokod"=>"",  "cegnev"=>"",  "osszek"=>"",  "cim"=>"",  "banksz"=>"",  
"tel"=>"",  "fax"=>"",  "megj1"=>"",  "megj2"=>"",  "arkat"=>"",  "kedv"=>"",  
"kontkod"=>"",  "adosz"=>"",  "fcs1"=>"",  "kedv1"=>"",  "ark1"=>"",  "fcs2"=>"",  
"kedv2"=>"",  "ark2"=>"",  "fcs3"=>"",  "kedv3"=>"",  "ark3"=>"",  "fcs4"=>"",  
"kedv4"=>"",  "ark4"=>"",  "fcs5"=>"",  "kedv5"=>"",  "ark5"=>"",  "utalasnap"=>"",  
"fizetesimod"=>"",  "vevocsop"=>"",  "x1"=>"",  "x2"=>"",  "x3"=>"",  "x4"=>"",  "x5"=>"",
);
   
sql_read($dbf,"vevok",$vevok,$vevok,"WHERE cegnev LIKE '".utf8_decode($_SESSION['fej']['nev'])."'");
if(sql_count($dbf,"vevok","WHERE cegnev LIKE '".utf8_decode($_SESSION['fej']['nev'])."'")==0){
  //debug(utf8_decode($_SESSION['fej']['nev']));
}
 
$termekek=array("id"=>"",  "azonosito"=>"",  "szallitoazon"=>"",  "vonalkod"=>"",  "megnevezes"=>"",  "megjegyzes"=>"",  
"egyseg"=>"",  "gyujtoazon"=>"",  "gyujtomennyiseg"=>"",  "gyujtoegyseg"=>"",  "afa"=>"",    "ksh"=>"",  "szam"=>"",  
"mennyiseg"=>"",  "minimum"=>"",  "vetelar"=>"",  "utcsobesz"=>"",  "elad1"=>"",  "elad2"=>"",  "elad3"=>"",  "elad4"=>"",  
"focsop"=>"",  "alcsop"=>"",  "foglalt"=>"",  "eladdeviza"=>"",  "deviza"=>"",  "gyariszam"=>"",  "kep"=>"",  "s1"=>"",  
"s2"=>"",  "s3"=>"",  "het"=>"",  "x1"=>"",  "x2"=>"",  "x3"=>"",  "x4"=>"",  "x5"=>"",);

if($bevetElar=="true"){
  $tetel=array(
  "gepissz"=>"",  "azon"=>"",  "nev"=>"",  "kshjel"=>"",  "kshsz"=>"",  "egyseg"=>"",  "afak"=>"",  
  "menny"=>"",  "eladar"=>"",  "devarf"=>"",  "devnem"=>"",  "kedv"=>"",  "megj"=>"",  "vear"=>"",  "rakt"=>"",  
  "kontir"=>"",  "gyszam"=>"",  "x1"=>"",  "x2"=>"",  "x3"=>"",  "x4"=>"",  "x5"=>"",
  "elad1"=>"","elad2"=>"","elad3"=>"","elad4"=>""  
  );
}else{
  $tetel=array(
  "gepissz"=>"",  "azon"=>"",  "nev"=>"",  "kshjel"=>"",  "kshsz"=>"",  "egyseg"=>"",  "afak"=>"",  
  "menny"=>"",  "eladar"=>"",  "devarf"=>"",  "devnem"=>"",  "kedv"=>"",  "megj"=>"",  "vear"=>"",  "rakt"=>"",  
  "kontir"=>"",  "gyszam"=>"",  "x1"=>"",  "x2"=>"",  "x3"=>"",  "x4"=>"",  "x5"=>"",
  );
}

$aremlekezes=array(
"cikkID"=>"",  "ceg"=>"",  "ar"=>"",  "raktar"=>"",
);

$xfocsop=array(
"focsop"=>"",  "kod"=>"",
);

$xalcsop=array(
"focsop"=>"",  "alcsop"=>"",  "kod"=>"",
);
  
$keszlet=array(
  "raktar"=>"","cikk"=>"","db"=>"",
);
  
if(isset($_POST['keres'])){
  sql_read($dbf,"focsop",$xfocsop,$xfocsop,"WHERE focsop LIKE '".$_POST['focsop']."'");	
  sql_read($dbf,"alcsop",$xalcsop,$alocsop,"WHERE focsop LIKE '".$_POST['alcsop']."'");	
  $feltetel="WHERE megnevezes NOT LIKE '*%' AND (megnevezes LIKE '%".$_POST['keres']."%' OR
                   vonalkod LIKE '%".$_POST['keres']."')
                   AND focsop LIKE '".$xfocsop['kod']."%' AND alcsop LIKE '".$xalcsop['kod']."%'";
}else{
  $feltetel="WHERE megnevezes NOT LIKE '*%' AND (megnevezes LIKE '%".$_POST['keres']."%' OR
                   vonalkod LIKE '%".$_POST['keres']."')
                   AND focsop LIKE '".$xfocsop['kod']."%' AND alcsop LIKE '".$xalcsop['kod']."%'";  
}

$feltetel=$feltetel."ORDER BY megnevezes";
$rec=sql_count($dbf,"termekek",$feltetel);

if(!isset($_SESSION['lap'])){
  $lap=1;
  $_SESSION['lap']=$lap;
}else{
  $lap=$_SESSION['lap'];
}

$maxsor=$tabBizTetel;
$maxoldal=(int)($rec/$maxsor);

$sum_neto="";
$sum_bruto="";

if(isset($_POST['mode'])){
  foreach($_POST as $kulcs=>$adat){
    if(substr($kulcs,0,2)=="id"){

//debug($_POST['elad1_'.$id].":".$_POST['elad2_'.$id].":".$_POST['elad3_'.$id].":".$_POST['elad4_'.$id]);

      $id=substr($kulcs,3);
      if($_POST['menny_'.$id]!=""){
	$feltetel_x="WHERE gepissz LIKE '".$xfejid."' AND azon LIKE '".$id."'";
	if(sql_count($dbf,"tetel",$feltetel_x)>0){
	  sql_read($dbf,"tetel",$tetel,$tetel,$feltetel_x);	
          $tetel['gepissz']=$xfejid;
          $tetel['azon']=$id;
	  $tetel['nev']=$_POST['megnevezes_'.$id];
	  $tetel['kshjel']=$_POST['kshjel_'.$id];
	  $tetel['kshsz']=$_POST['kshsz_'.$id];
	  $tetel['egyseg']=$_POST['egyseg_'.$id];
	  $tetel['afak']=$_POST['afa_'.$id];
	  $tetel['menny']=$_POST['menny_'.$id];
	  $tetel['eladar']=$_POST['ar_'.$id];
	  $tetel['rakt']=$gep_azonosito;
	  $tetel['x1']=kerekites($_POST['netto_'.$id],0.01);
	  $tetel['x2']=kerekites($_POST['netto_'.$id]*($_POST['afa_'.$id])/100,0.01);
	  $tetel['x3']=kerekites($_POST['brutto_'.$id],0.01);
	  $tetel['x4']="";
	  $tetel['x5']=date('Y-m-d');
          
          if($bevetElar=="true"){
            $tetel['elad1']=$_POST['elad1_'.$id];
            $tetel['elad2']=$_POST['elad2_'.$id];
            $tetel['elad3']=$_POST['elad3_'.$id];
            $tetel['elad4']=$_POST['elad4_'.$id];
          }
          
	  if($_POST['menny_'.$id]=="0"){
	    sql_del($dbf,"tetel",$feltetel_x);
	  }else{
	    sql_edit($dbf,"tetel",$tetel,$tetel,$feltetel_x);
	  }
	}else{
          $tetel['gepissz']=$xfejid;
          $tetel['azon']=$id;
	  $tetel['nev']=$_POST['megnevezes_'.$id];
	  $tetel['kshjel']=$_POST['kshjel_'.$id];
	  $tetel['kshsz']=$_POST['kshsz_'.$id];
	  $tetel['egyseg']=$_POST['egyseg_'.$id];
	  $tetel['afak']=$_POST['afa_'.$id];
	  $tetel['menny']=$_POST['menny_'.$id];
	  $tetel['eladar']=$_POST['ar_'.$id];
	  $tetel['rakt']=$gep_azonosito;
	  $tetel['x1']=kerekites($_POST['netto_'.$id],0.01);
	  $tetel['x2']=kerekites($_POST['netto_'.$id]*($_POST['afa_'.$id])/100,0.01);
	  $tetel['x3']=kerekites($_POST['brutto_'.$id],0.01);
	  $tetel['x4']="";
	  $tetel['x5']=date('Y-m-d');

         if($bevetElar=="true"){
            $tetel['elad1']=$_POST['elad1_'.$id];
            $tetel['elad2']=$_POST['elad2_'.$id];
            $tetel['elad3']=$_POST['elad3_'.$id];
            $tetel['elad4']=$_POST['elad4_'.$id];
          }
 
 	  sql_new($dbf,"tetel",$tetel,$tetel);
	}
      }
    }
  }
}
//-----------------------------------------------------
$sum_neto=$_POST['s_netto'];
$sum_bruto=$_POST['s_brutto'];

if($_POST['mode']=="first"){
  $lap=1;
  $_SESSION['lap']=$lap;
}elseif($_POST['mode']=="prev"){
  if($lap>1){
    $lap--;
    $_SESSION['lap']=$lap;
  }
}elseif($_POST['mode']=="next"){
  if($lap<$maxoldal+1){
    $lap++;
    $_SESSION['lap']=$lap;	  
  }		
}elseif($_POST['mode']=="last"){
  $lap=$maxoldal+1;
  $_SESSION['lap']=$lap;	
}elseif($_POST['mode']=="done"){

//print "Visszalépés";

  print "<SCRIPT language='JavaScript'>location.href='".$back_link."';</SCRIPT>";
}
##===============================================================================================================================================================================================================================
?>
<html>
  <head>
    <meta http-equiv=Content-Type content="text/html; charset=utf-8">
    <title>Tételek</title>
    
    <script language="JavaScript">
        function nettoChange(id){
            var xxx;
            var indexAr="ar_"+id;
            var indexBrAr="br_ar_"+id;
            var indexAfa="afa_"+id;
            var indexNetto="netto_"+id;
            var indexMenny="menny_"+id;
            var indexBrutto="brutto_"+id;
            
            var ar=document.getElementById(indexAr);
            var br_ar=document.getElementById(indexBrAr);
            var afa=document.getElementById(indexAfa);
            var netto=document.getElementById(indexNetto);
            var brutto=document.getElementById(indexBrutto);
            var menny=document.getElementById(indexMenny);
    
                xxxx=ar.value;
                ar.value=xxxx.replace(',', '.');
                  
                br_ar.value=parseInt(parseFloat(ar.value)*(1+(parseFloat(afa.value)/100))*100)/100;
                  
		netto.value=parseInt((parseFloat(ar.value)*parseFloat(menny.value))*100)/100;
		brutto.value=parseInt(parseInt((parseFloat(netto.value)*(parseFloat(afa.value)+100)/100)+0.5)*100)/100;          
        }
        function bruttoChange(id){
            var xxx;
            var indexAr="ar_"+id;
            var indexBrAr="br_ar_"+id;
            var indexAfa="afa_"+id;
            var indexNetto="netto_"+id;
            var indexMenny="menny_"+id;
            var indexBrutto="brutto_"+id;
            
            var ar=document.getElementById(indexAr);
            var br_ar=document.getElementById(indexBrAr);
            var afa=document.getElementById(indexAfa);
            var netto=document.getElementById(indexNetto);
            var brutto=document.getElementById(indexBrutto);
            var menny=document.getElementById(indexMenny);

                xxxx=br_ar.value;
                br_ar.value=xxxx.replace(',', '.');

		ar.value=parseInt(parseFloat(br_ar.value)/(1+(parseFloat(afa.value)/100))*100)/100;

                netto.value=parseInt((parseFloat(ar.value)*parseFloat(menny.value))*100)/100;
                brutto.value=parseInt((parseFloat(br_ar.value)*parseFloat(menny.value))+0.5);
		//brutto.value=parseInt(parseInt((parseFloat(netto.value)*(parseFloat(afa.value)+100)/100)+0.5)*100)/100;
        }
        function dbChange(id){
            var xxx;
            var indexAr="ar_"+id;
            var indexBrAr="br_ar_"+id;
            var indexAfa="afa_"+id;
            var indexNetto="netto_"+id;
            var indexMenny="menny_"+id;
            var indexBrutto="brutto_"+id;
            
            var ar=document.getElementById(indexAr);
            var br_ar=document.getElementById(indexBrAr);
            var afa=document.getElementById(indexAfa);
            var netto=document.getElementById(indexNetto);
            var brutto=document.getElementById(indexBrutto);
            var menny=document.getElementById(indexMenny);
            
            var sum_afa=document.getElementById('sum_afa');

              xxx=menny.value;
              menny.value=xxx.replace(',', '.');
               

	      netto.value=parseInt((parseFloat(ar.value)*parseFloat(menny.value))*100)/100;
	      brutto.value=parseInt(parseInt((parseFloat(netto.value)*(parseFloat(afa.value)+100)/100)+0.5)*100)/100;
		  
              sum_afa.value=parseInt(Number(sum_afa.value)+parseInt((parseFloat(netto.value)*(parseFloat(afa.value))/100)+0.5)*100)/100;
        }
      
    </script>  
  </head>
  <body style="width: 602px;">
	<center>
	<button type="button" onclick="document.getElementById('mode').value='first';document.myform.submit();">|<</button>
	<button type="button" onclick="document.getElementById('mode').value='prev';document.myform.submit();"><<</button>
	<button type="button" onclick="document.getElementById('mode').value='next';document.myform.submit();">>></button>
	<button type="button" onclick="document.getElementById('mode').value='last';document.myform.submit();">>|</button>
	</center>

    <form   action="<?php $_SERVER['PHP_SELF']?>" method="POST" id="myform" name="myform" >
	<center>

    <?php print "<h6>".$rec." => ".$lap."/".$maxoldal."</h6>";?>	
Sorok:<input id="tabBizTetel" name="tabBizTetel" size="3" value="<?php print $tabBizTetel; ?>" onblur="document.myform.submit();"></input>
Főcsoport: <?php print tomb2combo($focsop,"focsop","5","document.myform.submit()",$_POST['focsop']) ?> 
Alcsoport: <?php print tomb2combo($alcsop,"alcsop","5","document.myform.submit()",$_POST['alcsop']) ?> 	
Keresett szövegrész    <input id="keres" name="keres" size="10" value="" onblur="document.getElementById('mode').value='first';document.myform.submit();"></input>

	</center>
    <table style="text-align: left; width: 600px;" border="1">
	  <?php
          
//print_r($_GET);

                //Bevételezésnél az utolsó beszerar
		//$ar="elad".$aktualis_ar;
		$ar="utcsobesz";
                
		print "<tr>";
//		print "<th></th>";
		print "<th align='center' bgcolor='#A9D0F5'>Megnevezés</th>";
		print "<th align='center' bgcolor='#A9D0F5'>N.egys.ár</th>";

print "<th align='center' bgcolor='#A9D0F5'>B.egys.ár</th>";

		print "<th align='center' bgcolor='#A9D0F5'>Készlet</th>";
		print "<th align='center' bgcolor='#A9D0F5'>db</th>";
		print "<th align='center' bgcolor='#A9D0F5'>Me</th>";
		print "<th align='center' bgcolor='#A9D0F5'>Nettó  </th>";
		print "<th align='center' bgcolor='#A9D0F5'>Bruttó </th>";
                
                if($bevetElar="true"){
                  print "<th align='center' bgcolor='#A9D0F5'>Br.elad1</th>";
                  print "<th align='center' bgcolor='#A9D0F5'>Br.elad2</th>";
                  print "<th align='center' bgcolor='#A9D0F5'>Br.elad3</th>";
                  print "<th align='center' bgcolor='#A9D0F5'>Br.elad4</th>";
                }  
                
		print "</tr>\n";

		for($i=($lap-1)*$maxsor;$i<$rec AND $i<($lap-1)*$maxsor+$maxsor;$i++){
		  sql_read($dbf,"termekek",$termekek,$termekek,$feltetel,$i);
		  if((($i-4) % 5)!=0){
			$szin="#ffffff";
		  }else{
			$szin="#D8D8D8";
		  }
		  $id=$termekek['azonosito'];
		  print "<tr>";
//		  print "<td>".$i."</td>";
		  print "<td bgcolor='".$szin."'>".
		  "<input type='hidden' id='id_$id' name='id_$id' value='".$termekek['azonosito']."' onchange=''></input>".
		  "<input type='hidden' id='kshjel_$id' name='kshjel_$id' value='".$termekek['ksh']."' onchange=''></input>".
		  "<input type='hidden' id='kshsz_$id' name='kshsz_$id' value='".$termekek['szam']."' onchange=''></input>".
		  "<input size='30' id='megnevezes_$id' name='megnevezes_$id' value='".$termekek['megnevezes']."' readonly></input></td>";
//---------------------------------------------------		  
//ha már más nettó ár van megadva, akkor azt hozza fel
//---------------------------------------------------		  
                  $feltetel_x="WHERE gepissz LIKE '".$xfejid."' AND azon LIKE '".$id."'";
		  if($armodositas=="true"){
                    if(sql_count($dbf,"tetel",$feltetel_x)>0){		
                      sql_read($dbf,"tetel",$tetel,$tetel,$feltetel_x);
		      print "<td align='right' bgcolor='".$szin."'>".
		      "<input size='10' id='ar_$id' name='ar_$id' value='".$tetel['eladar']."' ";  			  
                    }else{
		      $aremlekeze_ar_feltetel="WHERE cikkID LIKE '".$termekek['azonosito']."' AND ceg LIKE '".$vevok['vevokod']."'";  
		      if($van_aremlekezes=="true" AND sql_count($dbf,"aremlekezes",$aremlekeze_ar_feltetel)>0){
			sql_read($dbf,"aremlekezes",$aremlekezes,$aremlekezes,$aremlekeze_ar_feltetel);	
		        print "<td align='right' bgcolor='".$szin."'>".
		        "<input size='10' id='ar_$id' name='ar_$id' value='".$aremlekezes['ar']."' ";  					
		      }else{
		        print "<td align='right' bgcolor='".$szin."'>".
		        "<input size='10' id='ar_$id' name='ar_$id' value='".$termekek[$ar]."' ";  	
		      }  			
                    }
		  }else{
		    $aremlekeze_ar_feltetel="WHERE cikkID LIKE '".$termekek['azonosito']."' AND ceg LIKE '".$vevok['vevokod']."'";  
		    if($van_aremlekezes=="true" AND sql_count($dbf,"aremlekezes",$aremlekeze_ar_feltetel)>0){
		      sql_read($dbf,"aremlekezes",$aremlekezes,$aremlekezes,$aremlekeze_ar_feltetel);	
		      print "<td align='right' bgcolor='".$szin."'>".
		      "<input size='10' id='ar_$id' name='ar_$id' value='".$aremlekezes[$ar]."' readonly";  					
		    }else{
		      print "<td align='right' bgcolor='".$szin."'>".
		      "<input size='10' id='ar_$id' name='ar_$id' value='".$termekek[$ar]."' readonly";  	
		    }  			
		  }
// NETTO ár változik -------------------------------

//                  print "onkeyup='nettoChange(".$id.");'></input>"."</td>";

/*
		  print "
		  onkeyup='
                  
                  xxxx=document.getElementById(\"ar_$id\").value;
                  document.getElementById(\"ar_$id\").value=xxxx.replace(\",\", \".\");
                  
		  document.getElementById(\"br_ar_$id\").value=
                  parseInt(parseFloat(document.getElementById(\"ar_$id\").value)*(1+(parseFloat(document.getElementById(\"afa_$id\").value)/100))*100)/100;    
                  
		  document.getElementById(\"netto_$id\").value=
                  parseInt((parseFloat(document.getElementById(\"ar_$id\").value)*parseFloat(document.getElementById(\"menny_$id\").value))*100)/100;
		  document.getElementById(\"brutto_$id\").value=
                  (parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)));";
*/
//                  parseInt((parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)))+0.5);";
//                  parseInt((parseFloat(document.getElementById(\"netto_$id\").value)*(parseFloat(document.getElementById(\"afa_$id\").value)+100)/100)+0.5);
		  print "'></input>"."</td>";

//---------------------------------------------------		  
                  $feltetel_x="WHERE gepissz LIKE '".$xfejid."' AND azon LIKE '".$id."'";
		  if($armodositas=="true"){
                    if(sql_count($dbf,"tetel",$feltetel_x)>0){		
                      sql_read($dbf,"tetel",$tetel,$tetel,$feltetel_x);
		      print "<td align='right' bgcolor='".$szin."'>".
		      "<input size='10' id='br_ar_$id' name='br_ar_$id' value='".
                      
                      kerekites($tetel['eladar']*(1+$termekek['afa']/100),0.01)
                      
                      ."' ";  			  
                    }else{
		      $aremlekeze_ar_feltetel="WHERE cikkID LIKE '".$termekek['azonosito']."' AND ceg LIKE '".$vevok['vevokod']."'";  
		      if($van_aremlekezes=="true" AND sql_count($dbf,"aremlekezes",$aremlekeze_ar_feltetel)>0){
			sql_read($dbf,"aremlekezes",$aremlekezes,$aremlekezes,$aremlekeze_ar_feltetel);	
		        print "<td align='right' bgcolor='".$szin."'>".
		        "<input size='10' id='br_ar_$id' name='br_ar_$id' value='".
                        
                        kerekites($aremlekezes['ar']*(1+$termekek['afa']/100),0.01)
                        
                        ."' ";  					
		      }else{
		        print "<td align='right' bgcolor='".$szin."'>".
		        "<input size='10' id='br_ar_$id' name='br_ar_$id' value='".
                        
                        kerekites($termekek[$ar]*(1+$termekek['afa']/100),0.01)
                        
                        ."' ";  	
		      }  			
                    }
		  }else{
		    $aremlekeze_ar_feltetel="WHERE cikkID LIKE '".$termekek['azonosito']."' AND ceg LIKE '".$vevok['vevokod']."'";  
		    if($van_aremlekezes=="true" AND sql_count($dbf,"aremlekezes",$aremlekeze_ar_feltetel)>0){
		      sql_read($dbf,"aremlekezes",$aremlekezes,$aremlekezes,$aremlekeze_ar_feltetel);	
		      print "<td align='right' bgcolor='".$szin."'>".
		      "<input size='10' id='br_ar_$id' name='br_ar_$id' value='".
                      
                      kerekites($aremlekezes[$ar]*(1+$termekek['afa']/100),0.01)
                      
                      ."' readonly";  					
		    }else{
		      print "<td align='right' bgcolor='".$szin."'>".
		      "<input size='10' id='br_ar_$id' name='br_ar_$id' value='".
                      
                      kerekites($termekek[$ar]*(1+$termekek['afa']/100),0.01)
                      
                      ."' readonly";  	
		    }  			
		  }
// BRUTTO ár változik -------------------------------

//                  print "onkeyup='bruttoChange(".$id.");'></input>"."</td>";


		  print "
		  onchange='

                  xxxx=document.getElementById(\"br_ar_$id\").value;
                  document.getElementById(\"br_ar_$id\").value=xxxx.replace(\",\", \".\");

		  document.getElementById(\"ar_$id\").value=
                  parseInt(parseFloat(document.getElementById(\"br_ar_$id\").value)/(1+(parseFloat(document.getElementById(\"afa_$id\").value)/100))*100)/100;

		  document.getElementById(\"netto_$id\").value=
                  parseInt((parseFloat(document.getElementById(\"ar_$id\").value)*parseFloat(document.getElementById(\"menny_$id\").value))*100)/100;
		  document.getElementById(\"brutto_$id\").value=
                  (parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)));";
//                  parseInt((parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)))+0.5);";
//                  parseInt((parseFloat(document.getElementById(\"netto_$id\").value)*(parseFloat(document.getElementById(\"afa_$id\").value)+100)/100)+0.5);
                  print "'></input>"."</td>";

//---------------------------------------------------		  
//Mennyiség
                  $kfeltetel="WHERE raktar LIKE '".$gep_azonosito."' AND cikk LIKE '".$id."'";
                  if(sql_count($dbf,"keszlet",$kfeltetel)>0){
                    sql_read($dbf,"keszlet",$keszlet,$keszlet,$kfeltetel);
                    print "<td align='right' bgcolor='".$szin."'>".$keszlet['db']."</td>";
                  }else{
  		    print "<td align='right' bgcolor='".$szin."'>".$termekek['mennyiseg']."</td>";
                  }
                  
//---------------------------------------------------		  
		  $feltetel_x="WHERE gepissz LIKE '".$xfejid."' AND azon LIKE '".$id."'";
		  if(sql_count($dbf,"tetel",$feltetel_x)>0){
		    sql_read($dbf,"tetel",$tetel,$tetel,$feltetel_x);	
// DB változik -------------------------------                  
		    print "<td align='center' bgcolor='#FFD8FF'>".
		    "<input size='4' id='menny_$id' name='menny_$id' value='".$tetel['menny']."' onkeyup='";

//                    print "dbChange(".$id.");";
                    

                    print "xxxx=document.getElementById(\"menny_$id\").value;
                    document.getElementById(\"menny_$id\").value=xxxx.replace(\",\", \".\");

                    
		    document.getElementById(\"netto_$id\").value=
                    parseInt((parseFloat(document.getElementById(\"ar_$id\").value)*parseFloat(document.getElementById(\"menny_$id\").value))*100)/100;
		    document.getElementById(\"brutto_$id\").value=
                    (parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)));";
//                    parseInt((parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)))+0.5);";
//                    parseInt((parseFloat(document.getElementById(\"netto_$id\").value)*(parseFloat(document.getElementById(\"afa_$id\").value)+100)/100)+0.5);";
		    
                    
                    print "' ></input>"."</td>";
		  }else{
// db változik -------------------------------                  
		    print "<td align='center' bgcolor='#FFD8FF'>".
		    "<input size='4' id='menny_$id' name='menny_$id' value='' onkeyup='";

//                    print "dbChange(".$id.");";

                    print "xxxx=document.getElementById(\"menny_$id\").value;
                    document.getElementById(\"menny_$id\").value=xxxx.replace(\",\", \".\");
                    
		    document.getElementById(\"netto_$id\").value=
                    parseInt((parseFloat(document.getElementById(\"ar_$id\").value)*parseFloat(document.getElementById(\"menny_$id\").value))*100)/100;
                    document.getElementById(\"brutto_$id\").value=
                    (parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)));";
//                    parseInt((parseFloat(document.getElementById(\"br_ar_$id\").value)*(parseFloat(document.getElementById(\"menny_$id\").value)))+0.5);";
//                    parseInt((parseFloat(document.getElementById(\"netto_$id\").value)*(parseFloat(document.getElementById(\"afa_$id\").value)+100)/100)+0.5);";
		    
                    print "' ></input>"."</td>";
		  }
		  print "<td align='center' bgcolor='".$szin."'>"."<input size='10' id='egyseg_$id' name='egyseg_$id' value='".$termekek['egyseg']."' readonly></input></td>";
                  if(sql_count($dbf,"tetel",$feltetel_x)>0){
		    print "<td align='right' bgcolor='".$szin."'>".
		    "<input size='10' id='netto_$id' name='netto_$id' value='".$tetel['x1']."' readonly onchange=''></input>"."</td>";
		    print "<td align='right' bgcolor='".$szin."'>".
		    "<input type='hidden' size='10' id='afa_$id' name='afa_$id' value='".$termekek['afa']."' readonly onchange=''></input>".
		    "<input size='10' id='brutto_$id' name='brutto_$id' value='".$tetel['x3']."' readonly  onchange=''></input>"."</td>";
		    //print "</tr>\n";
		  }else{
		    print "<td align='right' bgcolor='".$szin."'>".
		    "<input size='10' id='netto_$id' name='netto_$id' readonly onchange=''></input>"."</td>";
		    print "<td align='right' bgcolor='".$szin."'>".
		    "<input type='hidden' size='10' id='afa_$id' name='afa_$id' value='".$termekek['afa']."' readonly onchange=''></input>".
		    "<input size='10' id='brutto_$id' name='brutto_$id' readonly onchange=''></input>"."</td>";
		    //print "</tr>\n";
		  }
                  
                  if($bevetElar=="true"){
                    $feltetel_x="WHERE gepissz LIKE '".$xfejid."' AND azon LIKE '".$id."'";
                    sql_read($dbf,"tetel",$tetel,$tetel,$feltetel_x);
                    if($tetel['elad1']!=""){
                      print "<td align='right' bgcolor='".$szin."'>".
                      "<input size='10' id='elad1_$id' name='elad1_$id' value='".$tetel['elad1']."' >";  	
                    }else{
                      if($termekek['elad1Brutto']!=""){
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad1_$id' name='elad1_$id' value='".$termekek['elad1Brutto']."' >";
                      }else{
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad1_$id' name='elad1_$id' value='".round($termekek['elad1']*(100+$termekek['afa'])/100)."' >";
                      }
                    }
                    if($tetel['elad2']!=""){
                      print "<td align='right' bgcolor='".$szin."'>".
                      "<input size='10' id='elad2_$id' name='elad2_$id' value='".$tetel['elad2']."' >";  	
                    }else{
                      if($termekek['elad2Brutto']!=""){
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad2_$id' name='elad2_$id' value='".$termekek['elad2Brutto']."' >";
                      }else{
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad2_$id' name='elad2_$id' value='".round($termekek['elad2']*(100+$termekek['afa'])/100)."' >";
                      }
                    }
                    if($tetel['elad3']!=""){
                      print "<td align='right' bgcolor='".$szin."'>".
                      "<input size='10' id='elad3_$id' name='elad3_$id' value='".$tetel['elad3']."' >";  	
                    }else{
                      if($termekek['elad3Brutto']!=""){
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad3_$id' name='elad3_$id' value='".$termekek['elad3Brutto']."' >";
                      }else{
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad3_$id' name='elad3_$id' value='".round($termekek['elad3']*(100+$termekek['afa'])/100)."' >";
                      }
                    }
                    if($tetel['elad4']!=""){
                      print "<td align='right' bgcolor='".$szin."'>".
                      "<input size='10' id='elad4_$id' name='elad4_$id' value='".$tetel['elad4']."' >";  	
                    }else{
                      if($termekek['elad4Brutto']!=""){
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad4_$id' name='elad4_$id' value='".$termekek['elad4Brutto']."' >";
                      }else{
                        print "<td align='right' bgcolor='".$szin."'>".
                        "<input size='10' id='elad4_$id' name='elad4_$id' value='".round($termekek['elad4']*(100+$termekek['afa'])/100)."' >";
                      }
                    }
                  }
                  
                  print "</tr>\n";                
		}
	  ?>
	</table>
    </br>
	<input type="hidden" id="mode" name="mode" value="done"></input>
	<center>
	<button type="button" style="font-size: 20px" onclick="document.getElementById('mode').value='first';document.myform.submit();">|<</button>
	<button type="button" style="font-size: 20px" onclick="document.getElementById('mode').value='prev';document.myform.submit();"><<</button>
	<button type="button" style="font-size: 20px" onclick="document.getElementById('mode').value='next';document.myform.submit();">>></button>
	<button type="button" style="font-size: 20px" onclick="document.getElementById('mode').value='last';document.myform.submit();">>|</button>
    </br></br>
	<button type="button" style="font-size: 20px" onclick="document.getElementById('mode').value='done';document.myform.submit();"> Kész </button>
	</center>
    </form>
  </body>
</html>
