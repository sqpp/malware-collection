<?php
session_start();
session_id('vip_id');
error_reporting(0);

?>



<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NEMO Admin</title>
    
    
    <link href="assets/css_table/bootstrap.css" rel="stylesheet">
	<link href="assets/css_table/DT_bootstrap.css" rel="stylesheet">
    
    <!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME ICONS STYLES-->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!--CUSTOM STYLES-->
    <link href="assets/css/style.css" rel="stylesheet" />
      <!-- HTML5 Shiv and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css"  href="assets/tcal/tcal.css" rel="stylesheet" />

<script type="text/javascript" src="include/datetimepicker_css.js"></script>

</head>

<!--- DB ----->
<?php 
include("101db.php");
?>
<!--- DB ---->



<?php
	$error = '';
	if(isset($_POST['is_login'])){
		$sql = "SELECT * FROM vip WHERE `un` = '".mysql_real_escape_string($_POST['username'])."' AND `pw` = '".mysql_real_escape_string(md5($_POST['password']))."'";
		$sql_result = mysql_query ($sql, $connection ) or die ('request "Could not execute SQL query" '.$sql);
		$user = mysql_fetch_assoc($sql_result);
 ?>
       <?php
		if(!empty($user)){
			$_SESSION['user_info'] = $user;
			$query = " UPDATE vip SET l_login = NOW() WHERE vip_id=".$user['vip_id'];
			mysql_query ($query, $connection ) or die ('request "Could not execute SQL query" '.$query);
		}
		else{
			$error = 'Wrong User Name or password.';
		}
	}
	
	if(isset($_GET['ac']) && $_GET['ac'] == 'logout'){
		$_SESSION['user_info'] = null;
		unset($_SESSION['user_info']);
		unset($_SESSION['vip_id']);
		session_destroy($_SESSON['vip_id']);
		header("location:index.php");
	}
?>
	<?php if(isset($_SESSION['user_info']) && is_array($_SESSION['user_info'])) { ?>

<?php
$id = $_POST['edit'];


$ids = $id;


function cwUpload($field_name = '$id', $target_folder = 'upload', $file_name = '$id', $thumb = FALSE, $thumb_folder = 'upload/thumbs', $thumb_width = '100', $thumb_height = '50', $ids = '$ids'){
$ids = rand(10,1000);



    //folder path setup
    $target_path = $target_folder;
    $thumb_path = $thumb_folder;
    
    //file name setup
    $filename_err = explode(".",$_FILES[$field_name]['name']);
    $filename_err_count = count($filename_err);
    $file_ext = $filename_err[$filename_err_count-1];
    if($file_name != ''){
        $fileName = $file_name.'.'.$file_ext;
		$fileName = $ids."_".$fileName;
    }else{
        $fileName = $_FILES[$field_name]['name'];
		$fileName = $ids."_".$fileName;
    }
    
    //upload image path
    $upload_image = $target_path.basename($fileName);
 
 
    
    //upload image
    if(move_uploaded_file($_FILES[$field_name]['tmp_name'],$upload_image))
    {
        //thumbnail creation
        if($thumb == TRUE)
        {
            $thumbnail = $thumb_path.$fileName;
            list($width,$height) = getimagesize($upload_image);
            $thumb_create = imagecreatetruecolor($thumb_width,$thumb_height);
            switch($file_ext){
                case 'jpg':
                    $source = imagecreatefromjpeg($upload_image);
                    break;
                case 'jpeg':
                    $source = imagecreatefromjpeg($upload_image);
                    break;

                case 'png':
                    $source = imagecreatefrompng($upload_image);
                    break;
                case 'gif':
                    $source = imagecreatefromgif($upload_image);
                    break;
                default:
                    $source = imagecreatefromjpeg($upload_image);
            }
	
	
            imagecopyresized($thumb_create,$source,0,0,0,0,$thumb_width,$thumb_height,$width,$height);
            switch($file_ext){
                case 'jpg' || 'jpeg':
                    imagejpeg($thumb_create,$thumbnail,100);
                    break;
                case 'png':
                    imagepng($thumb_create,$thumbnail,100);
                    break;

                case 'gif':
                    imagegif($thumb_create,$thumbnail,100);
                    break;
                default:
                    imagejpeg($thumb_create,$thumbnail,100);
            }

        }

        return $fileName;
    }
    else
    {
        return false;
    }
}
?>
	
	
	
	
<body>
    <div id="wrapper">
        <nav class="navbar navbar-default navbar-cls-top " role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a  class="navbar-brand" href="index.html">Admin Panel</a>
            </div>

            
<!-- /. TOP School Name  ON -->
<ul class="nav">
<div style=" font-size:25px; text-align:center; margin:15px; color:#FFFFFF; line-height:28px;"><?php echo $designation ?></div>
    </nav>

	<!-- /. TOP School Name  END -->
        
        
        <!-- /. SIDEBAR MENU  -->
        <nav  class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
                    <li>
                        <div class="user-img-div">
                            <img src="./assets/img/user1.jpg" class="img-circle" />
						</div>

                    </li>
                    
                     <li><a  href="#"> <strong> <?php echo $_SESSION['user_info']['name']?> </strong></a></li>

                    <li><a href="index.php"><i class="fa fa-dashboard "></i>Dashboard</a></li>
                    
                    <li><a href="add_news.php"><i class="fa fa-puzzle-piece"></i>Add News</a></li>                  
                    
                    <!---
                    
                    <li><a href="search.php"><i class="fa fa-search "></i>Search</a></li>
                                     
                    <li><a href="mail.php"><i class="fa fa-envelope "></i>Mails</a></li>
                    
                    --->
                    
                    <li><a href="setting.php"><i class="fa fa-user "></i>My Profile</a></li>
                    
                    <li><a href="index.php?ac=logout"><i class="fa fa-sign-out fa-rotate-270 "></i>Logout</a></li>

                   
<!--- Multilevel Menu ----
                    <li>
                        <a href="#"><i class="fa fa-sitemap "></i>Multilevel Link <span class="fa arrow"></span></a>
                         <ul class="nav nav-second-level">
                            <li>
                                <a href="#"><i class="fa fa-cogs "></i>Second  Link</a>
                            </li>
                             <li>
                                <a href="#"><i class="fa fa-bullhorn "></i>Second Link</a>
                            </li>
                            <li>
                                <a href="#">Second Level<span class="fa arrow"></span></a>
                                <ul class="nav nav-third-level">
                                    <li>
                                        <a href="#">Third  Link</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Link</a>
                                    </li>

                                </ul>

                            </li>
                        </ul>
                    </li>
  ------->                  
  <!--- Blank Page -----                  
                    <li> <a href="blank.html"><i class="fa fa-dashcube "></i>Blank Page</a></li>
 ------>                  
                </ul>
            </div>

        </nav>

		<!-- /. SIDEBAR MENU  END -->
        
<!-- /. BODY ON -->
        
        <div id="page-wrapper" class="page-wrapper-cls">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="page-head-line">DASHBOARD</h1>


   <div class="col-md-8">
      <div class="panel panel-default">
         <div class="panel-heading">
         TEXT  ELEMENTS
         </div>
      <div class="panel-body">
      <form method="post" action="edit_save.php" id="form1">
    <?php 
		$query=mysql_query("select * from news20_news WHERE id='$id' ")or die(mysql_error());
		while($row=mysql_fetch_array($query)){
			$id = $row['id'];
			$status= $row['status'];
			$cat_id = $row['cat_id'];
			$title = $row['title'];
			$summary =$row['summary'];
			$content = $row['content'];
			$image = $row['image'];
			$caption = $row['caption'];
			$publish_date = $row['publish_date'];
	?>



  		<div class="form-group ">
        <label for="exampleInputEmail1">Status</label>
    	<select class="form-control" name="status" style="height:40px;">
        <?php if($status =="Published"){ ?>
        <option value="Published">Published</option>
        <option value="Hidden">Hidden</option>
        <?php }else{ ?>
        <option value="Hidden">Hidden</option>
        <option value="Published">Published</option>
        <?php } ?>       
        </select>
        </div>

  		<div class="form-group ">
        <label for="exampleInputEmail1">Category</label>
        <select class="form-control" name="cat" style="height:40px;" required>
        <?php 
		$query1=mysql_query("select * from news20_categories WHERE id='$cat_id'")or die(mysql_error());
		while($row1=mysql_fetch_array($query1)){
		?> 
        <option value="<?php echo $row1['id']; ?>"><?php echo $row1['cat_name']; ?></option>
		<?php } ?>
        <?php 
		$query2=mysql_query("select * from news20_categories ")or die(mysql_error());
		while($row2=mysql_fetch_array($query2)){
		?>
        <option value="<?php echo $row2['id']; ?>"><?php echo $row2['cat_name']; ?></option>
        <?php } ?>                
        </select>
  		</div>

  	<div class="form-group">
    <label for="exampleInputEmail1">Title</label>
    <input type="text" class="form-control" name="title" value="<?php echo $title ?>" placeholder="Hedding" style="height:40px;" required />
  	</div>
    
  	<div class="form-group">
    <label for="exampleInputEmail1">Summary</label>
    <input type="text" class="form-control" name="summary" value="<?php echo $summary ?>" placeholder="News Summary" style="height:40px;" />
  	</div>    
        

        

                     

 <div class="form-group">

<script type="text/javascript" src="nicEdit.js"></script>
<script type="text/javascript">
	bkLib.onDomLoaded(function() { nicEditors.allTextAreas() });
</script>

<label for="exampleInputEmail1">Content</label>
<textarea name="area2" id="content" class="form-control" rows = "20">
<?php echo $content ?>
</textarea> 




</div>



  	<div class="form-group">
    <label for="exampleInputEmail1">Image Caption</label>
    <input type="text" class="form-control" name="image_cap" value="<?php echo $caption ?>" placeholder="Image Caption" style="height:40px;"  />
  	</div> 


  	<div class="form-group">
<input type="text" name="date" id="publish_date" maxlength="25" size="25" value="<?php echo $publish_date ?>" readonly /> <a href="javascript:NewCssCal('publish_date','yyyymmdd','dropdown',true,24,false)"><img src="images/cal.gif" width="16" height="16" alt="Pick a date" border="0" /></a>
	</div>
<input type="hidden" name="id" value="<?php echo $id ?>" /> 

    	<button type="submit" name="submit" class="btn btn-primary btn-lg"><i class=" fa fa-refresh "></i> Update News</button>        
		</form>
  
  
    	</div>
</div></div>
<?php } ?>

   <div class="col-md-4">
      <div class="panel panel-default">
         <div class="panel-heading">
         IMAGE  ELEMENTS
         </div>
      <div class="panel-body">

<div class="form-group">
	
<?php if($image==''){?>
<img src="images/no_image.jpg" width="290"/>
 <form  action="image_up.php" method="post" name="view" id="view">
 <input type="hidden" name="id" value="<?php echo $id ?>" /> 
 <button class="btn btn-primary" name="image_up"  onClick="parent.location='image_up.php'" value="<?php echo $id; ?>"><i class="fa fa-list-alt "></i> Image Upload</button>
 </form>
<?php }else { ?>
<img src="upload/thumbs/<?php echo $image ?>" width="290"/> 
<br/> 
 <form  action="remove_image.php" method="post" name="remove" id="remove"> 
 <input type="hidden" name="id" value="<?php echo $id ?>" />
 <button class="btn btn-danger" name="image_remove"  onClick="parent.location='remove_image.php'" value="<?php echo $id; ?>"><i class="fa fa-list-alt "></i> Remove Image</button>
 </form>
<?php } ?>

</div>

</div>

</div>
            </div>
						
						
						
						
						
						
  <div class="col-md-4">
      <div class="panel panel-default">
         <div class="panel-heading">
         ADD EXTRA IMAGE
         </div>
      <div class="panel-body">

<div class="form-group">
	<form method="post" enctype="multipart/form-data">
    <input type="file" name="image"/>
	<input type="hidden" name="ids" id="ids"  value="<?php echo $id ?>" /> 
    <button type="submit_image" name="submit_image" value="<?php echo $id ?>" class="btn btn-primary">UPLOAD</button>
	</form>
<?php
		$query_image=mysql_query("select * from image WHERE s_id='$id' ")or die(mysql_error());
		while($row_image=mysql_fetch_array($query_image)){
			$set_image_id = $row_image['i_id'];
			$set_image_image = $row_image['image'];
			$set_image_tumb_path = $row_image['path'];
			$set_image_full_path = $row_image['full_path'];
?>		
<?php if($set_image_image != ''){ ?>
<img src="<?php echo $set_image_tumb_path; ?>" alt="">
 <form  action="remove_image_extra.php" method="post" name="remove" id="remove"> 
 <input type="hidden" name="id" value="<?php echo $set_image_id ?>" />
 <button class="btn btn-danger" name="image_remove"  onClick="parent.location='remove_image_extra.php'" value="<?php echo $set_image_id; ?>"><i class="fa fa-list-alt "></i> Remove Image</button>
 </form>
<br/>
<p>Path :- <?php echo $set_image_full_path; ?> </p>
<hr>
<?php }else{ ?>
<img src="images/no_image.jpg" width="290"/>
<?php } }?>

	
<?php
if(isset($_POST['submit_image'])){
if(!empty($_FILES['image']['name'])){
   $ids= $_POST['ids']; 
    //call thumbnail creation function and store thumbnail name
    $upload_img = cwUpload('image','upload/','',TRUE,'upload/thumbs/','280','190');
    
    //full path of the thumbnail image
    $thumb_src = 'upload/thumbs/'.$upload_img;
	$full_src = 'www.insssl.lk/upload/'.$upload_img;
    
    //set success and error messages
    $message = $upload_img?"<span style='color:#008000;'>Image thumbnail have been created successfully.</span>":"<span style='color:#F00000;'>Some error occurred, please try again.</span>";
	echo $ids;

	
	$insert="Insert into image(image, s_id, path, full_path)
 	values('".$upload_img."','".$ids."','".$thumb_src."','".$full_src."')";

$rs=mysql_query($insert) or die(mysql_error());

	?><script type="text/javascript">location.href = 'index.php';</script> <?php
    
}else{
    
    //if form is not submitted, below variable should be blank
    $thumb_src = '';
    $message = '';
}
}
?>

</div>

</div>

</div>
            </div>					
						
						
						
						
						
						
						
						
						
						
						
						
						
						
            </div>



</div>
        </div>
        <!-- /. PAGE WRAPPER  -->
    </div>
        </div>
    <!-- /. WRAPPER  -->

    <!-- /. FOOTER ON  -->
<?php 
include("footer.php"); 

?>

	<?php } else { 
	

header("location:index.php");

 } ?>   

    <!-- /. FOOTER OFF  -->
    
    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="../assets/js/jquery-1.11.1.js"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="../assets/js/bootstrap.js"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="../assets/js/jquery.metisMenu.js"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="../assets/js/custom.js"></script>


<script type="text/javascript" src="../assets/js_table/jquery.dataTables.js"></script>
<script type="text/javascript" src="../assets/js_table/DT_bootstrap.js"></script>

</body>
</html>
