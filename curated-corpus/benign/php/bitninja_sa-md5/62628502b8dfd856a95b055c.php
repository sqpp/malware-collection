<?php
require_once("../backend/functions.php");
dbconn();
loggedinonly();

mysqli_query($con, 'SET NAMES UTF8;');

$jo = mysqli_query($con, "SELECT * FROM ep_setting");
$jj = mysqli_fetch_assoc($jo);
$ukutipan = $jj["namakutipan"];
$uyear = date('Y');

if ($ukutipan == "OKT") {
    $ukutipan = "OKTOBER";
}

######## User Profile

if ($_POST['mode'] == "editinfo") {

    global $con;

    $uid = $_POST['uid'];
    $namapenuh = $_POST['namapenuh'];
    $alamat = $_POST['address'];
    $notel = $_POST['notel'];
    $emel = $_POST['emel'];
    $payaddr = $_POST['payaddr'];
    $nohp = $_POST['nohp'];

    $op = mysqli_query($con, "UPDATE users SET
        namapenuh = '$namapenuh', 
        address = '$alamat', 
        notel = '$notel', 
        email = '$emel', 
        payaddress = '$payaddr', 
        nohp = '$nohp' 
        WHERE id = '$uid'");

    if ($op) {

        echo "Kemaskini berjaya " . $uid . "";
    } else {

        echo "Kemaskini tidak berjaya (" . mysqli_error($con) . ")";
    }
}

if ($_POST['mode'] == "tukarpass") {

    $chpassword = $_POST['pass'];
    $passagain = $_POST['passagain'];
    $uid = $_POST['psid'];

    if ($chpassword != "") {
        $res = mysqli_query($con, "SELECT id, password, secret, enabled FROM users WHERE id = '$uid' AND status = 'confirmed'");
        $row = mysqli_fetch_array($res);

        if (strlen($chpassword) < 6)
            $message = "Katalaluan terlalu pendek.";
        if ($chpassword != $passagain)
            $message = "Katalaluan tidak sepadan.";
        $chpassword = md5($chpassword);
    }

    if ((!$chpassword) || (!$passagain))
        $message = "Sila isi ruang yang diperlukan.";

    if (!$message) {
        mysqli_query($con, "UPDATE users SET password = " . sqlesc($chpassword) . "  WHERE id = '$uid'") or die(mysqli_error($con));
        echo "Katalaluan telah ditukar.";
    } else {
        echo $message;
    }
}

if ($_GET['modo'] == "browsedata") {

    echo "<div id='divbrowsey'><div style='overflow-x:auto'>
    <table class=\"table table-hover table-bordered\" width='100%'>";
    echo "<tr><thead>
    <th width=\"2%\">Bil.</th>
    <th width='5%'>Tarikh</th>
    <th>Negeri</th>
    <th>Daerah</th>
    <th>Sekolah</th>
    <th>Data</th>
    <th>Tahun</th>
    <th>Kutipan</th>
    <th>Status</th>
    <th>Bahan</th>
    <th width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></thead></tr>";

    $e = 1;

    $user = $CURUSER['id'];
    $class = $CURUSER['class'];
    $negeri = $CURUSER['negeri'];
    $daerah = $CURUSER['ppd'];

    if ($class == "2") {
        $were = "WHERE user = '$user'";
    }

    if ($class == "3") {
        $were = "WHERE daerah = '$daerah'";
    }

    if ($class == "4") {
        $were = "WHERE negeri = '$negeri'";
    }

    if ($class >= "5") {

        $were = "";
    }

    $res2 = mysqli_query($con, "SELECT COUNT(*) FROM ep_awan $were");
    $row = mysqli_fetch_array($res2);
    $count = $row[0];
    $perpage = 10;

    list($pagertop, $pagerbottom, $limit) = ajax_pager($perpage, $count, "ajax/op.php", "browsedata");

    $rqq = "SELECT * FROM ep_awan $were ORDER BY id ASC $limit";
    echo $rqq;
    $resqq = mysqli_query($con, $rqq);

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='11'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["daerah"], "nama", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $tarikh = $row["tarikh"];
            $datas = $row["datas"];
            $deta = $row["datas"];
            $tahun = $row["tahun"];
            $kutipan = infoAwan($row["kutipan"], "nama", "ep_kutipan");
            $status = infoAwan($row["status"], "nama", "ep_status");
            $jnsbhn = infoAwan($row["jnsbhn"], "nama", "ep_bahan");
            $user = $row["user"];

            echo "<tr><td>$e</td><td>$tarikh</td>";

            if ($row["daerah"] == 0) {

                $daerah = "-";
                $merge = "style='background:url(../images/bulang.png) repeat'";
            }

            if ($row["sekolah"] == 0) {

                $sekolah = "-";
                $merge2 = "style='background:url(../images/bulang.png) repeat'";
            }

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "3") {
                $edit = "<a title='Edit' href='awan.php?mode=edit&id=$id'><span class=\"glyphicon glyphicon-edit\" aria-hidden=\"true\"></span></a> 
                <a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='awan.php?mode=pdm&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }

            echo "<td>$negeri</td>
            <td $merge>$daerah</td>
            <td $merge2>$sekolah</td>
            <td align='center'><a href=download.php?file=$deta><button class='btn btn-success'>DOWNLOAD</button></a></td>
            <td>$tahun</td>
            <td>$kutipan</td>
            <td>$status</td>
            <td>$jnsbhn</td>
            <td width=50 align=center>
            $edit            
            </td></tr>";
            $e++;
        }
    }
    echo "</tbody></table></div>";

    print($pagerbottom);

    echo "</div>";
}

///// AKAUN

if ($_POST['mode'] == "updateppd") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $neg = $_POST['neg'];

        pilih("ppd", "ep_ppd", $ppd, "updetsek()", "", "WHERE negeri = '$neg'");
    }
}

if ($_POST['mode'] == "updateppd2") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $neg = $_POST['neg'];

        pilih("ppdz", "ep_ppd", $ppd, "updetsek2()", "", "WHERE negeri = '$neg'");
    }
}

if ($_POST['mode'] == "updetsek") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $ppd = $_POST['ppd'];

        pilih("sekolah", "ep_sekolah", $sekolah, "", "", "WHERE ppd = '$ppd'");
    }
}

//browse ppd form biasa

if ($_POST['mode'] == "brwseppd") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $neg = $_POST['neg'];
        pilih("ppd", "ep_ppd", $ppd, "brwsesek()", "", "WHERE negeri = '$neg'");
    }
}

if ($_POST['mode'] == "paparPPD") {

    $neg = $_POST['neg'];
    input0("PPD", "ppd", pilihep("ppd", "ep_ppd", $ppd, "", "nama", "kodppd", "showJenis()", "WHERE negeri = '$neg'", "style='font-size:10pt;padding:0px'"));
}

//browse ppd pada analisis
if ($_POST['mode'] == "brwseppdana") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $neg = $_POST['neg'];

        pilih("ppds", "ep_ppd", $ppd, "brwsesek()", "", "WHERE negeri = '$neg'");
    }
}

if ($_POST['mode'] == "brwseppd2") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $neg = $_POST['neg'];

        pilih("ppd", "ep_ppd", $ppd, "pilihppd()", "", "WHERE negeri = '$neg'");
    }
}

//browse sekolah form biasa
if ($_POST['mode'] == "brwsesek") {

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $ppd = $_POST['ppd'];

        pilih("sekolah", "ep_sekolah", $sekolah, "", "", "WHERE ppd = '$ppd'");
    }
}

//browse sekolah form analisis
if ($_POST['mode'] == "paparSek") {

    $ppd = infoKod($_POST['ppd'], "ep_ppd", "kodppd", "id");
    $jensek = $_POST['jensek'];

    $klausa = array();

    if ($ppd != "0") {
        $klausa[] = "ppd = '$ppd'";
    }

    if ($jensek != "0") {
        $klausa[] = "jenis = '$jensek'";
    }

    $where = !empty($klausa) ? ' WHERE ' . implode(' AND ', $klausa) : '';

    input0("Sekolah", "sekolah", pilihep("sekolah", "ep_sekolah", "", "", "nama", "kod", "", $where), "style='font-size:10pt;padding:0px'");
}

if ($_POST['mode'] == "ppdsetel") {

    info("Sila pilih PPD untuk memaparkan sekolah yang berkenaan.");

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $neg = $_POST['id'];

        $al = mysqli_query($con, "SELECT * FROM ep_ppd WHERE negeri = '$neg' ORDER BY id ASC");

        if (mysqli_num_rows($al) == "") {

            amaran("Tiada Data.");
        } else {

            while ($aa = mysqli_fetch_array($al)) {

                $id = $aa["id"];
                $daerah = $aa["nama"];
                $brp = statawan($id, "daerah");

                if ($brp > 0) {

                    $bdge = "badge-info";
                } else {

                    $bdge = "badge-error";
                }

                echo "<a href='#' onclick=\"seksetel('$id')\"  class=\"list-group-item\"><span class=\"badge $bdge\">$brp</span>$daerah</a>";
            }
        }
    }
}

if ($_POST['mode'] == "seksetel") {

    info("Sila pilih sekolah untuk paparan terperinci sekolah.");

    if ($CURUSER == "") {

        amaran("Sila daftar sebagai ahli. <a href='akaun_daftar.php'>DAFTAR</a>");
    } else {

        $ppd = $_POST['id'];

        $al = mysqli_query($con, "SELECT * FROM ep_sekolah WHERE ppd = '$ppd' ORDER BY id ASC");

        if (mysqli_num_rows($al) == "") {

            amaran("Tiada Data.");
        } else {

            while ($aa = mysqli_fetch_array($al)) {

                $id = $aa["id"];
                $daerah = $aa["nama"];
                $brp = statawan($id, "sekolah");

                if ($brp > 0) {

                    $bdge = "badge-info";
                } else {

                    $bdge = "badge-error";
                    echo "<a href='#' class=\"list-group-item\"><span class=\"badge $bdge\">$brp</span>$daerah</a>";
                }
            }
        }
    }
}

if ($_POST['mode'] == "browsey") {

    echo "<div id='ajaxPage2'>";

    echo $_POST['ld'];

    $negeri = $_POST['neg'];
    $ppd = $_POST['ppd'];
    $sekolah = $_POST['sek'];
    $jenis = $_POST['jns'];
    $alir = $_POST['alir'];

    echo "<div class='table-responsive'><table class=\"table table-hover table-bordered vercell tablekecil datatebel\" width='100%'>";
    echo "<thead><tr>
    <th width=\"2%\">Bil.</th>
    <th width=\"2%\">Negeri</th>
    <th width=\"15%\">Daerah</th>
    <th class='text-center'>#</td>
    <th class='text-center'>Sekolah</th>
    <th class='text-center' width=\"15%\">Data</th>
    </tr></thead><tbody>";

    $e = 1;

    $clauses = array();

    if ($negeri != "0") {
        $clauses[] = "negeri = '$negeri'";
    }

    if ($ppd != "0") {
        $clauses[] = "ppd = '$ppd'";
    }

    if ($CURUSER["class"] == "2") {
        $clauses[] = "id = '$CURUSER[sekolah]'";
    }

    if ($jenis != "0") {

        $clauses[] = "jenis = '$jenis'";
    }

    if ($alir != "-2") {

        $clauses[] = "statuskhas = '$alir'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

    //echo $where;

    $res2 = mysqli_query($con, "SELECT * FROM ep_sekolah $where");
    $row = mysqli_fetch_array($res2);
    $count = mysqli_num_rows($res2);
    $perpage = 20;
    list($pagertop, $pagerbottom, $limit) = ajax_pager2($perpage, $count, "ajax/op.php?neg=$negeri&ppd=$ppd&jns=$jenis&alir=$alir", "browsey");

    if ($count == 0) {
        echo "<p class=\"information\">Tiada data.</p>";
    } else {

        $e = 1;

        $page = $_GET['page'];

        if ($page > 0) {

            $e = 20 * $page + 1;
        }

        $rqq = "SELECT * FROM ep_sekolah $where ORDER BY negeri ASC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri2 = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["ppd"], "nama", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $user = $row["id"];
            $statusaliran = $row["statuskhas"];

            if ($CURUSER["class"] > 2) {

                $linki = "details.php?id=$user";
            } else {

                $linki = "#";
            }


            if ($statusaliran == "-1") {

                $statusaliran = "PERDANA";
            } elseif ($statusaliran == "0") {

                $statusaliran = "PERDANA + PPKI";
            } elseif ($statusaliran == "1") {

                $statusaliran = "SKPK";
            } elseif ($statusaliran == "2") {

                $statusaliran = "SKPK + SKPK LD";
            } elseif ($statusaliran == "3") {

                $statusaliran = "SKPK LD";
            }

            if ($row["negeri"] == "14") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kl.png'>";
            } elseif ($row["negeri"] == "1") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/johor.jpg'>";
            } elseif ($row["negeri"] == "2") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kedah.png'>";
            } elseif ($row["negeri"] == "3") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kelantan.png'>";
            } elseif ($row["negeri"] == "4") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/melaka.png'>";
            } elseif ($row["negeri"] == "5") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/nsmbilan.png'>";
            } elseif ($row["negeri"] == "6") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/pahang.png'>";
            } elseif ($row["negeri"] == "7") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/penang.png'>";
            } elseif ($row["negeri"] == "8") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perak.png'>";
            } elseif ($row["negeri"] == "9") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perlis.png'>";
            } elseif ($row["negeri"] == "10") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/selangor.png'>";
            } elseif ($row["negeri"] == "11") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/tganu.png'>";
            } elseif ($row["negeri"] == "12") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sabah.png'>";
            } elseif ($row["negeri"] == "13") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sarawak.png'>";
            } elseif ($row["negeri"] == "15") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/labuan.jpg'>";
            } elseif ($row["negeri"] == "16") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/putrajaya.jpg'>";
            }

            echo "<tr><td align='center'>$e</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "3") {
                $edit = "<a title='Edit' href='awan.php?mode=edit&id=$id'><span class=\"glyphicon glyphicon-edit\" aria-hidden=\"true\"></span></a> 
                <a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='awan.php?mode=pdm&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }

            $sek = $row['nama'];
            $neg = $row['neg'];
            $kodsek = $row["kod"];

            $gmbr = logosek($id);

            if ($gmbr == "") {

                $gmbr = "defaultlogo.png";
            } else {

                $gmbr = logosek($id);
            }

            echo "<td align='center'>$negeri</td>
            <td class='text-center'>$daerah</td>
            <td class='text-center'><img class='img-thumbnail' style='width:50px' src='images/avatars/$gmbr'></td>
            <td><a href='$linki'>$sek</a>
            <div><span class='label label-default'>$kodsek</span> <span class='label label-default'>$statusaliran</span></div>
            </td>
            <td align='center'>

            <div>" . checksekolah($kodsek, $row["statuskhas"]) . "</div>
            </td></tr>";
            $e++;
        }
    }

    echo "</tbody></table></div>";

    print($pagerbottom);

    echo "</div>";
}

if ($_POST['mode'] == "browsejud") {

    loadjs();

    $negeri = $_POST['neg'];
    $ppd = $_POST['ppd'];
    $sekolah = $_POST['sek'];
    $tahun = $_POST['thn'];
    $kutipan = $_POST['kut'];
    $status = $_POST['stat'];

    $cari = $_POST['cari'];

    $e = 1;

    $clauses = array();

    if ($negeri != "0") {
        $clauses[] = "negeri = '$negeri'";
    }

    if ($ppd != "0") {
        $clauses[] = "daerah = '$ppd'";
    }

    if ($sekolah != "0") {
        $clauses[] = "sekolah = '$sekolah'";
    }

    if ($tahun != "") {
        $clauses[] = "tahun = '$tahun'";
    }

    if ($kutipan != 0) {
        $clauses[] = "kutipan = '$kutipan'";
    }

    if ($status != 0) {
        $clauses[] = "status = '$status'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

    $res2 = mysqli_query($con, "SELECT * FROM ep_awan $where");
    $row = mysqli_fetch_array($res2);
    $count = mysqli_num_rows($res2);

    if ($count == 0) {
        amaran("Tiada data yang ditemui.");
    } else {

        echo "<div class='table-responsive'><table class=\"table table-hover table-bordered vercell tablekecil datatebel\" width='100%'>";
        echo "<thead><tr>
        <th width=\"2%\">Bil.</th>
        <th width='5%'>Tarikh</th>
        <th width=\"2%\">Negeri</th>
        <th class='text-center'>Daerah</th>
        <th class='text-center' width=\"\">Sekolah</th>
        <th class='text-center' width=\"\">Status</th>
        <th width=\"7%\" class='text-center' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

        $e = 1;

        $rqq = "SELECT * FROM ep_awan $where ORDER BY negeri ASC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri2 = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["daerah"], "nama", "ep_ppd");
            $kodppd = infoAwan($row["daerah"], "kodppd", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $tarikh = $row["tarikh"];
            $datas = CutName($row["datas"], 15);
            $deta = $row["datas"];
            $tahun = $row["tahun"];
            $kutipan = infoAwan($row["kutipan"], "nama", "ep_kutipan");
            $status = infoAwan($row["status"], "nama", "ep_status");
            $jnsbhn = infoAwan($row["jnsbhn"], "nama", "ep_bahan");
            $user = $row["user"];

            if ($CURUSER["class"] > 2) {

                $linki = "details.php?id=$user";
            } else {

                $linki = "#";
            }

            if ($row["daerah"] == 0) {

                $daerah = "<span class='label label-primary'>DATA NEGERI GABUNG</span>";
                $merge = "class='bg-warning'";
            } elseif ($row["sekolah"] == 0) {

                $sekolah = "<span class='label label-danger'>DATA PPD GABUNG</span>";
                $merge = "class='bg-info'";
            } else {

                $merge = "";
            }

            if ($row["negeri"] == "14") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kl.png'>";
            } elseif ($row["negeri"] == "1") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/johor.jpg'>";
            } elseif ($row["negeri"] == "2") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kedah.png'>";
            } elseif ($row["negeri"] == "3") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kelantan.png'>";
            } elseif ($row["negeri"] == "4") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/melaka.png'>";
            } elseif ($row["negeri"] == "5") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/nsmbilan.png'>";
            } elseif ($row["negeri"] == "6") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/pahang.png'>";
            } elseif ($row["negeri"] == "7") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/penang.png'>";
            } elseif ($row["negeri"] == "8") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perak.png'>";
            } elseif ($row["negeri"] == "9") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perlis.png'>";
            } elseif ($row["negeri"] == "10") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/selangor.png'>";
            } elseif ($row["negeri"] == "11") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/tganu.png'>";
            } elseif ($row["negeri"] == "12") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sabah.png'>";
            } elseif ($row["negeri"] == "13") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sarawak.png'>";
            } elseif ($row["negeri"] == "15") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/labuan.jpg'>";
            } elseif ($row["negeri"] == "16") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/putrajaya.jpg'>";
            }

            echo "<tr><td align='center'>$e</td><td align='center'>" . TarikhCun2($tarikh) . "</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] <= "3") {
                $edit = "<input type='hidden' id='statusdata' value='$row[status]'><input type='hidden' id='pkodppd' value='$kodppd'><a class='btn btn-sm' onclick=\"padamdata()\" title='Mohon Padam Data' href='#'><i class='fa fa-times-circle'></i></a>";
            }
            if ($CURUSER["class"] >= "4") {
                $edits = "<a class='btn btn-sm' title='Padam Data Awan' href='awan.php?mode=padamkan&id=$id'><i class='fa fa-times-circle'></i></a>
                <a class='btn btn-sm' title='Padam Data Semua' href='awan.php?mode=padamsemua&id=$id' onclick=\"return confirm('Anda pasti mahu padam semua data sekolah ini?');\"><i style='color:red' class='fa fa-trash'></i></a>";
            }

            $sek = $row['sekolah'];
            $ppd = $row['daerah'];
            $neg = $row['negeri'];
            $kodsek = infoSekolah($sek, "kod");

            $statusz = $row["status"];

            if ($statusz == "1") {
                $statuss = "-1";
            } elseif ($statusz == "2") {
                $statuss = "0";
            } elseif ($statusz == "3") {
                $statuss = "1";
            }

            $statusppd = progppd($row["daerah"]);

            echo "<td align='center'>$negeri</td>
            <td>$daerah ($kodppd)</td>
            <td width='200'>$sekolah ($kodsek)<div>" . checksekolah($kodsek, $statuss) . "</div></td>
            <td class='text-center' style='width:10%'><span class='label label-danger'>$status</span></td>
            <td width='15%' align=center>
            $edit $edits           
            </td></tr>";
            $e++;
        }
    }

    echo "</tbody></table></div>";
}

if ($_GET['modo'] == "browsejud") {

    echo "<div id='ajaxPage2'>";

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $sekolah = $_GET['sek'];
    $tahun = $_GET['thn'];
    $kutipan = $_GET['kut'];
    $status = $_GET['stat'];

    $cari = $_GET['cari'];

    echo "<div class='table-responsive'><table class=\"table table-hover table-bordered vercell\" width='100%'>";
    echo "<thead><tr>
    <th width=\"2%\">Bil.</th>
    <th width='5%'>Tarikh</th>
    <th width=\"2%\">Negeri</th>
    <th class='text-center'>Daerah</th>
    <th class='text-center' width=\"\">Sekolah</th>
    <th class='text-center' width=\"\">Kutipan</th>
    <th class='text-center' width=\"\">Status</th>
    <th width=\"7%\" class='text-center' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

    $e = 1;

    $clauses = array();

    if ($negeri != "0") {
        $clauses[] = "negeri = '$negeri'";
    }

    if ($ppd != "0") {
        $clauses[] = "daerah = '$ppd'";
    }

    if ($sekolah != "0") {
        $clauses[] = "sekolah = '$sekolah'";
    }

    if ($CURUSER["class"] == "2") {
        $clauses[] = "user = '$CURUSER[id]'";
    }

    if ($tahun != "") {
        $clauses[] = "tahun = '$tahun'";
    }

    if ($kutipan != 0) {
        $clauses[] = "kutipan = '$kutipan'";
    }

    if ($status != 0) {
        $clauses[] = "status = '$status'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';
    //echo $where;

    $res2 = mysqli_query($con, "SELECT * FROM ep_awan $where");
    $row = mysqli_fetch_array($res2);
    $count = mysqli_num_rows($res2);
    $perpage = 20;
    list($pagertop, $pagerbottom, $limit) = ajax_pager2($perpage, $count, "ajax/op.php?neg=$negeri&ppd=$ppd&sek=$sekolah&thn=$tahun&kut=$kutipan&stat=$status", "browsejud");

    if ($count == 0) {
        echo "<p class=\"information\">Tiada data.</p>";
    } else {

        $e = 1;

        $page = $_GET['page'];

        if ($page > 0) {

            $e = 20 * $page + 1;
        }

        $rqq = "SELECT * FROM ep_awan $where ORDER BY negeri ASC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri2 = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["daerah"], "nama", "ep_ppd");
            $kodppd = infoAwan($row["daerah"], "kodppd", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $tarikh = $row["tarikh"];
            $datas = CutName($row["datas"], 15);
            $deta = $row["datas"];
            $tahun = $row["tahun"];
            $kutipan = infoAwan($row["kutipan"], "nama", "ep_kutipan");
            $status = infoAwan($row["status"], "nama", "ep_status");
            $jnsbhn = infoAwan($row["jnsbhn"], "nama", "ep_bahan");
            $user = $row["user"];

            if ($CURUSER["class"] > 2) {

                $linki = "details.php?id=$user";
            } else {

                $linki = "#";
            }

            if ($row["daerah"] == 0) {

                $daerah = "<span class='label label-primary'>DATA NEGERI GABUNG</span>";
                $merge = "class='bg-warning'";
            } elseif ($row["sekolah"] == 0) {

                $sekolah = "<span class='label label-danger'>DATA PPD GABUNG</span>";
                $merge = "class='bg-info'";
            } else {

                $merge = "";
            }

            if ($row["negeri"] == "14") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kl.png'>";
            } elseif ($row["negeri"] == "1") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/johor.jpg'>";
            } elseif ($row["negeri"] == "2") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kedah.png'>";
            } elseif ($row["negeri"] == "3") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kelantan.png'>";
            } elseif ($row["negeri"] == "4") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/melaka.png'>";
            } elseif ($row["negeri"] == "5") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/nsmbilan.png'>";
            } elseif ($row["negeri"] == "6") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/pahang.png'>";
            } elseif ($row["negeri"] == "7") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/penang.png'>";
            } elseif ($row["negeri"] == "8") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perak.png'>";
            } elseif ($row["negeri"] == "9") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perlis.png'>";
            } elseif ($row["negeri"] == "10") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/selangor.png'>";
            } elseif ($row["negeri"] == "11") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/tganu.png'>";
            } elseif ($row["negeri"] == "12") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sabah.png'>";
            } elseif ($row["negeri"] == "13") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sarawak.png'>";
            } elseif ($row["negeri"] == "15") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/labuan.jpg'>";
            } elseif ($row["negeri"] == "16") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/putrajaya.jpg'>";
            }

            if ($row["jnsbhn"] == "1") {

                $jnsbhn = "<span class='label label-success'>TXT</span>";
            } elseif ($row["jnsbhn"] == "2") {

                $jnsbhn = "<span class='label label-info'>EXC</span>";
            }

            echo "<tr $merge class='small'><td align='center'>$e</td><td align='center'>$tarikh</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "3") {
                $edit = "<input type='hidden' id='statusdata' value='$row[status]'><input type='hidden' id='pkodppd' value='$kodppd'><a title='Mohon Padam Data' onclick=\"padamdata()\" href='#'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }
            if ($CURUSER["class"] >= "4") {
                $edits = "<a title='Padam Data Awan' href='awan.php?mode=padamkan&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>
                <a title='Padam Data Semua' href='awan.php?mode=padamsemua&id=$id' onclick=\"return confirm('Anda pasti mahu padam semua data sekolah ini?');\"><span style='color:red' class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }

            $sek = $row['sekolah'];
            $ppd = $row['daerah'];
            $neg = $row['negeri'];
            $kodsek = infoSekolah($sek, "kod");

            $statusz = $row["status"];

            if ($statusz == "1") {
                $statuss = "-1";
            } elseif ($statusz == "2") {
                $statuss = "0";
            } elseif ($statusz == "3") {
                $statuss = "1";
            }

            $statusppd = progppd($row["daerah"]);

            echo "<td align='center'>$negeri</td>
            <td>$daerah ($kodppd)</td>
            <td width='200'>$sekolah ($kodsek)<div>" . checksekolah($kodsek, $statuss) . "</div></td>
            <td class='text-center' style='width:1px;white-space:nowrap'>
            <span class='label label-info'>$kutipan $tahun</span></td>
            <td class='text-center' style='width:10%'><span class='label label-danger'>$status</span></td>
            <td width='10%' align=center>
            $edit $edits           
            </td></tr>";
            $e++;
        }
    }

    echo "</tbody></table></div>";

    print($pagerbottom);

    echo "</div>";
}

if ($_GET['modo'] == "browsey") {

    echo "<div id='ajaxPage2'>";

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $sekolah = $_GET['sek'];
    $jenis = $_GET['jns'];
    $alir = $_GET['alir'];

    echo "<div class='table-responsive'><table class=\"table table-hover table-bordered vercell kecik\" width='100%'>";
    echo "<thead><tr>
    <th width=\"2%\">Bil.</th>
    <th width=\"2%\">Negeri</th>
    <th width=\"15%\">Daerah</th>
    <th class='text-center'>#</td>
    <th class='text-center'>Sekolah</th>
    <th class='text-center' width=\"15%\">Data</th>
    </tr></thead><tbody>";

    $e = 1;

    $clauses = array();

    if ($negeri != "0") {
        $clauses[] = "negeri = '$negeri'";
    }

    if ($ppd != "0") {
        $clauses[] = "ppd = '$ppd'";
    }

    if ($CURUSER["class"] == "2") {
        $clauses[] = "id = '$CURUSER[sekolah]";
    }

    if ($jenis != "0") {

        $clauses[] = "jenis = '$jenis'";
    }

    if ($alir != "-2") {

        $clauses[] = "statuskhas = '$alir'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

    //echo $where;

    $res2 = mysqli_query($con, "SELECT * FROM ep_sekolah $where");
    $row = mysqli_fetch_array($res2);
    $count = mysqli_num_rows($res2);
    $perpage = 20;
    list($pagertop, $pagerbottom, $limit) = ajax_pager2($perpage, $count, "ajax/op.php?neg=$negeri&ppd=$ppd&jns=$jenis&alir=$alir", "browsey");

    if ($count == 0) {
        echo "<p class=\"information\">Tiada data.</p>";
    } else {

        $e = 1;

        $page = $_GET['page'];

        if ($page > 0) {

            $e = 20 * $page + 1;
        }

        $rqq = "SELECT * FROM ep_sekolah $where ORDER BY negeri ASC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri2 = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["ppd"], "nama", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $user = $row["id"];
            $statusaliran = $row["statuskhas"];

            if ($CURUSER["class"] > 2) {

                $linki = "details.php?id=$user";
            } else {

                $linki = "#";
            }


            if ($statusaliran == "-1") {

                $statusaliran = "PERDANA";
            } elseif ($statusaliran == "0") {

                $statusaliran = "PERDANA + PPKI";
            } elseif ($statusaliran == "1") {

                $statusaliran = "SKPK";
            } elseif ($statusaliran == "2") {

                $statusaliran = "SKPK + SKPK LD";
            } elseif ($statusaliran == "3") {

                $statusaliran = "SKPK LD";
            }

            if ($row["negeri"] == "14") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kl.png'>";
            } elseif ($row["negeri"] == "1") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/johor.jpg'>";
            } elseif ($row["negeri"] == "2") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kedah.png'>";
            } elseif ($row["negeri"] == "3") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kelantan.png'>";
            } elseif ($row["negeri"] == "4") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/melaka.png'>";
            } elseif ($row["negeri"] == "5") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/nsmbilan.png'>";
            } elseif ($row["negeri"] == "6") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/pahang.png'>";
            } elseif ($row["negeri"] == "7") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/penang.png'>";
            } elseif ($row["negeri"] == "8") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perak.png'>";
            } elseif ($row["negeri"] == "9") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perlis.png'>";
            } elseif ($row["negeri"] == "10") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/selangor.png'>";
            } elseif ($row["negeri"] == "11") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/tganu.png'>";
            } elseif ($row["negeri"] == "12") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sabah.png'>";
            } elseif ($row["negeri"] == "13") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sarawak.png'>";
            } elseif ($row["negeri"] == "15") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/labuan.jpg'>";
            } elseif ($row["negeri"] == "16") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/putrajaya.jpg'>";
            }

            echo "<tr><td align='center'>$e</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "3") {
                $edit = "<a title='Edit' href='awan.php?mode=edit&id=$id'><span class=\"glyphicon glyphicon-edit\" aria-hidden=\"true\"></span></a> 
                <a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='awan.php?mode=pdm&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }

            $sek = $row['nama'];
            $neg = $row['neg'];
            $kodsek = $row["kod"];

            $gmbr = logosek($id);

            if ($gmbr == "") {

                $gmbr = "defaultlogo.png";
            } else {

                $gmbr = logosek($id);
            }

            echo "<td align='center'>$negeri</td>
            <td class='text-center'>$daerah</td>
            <td class='text-center'><img class='img-thumbnail' style='width:50px' src='images/avatars/$gmbr'></td>
            <td><a href='$linki'>$sek</a>
            <div><span class='label label-default'>$kodsek</span> <span class='label label-default'>$statusaliran</span></div>
            </td>
            <td align='center'>

            <div>" . checksekolah($kodsek, $row["statuskhas"]) . "</div>
            </td></tr>";
            $e++;
        }
    }

    echo "</tbody></table></div>";

    print($pagerbottom);

    echo "</div>";
}

if ($_POST['mode'] == "databrowse") {

    $jnsdata = $_POST['jnsdata'];
    $negeri = $_POST['neg'];
    $ppd = $_POST['ppd'];
    $sekolah = $_POST['sek'];

    if ($jnsdata == "tdatajqaf") {

        echo "<div class='table-responsive'><table class=\"table table-hover table-bordered vercell\" width='100%'>";
        echo "<thead><tr>
        <th width=\"2%\">Bil.</th>
        <th>Sekolah</th>
        <th width=\"50%\">Murid</th>
        </tr></thead><tbody>";

        $e = 1;

        $clauses = array();

        if ($negeri != "0") {
            $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE negeri = '$negeri')";
        }

        if ($ppd != "0") {
            $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE ppd = '$ppd')";
        }

        if ($sekolah != "0") {
            $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE id = '$sekolah')";
        }

        $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

        $rqq = "SELECT KODSEK, NAMA FROM tdatajqaf $where ORDER BY NAMA ASC";
        //echo $rqq;

        $resqq = mysqli_query($con, $rqq);

        if (mysqli_num_rows($resqq) == "") {

            echo "<tr><td colspan='11'>";

            amaran("Tiada data yang ditemui. Harap maklum.");

            echo "</td></tr>";
        } else {

            while ($row = mysqli_fetch_array($resqq)) {

                $sekolah = infoFromKod($row["KODSEK"], "ep_sekolah", "nama");
                $nama = $row["NAMA"];

                if ($CURUSER["class"] > 2) {

                    $linki = "details.php?id=$user";
                } else {

                    $linki = "#";
                }

                echo "<tr class='small'><td align='center'>$e</td>";

                echo "
                <td>$sekolah</td>
                <td><a href='$linki'>$nama</a></td>

                </tr>";
                $e++;
            }
        }

        echo "</tbody></table></div></div>";
    }
}

if ($_POST["mode"] == "loadppdgabung") {

    echo "<table class=\"table table-hover table-bordered vercell detatable2\" width='100%'>";
    echo "<thead><tr>
    <th width=\"2%\">Bil.</th>
    <th width='5%'>Tarikh</th>
    <th width=\"2%\">Negeri</th>
    <th width=\"8%\">Daerah</th>
    <th>Sekolah</th>
    <th width=\"2%\">Data</th>
    <th width=\"2%\">Tahun</th>        
    <th width=\"2%\" align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

    $e = 1;

    $user = $CURUSER['id'];
    $class = $CURUSER['class'];
    $negeri = $CURUSER['negeri'];
    $daerah = $CURUSER['ppd'];

    if ($class == "2") {
        $were = "WHERE user = '$user'";
    }

    if ($class == "3") {
        $were = "WHERE daerah = '$daerah' AND sekolah = '0'";
    }

    if ($class == "4") {
        $were = "WHERE negeri = '$negeri' AND daerah != '0' AND sekolah = '0'";
    }

    if ($class >= "5") {

        $were = "WHERE daerah != '0' AND sekolah = '0'";
    }


    $rqq = "SELECT * FROM ep_awan $were ORDER BY tarikh DESC";
    $resqq = mysqli_query($con, $rqq);
    //echo $rqq;

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='11'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri2 = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["daerah"], "nama", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $tarikh = $row["tarikh"];
            $datas = CutName($row["datas"], 15);
            $deta = $row["datas"];
            $tahun = $row["tahun"];
            $kutipan = infoAwan($row["kutipan"], "nama", "ep_kutipan");
            $status = infoAwan($row["status"], "nama", "ep_status");
            $jnsbhn = infoAwan($row["jnsbhn"], "nama", "ep_bahan");
            $user = $row["user"];

            if ($CURUSER["class"] > 2) {

                $linki = "details.php?id=$user";
            } else {

                $linki = "#";
            }

            if ($row["daerah"] == 0 && $row["sekolah"] == 0) {

                $daerah = "<span class='label label-primary'>DATA NEGERI GABUNG</span>";
                $sekolah = "<span class='label label-primary'>DATA NEGERI GABUNG</span>";
                $merge = "class='bg-warning'";
            } elseif ($row["sekolah"] == 0 && $row["daerah"] != 0) {

                $sekolah = "<span class='label label-danger'>DATA PPD GABUNG</span>";
                $merge = "class='bg-info'";
            } else {

                $merge = "";
            }

            if ($row["negeri"] == "14") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kl.png'>";
            } elseif ($row["negeri"] == "1") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/johor.jpg'>";
            } elseif ($row["negeri"] == "2") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kedah.png'>";
            } elseif ($row["negeri"] == "3") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kelantan.png'>";
            } elseif ($row["negeri"] == "4") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/melaka.png'>";
            } elseif ($row["negeri"] == "5") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/nsmbilan.png'>";
            } elseif ($row["negeri"] == "6") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/pahang.png'>";
            } elseif ($row["negeri"] == "7") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/penang.png'>";
            } elseif ($row["negeri"] == "8") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perak.png'>";
            } elseif ($row["negeri"] == "9") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perlis.png'>";
            } elseif ($row["negeri"] == "10") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/selangor.png'>";
            } elseif ($row["negeri"] == "11") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/tganu.png'>";
            } elseif ($row["negeri"] == "12") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sabah.png'>";
            } elseif ($row["negeri"] == "13") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sarawak.png'>";
            } elseif ($row["negeri"] == "15") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/labuan.jpg'>";
            } elseif ($row["negeri"] == "16") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/putrajaya.jpg'>";
            }

            if ($row["jnsbhn"] == "1") {

                $jnsbhn = "<span class='label label-success'>TXT</span>";
            } elseif ($row["jnsbhn"] == "2") {

                $jnsbhn = "<span class='label label-info'>EXC</span>";
            }

            echo "<tr $merge class='small'><td align='center'>$e</td><td align='center'>$tarikh</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "3") {
                $edit = "<a title='Edit' href='awan.php?mode=edit&id=$id'><span class=\"glyphicon glyphicon-edit\" aria-hidden=\"true\"></span></a> 
                <a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='awan.php?mode=pdm&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }

            echo "<td align='center'>$negeri</td>
            <td>$daerah </td>
            <td>$sekolah $jnsbhn</td>
            <td align='center'><a href=download.php?file=$deta><button class='btn btn-success'><span class='glyphicon glyphicon-download-alt'></span></button></a></td>
            <td><span class='label label-info'>$tahun</span>
            <span class='label label-success'>$kutipan</span>
            <span class='label label-danger'>$status</span></td>

            <td align=center>
            $edit             
            </td></tr>";
            $e++;
        }
    }
    echo "</tbody></table>";
}

if ($_POST["mode"] == "loadneggabung") {

    echo "<table class=\"table table-hover table-bordered vercell detatable2\" width='100%'>";
    echo "<thead><tr>
    <th width=\"2%\">Bil.</th>
    <th width='5%'>Tarikh</th>
    <th width=\"2%\">Negeri</th>
    <th width=\"8%\">Daerah</th>
    <th>Sekolah</th>
    <th width=\"2%\">Data</th>
    <th width=\"2%\">Tahun</th>        
    <th width=\"2%\" align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

    $e = 1;

    $user = $CURUSER['id'];
    $class = $CURUSER['class'];
    $negeri = $CURUSER['negeri'];
    $daerah = $CURUSER['ppd'];

    if ($class == "2") {
        $were = "WHERE user = '$user'";
    }

    if ($class == "3") {
        $were = "WHERE daerah = '$daerah'";
    }

    if ($class == "4") {
        $were = "WHERE negeri = '$negeri' AND daerah = '0' AND sekolah = '0'";
    }

    if ($class >= "5") {

        $were = "WHERE daerah = '0' AND sekolah = '0'";
    }


    $rqq = "SELECT * FROM ep_awan $were ORDER BY tarikh DESC";
    $resqq = mysqli_query($con, $rqq);

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='11'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri2 = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["daerah"], "nama", "ep_ppd");
            $sekolah = infoAwan($row["sekolah"], "nama", "ep_sekolah");
            $tarikh = $row["tarikh"];
            $datas = CutName($row["datas"], 15);
            $deta = $row["datas"];
            $tahun = $row["tahun"];
            $kutipan = infoAwan($row["kutipan"], "nama", "ep_kutipan");
            $status = infoAwan($row["status"], "nama", "ep_status");
            $jnsbhn = infoAwan($row["jnsbhn"], "nama", "ep_bahan");
            $user = $row["user"];

            if ($CURUSER["class"] > 2) {

                $linki = "details.php?id=$user";
            } else {

                $linki = "#";
            }

            if ($row["daerah"] == 0 && $row["sekolah"] == 0) {

                $daerah = "<span class='label label-primary'>DATA NEGERI GABUNG</span>";
                $sekolah = "<span class='label label-primary'>DATA NEGERI GABUNG</span>";
                $merge = "class='bg-warning'";
            } elseif ($row["sekolah"] == 0) {

                $sekolah = "<span class='label label-danger'>DATA PPD GABUNG</span>";
                $merge = "class='bg-info'";
            } else {

                $merge = "";
            }

            if ($row["negeri"] == "14") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kl.png'>";
            } elseif ($row["negeri"] == "1") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/johor.jpg'>";
            } elseif ($row["negeri"] == "2") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kedah.png'>";
            } elseif ($row["negeri"] == "3") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/kelantan.png'>";
            } elseif ($row["negeri"] == "4") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/melaka.png'>";
            } elseif ($row["negeri"] == "5") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/nsmbilan.png'>";
            } elseif ($row["negeri"] == "6") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/pahang.png'>";
            } elseif ($row["negeri"] == "7") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/penang.png'>";
            } elseif ($row["negeri"] == "8") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perak.png'>";
            } elseif ($row["negeri"] == "9") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/perlis.png'>";
            } elseif ($row["negeri"] == "10") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/selangor.png'>";
            } elseif ($row["negeri"] == "11") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/tganu.png'>";
            } elseif ($row["negeri"] == "12") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sabah.png'>";
            } elseif ($row["negeri"] == "13") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/sarawak.png'>";
            } elseif ($row["negeri"] == "15") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/labuan.jpg'>";
            } elseif ($row["negeri"] == "16") {

                $negeri = "<img data-toggle='tooltip' title='$negeri2' width='30' src='images/negeri/putrajaya.jpg'>";
            }

            if ($row["jnsbhn"] == "1") {

                $jnsbhn = "<span class='label label-success'>TXT</span>";
            } elseif ($row["jnsbhn"] == "2") {

                $jnsbhn = "<span class='label label-info'>EXC</span>";
            }

            echo "<tr $merge class='small'><td align='center'>$e</td><td align='center'>$tarikh</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "3") {
                $edit = "<a title='Edit' href='awan.php?mode=edit&id=$id'><span class=\"glyphicon glyphicon-edit\" aria-hidden=\"true\"></span></a> 
                <a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='awan.php?mode=pdm&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            }

            echo "<td align='center'>$negeri </td>
            <td>$daerah</td>
            <td>$sekolah $jnsbhn</td>
            <td align='center'><a href=download.php?file=$deta><button class='btn btn-success'><span class='glyphicon glyphicon-download-alt'></span></button></a></td>
            <td><span class='label label-info'>$tahun</span>
            <span class='label label-success'>$kutipan</span>
            <span class='label label-danger'>$status</span></td>

            <td align=center>
            $edit             
            </td></tr>";
            $e++;
        }
    }
    echo "</tbody></table>";
}

if ($_POST['mode'] == "browseju") {

    $negeri = $_POST['neg'];
    $ppd = $_POST['ppd'];
    $bdg = $_POST['bdg'];

    echo "<div class='table-responsive'><table class=\"table table-hover table-condensed table-bordered\" width='100%'>";
    echo "<thead><tr class='small'>
    <th width=\"2%\">Bil.</th>
    <th>Negeri</th>
    <th>Daerah</th>
    <th>Sekolah</th>
    <th>Nama</th> 
    <th>Peringkat</th>        
    <th>Bidang</th>      
    <th width='80' style='text-align:center' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

    $e = 1;

    $clauses = array();

    if ($negeri != "undefined" && $negeri != "0") {
        $clauses[] = "negeri = '$negeri'";
    }

    if ($ppd != "undefined" && $ppd != "0") {
        $clauses[] = "daerah = '$ppd'";
    }

    if ($bdg != "SEMUA") {

        $clauses[] = "bdgtugas = '$bdg'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

    $rqq = "SELECT * FROM ep_ju $where ORDER BY id ASC";
    //echo $rqq;

    $resqq = mysqli_query($con, $rqq);

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='8'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $negeri = infoAwan($row["negeri"], "nama", "ep_negeri");
            $daerah = infoAwan($row["daerah"], "nama", "ep_ppd");
            $sekolah = $row["sekolah"];
            $nama = $row["namapenuh"];
            $peringkat = $row["peringkat"];
            $bidang = $row["bdgtugas"];
            $user = $row["user"];

            echo "<tr class='small'><td>$e</td>";

            if ($row["negeri"] == 0) {

                $negeri = "-";
                $merge = "style='background:url(images/bulang.png) repeat'";
            }

            if ($row["daerah"] == 0) {

                $daerah = "-";
                $merge1 = "style='background:url(images/bulang.png) repeat'";
            }

            if ($row["sekolah"] == "") {

                $sekolah = "-";
                $merge2 = "style='background:url(images/bulang.png) repeat'";
            }

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {

                $edit = "<a href='ju.php?mode=papar&id=$id'><span class='glyphicon glyphicon-eye-open'></span></a> <a title='Edit' href='ju.php?mode=edit&id=$id'><span class=\"glyphicon glyphicon-edit\" aria-hidden=\"true\"></span></a> 
                <a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='ju.php?mode=pdm&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            } else {

                $edit = "<span class='label label-warning'>LIMITED</span>";
            }

            echo "<td align='center'>$negeri</td>
            <td align='center'>$daerah</td>
            <td align='center'>$sekolah</td>
            <td align='center'>$nama</td>
            <td align='center'>$peringkat</td>
            <td align='center'>$bidang</td>
            <td width=50 align=center>
            $edit            
            </td></tr>";
            $e++;
        }

        echo "</tbody></table></div>";
    }
}

if ($_POST['mode'] == "utilpindah") {

    $nokp = $_POST['nokp'];
    $nama = $_POST['nama'];

    echo "<div class='table-responsive' style='height:300px'><table class='table table-hover table-bordered vercell' width='100%'>";
    echo "<thead><tr class='small'>
    <th width='2%'>Bil.</th>
    <th width='30%'>Sekolah</th>
    <th>Nama Murid</th>
    <th style='text-align:center !important'><i class='fa fa-cogs'></i></th></tr></thead><tbody>";

    $e = 1;

    $clauses = array();

    if ($nokp != "") {
        $clauses[] = "KPUTAMA = '$nokp'";
    }

    if ($nama != "") {
        $clauses[] = "NAMA LIKE '%$nama%'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

    $rqq = "SELECT * FROM tdatajqaf $where ORDER BY ID ASC";
    //echo $rqq;

    $resqq = mysqli_query($con, $rqq);

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='7'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["ID"];
            $kodsekolah = $row["KODSEK"];
            $namamurid = $row["NAMA"];
            $nokp = $row["KPUTAMA"];
            $nmsekolah = infoFromKod($kodsekolah, "ep_sekolah");
            $idsekolah = SekToUser(infoFromKod($kodsekolah, "ep_sekolah", "id"), "id");

            echo "<tr class='small'><td align='center'>$e</td>";            

            echo "<td>$nmsekolah ($kodsekolah)</td>
            <td><div style='font-weight:bold'>$namamurid</div> <div>$nokp</div></td>
            <td align='center'><a title='Eksport data murid' href='download.php?mode=exportdatamurid&id=$id'><button class='btn btn-success'>DOWNLOAD</button></a></td>
            </tr>";
            $e++;
        }
    }

    echo "</tbody></table></div>";
}

if ($_POST['mode'] == "utilreq") {

    $kod = $_POST['kod'];
    $nama = $_POST['nama'];

    echo "<table class='table table-hover table-bordered vercell' width='100%'>";
    echo "<thead><tr class='small'>
    <th width='2%'>Bil.</th>
    <th width='5%'>Tarikh</th>       
    <th width='30%'>Sekolah Asal</th>
    <th width='30%'>Nama Murid</th>
    <th>Tindakan</th>
    <th width='80' align='center'><span class='glyphicon glyphicon-tasks'></span></th></tr></thead>";

    $e = 1;

    $clauses = array();

    if ($kod != "") {
        $clauses[] = "kodsekolah = '$kod'";
    }

    if ($nama != "") {
        $clauses[] = "namamurid LIKE '%$nama%'";
    }

    $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';

    $rqq = "SELECT * FROM ep_pindahreq $where ORDER BY id ASC";
    //echo $rqq;

    $resqq = mysqli_query($con, $rqq);

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='7'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $tarikh = $row["tarikh"];
            $kodsekolah = $row["kodsekolah"];
            $namamurid = $row["namamurid"];
            $user = $row["user"];
            $selesai = $row["selesai"];
            $nmsekolah = infoFromKod($kodsekolah, "ep_sekolah");
            $idsekolah = SekToUser(infoFromKod($kodsekolah, "ep_sekolah", "id"), "id");
            $jun = infoUSer($idsekolah, "negeri");
            $jun2 = infoAwan($jun, "nama", "ep_negeri");

            if ($selesai != "0") {

                $status = "<span class='label label-success'>SELESAI</span>";
            } else {

                $status = "<a href=util.php?mode=muridpindah&idreq=$id><button class='btn btn-primary'>UPLOAD</button></a>";
            }

            echo "<tr class='small'><td>$e</td><td>$tarikh</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {
                $edit = "<a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='util.php?mode=pdmreq&id=$id'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></a>";
            } else {
                $edit = "<span class='label label-warning'>LIMITED</span>";
            }

            echo "<td><a href='$linki'>$nmsekolah ($kodsekolah)</a></td>
            <td>$namamurid</td>
            <td align='center' style='font-weight:bold; background-color:indianred; color:white'>JUN " . $jun2 . "</td>
            <td align='center'>$status</td>
            <td width=50 align=center>
            $edit            
            </td></tr>";
            $e++;
        }
    }

    echo "</tbody></table>";
}

if ($_POST['mode'] == "pilihtgs") {

    $tgs = $_POST['tug'];

    if ($tgs == "juk") {

        info("ANDA adalah JU KEBANGSAAN");
    }

    if ($tgs == "jun") {

        echo "<div class='form-group'>

        <label for='negeri'>Negeri:&nbsp;</label>";

        pilih("negeri", "ep_negeri", "", "brwseppd()", "");

        echo "</div>";
    }

    if ($tgs == "jud") {

        echo "<div class='form-group'>

        <label for='negeri'>Negeri:&nbsp;</label>";

        pilih("negeri", "ep_negeri", "", "brwseppd()", "");

        echo "</div>";

        echo "<div class='form-group'>
        <label for='daerah'>Daerah:&nbsp;</label><span id='divvppd'>";

        pilih("ppd", "ep_ppd", "", "brwsesek()", "", "", "");

        echo "</span></div>";
    }
}

if ($_POST['mode'] == "carisekolah") {

    $request = $_POST['query'];

    $query = "SELECT nama FROM ep_sekolah WHERE nama LIKE '%" . $request . "%'";

    $result = mysqli_query($con, $query);

    $data = array();

    if (mysqli_num_rows($result) > 0) {
        while ($row = mysqli_fetch_assoc($result)) {
            $data[] = $row["nama"];
        }
        echo json_encode($data);
    }
}

if ($_POST['mode'] == "carisekk") {

    begin_panel("Carian Sekolah");

    echo "<div style='width:700px'><label>NAMA SEKOLAH</label><div class=\"input-group\"><input type=\"text\" class=\"form-control tobesar\" placeholder='SEKOLAH KEBANGSAAN (1) SELAYANG BARU' id=\"sekolah\" name=\"sekolah\">
    <span class=\"input-group-btn\"><button class=\"btn btn-success\" onclick='carikodsek()' type=\"button\">CARI!</button>
    </span></div>";
    echo "<div style='padding:10px' id='rescarisek'></div></div>";

    end_panel();
}

if ($_POST['mode'] == "checkdulu") {

    $kodsek = $_POST['kodsek'];
    $link = $_POST['pautan'];

    begin_panel("Pengesahan Keselamatan");

    info("Sila jawab soalan di bawah.");

    echo "<div style='width:700px'><label>NAMA GURU BESAR SEKOLAH ANDA:</label><div class=\"input-group\">
    <input type='hidden' id='jawapankodsek' value='$kodsek'>
    <input type=\"text\" class=\"form-control tobesar\" placeholder='Nama Guru Besar seperti dalam data e-Pelaporan' id=\"jawapancheck\" name=\"jawapancheck\">
    <span class=\"input-group-btn\"><button class=\"btn btn-success\" onclick='jawapancheckdulu(\"" . urlencode($link) . "\")' type=\"button\">HANTAR</button>
    </span></div>";
    echo "<div style='padding:10px' id='paparlinkjawapan'></div></div>";

    end_panel();
}

if ($_POST['mode'] == "checkjawapan") {

    $kodsek = $_POST['kodsek'];
    $link = $_POST['link'];
    $jwpn = $_POST['jwpn'];

    $mo = get_row_count("tdatasekolah", "WHERE KODSEK = '$kodsek' AND PGB = '$jwpn'");

    if ($mo > 0) {

        echo "<div class='container-fluid'><div class='row'>
        <div class='col-sm-12'>       
        ";

        jaya("Jawapan anda diterima. Anda DIBERI KEBENARAN untuk MUAT TURUN.");

        echo "<a href='$link'><button class='btn btn-success btn-block btn-lg'>MUAT TURUN</button></a>";

        echo "</div></div></div>";
    } else {

        echo "<div class='container-fluid'><div class='row'>
        <div class='col-sm-12'>       
        ";

        bahaya("Jawapan anda TIDAK diterima. Anda TIDAK MENDAPAT KEBENARAN untuk MUAT TURUN.");

        echo "<a class='btn btn-danger btn-block btn-lg disabled'>MUAT TURUN</a>";

        echo "</div></div></div>";
    }
}

if ($_POST['mode'] == "rescarisek") {

    $sek = $_POST['sk'];

    echo "<table id=\"table\" data-show-header=\"true\" data-pagination=\"true\" data-id-field=\"name\" data-page-list=\"[5, 10, 25, 50, 100, ALL]\" data-page-size=\"5\" class='table table-striped table-hover'>";

    $gk = mysqli_query($con, "SELECT id, nama, kod FROM ep_sekolah WHERE nama LIKE '%" . $sek . "%'");

    while ($gg = mysqli_fetch_array($gk)) {

        $kodsek = $gg["kod"];
        $namasek = $gg["nama"];

        echo "<tr><td>$kodsek</td><td data-field=\"name\">$namasek</td><td width='50'><button onclick='pilihsek(\"$kodsek\")' class='btn btn-primary'>PILIH</button></td></tr>";
    }

    echo "</table>";
}

if ($_POST['mode'] == "rekodtransfer") {

    $id = $_POST['id'];

    $e = 1;

    echo "<table class='table table-striped table-hover' style='width:700px'><thead></thead><tr><th>Bil.</th><th>Log</th><th>Tarikh</th></tr></thead>";

    $jo = mysqli_query($con, "SELECT * FROM ep_log WHERE usertarget = '$id'");
    while ($jj = mysqli_fetch_array($jo)) {

        $msj = $jj["log"];
        $added = $jj["added"];

        echo "<tr><td>$e</td><td>$msj</td><td>$added</td></tr>";
        $e++;
    }

    echo "</table>";
}

if ($_POST['mode'] == "updatesek") {

    sayang("Nama Sekolah", pilihsekolah($sekolah));
}

if ($_POST['mode'] == "editsekolah") {

    $uid = $_POST['uid'];
    $sekolah = $_POST['sekolah'];

    $op = mysqli_query($con, "UPDATE users SET 
        company = '$sekolah'
        WHERE id = '$uid'");

    if ($op) {

        echo "Kemaskini berjaya.";
    } else {

        echo "Kemaskini tidak berjaya (" . mysqli_error($con) . ")";
    }
}

if ($_POST['mode'] == "detailsek") {

    $id = $_POST['id'];

    begin_blok("Detail Data");

    $dt = mysqli_query($con, "SELECT * FROM ep_awan WHERE id = '$id'");
    $dl = mysqli_fetch_assoc($dt);

    $negeri = infoAwan($dl["negeri"], "nama", "ep_negeri");
    $daerah = infoAwan($dl["daerah"], "nama", "ep_ppd");
    $sekolah = infoAwan($dl["sekolah"], "nama", "ep_sekolah");
    $tarikh = $dl["tarikh"];
    $datas = $dl["datas"];
    $tahun = $dl["tahun"];
    $kutipan = infoAwan($dl["kutipan"], "nama", "ep_kutipan");
    $status = infoAwan($dl["status"], "nama", "ep_status");
    $jnsbhn = infoAwan($dl["jnsbhn"], "nama", "ep_bahan");
    $namapenuh = infoAwan($dl["user"], "namapenuh", "users");
    $class = infoAwan($dl["user"], "class", "users");
    $gmbo = infoAwan($dl["user"], "avatar", "users");

    if ($gmbo == "") {

        $gmbr = "photo.jpg";
    } else {

        $gmbr = $gmbo;
    }

    echo "<div class=\"row\" style='width:400px'>
    <div class=\"box box-widget widget-user\">
    <div class=\"widget-user-header bg-primary\">
    <h3 class=\"widget-user-username\">" . $namapenuh . "</h3>
    <h5 class=\"widget-user-desc\">" . klas($class) . "</h5>
    </div>
    <div class=\"widget-user-image\">
    <img class=\"img-circle\" src=\"images/avatars/" . $gmbr . "\" alt=\"User Avatar\">
    </div>   
    </div>
    </div>
    ";

    echo "<table class='table table-bordered' style='margin-top:50px'>";
    echo "<tr><td>Negeri</td><td>$negeri</td></tr>";
    echo "<tr><td>Daerah</td><td>$daerah</td></tr>";
    echo "<tr><td>Sekolah</td><td>$sekolah</td></tr>";
    echo "<tr><td>Tahun Kutipan</td><td>$tahun</td></tr>";
    echo "<tr><td>Kutipan</td><td>$kutipan</td></tr>";
    echo "<tr><td>Status</td><td>$status</td></tr>";
    echo "<tr><td>Jenis Bahan</td><td>$jnsbhn</td></tr>";
    echo "</table>";

    end_blok();
}

/////////

if ($_POST["mode"] == "hntrmsj") {

    $id = sqlesc($_POST['id']);
    $msj = $_POST['msj'];

    mysqli_query($con, "UPDATE users SET info = '$msj' WHERE id = '$id'");

    info($msj);
}

if ($_POST['mode'] == "statdata") {

    function statlapor3($negeri, $kutipan, $tahun)
    {

        $prda = get_row_count("ep_sekolah", "WHERE statuskhas = '-1' AND lapor = '1'");
        $prdax = get_row_count("ep_sekolah", "WHERE statuskhas = '-1' AND lapor != '1'");
        $khas = get_row_count("ep_sekolah", "WHERE statuskhas IN (0,1,2,3) AND laporkhas = '7'");
        $khasx = get_row_count("ep_sekolah", "WHERE statuskhas IN (0,1,2,3) AND laporkhas != '7'");
        $main = $prda + $khas;
        $mainx = $prdax + $khasx;

        echo "<h4>KEBANGSAAN</h4>";
        echo " <ul class=\"list-group\">
        <li class=\"list-group-item list-group-item-info small\">JUM MELAPOR<span class=\"badge\">" . number_format($main) . "</span></li>
        <li class=\"list-group-item list-group-item-info small\">JUM TIDAK MELAPOR<span class=\"badge\">" . number_format($mainx) . "</span></li>

        <li class=\"list-group-item small\">PERDANA MELAPOR<span class=\"badge badge-success\">" . number_format($prda) . "</span></li>
        <li class=\"list-group-item small\">PERDANA TIDAK MELAPOR <span class=\"badge badge-error\">" . number_format($prdax) . "</span></li>
        <li class=\"list-group-item small\">KHAS MELAPOR <span class=\"badge badge-success\">" . number_format($khas) . "</span></li>
        <li class=\"list-group-item small\">KHAS TIDAK MELAPOR <span class=\"badge badge-error\">" . number_format($khasx) . "</span></li>
        </ul> ";
    }

    function statlapor($negeri, $kutipan, $tahun)
    {

        $prda = get_row_count("ep_sekolah", "WHERE statuskhas = '-1' AND negeri = '$negeri' lapor = '1'");
        $prdax = get_row_count("ep_sekolah", "WHERE statuskhas = '-1' AND negeri = '$negeri' lapor != '1'");
        $khas = get_row_count("ep_sekolah", "WHERE statuskhas IN (0,1,2,3) AND negeri = '$negeri' laporkhas = '7'");
        $khasx = get_row_count("ep_sekolah", "WHERE statuskhas IN (0,1,2,3) AND negeri = '$negeri' laporkhas != '7'");
        $main = $prda + $khas;
        $mainx = $prdax + $khasx;

        echo "<h4>" . infoAwan($negeri, "nama", "ep_negeri") . "</h4>";
        echo " <ul class=\"list-group\">
        <li class=\"list-group-item list-group-item-info small\">JUM MELAPOR<span class=\"badge\">$main</span></li>
        <li class=\"list-group-item list-group-item-info small\">JUM TIDAK MELAPOR<span class=\"badge\">$mainx</span></li>

        <li class=\"list-group-item small\">PERDANA MELAPOR<span class=\"badge badge-success\">$prda</span></li>
        <li class=\"list-group-item small\">PERDANA TIDAK MELAPOR <span class=\"badge badge-error\">$prdax</span></li>
        <li class=\"list-group-item small\">KHAS MELAPOR <span class=\"badge badge-success\">$khas</span></li>
        <li class=\"list-group-item small\">KHAS TIDAK MELAPOR <span class=\"badge badge-error\">$khasx</span></li>
        </ul> ";
    }

    function statlapor2($ppd, $kutipan, $tahun)
    {

        $prda = get_row_count("ep_sekolah", "WHERE statuskhas = '-1' AND ppd = '$ppd' lapor = '1'");
        $prdax = get_row_count("ep_sekolah", "WHERE statuskhas = '-1' AND ppd = '$ppd' lapor != '1'");
        $khas = get_row_count("ep_sekolah", "WHERE statuskhas IN (0,1,2,3) AND ppd = '$ppd' laporkhas = '7'");
        $khasx = get_row_count("ep_sekolah", "WHERE statuskhas IN (0,1,2,3) AND ppd = '$ppd' laporkhas != '7'");
        $main = $prda + $khas;
        $mainx = $prdax + $khasx;

        echo "<h4>" . infoAwan($ppd, "nama", "ep_ppd") . "</h4>";
        echo " <ul class=\"list-group\">
        <li class=\"list-group-item list-group-item-info small\">JUM MELAPOR<span class=\"badge\">$main</span></li>
        <li class=\"list-group-item list-group-item-info small\">JUM TIDAK MELAPOR<span class=\"badge\">$mainx</span></li>

        <li class=\"list-group-item small\">PERDANA MELAPOR<span class=\"badge badge-success\">$prda</span></li>
        <li class=\"list-group-item small\">PERDANA TIDAK MELAPOR <span class=\"badge badge-error\">$prdax</span></li>
        <li class=\"list-group-item small\">KHAS MELAPOR <span class=\"badge badge-success\">$khas</span></li>
        <li class=\"list-group-item small\">KHAS TIDAK MELAPOR <span class=\"badge badge-error\">$khasx</span></li>
        </ul> ";
    }

    $neg = $CURUSER['negeri'];
    $ppdd = $CURUSER['ppd'];

    if ($CURUSER["class"] > 4) {

        statlapor3("0", "1", "2018");
    } else {

        statlapor($neg, "1", "2018");

        statlapor2($ppdd, "1", "2018");
    }
}

if ($_POST['mode'] == 'ppdxselesai') {

    info("Maklumat yang berada dalam Badge Merah merupakan data DAERAH yang diupload. Terdapat yang upload PERDANA tanpa KHAS dan sebaliknya.");

    echo "<div style='width:650px'><table class=\"table table-hover table-bordered vercell detatable3\" width='100%'>";
    echo "<thead><tr class='small'>
    <th width=\"1%\">Bil.</th>
    <th width=\"50%\">Daerah</th>
    <th>Negeri</th>
    </tr></thead><tbody>";

    $bil = 1;

    function dataygupload($daerah)
    {

        global $con;

        $po = "";

        $cari = mysqli_query($con, "SELECT * FROM ep_awan WHERE daerah = '$daerah' AND sekolah = '0' AND jnsbhn = '1'");
        while ($nah = mysqli_fetch_array($cari)) {

            $po .= "<span class='badge badge-error' style='font-size:9px'>" . infoAwan($nah["status"], "nama", "ep_status") . " (" . infoAwan($nah["jnsbhn"], "nama", "ep_bahan") . ")</span>&nbsp;";
        }

        return $po;
    }

    $sk = mysqli_query($con, "SELECT * FROM users WHERE class = '3' AND sah = 'TIDAK' ORDER BY negeri ASC");
    while ($se = mysqli_fetch_array($sk)) {

        $negeri = infoAwan($se["negeri"], "nama", "ep_negeri");
        $daerah = infoAwan($se["ppd"], "nama", "ep_ppd");
        $data = dataygupload($se["ppd"]);

        echo "<tr class='small'><td>$bil</td><td>$daerah $data</td><td>$negeri</td></tr>";
        $bil++;
    }

    echo "</tbody></table></div>";
}

if ($_POST['mode'] == 'negxselesai') {

    info("Maklumat yang berada dalam Badge Merah merupakan data NEGERI yang diupload.");

    echo "<div style='width:650px'><table class=\"table table-hover table-bordered vercell detatable3\" width='100%'>";
    echo "<thead><tr class='small'>
    <th width=\"1%\">Bil.</th>
    <th>Negeri</th>
    </tr></thead><tbody>";

    $bil = 1;

    function dataygupload($neg)
    {

        global $con;

        $po = "";

        $cari = mysqli_query($con, "SELECT * FROM ep_awan WHERE negeri = '$neg' AND daerah = '0' AND sekolah = '0' AND jnsbhn = '1'");
        while ($nah = mysqli_fetch_array($cari)) {

            $po .= "<span class='badge badge-error' style='font-size:9px'>" . infoAwan($nah["status"], "nama", "ep_status") . " (" . infoAwan($nah["jnsbhn"], "nama", "ep_bahan") . ")</span>&nbsp;";
        }

        return $po;
    }

    $sk = mysqli_query($con, "SELECT * FROM users WHERE class = '4' AND sah = 'TIDAK' ORDER BY id ASC");
    while ($se = mysqli_fetch_array($sk)) {

        $negeri = infoAwan($se["negeri"], "nama", "ep_negeri");
        $data = dataygupload($se["negeri"]);

        echo "<tr class='small'><td>$bil</td><td>$negeri $data</td></tr>";
        $bil++;
    }

    echo "</tbody></table></div>";
}

if ($_POST['mode'] == "tablesekolah") {

    echo "<table class=\"table table-hover vercell table-bordered detatable2\" width='100%'>";
    echo "<thead><tr>
    <th width=\"2%\">Bil.</th>
    <th width='5%'>Negeri</th> 
    <th>Daerah</th>
    <th>Kod dan Nama</th>
    <th>Stat Aliran</th>
    <th>Lokasi</th>
    <th width='5%'>Pengesahan<br>Sekolah</th>
    <th width='5%'>Pengesahan<br>PPD / JPN</th>
    <th width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

    $e = 1;

    if ($CURUSER["class"] == "3") {

        $ppds = $CURUSER['ppd'];

        $were = "WHERE ppd = '$ppds'";
    } elseif ($CURUSER["class"] == "4") {

        $negeris = $CURUSER['negeri'];

        $were = "WHERE negeri = '$negeris'";
    }

    $rqq = "SELECT * FROM ep_sekolah $were ORDER BY negeri ASC";
    $resqq = mysqli_query($con, $rqq);

    if (mysqli_num_rows($resqq) == "") {

        echo "<tr><td colspan='7'>";

        amaran("Tiada data yang ditemui. Harap maklum.");

        echo "</td></tr>";
    } else {

        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $tarikh = $row["tarikh"];
            $kodsekolah = $row["kod"];
            $nama = $row["nama"];
            $user = $row["user"];
            $jenis = $row["jenis"];
            $lokasi = $row['lokasi'];
            $tarikhsahsek = $row["tarikhsahsek"];
            $tarikhsahppd = $row["tarikhsahppd"];
            $statusaliran = infoAwan($row["statusaliran"], "nama", "ep_statusaliran");
            $selesai = $row["sahsek"];
            $selesai2 = $row["sahppd"];
            $negeri = infoAwan($row["negeri"], "nama", "ep_negeri");
            $ppd = infoAwan($row["ppd"], "nama", "ep_ppd");


            if ($CURUSER["class"] > 2) {

                $linki = "javascript:maksek(\"$id\")";
            } else {

                $linki = "#";
            }

            if ($selesai != "TIDAK") {

                $sahsek = "<img src='images/icons/settle.png'>";
            } else {

                if ($statusaliran == "") {

                    $sahsek = "<button class='btn btn-primary' disabled=\"disabled\">SAHKAN</button>";
                } else {

                    $sahsek = "<a href=sekolah.php?mode=sahsek&id=$id><button class='btn btn-primary'>SAHKAN</button></a>";
                }
            }

            if ($selesai2 != "TIDAK") {

                $sahppd = "<img src='images/icons/settle.png'>";
            } else {

                if ($statusaliran == "") {

                    $sahppd = "<button class='btn btn-primary' disabled=\"disabled\">SAHKAN</button>";
                } else {

                    $sahppd = "<a href=sekolah.php?mode=sahppd&id=$id><button class='btn btn-primary'>SAHKAN</button></a>";
                }
            }

            if ($statusaliran == "") {

                $statusaliran = "<span class='label label-danger'>Sila Kemaskini</span>";
            } else {

                $statusaliran = $statusaliran;
            }

            if ($tarikhsahsek != "0000-00-00") {

                $tarikhsahsek = $tarikhsahsek;
            } else {

                $tarikhsahsek = "";
            }

            if ($tarikhsahppd != "0000-00-00") {

                $tarikhsahppd = $tarikhsahppd;
            } else {

                $tarikhsahppd = "";
            }

            echo "<tr class='small'><td align='center'>$e</td><td align='center'>$negeri</td><td align='center'>$ppd</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {
                $edit = "<a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='util.php?mode=pdmreq&id=$id'><span class='label label-danger'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></span></a>";
            } else {
                $edit = "<span class='label label-warning'>LIMITED</span>";
            }

            echo "<td><a href='$linki'>$nama ($kodsekolah)</a></td>
            <td align='center'>$statusaliran</td>
            <td align='center'>$lokasi</td>
            <td align='center'>$sahsek<br><div class='small'>$tarikhsahsek</div></td>
            <td align='center'>$sahppd<br><div class='small'>$tarikhsahppd</div></td>           
            <td width=50 align=center>
            $edit            
            </td></tr>";
            $e++;
        }
    }
    echo "</tbody></table>";
}

if ($_POST['mode'] == "laporpo") {

    $id = $_POST['id'];

    $laporp = infoSekolah($id, "lapor");
    $lapork = infoSekolah($id, "laporkhas");
    $statusaliran = infoSekolah($id, "statuskhas");

    if ($statusaliran == "-1") {

        $statusaliran = "PERDANA";

        if ($laporp == "0") {

            $laporp = "<img src='images/icons/sign-error.png'>";
            $lapork = "";
        } else {

            $laporp = "<img data-toggle='tooltip' title='" . infoAwan($laporp, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
            $lapork = "";
        }
    } elseif ($statusaliran == "0") {

        $statusaliran = "PERDANA + PPKI";

        if ($laporp == "0") {

            $laporp = "<img src='images/icons/sign-error.png'>";
        } else {

            $laporp = "<img data-toggle='tooltip' title='" . infoAwan($laporp, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
        }

        if ($lapork == "0") {

            $lapork = "<img src='images/icons/sign-error.png'>";
        } else {

            $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
        }
    } elseif ($statusaliran == "1") {

        $statusaliran = "SKPK";

        if ($lapork == "0") {

            $lapork = "<img src='images/icons/sign-error.png'>";
            $laporp = "";
        } else {

            $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
            $laporp = "";
        }
    } elseif ($statusaliran == "2") {

        $statusaliran = "SKPK + SKPK LD";

        if ($lapork == "0") {

            $lapork = "<img src='images/icons/sign-error.png'>";
            $laporp = "";
        } else {

            $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
            $laporp = "";
        }
    } elseif ($statusaliran == "3") {

        $statusaliran = "SKPK LD";

        if ($lapork == "0") {

            $lapork = "<img src='images/icons/sign-error.png'>";
            $laporp = "";
        } else {

            $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
            $laporp = "";
        }
    }

    echo $laporp . " " . $lapork;
}

if ($_POST['mode'] == "maksek") {

    $sekolah = $_POST['id'];

    info("Pastikan maklumat anda tepat!");

    $ok = mysqli_query($con, "SELECT * FROM ep_sekolah WHERE id = $sekolah");
    $oo = mysqli_fetch_assoc($ok);

    $negeri = $oo["negeri"];
    $ppd = $oo["ppd"];
    $namasek = $oo["nama"];
    $notelsek = infoAwan($sekolah, "notel", "ep_sekolah");
    $almtsek = infoAwan($sekolah, "alamat", "ep_sekolah");
    $emelsek = infoAwan($sekolah, "emelsek", "ep_sekolah");
    $kodsek = infoAwan($sekolah, "kod", "ep_sekolah");
    $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");
    $kodjpn = infoAwan($negeri, "kod", "ep_negeri");
    $jnssek = infoAwan($sekolah, "jenis", "ep_sekolah");
    $lokasi = infoAwan($sekolah, "lokasi", "ep_sekolah");
    $lapor = infoAwan($sekolah, "lapor", "ep_sekolah");
    $laporkhas = infoAwan($sekolah, "laporkhas", "ep_sekolah");
    $statusaliran = infoAwan($sekolah, "statuskhas", "ep_sekolah");
    $beredar = infoSekolah($sekolah, "guruberedar");
    $pilihbahasa = infoKodSekolahT($kodsek,"TAWARB1");
    $bahasa = infoSekolah($sekolah,"bahasa");

    if ($CURUSER["class"] > 5) {
        $disable = "";
    } else {
        $disable = "disabled";
    }

    echo "<div class='row' style='width:800px'>";

    echo "<div class='col-md-6'>";

    begin_block("Maklumat Asas Sekolah");

?>
<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="kodjab">Kod Jabatan</label>
            <input type="text" class="form-control" id="kodjab" value='<?= $kodjpn ?>' placeholder="Kod Jabatan">
        </div>
    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="kodppd">Kod PPD</label>
            <input type="text" class="form-control" id="kodppd" value='<?= $kodppd ?>' placeholder="Kod PPD">
        </div>
    </div>
</div>

<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="negeri">Negeri</label>
            <? pilih("negeriz", "ep_negeri", $negeri, "updateppd2()") ?>
        </div>
    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="ppd">PPD</label>
            <div id="divppdz">
                <? pilih("ppdz", "ep_ppd", $ppd, "updetsek()", "", "WHERE negeri = '$negeri'") ?>
            </div>
        </div>
    </div>
</div>

<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="kodsek">Kod Sekolah</label>
            <input type="text" class="form-control" id="kodsek" value='<?= $kodsek ?>' placeholder="Kod Sekolah">
        </div>
    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="jnssek">Jenis Sekolah</label>
            <? pilihwei("jnssekk", "ep_jenissek", $jnssek, "") ?>
        </div>
    </div>
</div>

<div class="form-group">
    <label for="sekolah">Sekolah</label>
    <input type="text" id='nmsekolah' class='form-control' size="40" value="<?= $namasek ?>" <?= $disable ?>>
</div>

<div class="form-group">
    <label for="lokasi">Lokasi Sekolah</label>
    <? pilih("lokasi", "ep_lokasi", $lokasi, "") ?>
</div>

<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="lokasi">Status Aliran</label>
            <? pilihwei("statusaliranz", "ep_statusaliran", $statusaliran) ?>
        </div>
    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="guruberedar">Guru Beredar</label>
            <div><label class="radio-inline">
                    <input type="radio" name="guruberedar" id="guruberedar" value="ya"
                        <?php echo ($beredar == 'ya') ? "checked" : ""; ?>> Ada
                </label>
                <label class="radio-inline">
                    <input type="radio" name="guruberedar" id="guruberedar" value="tidak"
                        <?php echo ($beredar == 'tidak') ? "checked" : ""; ?>> Tiada
                </label>
            </div>
        </div>
    </div>
</div>



<?

input0("Pilihan Bahasa","pilihbahasa",pilihep("pilihbahasa","ep_bahasas","$bahasa","","bahasa"));

    end_block();

    echo "</div><div class='col-md-6'>";

    begin_block("Maklumat Enrolmen");

    if ($statusaliran == '-1') {

        $perdana = "AND STATUSMURID IN (3,4,5,6,7,8,31)";
        $murid = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek' $perdana");
    } elseif ($statusaliran == '0') {

        $perdana = "AND STATUSMURID IN (3,4,5,6,7,8,31)";
        $woro = "AND STATUSMURID IN (32,36,37,38,40)";
        $murid = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek' $perdana");
        $muridk = " / " . get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek' $woro");
    } elseif ($statusaliran == '1') {

        $woro = "AND STATUSMURID IN (33,34,35,40)";
        $muridk = "" . get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek' $woro");
    } elseif ($statusaliran == '2') {

        $woro = "AND STATUSMURID IN (33,34,35,40)";
        $muridk = "" . get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek' $woro");
    }

    //$enr = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek'");
    $gur = get_row_count("tdataguru", "WHERE KODSEK = '$kodsek'");
    //$kcj = get_row_count("tdatajqaf_kcj", "WHERE KODSEK = '$kodsek'");
    //$kcjy = get_row_count("tdatajqaf_kcj", "WHERE KODSEK = '$kodsek' AND (UDA+UDB+UDC) > '59'");
    //$kcjyl = get_row_count("tdatajqaf_kcj", "WHERE KODSEK = '$kodsek' AND KODJANTINA = 'L' AND (UDA+UDB+UDC) > '59'");
    //$kcjyp = get_row_count("tdatajqaf_kcj", "WHERE KODSEK = '$kodsek' AND KODJANTINA = 'P' AND (UDA+UDB+UDC) > '59'");


    echo "<label>Enrolmen Murid</label>";
    echo "<div style='background-color:#FFFFC0; font-size:20px; padding:10px'>" . number_format($murid) . "$muridk</div>";

    end_block();

    begin_block("Maklumat Pelaporan");

    info("Sila pilih status melapor sekolah.");

    if ($statusaliran == "-1") {
    ?>

<div class="form-group">
    <label for="melapor">Status Melapor PERDANA</label>
    <? pilihlapor("melaporp", "ep_pelaporan", $lapor, "WHERE aliran = 'PERDANA'") ?>
</div>
<input type="hidden" id='melapork' value='0'>
<?

    } elseif ($statusaliran == "0") {

    ?>

<div class="form-group">
    <label for="melapor">Status Melapor PERDANA</label>
    <? pilihlapor("melaporp", "ep_pelaporan", $lapor, "WHERE aliran = 'PERDANA'") ?>
</div>

<div class="form-group">
    <label for="melapor">Status Melapor KHAS</label>
    <? pilihlapor("melapork", "ep_pelaporan", $laporkhas, "WHERE aliran = 'KHAS'") ?>
</div>

<?

    } else {

    ?>

<div class="form-group">
    <label for="melapor">Status Melapor KHAS</label>
    <? pilihlapor("melapork", "ep_pelaporan", $laporkhas, "WHERE aliran = 'KHAS'") ?>
</div>

<input type="hidden" id='melaporp' value='0'>

<?

    }

    end_block();

    echo "<div class='text-center'>
    <button type='button' onclick='editSek(\"$sekolah\")' class='btn btn-primary'>MAKLUMAT DISAHKAN BETUL</button></div>";

    echo "</div>";

    ?>

<?

    echo "</div>";
}

if ($_POST['mode'] == "maksekt") {

    $sekolah = $_POST['id'];

    info("Pastikan maklumat anda tepat!");

    $ok = mysqli_query($con, "SELECT * FROM tdatasekolah WHERE KODSEK = '$sekolah'");
    $oo = mysqli_fetch_assoc($ok);

    $negeri = $oo["NEGERI"];
    $idneg = NEGkodtiID($negeri);
    $ppd = $oo["PPD"];
    $idppd = PPDkodtiID($ppd);
    $namasek = $oo["SEKOLAH"];

    $kodsek = $oo["KODSEK"];
    $kodppd = $oo["PPD"];
    $kodjpn = $oo["NEGERI"];
    $jnssek = $oo['JENISSEK'];
    $lokasi = $oo['KodLokasiPendaftaran'];
    $lapor = $oo['STALAPORDATA'];
    $statusaliran = $oo['STATUSKHAS'];

    echo "<div class='row' style='width:800px'>";

    echo "<div class='col-md-6'>";

    begin_block("Maklumat Asas Sekolah");

?>

<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="kodjab">Kod Jabatan</label>
            <input type="text" class="form-control" id="kodjab" value='<?= $kodjpn ?>' placeholder="Kod Jabatan"
                disabled>
        </div>
    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="kodppd">Kod PPD</label>
            <input type="text" class="form-control" id="kodppd" value='<?= $kodppd ?>' placeholder="Kod PPD" disabled>
        </div>
    </div>
</div>

<div class="form-group">
    <label for="negeri">Negeri</label>
    <? pilih("negeriz", "ep_negeri", $idneg, "updateppd2()", "disabled") ?>
</div>

<div class="form-group">
    <label for="ppd">PPD</label>
    <div id="divppdz">
        <? pilih("ppdz", "ep_ppd", $idppd, "updetsek()", "", "WHERE negeri = '$negeri'") ?>
    </div>
</div>


<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="kodsek">Kod Sekolah</label>
            <input type="text" class="form-control" id="kodsek" value='<?= $kodsek ?>' placeholder="Kod Sekolah"
                disabled>
        </div>
    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="jnssek">Jenis Sekolah</label>
            <? pilihwei("jnssekk", "ep_jenissek", $jnssek, "") ?>
        </div>
    </div>
</div>

<div class="form-group">
    <label for="sekolah">Sekolah</label>
    <input type="text" id='nmsekolah' class='form-control' size="40" value="<?= $namasek ?>" disabled>
</div>

<div class='row'>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="lokasi">Lokasi Sekolah</label>
            <? pilih("lokasi", "ep_lokasi", $lokasi, "") ?>
        </div>

    </div>
    <div class='col-md-6'>
        <div class="form-group">
            <label for="lokasi">Status Aliran</label>
            <? pilihwei("statusaliranz", "ep_statusaliran", $statusaliran) ?>
        </div>
    </div>
</div>
<?

    end_block();

    echo "</div><div class='col-md-6'>";

    begin_block("Maklumat Enrolmen");

    $enr = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek'");
    $gur = get_row_count("tdataguru", "WHERE KODSEK = '$kodsek'");

    echo "<label>Enrolmen Murid</label>";
    echo "<div style='background-color:#FFFFC0; font-size:20px; padding:10px'>" . number_format($enr) . "</div>";

    echo "<label>Bilangan Guru</label>";
    echo "<div style='background-color:#80FF80; font-size:20px; padding:10px'>" . number_format($gur) . "</div>";

    end_block();

    begin_block("Maklumat Pelaporan");

    $optlapor = array(
        "-1" => "--Sila Pilih--",
        "0" => "DILAPORKAN DENGAN LENGKAP",
        "1" => "TIADA ENROLMEN MURID ISLAM",
        "2" => "TIADA GURU PENDIDIKAN ISLAM",
        "3" => "TIDAK DILAPORKAN TANPA SEBAB / LAIN-LAIN SEBAB",
        "4" => "TIDAK DILAPORKAN KESELURUHAN (MURID ISLAM PENDIDIKAN KHAS TIDAK BOLEH DINILAI)",
        "5" => "UJIAN DIAGNOSTIK / KCJ"
    );

    echo select_menu("melapori", $optlapor, $lapor, "");

    end_block();

    echo "</div>";

    ?>

<div align="center">
    <button type="submit" onclick="editSek2()" class="btn btn-primary">MAKLUMAT DISAHKAN BETUL</button>
</div>

<?

    echo "</div>";
}

if ($_POST['mode'] == "makppd") {

    $id = $_POST['id'];

    $jp = mysqli_query($con, "SELECT * FROM ep_ppd WHERE id = '$id'");
    $jo = mysqli_fetch_assoc($jp);

    $nama = $jo["nama"];
    $kod = $jo["kodppd"];
    $negeri = $jo["negeri"];

    echo "<form method=\"POST\" enctype=\"multipart/form-data\" action=\"ppd.php\">";

    echo "<div class='row'>";

    echo "<div class='col-md-12'>";

    begin_block("Maklumat Asas PPD");

?>

<div class="form-group">
    <label for="negeri">Negeri</label>
    <? pilih("negeri", "ep_negeri", $negeri, "updateppd()") ?>
</div>

<div class="form-group">
    <label for="kodsek">Kod PPD</label>
    <input type="text" class="form-control" name="kod" value='<?= $kod ?>' placeholder="Kod Sekolah">
</div>

<div class="form-group">
    <label for="sekolah">Nama PPD</label>
    <input type="text" name='nama' class='form-control' size="40" value="<?= $nama ?>">
</div>

<?

    end_block();

    echo "</div>";

    ?>

<div align="center">
    <button type="submit" name='editppd' onclick='editppd("<?= $id ?>")' class="btn btn-primary">Simpan</button>
</div>

<?

    echo "</div>";

    echo "</form>";
}

if ($_POST['mode'] == "editsek") {

    $id = $_POST['id'];
    $negeri = $_POST['negeri'];
    $ppd = $_POST['ppd'];
    $sek = mysqli_real_escape_string($con, $_POST['sek']);
    $kodsek = infoSekolah($id,"kod");
    $jnssek = $_POST['jnssek'];
    $lokasi = $_POST['lokasi'];
    $stata = $_POST['stata'];
    $notelsek = $_POST['notelsek'];
    $emelsek = mysqli_real_escape_string($con, $_POST['emelsek']);
    $almt = mysqli_real_escape_string($con, $_POST['almt']);
    $beredar = $_POST['beredar'];
    $bahasa = $_POST['bahasa'];

    if ($stata == "-1") {

        $lapork = "0";
    } else {

        $lapork = $_POST['lapork'];
    }

    if ($stata == "1" || $stata == "2" || $stata == "3") {

        $laporp = "0";
    } else {

        $laporp = $_POST['laporp'];
    }

    $op = mysqli_query($con, "UPDATE ep_sekolah SET negeri = '$negeri', ppd = '$ppd', jenis = '$jnssek', nama = '$sek', statuskhas = '$stata', lokasi = '$lokasi', lapor = '$laporp', laporkhas = '$lapork', guruberedar = '$beredar', bahasa = '$bahasa' WHERE id = '$id'");
    mysqli_query($con,"UPDATE tdatasekolah SET TAWARB1 = '$bahasa' WHERE KODSEK = '$kodsek'");

    if ($op) {

        echo "Kemaskini berjaya.";

        write_log("" . $CURUSER['namapenuh'] . " telah mengemaskini maklumat sekolah $sek.");
    } else {

        echo "Kemaskini tidak berjaya (" . mysqli_error($con) . ")";
    }
}

if ($_POST['mode'] == "editsek2") {

    $ppd = $_POST['ppd'];
    $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");
    $jnssek = $_POST['jnssek'];
    $lokasi = $_POST['lokasi'];
    $stata = $_POST['stata'];
    $kodsek = $_POST['kodsek'];
    $lapor = $_POST['lapor'];

    $op = mysqli_query($con, "UPDATE tdatasekolah SET PPD = '$kodppd', JENISSEK = '$jnssek', STATUSKHAS = '$stata', KodLokasiPendaftaran = '$lokasi', STALAPORDATA = '$lapor' WHERE KODSEK = '$kodsek'");

    if ($op) {

        echo "Kemaskini berjaya.";

        write_log("" . $CURUSER['namapenuh'] . " telah mengemaskini maklumat sekolah $sek.");
    } else {

        echo "Kemaskini tidak berjaya (" . mysqli_error($con) . ")";
    }
}

if ($_POST['mode'] == "editppd") {

    $id = $_POST['id'];
    $negeri = $_POST['negeri'];
    $nama = mysqli_real_escape_string($con, $_POST['nama']);
    $kod = mysqli_real_escape_string($con, $_POST['kod']);

    $op = mysqli_query($con, "UPDATE ep_ppd SET negeri = '$negeri', nama = '$nama', kodppd = '$kod' WHERE id = '$id'");

    if ($op) {

        echo "Kemaskini berjaya.";

        write_log("" . $CURUSER['namapenuh'] . " telah mengemaskini maklumat PPD $nama.");
    } else {

        echo "Kemaskini tidak berjaya (" . mysqli_error($con) . ")";
    }
}

if ($_GET['modo'] == "cariseko") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $nmsek = $_GET['nma'];
    $aliran = $_GET['alir'];
    $jns = $_GET['jns'];
    $lapor = $_GET['lapor'];

    browsesek("ajax/op.php?neg=$negeri&ppd=$ppd&nma=$nmsek&alir=$aliran&jns=$jns&lapor=$lapor", "cariseko", "");
}

if ($_GET['modo'] == "carianalisa") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $nmsek = $_GET['nma'];
    $aliran = $_GET['alir'];
    $jns = $_GET['jns'];
    $deta = $_GET['deta'];

    browseanalisa("ajax/op.php?neg=$negeri&ppd=$ppd&nma=$nmsek&alir=$aliran&jns=$jns&deta=$deta", "carianalisa", "");
}

if ($_GET['modo'] == "carisekok") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $nmsek = $_GET['nma'];
    $aliran = $_GET['alir'];
    $jns = $_GET['jns'];
    $lapor = $_GET['lapor'];

    browsesek2("ajax/op.php?neg=$negeri&ppd=$ppd&nma=$nmsek&alir=$aliran&jns=$jns&lapor=$lapor", "carisekok", "");
}

if ($_POST['mode'] == "pdmmurid") {

    $id = mysqli_real_escape_string($con, $_POST['id']);

    $tr = mysqli_query($con, "DELETE FROM tdatajqaf WHERE ID = '$id'");

    if ($tr) {

        echo "Data telah dipadam.";
    } else {

        echo "Ada masalah.";
    }
}

if ($_POST['mode'] == "pdmguru") {

    $nokp = $_POST['nokp'];
    $kodsek = $_POST['kodsek'];

    $tr = mysqli_query($con, "DELETE FROM tdataguru WHERE KPUTAMA = '$nokp' AND KODSEK = '$kodsek'");

    if ($tr) {

        echo "Data telah dipadam.";
    } else {

        echo "Ada masalah.";
    }
}

if ($_GET['modo'] == "kptembung") {

    kptembung("ajax/op.php", "kptembung", "");
}

if ($_GET['modo'] == "kptembungguru") {

    kptembungguru("ajax/op.php", "kptembungguru", "");
}

if ($_GET['modo'] == "nmtembung") {

    nmtembung("ajax/op.php", "nmtembung", "");
}

if ($_GET['modo'] == "datatembung") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $sekolah = $_GET['sek'];

    kptembungvar("ajax/op.php?neg=$negeri&ppd=$ppd&sek=$sekolah", "datatembung");
}

if ($_GET["modo"] == "loadbrowsey") {

    loadbrowsey("ajax/op.php", "loadbrowsey", "");
}

if ($_GET["modo"] == "loadjud") {

    loadjud("ajax/op.php", "loadjud", "");
}

if ($_GET['modo'] == "carippd") {

    $negeri = $_GET['neg'];
    $nmppd = $_GET['nma'];

    browseppd("ajax/op.php?neg=$negeri&nma=$nmppd", "carippd", "");
}

if ($_GET['modo'] == "carisekt") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $nmsek = $_GET['nma'];
    $aliran = $_GET['alir'];

    echo "<div id=\"ajaxPage\">";

    $e = 1;

    if ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['ppd'];
        $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");

        $were = "WHERE PPD = '$kodppd'";
    } elseif ($CURUSER["class"] == "4") {

        $negeri = $CURUSER['negeri'];
        $kodnegg = infoAwan($neg, "kod", "ep_negeri");
        $kodneg = sprintf("%02d", $kodnegg);

        $were = "WHERE NEGERI = '$kodneg'";
    } else {

        $were = "";
    }

    $res2 = mysqli_query($con, "SELECT COUNT(*) FROM tdatasekolah $were");
    $row = mysqli_fetch_array($res2);
    $count = $row[0];
    $perpage = 10;
    list($pagertop, $pagerbottom, $limit) = ajax_pager($perpage, $count, "ajax/op.php?neg=$negeri&ppd=$ppd", "carisekt");
    if ($count == 0) {
        echo "<p class=\"information\">Tiada data pelajar.</p>";
    } else {

        $e = 1;

        $page = $_GET['page'];

        if ($page > 0) {

            $e = 10 * $page + 1;
        }

        echo "<table class=\"table table-hover vercell table-bordered\">";
        echo "<thead><tr>
        <th width=\"2%\">Bil.</th>
        <th width='5%'>Negeri</th> 
        <th>Daerah</th>
        <th>Kod dan Nama</th>
        <th>Status Aliran</th>
        <th width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

        $rqq = "SELECT * FROM tdatasekolah $were ORDER BY NEGERI ASC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            //$id = $row["id"];
            $kodsekolah = $row["KODSEK"];
            $nama = $row["SEKOLAH"];
            $jenis = $row["JENISSEK"];
            $statusaliran = $row["STATUSKHAS"];
            $negeri = infoAwan(NEGkodtiID($row["NEGERI"]), "nama", "ep_negeri");
            $ppd = infoAwan(PPDkodtiID($row["PPD"]), "nama", "ep_ppd");

            if ($CURUSER["class"] > 2) {

                $linki = "javascript:maksekt(\"$kodsekolah\")";
            } else {

                $linki = "#";
            }

            if ($statusaliran == "-1") {

                $statusaliran = "PERDANA";
            } elseif ($statusaliran == "0") {

                $statusaliran = "PERDANA + PPKI";
            } elseif ($statusaliran == "1") {

                $statusaliran = "SKPK";
            } elseif ($statusaliran == "2") {

                $statusaliran = "SKPK + SKPK LD";
            } elseif ($statusaliran == "3") {

                $statusaliran = "SKPK LD";
            }

            echo "<tr class='small'><td align='center'>$e</td><td align='center'>$negeri</td><td align='center'>$ppd</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {
                $edit = "<a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='sekolah.php?mode=pdmsek&id=$id'><span class='label label-danger'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></span></a>";
            } else {
                $edit = "<span class='label label-warning'>LIMITED</span>";
            }

            echo "<td><a href='$linki'>$nama ($kodsekolah)</a> <div>" . checksekolah($kodsekolah) . "</div></td>
            <td align='center'>$statusaliran</td>                
            <td width=50 align=center>
            $edit            
            </td></tr>";
            $e++;
        }

        echo "</tbody></table>";
    }

    print($pagerbottom);

    echo "</div>";
}

if ($_GET['modo'] == "carisekk") {

    echo "<div id=\"ajaxPage\">";

    $e = 1;

    if ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['ppd'];
        $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");

        $were = "WHERE ppd = '$ppd'";
    } elseif ($CURUSER["class"] == "4") {

        $negeri = $CURUSER['negeri'];
        $kodnegg = infoAwan($neg, "kod", "ep_negeri");
        $kodneg = sprintf("%02d", $kodnegg);

        $were = "WHERE negeri = '$negeri'";
    } else {

        $were = "";
    }

    $res2 = mysqli_query($con, "SELECT COUNT(*) FROM ep_sekolah $were");
    $row = mysqli_fetch_array($res2);
    $count = $row[0];
    $perpage = 10;
    list($pagertop, $pagerbottom, $limit) = ajax_pager($perpage, $count, "ajax/op.php?neg=$negeri&ppd=$ppd", "carisekk");
    if ($count == 0) {
        echo "<p class=\"information\">Tiada data pelajar.</p>";
    } else {

        $e = 1;

        $page = $_GET['page'];

        if ($page > 0) {

            $e = 10 * $page + 1;
        }

        echo "<table class=\"table table-hover vercell table-bordered\">";
        echo "<thead><tr>
        <th width=\"2%\">Bil.</th>
        <th width='5%'>Negeri</th> 
        <th>Daerah</th>
        <th>Kod dan Nama</th>
        <th>Status Aliran</th>
        <th>Status Pengesahan</th>
        <th width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

        $rqq = "SELECT * FROM ep_sekolah $were ORDER BY id ASC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $kodsekolah = $row["kod"];
            $nama = $row["nama"];
            $jenis = $row["jenis"];
            $statusaliran = $row["statuskhas"];
            $negeri = infoAwan($row["negeri"], "nama", "ep_negeri");
            $ppd = infoAwan($row["ppd"], "nama", "ep_ppd");
            $laporp = $row["lapor"];
            $lapork = $row["laporkhas"];

            $enr = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsekolah'");
            $gur = get_row_count("tdataguru", "WHERE KODSEK = '$kodsekolah'");

            if ($CURUSER["class"] > 2) {

                $linki = "javascript:maksek(\"$id\")";
            } else {

                $linki = "#";
            }

            if ($selesai != "TIDAK") {

                $sahsek = "<img src='images/icons/settle.png'>";
            } else {

                if ($statusaliran == "") {

                    $sahsek = "<button class='btn btn-primary' disabled=\"disabled\">SAHKAN</button>";
                } else {

                    $sahsek = "<a href=sekolah.php?mode=sahsek&id=$id><button class='btn btn-primary'>SAHKAN</button></a>";
                }
            }

            if ($selesai2 != "TIDAK") {

                $sahppd = "<img src='images/icons/settle.png'>";
            } else {

                if ($statusaliran == "") {

                    $sahppd = "<button class='btn btn-primary' disabled=\"disabled\">SAHKAN</button>";
                } else {

                    $sahppd = "<a href=sekolah.php?mode=sahppd&id=$id><button class='btn btn-primary'>SAHKAN</button></a>";
                }
            }

            if ($laporp == "1") {

                $star = "<span><img src='images/icons/star.png'></span>";
            } else {

                $star = "";
            }

            if ($lapork == "7") {

                $star2 = "<span><img src='images/icons/star.png'></span>";
            } else {

                $star2 = "";
            }

            if ($statusaliran == "-1") {

                $statusaliran = "PERDANA";

                if ($laporp == "0") {

                    $laporp = "<img src='images/icons/xsettle.png'>";
                    $lapork = "";
                } else {

                    $laporp = "<img data-toggle='tooltip' title='" . infoAwan($laporp, "nama", "ep_pelaporan") . "' src='images/icons/settle.png'>";
                    $lapork = "";
                }
            } elseif ($statusaliran == "0") {

                $statusaliran = "PERDANA + PPKI";

                if ($laporp == "0") {

                    $laporp = "<img src='images/icons/xsettle.png'>";
                } else {

                    $laporp = "<img data-toggle='tooltip' title='" . infoAwan($laporp, "nama", "ep_pelaporan") . "' src='images/icons/settle.png'>";
                }

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/xsettle.png'>";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/settle.png'>";
                }
            } elseif ($statusaliran == "1") {

                $statusaliran = "SKPK";

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/xsettle.png'>";
                    $laporp = "";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/settle.png'>";
                    $laporp = "";
                }
            } elseif ($statusaliran == "2") {

                $statusaliran = "SKPK + SKPK LD";

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/xsettle.png'>";
                    $laporp = "";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/settle.png'>";
                    $laporp = "";
                }
            } elseif ($statusaliran == "3") {

                $statusaliran = "SKPK LD";

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/xsettle.png'>";
                    $laporp = "";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/settle.png'>";
                    $laporp = "";
                }
            }

            echo "<tr class='small'><td align='center'>$e</td><td align='center'>$negeri</td><td align='center'>$ppd</td>";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {
                $edit = "<a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='sekolah.php?mode=pdmsek&id=$id'><span class='label label-danger'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></span></a>";
            } else {
                $edit = "<span class='label label-warning'>LIMITED</span>";
            }

            echo "<td><a href='$linki'>$nama ($kodsekolah)</a> <div>" . checksekolah($kodsekolah) . "</div></td>
            <td width='50' align='center'><div><span class='label label-primary'>$enr</span></div><br><div><span class='label label-danger'>$gur</span></div></td>
            <td align='center'>$statusaliran</td>
            <td width='100' align='center'>$laporp 
            $lapork<div>$star $star2</div></td>
            <td width=30 align=center>
            $edit            
            </td></tr>";
            $e++;
        }

        echo "</tbody></table>";
    }

    print($pagerbottom);

    echo "</div>";
}

if ($_GET['modo'] == "carippdd") {

    echo "<div id=\"ajaxPage\">";

    $e = 1;

    if ($CURUSER["class"] == "4") {

        $negeri = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $kodnegg);

        $were = "WHERE negeri = '$negeri'";
    } else {

        $were = "";
    }

    $res2 = mysqli_query($con, "SELECT COUNT(*) FROM ep_ppd $were");
    $row = mysqli_fetch_array($res2);
    $count = $row[0];
    $perpage = 10;
    list($pagertop, $pagerbottom, $limit) = ajax_pager($perpage, $count, "ajax/op.php?neg=$negeri", "carippdd");
    if ($count == 0) {
        echo "<p class=\"information\">Tiada data PPD.</p>";
    } else {

        $e = 1;

        $page = $_GET['page'];

        if ($page > 0) {

            $e = 10 * $page + 1;
        }

        echo "<table class=\"table table-hover vercell table-bordered\">";
        echo "<thead><tr>
        <th width=\"2%\">Bil.</th>
        <th width='40%'>Negeri</th> 
        <th>Daerah</th>
        <th width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";

        $rqq = "SELECT * FROM ep_ppd $were ORDER BY id DESC $limit";
        $resqq = mysqli_query($con, $rqq);
        while ($row = mysqli_fetch_array($resqq)) {

            $id = $row["id"];
            $kodppd = $row["kodppd"];
            $nama = $row["nama"];
            $negeri = infoAwan($row["negeri"], "nama", "ep_negeri");

            if ($CURUSER["class"] > 2) {

                $linki = "javascript:makppd(\"$id\")";
            } else {

                $linki = "#";
            }

            echo "<tr><td align='center'>$e</td>
            <td align='left'>$negeri</td>
            ";

            if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {
                $edit = "<a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='ppd.php?mode=pdmppd&id=$id'><span class='label label-danger'><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span></span></a>";
            } else {
                $edit = "<span class='label label-warning'>LIMITED</span>";
            }

            echo "<td><a href='$linki'>$nama ($kodppd)</a></td>
            <td width=50 align=center>
            $edit            
            </td></tr>";
            $e++;
        }

        echo "</tbody></table>";
    }

    print($pagerbottom);

    echo "</div>";
}

if ($_POST['mode'] == "papartembung") {

    $nokp = $_POST['nokp'];

    begin_block("Paparan Maklumat KP Tembung");

    $bil = 1;

    bahaya("Sila padam murid yang tidak berkenaan.");

    echo "<div class='container'><table class='table table-striped table-hover'>";
    echo "<tr><td>Bil.</td><td>MyKad</td><td>Nama</td><td>Sekolah</td>
    <td>Update Khatam</td>
    <td>Update Tasmik</td>
    <td>Update Arab</td>
    <td>Update Jawi</td>
    <td>Update Wuduk</td>
    <td width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></td></tr>";

    $jo = mysqli_query($con, "SELECT NAMA, KODSEK, ID, KPUTAMA, UpdateKhatam, UpdateTasmik, UpdateArab, UpdateJawi, UpdateWudhuk FROM tdatajqaf WHERE KPUTAMA = '$nokp' ORDER BY KPUTAMA ASC");
    while ($ju = mysqli_fetch_array($jo)) {

        $nama = $ju["NAMA"];
        $nokp = $ju["KPUTAMA"];
        $sekolah = infoKodSekolah($ju["KODSEK"]);
        $kodsek = $ju["KODSEK"];
        $id = $ju["ID"];
        $upkhatam = $ju["UpdateKhatam"];
        $uptasmik = $ju["UpdateTasmik"];
        $uparab = $ju["UpdateArab"];
        $upjawi = $ju["UpdateJawi"];
        $upwudu = $ju["UpdateWudhuk"];

        if ($CURUSER["username"] == $ju["KODSEK"] || $CURUSER["class"] >= "3") {
            $edit = "<a href='javascript:pdmmurid(\"$id\")'><span style='color:red'><i class='fas fa-trash-alt'></i></span></a>";
            $linkk = "murid.php?mode=editmurid&id=$id";
        } else {
            $edit = "<span class='label label-warning'>LIMITED</span>";
            $linkk = "#";
        }

        echo "<tr><td>$bil</td><td>$nokp</td><td><a target='_blank' href='$linkk'>$nama</a></td><td>$sekolah ($kodsek)</td>
        <td>$upkhatam</td>
        <td>$uptasmik</td>
        <td>$uparab</td>
        <td>$upjawi</td>
        <td>$upwudu</td>
        <td align='center'>$edit</td></tr>";
        $bil++;
    }

    echo "</table></div>";

    end_block();
}

if ($_POST['mode'] == "papartembungguru") {

    $nokp = $_POST['nokp'];

    begin_block("Paparan Maklumat Guru KP Tembung");

    $bil = 1;

    bahaya("Sila padam data yang tidak berkenaan.");

    echo "<div class='container'><table class='table table-striped table-hover'>";
    echo "<tr><td>Bil.</td><td>MyKad</td><td>Nama</td><td>Sekolah</td>
    <td>Update Data</td>     
    <td width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></td></tr>";

    $jo = mysqli_query($con, "SELECT NAMA, KODSEK, KPUTAMA, UpdateData FROM tdataguru WHERE KPUTAMA = '$nokp' ORDER BY KPUTAMA ASC");
    while ($ju = mysqli_fetch_array($jo)) {

        $nama = $ju["NAMA"];
        $nokp = $ju["KPUTAMA"];
        $sekolah = infoKodSekolah($ju["KODSEK"]);
        $kodsek = $ju["KODSEK"];
        $id = $ju["ID"];
        $updata = $ju["UpdateData"];

        if ($CURUSER["username"] == $ju["KODSEK"] || $CURUSER["class"] >= "4") {
            $edit = "<a href='javascript:pdmguru(\"$nokp\",\"$kodsek\")'><span style='color:red'><i class='fas fa-trash-alt'></i></span></a>";
        } else {
            $edit = "<span class='label label-warning'>LIMITED</span>";
        }

        echo "<tr><td>$bil</td><td>$nokp</td><td>$nama</td><td>$sekolah ($kodsek)</td>
        <td>$updata</td>
        <td align='center'>$edit</td></tr>";
        $bil++;
    }

    echo "</table></div>";

    end_block();
}

if ($_POST['mode'] == "paparnmtembung") {

    $nama = $_POST['nama'];

    begin_block("Paparan Maklumat Nama Tembung");

    $bil = 1;

    bahaya("Sila padam murid yang tidak berkenaan.");

    echo "<div class='container'><table class='table table-striped table-hover'>";
    echo "<tr><td>Bil.</td><td>MyKad</td><td>Nama</td><td>Sekolah</td><td width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></td></tr>";

    $jo = mysqli_query($con, "SELECT NAMA, KODSEK, ID, KPUTAMA FROM tdatajqaf WHERE NAMA = '$nama' ORDER BY NAMA ASC");
    while ($ju = mysqli_fetch_array($jo)) {

        $nama = $ju["NAMA"];
        $nokp = $ju["KPUTAMA"];
        $sekolah = infoKodSekolah($ju["KODSEK"]);
        $kodsek = $ju["KODSEK"];
        $id = $ju["ID"];

        if ($CURUSER["username"] == $ju["KODSEK"] || $CURUSER["class"] >= "4") {
            $edit = "<a onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='murid.php?mode=pdmmurid&id=$id'><span style='color:red'><i class='fas fa-trash-alt'></i></span></a>";
        } else {
            $edit = "<span class='label label-warning'>LIMITED</span>";
        }

        echo "<tr><td>$bil</td><td>$nokp</td><td><a href='murid.php?mode=editmurid&id=$id'>$nama</a></td><td>$sekolah ($kodsek)</td><td align='center'>$edit</td></tr>";
        $bil++;
    }

    echo "</table></div>";

    end_block();
}

if ($_POST['mode'] == "divstato") {

    begin_panel("Statistik Murid");

    echo "<table class=\"table table-bordered table-hover table-striped\" width=\"100%\" cellpadding=\"5\" border=\"1\">";
    echo "<thead><tr><th>Darjah</th><th>JUMLAH MURID</th><th>Jumlah Lelaki</th><th>Jumlah Perempuan</th><th>Jumlah ISLAM</th><th>Jumlah BUKAN ISLAM</th></tr></thead>";

    $bil = 1;
    $user = $CURUSER['id'];

    if ($CURUSER["class"] == "2") {

        $sek = $CURUSER['sekolah'];
        $kodsek = infoSekolah($sek, "kod");
        $were = "AND KODSEK = '$kodsek'";
        $were2 = "WHERE KODSEK = '$kodsek'";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['ppd'];
        $were = "AND KODSEK IN (SELECT kod FROM ep_sekolah WHERE ppd = '$ppd')";
        $were2 = "WHERE KODSEK IN (SELECT kod FROM ep_sekolah WHERE ppd = '$ppd')";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $were = "AND KODSEK IN (SELECT kod FROM ep_sekolah WHERE negeri = '$neg')";
        $were2 = "WHERE KODSEK IN (SELECT kod FROM ep_sekolah WHERE negeri = '$neg')";
    } elseif ($CURUSER["class"] > "4") {

        $were = "";
        $were = "";
    }

    for ($i = 1; $i < 7; $i++) {

        $bilmurid = get_row_count("tdatajqaf", "WHERE `KODTINGKATAN/TAHUN` = 'D$i' $were");
        $jummurid = get_row_count("tdatajqaf", "$were2");
        $laki = get_row_count("tdatajqaf", "WHERE KODJANTINA = 'L' AND `KODTINGKATAN/TAHUN` = 'D$i' $were");
        $pmpuan = get_row_count("tdatajqaf", "WHERE KODJANTINA = 'P' AND `KODTINGKATAN/TAHUN` = 'D$i' $were");
        $islam = get_row_count("tdatajqaf", "WHERE KODAGAMA = '01' AND `KODTINGKATAN/TAHUN` = 'D$i' $were");
        $xislam = get_row_count("tdatajqaf", "WHERE KODAGAMA != '01' AND `KODTINGKATAN/TAHUN` = 'D$i' $were");
        $id = $re["id"];
        $bilmurthn = get_row_count("tdatajqaf", "WHERE `KODTINGKATAN/TAHUN` = 'D$i' $were");

        echo "<tr>
        <td align='center'><div style='font-size:20px'>$i</div></td>
        <td class='bilgn' align=\"center\">" . number_format($bilmurid) . "</td>
        <td align='center'>" . number_format($laki) . "</td>
        <td align='center'>" . number_format($pmpuan) . "</td>
        <td align='center'>" . number_format($islam) . "</td>
        <td align='center'>" . number_format($xislam) . "</td>
        </tr>";
    }

    echo "<tr>
    <td align='center'><div style='font-size:20px'</div></td>
    <td align=\"center\">" . number_format($jummurid) . "</td>
    <td align='center'></td>
    <td align='center'></td>
    <td align='center'></td>
    <td align='center'></td>
    </tr>";

    echo "</table>";

    end_panel();
}

if ($_POST['mode'] == "kiratembung") {

    if ($CURUSER["class"] == "2") {

        $sek = $CURUSER['sekolah'];
        $kodsek = infoSekolah($sek, "kod");
        $were = "WHERE KODSEK = '$kodsek'";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $were = "AND CatatPlakuOkt = '$ppd'";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);
        $were = "AND CatatPlakuJun = '$kodneg'";
    } else {

        $were = "";
    }

    $kpt = mysqli_query($con, "SELECT KODSEK, NAMA, CatatPlakuJun, CatatPlakuOkt, KPUTAMA FROM tdatajqaf WHERE KPUTAMA IN (SELECT KPUTAMA FROM tdatajqaf GROUP BY KPUTAMA HAVING COUNT(ID) > 1) $were") or trigger_error(mysqli_error($con));
    //$namatembung = mysqli_num_rows($nmt);

    echo "<div class=\"list-group\">
    <a href='murid.php?mode=tembung' class=\"list-group-item\"><i class='fas fa-exclamation-circle'></i> KP Tembung <span class='badge'>$kptembung</span></a>";
    //echo "<a href='murid.php?mode=nmtembung' class=\"list-group-item\"><i class='fas fa-exclamation-circle'></i> Nama Tembung <span class='badge'>$namatembung</span></a>";
    echo "</div>";
}

if ($_POST['mode'] == "kiratembungguru") {

    if ($CURUSER["class"] == "2") {

        $sek = $CURUSER['sekolah'];
        $kodsek = infoSekolah($sek, "kod");
        $were = "WHERE KODSEK = '$kodsek'";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['ppd'];
        $were = "AND KODSEK IN (SELECT kod FROM ep_sekolah WHERE ppd = '$ppd')";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $were = "AND KODSEK IN (SELECT kod FROM ep_sekolah WHERE negeri = '$neg')";
    } else {

        $were = "";
    }

    $kpt = mysqli_query($con, "SELECT KODSEK, NAMA, tdataguru.KPUTAMA FROM tdataguru WHERE KPUTAMA IN (SELECT KPUTAMA FROM tdataguru GROUP BY KPUTAMA HAVING COUNT(*) > 1) $were");
    $kptembung = mysqli_num_rows($kpt);

    echo "<div class=\"list-group\">
    <a href='guru.php?mode=tembung' class=\"list-group-item\"><i class='fas fa-exclamation-circle'></i> KP Tembung <span class='badge'>$kptembung</span></a>";
    echo "</div>";
}

if ($_POST['mode'] == "stattembung") {

    if ($CURUSER["class"] > "4") {

        echo " <ul class=\"list-group\">";

        $tu = mysqli_query($con, "SELECT * FROM ep_negeri");
        while ($te = mysqli_fetch_array($tu)) {

            $neg = $te["id"];
            $negeri = $te["nama"];
            $kodneg = sprintf("%02d", $neg);

            $fn = mysqli_query($con, "SELECT KPUTAMA, CatatPlakuJun, CatatPlakuOkt FROM tdatajqaf WHERE KPUTAMA IN (SELECT KPUTAMA FROM tdatajqaf GROUP BY KPUTAMA HAVING COUNT(*) > 1) AND CatatPlakuJun = '$neg'");
            $fg = mysqli_num_rows($fn);

            $negeri = $te["nama"];

            echo "<li class=\"list-group-item\">$negeri <span class=\"badge\">" . number_format($fg) . "</span></li>";
        }

        echo "</ul>";
    }

    if ($CURUSER["class"] == "4") {

        echo " <ul class=\"list-group\">";

        $neg = $CURUSER['negeri'];

        $tu = mysqli_query($con, "SELECT * FROM ep_ppd WHERE negeri = '$neg'");
        while ($te = mysqli_fetch_array($tu)) {

            $ppd = $te["id"];
            $nama = $te["nama"];
            $kod = $te["kodppd"];

            $fn = mysqli_query($con, "SELECT KPUTAMA, CatatPlakuJun, CatatPlakuOkt FROM tdatajqaf WHERE KPUTAMA IN (SELECT KPUTAMA FROM tdatajqaf GROUP BY KPUTAMA HAVING COUNT(*) > 1) AND CatatPlakuOkt = '$kod')");
            $fg = mysqli_num_rows($fn);

            echo "<li class=\"list-group-item\">$nama <span class=\"badge\">" . number_format($fg) . "</span></li>";
        }

        echo "</ul>";
    }
}

if ($_POST['mode'] == "pilihnegeri") {

    $negeri = $_POST['neg'];
    $nmneg = infoAwan($negeri, "nama", "ep_negeri");

    echo "<div class='label label-primary'>$nmneg</div>";

    info("Sila klik pada nama fail di bawah mengikut kategori.");

    echo "<table class='table' width='100%'><tr>";
    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>MURID</div>
    <a href='download.php?mode=pilihnegeri&negeri=$negeri&db=murid'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFMurid.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>GURU</div>
    <a href='download.php?mode=pilihnegeri&negeri=$negeri&db=guru'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFGuru.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>SEKOLAH</div>
    <a href='download.php?mode=pilihnegeri&negeri=$negeri&db=sek'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFSekolah.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>KCJ</div>
    <a href='download.php?mode=pilihnegeri&negeri=$negeri&db=kcj'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>KCJMurid.txt</div></a>
    </div></td>";
    echo "</tr></table>";
}

if ($_POST['mode'] == "pilihppd") {

    $ppd = $_POST['ppd'];
    $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");
    $nmppd = infoAwan($ppd, "nama", "ep_ppd");

    echo "<div class='label label-primary'>$nmppd</div>";

    info("Sila klik pada nama fail di bawah mengikut kategori.");

    echo "<table class='table' width='100%'><tr>";
    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>MURID</div>
    <a href='download.php?mode=pilihppd&ppd=$ppd&db=murid'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFMurid.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>GURU</div>
    <a href='download.php?mode=pilihppd&ppd=$ppd&db=guru'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFGuru.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>SEKOLAH</div>
    <a href='download.php?mode=pilihppd&ppd=$ppd&db=sek'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFSekolah.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>KCJ</div>
    <a href='download.php?mode=pilihppd&ppd=$ppd&db=kcj'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>KCJMurid.txt</div></a>
    </div></td>";
    echo "</tr></table>";
}

if ($_POST['mode'] == "pilihzon") {

    $zon = $_POST['zon'];

    if ($zon == "1") {

        $zono = "Zon Pantai Timur";
    } elseif ($zon == "2") {

        $zono = "Zon Tengah";
    } elseif ($zon == "3") {

        $zono = "Zon Selatan";
    } elseif ($zon == "4") {

        $zono = "Zon Utara";
    } elseif ($zon == "5") {

        $zono = "Zon Borneo";
    }

    echo "<div class='label label-primary'>$zono</div>";

    info("Sila klik pada nama fail di bawah mengikut kategori.");

    echo "<table class='table' width='100%'><tr>";
    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>MURID</div>
    <a href='download.php?mode=pilihzon&zon=$zon&db=murid'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFMurid.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>GURU</div>
    <a href='download.php?mode=pilihzon&zon=$zon&db=guru'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFGuru.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>SEKOLAH</div>
    <a href='download.php?mode=pilihzon&zon=$zon&db=sek'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>JQAFSekolah.txt</div></a>
    </div></td>";

    echo "<td width='25%'>
    <div style='height:105px; border-radius:10px; background-color:#aed581; padding:10px'>
    <div style='border-radius:10px; background-color: #e6ee9c; font-weight:bold; font-size:20px; text-align:center; padding:10px'>KCJ</div>
    <a href='download.php?mode=pilihzon&zon=$zon&db=kcj'><div style='border-radius:10px; margin-top:5px; background-color: #43a047; color:white; text-align:center; padding:5px'>KCJMurid.txt</div></a>
    </div></td>";
    echo "</tr></table>";
}

if ($_POST['mode'] == "verifikasippd") {

    $ppd = $CURUSER['ppd'];
    $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");

    $smuae = get_row_count("ep_sekolah", "WHERE ppd = '$ppd'"); //bil sk
    $smua = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd'"); //bil sk
    $sk = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK IN (101,102,207)"); //bil sk
    $sjkc = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK = '103'"); //bil sjkc
    $sjkt = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK = '104'"); //bil sjkt
    $sabk = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK = '107'"); //bil sabk
    $skkhas = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK = '105'"); //bil skkhas
    $skasli = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK = '106'"); //bil skasli
    $k9 = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND JENISSEK = '108'"); //bil k9
    $ppki = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND STATUSKHAS = '0'"); //bil ppki
    $skpkld = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND STATUSKHAS = '2'"); //bil skpk ld
    $skpkldd = get_row_count("tdatasekolah", "WHERE PPD = '$kodppd' AND STATUSKHAS = '3'"); //bil skpk + skpk ld

    $smuamu = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd')"); //bil sk
    $skm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (101,102,207)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sk
    $sjkcm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (103)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sjkc
    $sjktm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (104)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sjkt
    $sabkm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (107)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sabk
    $skkhasm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (1) AND JENISSEK IN (105)) AND STATUSMURID IN (33,34,40)"); //bil skkhas dan k9
    $skaslim = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (106,108)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil skasli
    $ppkim = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (0)) AND  STATUSMURID IN (32,36,37,38,40)"); //bil ppki
    $inklu = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (0)) AND  STATUSMURID IN (31)"); //bil ppki
    $skpkldm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (2) AND JENISSEK IN (105)) AND STATUSMURID IN (33,34,40)"); //bil skpk ld
    $skpklddm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE PPD = '$kodppd' AND STATUSKHAS IN (3) AND JENISSEK IN (105)) AND STATUSMURID IN (33,34,35,40)"); //bil skpk + skpk ld

    $e = 0;
    $ko = mysqli_query($con, "SELECT kod, nama FROM ep_sekolah WHERE ppd = '$ppd'");
    while ($hu = mysqli_fetch_array($ko)) {

        $kod = $hu["kod"];
        $nama = $hu["nama"];

        $jo3 = mysqli_query($con, "SELECT KODSEK FROM tdatasekolah WHERE KODSEK = '$kod'");
        if (mysqli_num_rows($jo3) == 0) {
            $e++;
        }
    }

    $sekxdata = $e;

    echo "<div class='row'><div class='container-fluid'>";
    echo "<div class='col-sm-6 col-md-6'>";
    echo "<h4><strong>STATISTIK SEKOLAH</strong></h4>";
    echo " <ul class=\"list-group\">
    <li class=\"list-group-item list-group-item-info small\">BIL. SEKOLAH<span class=\"badge\">" . number_format($smua) . "</span></li>
    <li onclick='sektakde()' class=\"list-group-item list-group-item-danger small\" style='cursor:pointer'>BIL. SEKOLAH TIADA DATA<span class=\"badge\">" . number_format($sekxdata) . "</span></li>
    <li class=\"list-group-item small\">SK + SRK + MODEL KHAS<span class=\"badge\">" . number_format($sk) . "</span></li>
    <li class=\"list-group-item small\">SJKC<span class=\"badge\">" . number_format($sjkc) . "</span></li>
    <li class=\"list-group-item small\">SJKT<span class=\"badge badge-success\">" . number_format($sjkt) . "</span></li> 
    <li class=\"list-group-item small\">SABK<span class=\"badge badge-success\">" . number_format($sabk) . "</span></li> 
    <li class=\"list-group-item small\">SK ASLI + K9<span class=\"badge badge-success\">" . number_format($skasli) . "</span></li> 
    <li class=\"list-group-item small\">PPKI<span class=\"badge badge-success\">" . number_format($ppki) . "</span></li>
    <li class=\"list-group-item small\">SK KHAS<span class=\"badge badge-success\">" . number_format($skkhas) . "</span></li> 
    </ul> ";
    echo "</div><div class='col-sm-6 col-md-6'>";

    echo "<h4><strong>STATISTIK MURID</strong></h4>";
    echo " <ul class=\"list-group\">
    <li class=\"list-group-item list-group-item-info small\">ENROLMEN MURID<span class=\"badge\">" . number_format($smuamu) . "</span></li>
    <li class=\"list-group-item small\">SK + SRK + MODEL KHAS<span class=\"badge\">" . number_format($skm) . "</span></li>
    <li class=\"list-group-item small\">SJKC<span class=\"badge\">" . number_format($sjkcm) . "</span></li>
    <li class=\"list-group-item small\">SJKT<span class=\"badge badge-success\">" . number_format($sjktm) . "</span></li> 
    <li class=\"list-group-item small\">SABK<span class=\"badge badge-success\">" . number_format($sabkm) . "</span></li> 
    <li class=\"list-group-item small\">SK ASLI + K9<span class=\"badge badge-success\">" . number_format($skaslim) . "</span></li> 
    <li class=\"list-group-item small\">PPKI<span class=\"badge badge-success\">" . number_format($ppkim) . "</span></li>
    <li class=\"list-group-item small\">INKLUSIF PENUH<span class=\"badge badge-success\">" . number_format($inklu) . "</span></li>
    <li class=\"list-group-item small\">SK KHAS<span class=\"badge badge-success\">" . number_format($skkhasm) . "</span></li> 
    </ul> ";

    echo "</div></div></div>";
}

if ($_POST['mode'] == "verifikasineg") {

    $neg = $CURUSER['negeri'];
    $kodnegg = infoAwan($neg, "kod", "ep_negeri");
    $kodneg = sprintf("%02d", $kodnegg);

    $smuae = get_row_count("ep_sekolah", "WHERE negeri = '$neg'"); //bil sk eprd
    $seklapore = get_row_count("ep_sekolah", "WHERE negeri = '$neg' AND lapor = '1' AND lapor != '0'"); //bil sk eprd
    $smua = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg'"); //bil sk
    $seklapor = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND STALAPORDATA = '0'"); //bil sk
    $sk = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK IN (101,102,207)"); //bil sk
    $sjkc = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK = '103'"); //bil sjkc
    $sjkt = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK = '104'"); //bil sjkt
    $sabk = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK = '107'"); //bil sabk
    $skkhas = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK = '105'"); //bil skkhas
    $skasli = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK = '106'"); //bil skasli
    $k9 = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND JENISSEK = '108'"); //bil k9
    $ppki = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND STATUSKHAS = '0'"); //bil ppki
    $skpkld = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND STATUSKHAS = '2'"); //bil skpk ld
    $skpkldd = get_row_count("tdatasekolah", "WHERE NEGERI = '$kodneg' AND STATUSKHAS = '3'"); //bil skpk + skpk ld

    $smuamu = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg')"); //bil sk
    $skm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (101,102,207)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sk
    $sjkcm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (103)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sjkc
    $sjktm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (104)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sjkt
    $sabkm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (107)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil sabk
    $skkhasm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (1) AND JENISSEK IN (105)) AND STATUSMURID IN (33,34,40)"); //bil skkhas dan k9
    $skaslim = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (-1,0) AND JENISSEK IN (106,108)) AND STATUSMURID IN (3,4,5,6,7,8)"); //bil skasli
    $ppkim = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (0)) AND  STATUSMURID IN (32,36,37,38,40)"); //bil ppki
    $inklu = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (0)) AND  STATUSMURID IN (31)"); //bil inklusif
    $skpkldm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (2) AND JENISSEK IN (105)) AND STATUSMURID IN (33,34,40)"); //bil skpk ld
    $skpklddm = get_row_count("tdatajqaf", "WHERE KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE NEGERI = '$kodneg' AND STATUSKHAS IN (3) AND JENISSEK IN (105)) AND STATUSMURID IN (33,34,40)"); //bil skpk + skpk ld

    $e = 0;
    $ko = mysqli_query($con, "SELECT kod, nama FROM ep_sekolah WHERE negeri = '$negeri'");
    while ($hu = mysqli_fetch_array($ko)) {

        $kod = $hu["kod"];
        $nama = $hu["nama"];

        $jo3 = mysqli_query($con, "SELECT KODSEK FROM tdatasekolah WHERE KODSEK = '$kod'");
        if (mysqli_num_rows($jo3) == 0) {
            $e++;
        }
    }

    $sekxdata = $e;

    echo "<div class='row'><div class='container-fluid'>";
    echo "<div class='col-sm-6 col-md-6'>";
    echo "<h4><strong>STATISTIK SEKOLAH</strong></h4>";
    echo " <ul class=\"list-group\">
    <li class=\"list-group-item list-group-item-success small\"><strong>BIL. SEKOLAH EPRD</strong><span class=\"badge\">" . number_format($smuae) . "</span></li>
    <li class=\"list-group-item list-group-item-info small\"><strong>BIL. SEKOLAH YANG DIUPLOAD</strong><span class=\"badge\">" . number_format($smua) . "</span></li>
    <li class=\"list-group-item list-group-item-warning small\">BIL. SEKOLAH YANG MELAPOR<span class=\"badge\">" . number_format($seklapor) . "</span></li>
    <li onclick='sektakde()' class=\"list-group-item list-group-item-danger small\" style='cursor:pointer'>BIL. SEKOLAH TIADA DATA<span class=\"badge\">" . number_format($sekxdata) . "</span></li>
    <li class=\"list-group-item small\">SK + SRK + MODEL KHAS<span class=\"badge\">" . number_format($sk) . "</span></li>
    <li class=\"list-group-item small\">SJKC<span class=\"badge\">" . number_format($sjkc) . "</span></li>
    <li class=\"list-group-item small\">SJKT<span class=\"badge badge-success\">" . number_format($sjkt) . "</span></li> 
    <li class=\"list-group-item small\">SABK<span class=\"badge badge-success\">" . number_format($sabk) . "</span></li> 
    <li class=\"list-group-item small\">SK ASLI + K9<span class=\"badge badge-success\">" . number_format($skasli) . "</span></li> 
    <li class=\"list-group-item small\">PPKI<span class=\"badge badge-success\">" . number_format($ppki) . "</span></li>
    <li class=\"list-group-item small\">SK KHAS<span class=\"badge badge-success\">" . number_format($skkhas) . "</span></li> 
    </ul> ";
    echo "</div><div class='col-sm-6 col-md-6'>";

    echo "<h4><strong>STATISTIK MURID</strong></h4>";
    echo " <ul class=\"list-group\">
    <li class=\"list-group-item list-group-item-info small\">ENROLMEN MURID<span class=\"badge\">" . number_format($smuamu) . "</span></li>
    <li class=\"list-group-item small\">SK + SRK + MODEL KHAS<span class=\"badge\">" . number_format($skm) . "</span></li>
    <li class=\"list-group-item small\">SJKC<span class=\"badge\">" . number_format($sjkcm) . "</span></li>
    <li class=\"list-group-item small\">SJKT<span class=\"badge badge-success\">" . number_format($sjktm) . "</span></li> 
    <li class=\"list-group-item small\">SABK<span class=\"badge badge-success\">" . number_format($sabkm) . "</span></li> 
    <li class=\"list-group-item small\">SK ASLI + K9<span class=\"badge badge-success\">" . number_format($skaslim) . "</span></li> 
    <li class=\"list-group-item small\">PPKI<span class=\"badge badge-success\">" . number_format($ppkim) . "</span></li>
    <li class=\"list-group-item small\">INKLUSIF PENUH<span class=\"badge badge-success\">" . number_format($inklu) . "</span></li>
    <li class=\"list-group-item small\">SK KHAS<span class=\"badge badge-success\">" . number_format($skkhasm) . "</span></li> 
    </ul> ";

    echo "</div></div></div>";
}

if ($_POST['mode'] == "sektakde") {

    begin_block("SEKOLAH TIADA DATA");

    if ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['ppd'];
        $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");

        $were = "ppd = '$ppd'";
    }

    if ($CURUSER["class"] == "4") {

        $negeri = $CURUSER['negeri'];
        $kodnegg = infoAwan($neg, "kod", "ep_negeri");
        $kodneg = sprintf("%02d", $kodnegg);
        $were = "negeri = '$negeri'";
    }

    echo "<table class='table' style='width:500px'><tr><td>Bil.</td><td>Kod Sekolah</td><td>Nama Sekolah</td></tr>";

    $e = 1;

    $ko = mysqli_query($con, "SELECT kod, nama FROM ep_sekolah WHERE $were");

    while ($hu = mysqli_fetch_array($ko)) {

        $kod = $hu["kod"];
        $nama = $hu["nama"];

        $jo3 = mysqli_query($con, "SELECT KODSEK FROM tdatasekolah WHERE KODSEK = '$kod'");
        if (mysqli_num_rows($jo3) > 0) {

            $lo = "";
        } else {

            $lo = "<tr><td>$e</td><td>$kod</td><td>$nama</td></tr>";
            $e++;
        }

        echo $lo;
    }

    echo "</table>";

    end_block();
}

if ($_GET['modo'] == "arahandata") {

    $arah = $_GET['arah'];

    arahandata("ajax/op.php?arah=$arah", "arahandata", "");
}

if ($_GET['modo'] == "arahandata2") {

    $arah = $_GET['arah'];

    arahandata2("ajax/op.php?arah=$arah", "arahandata2", "");
}

if ($_GET['modo'] == "carimurid") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $sek = $_GET['sek'];
    $nma = $_GET['nma'];
    $aliran = $_GET['alir'];
    $drjh = $_GET['drjh'];

    carimurid("ajax/op.php?neg=$negeri&ppd=$ppd&sek=$sek&nma=$nma&alir=$aliran&drjh=$drjh", "carimurid");
}

if ($_GET['modo'] == "cariguru") {

    $negeri = $_GET['neg'];
    $ppd = $_GET['ppd'];
    $sek = $_GET['sek'];
    $nma = $_GET['nma'];
    $jns = $_GET['jns'];

    cariguru("ajax/op.php?neg=$negeri&ppd=$ppd&sek=$sek&nma=$nma&jns=$jns", "cariguru", "2");
}

if ($_GET['mode'] == "pilihbhs") {

    $elek = $_GET['elek'];
    $kodsek = infoAwan($CURUSER["sekolah"], "kod", "ep_sekolah");

    //////// BAHASA PILIHAN 1 ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIDAK MENYERTAI',
        '1' => 'BAHASA ARAB',
        '2' => 'BAHASA CINA',
        '3' => 'BAHASA TAMIL',
        '4' => 'BAHASA IBAN',
        '5' => 'BAHASA KADAZANDUSUN',
        '6' => 'BAHASA SEMAI'
    );

    $menu_name1 = 'tawarb1';
    $selected_value1 = getSekolah($kodsek, 'TAWARB1');
    $bhspilih = select_menu($menu_name1, $options, $selected_value1);

    $menu_name2 = 'tawarb2';
    $selected_value2 = getSekolah($kodsek, 'TAWARB2');
    $bhspilih2 = select_menu($menu_name2, $options, $selected_value2);

    $menu_name3 = 'tawarb3';
    $selected_value3 = getSekolah($kodsek, 'TAWARB3');
    $bhspilih3 = select_menu($menu_name3, $options, $selected_value3);

    $menu_name4 = 'tawarb4';
    $selected_value4 = getSekolah($kodsek, 'TAWARB4');
    $bhspilih4 = select_menu($menu_name4, $options, $selected_value4);

    $menu_name5 = 'tawarb5';
    $selected_value5 = getSekolah($kodsek, 'TAWARB5');
    $bhspilih5 = select_menu($menu_name5, $options, $selected_value5);

    $menu_name6 = 'tawarb6';
    $selected_value6 = getSekolah($kodsek, 'TAWARB6');
    $bhspilih6 = select_menu($menu_name6, $options, $selected_value6);

    $menu_name7 = 'tawarb7';
    $selected_value7 = getSekolah($kodsek, 'TAWARB7');
    $bhspilih7 = select_menu($menu_name7, $options, $selected_value7);
    //////////////////////////////////////////////////////////////////////

    if ($elek == "1") {

        echo "<div id='divbhs1'>$bhspilih</div>";
    }
    if ($elek == "2") {

        echo "<div id='divbhs2'><div style='padding-top:5px'>$bhspilih</div><div style='padding-top:5px'>$bhspilih2</div></div>";
    }
    if ($elek == "3") {

        echo "<div id='divbhs3'><div style='padding-top:5px'>$bhspilih</div><div style='padding-top:5px'>$bhspilih2</div><div style='padding-top:5px'>$bhspilih3</div></div>";
    }
    if ($elek == "4") {

        echo "<div id='divbhs4'><div style='padding-top:5px'>$bhspilih</div><div style='padding-top:5px'>$bhspilih2</div><div style='padding-top:5px'>$bhspilih3</div><div style='padding-top:5px'>$bhspilih4</div></div>";
    }
    if ($elek == "5") {

        echo "<div id='divbhs5'><div style='padding-top:5px'>$bhspilih</div><div style='padding-top:5px'>$bhspilih2</div><div style='padding-top:5px'>$bhspilih3</div><div style='padding-top:5px'>$bhspilih4</div><div style='padding-top:5px'>$bhspilih5</div></div>";
    }
    if ($elek == "6") {

        echo "<div id='divbhs6'><div style='padding-top:5px'>$bhspilih</div><div style='padding-top:5px'>$bhspilih2</div><div style='padding-top:5px'>$bhspilih3</div><div style='padding-top:5px'>$bhspilih4</div><div style='padding-top:5px'>$bhspilih5</div><div style='padding-top:5px'>$bhspilih6</div></div>";
    }
    if ($elek == "7") {

        echo "<div id='divbhs7'><div style='padding-top:5px'>$bhspilih</div><div style='padding-top:5px'>$bhspilih2</div><div style='padding-top:5px'>$bhspilih3</div><div style='padding-top:5px'>$bhspilih4</div><div style='padding-top:5px'>$bhspilih5</div><div style='padding-top:5px'>$bhspilih6</div><div style='padding-top:5px'>$bhspilih7</div></div>";
    }
}

if ($_POST['mode'] == "aduan") {

    begin_block("Aduan Masalah Sistem");
    echo "<textarea class='form-control' name='aduantxt' placeholder='Sila tulis aduan di sini..' rows='4' id='aduantxt'></textarea>";
    echo "<div align='right' style='padding-top:10px'><button type=\"submit\" onclick='posaduan()' class=\"btn btn-primary\">Hantar</button></div>";
    end_block();
}

if ($_POST['mode'] == "posaduan") {

    $aduan = $_POST['aduan'];
    $user = $CURUSER['id'];
    $kepada = "2";
    $subjek = "Aduan Sistem";

    $ad = mysqli_query($con, "INSERT INTO ep_surat (kepada,daripada,subjek,kandungan,tarikh) VALUES ('$kepada','$user','$subjek','$aduan',NOW())") or die(mysqli_error($con));

    if ($ad) {

        echo "Aduan anda telah disimpan.";
    }
}

if ($_POST['mode'] == "prosesdata") {

    $filemurid = $_POST['murid'];
    $filesek = $_POST['sek'];
    $status = $_POST['status'];

    $filename1 = "../temp/$filemurid";

    $checkversion = file_get_contents($filename1);

    //echo realpath($filename1);

    if (mb_strpos($checkversion, 'ePeLaporOKT2020') !== false) {

        mysqli_query($con, 'SET NAMES utf8;');
        mysqli_set_charset($con, "utf8");

        $ho = mysqli_query($con, "LOAD DATA LOCAL INFILE '$filename1' INTO TABLE tdatajqaf
        CHARACTER SET latin1
        FIELDS TERMINATED BY ',' 
        ENCLOSED BY '\"' 
        LINES TERMINATED BY '\r\n'
        IGNORE 1 LINES") or trigger_error(mysqli_error($con));

        if ($CURUSER['class'] == "2") {

            $kodsek = $CURUSER["username"];
            $ppd = $CURUSER['ppd'];
            $kodppd = PPDidtoKOD($ppd);
            $negeri = $CURUSER['negeri'];
            $kodneg = sprintf("%02d", $negeri);
            $jnssek = infoKod($kodsek, "ep_sekolah", "kod", "jenis");
            mysqli_query($con, "UPDATE tdatajqaf SET Aurat4 = '$jnssek', CatatPlakuJun = '$kodneg', CatatPlakuOkt='$kodppd' WHERE KODSEK = '$kodsek'");
        
        }

        if ($ho) {

            echo "Data telah diproses dan telah disimpan.";

        } else {

            echo "Data bermasalah!";
        }
    } else {
        $usr = $CURUSER['id'];
        mysqli_query($con,"DELETE FROM ep_awan WHERE user = '$usr' AND status = '$status'");
        echo "$idsek $status Data pencapaian murid tidak sah kerana tidak menggunakan Sistem ePelaporan Bersepadu versi terkini. Sila upload semula.";
    }
}

if ($_POST['mode'] == "prosesdataver") {

    $filemurid = $_POST['murid'];
    $filesek = $_POST['sek'];
    $status = $_POST['status'];

    $filename1 = "../temp/$filemurid";

    $checkversion = file_get_contents($filename1);

    //echo realpath($filename1);

    if (mb_strpos($checkversion, 'ePeLaporOKT2020') !== false) {

        mysqli_query($con, 'SET NAMES utf8;');
        mysqli_set_charset($con, "utf8");

        $ho = mysqli_query($con, "LOAD DATA LOCAL INFILE '$filename1' INTO TABLE tdatajqafver
        CHARACTER SET latin1
        FIELDS TERMINATED BY ',' 
        ENCLOSED BY '\"' 
        LINES TERMINATED BY '\r\n'
        IGNORE 1 LINES") or trigger_error(mysqli_error($con));

        if ($CURUSER['class'] == "2") {

            $kodsek = $CURUSER["username"];
            $ppd = $CURUSER['ppd'];
            $kodppd = PPDidtoKOD($ppd);
            $negeri = $CURUSER['negeri'];
            $kodneg = sprintf("%02d", $negeri);
            $jnssek = infoKod($kodsek, "ep_sekolah", "kod", "jenis");
            mysqli_query($con, "UPDATE tdatajqafver SET Aurat4 = '$jnssek', CatatPlakuJun = '$kodneg', CatatPlakuOkt='$kodppd' WHERE KODSEK = '$kodsek'");
        
        }

        if ($ho) {

            echo "Data telah diproses dan telah disimpan.";

        } else {

            echo "Data bermasalah!";
        }
    } else {
        $usr = $CURUSER['id'];
        mysqli_query($con,"DELETE FROM ep_awan_ver WHERE user = '$usr' AND status = '$status'");
        echo "$idsek $status Data pencapaian murid tidak sah kerana tidak menggunakan Sistem ePelaporan Bersepadu versi terkini. Sila upload semula.";
    }
}

if ($_POST['mode'] == "mohonpadam") {

    $user = $CURUSER['id'];

    if ($CURUSER["class"] != "3") {

        $kodppd = $_POST['kodppd'];
    } else {

        $kodppd = $CURUSER["username"];
    }

    $kepada = "2";
    $subjek = "Permohonan Padam Data";
    $status = $_POST['status'];
    $aduan = "Permohonan padam data oleh #$user untuk username $kodppd, status aliran: $status";

    $ad = mysqli_query($con, "INSERT INTO ep_surat (kepada,daripada,subjek,kandungan,tarikh) VALUES ('$kepada','$user','$subjek','$aduan',NOW())") or die(mysqli_error($con));

    if ($ad) {

        echo "Permohonan anda telah disimpan.";
    }
}

if ($_POST['mode'] == "senaraimarkah") {

    $kutipan = $SETTINGS["namakutipan"];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
        
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    echo "<div class='container' style='width:100vw'>";

    $kodsek = $_POST['kodsek'];
    $tahun = $_POST['tahun'];
    $jenis = $_POST['jenis'];
    $my = $_POST['my'];
    $deta = $_POST['deta'];
    $idsek = infoKodSekolah($kodsek, "id");
    $leveli = $_POST['level'];

    if ($leveli == "2") {

        $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        $drjh = "<td>Darjah</td>";

    } elseif ($leveli == "3") {

        $ppd = $_POST['kodsek'];
        if ($my == "1") {
            $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        } else {
            $level = "WHERE CatatPlakuOkt = '$ppd' AND SB6 = '1'";
        }
        $drjh = "<td>Kod Sekolah</td><td>Sekolah</td>";

    } elseif ($leveli == "4") {

        $neg = $_POST['kodsek'];
        if ($my == "1") {
            $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        } else {
            $kodneg = sprintf("%02d", $neg);
            $level = "WHERE CatatPlakuJun = '$kodneg' AND SB6 = '1'";
        }
        $drjh = "<td>PPD</td><td>Kod Sekolah</td><td>Sekolah</td>";

    } elseif ($CURUSER["class"] > "4") {

        if ($my == "1") {
            $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        } else {
            $level = "WHERE SB6 = '1'";
        }
        $drjh = "<td>Negeri</td>";
        
    }

    if ($jenis == "1") {

        begin_block("Murid Menguasai Al-Quran <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div class='row'><div class='col-md-6'>";

        info("MURID MENGUASAI AL-QURAN <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&leveli=$leveli&cp=capai' target='_blank'>Cetak</a></span>");

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];

                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";

                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div><div class='col-md-6'>";

        bahaya("MURID TIDAK MENGUASAI AL-QURAN <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&leveli=$leveli&cp=tidak' target='_blank'>Cetak</a></span>");

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh NOT IN (7,8) AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div></div>";

        end_block();
    }

    if ($jenis == "2") {

        begin_block("Murid Menguasai Jawi <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        echo "<div class='row'><div class='col-md-6'>";

        info("MURID MENGUASAI JAWI");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Tahap Penguasaan</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$tt[$koljawi]</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div><div class='col-md-6'>";

        info("MURID TIDAK MENGUASAI JAWI");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Tahap Penguasaan</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $koljawi IN (1,2) AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$tt[$koljawi]</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div></div>";

        end_block();
    }

    if ($jenis == "3") {

        begin_block("Murid Menguasai Bahasa Arab <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");
        echo "<div class='row'><div class='col-md-6'>";

        info("MURID MENGUASAI BAHASA ARAB");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Tahap Penguasaan</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$tt[$kolba]</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div><div class='col-md-6'>";

        info("MURID TIDAK MENGUASAI BAHASA ARAB");

        $f = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Tahap Penguasaan</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolba IN (1,2) AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$f</td>$ikat<td>$NAMA</td><td>$tt[$kolba]</td></tr>";
                $f++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div></div>";

        end_block();
    }

    if ($jenis == "4") {

        begin_block("Murid Menguasai Amali Wuduk <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");
        echo "<div class='row'><div class='col-md-6'>";

        info("MURID MENGUASAI AMALI WUDUK <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&cp=capai' target='_blank'>Cetak</a></span>");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div><div class='col-md-6'>";

        bahaya("MURID TIDAK MENGUASAI AMALI WUDUK <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&cp=tidak' target='_blank'>Cetak</a></span>");

        $f = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) != '6' AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$f</td>$ikat<td>$NAMA</td></tr>";
                $f++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div></div>";

        end_block();
    }

    if ($jenis == "6") {

        begin_block("Murid Menguasai Solat Bacaan <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");
        echo "<div class='row'><div class='col-md-6'>";

        info("MURID MENGUASAI SOLAT BACAAN <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&cp=capai' target='_blank'>Cetak</a></span>");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div><div class='col-md-6'>";

        bahaya("MURID TIDAK MENGUASAI SOLAT BACAAN <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&cp=tidak' target='_blank'>Cetak</a></span>");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) != '4' AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div></div>";

        end_block();
    }

    if ($jenis == "5") {

        begin_block("Murid Menguasai Solat Perlakuan <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        echo "<div class='row'><div class='col-md-6'>";

        info("MURID MENGUASAI SOLAT PERLAKUAN <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&cp=capai' target='_blank'>Cetak</a></span>");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA ($STATUSMURID)</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div><div class='col-md-6'>";

        info("MURID TIDAK MENGUASAI SOLAT PERLAKUAN <span class='pull-right' style='position:absolute;top:10px;right:30px'><a class='btn btn-success btn-sm' href='cetakpdf.php?mode=cetakmyanalisis&jenis=$jenis&kodsek=$kodsek&tahun=$tahun&cp=tidak' target='_blank'>Cetak</a></span>");

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover tablekecil'>";
        echo "<tr style='font-weight:bold'><td>Bil</td><$drjh<td>Nama</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) != '7' AND `KODTINGKATAN/TAHUN` = '$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA ($STATUSMURID)</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        echo "</div></div>";

        end_block();
    }

    echo "</div>";
}

if ($_POST['mode'] == "senaraimarkahquran") {

    $kutipan = $SETTINGS["namakutipan"];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    echo "<div class='container' style='width:70vw'>";

    $kodsek = $_POST['kodsek'];
    $tahun = $_POST['tahun'];
    $jenis = $_POST['jenis'];
    $my = $_POST['my'];
    $deta = $_POST['deta'];
    $idsek = infoKodSekolah($kodsek, "id");

    $leveli = $_POST['level'];
    if ($leveli == "2") {
        $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        $drjh = "<td>Darjah</td>";
    } elseif ($leveli == "3") {
        $ppd = $_POST['kodsek'];
        if ($my == "1") {
            $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        } else {
            $level = "WHERE CatatPlakuOkt = '$ppd' AND SB6 = '1'";
        }
        $drjh = "<td>Kod Sekolah</td><td>Sekolah</td>";
    } elseif ($leveli == "4") {
        $neg = $_POST['kodsek'];
        if ($my == "1") {
            $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        } else {
            $kodneg = sprintf("%02d", $neg);
            $level = "WHERE CatatPlakuJun = '$kodneg' AND SB6 = '1'";
        }
        $drjh = "<td>PPD</td><td>Kod Sekolah</td><td>Sekolah</td>";
    } elseif ($CURUSER["class"] > "4") {
        if ($my == "1") {
            $level = "WHERE KODSEK = '$kodsek' AND SB6 = '1'";
        } else {
            $level = "WHERE SB6 = '1'";
        }
        $drjh = "<td>Negeri</td>";
    }

    if ($jenis == "1") {

        begin_block("Murid Membaca Iqra 1 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (1) AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "2") {

        begin_block("Murid Membaca Iqra 2 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (2) AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "3") {

        begin_block("Murid Membaca Iqra 3 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (3) AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "4") {

        begin_block("Murid Membaca Iqra 4 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (4) AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "5") {

        begin_block("Murid Membaca Iqra 5 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (5) AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "6") {

        begin_block("Murid Membaca Iqra 6 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (6) AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q1") {

        begin_block("Murid Membaca Al-Quran Juz 1-5 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q2") {

        begin_block("Murid Membaca Al-Quran Juz 6-10 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q3") {

        begin_block("Murid Membaca Al-Quran Juz 11-15 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q4") {

        begin_block("Murid Membaca Al-Quran Juz 16-20 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q5") {

        begin_block("Murid Membaca Al-Quran Juz 21 -25 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q6") {

        begin_block("Murid Membaca Al-Quran Juz 25 -30 Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    if ($jenis == "q7") {

        begin_block("Murid Membaca Al-Quran Khatam Tahun $tahun <div class='pull-right'><span style='cursor:pointer' onclick='paparanalisa(\"$idsek\")'><i class=\"fas fa-chevron-circle-left\"></i> KEMBALI</span></div>");

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        if ($jenis == "q1") {
            $juzbrp = "$kolms < 102";
        } elseif ($jenis == "q2") {
            $juzbrp = "$kolms > 101 AND $kolms < 201";
        } elseif ($jenis == "q3") {
            $juzbrp = "$kolms > 200 AND $kolms < 302";
        } elseif ($jenis == "q4") {
            $juzbrp = "$kolms > 301 AND $kolms < 402";
        } elseif ($jenis == "q5") {
            $juzbrp = "$kolms > 401 AND $kolms < 502";
        } elseif ($jenis == "q6") {
            $juzbrp = "$kolms > 501 AND $kolms <= 604";
        } elseif ($jenis == "q7") {
            $juzbrp = "$kolms = 604";
        }

        $e = 1;

        echo "<div style='overflow:scroll; height:400px'><table class='table table-striped table-hover'>";
        echo "<tr style='font-weight:bold'><td>Bil</td>$drjh<td>Nama</td><td>Muka Surat</td><td>Juzuk</td></tr>";

        $t = mysqli_query($con, "SELECT * FROM $deta $level AND KODAGAMA = '01' AND $jenissek $kolkh IN (8) AND $juzbrp AND `KODTINGKATAN/TAHUN` = 'D$tahun'");

        if (mysqli_num_rows($t) > 0) {

            while ($tt = mysqli_fetch_array($t)) {
                extract($tt);

                if ($kutipan == "JUN") {

                    $kolms = $tt["KH2"];
                    $kolq = $tt["KH5"];
                } else {

                    $kolms = $tt["KH4"];
                    $kolq = $tt["KH6"];
                }

                if ($leveli == 2) {

                    $ikat = "<td>$tahun $NAMAKELAS</td>";
                } elseif ($leveli == 3) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $ikat = "<td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli == 4) {

                    $nmsek = infoKodSekolah($KODSEK, "nama");
                    $nmppd = PPDkodtiID($CatatPlakuOkt);
                    $ikat = "<td>$nmppd</td><td>$KODSEK</td><td>$nmsek</td>";
                } elseif ($leveli > 4) {

                    $ikat = "<td></td>";
                }

                echo "<tr><td>$e</td>$ikat<td>$NAMA</td><td>$kolms</td><td>" . juzbrp($kolms) . "</td></tr>";
                $e++;
            }
        } else {

            info("Tiada data ditemui.");
        }

        echo "</table></div>";

        end_block();
    }

    echo "</div>";
}

if ($_POST['mode'] == "mengaku") {

    if ($CURUSER["class"] == "2") {

        $sekolah = $CURUSER['sekolah'];
        $akuan = $_POST['akuan'];
        /*$sahpds = infoSekolah($sekolah,"sahpds");
        $sahsek = infoSekolah($sekolah,"sahsek");*/

        if ($CURUSER["title"] == "KP") {

            mysqli_query($con, "UPDATE ep_sekolah SET akuankp = '$akuan', tarikhakukp = NOW() WHERE id = '$sekolah'");

            echo "Kemaskini berjaya.";

            write_log("" . $CURUSER['namapenuh'] . " KP telah mengesah maklumat sekolah.");
        } elseif ($CURUSER["title"] == "GB") {

            mysqli_query($con, "UPDATE ep_sekolah SET akuangb = '$akuan', tarikhakugb = NOW() WHERE id = '$sekolah'");

            echo "Kemaskini berjaya.";

            write_log("" . $CURUSER['namapenuh'] . " GB telah mengesah maklumat sekolah.");
        } else {

            mysqli_query($con, "UPDATE ep_sekolah SET akuanpds = '$akuan', tarikhakupds = NOW() WHERE id = '$sekolah'");

            echo "Kemaskini berjaya.";

            write_log("" . $CURUSER['namapenuh'] . " PDS telah mengesah maklumat sekolah.");
        }
    }
}

if ($_POST['mode'] == "sahgb") {

    $id = $_POST['id'];

    $jo = mysqli_query($con, "UPDATE ep_sekolah SET sahsek = 'YA', tarikhsek = NOW() WHERE id = '$id'");

    echo "Tarikh disahkan pada: " . infoSekolah($id, "tarikhsek");
}

if ($_POST['mode'] == "sahkp") {

    $id = $_POST['id'];

    $jo = mysqli_query($con, "UPDATE ep_sekolah SET sahpds = 'YA', tarikhpds = NOW() WHERE id = '$id'");

    echo "Tarikh disahkan pada: " . infoSekolah($id, "tarikhpds");
}

if ($_POST['mode'] == "simpancache") {

    $mod = $_POST['mod'];
    $data = $_POST['data'];

    if ($data != "") {

        $check = get_row_count("ep_cache", "WHERE kod = '$mod'");
        if ($check == 0) {
            mysqli_query($con, "INSERT INTO ep_cache (kod,data) VALUES ('$mod','$data')") or trigger_error(mysqli_error($con));
        }
    }
}

if ($_POST['mode'] == "analisison") {

    $kutipan = $SETTINGS["namakutipan"];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    function markahkhatam($tahun, $level)
    {

        global $con, $kolms, $kolq;

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $t = mysqli_query($con, "SELECT *, (((((IF($kolms > $silibus, '$silibus', $kolms)/$silibus)*60)/60) * 40)+(($kolq/40)*60)) AS markah, 59.99 FROM `tdatajqaf` $level AND `KODTINGKATAN/TAHUN` = '$tahun' HAVING markah > 59.99");
        $tt = mysqli_num_rows($t);
        return $tt;
    }

    function markahkhatamsek($tahun, $level, $jnssek)
    {

        global $con, $kolms, $kolq;

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $t = mysqli_query($con, "SELECT *, (((((IF($kolms > $silibus, '$silibus', $kolms)/$silibus)*60)/60) * 40)+(($kolq/40)*60)) AS markah, 59.99 FROM `tdatajqaf` $level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN ($jnssek)) AND `KODTINGKATAN/TAHUN` = '$tahun' HAVING markah > 59.99");
        $tt = mysqli_num_rows($t);
        return $tt;
    }

    $thn = date('Y');
    $jnssek = infoAwan($CURUSER["sekolah"], "jenis", "ep_sekolah");
    $kodsekolah = infoSekolah($CURUSER["sekolah"], "kod");

    if ($CURUSER["class"] == "2") {

        $aliran = infoAwan($CURUSER["sekolah"], "statuskhas", "ep_sekolah");
        //$aliran = "2";
        $level = "WHERE KODSEK = '$kodsekolah' AND SB6 = '1'";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $level = "WHERE CatatPlakuOkt = '$ppd' AND SB6 = '1'";
        $aliran = "-1";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "1";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);
        $level = "WHERE CatatPlakuJun = '$kodneg' AND SB6 = '1'";
        $aliran = "-1";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "1";
    } elseif ($CURUSER["class"] > "4") {

        $level = "WHERE SB6 = '1'";
        $aliran = "-1";
        $tajuk = "KEBANGSAAN";
        $guna = $CURUSER["username"];
        $ch = "1";
    }

    $mod = $_POST['mod'];

    echo "<div align='center'><div id='cetakanalisa' style='padding:1cm;width:100%'>";
    echo "<div id='headeranalisa' class='row' style='margin-bottom:10px;padding-bottom:10px; border-bottom:1px solid black'>
    <div class='col-md-4'><img width='250' src='images/logokpm.png'></div>
    <div class='col-md-4' style='text-align:center;font-weight:bold;font-size:16px'>LAPORAN PENCAPAIAN PROGRAM j-QAF<br>KEMENTERIAN PENDIDIKAN MALAYSIA<br>$ukutipan $uyear</div>
    <div class='col-md-4'></div>
    </div>";

    if ($mod == "analisasemua") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

    ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";

            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN (PERDANA)<br>$tajuk");

            function kira_analisa($kodsekolah, $jns, $thn, $aliran)
            {

                global $level, $koljawi, $kolba, $kolkh, $ch;

                if ($jns == "2") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "1") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "3") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "4") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "6") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "5") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }
            }

            analisapencapaian("", 1);

            end_analisa();

            begin_analisa("ANALISIS PENCAPAIAN AL-QURAN");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran();

            end_analisa();
        }
    }

    if ($mod == "analisappki") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";

            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)");

            function kira_khas($thn)
            {

                global $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_khas()
            {

                global $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40)";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
            </tr>
            <tr class='tengah small boldo'>        

            <td width='5%' class='bgprime'>BIL</td>           
            <td width='5%' class='bgprime'>%</td>       

            </tr>
            ";

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
            $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

                $iq1 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq1p = @($iq1 / $jumlahbwh) * 100;
                } else {
                    $iq1p = "0";
                }
                $iq2 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                } else {
                    $iq2p = "0";
                }

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah ($kod)</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                </tr>";
            }

            $jiq1 = kolum_khas($jnssek, $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            </tr>";

            echo "</table>";

            end_analisa();

            begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)");

            function kira_quran_ppki($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND KategoriKhas = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_quran_ppki($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell  table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
            <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ6</td>          
            <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
            <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
            <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
            </tr>
            <tr class='tengah small boldo'>        

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>          

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>         

            </tr>
            ";

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
            $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam'");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

                if ($jumlahtepi != 0) {
                    $iq1 = kira_quran_ppki($jnssek, $kod, $kolkh, "1", $aliran);
                    $iq1p = @($iq1 / $jumlahtepi) * 100;
                    $iq2 = kira_quran_ppki($jnssek, $kod, $kolkh, "2", $aliran);
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                    $iq3 = kira_quran_ppki($jnssek, $kod, $kolkh, "3", $aliran);
                    $iq3p = @($iq3 / $jumlahtepi) * 100;
                    $iq4 = kira_quran_ppki($jnssek, $kod, $kolkh, "4", $aliran);
                    $iq4p = @($iq4 / $jumlahtepi) * 100;
                    $iq5 = kira_quran_ppki($jnssek, $kod, $kolkh, "5", $aliran);
                    $iq5p = @($iq5 / $jumlahtepi) * 100;
                    $iq6 = kira_quran_ppki($jnssek, $kod, $kolkh, "6", $aliran);
                    $iq6p = @($iq6 / $jumlahtepi) * 100;
                    $iq7 = kira_quran_ppki($jnssek, $kod, $kolkh, "7", $aliran);
                    $iq7p = @($iq7 / $jumlahtepi) * 100;
                    $iq8 = kira_quran_ppki($jnssek, $kod, $kolkh, "8", $aliran);
                    $iq8p = @($iq8 / $jumlahtepi) * 100;
                } else {
                    $iq1 = kira_quran_ppki($jnssek, $kod, $kolkh, "1", $aliran);
                    $iq1p = "0";
                    $iq2 = kira_quran_ppki($jnssek, $kod, $kolkh, "2", $aliran);
                    $iq2p = "0";
                    $iq3 = kira_quran_ppki($jnssek, $kod, $kolkh, "3", $aliran);
                    $iq3p = "0";
                    $iq4 = kira_quran_ppki($jnssek, $kod, $kolkh, "4", $aliran);
                    $iq4p = "0";
                    $iq5 = kira_quran_ppki($jnssek, $kod, $kolkh, "5", $aliran);
                    $iq5p = "0";
                    $iq6 = kira_quran_ppki($jnssek, $kod, $kolkh, "6", $aliran);
                    $iq6p = "0";
                    $iq7 = kira_quran_ppki($jnssek, $kod, $kolkh, "7", $aliran);
                    $iq7p = "0";
                    $iq8 = kira_quran_ppki($jnssek, $kod, $kolkh, "8", $aliran);
                    $iq8p = "0";
                }

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
                <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
                <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
                <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
                <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
                <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
                <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

                <td>" . number_format($jumlahtepi) . "</td>
                </tr>";
            }

            $jiq1 = kolum_quran_ppki($jnssek, $kolkh, "1", $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;
            $jiq2 = kolum_quran_ppki($jnssek, $kolkh, "2", $aliran);
            $jiq2p = @($jiq2 / $jumlahbwh) * 100;
            $jiq3 = kolum_quran_ppki($jnssek, $kolkh, "3", $aliran);
            $jiq3p = @($jiq3 / $jumlahbwh) * 100;
            $jiq4 = kolum_quran_ppki($jnssek, $kolkh, "4", $aliran);
            $jiq4p = @($jiq4 / $jumlahbwh) * 100;
            $jiq5 = kolum_quran_ppki($jnssek, $kolkh, "5", $aliran);
            $jiq5p = @($jiq5 / $jumlahbwh) * 100;
            $jiq6 = kolum_quran_ppki($jnssek, $kolkh, "6", $aliran);
            $jiq6p = @($jiq6 / $jumlahbwh) * 100;
            $jiq7 = kolum_quran_ppki($jnssek, $kolkh, "7", $aliran);
            $jiq7p = @($jiq7 / $jumlahbwh) * 100;
            $jiq8 = kolum_quran_ppki($jnssek, $kolkh, "8", $aliran);
            $jiq8p = @($jiq8 / $jumlahbwh) * 100;

            $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
            <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
            <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
            <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
            <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
            <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
            <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

            <td>" . number_format($jumlahbwh) . "</td> 
            </tr>";

            echo "</table>";

            end_analisa();
        }
    }

    if ($mod == "analisaskpk") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK)");

            function kira_khas($jnssek, $thn, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_khas($jnssek, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35)";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
            <td rowspan='2' width='5%' class='bgprime' style='vertical-align: middle !important'>JUMLAH</td>

            </tr>
            <tr class='tengah small boldo'>        

            <td width='5%' class='bgprime'>BIL</td>           
            <td width='5%' class='bgprime'>%</td>       

            </tr>
            ";

            $jenissek = "STATUSMURID IN (33,34,35) AND";
            $jenisseks = "STATUSMURID IN (33,34,35)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'");

                $iq1 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq1p = @($iq1 / $jumlahtepi) * 100;
                } else {
                    $iq1p = "0";
                }
                $iq2 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                } else {
                    $iq2p = "0";
                }

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah ($kod)</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                <td>" . number_format($jumlahtepi) . "</td>
                </tr>";
            }

            $jiq1 = kolum_khas($jnssek, $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            <td>" . number_format($jumlahbwh) . "</td> 
            </tr>";

            echo "</table>";

            end_analisa();

            begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK)");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
            <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ6</td>          
            <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
            <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
            <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
            </tr>
            <tr class='tengah small boldo'>        

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>          

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>         

            </tr>
            ";

            $jenissek = "STATUSMURID IN (33,34,35) AND";
            $jenisseks = "STATUSMURID IN (33,34,35)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_darjah");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek `KODTINGKATAN/TAHUN` = 'D$id'");

                $iq1 = kira_peratus_quran($jnssek, "D$id", $kolkh, "1", $aliran);
                $iq1p = @($iq1 / $jumlahtepi) * 100;
                $iq2 = kira_peratus_quran($jnssek, "D$id", $kolkh, "2", $aliran);
                $iq2p = @($iq2 / $jumlahtepi) * 100;
                $iq3 = kira_peratus_quran($jnssek, "D$id", $kolkh, "3", $aliran);
                $iq3p = @($iq3 / $jumlahtepi) * 100;
                $iq4 = kira_peratus_quran($jnssek, "D$id", $kolkh, "4", $aliran);
                $iq4p = @($iq4 / $jumlahtepi) * 100;
                $iq5 = kira_peratus_quran($jnssek, "D$id", $kolkh, "5", $aliran);
                $iq5p = @($iq5 / $jumlahtepi) * 100;
                $iq6 = kira_peratus_quran($jnssek, "D$id", $kolkh, "6", $aliran);
                $iq6p = @($iq6 / $jumlahtepi) * 100;
                $iq7 = kira_peratus_quran($jnssek, "D$id", $kolkh, "7", $aliran);
                $iq7p = @($iq7 / $jumlahtepi) * 100;
                $iq8 = kira_peratus_quran($jnssek, "D$id", $kolkh, "8", $aliran);
                $iq8p = @($iq8 / $jumlahtepi) * 100;

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
                <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
                <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
                <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
                <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
                <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
                <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

                <td>" . number_format($jumlahtepi) . "</td>
                </tr>";
            }

            $jiq1 = kolum_peratus_quran($jnssek, $kolkh, "1", $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;
            $jiq2 = kolum_peratus_quran($jnssek, $kolkh, "2", $aliran);
            $jiq2p = @($jiq2 / $jumlahbwh) * 100;
            $jiq3 = kolum_peratus_quran($jnssek, $kolkh, "3", $aliran);
            $jiq3p = @($jiq3 / $jumlahbwh) * 100;
            $jiq4 = kolum_peratus_quran($jnssek, $kolkh, "4", $aliran);
            $jiq4p = @($jiq4 / $jumlahbwh) * 100;
            $jiq5 = kolum_peratus_quran($jnssek, $kolkh, "5", $aliran);
            $jiq5p = @($jiq5 / $jumlahbwh) * 100;
            $jiq6 = kolum_peratus_quran($jnssek, $kolkh, "6", $aliran);
            $jiq6p = @($jiq6 / $jumlahbwh) * 100;
            $jiq7 = kolum_peratus_quran($jnssek, $kolkh, "7", $aliran);
            $jiq7p = @($jiq7 / $jumlahbwh) * 100;
            $jiq8 = kolum_peratus_quran($jnssek, $kolkh, "8", $aliran);
            $jiq8p = @($jiq8 / $jumlahbwh) * 100;

            $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
            <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
            <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
            <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
            <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
            <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
            <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

            <td>" . number_format($jumlahbwh) . "</td> 
            </tr>";

            echo "</table>";

            end_analisa();
        }
    }

    if ($mod == "analisaskpkld") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK LD)");

            function kira_khas($jnssek, $thn, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_khas($jnssek, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35)";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
            <td rowspan='2' width='5%' class='bgprime' style='vertical-align: middle !important'>JUMLAH</td>

            </tr>
            <tr class='tengah small boldo'>        

            <td width='5%' class='bgprime'>BIL</td>           
            <td width='5%' class='bgprime'>%</td>       

            </tr>
            ";

            $jenissek = "STATUSMURID IN (33,34,35) AND";
            $jenisseks = "STATUSMURID IN (33,34,35)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "WHERE KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'");

                $iq1 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq1p = @($iq1 / $jumlahtepi) * 100;
                } else {
                    $iq1p = "0";
                }
                $iq2 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                } else {
                    $iq2p = "0";
                }

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah ($kod)</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                <td>" . number_format($jumlahtepi) . "</td>
                </tr>";
            }

            $jiq1 = kolum_khas($jnssek, $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            <td>" . number_format($jumlahbwh) . "</td> 
            </tr>";

            echo "</table>";

            end_analisa();

            begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK LD)");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND KategoriMasalah = '$thn'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (33,34,35,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
            <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ6</td>          


            <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
            <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
            <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
            </tr>
            <tr class='tengah small boldo'>        

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>          

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>         

            </tr>


            ";

            $jenissek = "STATUSMURID IN (33,34,35) AND";
            $jenisseks = "STATUSMURID IN (33,34,35)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'masalah'");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriMasalah = '$kod'");

                $iq1 = kira_peratus_quran($jnssek, $kod, $kolkh, "1", $aliran);
                if ($jumlahtepi != 0) {
                    $iq1p = @($iq1 / $jumlahtepi) * 100;
                } else {
                    $iq1p = "0";
                }
                $iq2 = kira_peratus_quran($jnssek, $kod, $kolkh, "2", $aliran);
                if ($jumlahtepi != 0) {
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                } else {
                    $iq2p = "0";
                }
                $iq3 = kira_peratus_quran($jnssek, $kod, $kolkh, "3", $aliran);
                if ($jumlahtepi != 0) {
                    $iq3p = @($iq3 / $jumlahtepi) * 100;
                } else {
                    $iq3p = "0";
                }
                $iq4 = kira_peratus_quran($jnssek, $kod, $kolkh, "4", $aliran);
                if ($jumlahtepi != 0) {
                    $iq4p = @($iq4 / $jumlahtepi) * 100;
                } else {
                    $iq4p = "0";
                }
                $iq5 = kira_peratus_quran($jnssek, $kod, $kolkh, "5", $aliran);
                if ($jumlahtepi != 0) {
                    $iq5p = @($iq5 / $jumlahtepi) * 100;
                } else {
                    $iq5p = "0";
                }
                $iq6 = kira_peratus_quran($jnssek, $kod, $kolkh, "6", $aliran);
                if ($jumlahtepi != 0) {
                    $iq6p = @($iq6 / $jumlahtepi) * 100;
                } else {
                    $iq6p = "0";
                }
                $iq7 = kira_peratus_quran($jnssek, $kod, $kolkh, "7", $aliran);
                if ($jumlahtepi != 0) {
                    $iq7p = @($iq17 / $jumlahtepi) * 100;
                } else {
                    $iq7p = "0";
                }
                $iq8 = kira_peratus_quran($jnssek, $kod, $kolkh, "8", $aliran);
                if ($jumlahtepi != 0) {
                    $iq8p = @($iq8 / $jumlahtepi) * 100;
                } else {
                    $iq8p = "0";
                }

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
                <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
                <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
                <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
                <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
                <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
                <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

                <td>" . number_format($jumlahtepi) . "</td>
                </tr>";
            }

            $jiq1 = kolum_peratus_quran($jnssek, $kolkh, "1", $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;
            $jiq2 = kolum_peratus_quran($jnssek, $kolkh, "2", $aliran);
            $jiq2p = @($jiq2 / $jumlahbwh) * 100;
            $jiq3 = kolum_peratus_quran($jnssek, $kolkh, "3", $aliran);
            $jiq3p = @($jiq3 / $jumlahbwh) * 100;
            $jiq4 = kolum_peratus_quran($jnssek, $kolkh, "4", $aliran);
            $jiq4p = @($jiq4 / $jumlahbwh) * 100;
            $jiq5 = kolum_peratus_quran($jnssek, $kolkh, "5", $aliran);
            $jiq5p = @($jiq5 / $jumlahbwh) * 100;
            $jiq6 = kolum_peratus_quran($jnssek, $kolkh, "6", $aliran);
            $jiq6p = @($jiq6 / $jumlahbwh) * 100;
            $jiq7 = kolum_peratus_quran($jnssek, $kolkh, "7", $aliran);
            $jiq7p = @($jiq7 / $jumlahbwh) * 100;
            $jiq8 = kolum_peratus_quran($jnssek, $kolkh, "8", $aliran);
            $jiq8p = @($jiq8 / $jumlahbwh) * 100;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
            <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
            <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
            <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
            <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
            <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
            <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

            <td>" . number_format($jumlahbwh) . "</td> 
            </tr>";

            echo "</table>";

            end_analisa();
        }
    }

    if ($mod == "analisask") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN SK<br>$tajuk");

            function kira_analisa($kodsekolah, $jns, $thn, $aliran)
            {

                global $level, $koljawi, $kolba, $kolkh, $cn;

                if ($jns == "2") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207)) AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "1") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207)) AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "3") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207)) AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "4") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207)) AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "6") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207)) AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "5") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207)) AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }
            }

            analisapencapaian("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207))");

            end_analisa();

            begin_analisa("ANALISIS PENCAPAIAN AL-QURAN");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101,102,207))");

            end_analisa();
        }
    }

    if ($mod == "analisasjkc") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN SJKC<br>$tajuk");

            function kira_analisa($kodsekolah, $jns, $thn, $aliran)
            {

                global $level, $koljawi, $kolba, $kolkh, $cn;

                if ($jns == "2") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103)) AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "1") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103)) AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "3") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103)) AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "4") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103)) AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "6") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103)) AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "5") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103)) AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }
            }

            analisapencapaian("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103))");

            end_analisa();

            begin_analisa("ANALISIS PENCAPAIAN AL-QURAN");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103))");

            end_analisa();
        }
    }

    if ($mod == "analisasjkt") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN SJKT<br>$tajuk");

            function kira_analisa($kodsekolah, $jns, $thn, $aliran)
            {

                global $level, $koljawi, $kolba, $kolkh, $cn;

                if ($jns == "2") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104)) AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "1") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104)) AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "3") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104)) AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "4") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104)) AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "6") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104)) AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "5") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104)) AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }
            }

            analisapencapaian("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104))");

            end_analisa();

            begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT TAHUN");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104))");

            end_analisa();
        }
    }

    if ($mod == "analisaskasli") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN SK ASLI<br>$tajuk");

            function kira_analisa($kodsekolah, $jns, $thn, $aliran)
            {

                global $level, $koljawi, $kolba, $kolkh, $cn;

                if ($jns == "2") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108)) AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "1") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108)) AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "3") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108)) AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "4") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108)) AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "6") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108)) AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "5") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108)) AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }
            }
        }

        analisapencapaian("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108))");

        end_analisa();

        begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT TAHUN");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
        {

            global $kodsekolah, $level, $kolms, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            if ($juz == 1) {
                $juzbrp = "$kolms < 102";
            } elseif ($juz == 2) {
                $juzbrp = "$kolms > 101 AND $kolms < 201";
            } elseif ($juz == 3) {
                $juzbrp = "$kolms > 200 AND $kolms < 302";
            } elseif ($juz == 4) {
                $juzbrp = "$kolms > 301 AND $kolms < 402";
            } elseif ($juz == 5) {
                $juzbrp = "$kolms > 401 AND $kolms < 502";
            } elseif ($juz == 6) {
                $juzbrp = "$kolms > 501 AND $kolms <= 604";
            }

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108))");

        end_analisa();
    }

    if ($mod == "analisasabk") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' style='opacity:1' src=\"$img\">";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN SABK<br>$tajuk");

            function kira_analisa($kodsekolah, $jns, $thn, $aliran)
            {

                global $level, $koljawi, $kolba, $kolkh, $cn;

                if ($jns == "2") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107)) AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "1") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107)) AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "3") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107)) AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "4") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107)) AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "6") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107)) AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }

                if ($jns == "5") {

                    $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                    $bilangan = get_row_count("tdatajqaf", "$level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107)) AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                    if ($bilangan > 0) {

                        return $bilangan;
                    } else {

                        return "0";
                    }
                }
            }
        }

        analisapencapaian("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107))");

        end_analisa();

        begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT TAHUN");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
        {

            global $kodsekolah, $level, $kolms, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            if ($juz == 1) {
                $juzbrp = "$kolms < 102";
            } elseif ($juz == 2) {
                $juzbrp = "$kolms > 101 AND $kolms < 201";
            } elseif ($juz == 3) {
                $juzbrp = "$kolms > 200 AND $kolms < 302";
            } elseif ($juz == 4) {
                $juzbrp = "$kolms > 301 AND $kolms < 402";
            } elseif ($juz == 5) {
                $juzbrp = "$kolms > 401 AND $kolms < 502";
            } elseif ($juz == 6) {
                $juzbrp = "$kolms > 501 AND $kolms <= 604";
            }

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (107))");

        end_analisa();
    }

    echo "</div></div>";

    $mem = memory_get_usage();
    echo "<div align='center'>Skrip dijana dalam masa " . number_format(microtime(true) - $_SERVER["REQUEST_TIME_FLOAT"]) . " saat.
    <div>" . mksize($mem) . "</div></div>";
    echo "$bgtau";
}

if ($_POST['mode'] == "tgkanalisa") {

    $kutipan = $SETTINGS["namakutipan"];
    $mod = $_POST['mod'];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    function markahkhatam($tahun, $level)
    {

        global $con, $kolms, $kolq;

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $t = mysqli_query($con, "SELECT *, (((((IF($kolms > $silibus, '$silibus', $kolms)/$silibus)*60)/60) * 40)+(($kolq/40)*60)) AS markah, 59.99 FROM `tdatajqaf` $level AND `KODTINGKATAN/TAHUN` = '$tahun' HAVING markah > 59.99");
        $tt = mysqli_num_rows($t);
        return $tt;
    }

    $thn = date('Y');
    $jnssek = infoAwan($CURUSER[sekolah], "jenis", "ep_sekolah");
    $kodsekolah = infoSekolah($CURUSER[sekolah], "kod");

    if ($CURUSER["class"] == "2") {

        $aliran = infoAwan($CURUSER[sekolah], "statuskhas", "ep_sekolah");
        //$aliran = "2";
        $level = "WHERE KODSEK = '$kodsekolah' AND SB6 = '1'";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $level = "WHERE CatatPlakuOkt = '$ppd' AND SB6 = '1'";
        $aliran = "-1";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "1";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);

        $level = "WHERE CatatPlakuJun = '$kodneg' AND SB6 = '1'";
        $aliran = "-1";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "1";
    } elseif ($CURUSER["class"] > "4") {

        $level = "WHERE SB6 = '1'";
        $aliran = "-1";
        $tajuk = "KEBANGSAAN";
        $guna = $CURUSER["username"];
        $ch = "1";
    }

    echo "<div align='center'><div id='cetakanalisa' style='padding:10px;width:100%'>";
    echo "<div class='row' id='headeranalisa' style='margin-bottom:10px;padding-bottom:10px; border-bottom:1px solid black'>
    <div class='col-md-4'><img width='250' src='images/logokpm.png'></div>
    <div class='col-md-4' style='text-align:center;font-weight:bold;font-size:16px'>LAPORAN PENCAPAIAN PROGRAM j-QAF<br>KEMENTERIAN PENDIDIKAN MALAYSIA<br>$ukutipan 2019</div>
    <div class='col-md-4'></div>
    </div>";

    if ($mod == "kbs") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MURID MENGIKUT ITEM SOLAT<br>$tajuk");

            function kira_solat($thn, $kolum, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31)";

                $bilangan = get_row_count("tdatajqaf", "$level AND `KODTINGKATAN/TAHUN` = '$thn' AND KODAGAMA = '01' AND `$kolum` = '1' AND $jenissek");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_solat($kolum, $aliran)
            {

                global $kodsekolah, $level;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31)";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND `$kolum` = '1' AND $jenissek");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisakbs();

            end_analisa();
        }
    }

    if ($mod == "khatam") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("ANALISIS PENCAPAIAN AL-QURAN<br>$tajuk");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran();

            end_analisa();
        }
    }

    if ($mod == "khatamsk") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MODEL KHATAM AL-QURAN DAN MODEL TASMIK SK, SRK DAN MODEL KHAS<br>$tajuk");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (101))");

            end_analisa();
        }
    }

    if ($mod == "khatamsjkc") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MODEL KHATAM AL-QURAN DAN MODEL TASMIK SJKC<br>$tajuk");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (103))");

            end_analisa();
        }
    }

    if ($mod == "khatamsjkt") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MODEL KHATAM AL-QURAN DAN MODEL TASMIK SJKT<br>$tajuk");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (104))");

            end_analisa();
        }
    }

    if ($mod == "khatamasli") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MODEL KHATAM AL-QURAN DAN MODEL TASMIK SK ASLI DAN K9<br>$tajuk");

            function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
            {

                global $kodsekolah, $level, $kolms, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                if ($juz == 1) {
                    $juzbrp = "$kolms < 102";
                } elseif ($juz == 2) {
                    $juzbrp = "$kolms > 101 AND $kolms < 201";
                } elseif ($juz == 3) {
                    $juzbrp = "$kolms > 200 AND $kolms < 302";
                } elseif ($juz == 4) {
                    $juzbrp = "$kolms > 301 AND $kolms < 402";
                } elseif ($juz == 5) {
                    $juzbrp = "$kolms > 401 AND $kolms < 502";
                } elseif ($juz == 6) {
                    $juzbrp = "$kolms > 501 AND $kolms <= 604";
                }

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_peratus_quran($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level $jnssek AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaquran("AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN (106,108))");

            end_analisa();
        }
    }

    if ($mod == "khatamkhas") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$mod0'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("PENCAPAIAN MODEL KHATAM AL-QURAN DAN MODEL TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)<br>$tajuk");

            function kira_quran_ppki($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND KategoriKhas = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_quran_ppki($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
            <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
            <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
            <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
            <td width='5%' colspan='2' class='bgprime'>IQ6</td>          
            <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
            <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
            <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
            </tr>
            <tr class='tengah small boldo'>        

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>          

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td> 

            <td width='2%' class='bgprime'>M</td>           
            <td width='2%' class='bgprime'>%</td>         

            </tr>
            ";

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
            $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam'");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

                $iq1 = kira_quran_ppki($jnssek, $kod, $kolkh, "1", $aliran);
                $iq1p = @($iq1 / $jumlahtepi) * 100;
                $iq2 = kira_quran_ppki($jnssek, $kod, $kolkh, "2", $aliran);
                $iq2p = @($iq2 / $jumlahtepi) * 100;
                $iq3 = kira_quran_ppki($jnssek, $kod, $kolkh, "3", $aliran);
                $iq3p = @($iq3 / $jumlahtepi) * 100;
                $iq4 = kira_quran_ppki($jnssek, $kod, $kolkh, "4", $aliran);
                $iq4p = @($iq4 / $jumlahtepi) * 100;
                $iq5 = kira_quran_ppki($jnssek, $kod, $kolkh, "5", $aliran);
                $iq5p = @($iq5 / $jumlahtepi) * 100;
                $iq6 = kira_quran_ppki($jnssek, $kod, $kolkh, "6", $aliran);
                $iq6p = @($iq6 / $jumlahtepi) * 100;
                $iq7 = kira_quran_ppki($jnssek, $kod, $kolkh, "7", $aliran);
                $iq7p = @($iq7 / $jumlahtepi) * 100;
                $iq8 = kira_quran_ppki($jnssek, $kod, $kolkh, "8", $aliran);
                $iq8p = @($iq8 / $jumlahtepi) * 100;

                echo "<tr class='tengah small'>
                <td style='text-align:left'>$darjah</td>
                <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
                <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
                <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
                <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
                <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
                <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
                <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
                <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

                <td>" . number_format($jumlahtepi) . "</td>
                </tr>";
            }

            $jiq1 = kolum_quran_ppki($jnssek, $kolkh, "1", $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;
            $jiq2 = kolum_quran_ppki($jnssek, $kolkh, "2", $aliran);
            $jiq2p = @($jiq2 / $jumlahbwh) * 100;
            $jiq3 = kolum_quran_ppki($jnssek, $kolkh, "3", $aliran);
            $jiq3p = @($jiq3 / $jumlahbwh) * 100;
            $jiq4 = kolum_quran_ppki($jnssek, $kolkh, "4", $aliran);
            $jiq4p = @($jiq4 / $jumlahbwh) * 100;
            $jiq5 = kolum_quran_ppki($jnssek, $kolkh, "5", $aliran);
            $jiq5p = @($jiq5 / $jumlahbwh) * 100;
            $jiq6 = kolum_quran_ppki($jnssek, $kolkh, "6", $aliran);
            $jiq6p = @($jiq6 / $jumlahbwh) * 100;
            $jiq7 = kolum_quran_ppki($jnssek, $kolkh, "7", $aliran);
            $jiq7p = @($jiq7 / $jumlahbwh) * 100;
            $jiq8 = kolum_quran_ppki($jnssek, $kolkh, "8", $aliran);
            $jiq8p = @($jiq8 / $jumlahbwh) * 100;

            $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

            echo "<tr class='bgprime tengah small'>
            <td style='text-align:left'>JUMLAH KESELURUHAN</td>
            <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
            <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
            <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
            <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
            <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
            <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
            <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
            <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

            <td>" . number_format($jumlahbwh) . "</td> 
            </tr>";

            echo "</table>";

            end_analisa();
        }
    }

    if ($mod == "jawi") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("ANALISIS PENCAPAIAN JAWI<br>$tajuk");

            function kira_jawi($thn, $val)
            {

                global $koljawi, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $val AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_jawi($val)
            {

                global $koljawi, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $val", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisajawi();

            end_analisa();
        }
    }

    if ($mod == "arab") {

        $modo = $mod . $guna;

        $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

        if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

            $img = getImage($mod);

            echo "<img width='100%' src=\"$img\" style='opacity:1'>";
            $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
        } else {

            begin_analisa("ANALISIS PENCAPAIAN BAHASA ARAB<br>$tajuk");

            function kira_arab($thn, $val)
            {

                global $kolba, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND $jenissek $val AND KODBAHASA = '1' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_arab($val)
            {

                global $kolba, $level, $cn;

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODBAHASA = '1' AND $jenissek $val", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            analisaarab();

            end_analisa();
        }
    }

    echo "</div></div>";

    $mem = memory_get_usage();
    echo "<div align='center'>Skrip dijana dalam masa " . number_format(microtime(true) - $_SERVER["REQUEST_TIME_FLOAT"]) . " saat.
    <div>" . mksize($mem) . "</div></div>";
    echo "$bgtau";
}

if ($_POST['mode'] == "analisappd") {

    $kutipan = $SETTINGS["namakutipan"];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    function markahkhatam($tahun, $level)
    {

        global $con, $kolms, $kolq;

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $t = mysqli_query($con, "SELECT *, (((((IF($kolms > $silibus, '$silibus', $kolms)/$silibus)*60)/60) * 40)+(($kolq/40)*60)) AS markah, 59.99 FROM `tdatajqaf` $level AND `KODTINGKATAN/TAHUN` = '$tahun' HAVING markah > 59.99");
        $tt = mysqli_num_rows($t);
        return $tt;
    }

    function markahkhatamsek($tahun, $level, $jnssek)
    {

        global $con, $kolms, $kolq;

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $t = mysqli_query($con, "SELECT *, (((((IF($kolms > $silibus, '$silibus', $kolms)/$silibus)*60)/60) * 40)+(($kolq/40)*60)) AS markah, 59.99 FROM `tdatajqaf` $level AND KODSEK IN (SELECT KODSEK FROM tdatasekolah WHERE JENISSEK IN ($jnssek)) AND `KODTINGKATAN/TAHUN` = '$tahun' HAVING markah > 59.99");
        $tt = mysqli_num_rows($t);
        return $tt;
    }

    $thn = date('Y');

    $ppd = $_POST['ppd'];
    $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");
    $namappd = infoAwan($ppd, "nama", "ep_ppd");
    $level = "WHERE CatatPlakuOkt = '$kodppd' AND SB6 = '1'";
    $aliran = "-1";

    $mod = $kodppd;

    echo "<div align='center'><span style='position:absolute;top:50px;right:30px'><a target='_blank' class='btn btn-success' href='cetakpdf.php?mode=cetak&kat=ppd&idsek=$ppd&deta=tdatajqaf'>CETAK</a></span><div id='cetakanalisa' style='width:100%'>";
    echo "<div id='headeranalisa' class='row' style='margin-bottom:10px;padding-bottom:10px; border-bottom:1px solid black'>
    <div class='col-md-4'><img width='250' src='images/logokpm.png'></div>
    <div class='col-md-5' style='text-align:center;font-weight:bold;font-size:16px'>LAPORAN PENCAPAIAN PROGRAM j-QAF<br>KEMENTERIAN PENDIDIKAN MALAYSIA<br>$ukutipan $uyear</div>
    <div class='col-md-3'></div>
    </div>";

    $modo = $mod;

    $cache = get_row_count("ep_cache", "WHERE kod = '$modo'");

    if ($cache > 0) {

        ?>
<script>
$(function() {
    $("#headeranalisa").remove();
})
</script>
<?

        $img = getImage($mod);

        echo "<img width='100%' style='opacity:1' src=\"$img\">";

        $bgtau = "<div style='background:#fbe9e7; text-align:center; border-radius:10px; font-size:11px; padding:5px'>Paparan ini adalah paparan cache analisa. <a onclick='buangcache(\"$modo\")' class='btn btn-danger btn-sm'>Jana Semula</a></div>";
    } else {

        begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN (PERDANA)<br>$namappd");

        function kira_analisa($kodsekolah, $jns, $thn, $aliran)
        {

            global $level, $koljawi, $kolba, $kolkh, $cn;

            if ($jns == "2") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "1") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "3") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "4") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "6") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "5") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }
        }

        analisapencapaian();

        end_analisa();

        begin_analisa("ANALISIS PENCAPAIAN AL-QURAN");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
        {

            global $kodsekolah, $level, $kolms, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            if ($juz == 1) {
                $juzbrp = "$kolms < 102";
            } elseif ($juz == 2) {
                $juzbrp = "$kolms > 101 AND $kolms < 201";
            } elseif ($juz == 3) {
                $juzbrp = "$kolms > 200 AND $kolms < 302";
            } elseif ($juz == 4) {
                $juzbrp = "$kolms > 301 AND $kolms < 402";
            } elseif ($juz == 5) {
                $juzbrp = "$kolms > 401 AND $kolms < 502";
            } elseif ($juz == 6) {
                $juzbrp = "$kolms > 501 AND $kolms <= 604";
            }

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        analisaquran();

        end_analisa();
    }
}

if ($_POST['mode'] == "paparanalisa") {

    $idsek = $_POST['idsek'];
    $deta = $_POST['deta'];
    $jns = $_POST['jenis'];

    $kutipan = $SETTINGS["namakutipan"];

    echo "<div class='container' style='overflow-y:auto; height:600px'>";

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        if ($deta == "tdatajqaf_jun2019") {

            $koljawi = "JW3";
            $kolba = "BA1";
            $kolkh = "KH1";
            $kolms = "KH2";
            $kolq = "KH5";
        } else {

            $koljawi = "JW4";
            $kolba = "BA2";
            $kolkh = "KH3";
            $kolms = "KH4";
            $kolq = "KH6";
        }
    }

    function markahkhatam($tahun, $level)
    {

        global $con, $kolms, $kolq;

        if ($tahun == "D2") {
            $silibus = "120";
        } elseif ($tahun == "D3") {
            $silibus = "241";
        } elseif ($tahun == "D4") {
            $silibus = "362";
        } elseif ($tahun == "D5") {
            $silibus = "482";
        } elseif ($tahun == "D6") {
            $silibus = "604";
        }

        $t = mysqli_query($con, "SELECT *, (((((IF($kolms > $silibus, '$silibus', $kolms)/$silibus)*60)/60) * 40)+(($kolq/40)*60)) AS markah, 59.99 FROM `$deta` $level AND `KODTINGKATAN/TAHUN` = '$tahun' HAVING markah > 59.99");
        $tt = mysqli_num_rows($t);
        return $tt;
    }

    $thn = date('Y');
    $jnssek = infoAwan($idsek, "jenis", "ep_sekolah");
    $kodsekolah = infoSekolah($idsek, "kod");
    $nmsekolah = infoSekolah($idsek, "nama");

    $aliran = infoAwan($idsek, "statuskhas", "ep_sekolah");
    //$aliran = "2";
    $level = "WHERE KODSEK = '$kodsekolah' AND SB6 = '1'";

    /*if ($CURUSER["class"] == "2") {

    $aliran = infoAwan($CURUSER[sekolah], "statuskhas", "ep_sekolah");
    //$aliran = "2";
    $level = "WHERE KODSEK = '$kodsekolah' AND SB6 = '1'";

    } elseif ($CURUSER["class"] == "3") {

    $ppd = $CURUSER['username'];
    $level = "LEFT JOIN tdatasekolah ON tdatajqaf.KODSEK = tdatasekolah.KODSEK WHERE PPD = '$ppd' AND SB6 = '1'";
    $aliran = "-1";

    } elseif ($CURUSER["class"] == "4") {

    $neg = $CURUSER['negeri'];
    $kodneg = sprintf("%02d", $neg);

    $level = "LEFT JOIN tdatasekolah ON tdatajqaf.KODSEK = tdatasekolah.KODSEK WHERE NEGERI = '$kodneg' AND SB6 = '1'";
    $aliran = "-1";

    }  */

    if ($deta == "tdatajqaf") {

        $tjk = "OKT 2019";
    } elseif ($deta == "tdatajqaf_jun2019") {

        $tjk = "JUN 2019";
    } elseif ($deta == "tdatajqaf_okt2018") {

        $tjk = "OKT 2018";
    } elseif ($deta == "tdatajqaf_jun2018") {

        $tjk = "JUN 2018";
    }

    if ($aliran == "-1" || $aliran == "0") {

        begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN (PERDANA)<br>$nmsekolah<br>$tjk");

        function kira_analisa($kodsekolah, $jns, $thn, $aliran)
        {

            global $level, $koljawi, $deta, $kolba, $kolkh, $cn;

            if ($jns == "2") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "1") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "3") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("$deta", "$level AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "4") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "6") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "5") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }
        }

        analisapencapaian("", "", $deta);

        end_analisa();

        begin_analisa("ANALISIS PENCAPAIAN AL-QURAN");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $cn, $deta;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
        {

            global $kodsekolah, $level, $deta, $kolms, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            if ($juz == 1) {
                $juzbrp = "$kolms < 102";
            } elseif ($juz == 2) {
                $juzbrp = "$kolms > 101 AND $kolms < 201";
            } elseif ($juz == 3) {
                $juzbrp = "$kolms > 200 AND $kolms < 302";
            } elseif ($juz == 4) {
                $juzbrp = "$kolms > 301 AND $kolms < 402";
            } elseif ($juz == 5) {
                $juzbrp = "$kolms > 401 AND $kolms < 502";
            } elseif ($juz == 6) {
                $juzbrp = "$kolms > 501 AND $kolms <= 604";
            }

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $deta, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $deta, $level, $cn;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        analisaquran("", $deta);

        end_analisa();

        /* begin_analisa("ANALISIS PENCAPAIAN JAWI<br>$tajuk");  

        function kira_jawi($thn,$val) {

        global $koljawi, $level;

        $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

        $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $val AND `KODTINGKATAN/TAHUN` = '$thn'");

        if ($bilangan > 0) {

        return $bilangan;

        } else {

        return "0";
        }

        }

        function kolum_jawi($val) {

        global $koljawi, $level;

        $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

        $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $val");

        if ($bilangan > 0) {

        return $bilangan;

        } else {

        return "0";
        }

        }

        analisajawi();

        end_analisa();

        begin_analisa("ANALISIS PENCAPAIAN BAHASA ARAB<br>$tajuk");  

        function kira_arab($thn,$val) {

        global $kolba, $level;

        $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

        $bilangan = get_row_count("tdatajqaf", "$level AND $jenissek $val AND `KODTINGKATAN/TAHUN` = '$thn'");

        if ($bilangan > 0) {

        return $bilangan;

        } else {

        return "0";
        }

        }

        function kolum_arab($val) {

        global $kolba, $level;

        $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

        $bilangan = get_row_count("tdatajqaf", "$level AND $jenissek $val");

        if ($bilangan > 0) {

        return $bilangan;

        } else {

        return "0";
        }

        }

        analisaarab();

        end_analisa();*/
    }

    if ($aliran == "0") {

        begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)");

        function kira_khas($jnssek, $thn, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_khas($jnssek, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (32,36,37,38,40)";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
        <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
        <td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
        </tr>
        <tr class='tengah small boldo'>        

        <td width='5%' class='bgprime'>BIL</td>           
        <td width='5%' class='bgprime'>%</td>       

        </tr>
        ";

        $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
        $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

        $jumlahbwh = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

        $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

            $iq1 = kira_khas($jnssek, $kod, $aliran);
            $iq1p = @($iq1 / $jumlahbwh) * 100;
            $iq2 = kira_khas($jnssek, $kod, $aliran);
            $iq2p = @($iq2 / $jumlahbwh) * 100;

            echo "<tr class='tengah small'>
            <td style='text-align:left'>$darjah ($kod)</td>
            <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
            </tr>";
        }

        $jiq1 = kolum_khas($jnssek, $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;

        echo "<tr class='bgprime tengah small'>
        <td style='text-align:left'>JUMLAH KESELURUHAN</td>
        <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
        </tr>";

        echo "</table>";

        end_analisa();
    } elseif ($aliran == "1") {

        begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK)");

        function kira_khas($jnssek, $thn, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_khas($jnssek, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40)";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
        <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
        <td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
        <td rowspan='2' width='5%' class='bgprime' style='vertical-align: middle !important'>JUMLAH</td>

        </tr>
        <tr class='tengah small boldo'>        

        <td width='5%' class='bgprime'>BIL</td>           
        <td width='5%' class='bgprime'>%</td>       

        </tr>
        ";

        $jenissek = "STATUSMURID IN (33,34,35,40) AND";
        $jenisseks = "STATUSMURID IN (33,34,35,40)";

        $jumlahbwh = get_row_count("$deta", "$level AND $jenisseks", $cn);

        $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

            $iq1 = kira_khas($jnssek, $kod, $aliran);
            $iq1p = @($iq1 / $jumlahtepi) * 100;
            $iq2 = kira_khas($jnssek, $kod, $aliran);
            $iq2p = @($iq2 / $jumlahtepi) * 100;

            echo "<tr class='tengah small'>
            <td style='text-align:left'>$darjah ($kod)</td>
            <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
            <td>" . number_format($jumlahtepi) . "</td>
            </tr>";
        }

        $jiq1 = kolum_khas($jnssek, $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;

        echo "<tr class='bgprime tengah small'>
        <td style='text-align:left'>JUMLAH KESELURUHAN</td>
        <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
        <td>" . number_format($jumlahbwh) . "</td> 
        </tr>";

        echo "</table>";

        end_analisa();
    } elseif ($aliran == "2") {

        begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK LD)");

        function kira_khas($jnssek, $thn, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_khas($jnssek, $aliran)
        {

            global $kodsekolah, $deta, $level, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40)";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
        <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
        <td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
        <td rowspan='2' width='5%' class='bgprime' style='vertical-align: middle !important'>JUMLAH</td>

        </tr>
        <tr class='tengah small boldo'>        

        <td width='5%' class='bgprime'>BIL</td>           
        <td width='5%' class='bgprime'>%</td>       

        </tr>
        ";

        $jenissek = "STATUSMURID IN (33,34,35,40) AND";
        $jenisseks = "STATUSMURID IN (33,34,35,40)";

        $jumlahbwh = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks", $cn);

        $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("$deta", "WHERE KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

            $iq1 = kira_khas($jnssek, $kod, $aliran);
            $iq1p = @($iq1 / $jumlahtepi) * 100;
            $iq2 = kira_khas($jnssek, $kod, $aliran);
            $iq2p = @($iq2 / $jumlahtepi) * 100;

            echo "<tr class='tengah small'>
            <td style='text-align:left'>$darjah ($kod)</td>
            <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
            <td>" . number_format($jumlahtepi) . "</td>
            </tr>";
        }

        $jiq1 = kolum_khas($jnssek, $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;

        echo "<tr class='bgprime tengah small'>
        <td style='text-align:left'>JUMLAH KESELURUHAN</td>
        <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
        <td>" . number_format($jumlahbwh) . "</td> 
        </tr>";

        echo "</table>";

        end_analisa();
    }

    /* Pencapaian Murid */

    if ($aliran == "0") {

        begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)");

        function kira_quran_ppki($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND KategoriKhas = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_quran_ppki($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
        <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
        <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
        <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ6</td>          
        <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
        <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
        <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
        </tr>
        <tr class='tengah small boldo'>        

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td>          

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td>         

        </tr>
        ";

        $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
        $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

        $jumlahbwh = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks", $cn);

        $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam'");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

            $iq1 = kira_quran_ppki($jnssek, $kod, $kolkh, "1", $aliran);
            $iq1p = @($iq1 / $jumlahtepi) * 100;
            $iq2 = kira_quran_ppki($jnssek, $kod, $kolkh, "2", $aliran);
            $iq2p = @($iq2 / $jumlahtepi) * 100;
            $iq3 = kira_quran_ppki($jnssek, $kod, $kolkh, "3", $aliran);
            $iq3p = @($iq3 / $jumlahtepi) * 100;
            $iq4 = kira_quran_ppki($jnssek, $kod, $kolkh, "4", $aliran);
            $iq4p = @($iq4 / $jumlahtepi) * 100;
            $iq5 = kira_quran_ppki($jnssek, $kod, $kolkh, "5", $aliran);
            $iq5p = @($iq5 / $jumlahtepi) * 100;
            $iq6 = kira_quran_ppki($jnssek, $kod, $kolkh, "6", $aliran);
            $iq6p = @($iq6 / $jumlahtepi) * 100;
            $iq7 = kira_quran_ppki($jnssek, $kod, $kolkh, "7", $aliran);
            $iq7p = @($iq7 / $jumlahtepi) * 100;
            $iq8 = kira_quran_ppki($jnssek, $kod, $kolkh, "8", $aliran);
            $iq8p = @($iq8 / $jumlahtepi) * 100;

            echo "<tr class='tengah small'>
            <td style='text-align:left'>$darjah</td>
            <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
            <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
            <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
            <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
            <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
            <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
            <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
            <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

            <td>" . number_format($jumlahtepi) . "</td>
            </tr>";
        }

        $jiq1 = kolum_quran_ppki($jnssek, $kolkh, "1", $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;
        $jiq2 = kolum_quran_ppki($jnssek, $kolkh, "2", $aliran);
        $jiq2p = @($jiq2 / $jumlahbwh) * 100;
        $jiq3 = kolum_quran_ppki($jnssek, $kolkh, "3", $aliran);
        $jiq3p = @($jiq3 / $jumlahbwh) * 100;
        $jiq4 = kolum_quran_ppki($jnssek, $kolkh, "4", $aliran);
        $jiq4p = @($jiq4 / $jumlahbwh) * 100;
        $jiq5 = kolum_quran_ppki($jnssek, $kolkh, "5", $aliran);
        $jiq5p = @($jiq5 / $jumlahbwh) * 100;
        $jiq6 = kolum_quran_ppki($jnssek, $kolkh, "6", $aliran);
        $jiq6p = @($jiq6 / $jumlahbwh) * 100;
        $jiq7 = kolum_quran_ppki($jnssek, $kolkh, "7", $aliran);
        $jiq7p = @($jiq7 / $jumlahbwh) * 100;
        $jiq8 = kolum_quran_ppki($jnssek, $kolkh, "8", $aliran);
        $jiq8p = @($jiq8 / $jumlahbwh) * 100;

        $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

        echo "<tr class='bgprime tengah small'>
        <td style='text-align:left'>JUMLAH KESELURUHAN</td>
        <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
        <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
        <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
        <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
        <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
        <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
        <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
        <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

        <td>" . number_format($jumlahbwh) . "</td> 
        </tr>";

        echo "</table>";

        end_analisa();
    } elseif ($aliran == "1") {

        begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK)");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $leve, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
        <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
        <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
        <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ6</td>          
        <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
        <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
        <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
        </tr>
        <tr class='tengah small boldo'>        

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td>          

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td>         

        </tr>
        ";

        $jenissek = "STATUSMURID IN (33,34,35,40) AND";
        $jenisseks = "STATUSMURID IN (33,34,35,40)";

        $jumlahbwh = get_row_count("$deta", "$level KODAGAMA = '01' AND SB6 = '1' AND $jenisseks", $cn);

        $kcc = mysqli_query($con, "SELECT * FROM ep_darjah");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek `KODTINGKATAN/TAHUN` = 'D$id'", $cn);

            $iq1 = kira_peratus_quran($jnssek, "D$id", $kolkh, "1", $aliran);
            $iq1p = @($iq1 / $jumlahtepi) * 100;
            $iq2 = kira_peratus_quran($jnssek, "D$id", $kolkh, "2", $aliran);
            $iq2p = @($iq2 / $jumlahtepi) * 100;
            $iq3 = kira_peratus_quran($jnssek, "D$id", $kolkh, "3", $aliran);
            $iq3p = @($iq3 / $jumlahtepi) * 100;
            $iq4 = kira_peratus_quran($jnssek, "D$id", $kolkh, "4", $aliran);
            $iq4p = @($iq4 / $jumlahtepi) * 100;
            $iq5 = kira_peratus_quran($jnssek, "D$id", $kolkh, "5", $aliran);
            $iq5p = @($iq5 / $jumlahtepi) * 100;
            $iq6 = kira_peratus_quran($jnssek, "D$id", $kolkh, "6", $aliran);
            $iq6p = @($iq6 / $jumlahtepi) * 100;
            $iq7 = kira_peratus_quran($jnssek, "D$id", $kolkh, "7", $aliran);
            $iq7p = @($iq7 / $jumlahtepi) * 100;
            $iq8 = kira_peratus_quran($jnssek, "D$id", $kolkh, "8", $aliran);
            $iq8p = @($iq8 / $jumlahtepi) * 100;

            echo "<tr class='tengah small'>
            <td style='text-align:left'>$darjah</td>
            <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
            <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
            <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
            <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
            <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
            <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
            <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
            <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

            <td>" . number_format($jumlahtepi) . "</td>
            </tr>";
        }

        $jiq1 = kolum_peratus_quran($jnssek, $kolkh, "1", $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;
        $jiq2 = kolum_peratus_quran($jnssek, $kolkh, "2", $aliran);
        $jiq2p = @($jiq2 / $jumlahbwh) * 100;
        $jiq3 = kolum_peratus_quran($jnssek, $kolkh, "3", $aliran);
        $jiq3p = @($jiq3 / $jumlahbwh) * 100;
        $jiq4 = kolum_peratus_quran($jnssek, $kolkh, "4", $aliran);
        $jiq4p = @($jiq4 / $jumlahbwh) * 100;
        $jiq5 = kolum_peratus_quran($jnssek, $kolkh, "5", $aliran);
        $jiq5p = @($jiq5 / $jumlahbwh) * 100;
        $jiq6 = kolum_peratus_quran($jnssek, $kolkh, "6", $aliran);
        $jiq6p = @($jiq6 / $jumlahbwh) * 100;
        $jiq7 = kolum_peratus_quran($jnssek, $kolkh, "7", $aliran);
        $jiq7p = @($jiq7 / $jumlahbwh) * 100;
        $jiq8 = kolum_peratus_quran($jnssek, $kolkh, "8", $aliran);
        $jiq8p = @($jiq8 / $jumlahbwh) * 100;

        $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

        echo "<tr class='bgprime tengah small'>
        <td style='text-align:left'>JUMLAH KESELURUHAN</td>
        <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
        <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
        <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
        <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
        <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
        <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
        <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
        <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

        <td>" . number_format($jumlahbwh) . "</td> 
        </tr>";

        echo "</table>";

        end_analisa();
    } //skpk 

    elseif ($aliran == "2") { //skpk + skpk ld

        begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK LD)");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND KategoriMasalah = '$thn'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level, $deta, $cn;

            $jenissek = "STATUSMURID IN (33,34,35,40) AND";

            $bilangan = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
        <td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
        <td width='5%' colspan='2' class='bgprime'>IQ1</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ2</td>           
        <td width='5%' colspan='2' class='bgprime'>IQ3</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ4</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ5</td>          
        <td width='5%' colspan='2' class='bgprime'>IQ6</td>          
        <td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
        <td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
        <td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
        </tr>
        <tr class='tengah small boldo'>        

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td>          

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td> 

        <td width='2%' class='bgprime'>M</td>           
        <td width='2%' class='bgprime'>%</td>         

        </tr>
        ";

        $jenissek = "STATUSMURID IN (33,34,35,40) AND";
        $jenisseks = "STATUSMURID IN (33,34,35,40)";

        $jumlahbwh = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks", $cn);

        $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'masalah'");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("$deta", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriMasalah = '$kod'", $cn);

            $iq1 = kira_peratus_quran($jnssek, $kod, $kolkh, "1", $aliran);
            $iq1p = @($iq1 / $jumlahtepi) * 100;
            $iq2 = kira_peratus_quran($jnssek, $kod, $kolkh, "2", $aliran);
            $iq2p = @($iq2 / $jumlahtepi) * 100;
            $iq3 = kira_peratus_quran($jnssek, $kod, $kolkh, "3", $aliran);
            $iq3p = @($iq3 / $jumlahtepi) * 100;
            $iq4 = kira_peratus_quran($jnssek, $kod, $kolkh, "4", $aliran);
            $iq4p = @($iq4 / $jumlahtepi) * 100;
            $iq5 = kira_peratus_quran($jnssek, $kod, $kolkh, "5", $aliran);
            $iq5p = @($iq5 / $jumlahtepi) * 100;
            $iq6 = kira_peratus_quran($jnssek, $kod, $kolkh, "6", $aliran);
            $iq6p = @($iq6 / $jumlahtepi) * 100;
            $iq7 = kira_peratus_quran($jnssek, $kod, $kolkh, "7", $aliran);
            $iq7p = @($iq7 / $jumlahtepi) * 100;
            $iq8 = kira_peratus_quran($jnssek, $kod, $kolkh, "8", $aliran);
            $iq8p = @($iq8 / $jumlahtepi) * 100;

            echo "<tr class='tengah small'>
            <td style='text-align:left'>$darjah</td>
            <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
            <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
            <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
            <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
            <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
            <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
            <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
            <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

            <td>" . number_format($jumlahtepi) . "</td>
            </tr>";
        }

        $jiq1 = kolum_peratus_quran($jnssek, $kolkh, "1", $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;
        $jiq2 = kolum_peratus_quran($jnssek, $kolkh, "2", $aliran);
        $jiq2p = @($jiq2 / $jumlahbwh) * 100;
        $jiq3 = kolum_peratus_quran($jnssek, $kolkh, "3", $aliran);
        $jiq3p = @($jiq3 / $jumlahbwh) * 100;
        $jiq4 = kolum_peratus_quran($jnssek, $kolkh, "4", $aliran);
        $jiq4p = @($jiq4 / $jumlahbwh) * 100;
        $jiq5 = kolum_peratus_quran($jnssek, $kolkh, "5", $aliran);
        $jiq5p = @($jiq5 / $jumlahbwh) * 100;
        $jiq6 = kolum_peratus_quran($jnssek, $kolkh, "6", $aliran);
        $jiq6p = @($jiq6 / $jumlahbwh) * 100;
        $jiq7 = kolum_peratus_quran($jnssek, $kolkh, "7", $aliran);
        $jiq7p = @($jiq7 / $jumlahbwh) * 100;
        $jiq8 = kolum_peratus_quran($jnssek, $kolkh, "8", $aliran);
        $jiq8p = @($jiq8 / $jumlahbwh) * 100;

        echo "<tr class='bgprime tengah small'>
        <td style='text-align:left'>JUMLAH KESELURUHAN</td>
        <td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
        <td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
        <td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
        <td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
        <td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
        <td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
        <td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
        <td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

        <td>" . number_format($jumlahbwh) . "</td> 
        </tr>";

        echo "</table>";

        end_analisa();
    }

    $mem = memory_get_usage();
    echo "<div align='center'>Skrip dijana dalam masa " . number_format(microtime(true) - $_SERVER["REQUEST_TIME_FLOAT"]) . " saat.
    <div>" . mksize($mem) . "</div></div>";

    echo "</div>";
}

if ($_POST["mode"] == "paparstatsek") {

    $arah = $_POST['arahan'];

    if ($arah == "bezaeprd") {

        begin_block("Senarai Beza Sekolah");

        echo "<div class='container'><div style='overflow:scroll; height:300px'>";

        echo "<table class='table table-striped'>";

        if ($CURUSER["class"] == "3") {

            $ppd = $CURUSER["ppd"];
            $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");

            $were = "ppd = '$ppd'";
            $were2 = "PPD = '$kodppd'";
        } elseif ($CURUSER["class"] == "4") {

            $neg = $CURUSER["negeri"];
            $kodnegg = infoAwan($neg, "kod", "ep_negeri");
            $kodneg = sprintf("%02d", $kodnegg);

            $were = "negeri = '$neg'";
            $were2 = "NEGERI = '$kodneg'";
        }


        $e = 1;
        $ji = mysqli_query($con, "SELECT * FROM ep_sekolah WHERE $were AND kod NOT IN (SELECT KODSEK FROM tdatasekolah)");
        while ($jo = mysqli_fetch_array($ji)) {
            extract($jo);

            $laporp = $lapor;
            $lapork = $laporkhas;
            $statusaliran = $statuskhas;

            if ($statusaliran == "-1") {

                $statusaliran = "PERDANA";

                if ($laporp == "0") {

                    $laporp = "<img src='images/icons/sign-error.png'>";
                    $lapork = "";
                } else {

                    $laporp = "<img data-toggle='tooltip' title='" . infoAwan($laporp, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
                    $lapork = "";
                }
            } elseif ($statusaliran == "0") {

                $statusaliran = "PERDANA + PPKI";

                if ($laporp == "0") {

                    $laporp = "<img src='images/icons/sign-error.png'>";
                } else {

                    $laporp = "<img data-toggle='tooltip' title='" . infoAwan($laporp, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
                }

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/sign-error.png'>";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
                }
            } elseif ($statusaliran == "1") {

                $statusaliran = "SKPK";

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/sign-error.png'>";
                    $laporp = "";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
                    $laporp = "";
                }
            } elseif ($statusaliran == "2") {

                $statusaliran = "SKPK + SKPK LD";

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/sign-error.png'>";
                    $laporp = "";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
                    $laporp = "";
                }
            } elseif ($statusaliran == "3") {

                $statusaliran = "SKPK LD";

                if ($lapork == "0") {

                    $lapork = "<img src='images/icons/sign-error.png'>";
                    $laporp = "";
                } else {

                    $lapork = "<img data-toggle='tooltip' title='" . infoAwan($lapork, "nama", "ep_pelaporan") . "' src='images/icons/sign-check.png'>";
                    $laporp = "";
                }
            }

            echo "<tr><td>$e</td><td width='5%'>$kod</td><td width='5%'>$neg</td><td width='15%'>$daerah</td><td>$nama " . checksekolah($kod, $statuskhas) . "</td><td>$laporp $lapork</td></tr>";
            $e++;
        }

        echo "</table>";

        echo "</div></div>";

        end_block();
    }
}

if ($_POST["mode"] == "paparsektakmelapor") {

    $negeri = $_POST['negeri'];
    $aliran = $_POST['aliran'];

    begin_block("Senarai Sekolah Tak Melapor");

    echo "<div class='container'><div style='overflow:scroll; height:300px'>";

    echo "<table class='table table-striped'>";

    $kodnegg = infoAwan($negeri, "kod", "ep_negeri");

    $e = 1;

    if ($CURUSER["class"] == "7") {

        info("SELECT * FROM tdatasekolah WHERE NEGERI = '$kodnegg' AND STALAPORDATA != '0'");
    }

    $ji = mysqli_query($con, "SELECT * FROM tdatasekolah WHERE NEGERI = '$kodnegg' AND STALAPORDATA != '0' AND STATUSKHAS = '$aliran'");
    while ($jo = mysqli_fetch_array($ji)) {
        extract($jo);

        $laporp = $STALAPORDATA;
        $statusaliran = $STATUSKHAS;

        if ($statusaliran == "-1") {

            $statusaliran = "PERDANA";

            if ($laporp == "0") {

                $laporp = "<img src='images/icons/sign-error.png'>";
            } else {

                $laporp = infoLapor($laporp);
            }
        } elseif ($statusaliran == "0") {

            $statusaliran = "PERDANA + PPKI";

            if ($laporp == "0") {

                $laporp = "<img src='images/icons/sign-error.png'>";
            } else {

                $laporp = infoLapor($laporp);
            }
        } elseif ($statusaliran == "1") {

            $statusaliran = "SKPK";

            if ($laporp == "0") {

                $laporp = "<img src='images/icons/sign-error.png'>";
            } else {

                $laporp = infoLapor($laporp);
            }
        } elseif ($statusaliran == "2") {

            $statusaliran = "SKPK + SKPK LD";

            if ($laporp == "0") {

                $laporp = "<img src='images/icons/sign-error.png'>";
            } else {

                $laporp = infoLapor($laporp);
            }
        } elseif ($statusaliran == "3") {

            $statusaliran = "SKPK LD";

            if ($laporp == "0") {

                $laporp = "<img src='images/icons/sign-error.png'>";
            } else {

                $laporp = infoLapor($laporp);
            }
        }

        echo "<tr><td width='1%'>$e</td><td width='5%'>$KODSEK</td><td width='5%'>$NEGERI</td><td width='5%'>$PPD</td><td>$SEKOLAH <span class='label label-info'>$statusaliran</span> " . checksekolah($KODSEK, $STATUSKHAS) . "</td><td width='25%'>$laporp</td></tr>";
        $e++;
    }

    echo "</table>";

    echo "</div></div>";

    end_block();
}

if ($_POST['mode'] == "buangcache") {

    $mod = $_POST['mod'];
    mysqli_query($con, "DELETE FROM ep_cache WHERE kod = '$mod'");
}

if ($_POST['mode'] == "carimanual") {

    begin_block("Hasil carian..", "fas fa-search");

    echo "<div class='container'>";

    $txt = mysqli_real_escape_string($con, $_POST['txt']);

    echo "<div class=\"list-group\">";
    $ter = mysqli_query($con, "SELECT * FROM blog WHERE tajuk LIKE '%$txt%'");
    while ($tg = mysqli_fetch_array($ter)) {
        extract($tg);

        echo "<a style='font-weight:600; font-size:12px' class='list-group-item' href='blog.php?go=papar&id=$id'>$tajuk <span class='label label-info'>$tarikh</span></a> ";
    }
    echo "</div>";

    echo "</div>";

    end_block();
}

if ($_POST['mode'] == "paparralat") {

    $query = $_POST['q'];
    $db = $_POST['db'];

    $kutipan = $SETTINGS["namakutipan"];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    if ($CURUSER["class"] == "2") {
        $kodsek = infoSekolah($CURUSER["sekolah"], "kod");
        $level = "WHERE KODSEK = '$kodsek'";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $pipd = $CURUSER['ppd'];
        $level = "WHERE CatatPlakuOkt = '$ppd' AND SB6 = '1'";
        $levelsek = "WHERE PPD = '$ppd'";
        $sekk = "WHERE sekolah = 0 AND ppd = '$pipd' AND class='2'";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);
        $level = "WHERE CatatPlakuJun = '$kodneg' AND SB6 = '1'";
        $levelsek = "WHERE NEGERI = '$kodneg'";
        $sekk = "WHERE sekolah = 0 AND negeri = '$neg' AND class='2'";
    } elseif ($CURUSER["class"] > "4") {

        $level = "WHERE SB6 = '1'";
    }

    //echo $query;

    if ($query == "ralatkhat2") {

        $q = "$level AND $kolkh = '' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND KODAGAMA = '01'";
    } elseif ($query == "ralatkhat1") {

        $q = "$level AND $kolkh = '7' AND $kolms IS NULL AND STATUSMURID IN (3,4,5,6,7,8,31) AND SB6 = '1' AND KODAGAMA = '01'";
    } elseif ($query == "ralatkhat3") {

        $q = "$level AND $kolkh IN (1,2,3,4,5,6) AND STATUSMURID IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND $kolms != '0' AND KODAGAMA = '01'";
    } elseif ($query == "ralatstat1") {

        $q = "$level AND STATUSMURID NOT IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS'";
    } elseif ($query == "ralatkhat4") {

        $q = "$level AND $kolkh = '8' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND $kolms != '604' AND KODAGAMA = '01'";
    } elseif ($query == "ralatkhat5") {

        $q = "$level AND $kolkh = '7' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND $kolms = '604' AND KODAGAMA = '01'";
    } elseif ($query == "ralattarikh1") {
        $q = "$level AND STATUSMURID IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1' AND UpdateTasmik LIKE '%2020%'";
    } elseif ($query == "ralattarikh2") {
        $q = "$level AND STATUSMURID IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1' AND UpdateArab LIKE '%2020%'";
    } elseif ($query == "ralattarikh3") {
        $q = "$level AND STATUSMURID IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1' AND UpdateWudhuk LIKE '%2020%'";
    } elseif ($query == "ralattarikh4") {
        $q = "$level AND STATUSMURID IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1' AND UpdatePelakuan LIKE '%2020%'";
    } elseif ($query == "ralattarikh5") {
        $q = "$level AND STATUSMURID IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1' AND UpdateBacaan LIKE '%2020%'";
    }

    $hu = mysqli_query($con, "SELECT * FROM $db $q");

    //echo "SELECT * FROM $db $q";

    $i = 1;

    if ($db == "tdatajqaf") {

        echo "<div class='container' style='width:80vw;overflow-y:auto;height:300px'><table class='table table-stripes table-hover'>";

        if ($query == "ralatstat1") {

            echo "<tr class='boldo'><td>Bil</td><td>Sekolah</td><td>No KP</td><td>Nama</td><td>Kelas</td><td>Status Murid</td></tr>";

            while ($rw = mysqli_fetch_array($hu)) {

                extract($rw);

                $darjah = $rw["KODTINGKATAN/TAHUN"];

                if ($CURUSER["class"] > 4) {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                } else {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                }

                echo "<tr><td>$i</td><td>" . infoKodSekolah($KODSEK) . " ($KODSEK)</td><td>$KPUTAMA</td><td><a target='_blank' href='$linkk'>$NAMA</a></td><td>$darjah $NAMAKELAS</td><td>$STATUSMURID</td></tr>";
                $i++;
            }
        } else {

            echo "<tr class='boldo'><td>Bil</td><td>Sekolah</td><td>Status Khas</td><td>No KP</td><td>Nama</td><td>Bacaan</td><td>Mukasurat</td></tr>";

            while ($rw = mysqli_fetch_array($hu)) {

                extract($rw);

                $kh = $rw["$kolkh"];
                $kms = $rw["$kolms"];

                if ($CURUSER["class"] > 4) {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                } else {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                }

                echo "<tr><td>$i</td><td>" . infoKodSekolah($KODSEK) . " ($KODSEK)</td><td>" . infoKodSekolahT($KODSEK, "STATUSKHAS") . "</td><td>$KPUTAMA</td><td><a target='_blank' href='$linkk'>$NAMA</a></td><td>$kh</td><td>$kms</td></tr>";
                $i++;
            }
        }

        echo "</table></div>";

    } else { //bukan DB tdatajqaf

        echo "<div class='container' style='width:80vw;overflow-y:auto;height:300px'><table class='table table-stripes table-hover'>";

        if ($query == "ralatstat1") {

            echo "<tr class='boldo'><td>Bil</td><td>Sekolah</td><td>No KP</td><td>Nama</td><td>Kelas</td><td>Status Murid</td></tr>";

            while ($rw = mysqli_fetch_array($hu)) {

                extract($rw);

                $darjah = $rw["KODTINGKATAN/TAHUN"];

                if ($CURUSER["class"] > 4) {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                } else {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                }

                echo "<tr><td>$i</td><td>" . infoKodSekolah($KODSEK) . " ($KODSEK)</td><td>$KPUTAMA</td><td><a target='_blank' href='$linkk'>$NAMA</a></td><td>$darjah $NAMAKELAS</td><td>$STATUSMURID</td></tr>";
                $i++;
            }
        } else {

            echo "<tr class='boldo'><td>Bil</td><td>Sekolah</td><td>Status Khas</td><td>No KP</td><td>Nama</td><td>Bacaan</td><td>Mukasurat</td><td>Update Al-Quran</td><td>Update Arab</td><td>Update Wuduk</td><td>Update Pelakuan</td><td>Update Bacaan</td></tr>";

            while ($rw = mysqli_fetch_array($hu)) {

                extract($rw);

                $kh = $rw["$kolkh"];
                $kms = $rw["$kolms"];
                $update1 = $rw["UpdateTasmik"];
                $update2 = $rw["UpdateArab"];
                $update3 = $rw["UpdateWudhuk"];
                $update4 = $rw["UpdatePelakuan"];
                $update5 = $rw["UpdateBacaan"];

                if ($CURUSER["class"] > 4) {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                } else {

                    $linkk = "murid.php?mode=editmurid&id=$ID";
                }

                echo "<tr><td>$i</td><td>" . infoKodSekolah($KODSEK) . " ($KODSEK)</td><td>" . infoKodSekolahT($KODSEK, "STATUSKHAS") . "</td><td>$KPUTAMA</td><td><a target='_blank' href='$linkk'>$NAMA</a></td><td>$kh</td><td>$kms</td><td>$update1</td><td>$update2</td><td>$update3</td><td>$update4</td><td>$update5</td></tr>";
                $i++;
            }
        }

        echo "</table></div>";

    }
}

if ($_POST['mode'] == "filtersah") {

    $neg = $_POST['neg'];
    $ppd = $_POST['ppd'];

    if ($ppd == 0) {

        $state = "AND negeri = '$neg'";
    } else {

        $state = "AND negeri = '$neg' AND ppd = '$ppd'";
    }

    echo "<ul class='list-group'>";

    $e = 1;

    function tidaklapor($kodsek)
    {
        global $con;
        $ji = mysqli_query($con, "SELECT * FROM tdatasekolah WHERE KODSEK = '$kodsek'");
        if (mysqli_num_rows($ji) == 0) {
            return "<span class='label label-info'>TIDAK MELAPOR</span>";
        }
    }

    $ge = mysqli_query($con, "SELECT * FROM ep_sekolah WHERE tarikhsek IS NULL $state") or trigger_error(mysqli_error($con));

    if (mysqli_num_rows($ge) > 0) {

        while ($gu = mysqli_fetch_array($ge)) {

            extract($gu);

            $nama = $gu["nama"];

            echo "<li class='list-group-item'>$e. $nama ($kod) " . tidaklapor($kod) . " <a target='_blank' href='awan.php?mode=genusersah&kod=$kod'><span class='label label-warning'>JANA</span></a></li>";
            $e++;
        }
    } else {

        info("Sekolah telah membuat pengesahan.");
    }

    echo "</ul>";
}

if ($_POST['mode'] == "paparragu") {

    $akuan = $_POST['akuan'];

    if ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['ppd'];
        $level = "WHERE ppd = '$ppd'";
        $tajok = $CURUSER['namapenuh'];
        $aliran = 0;
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);
        $level = "WHERE negeri = '$neg'";
        $tajok = $CURUSER['namapenuh'];
        $aliran = 0;
    } elseif ($CURUSER["class"] > "4") {

        $level = "";
        $tajok = "KEBANGSAAN";
        $aliran = 0;
    }

    echo "<div class='container' style='overflow-y:auto;height:300px'><ul class='list-group'>";

    $e = 1;

    function tidaklapor($kodsek)
    {
        global $con;
        $ji = mysqli_query($con, "SELECT * FROM tdatasekolah WHERE KODSEK = '$kodsek'");
        if (mysqli_num_rows($ji) == 0) {
            return "<span class='label label-info'>TIDAK MELAPOR</span>";
        }
    }

    $ge = mysqli_query($con, "SELECT * FROM ep_sekolah $level AND $akuan = 'tidak'") or trigger_error(mysqli_error($con));

    if (mysqli_num_rows($ge) > 0) {

        while ($gu = mysqli_fetch_array($ge)) {

            extract($gu);

            $nama = $gu["nama"];

            echo "<li class='list-group-item'>$e. $nama ($kod) " . tidaklapor($kod) . " <span class='label label-default text-uppercase'>KP: $akuankp</span> <span class='label label-warning text-uppercase'>GB: $akuangb</span></li>";
            $e++;
        }
    } else {

        info("Tiada sekolah data ragu.");
    }

    echo "</ul></div>";
}

if ($_POST['mode'] == "paparsah") {

    $stp = $_POST['step'];

    if ($stp == "sah1") {

        loadingajax("sah1", "grab.php", "divpengesah");
    } elseif ($stp == "sah2") {

        loadingajax("sah2", "grab.php", "divpengesah");
    } elseif ($stp == "sah3") {

        loadingajax("sah3", "grab.php", "divpengesah");
    }
}

if ($_POST['mode'] == "sekolahranking") {

    $data = $_POST['data'];

    $quran = mysqli_query($con, "SELECT KODSEK,KH3,CatatPlakuJun,CatatPlakuOkt,COUNT(KODSEK) AS enrol, 
    (COUNT(IF(KH3>6,1,NULL))/COUNT(KODSEK))*100 AS markah 
    FROM tdatajqaf WHERE CatatPlakuOkt = '$data' AND SB6='1' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND STATUSMURID IN (3,4,5,6,7,8,31) AND KODAGAMA = '01' GROUP BY KODSEK ORDER BY markah DESC");

    echo "<div style='width:700px;overflow:auto;height:400px'><ul class='list-group'>";

    $ie = 1;

    while ($qo = mysqli_fetch_array($quran)) {
        extract($qo);

        $nama = infoKodSekolah($KODSEK, "nama");
        $idsek = infoKodSekolah($KODSEK, "id");

        if ($i == "1") {

            $color = "style='background-color:#ffee58; color:black; font-weight:bold;font-size:11px'";
            $pangkat = "<img src='images/icons/class.png'><img src='images/icons/class.png'><img src='images/icons/class.png'>";
        } elseif ($i == "2") {

            $color = "style='background-color:#e1bee7; color:black; font-weight:bold;font-size:11px'";
            $pangkat = "<img src='images/icons/class.png'><img src='images/icons/class.png'>";
        } elseif ($i == "3") {

            $color = "style='background-color:#b3e5fc; color:black; font-weight:bold;font-size:11px'";
            $pangkat = "<img src='images/icons/emas.png'>";
        } else {

            $color = "style='font-size:11px'";
            $pangkat = "";
        }

        echo "<li class='list-group-item' $color><span class='pull-left label label-success' style='font-size:12px;margin-right:10px'>$ie</span><a target='_blank' href='cetakpdf.php?mode=cetak&kat=sek&idsek=$idsek&deta=tdatajqaf'>$nama</a> (" . number_format($enrol) . ") $pangkat<span class='pull-right badge'>" . number_format($markah, 2) . "%</span></li>";
        $ie++;
    }

    echo "</ul></div>";
}

if ($_POST['mode'] == "sekbhs") {

    $kod = $_POST['kod'];
    $serta = $_POST['serta'];

    $r = 1;

    echo "<div style='overflow:auto;height:300px'><table class='table table-striped' style='width:700px'>";
    echo "<tr><td>BIL</td><td>NEGERI</td><td>PPD</td><td>KODSEK</td><td>SEKOLAH</td><td>JENIS SEKOLAH</td></tr>";

    $jo = mysqli_query($con, "SELECT * FROM tdatasekolah WHERE JENISSEK = '$kod' AND KODSEK IN (SELECT KODSEK FROM tdatajqaf WHERE SB6 = 1 AND KODBAHASA = '$serta')");
    while ($ju = mysqli_fetch_array($jo)) {
        extract($ju);

        echo "<tr><td>$r</td><td>$NEGERI</td><td>$PPD</td><td>$KODSEK</td><td>$SEKOLAH</td><td>" . infoFromKod($JENISSEK, "ep_jenissek") . "</td></tr>";
        $r++;
    }

    echo "</table></div>";
}

if ($_POST['mode'] == "downloady") {

    $negeri = $_POST['neg'];
    $ppd = $_POST['ppd'];
    $sekolah = $_POST['sek'];
    $jenis = $_POST['jen'];
    $alir = $_POST['alir'];
    $thp = $_POST['thp'];
    $kodsek = infoKod($sekolah, "ep_sekolah", "id", "kod");

    $tag = array();

    if ($negeri != "0") {
        $tag[] = "<span class='label label-success'>" . infoKod($negeri, "ep_negeri", "id", "nama") . "</span>";
        $klausa[] = "neg=$negeri";
    }
    if ($ppd != "0") {
        $tag[] = "<span class='label label-success'>" . infoKod($ppd, "ep_ppd", "kodppd", "nama") . "</span>";
        $klausa[] = "ppd=$ppd";
    }
    if ($sekolah != "0") {
        $tag[] = "<span class='label label-success'>" . infoKod($sekolah, "ep_sekolah", "kod", "nama") . "</span>";
        $klausa[] = "sek=$sekolah";
    }
    if ($jenis != "0") {

        if ($jenis == "1") {
            $jenis = "sk";
        } elseif ($jenis == "2") {
            $jenis = "sjkc";
        } elseif ($jenis == "3") {
            $jenis = "sjkt";
        } elseif ($jenis == "4") {
            $jenis = "sabk";
        } elseif ($jenis == "5") {
            $jenis = "skasli";
        } elseif ($jenis == "6") {
            $jenis = "skpk";
        } elseif ($jenis == "7") {
            $jenis = "inklusif";
        }

        $tag[] = "<span class='label label-success text-uppercase'>$jenis</span>";
        $klausa[] = "jen=$jenis";
    } else {
        $jenis = "sk";
    }
    if ($alir != "0") {

        if ($alir == "1") {
            $am = "perdana";
        } elseif ($alir == "2") {
            $am = "ppki";
        } elseif ($alir == "3") {
            $am = "skpk";
        } else {
            $am = "perdana";
        }

        $tag[] = "<span class='label label-success text-uppercase'>$alir</span>";
        $klausa[] = "am=$am";
    }
    if ($thp != "0") {
        if ($thp == "sek") {
            $thpp = "Tahap Sekolah";
        } elseif ($thp == "ppd") {
            $thpp = "Tahap Daerah";
        } elseif ($thp == "neg") {
            $thpp = "Tahap Negeri";
        } elseif ($thp == "keb") {
            $thpp = "Tahap Kebangsaan";
        }
        $tag[] = "<span class='label label-success'>$thpp</span>";
    }

    $e = 1;

    if ($thp != "0") {

        if ($thp == "sek") {
            $lnk = "download.php?mode=totxt&alir=$am&jenis=murid&am=sekolah&kodsek=$kodsek";
            $lnks = "download.php?mode=totxt&alir=$am&jenis=sekolah&am=sekolah&kodsek=$kodsek";
        } elseif ($thp == "ppd") {
            $lnk = "download.php?mode=export2&jenis=$jenis&am=$am&thp=ppd&ppd=$ppd&db=murid";
            $lnks = "download.php?mode=export2&jenis=$jenis&am=$am&thp=ppd&ppd=$ppd&db=sek";
        } elseif ($thp == "neg") {
            $lnk = "download.php?mode=export2&jenis=$jenis&am=$am&thp=negeri&neg=$negeri&db=murid";
            $lnks = "download.php?mode=export2&jenis=$jenis&am=$am&thp=negeri&neg=$negeri&db=sek";
            $slip = "<div class='nunito' style='margin-top:10px;color:white;padding:15px;background:#e53935;border-radius:10px'><i class='fe fe-package'></i> <a style='color:white' href='excel.php?mode=slip&neg=$negeri'>Pelaporan Tahun 6<span class='float-right'><i class='fe fe-excel'></i></span></a></div>";
        } elseif ($thp == "keb") {
            $lnk = "download.php?mode=export2&jenis=$jenis&am=$am&thp=keb&db=murid";
            $lnks = "download.php?mode=export2&jenis=$jenis&am=$am&thp=keb&db=sek";
        }

        $tagg = !empty($tag) ? '' . implode(' ', $tag) : '';

        if (!empty($tag)) {
            echo "<div style='background:#fff9c4;padding:10px;margin-bottom:10px'>FILTER ANDA: $tagg</div>";
        }

        echo "<div class='nunito' style='margin-bottom:10px;padding:15px;background:#81d4fa;border-radius:10px'><i class='fe fe-package'></i> <a href='$lnk'>JQAFMurid.txt<span class='float-right'><i class='fe fe-download'></i></span></a></div>";
        echo "<div class='nunito' style='padding:15px;background:#e6ee9c;border-radius:10px'><i class='fe fe-package'></i> <a href='$lnks'>JQAFSekolah.txt<span class='float-right'><i class='fe fe-download'></i></span></a></div>";
        echo $slip;
    } else {
        filterx("Sila pilih Tahap!");
    }
}

?>