<?php
include_once("../libs/libs-manage-sysconfig.php");
//---
$_REQUEST['func'] = (!empty($_REQUEST['func'])) ? $_REQUEST['func']:"";
//---
$count = new Count;

class Count
{
    public function __construct()
    {
        switch($_REQUEST['func']){
            case "orders":
                $this->showCount();
                break;
            case "bonus-orders":
                $this->showCount2();
                break;
            case "tryout-orders":
                $this->showCount3();
                break;
        }
    }

    private function showCount()
    {
        global $nc_cfg,$db;
        //---
        $prefix =$nc_cfg['prefix'];
        //---
        if($_REQUEST['status']==0)
        {
            $sql ="select count(*) from orders";
            $rs = $db->prepare($sql);
        }
        else
        {
            $sql ="select count(*) from orders where ".$prefix."_o_status = :status";
            $rs = $db->prepare($sql);
            $rs->bindValue(':status',$_REQUEST['status'],PDO::PARAM_INT);
        }
        $rs->execute();
        $num = $rs->fetchColumn();
        $data =array();
        if(!empty($num)) $data['count'] =$num;
        else $data['count'] =0;
        echo json_encode($data);
    }

    private function showCount2()
    {
        global $nc_cfg,$db;
        //---
        $prefix =$nc_cfg['prefix'];
        //---
        if($_REQUEST['status']==0)
        {
            $sql ="select count(*) from bonus_orders";
            $rs = $db->prepare($sql);
        }
        else
        {
            $sql ="select count(*) from bonus_orders where ".$prefix."_bo_status = :status";
            $rs = $db->prepare($sql);
            $rs->bindValue(':status',$_REQUEST['status'],PDO::PARAM_INT);
        }
        $rs->execute();
        $num = $rs->fetchColumn();
        $data =array();
        if(!empty($num)) $data['count'] =$num;
        else $data['count'] =0;
        echo json_encode($data);
    }

    private function showCount3()
    {
        global $nc_cfg,$db;
        //---
        $prefix =$nc_cfg['prefix'];
        //---
        if($_REQUEST['status']==0)
        {
            $sql ="select count(*) from tryout_orders";
            $rs = $db->prepare($sql);
        }
        else
        {
            $sql ="select count(*) from tryout_orders where ".$prefix."_to_status = :status";
            $rs = $db->prepare($sql);
            $rs->bindValue(':status',$_REQUEST['status'],PDO::PARAM_INT);
        }
        $rs->execute();
        $num = $rs->fetchColumn();
        $data =array();
        if(!empty($num)) $data['count'] =$num;
        else $data['count'] =0;
        echo json_encode($data);
    }
}
?>