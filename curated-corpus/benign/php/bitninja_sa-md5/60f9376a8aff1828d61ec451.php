<?php
	include '../connection/connection.php';
	if(isset($_POST['addPackage']))
	{
		$mcat = $_POST['mcat'];
		$scat = $_POST['scat'];
		$sscat = $_POST['sscat'];
		$p_title = $_POST['p_title'];
		$image = $_FILES['image']['name'];
		$bimage = $_FILES['bimage']['name'];
		$day = $_POST['day'];
		$night = $_POST['night'];
		$hotspot = $_POST['hotspot'];
		$price = $_POST['price'];
		$person = $_POST['person'];
		$rating = $_POST['rating'];
		$services = implode(',',$_POST['services']);
		$overview = str_replace("'","",$_POST['overview']);
		// Iternery Data STARTS Here ///
		$d1img = $_FILES['d1img']['name'];
		$d1info = str_replace("'","",$_POST['d1info']);
		$d2img = $_FILES['d2img']['name'];
		$d2info = str_replace("'","",$_POST['d2info']);
		$d3img = $_FILES['d3img']['name'];
		$d3info = str_replace("'","",$_POST['d3info']);
		$d4img = $_FILES['d4img']['name'];
		$d4info = str_replace("'","",$_POST['d4info']);
		$d5img = $_FILES['d5img']['name'];
		$d5info = str_replace("'","",$_POST['d5info']);
		$d6img = $_FILES['d6img']['name'];
		$d6info = str_replace("'","",$_POST['d6info']);
		$d7img = $_FILES['d7img']['name'];
		$d7info = str_replace("'","",$_POST['d7info']);
		$d8img = $_FILES['d8img']['name'];
		$d8info = str_replace("'","",$_POST['d8info']);
		$d9img = $_FILES['d9img']['name'];
		$d9info = str_replace("'","",$_POST['d9info']);
		$d10img = $_FILES['d10img']['name'];
		$d10info = str_replace("'","",$_POST['d10info']);
		$d11img = $_FILES['d11img']['name'];
		$d11info = str_replace("'","",$_POST['d11info']);
		$d12img = $_FILES['d12img']['name'];
		$d12info = str_replace("'","",$_POST['d12info']);
		$d13img = $_FILES['d13img']['name'];
		$d13info = str_replace("'","",$_POST['d13info']);
		$d14img = $_FILES['d14img']['name'];
		$d14info = str_replace("'","",$_POST['d14info']);
		$d15img = $_FILES['d15img']['name'];
		$d15info = str_replace("'","",$_POST['d15info']);
		// Iternery Data ENDS Here ///
		$inclusion = $_POST['inclusion'];
		$exclusion = $_POST['exclusion'];
		$terms = $_POST['terms'];
		$docfile = $_FILES['docfile']['name'];
		// Processing Images STARTS Here //
		$imgext = pathinfo($image,PATHINFO_EXTENSION);
		$newtit = explode(' ',$p_title);
		if($mcat==1)
		{
			$newMimg = 'AIR_'.$newtit[0].'.'.$imgext;
		}
		else
		{
			$newMimg = $newtit[0].'.'.$imgext;
		}
		$bimgext = pathinfo($bimage,PATHINFO_EXTENSION);
		if($mcat==1)
		{
			$newbimg = 'AIR_'.$newtit[0].'_banner'.'.'.$bimgext;
		}
		else
		{
			$newbimg = $newtit[0].'_banner'.'.'.$bimgext;
		}
		$d1imgext = pathinfo($d1img,PATHINFO_EXTENSION);
		$newd1img = $newtit[0].'day1'.'.'.$d1imgext;
		
		$d2imgext = pathinfo($d2img,PATHINFO_EXTENSION);
		$newd2img = $newtit[0].'day2'.'.'.$d2imgext;
		
		$d3imgext = pathinfo($d3img,PATHINFO_EXTENSION);
		$newd3img = $newtit[0].'day3'.'.'.$d3imgext;
		
		$d4imgext = pathinfo($d4img,PATHINFO_EXTENSION);
		$newd4img = $newtit[0].'day4'.'.'.$d4imgext;
		
		$d5imgext = pathinfo($d5img,PATHINFO_EXTENSION);
		$newd5img = $newtit[0].'day5'.'.'.$d5imgext;
		
		$d6imgext = pathinfo($d6img,PATHINFO_EXTENSION);
		$newd6img = $newtit[0].'day6'.'.'.$d6imgext;
		
		$d7imgext = pathinfo($d7img,PATHINFO_EXTENSION);
		$newd7img = $newtit[0].'day7'.'.'.$d7imgext;
		
		$d8imgext = pathinfo($d8img,PATHINFO_EXTENSION);
		$newd8img = $newtit[0].'day8'.'.'.$d8imgext;
		
		$d9imgext = pathinfo($d9img,PATHINFO_EXTENSION);
		$newd9img = $newtit[0].'day9'.'.'.$d9imgext;
		
		$d10imgext = pathinfo($d10img,PATHINFO_EXTENSION);
		$newd10img = $newtit[0].'day10'.'.'.$d10imgext;
		
		$d11imgext = pathinfo($d11img,PATHINFO_EXTENSION);
		$newd11img = $newtit[0].'day11'.'.'.$d11imgext;
		
		$d12imgext = pathinfo($d12img,PATHINFO_EXTENSION);
		$newd12img = $newtit[0].'day12'.'.'.$d12imgext;
		
		$d13imgext = pathinfo($d13img,PATHINFO_EXTENSION);
		$newd13img = $newtit[0].'day13'.'.'.$d13imgext;
		
		$d14imgext = pathinfo($d14img,PATHINFO_EXTENSION);
		$newd14img = $newtit[0].'day14'.'.'.$d14imgext;
		
		$d15imgext = pathinfo($d15img,PATHINFO_EXTENSION);
		$newd15img = $newtit[0].'day15'.'.'.$d15imgext;
		
		// PDF Processing STARTS Here //
		
		$docext = pathinfo($docfile,PATHINFO_EXTENSION);
		if($mcat==1)
				{
					$newDoc = 'AIR_'.$newtit[0].'doc'.'.'.$docext;
				}
			else
				{
					$newDoc = $newtit[0].'doc'.'.'.$docext;
				}
		// PDF Processing ENDS Here //
		
		$qry = "INSERT INTO package (cat,sCat,sScat,name,image,bimage,day,night,hotspots,price,person,rating,services,overview,d1img,d2img,d3img,d4img,d5img,d6img,d7img,d8img,d9img,d10img,d11img,d12img,d13img,d14img,d15img,inclusion,exclusion,terms,pdf) VALUES ('$mcat','$scat','$sscat','$p_title','$newMimg','$newbimg','$day','$night','$hotspot','$price','$person','$rating','$services','$overview','$newd1img','$newd2img','$newd3img','$newd4img','$newd5img','$newd6img','$newd7img','$newd8img','$newd9img','$newd10img','$newd11img','$newd12img','$newd13img','$newd14img','$newd15img','$inclusion','$exclusion','$terms','$newDoc')";
		$res = mysqli_query($conn,$qry);
		if($res)
		{
		    $lstrow = "SELECT * FROM package ORDER BY id DESC LIMIT 1";
		    $rowres = mysqli_query($conn,$lstrow);
		    $lst = mysqli_fetch_array($rowres);
		    $tmpPid = $lst['id'];
		
    		$qry_1 = "INSERT INTO p_info1 (pid,d1info,d2info,d3info,d4info,d5info) VALUES ('$tmpPid','$d1info','$d2info','$d3info','$d4info','$d5info')";
    		$res_1 = mysqli_query($conn,$qry_1);
    		
    		$qry_2 = "INSERT INTO p_info2 (pid,d6info,d7info,d8info,d9info,d10info) VALUES ('$tmpPid','$d6info','$d7info','$d8info','$d9info','$d10info')";
    		$res_2 = mysqli_query($conn,$qry_2);
    		
    		$qry_3 = "INSERT INTO p_info3 (pid,d11info,d12info,d13info,d14info,d15info) VALUES ('$tmpPid','$d11info','$d12info','$d13info','$d14info','$d15info')";
    		$res_3 = mysqli_query($conn,$qry_3);
		}
		if($res AND $res_1 AND $res_2 AND $res_3)
		{
			move_uploaded_file($_FILES['image']['tmp_name'],'../uploads/package/'.$newMimg);
			move_uploaded_file($_FILES['bimage']['tmp_name'],'../uploads/package/'.$newbimg);
			move_uploaded_file($_FILES['d1img']['tmp_name'],'../uploads/package/'.$newd1img);
			move_uploaded_file($_FILES['d2img']['tmp_name'],'../uploads/package/'.$newd2img);
			move_uploaded_file($_FILES['d3img']['tmp_name'],'../uploads/package/'.$newd3img);
			move_uploaded_file($_FILES['d4img']['tmp_name'],'../uploads/package/'.$newd4img);
			move_uploaded_file($_FILES['d5img']['tmp_name'],'../uploads/package/'.$newd5img);
			move_uploaded_file($_FILES['d6img']['tmp_name'],'../uploads/package/'.$newd6img);
			move_uploaded_file($_FILES['d7img']['tmp_name'],'../uploads/package/'.$newd7img);
			move_uploaded_file($_FILES['d8img']['tmp_name'],'../uploads/package/'.$newd8img);
			move_uploaded_file($_FILES['d9img']['tmp_name'],'../uploads/package/'.$newd9img);
			move_uploaded_file($_FILES['d10img']['tmp_name'],'../uploads/package/'.$newd10img);
			move_uploaded_file($_FILES['d11img']['tmp_name'],'../uploads/package/'.$newd11img);
			move_uploaded_file($_FILES['d12img']['tmp_name'],'../uploads/package/'.$newd12img);
			move_uploaded_file($_FILES['d13img']['tmp_name'],'../uploads/package/'.$newd13img);
			move_uploaded_file($_FILES['d14img']['tmp_name'],'../uploads/package/'.$newd14img);
			move_uploaded_file($_FILES['d15img']['tmp_name'],'../uploads/package/'.$newd15img);
			move_uploaded_file($_FILES['docfile']['tmp_name'],'../uploads/pdf/'.$newDoc);
			$_SESSION['smsg']='Data Inserted Successfuly';
			header('location:../addPackage.php');
		}
		else
		{
			$_SESSION['smsg']='ERROR';
			header('location:../addPackage.php');
		}
	}
?>