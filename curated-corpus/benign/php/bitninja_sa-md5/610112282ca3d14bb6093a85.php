<?php
ob_start();
require 'admin/includes/config.php';
$returnBack = $_SERVER['HTTP_REFERER'];
$username=trim(isset($_POST['username'])? $_POST['username']:null);
$password=trim(isset($_POST['password'])? $_POST['password']:null);
$confirm_password=trim(isset($_POST['confirm_password'])? $_POST['confirm_password']:null);
$mobile=trim(isset($_POST['mobile'])? $_POST['mobile']:null);
$house_no=trim(isset($_POST['house_no'])? $_POST['house_no']:null);
$street=trim(isset($_POST['street'])? $_POST['street']:null);
$landmark=trim(isset($_POST['landmark'])? $_POST['landmark']:null);
$city=trim(isset($_POST['city'])? $_POST['city']:null);
$state=trim(isset($_POST['state'])? $_POST['state']:null);
$pin_code=trim(isset($_POST['pin_code'])? $_POST['pin_code']:null);
$country=trim(isset($_POST['country'])? $_POST['country']:null);

$manuscript_type=isset($_POST['manuscript_type'])? $_POST['manuscript_type']:null;
$branch=trim(isset($_POST['branch'])? $_POST['branch']:null);
$area_research=trim(isset($_POST['area_research'])? $_POST['area_research']:null);
$college=trim(isset($_POST['college'])? $_POST['college']:null);
$publication_issue=isset($_POST['publication_issue'])? $_POST['publication_issue']:null;
$paper_title=trim(isset($_POST['paper_title'])? $_POST['paper_title']:null);
$author1=trim(isset($_POST['author1'])? $_POST['author1']:null);
$author2=trim(isset($_POST['author2'])? $_POST['author2']:null);
$author3=trim(isset($_POST['author3'])? $_POST['author3']:null);
$author4=trim(isset($_POST['author4'])? $_POST['author4']:null);

$file=isset($_FILES['file'])? $_FILES['file']:null;
$file_acn=$file['name'];
$file_tmp=$file['tmp_name'];

$query="SELECT username FROM author_login WHERE username=:field";
$sql=$dbcon->prepare($query);
$sql->execute(array(':field' => $username));
$row=$sql->rowCount();

if(isset($_POST['submit'])) {
	if($username==null or $password==null or $confirm_password==null or $mobile==null or $city==null or $state==null or $country==null or $branch==null or $area_research==null or $college==null or $paper_title==null or $author1==null or $manuscript_type=="null" or $publication_issue=="null" or strlen($file_acn)==0) {
		echo '<script language="javascript">
				alert("Please fill out necessary fields.");
				window.location.href="'.$returnBack.'";
			  </script>';
	} else if($row>0) {
		echo '<script language="javascript">
				alert("This email id has already been registered.");
				window.location.href="'.$returnBack.'";
			  </script>';
	} else {
		if($password==$confirm_password) {
			$path="uploads/manuscript/";
			/*if($author2==null){ $author2="NA"; }
			if($author3==null){ $author3="NA"; }
			if($author4==null){ $author4="NA"; }*/
			$address=trim($house_no." ".$street." ".$landmark." ".$city."<br>".$pin_code);
			$password=md5($password);
			$query="INSERT INTO author_login (username, password, mobile, address, state, country, datetime) VALUES (:field1, :field2, :field3, :field4, :field5, :field6, NOW())";
			$sql=$dbcon->prepare($query);
			$sql->execute(array(':field1' => $username, ':field2' => $password, ':field3' => $mobile, ':field4' => $address, ':field5' => $state, ':field6' => $country));
			
			$createTrigger="DROP TRIGGER IF EXISTS before_author_insert;
							CREATE TRIGGER before_author_insert BEFORE INSERT ON author_manuscript
							FOR EACH ROW
							BEGIN
								INSERT INTO author_autoid (id, datetime) VALUES (null, NOW());
								SET NEW.am_id=CONCAT('IJEBRMA', LAST_INSERT_ID());
							END";
			$dbcon->exec($createTrigger);
			$fileinc=0;
			do {
				$fileinc++;
				$filename="IJEBRMA".$fileinc;
			} while(file_exists($path.$filename.$file_acn));
			move_uploaded_file($file_tmp, $path.$filename.$file_acn);
			
			$query="INSERT INTO author_manuscript (type, branch, area_research, college, paper_title, author1, author2, author3, author4, pub_issue, username, file, status, datetime) VALUES (:field1, :field2, :field3, :field4, :field5, :field6, :field7, :field8, :field9, :field10, :field11, :field12, :field13, NOW())";
			$sql=$dbcon->prepare($query);
			$sql->execute(array(':field1' => $manuscript_type, ':field2' => $branch, ':field3' => $area_research, ':field4' => $college, ':field5' => $paper_title, ':field6' => $author1, ':field7' => $author2, ':field8' => $author3, ':field9' => $author4, ':field10' => $publication_issue, ':field11' => $username, ':field12' => $filename.$file_acn, ':field13' => 'Non Published'));
			
			$to =$username;
			$from ="editor@ijebr.com";
			
			$subject_email="IJEBR - Regsitration Successfull";
			$message="<table width='600px'>
							<tr style='font-weight:bold'>
								<td>Hi $author1,<br>Welcome to IJEBR !<br>This message serves as confirmation that you are now successfully registered with IJEBR - Editorial Management System (EMS).</td>
							</tr>
							<tr style='font-weight:bold'>
								<td>Editor<br><a href='http://www.ijebr.com'>http://www.ijebr.com</a></td>
							</tr>
						  </table>";
			$headers  = 'MIME-Version: 1.0' . "\r\n";
			$headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
			$headers .= 'From:'.$from."\r\n".'Reply-To:'. $to."\r\n";
			@mail($to, $subject_email, $message, $headers);
				
			$subject_email="IJEBR - Manuscript Submitted Successfully";
			$message="<table width='600px'>
							<tr style='font-weight:bold'>
								<td>Hi $author1,<br>We received your manuscript and it is submitted to editor for review process.<br>It will takes 4-6 working days for completing initial manuscript review by members of our initial screening team/review board. You will get confirmation email once your manuscript initial review phase completes.</td>
							</tr>
							<tr>
								<td>Best Wishes.</td>
							</tr>
							<tr style='font-weight:bold'>
								<td>Editor,<br><a href='http://www.ijebr.com'>http://www.ijebr.com</a></td>
							</tr>
						  </table>";
			$headers  = 'MIME-Version: 1.0' . "\r\n";
			$headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
			$headers .= 'From:'.$from."\r\n".'Reply-To:'. $to."\r\n";
			@mail($to, $subject_email, $message, $headers);

			echo '<script language="javascript">
					alert("You have been registered successfully.");
					window.location.href="ems_author_login.php";
				  </script>';
		} else {
			echo '<script language="javascript">
					alert("Password and confirm password not matched.");
					window.location.href="'.$returnBack.'";
				  </script>';
		}
	}
}
?>
<!doctype html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->

<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->

<!--[if IE 9]>
<html class="ie ie9" lang="en-US">
<![endif]-->

<!--[if !(IE 7) | !(IE 8) | !(IE 9)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<title>International Journal of Economics Review & Business Research</title>
<link rel="stylesheet" type="text/css" href="css/style.css" id="magz-style-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/swipemenu.css" id="swipemenu-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/flexslider.css" id="flexslider-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/bootstrap.css" id="bootstrap-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.css" id="bootstrap-responsive-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/jquery.simplyscroll.css" id="simplyscroll-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/jPages.css" id="jPages-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/jquery.rating.css" id="rating-css" media="all" />
<link rel="stylesheet" type="text/css" href="css/ie.css" id="ie-styles-css" media="all" />
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Roboto" id="Roboto-css" media="all" />

<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/html5.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.flexslider.js"></script>
<script type="text/javascript" src="js/jquery.flexslider.init.js"></script>
<script type="text/javascript" src="js/jquery.bxslider.js"></script>
<script type="text/javascript" src="js/jquery.bxslider.init.js"></script>
<script type="text/javascript" src="js/jquery.rating.js"></script>
<script type="text/javascript" src="js/jquery.idTabs.min.js"></script>
<script type="text/javascript" src="js/jquery.simplyscroll.js"></script>
<script type="text/javascript" src="js/fluidvids.min.js"></script>
<script type="text/javascript" src="js/jPages.js"></script>
<script type="text/javascript" src="js/jquery.sidr.min.js"></script>
<script type="text/javascript" src="js/jquery.touchSwipe.min.js"></script>
<script type="text/javascript" src="js/custom.js"></script>
</head>
<body>

<div id="page">

	<?php require 'includes/header.php'; ?>

	<div id="content" class="container" style="padding-bottom:0px">
		<div id="main" class="row-fluid">
        
			<div id="main-left" class="span12" style="margin:0px">
				
                <?php require 'includes/ems_header.php'; ?>
                
                <div class="ems-main">
                	<div class="ems-form">
                    
                    	<div class="ems-form-head">IJEBR - Submit Manuscript/Paper</div>
                        <div class="ems-form-subhead">
                        	<div class="ems-form-subhead-left">Personal Details</div>
                            <div class="ems-form-subhead-right">Paper Details</div>
                        </div>
                        <div style="clear:both"></div>
                        <form method="post" enctype="multipart/form-data">
                    	<div class="ems-form-left">
                        	<label>Username (Email Id) *</label>
                            <input type="text" name="username">
                            <label>Password *</label>
                            <input type="password" name="password">
                            <label>Confirm Password *</label>
                            <input type="password" name="confirm_password">
                            <label>Mobile No. *</label>
                            <input type="text" name="mobile">
                            <label>House No./Building/Apartment Name</label>
                            <input type="text" name="house_no">
                            <label>Street/Society</label>
                            <input type="text" name="street">
                            <label>Landmark</label>
                            <input type="text" name="landmark">
                            <label>City *</label>
                            <input type="text" name="city">
                            <label>State *</label>
                            <input type="text" name="state">
                            <label>Pin/Zip Code</label>
                            <input type="text" name="pin_code">
                            <label>Country *</label>
                            <input type="text" name="country">
                        </div>
                        
                        <div class="ems-form-right">
                        	<label>Manuscript Type *</label>
                            <select name="manuscript_type">
                            	<option value="null" selected>Please Select</option>
                                <option value="Review Article">Review Article</option>
                                <option value="Case Reports/Studies">Case Reports/Studies</option>
                                <option value="Research Article">Research Article</option>
                                <option value="View Points">View Points</option>
                                <option value="Special Reports">Special Reports</option>
                                <option value="Commentaries">Commentaries</option>
                            </select>
                            <label>Branch *</label>
                            <input type="text" name="branch">
                            <label>Area of Research *</label>
                            <input type="text" name="area_research">
                            <label>College/Institute/University/Company *</label>
                            <input type="text" name="college">
                            <label>Publication Issue *</label>
                            <select name="publication_issue">
                            	<option value="null" selected>Please Select</option>
                                <?php
								$query_pubissue="SELECT * FROM journal WHERE status=:field ORDER BY jou_id ASC";
								$sql_pubissue=$dbcon->prepare($query_pubissue);
								$sql_pubissue->execute(array(':field' => 'Published'));
								while($data_pubissue=$sql_pubissue->fetch(PDO::FETCH_ASSOC)) {
								?>
                                <option value="<?php echo $data_pubissue['jou_id']; ?>"><?php echo $data_pubissue['volume']."&nbsp;-&nbsp;".$data_pubissue['issue']."&nbsp;-&nbsp;".$data_pubissue['title']; ?></option>
                                <?php
								}
								?>
                            </select>
                            <label>Paper Title *</label>
                            <input type="text" name="paper_title">
                            <label>Name of Author 1 *</label>
                            <input type="text" name="author1">
                            <label>Name of Author 2</label>
                            <input type="text" name="author2">
                            <label>Name of Author 3</label>
                            <input type="text" name="author3">
                            <label>Name of Author 4</label>
                            <input type="text" name="author4">
                            <label>Upload Paper/Manuscript *</label>
                            <input type="file" name="file">
                        </div>
                        <div class="ems-form-submit">
                        	<input type="submit" name="submit" value="Submit">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <input type="reset" value="Reset">
                        </div>
                        </form>
                    </div>	<!--END ems-form-->
                </div>	<!--END ems-main-->
			</div><!-- #main-left -->
		<div class="clearfix"></div>
		</div><!-- #main -->

		</div><!-- #content -->

	<?php require 'includes/ems_footer.php'; ?>
    
</div>	<!-- #wrapper -->

</body>
</html>
