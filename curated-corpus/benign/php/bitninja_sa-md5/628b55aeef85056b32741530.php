<?Php
	//Designed and Developed by Charitha Punchinilame, ICT Officer, Sabaragamuwa Provincial Council
	session_start(); //To use the SESSION variable
	include "db.php"; // get the database connection

		$nid=$_SESSION['nid'];
		$logtype=$_SESSION['logtype'];
		$office=$_SESSION['office'];
		$un=$_SESSION['un'];

		//set the local time zone
 		date_default_timezone_set("Asia/Colombo");
 		$dt=date("Y-m-d");
		$tim=date("h:i:sa");

		$updateby=$nid;

?>
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Cadre Management System - Sabaragamuwa Provincial Council</title>


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

</head>

<body>
<div class="container-fluid">
   <div class="row navbar-fixed-top" style="background-color: antiquewhite"><?Php require_once("leftmenu.php"); ?></div>
	 
	<div class="row" style="height:auto;margin: 10px">
			<div style="width: 100%" align="center">
				<?Php
				// Add date to the Database
				$stfnid=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["stfnid"])));
				$empname=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empname"])));
				$empdob=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empdob"])));
				$empgender=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empgender"])));
				
				$empmobile=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empmobile"])));
				$empofftele=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empofftele"])));
				$empemail=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empemail"])));
				
				
				$desig=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["desig"])));
				$off=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["off"])));
				$service=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["service"])));
				$grade=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["grade"])));
				$sscale=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["sscale"])));
				$servicelevel=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["servicelevel"])));
				$empapptype=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empapptype"])));
				
				$empfirstappdate=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empfirstappdate"])));
				$empretdate=mysqli_real_escape_string($con,trim(htmlspecialchars($_POST["empretdate"])));
				
				
		
				//Check the employye details are already added
				$sql="SELECT * FROM cad_staff where stf_nid='$stfnid'";
				$rs=mysqli_query($con,$sql);
			   	if(mysqli_num_rows($rs)<1){//if designation not exists
		
				$sqlinsert = "insert into cad_staff (stf_nid,stf_name,stf_dob,stf_gender,stf_mobile,stf_officetele,stf_email,stf_desig,stf_office,
				stf_salcode,stf_grade,stf_service,stf_servicelevel,stf_desigtype,stf_firstappointmentdate,
				stf_retierddate,stf_updatedby,stf_updatedate,stf_updatetime) 
				values ('".$stfnid."','".$empname."','".$empdob."','".$empgender."','".$empmobile."','".$empofftele."','".$empemail."',
				'".$desig."','".$off."','".$sscale."','".$grade."','".$service."'
				,'".$servicelevel."','".$empapptype."','".$empfirstappdate."','".$empretdate."','".$updateby."','".$dt."','".$tim."')";
 						$rsinsert = mysqli_query($con,$sqlinsert);
						if(!$rsinsert){
						?>
							  <div class="alert alert-danger">
    							<strong>Error :<?Php echo " ".mysqli_error($con); ?> </strong>
  							</div>
						<?Php
						
						}
						else{
				?>
								  <div class="alert alert-success" align="center">
    								<strong>New Employee information is added Successfully.... Add another Employee.</strong>
  								</div>
				<?Php
							
						}
						
				}
 				else{
				?>
								  <div class="alert alert-warning">
   									 <strong>This Employee is already inserted...Please try again...</strong>
 								 </div>
				<?Php
					
				}
  
			?>
			</div>

		<div class="btn-group">
		  <button type="button" class="btn btn-info" onClick="document.location.href='viewstaffdetails.php'"> View All Employees' Details </button>
		<!--  <button type="button" class="btn btn-primary">Samsung</button>
		  <button type="button" class="btn btn-primary">Sony</button> -->
		</div>
	</div>
	<div class="row" style="height:auto">
		<div class="container">
  <h2>Add Staff Details</h2>
  
  <form action="addstaffdata.php" class="was-validated" method="post" name="frmadd">
    <div class="form-group">
		
		<table class="table">
			<tr>
			  <td align="right">National Identity Card No.:</td>
			  <td align="left"><input type="text" pattern="[0123456789VX]{10}|[0-9]{12}" class="form-control" id="stfnid" placeholder="Enter valied employee NID No. (ex : 123456789V OR 123456789X OR 123456789012)" name="stfnid" required></td>
		  </tr>
			<tr>
			  <td align="right">Name of the Employee:</td>
			  <td align="left"><input type="text" class="form-control" id="empname" placeholder="Enter Employee's name (Ex: A.B.C. Perera)" name="empname" required></td>
		  </tr>
			<tr>
			  <td align="right">Employee's Date of Birth:</td>
			  <td align="left"><input type="date" class="form-control" id="empdob" placeholder="" name="empdob" required></td>
		  </tr>
			<tr>
			  <td align="right">Gender:</td>
			  <td align="left">
				  <select class="form-control" id="empgender" name="empgender" required>
					  <option>Male</option>
					  <option>Female</option>
				  </select>
				
			</td>
		  </tr>
			<tr>
			  <td align="right">Mobile No:</td>
			  <td align="left"><input type="text" pattern="[0-9]{10}" class="form-control" id="empmobile" placeholder="Enter Employee's Mobile No." name="empmobile" ></td>
		  </tr>
			<tr>
			  <td align="right">Office Telephone No:</td>
			  <td align="left"><input type="text" pattern="[0-9]{10}" class="form-control" id="empofftele" placeholder="Enter Employee's Office Telephone No." name="empofftele" required ></td>
		  </tr>
			<tr>
			  <td align="right">Email Address:</td>
			  <td align="left"><input type="email" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" class="form-control" id="empemail" placeholder="Enter Employee's Email address" name="empemail" ></td>
		  </tr>			
			<tr>
				<td width="35%" align="right"><label for="uname">Designation:</label></td>
				<td width="65%" align="left">
					
			<?Php
				//retrieve data from the database
				$sql="SELECT * FROM cad_desigs order by desig_name ASC";
				$rs=mysqli_query($con,$sql);
				$numberofRows= mysqli_num_rows($rs);	
				if($numberofRows !=0){
			?>
					<select class="form-control" id="desig" name="desig" required>
						<option></option>
			<?Php		
					while($rows=mysqli_fetch_assoc($rs)){
			?>					
					
						<option value="<?Php echo $rows["desig_id"]; ?>"><?php echo $rows["desig_name"]; ?></option>
			<?Php
					}
			?>			
					</select>
			<?Php
				}
			?>		
					
				</td>
			</tr>	
			<tr>
				<td align="right"><label for="uname">Office:</label></td>
				<td align="left">
			<?Php
				//retrieve data from the database
				$sqlo="SELECT * FROM cad_office order by of_name ASC";
				$rso=mysqli_query($con,$sqlo);
				$numberofRowso= mysqli_num_rows($rso);	
				if($numberofRowso !=0){
			?>
					<select class="form-control" id="off" name="off" required>
			<?Php
				//***** if not administrator************
					if($logtype!="Administrator"){
						$sqlof="SELECT * FROM cad_office where of_id='$office'";
						$rsof=mysqli_query($con,$sqlof);
						$rowsof=mysqli_fetch_assoc($rsof);
				?>		
						<option value="<?Php echo $office; ?>"><?php echo $rowsof["of_name"]; ?></option>
				<?Php		
					}
					else{ //************ if administrator ****************************
			?>								
						<option></option>
			<?Php		
					while($rowso=mysqli_fetch_assoc($rso)){
			?>					
					
						<option value="<?Php echo $rowso["of_id"]; ?>"><?php echo $rowso["of_name"]; ?></option>
			<?Php
					}
					}
			?>			
					</select>
			<?Php
						
				}
			?>		
					
				</td>
			</tr>	
			<tr>
			  <td align="right">Service:</td>
			  <td align="left">

			<?Php
				//retrieve data from the database
				$sqls="SELECT * FROM cad_services order by service_name ASC";
				$rss=mysqli_query($con,$sqls);
				$numberofRowss= mysqli_num_rows($rss);	
				if($numberofRowss !=0){
			?>
					<select class="form-control" id="service" name="service" required>
						<option></option>
			<?Php		
					while($rowss=mysqli_fetch_assoc($rss)){
			?>					
					
						<option value="<?Php echo $rowss["service_id"]; ?>"><?php echo $rowss["service_name"]; ?></option>
			<?Php
					}
			?>			
					</select>
			<?Php
				}
			?>						  
			
			  </td>
		  </tr>
			<tr>
			  <td align="right">Grade:</td>
			  <td align="left">
				
			<?Php
				//retrieve data from the database
				$sqlg="SELECT * FROM cad_class order by cls_class ASC";
				$rsg=mysqli_query($con,$sqlg);
				$numberofRowsg= mysqli_num_rows($rsg);	
				if($numberofRowsg !=0){
			?>
					<select class="form-control" id="grade" name="grade" required>
						<option></option>
			<?Php		
					while($rowsg=mysqli_fetch_assoc($rsg)){
			?>					
					
						<option value="<?Php echo $rowsg["cls_id"]; ?>"><?php echo $rowsg["cls_class"]; ?></option>
			<?Php
					}
			?>			
					</select>
			<?Php
				}
			?>						  				
				
			  </td>
		  </tr>
			<tr>
			  <td align="right">Salary Scale:</td>
			  <td align="left">
				
			<?Php
				//retrieve data from the database
				$sqlsc="SELECT * FROM cad_salaryscale order by sal_scale ASC";
				$rssc=mysqli_query($con,$sqlsc);
				$numberofRowssc= mysqli_num_rows($rssc);	
				if($numberofRowssc !=0){
			?>
					<select class="form-control" id="sscale" name="sscale" required>
						<option></option>
			<?Php		
					while($rowssc=mysqli_fetch_assoc($rssc)){
			?>					
					
						<option value="<?Php echo $rowssc["sal_id"]; ?>"><?php echo $rowssc["sal_scale"]; ?></option>
			<?Php
					}
			?>			
					</select>
			<?Php
				}
			?>						 
				  
			  </td>
		  </tr>
			<tr>
			  <td align="right">Service Level:</td>
			  <td align="left">
				
			<?Php
				//retrieve data from the database
				$sqlsl="SELECT * FROM cad_serviceprof order by sp_name ASC";
				$rssl=mysqli_query($con,$sqlsl);
				$numberofRowssl= mysqli_num_rows($rssl);	
				if($numberofRowssl !=0){
			?>
					<select class="form-control" id="servicelevel" name="servicelevel" required>
						<option></option>
			<?Php		
					while($rowssl=mysqli_fetch_assoc($rssl)){
			?>					
					
						<option value="<?Php echo $rowssl["sp_id"]; ?>"><?php echo $rowssl["sp_name"]; ?></option>
			<?Php
					}
			?>			
					</select>
			<?Php
				}
			?>						 
				  
			  </td>
		  </tr>
			<tr>
			  <td align="right">Nature of the Appintment:</td>
			  <td align="left">
				
			  		<select class="form-control" id="empapptype" name="empapptype" required>
					  	<option>Permanent</option>
					  	<option>Contract</option>
						<option>Casual</option>	
						<option>Temporary</option>
				 	 </select>
				  
				</td>
		  </tr>
			<tr>
				<td align="right"><label for="uname">Date of the first Appointment:</label></td>
				<td align="left">
					<input type="date" class="form-control" id="empfirstappdate" placeholder="" name="empfirstappdate" required>
				</td>
			</tr>
			<tr>
				<td align="right"><label for="uname">Date of the Retirement/Ending date of Contract/Agreement:</label></td>
				<td align="left">
					<input type="date" class="form-control" id="empretdate" placeholder="" name="empretdate" required>
					
				</td>
			</tr>		
			<tr>
				<td align="right"><button type="reset" class="btn btn-secondary"> Clear the Form </button></td>
				<td align="left">
					<button type="submit" class="btn btn-success"> Submit </button>
				</td>
			</tr>					
		</table>
	
    
  </form>
</div>
	</div>	
</body>
</html>