<?php


function pegaValor($valor) {
    return isset($_POST[$valor]) ? $_POST[$valor] : '';
}

function validaEmail($email) {
    return filter_var($email, FILTER_VALIDATE_EMAIL);
}

function enviaEmail($de, $assunto, $mensagem, $para, $email_servidor) {
    $headers = "From: $email_servidor\r\n" .
               "Reply-To: $de\r\n" .
               "X-Mailer: PHP/" . phpversion() . "\r\n";
    $headers .= "MIME-Version: 1.0\r\n";
    $headers .= "Content-Type: text/html; charset=ISO-8859-1\r\n";
  
  mail($para, $assunto, nl2br($mensagem), $headers);
}

// Tratamento para Anti Span
$spam=false;  
$spamwords = "/(180|watches|)/i";

if (preg_match( "/bcc:|cc:|multipart|\[url|Content-Type:/i", implode($_POST))) {
$spam=true;  
}

if (preg_match($spamwords, implode($_POST))) {      
//$spam=true;  
}

if($_POST['telefone'] == $_POST['assunto']) $spam=true;

if (preg_match_all("/<a|http:/i", implode($_POST), $out) > 3) {      
$spam=true;  
}


$email_servidor = "admin@tlccampinas.com.br";
	
$de = pegaValor("email");
$nome = pegaValor("nome");
$telefone = pegaValor("telefone");
$assunto = pegaValor("assunto");
$categoria= pegaValor("categoria");
$mensagem = pegaValor("mensagem");

  

$corpo_mail = "Mensagem recebida através do site \n \n";
$corpo_mail .= "\n Nome: " . $nome ;
$corpo_mail .= "\n Telefone: ".$telefone ;
$corpo_mail .= "\n E-mail: ".$de;
$corpo_mail .= "\n Assunto: ".$assunto ;
$corpo_mail .= "\n Categoria: ".$categoria;
$corpo_mail .= "\n \n Mensagem: \n".$mensagem ;

$mail_conf = "Olá, ". $nome . "\n";
$mail_conf .= "Recebemos sua Mensagem enviada através do site www.tlccampinas.com.br \n \n";
$mail_conf .= "Logo alguém da nossa família irá ler e te responder ;) \n \n";
$mail_conf .= "Que Deus te abençoe, Sempre Mais Alto! \n \n";
$mail_conf .= "Sua mensagem foi enviada assim: ";
$mail_conf .= "\n Nome: " . $nome ;
$mail_conf .= "\n Telefone: ".$telefone ;
$mail_conf .= "\n E-mail: ".$de;
$mail_conf .= "\n Assunto: ".$assunto ;
$mail_conf .= "\n \n Mensagem: \n".$mensagem ;

if ($categoria == "informacoes"){
	$para = "contato@tlccampinas.com.br";
}elseif ($categoria == "intercambio"){
	$para = "contato@tlccampinas.com.br";
}elseif ($categoria == "tlc"){
	$para = "fichas@tlccampinas.com.br";
}elseif ($categoria == "mini"){
	$para = "mini@tlccampinas.com.br";
}elseif ($categoria == "formacoes"){
	$para = "formacao@tlccampinas.com.br";
}elseif ($categoria == "guada"){
	$para = "guada@tlccampinas.com.br ";
}elseif ($categoria == "escalada"){
	$para = "escalada@tlccampinas.com.br";
}elseif ($categoria == "vivencia"){
	$para = "vivencia@tlccampinas.com.br";
}

$email_servidor = $para;

if ($nome && validaEmail($de) && $mensagem && $spam==false ) {
    enviaEmail($de, $assunto, $corpo_mail , $para, $email_servidor);
    enviaEmail($para, $assunto, $mail_conf, $de , $email_servidor);
    $ret = "<FONT COLOR='green'> Mensagem Enviada com Sucesso!</FONT>";
    
    
} else {
    $ret = "<FONT COLOR='red'> Ocorreu um problema no envio da sua mensagem! </FONT>";
}


echo ("<center><h2 class='sec-title sec-title__lg-title'><span>".$ret."</center></span></h2>");

if($spam==true){
$ret = "<FONT COLOR='red'> Um conteúdo de SPAN foi detectado na sua mensagem... :( </FONT>";
echo ("<center><h2 class='sec-title sec-title__lg-title'><span>".$ret."</center></span></h2>");
}


?>