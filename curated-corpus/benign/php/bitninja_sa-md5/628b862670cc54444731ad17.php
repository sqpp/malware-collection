<?php 
// echo '<pre>';print_r('hello');echo '</pre>';exit();
$_POST['action'] = 'check_first_time';
// $_POST['id'] = '6512';
require_once 'include/php_functions.php';
// $_POST['action'] = 'get_user_subsctiptions_status';

if ($_POST['action'] == 'get_user_subsctiptions_status') {
    // echo 'false';
    // PRODUCTION STAGING 
    // $user_token = $_POST['token'];
    
    // DEVELOPMENT - TESTING
    // subscription expired (no signal)
    $respoce = [];
    $user_token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI5NGZhMTUwYS01NDQ4LTQ1YzEtOTRkOC03ZDI5NTgzNTUxMjYiLCJqdGkiOiJhZDU3ZGU3ZGVkOWMyOGI2ZDE5YzY0ZWMwNmQxZjg2MzU2ZDdkNGYzYjhlZTFkMWVlMDBiZjdiZTk3MTg2ZTE0ZjkxYjc5Y2Q3ZDE2NGEwYSIsImlhdCI6MTY1MjMzMDYzMSwibmJmIjoxNjUyMzMwNjMxLCJleHAiOjE2ODM4NjY2MzEsInN1YiI6IjcwMjQiLCJzY29wZXMiOlsiYXV0aC11c2VyIl19.35OLPvUNL4o6GlIyE4zbY8JgcJ7lRs9Lvx5hzxnKZVgvmhMspzXEszU4PVSvVGsHZ_3e-sWB7TLIZ60xOTcZm3clEoNGj1V9F2GW8HX1JQ0oFmM_kKty1gnNFIiW8YcCYfbJIK-odKxsTV8GcegSVSanSfV1rOfMeGxYOn8GuiIBjdGr-yoc5M2d-6qVIRQBH3hr6byCSvl3CKKzbw08ws7GELhOOcKkp7vR_m6R5N9Q4oQEij7t1Eh7LMsZB3hNwRcXYasfSBJAOSe5CUTgyRbsovYaJ1rywafSbPYRlQqKL9xAWWth3AdTE60PiUa8hysKSuGHAjL75a838TL56nrCm9ef9-ER_T_6SSokzqids8ohXgN0udtC3_Hza3CdZIYfnl-uePBB_enbEpurJrNKRL_9v03B_x43s2ztNR6-H3vAqeLqcd5vxqC1JOPMOtSCItD68W_UypPIXNzlFSLgvDvNkCUVehVMQT-1qCbysFohzQbLeMcRdvMJcZcyNXPsFRAdrMxbXRL6-bpRFoPIe0-vhgWTyikZ3uGzPejlNFavEXFpEKXHk2UC4Yq-55Pyp82CXdXgpoanHf07ojrObBgaIFNORvRe6snQ7bMz3kLhFIDA6wVSf-A2MM3ZBafWYHdsYb1AS1UcIrCAlbpI9isy1aOZMwyFeZHBOtE';
    // subscribed user   
    // $user_token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI5NGZhMTUwYS01NDQ4LTQ1YzEtOTRkOC03ZDI5NTgzNTUxMjYiLCJqdGkiOiI5ZDczNjEwNTYwN2NlYTU4NWI4ZWEzZjk4MDg0MjNjZGZmZWMzMzYyZGQzZjIxMmNhODg0NTU4ZjQ4OGMwMmFhNTMwMDE3Mjc3ZjRjZmRlNyIsImlhdCI6MTY1MjMzMDQ4NSwibmJmIjoxNjUyMzMwNDg1LCJleHAiOjE2ODM4NjY0ODUsInN1YiI6IjY1MTIiLCJzY29wZXMiOlsiYXV0aC11c2VyIl19.llSmftZlPfPCxjnWnjskQYXwBUlKX96m42X60HYy4Tt0Mpnm290pEQbqxl5qvTVNxl7qGXjyZpf-o0KqSwXjZEx38RmIpqTd5Atr4znD3HSn4Wc9SzPhsyLdsnIjnB47wFyymzdd0S1yhkWJWJUh7u9__80mE-cs0WHObOptU4wuceEdUb2UifG6JiZVZfm604ZjJEq1Ki-x0bRQRj-Qf3nScXEpTH6FnfvhNkJd9pY8DHm2gl-L-yQL3Eu5oVmnIcvrIvh4WpA8hCMVHJ_xAdGtXt7YsFCQuFkOadR4VVfcSOvtYjsu0TH0gGeWGHvmHjtIl5u8S6t1Hgk3MiOZO9rwNYO5RxbOPiSMEQ0siwGrPlo8noYpZ_4Kw8AKr8owWVucU1WhtrB3IWXQCfXD4zfouM6uRAZ9w0JKLyMu4pFl9pn_kxXriqv7eH8ZEdb6SKs1vmyDvv9Nr6YZgve6tdys1yRX1ELNWq8hq0Uf_YzjLQUDDsCMimihScSQQMQarO8J-WFmpRXMfSx-yB0jrsqFZYPtbKoyx6t8kMwH82-XR_iql5Zn6bCSNNQzyAz4Mr65f0vueRbKk2SLpJQDyI3cGB6sH9q1Gncq67fmV53VwBC0USb5U0kRQ8UTCjPo8IB1vZk_RCmWoXq1-0yPSB3NObckhPQA1Ef8rLEgvNo';
    $token = ($_POST['token']) ? $_POST['token'] : $user_token;

    $verify_token = api_curl_2('verify-token', $post_fields = '', 'GET',$token);
    $verify_token_ary = json_decode($verify_token, true);
    if (isset($verify_token_ary['success']) && $verify_token_ary['success'] == true) {
        $post_fields = '';
        $api_curl = api_curl_2('user', $post_fields, 'GET',$token);
        $api_curl_ary = json_decode($api_curl, true);
        $uni_user_id = '';
        if (is_array($api_curl_ary) && count($api_curl_ary) > 0) {
            $uni_user_id = $api_curl_ary['data']['id'];
        }
        $check_service_duration = get_service_duration($uni_user_id);
        if (isset($check_service_duration) && $check_service_duration['success'] != '') {
            $respoce['success'] = true;
            $respoce['remaining_days'] = $check_service_duration['remaining_days']; 
            print_r(json_encode($respoce));
        } else {
            $respoce['success'] = false;
            print_r(json_encode($respoce));
        }
        // prine_r($respoce);
    }
} else if (isset($_POST['action']) && $_POST['action'] == 'check_first_time') {
    extract($_POST);
    $output = ["success" => false, "message" => ["error" => "Invalid Operation."]];
    $user_id = '';
    if(isset($_POST) && !empty($_POST['id'])){
        $user_id = $_POST['id'];
    } else {
        $output = ["success" => false, "message" => ["error" => "user id required."]];
    }
    $conn = start_connection();
    $edit_count = "SELECT edit_count FROM users WHERE id= ? ";
    $sql = $conn->prepare($edit_count);
    $sql->bind_param("i", $user_id);
    $sql->execute();
    $reponce = $sql->get_result();
    close_connection($sql, $conn);
    print_r($respoce);exit();
    // $respoce = [];
    // $user_token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI5NGZhMTUwYS01NDQ4LTQ1YzEtOTRkOC03ZDI5NTgzNTUxMjYiLCJqdGkiOiIzYWYzZThlNzMyNjg0YTA1MWFkMWFlMjA5N2RkYzgyYjc1Nzg5YzMxYWM0MTIxNGY4NzRkYjZmZjg1NDc0NDg2MjNiNTg0YWQ1OTEyN2MyMCIsImlhdCI6MTY1MjM0NzAwMC45MTE4NDgsIm5iZiI6MTY1MjM0NzAwMC45MTE4NTQsImV4cCI6MTY4Mzg4MzAwMC45MDIwMDMsInN1YiI6IjM3NTciLCJzY29wZXMiOlsiYXV0aC11c2VyIl19.0n7vv2l5InW_LlsCXqz_-j8kGw7MB0PQt8GGM_Hhq0_QGIE1Ryl45G4Q7pxi9i7LcIRQ20KGQIR2irYiENT1fwXw4MdP1WfMYDLG1HmBceIIt5XeVErbv6QktxphFLnieDX2luuN-mxtZkCRuPSCf4H8b0DfuFrQwMT-ueIkl1Bjqw72L_VT5gVuxNz0vqAYx_yNnBo-bkTaI6hczoWRGbHVIna3Lhds7s76txI0mti9iT0hZTPW-KqHcglC4cyr9wDNoDiPspmesdvehIVU8F4XCP7nvugRvzb1zHrsURyltp6nMoajRTXJAWlHypiB4oEbAkedGINnHyZtSmrbO5_gLEHksdrKCZhtYywrPj_PfMhM0wxHmrnyXOw3EnKfJNQash4kg-SzzqDmEupXV6O0PKwAFIYfY1txPAZdoDzA0_3rThGiFBrniUfBY0xrR1Ez3qQMCcEbSLoDVyZ2_RYpm-es7UihJ-BH9tcoR-FhYHFcwhIPDI4h6CHHqrxM4JduYTl2P7_hhxUc7rv2M9EBtLnUSo6ALDEfq1SR26COdxFUWc70lLmongQUT413k5YJ6UvFafRsGNL-4W0KYYGqGTJGCqGsBqD8i4ukdpHsrrXxcA-rUHhg5-8STgHwp8R24B0RIQZeFXuS8WOr_RdtiQMD2vHnGW7sNVJw3U8';
    
    // $token = ($_POST['token']) ? $_POST['token'] : $user_token;
    // $post_fields = 'id=' . $_POST['id'];
    // $api_curl = api_curl('edit-count', $post_fields);
    // $api_curl_ary = json_decode($api_curl, TRUE);

    // if (is_array($api_curl_ary) && count($api_curl_ary) > 0) {
    //     $output = $api_curl_ary;
    // }
    // echo json_encode($output);
} 

?>