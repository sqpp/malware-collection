<?php
session_start();
include('includes/config.php');
error_reporting(0);
if(strlen($_SESSION['login'])==0)
  { 
header('location:index.php');
}
else{

?>


<!DOCTYPE html>
<html lang="en">

<head>

    <title>Add Paper</title>

    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/core.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/components.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/menu.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../plugins/switchery/switchery.min.css">
    <script src="assets/js/modernizr.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">


</head>


<body class="fixed-left">

    <!-- Begin page -->
    <div id="wrapper">

        <!-- Top Bar Start -->
        <?php include('includes/topheader.php');?>
        <!-- Top Bar End -->


        <!-- ========== Left Sidebar Start ========== -->
        <?php include('includes/leftsidebar.php');?>
        <!-- Left Sidebar End -->

        <div class="content-page">
            <!-- Start content -->
            <div class="content">
                <div class="container">


                    <div class="row">
                        <div class="col-xs-12">
                            <div class="page-title-box">
                                <h4 class="page-title">Add Paper </h4>
                                <ol class="breadcrumb p-0 m-0">
                                    <li>
                                        <a href="#"> Paper</a>
                                    </li>
                                    <li>
                                        <a href="#">Add Paper </a>
                                    </li>
                                    <!--
                                        <li class="active">
                                            Add Tag
                                        </li>
-->
                                </ol>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->


                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card-box">
                                <h4 class="m-t-0 header-title"><b>Add Paper </b></h4>
                                <hr />
                                <?php
                                
                                   if (isset($_POST['submit']) && $_POST['id'] == "") {
         $imgFile = $_FILES['image']['name'];
              $tmp_dir = $_FILES['image']['tmp_name'];
              $imgSize = $_FILES['image']['size'];
              $upload_dir = 'img/'; // upload directory
                    $imgExt = strtolower(pathinfo($imgFile,PATHINFO_EXTENSION)); // get image extension
                    // valid image extensions
                    $valid_extensions = array('jpeg', 'jpg', 'png', 'gif'); // valid extensions
                    // rename uploading image
                    $userpic = rand(1000,1000000).".".$imgExt;
                    // allow valid image file formats
                    if(in_array($imgExt, $valid_extensions)){
                        // Check file size '5MB'
                        if($imgSize < 5000000){
                            move_uploaded_file($tmp_dir,$upload_dir.$userpic);
                        }
                        else{
                            $errMSG = "Sorry, your file is too large.";
                        }
                    }
                    else{
                        $errMSG = "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
                    }
        
        
        $sql = "INSERT INTO `paper`(`image`, `title`,`details`) VALUES('" . $userpic . "','" . $_POST['title'] . "','" . $_POST['details'] . "')";

        if (mysqli_query($con, $sql)) {
            
//                echo "<script> alert('Inserted Successfully');</script>";
            $msg='Inserted Successfully';
//               echo "<script>window.location.href='manage-institution.php';</script>";
                 
}
                else {
                     
                        $msg='Error inserting News Letter  details';
                    }
  }
                

                                ?>


                                <div class="row">
                                    <div class="col-sm-6">
                                        <!---Success Message--->
                                        <?php if($msg){ ?>
                                        <div class="alert alert-success" role="alert">
                                            <strong>Well done!</strong> <?php echo htmlentities($msg);?>
                                        </div>
                                        <?php } ?>

                                        <!---Error Message--->
                                        <?php if($error){ ?>
                                        <div class="alert alert-danger" role="alert">
                                            <strong>Oh snap!</strong> <?php echo htmlentities($error);?></div>
                                        <?php } ?>


                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-11">
                                        <form class="form-horizontal" name="Add Member" action="#" method="post" enctype="multipart/form-data">

                                            
<!--

                                            <div class="form-group">
                                                <label class="col-md-3 control-label"> Name</label>
                                                <div class="col-md-9">
                                                    <input type="text" class="form-control" value="" name="name" required>
                                                </div>
                                            </div>
-->
                                            
                                           
                                            <div class="form-group">
                                                <label class="col-md-2 control-label"> Image</label>
                                                <div class="col-md-10">
                                                    <img src="" id="previewImg" style="height: 150px;" alt=""><br>
                                                    <label class="btn btn-primary" for="image"><i class="fa fa-upload"></i> Upload</label>
                                                    <input type="file" class="d-none" id="image" name="image" style="display: none;" required>
                                                </div>
                                            </div>
                                          
                                           
                                           <div class="form-group">
	                                                <label class="col-md-2 control-label">Title</label>
	                                                <div class="col-md-10">
	                                                    <input type="text" class="form-control" value="" name="title" required>
	                                                </div>
	                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="col-md-2 control-label">Details </label>
                                                <div class="col-md-10">
                                                    <textarea class="form-control summernote" value="" name="details"></textarea>
                                                   
                                                </div>
                                            </div>
                                            

                                            <div class="form-group">
                                                <label class="col-md-3 control-label">&nbsp;</label>
                                                <div class="col-md-9">
                                                    <input type="hidden" name="id">
                                                    <button type="submit" class="btn btn-custom waves-effect waves-light btn-md" name="submit">
                                                        Submit
                                                    </button>
                                                </div>
                                            </div>

                                        </form>
                                    </div>


                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- end row -->


                </div> <!-- container -->

            </div> <!-- content -->

            <?php include('includes/footer.php');?>

        </div>
    </div>

    <script>
        var resizefunc = [];

    </script>

    <!-- jQuery  -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/detect.js"></script>
    <script src="assets/js/fastclick.js"></script>
    <script src="assets/js/jquery.blockUI.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="../plugins/switchery/switchery.min.js"></script>

    <!-- App js -->
    <script src="assets/js/jquery.core.js"></script>
    <script src="assets/js/jquery.app.js"></script>
    
        
    
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
    <script src="summernote/dist/summernote-gallery.min.js" type="text/javascript"></script>
<?php
     $output = '[';
    $run_img = mysqli_query($con, 'SELECT * FROM `tblpicture` ORDER BY `id` DESC');
    while ($row = mysqli_fetch_assoc($run_img)) {
        # code...
        $output .= '{
            "src": "postimages/' . $row['img'] . '",
            "title": "' . $row['img'] . '"
        },
        ';
    }
    $output .= ']';
    ?>
     <script>
        jQuery(document).ready(function() {
            // $("#previewImg").hide();
            var data = <?php echo $output; ?>;

            $('.summernote').summernote({
                height: 240, // set editor height
                minHeight: null, // set minimum height of editor
                maxHeight: null, // set maximum height of editor
                focus: false, // set focus to editable area after initializing summernote
                toolbar: [
                    ['insert', ['picture', 'link', 'video', 'table', 'hr', 'gallery']],
                    ['font style', ['fontname', 'fontsize', 'color', 'bold', 'italic',
                        'underline', 'strikethrough', 'superscript', 'subscript', 'clear'
                    ]],
                    ['paragraph style', ['style', 'ol', 'ul', 'paragraph', 'height']],
                    ['misc', ['fullscreen', 'codeview', 'undo', 'redo', 'help']]
                    ['extensions', ['gallery']],
                ],
                gallery: {
                    source: {
                        data: data,
                        // url: location.origin+location.pathname+'/server/example.json',
                        responseDataKey: 'data',
                        nextPageKey: 'links.next',
                    },
                    modal: {
                        loadOnScroll: true,
                        noImageSelected_msg: 'No image was selected, please select one by clicking it!',
                    }
                }
            });
            // Select2
            $(".select2").select2();

            $(".select2-limiting").select2({
                maximumSelectionLength: 2
            });
        });
    </script>

</body>

</html>
<?php } ?>
