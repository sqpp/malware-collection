<?php

session_start();
if(!isset($_SESSION['username'])){
	header('location:logout.php');
	exit();
}
require_once 'dbcon.php';
date_default_timezone_set('Asia/Colombo');
$userType= $_SESSION['userType'];
$cuserId = $_SESSION['userId'];
$idx = $_SESSION['userIdx'];
$userName =  $_SESSION['username'];

require_once 'DB/page_check.php';
$page_name = basename($_SERVER['PHP_SELF']);
$page_class = new page_check(); 
$page_check = $page_class->userLogin($page_name,$cuserId);
if($page_check != true){
    header('location:dialyplanTest.php');
}

$date="";

unset($_SESSION['insert']);
$tableName = $cuserId."claim_requsts";
$mtableName = $cuserId."meal_requsts";
$ltableName = $cuserId."lodging_requsts";



$db = new DbConnect();
$cn = $db->connect();
$con = $db->connect2();
$con3 = $db->connect3();
$con5 = $db->connect5();
$today = date("Y-m-d");

$sDate = strtotime($today);
$month = date('m',$sDate);
$year = date('Y',$sDate);

$a = 0;




//echo $_SESSION['numRules'];

$cuserSQL = "SELECT b.name,a.dep,a.emp_no,a.sub_type,b.salary_band_id FROM primela2_hasanka.login a
            LEFT JOIN primela2_inventrypela.emp_reg_master b ON a.emp_no = b.emp_no
            WHERE user_id = $cuserId";
$cuserQuery = $cn->query($cuserSQL);
$rowUsing = $cuserQuery->fetch_object();
$currentUser = $rowUsing->name;
$userDep = $rowUsing->dep;
$cEmp = $rowUsing->emp_no;
$sub_type = $rowUsing->sub_type;
$sal_band = $rowUsing->salary_band_id;



$exSQL = "select 1 from `$tableName` LIMIT 1";
//echo $exSQL;
$val = mysqli_query($cn,$exSQL);

if($val !== FALSE)
{
	//echo("This table exists");
	$_SESSION['tableCheck'] =1;
}

// $cuserNameSQL = "SELECT tl,desix FROM project_team WHERE idx = $teamId";
// $cuserNameQuery = $con->query($cuserNameSQL);
// $rowCUser = $cuserNameQuery->fetch_object();
// $teamLeader = $rowCUser->tl."-".$rowCUser->desix;


$type = "";
$message ="";
$create="";

if(isset($_POST['sub1']) || isset($_POST['sub2']) || isset($_POST['sub3']) ){
	
	$cat = "";
	$qty = "";
	$rate = "";
	$selectedDesc = "";
	$amount = "";
	$wo = "";
	$date = "";
	$requesterId = "";
	$shared = 0;
	
	if(isset($_POST['staticUser3'])){
		$requesterId = $_POST['staticUser3'];
	}
	if(isset($_POST['staticUser2'])){
		$requesterId = $_POST['staticUser2'];
	}
	if(isset($_POST['staticUser'])){
		$requesterId = $_POST['staticUser'];
	}
	if(isset($_POST['category'])){
		$cat = $_POST['category'];	
	}
	if(isset($_POST['qty'])){
		$qty = $_POST['qty'];	
	}
	if(isset($_POST['rate'])){
		$rate = $_POST['rate'];	
	}
	if(isset($_POST['amount'])){
		$amount = $_POST['amount'];	
	}
	if(isset($_POST['woI'])){
		$wo = $_POST['woI'];
		
	}
	//echo $requesterId;
	//meal
	if(isset($_POST['staicCat'])){
		$cat = $_POST['staicCat'];	
	}
	if(isset($_POST['mqty'])){
		$qty = $_POST['mqty'];	
	}
	if(isset($_POST['staticRate'])){
		$rate = $_POST['staticRate'];	
	}
	if(isset($_POST['staticAmount'])){
		$amount = $_POST['staticAmount'];
			//echo $_POST['staticAmount'];
			//echo "test";
	}
	if(isset($_POST['staticM'])){
		$wo = $_POST['staticM'];
	}
	if(isset($_POST['staticDis'])){
		$selectedDesc = $_POST['staticDis'];
	}
	if(isset($_POST['shared'])){
		$shared = $_POST['shared'];
	}
	
	//lodging
	if(isset($_POST['staiclCat'])){
		$cat = $_POST['staiclCat'];	
	}
	if(isset($_POST['lqty'])){
		$qty = $_POST['lqty'];	
	}
	if(isset($_POST['staticlRate'])){
		$rate = $_POST['staticlRate'];	
	}
	if(isset($_POST['staticlAmount'])){
		$amount = $_POST['staticlAmount'];
			//echo $_POST['staticAmount'];
			//echo "test";
	}
	if(isset($_POST['staticlM'])){
		$wo = $_POST['staticlM'];
	}
	if(isset($_POST['staticlDis'])){
		$selectedDesc = $_POST['staticlDis'];
	}
	$mealMem = array();
	if(isset($_POST['toy'])){
		$mealMem = $_POST['toy'];
	}
	
	$date = $_SESSION['sdate'];
	$_SESSION['swo'] = $wo;
	
	$_SESSION['$requesterId'] = $requesterId;

	$balanceSQL = "SELECT * FROM float_detail WHERE user_id = $requesterId";
	//echo $balanceSQL;
	$balanceQuery = $cn->query($balanceSQL);
	$floatAvailable = $balanceQuery ->num_rows;


	if($floatAvailable > 0) {

		$dep= "";

		if(isset($_SESSION['userDEP'])){
			$dep = $_SESSION['userDEP'];
		}

	
    $reqIdx = 0;
	if($dep == 2){
		$reqDetails = "SELECT name FROM login WHERE user_id = $requesterId";
	$reqDetailsQ = $cn->query($reqDetails);
	$reqDetailR = $reqDetailsQ->fetch_object();
	$logName = $reqDetailR->name;
	$_SESSION['$requesterName'] = $logName;
	}

	else{
	$reqDetails = "SELECT idx FROM login WHERE user_id = $requesterId";
	$reqDetailsQ = $cn->query($reqDetails);
	$reqDetailR = $reqDetailsQ->fetch_object();
	$reqIdx = $reqDetailR->idx;

	$clientDSQL = "SELECT clientx FROM work_order WHERE Work_Orderx = '$wo'";
	//echo $clientDSQL;
	$clientDqu = $con->query($clientDSQL);
	$clientDR2 = $clientDqu->fetch_object();
	$clientD = $clientDR2->clientx;

	if($clientD != 0){
	$reqDetails2 = "SELECT tl_name,desix FROM planx WHERE idx = $reqIdx";
	$reqDetailsQ2 = $con->query($reqDetails2);
	$reqDetailR2 = $reqDetailsQ2->fetch_object();
	$tl_name = $reqDetailR2->tl_name;
	$desix = $reqDetailR2->desix;

	$_SESSION['$requesterName'] = $tl_name."-".$desix;
	}
	else{
			$reqDetails = "SELECT name FROM login WHERE user_id = $requesterId";
	$reqDetailsQ = $cn->query($reqDetails);
	$reqDetailR = $reqDetailsQ->fetch_object();
	$logName = $reqDetailR->name;
	$_SESSION['$requesterName'] = $logName;
	}
	}
	$creatTable = "CREATE TABLE `$tableName` (
					  `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
					  `cat` int(2) NOT NULL,
					  `descr` varchar(255) NOT NULL,
					  `qty` double NOT NULL,
					  `rate` double(8,2) NOT NULL,
					  `amount` double(8,2) NOT NULL,
					  `user` int(4) NOT NULL,
					  `wo` varchar(15) NOT NULL,
					  `wo_date` date NOT NULL,
					  `req_date` date NOT NULL,
					  `p_req` int(1) NOT NULL DEFAULT '0',
					  `shared` int(1) NOT NULL,
					  `sub_ad_id` int(1) NOT NULL DEFAULT '0'
						)";
	$mealTable = "CREATE TABLE `$mtableName` (
					  `id` int(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
					  `wo` varchar(50) NOT NULL,
					  `name` varchar(255) NOT NULL,
					  `datex` date NOT NULL,
					  `team` varchar(255) NOT NULL,
					  `emp_code` int(11) NOT NULL,
					  `month` int(11) NOT NULL,
					  `year` int(11) NOT NULL,
					  `amount` double(12,2) NOT NULL
					)";
	
	$lodgingTable = "CREATE TABLE `$ltableName` (
					  `id` int(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
					  `wo` varchar(50) NOT NULL,
					  `name` varchar(255) NOT NULL,
					  `datex` date NOT NULL,
					  `team` varchar(255) NOT NULL,
					  `emp_code` int(11) NOT NULL,
					  `idx` int(11) NOT NULL,
					  `amount` double(12,2) NOT NULL
					)";
	$create = mysqli_query($cn,$creatTable);
	if(!empty($create)){
		$_SESSION['tableCheck'] = 1;
		$create = mysqli_query($cn,$mealTable);
		$create = mysqli_query($cn,$lodgingTable);
		//echo $mealTable;
	}

	$a = $_SESSION['tableCheck'];
	//echo $a;
	if( $a == 1){
	//$selectedDesc = "";
	if(isset($_POST['choices'])){
	    //echo 'testaaa';
		$desc = $_POST['choices'];
		foreach( $desc as $n ) {
		 $selectedDesc = $n;
		}
	}
	
	else if(isset($_POST['choicesT'])){
	    //echo 'testqqqqqqq';
		$selectedDesc  = $_POST['choicesT'];
		
	}
	
	if($cat == 'sp'){
	    if(isset($_POST['sub_choices'])){
    	    //echo 'test';
    	    $selectedDesc  = $_POST['sub_choices'];
	    }
	}
	
	
	
	$catIdSQL = "SELECT id FROM claim_category WHERE uni_code = '$cat'";
	//echo $catIdSQL;
	$catIdQuery = $cn -> query($catIdSQL);
	$rowCatID = $catIdQuery->fetch_object();
	
	$catId = $rowCatID->id;
	$sub_ad_id = 0;
	if($catId == 10){
	    list($selectedDesc,$sub_ad_id) = explode("-",$selectedDesc);
	    
	}
	//echo $date;
	$insertSQL = "INSERT INTO `$tableName`( `cat`, `descr`, `qty`, `rate`, `amount`, `user`, `wo`, `wo_date`,`req_date`,`shared`,`sub_ad_id`) 
					VALUES ('$catId','$selectedDesc','$qty','$rate','$amount','$requesterId','$wo','$date','$today','$shared','$sub_ad_id')";
	//echo $insertSQL;


		$cdate = $_SESSION['sdate'];
		$checkMeal = "SELECT * FROM claim_requests WHERE user = $requesterId AND wo_date = '$cdate' AND cat = 8";
		
		//echo $checkMeal;
		$checkLo = "SELECT * FROM claim_requests WHERE user = $requesterId AND wo_date = '$cdate' AND cat = 9";
		//echo $checkLo;

		$validationSQL = "select 1 from `$tableName` LIMIT 1";
		//echo $validationSQL;
		$val = mysqli_query($cn,$validationSQL);

		$checkMealQ = $cn->query($checkMeal);
		$checkLoQ = $cn->query($checkLo);
		
		
		$mealR = $checkMealQ->num_rows;
		$loR = $checkLoQ->num_rows;
		$meaNewlR = 0;
		$loNewR = 0;
		if(!empty($val)){
			//echo "test";
			
			$checkNewMeal = "SELECT * FROM `$tableName` WHERE user = $requesterId AND wo_date = '$cdate' AND cat = 8";
			//echo $checkNewMeal."<br>";
			$checkNewLo = "SELECT * FROM `$tableName` WHERE user = $requesterId AND wo_date = '$cdate' AND cat = 9";
			//echo $checkNewLo."<br>";
			$checkNewMealQ = $cn->query($checkNewMeal);
			$checkNewLoQ = $cn->query($checkNewLo);
			$meaNewlR = $checkNewMealQ->num_rows;
			$loNewR = $checkNewLoQ->num_rows;
		
		}
		//echo $meaNewlR."<br>";
		//echo $mealR."<br>"; 

		if($catId == 8){

			if($mealR == 0 ){
				if($meaNewlR == 0){

				$result = mysqli_query($cn,$insertSQL);
				 if (!empty($result)) {

				 	foreach( $mealMem as $n ) {
		 				//echo $n."<br>";
		 				list($teamN,$teamMN,$emp_code) = explode("-", $n);

		 				$mealSQL = "INSERT INTO `$mtableName`( `wo`, `name`, `datex`, `team`,`emp_code`,`year`,`month`,amount) VALUES ('$wo','$teamMN','$date','$teamN',$emp_code,$year,$month,$rate)";
		 				//echo $mealSQL;
		 				$resultM = mysqli_query($cn,$mealSQL);
		}

                        $type = "success";
                        $message = "Claim request updated";
                    } else {
                        $type = "error";
                        $message = "Can not update claim request #2";
                    }

                }
                else{
            	$type = "error";
                $message = "Meal details already added";
            }

			}
			
			else{
            	$type = "error";
                $message = "Meal details already added";
            }

		}

		if($catId == 9){

			if($loR == 0){

				if($loNewR == 0){
					$result = mysqli_query($cn,$insertSQL);
					
					foreach( $mealMem as $n ) {
		 				//echo $n."<br>";
		 				list($teamN,$teamMN,$emp_code) = explode("-", $n);

		 				$mealSQL = "INSERT INTO `$ltableName`( `wo`, `name`, `datex`, `team`,`emp_code`,idx,amount) VALUES ('$wo','$teamMN','$date','$teamN',$emp_code,$reqIdx,'$rate')";
		 				//echo $mealSQL;
		 				$resultM = mysqli_query($cn,$mealSQL);
		}
					
					 if (!empty($result)) {

	                        $type = "success";
	                        $message = "Claim request updated";
	                    } else {
	                        $type = "error";
	                        $message = "Can not update claim request #2";
	                    }
	                }
	                	else{
			            	$type = "error";
			                $message = "Lodging details already added";
			            }

			}
			else{
            	$type = "error";
                $message = "Lodging details already added";
            }

		}
		if($catId != 9 && $catId != 8){
			$result = mysqli_query($cn,$insertSQL);
			if (! empty($result)) {

                        $type = "success";
                        $message = "Claim request updated";
                    } else {
                        $type = "error";
                        $message = "Can not update claim request #2";
                    }
		}
		
}


}
else{
	 $type = "error";
     $message = "Requester has not cash float";
}
}

if(isset($_POST['delete'])){
	$claimId = $_POST['id'];

	$checkCatSQL = "SELECT cat,wo,wo_date,user FROM `$tableName` WHERE id = $claimId";
	$checkCatQuery = $cn->query($checkCatSQL);
	$checkCatRow = $checkCatQuery->fetch_object();
	$catDel = $checkCatRow->cat;

	if($catDel == 8 ){
		$woDel = $checkCatRow->wo;
		$dateDel = $checkCatRow->wo_date;
		$userDel = $checkCatRow->user;

		$userIdxSQL = "SELECT idx FROM login WHERE user_id = $userDel";
		$userIdxQuery = $cn->query($userIdxSQL);
		$userIdxRow = $userIdxQuery->fetch_object();
		$userIdx = $userIdxRow->idx;

		$userTlSQL = "SELECT mark_relationship FROM project_team WHERE idx = $userIdx";
		//echo $userTlSQL;
		$userTlQuery = $con->query($userTlSQL);
		$userTlRow = $userTlQuery->fetch_object();
		$userTl = $userTlRow->mark_relationship;

		$deleteSQL = "DELETE FROM `$tableName` WHERE id = '$claimId'";
		$deleteMSQL = "DELETE FROM `$mtableName` WHERE team = '$userTl' AND datex = '$dateDel' AND wo = '$woDel'";
		//echo $deleteMSQL;

		$result = mysqli_query($cn,$deleteSQL);
	
					 if (! empty($result)) {
						 $result = mysqli_query($cn,$deleteMSQL);




						$selectAll = "SELECT * from `$tableName`";
						$allQuery=$cn->query($selectAll);
						$numRows = $allQuery->num_rows;
						if($numRows == 0){
							$deleteTable ="DROP TABLE `$tableName`";
							$result1 = mysqli_query($cn,$deleteTable);

						$selectMAll = "SELECT * from `$mtableName`";
						$allMQuery=$cn->query($selectMAll);
						$numMRows = $allMQuery->num_rows;
						if($numMRows == 0){
							$deleteMTable ="DROP TABLE `$mtableName`";
							$result1 = mysqli_query($cn,$deleteMTable);
						}
						
						    $deleteLTable ="DROP TABLE `$ltableName`";
							$result1 = mysqli_query($cn,$deleteLTable);
						

							$_SESSION['tableCheck'] = 0;
						}


						

                        $type = "success";
                        $message = "Claim request successfully deleted";
                    } else {
                        $type = "error";
                        $message = "Can not delete claim request";
                    }
	}
	
	else if($catDel == 9){
	    $woDel = $checkCatRow->wo;
		$dateDel = $checkCatRow->wo_date;
		$userDel = $checkCatRow->user;

		$userIdxSQL = "SELECT idx FROM login WHERE user_id = $userDel";
		$userIdxQuery = $cn->query($userIdxSQL);
		$userIdxRow = $userIdxQuery->fetch_object();
		$userIdx = $userIdxRow->idx;

		$userTlSQL = "SELECT mark_relationship FROM project_team WHERE idx = $userIdx";
		//echo $userTlSQL;
		$userTlQuery = $con->query($userTlSQL);
		$userTlRow = $userTlQuery->fetch_object();
		$userTl = $userTlRow->mark_relationship;

		$deleteSQL = "DELETE FROM `$tableName` WHERE id = '$claimId'";
		$deleteMSQL = "DELETE FROM `$ltableName` WHERE team = '$userTl' AND datex = '$dateDel' AND wo = '$woDel'";
		//echo $deleteMSQL;

		$result = mysqli_query($cn,$deleteSQL);
	
					 if (! empty($result)) {
						 $result = mysqli_query($cn,$deleteMSQL);




						$selectAll = "SELECT * from `$tableName`";
						$allQuery=$cn->query($selectAll);
						$numRows = $allQuery->num_rows;
						if($numRows == 0){
							$deleteTable ="DROP TABLE `$tableName`";
							$result1 = mysqli_query($cn,$deleteTable);

						
							$deleteMTable ="DROP TABLE `$mtableName`";
							$result1 = mysqli_query($cn,$deleteMTable);
						    
						    $deleteLTable ="DROP TABLE `$ltableName`";
							$result1 = mysqli_query($cn,$deleteLTable);
						
						

							$_SESSION['tableCheck'] = 0;
						}


						

                        $type = "success";
                        $message = "Claim request successfully deleted";
                    } else {
                        $type = "error";
                        $message = "Can not delete claim request";
                    }
	}
	
	else{
	
	$deleteSQL = "DELETE FROM `$tableName` WHERE id = '$claimId'";

		$result = mysqli_query($cn,$deleteSQL);
	
					 if (! empty($result)) {
						 
						$selectAll = "SELECT * from `$tableName`";
						$allQuery=$cn->query($selectAll);
						$numRows = $allQuery->num_rows;
						if($numRows == 0){
							$deleteTable ="DROP TABLE `$tableName`";
							$result1 = mysqli_query($cn,$deleteTable);
							
							$deleteLTable ="DROP TABLE `$ltableName`";
							$result1 = mysqli_query($cn,$deleteLTable);

				// 				$selectMAll = "SELECT * from `$mtableName`";
				// 		$allMQuery=$cn->query($selectMAll);
				// 		$numMRows = $allMQuery->num_rows;
				// 		if($numMRows == 0){
							$deleteMTable ="DROP TABLE `$mtableName`";
							$result1 = mysqli_query($cn,$deleteMTable);
						//}
							$_SESSION['tableCheck'] = 0;
						}

                        $type = "success";
                        $message = "Claim request successfully deleted";
                    } else {
                        $type = "error";
                        $message = "Can not delete claim request";
                    }
                }
}

if(isset($_POST['req'])){


	$tempTableSQL = "SELECT * FROM `$tableName`";

	$tempQuery = $cn->query($tempTableSQL);
	$test = 0;
	// while($tempRow = $tempQuery->fetch_object()){

	// 	$totalAmount = $tempRow->amount;
	// 	$rqUser = $tempRow->user;
	// 	//echo $rqUser."<br>";

	// 	$balanceSQL = "SELECT balance FROM float_detail WHERE user_id = $rqUser";
	// 	//echo $balanceSQL."<br>";
	//     $balanceQuery = $cn->query($balanceSQL);

	//     $balanceRow = $balanceQuery->fetch_object();
	// 	$balance = $balanceRow->balance;
	// 	//echo $balance."<br>";
	// 	$balance =  $balance - $totalAmount ;
	// 	//echo $balance."<br>";
	// 	//echo $totalAmount."<br>";
	// 	$updateBalance = "UPDATE `float_detail` SET `balance` = $balance WHERE `user_id` = $rqUser";
	// 	$updateResult = mysqli_query($cn,$updateBalance);

	// }

	// 	if(!empty($updateResult)){


	
	$insertSQL = "INSERT INTO `claim_requests`(`cat`, `descr`, `qty`, `rate`, `amount`, `user`, `wo`, `wo_date`, `p_req`, `req_date`,`shared`,`sub_ad_id`,`i_user`)
					SELECT `cat`, `descr`, `qty`, `rate`, `amount`, `user`, `wo`, `wo_date`, `p_req`, `req_date` ,`shared`,`sub_ad_id`,$cuserId
					FROM `$tableName`";

	$inserMSQL = "INSERT INTO `meal_detail`(`wo`, `name`, `datex`, `team`,`emp_code`,`year`,`month`,amount) 
					SELECT `wo`, `name`, `datex`, `team`,`emp_code`,`year`,`month`,amount
					FROM `$mtableName`";
					
	$inserLSQL = "INSERT INTO `lodging_detail`(`wo`, `name`, `datex`, `team`,`emp_code`,`idx`,amount) 
					SELECT `wo`, `name`, `datex`, `team`,`emp_code`,`idx`,amount
					FROM `$ltableName`";
					
	// $amountSQL = "SELECT SUM(amount) as total FROM `$tableName`";
	// $amountQuery = $cn -> query($amountSQL);
	// $amountRow = $amountQuery->fetch_object();
	// $totalAmount = $amountRow->total;
	
	
	// $balanceSQL = "SELECT balance FROM float_detail WHERE user_id = $cuserId";
	// $balanceQuery = $cn->query($balanceSQL);
	
	
	// $floatAvailable = $balanceQuery -> num_rows;

	$insertResult = mysqli_query($cn,$insertSQL);
	
	
	if(!empty($insertResult)){
		//echo "test";
		
		$select_re_sql = "SELECT amount,descr,wo,wo_date,user FROM `$tableName` WHERE  `cat` = 4";
                    $select_re_query = mysqli_query($cn,$select_re_sql);
                    $re_num_rows = mysqli_num_rows($select_re_query);
                    if($re_num_rows > 0){
                        while($re_row = mysqli_fetch_array($select_re_query)){
                            $amount = $re_row['amount'];
                            $desc = $re_row['descr'];
                            $wo = $re_row['wo'];
                            $wo_date = $re_row['wo_date'];
                            $user = $re_row['user'];
                            echo $desc;
                            $user_emp_no_sql = "SELECT emp_no,dep FROM login where user_id = $user";
                            $user_emp_no_query = mysqli_query($cn,$user_emp_no_sql);
                            $user_emp_no_row = mysqli_fetch_array($user_emp_no_query);
                            $user_emp_no = $user_emp_no_row['emp_no'];
                            $user_dep = $user_emp_no_row['dep'];
                            //echo $user_emp_no."<br>";
                            if($user_emp_no != 0){
                                $vehicle_no_sql = "SELECT vehicle_no FROM vehicle_assign WHERE emp_no = '$user_emp_no' AND status = 1";
                                $vehicle_no_query = mysqli_query($cn,$vehicle_no_sql);
                                $vehicle_no_row = mysqli_fetch_array($vehicle_no_query);
                                $vehicle_no = $vehicle_no_row['vehicle_no'];
                               // echo $vehicle_no."<br>";
                                if($vehicle_no != ''){
                                    $v_insert_sql = "INSERT INTO `vehicle_rem`( `v_no`, `emp_no`, `reason`, `amount`, `wo`, `r_date`,`dep`,`paid_user`) VALUES
                                            ('$vehicle_no',$user_emp_no,'$desc',$amount,'$wo','$wo_date',$user_dep,$user)";
                                   // echo $v_insert_sql;
                                    mysqli_query($cn,$v_insert_sql);
                                }
                            }
                        }
                    }
		$_SESSION['tableCheck'] = 0;
		$insertResult = mysqli_query($cn,$inserMSQL);
		$insertResult = mysqli_query($cn,$inserLSQL);
		$deleteSQL = "DELETE FROM `$tableName`";
		$deleteTable ="DROP TABLE `$tableName`";
		$result = mysqli_query($cn,$deleteSQL);
		$result1 = mysqli_query($cn,$deleteTable);

		
		if(!empty($result)){

			$deleteMSQL = "DELETE FROM `$mtableName`";
		$deleteMTable ="DROP TABLE `$mtableName`";
		$deleteLTable ="DROP TABLE `$ltableName`";
		$result1 = mysqli_query($cn,$deleteLTable);
		$resultM = mysqli_query($cn,$deleteMSQL);
		$resultM1 = mysqli_query($cn,$deleteMTable);
			
			$_SESSION['sdate'] = "";
			$_SESSION['swo'] = "";
			$_SESSION['$requesterName'] = "";
            $type = "success";
            $message = "Claim requests successfully submited";
         } else {
            $type = "error";
            $message = "Can not submit claim requests - #1 ";
         }
			
		}
		else {
            $type = "error";
            $message = "Can not submit claim requests - #2 ";
         }
     // }
     // else {
     //        $type = "error";
     //        $message = "Can not submit claim requests - #3 ";
     //     }

  
     
		
	}
	
	
	$planQuery ="";
	if(isset($_POST['search'])){ 	
			$date = $_POST['sdate'];
			$_SESSION['sdate'] = $date;

			

	
	
	// if($userType == 1){
	// 	$planSQL = "SELECT * FROM planx WHERE datex='$date' AND work_order != 'Leave' AND work_order != 'Office' AND work_order != 'Stand By'";
	// }
	// else{
	// $planSQL = "SELECT * FROM planx WHERE datex='$date' AND idx='$idx' AND work_order != 'Leave'";
	// }
	// $planQuery = $con->query($planSQL);
	
	// $numSQL = "SELECT * FROM `att_mark_record` WHERE `ass_team`='$userName' AND `date`='$date' AND att = 1";
	// //echo "<br>".$numSQL;
	// $numQuery = $con3 -> query($numSQL);
	// $_SESSION['numRules'] = 0;
	// $_SESSION['numRules'] = $numQuery->num_rows;
	
	}
	
	if($_SESSION['sdate'] != ""){	
	$date = $_SESSION['sdate'];
	$_SESSION['sdate'] = $date;
	
	// if($userType == 1){
	// 	$planSQL = "SELECT * FROM planx WHERE datex='$date' AND work_order != 'Leave' AND work_order != 'Office' AND work_order != 'Stand By'";
	// }
	// else{
	// $planSQL = "SELECT * FROM planx WHERE datex='$date' AND idx='$idx' AND work_order != 'Leave'";
	// }
	// $planQuery = $con->query($planSQL);
	
	// $numSQL = "SELECT * FROM `att_mark_record` WHERE `ass_team`='$userName' AND `date`='$date' AND att = 1";
	// //echo "<br>".$numSQL;
	// $numQuery = $con3 -> query($numSQL);
	// $_SESSION['numRules'] = 0;
	// $_SESSION['numRules'] = $numQuery->num_rows;
	
	}



?>

<HTML>
<HEAD>
	<TITLE> Requesting claims  </TITLE>

	<style>
	.tableFixHead          { overflow-y: auto; overflow-x: auto; height: 50px; }
	.tableFixHead thead th { position: sticky; top: 0; }
	th     { background:#eee; }
	
					#response {
			padding: 10px;
			margin-top: 10px;
			border-radius: 2px;
			display:none;
		}

		.success {
			background: #c7efd9;
			border: #bbe2cd 1px solid;
		}

		.error {
			background: #fbcfcf;
			border: #f3c6c7 1px solid;
		}

		div#response.display-block {
			display: block;
		}

		#checkbox-dropdown-container {
	background: #99d3de;
	padding: 20px;
}
.custom-select {
    background: #FFF url(downward-arrow.png) no-repeat center right 10px;
    display: inline-block;
    padding: 5px 15px;
    border: #80b2bb 1px solid;
    color: #3892a2;
    border-radius: 2px;
    width: 200px;
    cursor:pointer;
    
}
div#custom-select-option-box {
    background: #FFF;
    border: #80b2bb 1px solid;
    color: #3892a2;
    border-radius: 2px;
    position:absolute;
    z-index:1;
    display:none;
}

div#custom-select-option-box_lodging {
    background: #FFF;
    border: #80b2bb 1px solid;
    color: #3892a2;
    border-radius: 2px;
    position:absolute;
    z-index:1;
    display:none;
}
button.search.btn {
   	background: #4c4c4c;
    border: #353535 1px solid;
    color: #ffffff;
    border-radius: 2px;
    padding: 8px 40px;
    margin-top: 20px;
    font-size: 0.9em;
}
.custom-select-option {
    width: 200px;
    padding: 5px 15px;
    margin: 1px 0px;
    cursor:pointer;
}

.custom-select-option_lodging {
    width: 200px;
    padding: 5px 15px;
    margin: 1px 0px;
    cursor:pointer;
}
.custom-select-option:hover {
    
}
.result-list {
    padding-bottom: 20px;
    color: #4d4d4d;
    line-height: 25px;
}
.result-list-heading {
    font-style: italic;
    color: #717171;
    text-decoration: underline;
}
	</style>
		
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link href='CSS/select2.min.css' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="CSS/bootstrap.min.css">
<link rel="stylesheet" href="CSS/wo.css">

<link rel="stylesheet" href="CSS/normalize.min.css">
   	 <link rel="stylesheet" href="CSS/combo.select.css">
     <link rel="stylesheet" href="CSS/jquerysctipttop.css">

<script src="JS/jquery-3.2.1.slim.min.js" ></script>
<script src="JS/popper.min.js"></script>
<script src="JS/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

 <script src="JS/jquery.combo.select.js"></script>
 
 <link rel="stylesheet" href="JS/ui/themes/base/jquery-ui.css">
 <script src='JS/select2.min.js' type='text/javascript'></script>

    <script>
			$(document).ready(function(){
				$("#rate").on("input", function(){
					var a = $(this).val();
					var b = $("#qty").val();
					//var select = $("#choices").val();
					var z = a * b;
					$("#amount").val(z);
					//$("#selectedValue").text(select);
				});
	
			});
			
			if ( window.history.replaceState ) {
			    window.history.replaceState( null, null, window.location.href );
		    }
    </script>

</HEAD>
<BODY>

<?php
include 'navbar.php';
?>

	<?php

?>
	

 <div class="container-fluid">

	<div style="float:left;width:100%;margin-bottom:5px;padding:20px;" id="response" class="<?php if(!empty($type)) { echo $type . " display-block"; } ?>"><?php if(!empty($message)) { echo $message; } ?></div>
    <div class="row" style="padding:10px 20px 5px 20px;">
		<div class="col-12">
        	<form action="requests.php" method="post" style="float:left;" class="form-inline">
        		<div class="form-group" >
        			<label>Date</label> <INPUT  class="form-control col-md-12" type="date" id="sDate" name="sdate" value="<?php if($_SESSION['sdate'] != ""){ echo $_SESSION['sdate']; }?>" required>
        		</div>
        	
        		<div class="form-group" >
        			
        			<button class="btn btn-info" style="margin-top:22px; margin-left:5px;"  type="submit" name ="search" >Search</button>
        		</div>
        		
        			
        	</form>
        </div>
	</div>
	<?php
	if($_SESSION['sdate'] != ""){

		

	?>
	<div class="row" style="padding:5px 20px 5px 20px;">
		<div class="col-5">
		<form  class="form">
		<div class="form-group" >
	
				<label>Work Order ID</label>
			</div>
			<div class="form-group" >
				<select name="wo" id = "wo"  class="col-md-5" required>
				<option value="">-Select Workorder-</option>
									<?php

									//echo "Test";
					//if($planQuery != ""){
									$a=0;
				if($userType == 1 || $userType ==5){


						$planSQL = "SELECT * FROM planx WHERE datex='$date'  AND work_order != 'Leave' AND desix != 'TRP' AND desix != 'SUB'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){

						$planWO = $planRow->work_order;
						$cTeamName = $planRow->tl_name;
						$cTeamIdx = $planRow->idx;
						$desix = $planRow->desix;

						$cteamSQL = "SELECT user_id FROM login WHERE idx = $cTeamIdx";
						//echo $cteamSQL;
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();

						$teamIDX = $cteamQuery->num_rows;
						if($teamIDX > 0){
						$cTeamId = $cteamRow->user_id;


					
						
						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;
						

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3)";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules = $numQuery->num_rows;
							//echo $rules;
							
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3) AND `ass_team`=`team` ";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules_2 = $numQuery->num_rows;

							$cwoSQL = "select * from work_order where `departmentx` = 1 AND clientx = 0";
						//echo $cwoSQL;
						$cplanQuery = $con->query($cwoSQL);
						$cplanRow = $cplanQuery->fetch_object();
						$cplanWO = $cplanRow->Work_Orderx;

						if( $_SESSION['swo'] == $planWO){
							
						
					?>
				

					<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>" selected><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>

					<?php
						}
						else{
							?>
					
						<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>"><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>	
							
		
							<?php
						}
					}
					$a++;
						}
					
				//	}

				}
				else if($userType == 3){
				    
				    $userDepSQL = "SELECT dep,name FROM login WHERE user_id = $cuserId";
					$userDepQuery = $cn->query($userDepSQL);
					$userDepRow = $userDepQuery->fetch_object();
					$cUserDep = $userDepRow->dep;
					$_SESSION['userDEP'] = $cUserDep;
					$cUserName = $userDepRow->name;
					
				    $woSQL = "select * from work_order where `departmentx` = 6 AND clientx = 0";
						//echo $woSQL;
						$planQuery = $con->query($woSQL);
						
						$rules =0;
					while($planRow = $planQuery->fetch_object()){

						$planWO = $planRow->Work_Orderx;
						

						if( $_SESSION['swo'] == $planWO){
							
						
					?>
					<option value="<?php echo $planWO.'_'.$cuserId.'_'.$rules.'_'.$a; ?>" selected><?php echo $planWO." - ".$planRow->site."@". $cUserName; ?></option>
			
					<?php
						}
						else{
							?>
						<option value="<?php echo $planWO.'_'.$cuserId.'_'.$rules.'_'.$a; ?>"><?php echo $planWO." - ".$planRow->site."@". $cUserName; ?></option>	

							<?php
						}
						$a++;
						}
				}

				else if($userType == 10 || ($userType == 1 && $userDep ==0) || ($userType == 2 && $userDep ==2)){

					$userDepSQL = "SELECT dep,name FROM login WHERE user_id = $cuserId";
					$userDepQuery = $cn->query($userDepSQL);
					$userDepRow = $userDepQuery->fetch_object();
					$cUserDep = $userDepRow->dep;
					$_SESSION['userDEP'] = $cUserDep;
					$cUserName = $userDepRow->name;

					if($cUserDep == 2 || $userType == 1 || $userType == 2){

						$sDate = strtotime($_SESSION['sdate']);
						//echo $sDate;
						//$my = date('m',$sDate);
						//echo $my;

						$woMonth = 100;
						$month = date('m',$sDate);
						$year = date('Y',$sDate);
						$date = date('d',$sDate);

						if($date >= 26 && $date <= 31){
							$woMonth = $month;
						}
						else{
							$woMonth = $month -1;
						}

						if($woMonth == 0){
							$woMonth = $woMonth+12;
						}


					
						$woSQL = "select * from work_order where month(Date)= $woMonth AND `departmentx` = 2";
						//echo $woSQL;
						$planQuery = $con->query($woSQL);
						
						$rules =0;
					while($planRow = $planQuery->fetch_object()){

						$planWO = $planRow->Work_Orderx;
						

						if( $_SESSION['swo'] == $planWO){
							
						
					?>
					<option value="<?php echo $planWO.'_'.$cuserId.'_'.$rules.'_'.$a; ?>" selected><?php echo $planWO." - ".$planRow->site."@". $cUserName; ?></option>
			
					<?php
						}
						else{
							?>
						<option value="<?php echo $planWO.'_'.$cuserId.'_'.$rules.'_'.$a; ?>"><?php echo $planWO." - ".$planRow->site."@". $cUserName; ?></option>	

							<?php
						}
						$a++;
						}

					}

					else{
					$cteamSQL = "SELECT idx,username FROM login WHERE user_id = $cuserId";
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();
						$cTeamIdx = $cteamRow->idx;

						$planSQL = "SELECT * FROM planx WHERE datex='$date' AND idx = $cTeamIdx  AND work_order != 'Leave' ";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){

						$planWO = $planRow->work_order;
						$cTeamName = $planRow->tl_name;
						$cTeamIdx = $planRow->idx;
						$desix = $planRow->desix;

						$cteamSQL = "SELECT user_id FROM login WHERE idx = $cTeamIdx";
						//echo $cteamSQL;
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();
						$cTeamId = $cteamRow->user_id;
					

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;
						

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3)";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules = $numQuery->num_rows;
							//echo $rules;
							
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3) AND `ass_team`=`team` ";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules_2 = $numQuery->num_rows;

						if( $_SESSION['swo'] == $planWO){
							
						
					?>
					<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>" selected><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>
					<?php
						}
						else{
							?>
						<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>"><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>	
							<?php
						}
						$a++;
						}
					}

				}
					else{
					//if($planQuery != ""){

				//$clusterSQL = "SELECT teamId FROM clusters WHERE userId = $cuserId";
				$clusterSQL = "SELECT emp_no FROM emp_reg_master WHERE emp_dep_sup = $cEmp AND ac_dc = 0 AND salary_band_id = 2";
					//echo $clusterSQL."<br>";
					$clusterQuery = $con5->query($clusterSQL);
					while($clusterRow = $clusterQuery->fetch_object()){

						$emp_no =	$clusterRow->emp_no;
						$cteamSQL = "SELECT idx,username,user_id FROM login WHERE emp_no = $emp_no";
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();
						$cTeamIdx = $cteamRow->idx;
						$cTeamName = $cteamRow->username;
						$cTeamId = $cteamRow->user_id;

						$planSQL = "SELECT * FROM planx WHERE datex='$date' AND idx='$cTeamIdx' AND work_order != 'Leave'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$planWO = $planRow->work_order;
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3)";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules = $numQuery->num_rows;
							//echo $rules;
							
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3) AND `ass_team`=`team` ";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules_2 = $numQuery->num_rows;

						if( $_SESSION['swo'] == $planWO){
							
						
					?>
					<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>" selected><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>
					<?php
						}
						else{
							?>
						<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>"><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>	
							<?php
						}
						$a++;
						}
					}
					
					
					
						$cteamSQL = "SELECT idx,username,user_id FROM login WHERE emp_no = $cEmp";
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();
						$cTeamIdx = $cteamRow->idx;
						$cTeamName = $cteamRow->username;
						$cTeamId = $cteamRow->user_id;

						$planSQL = "SELECT * FROM planx WHERE datex='$date' AND idx='$cTeamIdx' AND work_order != 'Leave'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$planWO = $planRow->work_order;
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3)";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules = $numQuery->num_rows;
							//echo $rules;
							
							$numSQL = "SELECT DISTINCT name FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$date' AND (att = 1 OR att = 3) AND `ass_team`=`team` ";
							//echo "<br>".$numSQL;
							$numQuery = $cn -> query($numSQL);
							//$_SESSION['numRules'] = 0;
							$rules_2 = $numQuery->num_rows;

						if( $_SESSION['swo'] == $planWO){
							
						
					?>
					<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>" selected><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>
					<?php
						}
						else{
							?>
						<option value="<?php echo $planRow->work_order.'_'.$cTeamId.'_'.$rules.'_'.$a.'_'.$rules_2; ?>"><?php echo $planRow->work_order." - ".$planRow->site_name."@". $cTeamName."-".$desix; ?></option>	
							<?php
						}
						$a++;
						}
					
					
					}
					?>

					<?php

					$cplanWO= "";
					$cplanRow ="";

					if($userType == 2 && $userDep == 2){
					$cwoSQL = "select * from work_order where `departmentx` = 2 AND clientx = 0";
						//echo $cwoSQL;
						$cplanQuery = $con->query($cwoSQL);
						$cplanRow = $cplanQuery->fetch_object();
						$cplanWO = $cplanRow->Work_Orderx;
					}

					else if(($userType == 1 && $userDep == 1) || ($userType == 2 && $userDep == 1) ){
					$cwoSQL = "select * from work_order where `departmentx` = 1 AND clientx = 0";
						//echo $cwoSQL;
						$cplanQuery = $con->query($cwoSQL);
						$cplanRow = $cplanQuery->fetch_object();
						$cplanWO = $cplanRow->Work_Orderx;
					}


					else if($userType == 2 && $userDep == 4){
					$cwoSQL = "select * from work_order where `departmentx` = 4 AND clientx = 0";
						//echo $cwoSQL;
						$cplanQuery = $con->query($cwoSQL);
						$cplanRow = $cplanQuery->fetch_object();
						$cplanWO = $cplanRow->Work_Orderx;
					}

					else if((($userType == 10 || $userType == 7) && $userDep == 5) || ($userType == 1 && $userDep == 0)){
					$cwoSQL = "select * from work_order where `departmentx` = 5 AND clientx = 0";
						//echo $cwoSQL;
						$cplanQuery = $con->query($cwoSQL);
						$cplanRow = $cplanQuery->fetch_object();
						$cplanWO = $cplanRow->Work_Orderx;
					}

					?>
					<?php
					if(($userType == 2 && $userDep == 2) ||($userType == 1 && $userDep == 1) || ($userType == 2 && $userDep == 4) || (($userType == 10 || $userType == 7) && $userDep == 5) || ($userType == 1 && $userDep == 0) || ($userType == 2 && $userDep == 1) ){
						$userDepSQL = "SELECT dep,name FROM login WHERE user_id = $cuserId";
					$userDepQuery = $cn->query($userDepSQL);
					$userDepRow = $userDepQuery->fetch_object();
					$cUserDep = $userDepRow->dep;
					//$_SESSION['userDEP'] = $cUserDep;
					$cUserName = $userDepRow->name;
					?>
					<option value="<?php echo $cplanWO.'_'.$cuserId.'_'.'_'.$a; ?>"><?php echo $cplanWO." - ".$cplanRow->site."@". $cUserName; ?></option>	
					<?php
				}
					?>
				</select>

				
			</div>
	</form>
	</div>
		
	
	</div>
	<?php
	}
	?>
			<script>
				
				$(function() {
				    
				    $(window).on("load", function() {
                        // Animate loader off screen
                        wo_load();
                    });
				    $('#wo').comboSelect();
				    $('#choices_2').select2();
					$('#customT').hide();
					$('#choices').hide();
					$('#choices_2_div').hide();
					
					$("#choices_2").select2({
                        width: 'resolve', // need to override the changed default
                        theme: "classic"
                    });
					
					// $('#custom-select').hide();
					// $('#lqty').hide();
					// $('#qty').hide();
					//$('#desLabel').hide();
					$('div[class^=AB]').hide();
					$('div[class^=LAB]').hide();

                $('#choices_2').change(function(){
                    var cat = $('#cat').val();
                    //console.log(cat);
                    var wo = $(this).val();
                    if(cat == 'sp'){
                        //console.log("test");
                        $.ajax({
            
                            url:"sub_req_claim.php",
                            method:"POST",
                            data:{wo:wo},
                            dataType:"json",
                            success:function(data)
                                {
                                    var rate = data.rate;
                                    $('#qty').val('1');
                                    $('#rate').val(rate);
                                    $('#amount').val(rate);
                                }
                            });
                    }
                });
                //wo_load();
                function wo_load(){
                    
                    var a = $('#wo').val();
					var dropText = $('#wo option:selected' ).html();
					//console.log(dropText);
					//var wo = a.slice(0,11);

					var [wo, rqId, att,no] = a.split("_");
					var [nothing, rqName] = dropText.split("@");

					var [tName, desix] = rqName.split("-");

					var className = "AB"+tName+no;
					var lo_className = "LAB"+tName+no;

					className = className.replace('.', '');
					className = className.replace(' ', '');
					
					lo_className = lo_className.replace('.', '');
					lo_className = lo_className.replace(' ', '');
					console.log(className);
					var checkClass = $( "div" ).hasClass( className ).toString();
					var lo_checkClass = $( "div" ).hasClass( lo_className ).toString();
					console.log(checkClass);


					if(checkClass == "true"){
						console.log(className);
						$('div[class^=AB]').hide();
						$("."+className).show();

					}
					
					if(lo_checkClass == "true"){
						console.log(lo_className);
						$('div[class^=LAB]').hide();
						$("."+lo_className).show();

					}
                }
				
				$('#sDate').change(function(){

					var inDate = $(this).val();
					var d = new Date();
					var b = new Date(inDate);
					var last_date = new Date(d);
					last_date.setDate(last_date.getDate() - 4);
					//console.log(last_date);
					if(d < b){
    					alert("Sorry!!! Cannot request claim for "+$(this).val());
    					$(this).val("");
				    }
				    <?php
				    if(( $_SESSION['userType'] == 1 && $userDep == 0) || ($sal_band >= 5) || ($cEmp == 1127)){}
				    else{
				    ?>
				    else if(last_date > b){
				        alert("Sorry!!! Cannot request claim for "+$(this).val());
    					$(this).val("");
				    }
				    <?php
				    }
				    ?>
				});

				$('#wo').change(function(){
					//var attenx = 1;
					//console.log(attenx);
				// 	$('div[class^=AB]').hide();
				// 	$('div[class^=LAB]').hide();
					
					$('#custom-select').show();
					$('#lqty').show();
					$('#qty').show();

					$('#mqty').val(0);
					$('#checkCount').text('0');
					$('#checkCount_lodging').text('0');
					
					$("#staticAmount").val(0);
				    $("#staticRate").val(0);
					$("#cAmount").text('');
					$("#cRate").text('');
			        
			        $("#staticlAmount").val(0);
        			$("#staticlRate").val(0);
        			$("#clAmount").text('');
        			$("#clRate").text('');
					
					var a = $(this).val();
					var dropText = $('#wo option:selected' ).html();
					//console.log(dropText);
					//var wo = a.slice(0,11);

					var [wo, rqId, att,no] = a.split("_");
					var [nothing, rqName] = dropText.split("@");

					var [tName, desix] = rqName.split("-");

					var className = "AB"+tName+no;
					var lo_className = "LAB"+tName+no;

					className = className.replace('.', '');
					className = className.replace(' ', '');
					
					lo_className = lo_className.replace('.', '');
					lo_className = lo_className.replace(' ', '');
					console.log(className);
					var checkClass = $( "div" ).hasClass( className ).toString();
					var lo_checkClass = $( "div" ).hasClass( lo_className ).toString();
					console.log(checkClass);


					if(checkClass == "true"){
						console.log(className);
						$('div[class^=AB]').hide();
						$("."+className).show();

					}
					
					if(lo_checkClass == "true"){
						console.log(lo_className);
						$('div[class^=LAB]').hide();
						$("."+lo_className).show();

					}
					


					//var rqId = a.slice(12);
					//console.log(rqId);
					$('#staticUser').val(rqId);
					$('#staticUser2').val(rqId);
					$('#staticUser3').val(rqId);
					$('#staticM').val(wo); 
					$('#reqName').text(rqName);
					$('#reqName2').text(rqName);
					$('#reqName3').text(rqName);
					$('#woC').text(wo);
					$('#staticlM').val(wo); 
					$('#wolC').text(wo);
					$('#woI').val(wo); 
					$('#woS').text(wo);
					$('#customT').attr('placeholder','');
					$('#cat').val('');

				});
					
					$('#cat').change(function() {
					    
					    var claim_id = $('#staticUser3').val();
						if ($(this).val() == 'ma'){
							//$('#desLabel').show();
							$('#showI').hide();
							$('#customT').show();
							$('#choices').hide();
							$('#rate').show();
							$('#rateLabel').show();
							$('#desLabel').show();
							$("#choices_2_div").hide();
							
							$("#rate").attr('readonly',false);
					        $("#qty").attr('readonly',false);
						}
						else if ($(this).val() == 'me'){
							//$('#desLabel').show();
							$('#showI').hide();
							$('#customT').hide();
							$('#choices').hide();
							$('#rate').hide();
							$('#rateLabel').hide();
							$('#desLabel').hide();
							$("#choices_2_div").hide();
							
							$("#rate").attr('readonly',false);
					        $("#qty").attr('readonly',false);
							
						}
						
						else if ($(this).val() == 'lo'){
							//$('#desLabel').show();
							$('#showI').hide();
							$('#customT').hide();
							$('#choices').hide();
							$('#rate').hide();
							$('#rateLabel').hide();
							$('#desLabel').hide();
							$("#choices_2_div").hide();
							
							$("#rate").attr('readonly',false);
					        $("#qty").attr('readonly',false);
						}
						
						else if ($(this).val() == 'to'){
							//$('#desLabel').show();
							$('#showI').hide();
							$('#customT').show();
							$('#choices').hide();
							$('#rate').show();
							$('#rateLabel').show();
							$('#desLabel').show();
							$("#choices_2_div").hide();
							
							$("#rate").attr('readonly',false);
					        $("#qty").attr('readonly',false);
						}
						else if ($(this).val() == 'ot'){
							//$('#desLabel').show();
							$('#showI').hide();
							$('#customT').show();
							$('#choices').hide();
							$('#rate').show();
							$('#rateLabel').show();
							$('#desLabel').show();
							$("#choices_2_div").hide();
							
							$("#rate").attr('readonly',false);
					        $("#qty").attr('readonly',false);
						}
						else if($(this).val() == 're'){
							$('#showI').hide();
							$('#customT').show();
							$('#choices').hide();
							$('#rate').show();
							$('#rateLabel').show();
							$('#desLabel').show();
							$("#choices_2_div").hide();
							
							$("#rate").attr('readonly',false);
					        $("#qty").attr('readonly',false);
					        
					        console.log(claim_id);
					        
							$.ajax({
							url:"checkVehicleAssign.php",
							method:"POST",
							data:{user_id:claim_id},
							dataType:"json",
							success:function(data)
							{
								console.log(data.vehicle_no);
								if(data.output == 1){
									$('#customT').attr('placeholder', data.vehicle_no);
								}
								else{
									alert('The claim holder is not being assigned a vehicle. Therefore you can not request a vehicle repair claim.');
									$('#cat').val('');
								}
								
							}
							});
						}
						else if($(this).val() == 'sp'){
							//$('#desLabel').show();
							//$('#choices_2').show();
							$("#choices_2_div").show();
							$('#showI').hide();
							$('#choices').hide();
							$('#customT').hide();
							$('#rate').show();
							$('#rateLabel').show();
							$('#desLabel').show();
							
						}
						else{
							//$('#desLabel').show();
							$("#choices_2_div").hide();
							
							$('#showI').hide();
							$('#choices').show();
							$('#customT').hide();
							$('#rate').show();
							$('#rateLabel').show();
							$('#desLabel').show();
							
						}
					});


					


					$("#mqty").on("input", function(){

						var a = $('#wo').val();
						var [aa, tt, att] = a.split("_");
						var atten = att;
 					var wo = $('#staticM').val();
					if(wo != ""){
						console.log(atten);
						
						var b = $(this).val();
						//var selected = $('#staticCat').val();
						
						
						//if(userType == 10){
						if( b <= atten){	
							var z = 400 * b;
							$("#staticAmount").val(z);
							$("#staticRate").val(400);
							$("#cAmount").text(z);
							$("#cRate").text(400);
							
							//console.log(z);
						}
						else{
							alert("Wrong qty!!!");
							$("#mqty").val("");
							$("#staticAmount").val("");
							$("#cAmount").text("");
							$("#cRate").text("");
						}
					// }
					// if(userType == 1){
					// 	var z = 400 * b;
					// 		$("#staticAmount").val(z);
					// 		$("#staticRate").val(400);
					// 		$("#cAmount").text(z);
					// 		$("#cRate").text(400);
					// }
					
					}
					else{
						alert("Select workorder ID");
						$("#mqty").val("");
						$("#staticAmount").val("");
						$("#cAmount").text("");
						$("#cRate").text("");
					}
					
				});
					
					
				$("#lqty").on("input", function(){

					var a = $('#wo').val();
						var [aa, tt,abc,ab2, att] = a.split("_");
						var atten = att;
					
					var wo = $('#staticM').val();
					if(wo != ""){
						
						console.log(atten);
						var b = $(this).val();
						
						

					if( b <= atten){	
						if(b == 1){
						    if($('#shared').prop("checked") == true){
						        $("#staticlAmount").val(500);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(500);
        						$("#clRate").text(500);
						    }
						    else{
						        $("#staticlAmount").val(1000);
        						$("#staticlRate").val(1000);
        						$("#clAmount").text(1000);
        						$("#clRate").text(1000);
						    }
						
						}
						else if(b > 1 && b < 5){
						    if($('#shared').prop("checked") == true){
						        b = b - 1;
						        var z = 500 * b;
						        z = z+500;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(z);
        						$("#clRate").text(500);
						    }
						    else{
						        var z = 500 * b;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(z);
        						$("#clRate").text(500);
						    }
							
						}

						else if(b > 4){
						    
						    if($('#shared').prop("checked") == true){
						        b = b - 1;
						        var z = 400 * b;
						        z = z+500;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(400);
        						$("#clAmount").text(z);
        						$("#clRate").text(400);
						    }
						    else{
						        var z = 400 * b;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(400);
        						$("#clAmount").text(z);
        						$("#clRate").text(400);
						    }
						
						
						}
					}
					else{
						alert("Wrong qty!!!");
						$("#lqty").val("");
						$("#staticlAmount").val("");
						$("#clAmount").text("");
						$("#clRate").text("");
					}
					
	
						
					}
					
					else{
						//$(this).val("");
						$("#lqty").val("");
						$("#staticAmount").val("");
						$("#cAmount").text("");
						$("#cRate").text("");
						alert("Select Workorder ID !!!");
					}

				});
				
				 $('#shared').click(function(){
				     var b = $('#lqty').val();
                    if(b == 1){
						    if($('#shared').prop("checked") == true){
						        $("#staticlAmount").val(500);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(500);
        						$("#clRate").text(500);
						    }
						    else{
						        $("#staticlAmount").val(1000);
        						$("#staticlRate").val(1000);
        						$("#clAmount").text(1000);
        						$("#clRate").text(1000);
						    }
						
						}
						else if(b > 1 && b < 5){
						    if($('#shared').prop("checked") == true){
						        b = b - 1;
						        var z = 500 * b;
						        z = z+500;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(z);
        						$("#clRate").text(500);
						    }
						    else{
						        var z = 500 * b;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(z);
        						$("#clRate").text(500);
						    }
							
						}

						else if(b > 4){
						    
						    if($('#shared').prop("checked") == true){
						        b = b - 1;
						        var z = 400 * b;
						        z = z+500;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(400);
        						$("#clAmount").text(z);
        						$("#clRate").text(400);
						    }
						    else{
						        var z = 400 * b;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(400);
        						$("#clAmount").text(z);
        						$("#clRate").text(400);
						    }
						
						
						}
                });
				
				$('#qty').on("input", function(){

					var a = $('#woI').val();
					//console.log("Test");
					if(a == ""){
						alert("Select Workorder ID !!!");
						$('#qty').val("");
						$('#amount').text("");
						$('#rate').text("");
					}
				});
				});




				</script>

	<div class="row" style="padding:5px 20px 5px 20px;">
		<div class="col-12">
	<table class="table table-bordered table-hover tableFixHead " >
	<thead>
		<tr>
			<th>Workorder</th>
			<th>Planed Date</th>
			<th>Requester</th>
			<th>Category</th>
			<th>Description</th>
			<th>QTY</th>
			<th>Rate</th>
			<th>Amount</th>	
			<th ></th>

		</tr>
		</thead>
		<tbody>
	<?php

	if($_SESSION['sdate'] != ""){
		$cdate = $_SESSION['sdate'];
		$checkMeal = "SELECT * FROM claim_requests WHERE user = $cuserId AND wo_date = '$cdate' AND cat = 8";
		
		//echo $checkMeal;
		$checkLo = "SELECT * FROM claim_requests WHERE user = $cuserId AND wo_date = '$cdate' AND cat = 9";
		
		//echo $checkLo;
		
		$checkMealQ = $cn->query($checkMeal);
		$checkLoQ = $cn->query($checkLo);
		
		
		$mealR = $checkMealQ->num_rows;
		$loR = $checkLoQ->num_rows;
		
		$meaNewlR = 0;
		$loNewR = 0;
		
		$val = mysqli_query($cn,"select 1 from `$tableName` LIMIT 1");
		
		if(!empty($val)){
			
			$checkNewMeal = "SELECT * FROM `$tableName` WHERE user = $cuserId AND wo_date = '$cdate' AND cat = 8";
			
			$checkNewLo = "SELECT * FROM `$tableName` WHERE user = $cuserId AND wo_date = '$cdate' AND cat = 9";
			$checkNewMealQ = $cn->query($checkNewMeal);
			$checkNewLoQ = $cn->query($checkNewLo);
			$meaNewlR = $checkNewMealQ->num_rows;
			$loNewR = $checkNewLoQ->num_rows;
		}
		
		if($mealR == 0 && $userDep != 2 && $userDep != 5 && $userDep != 3){
			if($meaNewlR == 0 ){
	
	?>
	<form method = "post" action="">
	<tr style='background-color:#969997;'>

		<td ><p id = "woC"><?php echo $_SESSION['swo'];?></p><input type= "hidden" name="staticM" id = "staticM" value="<?php echo $_SESSION['swo'];?>" ></td>
		<td><input type= "hidden" name="staticD" id = "staticD" value="<?php echo $_SESSION['sdate'];?>"><?php echo $_SESSION['sdate'];?></td>
		<td><input type= "hidden" name="staticUser" id = "staticUser" value="<?php if(isset($_SESSION['$requesterId'])){echo $_SESSION['$requesterId'];}?>"><p id="reqName"><?php if(isset($_SESSION['$requesterName'])){echo $_SESSION['$requesterName'];}?></p></td>
		<td>Meal<input type= "hidden" name="staicCat" id = "staicCat" value="me"></td>
		<td>Meal for team<input type= "hidden" name="staticDis" id = "staticDis" value="Meal for team"></td>
		<td ><input type= "hidden" name="mqty"  id = "mqty" required>

			<div class="custom-select" id="custom-select"><p id ="checkCount"></p></div>
			<div id="custom-select-option-box">
			<?php
					if(($userType == 2 && $userDep == 1)||($userType == 2 && $userDep == 4)){
					    //echo "test";
						$a=0;
						//$clusterSQL = "SELECT teamId FROM clusters WHERE userId = $cuserId";
						$clusterSQL = "SELECT emp_no FROM emp_reg_master WHERE emp_dep_sup = $cEmp AND ac_dc = 0 AND salary_band_id = 2";
					//echo $clusterSQL."<br>";
					$clusterQuery = $con5->query($clusterSQL);
					while($clusterRow = $clusterQuery->fetch_object()){

						$emp_no = $clusterRow->emp_no;
						$cteamSQL = "SELECT idx,username,user_id FROM login WHERE emp_no = $emp_no";
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();
						$cTeamIdx = $cteamRow->idx;
						$cTeamId =	$cteamRow->user_id;

						$planSQL = "SELECT * FROM planx WHERE datex='$cdate' AND idx='$cTeamIdx' AND work_order != 'Leave'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;

						$checkname = "AB".$cTeamName.$a;

						$checkname = str_replace(".","",$checkname);
						$checkname = str_replace(" ","",$checkname);
						

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name,epf,ass_team FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$cdate' AND (att = 1 OR att = 3)";
						//	echo "<br>".$numSQL;
							$teamDQuery = $cn -> query($numSQL);
						//echo $checkname; 
						?>
						
							<?php
							while($teamDRow = $teamDQuery->fetch_object()){
								$tMember = $teamDRow->name;
								$emp_code = $teamDRow->epf;
							?>
							<div class="<?php echo $checkname; ?>">
						<div class="custom-select-option" >
							
							<input onchange="toggleFillColor(this);"
								class="custom-select-option-checkbox" type="checkbox"
								name="toy[]"  value="<?php echo $teamDRow->ass_team."-".$tMember."-".$emp_code;?>"><?php echo $tMember; ?></div>
								</div>
								<?php
								
							}
								?>
						
						


						<?php
						//echo "test";
						$a++;
					}
					
					
				}
				$a++;
					}
					else if(($userType == 1 && $userDep == 1)||($userType == 1 && $userDep == 0)){

						$a=0;

						$planSQL = "SELECT * FROM planx WHERE datex='$cdate' AND work_order != 'Leave' AND desix != 'TRP' AND desix != 'SUB'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;
						$cTeamIdx = $planRow->idx;

						$checkIdx = $cn->query("SELECT * FROM login WHERE idx = $cTeamIdx");
						$numIdx = $checkIdx->num_rows;

						if($numIdx > 0){

						$checkname = "AB".$cTeamName.$a;
						$checkname = str_replace(".","",$checkname);
						$checkname = str_replace(" ","",$checkname);

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name,epf,ass_team FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$cdate' AND (att = 1 OR att = 3)";
							//echo "<br>".$numSQL;
							$teamDQuery = $cn -> query($numSQL);
						//echo $checkname; 
						?>
						
							<?php
							while($teamDRow = $teamDQuery->fetch_object()){
								$tMember = $teamDRow->name;
								$emp_code = $teamDRow->epf;
							?>
							<div class="<?php echo $checkname?>">
						<div class="custom-select-option" >
							
							<input onchange="toggleFillColor(this);"
								class="custom-select-option-checkbox" type="checkbox"
								name="toy[]"  value="<?php echo $teamDRow->ass_team."-".$tMember."-".$emp_code;?>"><?php echo $tMember; ?></div>
								</div>
								<?php
							}
								?>
						
						


						<?php
					}
					$a++;
					}
				
					}
					else {

						$a=0;
						$checkIdx = $cn->query("SELECT * FROM login WHERE user_id  = $cuserId");
						$checkIdxR = $checkIdx->fetch_object();
						$cTeamIdx = $checkIdxR->idx;

						$planSQL = "SELECT * FROM planx WHERE datex='$cdate' AND work_order != 'Leave' AND idx=$cTeamIdx";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;
						$cTeamIdx = $planRow->idx;

						$checkname = "AB".$cTeamName.$a;
						$checkname = str_replace(".","",$checkname);
						$checkname = str_replace(" ","",$checkname);

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name,epf,ass_team FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$cdate' AND (att = 1 OR att = 3)";
							//echo "<br>".$numSQL;
							$teamDQuery = $cn -> query($numSQL);
						//echo $checkname; 
						?>
						
							<?php
							while($teamDRow = $teamDQuery->fetch_object()){
								$tMember = $teamDRow->name;
								$emp_code = $teamDRow->epf;
							?>
							<div class="<?php echo $checkname?>">
						<div class="custom-select-option" >
							
							<input onchange="toggleFillColor(this);"
								class="custom-select-option-checkbox" type="checkbox"
								name="toy[]"  value="<?php echo $teamDRow->ass_team."-".$tMember."-".$emp_code;?>"><?php echo $tMember; ?></div>
								</div>
								<?php
							}
								?>
						
						


						<?php
					
					$a++;
					}
				
					}

					?>

				</div>


		</td>
		<td><p id = "cRate"></p><input type= "hidden" name="staticRate" id = "staticRate" value=""></td>
		<td><p id = "cAmount"></p><input type= "hidden" name="staticAmount" id = "staticAmount" value=""></td>
		<td><button class="btn btn-dark"  type="submit" name ="sub1" style = "margin-left:10px;padding: 12px 16px;font-size: 16px;cursor: pointer;"><i class="fa fa-plus"></i></button></td>
	</tr>
	</form>
		<script>

	$("#custom-select").on("click",function(){
		$("#custom-select-option-box").toggle();
	});
	
	function toggleFillColor(obj) {
		$("#custom-select-option-box").show();
		if($(obj).prop('checked') == true) {
			$(obj).parent().css("background",'#c6e7ed');
		} else {
			$(obj).parent().css("background",'#FFF');
		}
	}
	$('#wo').change(function(){
		var checkboxes = $('#custom-select-option-box input[type="checkbox"]');
           
        //checkboxes.filter(':checked').length;

		//var checkboxObj = $(".custom-select-option").children("input");
		//console.log(checkboxes);
		 $(checkboxes).prop("checked",false);
		 		//toggleFillColor(checkboxObj);
	});

	$(".custom-select-option").on("click", function() {

				if(wo != ""){

					var checkboxObj = $(this).children("input");

		 if($(checkboxObj).prop("checked") == true){
                $(checkboxObj).prop("checked",false);
		 		toggleFillColor(checkboxObj);
            }
            else if($(checkboxObj).prop("checked") == false){
                $(checkboxObj).prop("checked",true);
		 		toggleFillColor(checkboxObj);
            }
            var checkboxes = $('#custom-select-option-box input[type="checkbox"]');
           
            var countCheckedCheckboxes = checkboxes.filter(':checked').length;
             //console.log(countCheckedCheckboxes);
             $('#checkCount').text(countCheckedCheckboxes);
             $('#mqty').val(countCheckedCheckboxes);
		// $(checkboxObj).prop("checked",true);
		// toggleFillColor(checkboxObj);
	
							var z = 500 * countCheckedCheckboxes;
							$("#staticAmount").val(z);
							$("#staticRate").val(500);
							$("#cAmount").text(z);
							$("#cRate").text(500);
							
							//console.log(z);
						}

					else{
						alert("Select workorder ID");
						$("#mqty").val("");
						$("#staticAmount").val("");
						$("#cAmount").text("");
						$("#cRate").text("");
						$('#checkCount').text("0");
					}
		


	});
		
	$("body").on("click",function(e){
		if(e.target.id != "custom-select" && $(e.target).attr("class") != "custom-select-option") {
			$("#custom-select-option-box").hide();
		}
	});

	</script>
	<?php
		
			}
		}
		if($loR == 0 && $userDep != 2 && $userDep != 5 && $userDep != 3){
			if($loNewR == 0 ){ 
				
	?>
	<form method = "post" action="">
	<tr style='background-color:#969997;'>

		<td ><p id = "wolC"><?php echo $_SESSION['swo'];?></p><input type= "hidden" name="staticlM" id = "staticlM" value="<?php echo $_SESSION['swo'];?>" ></td>
		<td><input type= "hidden" name="staticD" id = "staticD" value="<?php echo $_SESSION['sdate'];?>"><?php echo $_SESSION['sdate'];?></td>
		<td><input type= "hidden" name="staticUser2" id = "staticUser2" value="<?php if(isset($_SESSION['$requesterId'])){echo $_SESSION['$requesterId'];}?>"><p id="reqName2"><?php if(isset($_SESSION['$requesterName'])){echo $_SESSION['$requesterName'];}?></p></td>
		<td>Lodging<input type= "hidden" name="staiclCat" id = "staiclCat" value="lo"></td>
		<td>Lodging for team<input type= "hidden" name="staticlDis" id = "staticlDis" value="Lodging for team"></td>
		<td>
		    <!--<input type= "number" name="lqty"  id = "lqty" style="width:75px;" class = "form-control" value="" required><span style="font-size: 15px;">Shared </span><input type="checkbox" id="shared" name = "shared" value = "1">-->
		    <input type= "hidden" name="lqty"  id = "lqty" style="width:75px;" class = "form-control" >
		    <div class="custom-select" id="custom-select_lodging"><p id ="checkCount_lodging"></p></div>
			<div id="custom-select-option-box_lodging">
			<?php
					if(($userType == 2 && $userDep == 1)||($userType == 2 && $userDep == 4)){
					    //echo "test";
						$a=0;
						//$clusterSQL = "SELECT teamId FROM clusters WHERE userId = $cuserId";
						$clusterSQL = "SELECT emp_no FROM emp_reg_master WHERE emp_dep_sup = $cEmp AND ac_dc = 0 AND salary_band_id = 2";
					//echo $clusterSQL."<br>";
					$clusterQuery = $con5->query($clusterSQL);
					while($clusterRow = $clusterQuery->fetch_object()){

						$emp_no = $clusterRow->emp_no;
						$cteamSQL = "SELECT idx,username,user_id FROM login WHERE emp_no = $emp_no";
						$cteamQuery = $cn->query($cteamSQL);
						$cteamRow = $cteamQuery->fetch_object();
						$cTeamIdx = $cteamRow->idx;
						$cTeamId =	$cteamRow->user_id;

						$planSQL = "SELECT * FROM planx WHERE datex='$cdate' AND idx='$cTeamIdx' AND work_order != 'Leave'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;

						$checkname = "LAB".$cTeamName.$a;

						$checkname = str_replace(".","",$checkname);
						$checkname = str_replace(" ","",$checkname);
						

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name,epf,ass_team FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$cdate' AND (att = 1 OR att = 3) AND `ass_team`=`team`";
						//	echo "<br>".$numSQL;
							$teamDQuery = $cn -> query($numSQL);
						//echo $checkname; 
						?>
						
							<?php
							while($teamDRow = $teamDQuery->fetch_object()){
								$tMember = $teamDRow->name;
								$emp_code = $teamDRow->epf;
							?>
							<div class="<?php echo $checkname; ?>">
						<div class="custom-select-option_lodging" >
							
							<input onchange="toggleFillColor(this);"
								class="custom-select-option-checkbox_lodging" type="checkbox"
								name="toy[]"  value="<?php echo $teamDRow->ass_team."-".$tMember."-".$emp_code;?>"><?php echo $tMember; ?></div>
								</div>
								<?php
								
							}
								?>
						
						


						<?php
						//echo "test";
						$a++;
					}
					
					
				}
				$a++;
					}
					else if(($userType == 1 && $userDep == 1)||($userType == 1 && $userDep == 0)){

						$a=0;

						$planSQL = "SELECT * FROM planx WHERE datex='$cdate' AND work_order != 'Leave' AND desix != 'TRP' AND desix != 'SUB'";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;
						$cTeamIdx = $planRow->idx;

						$checkIdx = $cn->query("SELECT * FROM login WHERE idx = $cTeamIdx");
						$numIdx = $checkIdx->num_rows;

						if($numIdx > 0){

						$checkname = "LAB".$cTeamName.$a;
						$checkname = str_replace(".","",$checkname);
						$checkname = str_replace(" ","",$checkname);

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name,epf,ass_team FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$cdate' AND (att = 1 OR att = 3) AND `ass_team`=`team`";
							//echo "<br>".$numSQL;
							$teamDQuery = $cn -> query($numSQL);
						//echo $checkname; 
						?>
						
							<?php
							while($teamDRow = $teamDQuery->fetch_object()){
								$tMember = $teamDRow->name;
								$emp_code = $teamDRow->epf;
							?>
							<div class="<?php echo $checkname?>">
						<div class="custom-select-option_lodging" >
							
							<input onchange="toggleFillColor(this);"
								class="custom-select-option-checkbox_lodging" type="checkbox"
								name="toy[]"  value="<?php echo $teamDRow->ass_team."-".$tMember."-".$emp_code;?>"><?php echo $tMember; ?></div>
								</div>
								<?php
							}
								?>
						
						


						<?php
					}
					$a++;
					}
				
					}
					else {

						$a=0;
						$checkIdx = $cn->query("SELECT * FROM login WHERE user_id  = $cuserId");
						$checkIdxR = $checkIdx->fetch_object();
						$cTeamIdx = $checkIdxR->idx;

						$planSQL = "SELECT * FROM planx WHERE datex='$cdate' AND work_order != 'Leave' AND idx=$cTeamIdx";
						//echo $planSQL."<br>";
						$planQuery = $con->query($planSQL);

					while($planRow = $planQuery->fetch_object()){
						$cTeamName = $planRow->tl_name;
						$desix = $planRow->desix;
						$cTeamIdx = $planRow->idx;

						$checkname = "LAB".$cTeamName.$a;
						$checkname = str_replace(".","",$checkname);
						$checkname = str_replace(" ","",$checkname);

						$pro_teamSQL = "SELECT `mark_relationship` FROM `project_team` WHERE `idx` = $cTeamIdx";
						$pro_teamQuery = $con->query($pro_teamSQL);
						$pro_teamR = $pro_teamQuery->fetch_object();
						$mark_rel = $pro_teamR->mark_relationship;

							$date = $_SESSION['sdate'];
							$numSQL = "SELECT DISTINCT name,epf,ass_team FROM `team_att` WHERE `ass_team`='$mark_rel' AND `date`='$cdate' AND (att = 1 OR att = 3) AND `ass_team`=`team`";
							//echo "<br>".$numSQL;
							$teamDQuery = $cn -> query($numSQL);
						//echo $checkname; 
						?>
						
							<?php
							while($teamDRow = $teamDQuery->fetch_object()){
								$tMember = $teamDRow->name;
								$emp_code = $teamDRow->epf;
							?>
							<div class="<?php echo $checkname?>">
						<div class="custom-select-option_lodging" >
							
							<input onchange="toggleFillColor(this);"
								class="custom-select-option-checkbox_lodging" type="checkbox"
								name="toy[]"  value="<?php echo $teamDRow->ass_team."-".$tMember."-".$emp_code;?>"><?php echo $tMember; ?></div>
								</div>
								<?php
							}
								?>
						
						


						<?php
					
					$a++;
					}
				
					}

					?>

				</div>
		    
		
		</td>
		<td><p id = "clRate"></p><input type= "hidden" name="staticlRate" id = "staticlRate" value=""></td>
		<td><p id = "clAmount"></p><input type= "hidden" name="staticlAmount" id = "staticlAmount" value=""></td>
		<td> <button class="btn btn-dark"  type="submit" name ="sub2" style = "margin-left:10px;padding: 12px 16px;font-size: 16px;cursor: pointer;"><i class="fa fa-plus"></i></button>
		    
		
		</td>
	</tr>
	</form>
	
	<script>

	$("#custom-select_lodging").on("click",function(){
		$("#custom-select-option-box_lodging").toggle();
	});
	function toggleFillColor(obj) {
		$("#custom-select-option-box_lodging").show();
		if($(obj).prop('checked') == true) {
			$(obj).parent().css("background",'#c6e7ed');
		} else {
			$(obj).parent().css("background",'#FFF');
		}
	}
	$('#wo').change(function(){
		var checkboxes = $('#custom-select-option-box_lodging input[type="checkbox"]');
           
        //checkboxes.filter(':checked').length;

		//var checkboxObj = $(".custom-select-option").children("input");
		//console.log(checkboxes);
		 $(checkboxes).prop("checked",false);
		 		//toggleFillColor(checkboxObj);
	});

	$(".custom-select-option_lodging").on("click", function() {

				if(wo != ""){

					var checkboxObj = $(this).children("input");

		 if($(checkboxObj).prop("checked") == true){
                $(checkboxObj).prop("checked",false);
		 		toggleFillColor(checkboxObj);
            }
            else if($(checkboxObj).prop("checked") == false){
                $(checkboxObj).prop("checked",true);
		 		toggleFillColor(checkboxObj);
            }
            var checkboxes = $('#custom-select-option-box_lodging input[type="checkbox"]');
           
            var countCheckedCheckboxes = checkboxes.filter(':checked').length;
             //console.log(countCheckedCheckboxes);
             $('#checkCount_lodging').text(countCheckedCheckboxes);
             $('#lqty').val(countCheckedCheckboxes);
		// $(checkboxObj).prop("checked",true);
		// toggleFillColor(checkboxObj);
	            b = countCheckedCheckboxes;
							if(b == 1){
						    
						        $("#staticlAmount").val(1000);
        						$("#staticlRate").val(1000);
        						$("#clAmount").text(1000);
        						$("#clRate").text(1000);
						    
						
						}
						else if(b > 1 && b < 5){
						    
						        var z = 500 * b;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(500);
        						$("#clAmount").text(z);
        						$("#clRate").text(500);
						    
							
						}

						else if(b > 4){
						    
						        var z = 400 * b;
        						$("#staticlAmount").val(z);
        						$("#staticlRate").val(400);
        						$("#clAmount").text(z);
        						$("#clRate").text(400);
						    
						
						
						}
							
							//console.log(z);
						}

					else{
						alert("Select workorder ID");
						$("#mqty").val("");
						$("#staticAmount").val("");
						$("#cAmount").text("");
						$("#cRate").text("");
						$('#checkCount').text("0");
					}
		


	});
		
	$("body").on("click",function(e){
		if(e.target.id != "custom-select_lodging" && $(e.target).attr("class") != "custom-select-option_lodging") {
			$("#custom-select-option-box_lodging").hide();
		}
	});

	</script>
			
	<?php 
				
			}
		}
	
	?>
	
	<form method = "post" action="" id="demoForm" >
	<tr style='background-color:#969997;'>

		<td ><p id = "woS"><?php echo $_SESSION['swo'];?></p><input type= "hidden" name="woI" id = "woI" value="<?php echo $_SESSION['swo'];?>" ></td>
		<td><input type= "hidden" name="staticD" id = "staticD" value="<?php echo $_SESSION['sdate'];?>"><?php echo $_SESSION['sdate'];?></td>
		<td><input type= "hidden" name="staticUser3" id = "staticUser3" value="<?php if(isset($_SESSION['$requesterId'])){echo $_SESSION['$requesterId'];}?>"><p id="reqName3"><?php if(isset($_SESSION['$requesterName'])){echo $_SESSION['$requesterName'];}?></p></td>
		<td><select name="category"  id="cat" class="form-control" required>
				<option value="">-Select Category-</option>
				<?php
				$catSQL = "";
				if($userType == 1 && $userDep == 0){
				    $catSQL = "SELECT * FROM claim_category where not id = 8 and not id= 9";
				}
				else if($userType == 7 && $userDep == 5){
				    $catSQL = "SELECT * FROM claim_category where not id = 8 and not id= 9 AND (user_type = 0 || user_type = $userType)";
				}
				else{
				    $catSQL = "SELECT * FROM claim_category where not id = 8 and not id= 9 AND user_type = 0";
				}
				
				$catQuery = $cn -> query($catSQL);
				while($rowCat = $catQuery->fetch_object()){
				?>
				<option value="<?php echo $rowCat->uni_code;?>"><?php echo $rowCat->category;?></option>
				<?php
				}
				?>
				</select></td>
		<td><select name="choices[]" id="choices" class="form-control">
				<option value="">-Select Category-</option>
				</select>
				<div id="choices_2_div" style="display:none;">
				<select name="sub_choices" id="choices_2" style="width: 300px;">
				<option value="">-Select Description-</option>
				
				<?php
				$transportSQl = "Select a.wo,b.site,a.id,a.payment_type from primela2_hasanka.sub_advance a
						                   LEFT JOIN  primela2_deliverydb.work_order b ON a.wo = b.`Work_Orderx`
						                   LEFT JOIN primela2_hasanka.claim_requests c ON a.id = c.sub_ad_id
						                   WHERE a.apr = 2 AND a.team_idx != 140  AND c.sub_ad_id IS NULL";
						$transportQuery = $cn->query($transportSQl);
						while($rowTransport = $transportQuery->fetch_object()){
				?>
				        <option value="<?php echo $rowTransport->wo."-".$rowTransport->id;?>"><?php echo $rowTransport->wo." - ".$rowTransport->site." - ".$rowTransport->payment_type;?></option>
				<?php
						}
				?>
				</select>
				</div>
				<input type="text" id="customT" name="choicesT" class="form-control"/>
				<input type="text" id="showI" class="form-control"/></td>
		<td><input type= "number" name="qty"  id = "qty" style="width:75px;" class = "form-control" value="" required></td>
		<td><input type= "text" name="rate" step="0.01" id = "rate" class = "form-control" value="" required></td>
		<td><input type= "text" name="amount" id = "amount" value="" class = "form-control" readonly></td>
		<td><button class="btn btn-dark"  type="submit" name ="sub3" style = "margin-left:10px;padding: 12px 16px;font-size: 16px;cursor: pointer;"><i class="fa fa-plus"></i></button></td>

		
	</tr>
	</form>
	
	<script type="text/javascript">
			// removes all option elements in select list 
			// removeGrp (optional) boolean to remove optgroups
			function removeAllOptions(sel, removeGrp) {
				var len, groups, par;
				if (removeGrp) {
					groups = sel.getElementsByTagName('optgroup');
					len = groups.length;
					for (var i=len; i; i--) {
						sel.removeChild( groups[i-1] );
					}
				}
				
				len = sel.options.length;
				for (var i=len; i; i--) {
					par = sel.options[i-1].parentNode;
					par.removeChild( sel.options[i-1] );
				}
			}

			function appendDataToSelect(sel, obj) {
				var f = document.createDocumentFragment();
				var labels = [], group, opts;
				
				function addOptions(obj) {
					var f = document.createDocumentFragment();
					var o;
					
					for (var i=0, len=obj.text.length; i<len; i++) {
						o = document.createElement('option');
						o.appendChild( document.createTextNode( obj.text[i] ) );
						
						if ( obj.value ) {
							o.value = obj.value[i];
						}
						
						f.appendChild(o);
					}
					return f;
				}
				
				if ( obj.text ) {
					opts = addOptions(obj);
					f.appendChild(opts);
				} else {
					for ( var prop in obj ) {
						if ( obj.hasOwnProperty(prop) ) {
							labels.push(prop);
						}
					}
					
					for (var i=0, len=labels.length; i<len; i++) {
						group = document.createElement('optgroup');
						group.label = labels[i];
						f.appendChild(group);
						opts = addOptions(obj[ labels[i] ] );
						group.appendChild(opts);
					}
				}
				sel.appendChild(f);
			}

			// anonymous function assigned to onchange event of controlling select list
			document.forms['demoForm'].elements['category'].onchange = function(e) {
				// name of associated select list				
				var relName = 'choices[]';
				
				// reference to associated select list 
				var relList = this.form.elements[ relName ];
				
				// get data from object literal based on selection in controlling select list (this.value)
				var obj = Select_List_Data[ relName ][ this.value ];
				var s_val = this.value;
				
				// remove current option elements
				removeAllOptions(relList, true);
				
				// call function to add optgroup/option elements
				// pass reference to associated select list and data for new options
				if(s_val == 'tr' || s_val == 'st' || s_val =='la' || s_val =='sp'){
					appendDataToSelect(relList, obj);
					if(s_val =='sp'){
					    //console.log("test");
					    $("#rate").attr('readonly',true);
					    $("#qty").attr('readonly',true);
					}
				}
			};

			// object literal holds data for optgroup/option elements
			var Select_List_Data = {

				
				// name of associated select list
				'choices[]': {
					
					// names match option values in controlling select list
					tr: {
						<?php
						$transportSQl = "Select * from claim_desc WHERE cat = 1";
						$transportQuery = $cn->query($transportSQl);
						$vtransportQuery = $cn->query($transportSQl);
						$a = $transportQuery->num_rows;
						
						?>
							text: ['-Select Description-',<?php while($rowTransport = $transportQuery->fetch_object()){ ?>
								'<?php echo $rowTransport->des;?>',
								
										<?php
						}
					?>],
							value: ['',<?php while($rowVTransport = $vtransportQuery->fetch_object()){ ?>
								'<?php echo $rowVTransport->des;?>',
								
										<?php
						}
					?>]
			
					},
					st: {
						<?php
						$transportSQl = "Select * from claim_desc WHERE cat = 2";
						$transportQuery = $cn->query($transportSQl);
						$vtransportQuery = $cn->query($transportSQl);
						$a = $transportQuery->num_rows;
						
						?>
							text: ['-Select Description-',<?php while($rowTransport = $transportQuery->fetch_object()){ ?>
								'<?php echo $rowTransport->des;?>',
								
										<?php
						}
					?>],
							value: ['',<?php while($rowVTransport = $vtransportQuery->fetch_object()){ ?>
								'<?php echo $rowVTransport->des;?>',
								
										<?php
						}
					?>]
					},
					la: {
						<?php
						$transportSQl = "Select * from claim_desc WHERE cat = 3";
						$transportQuery = $cn->query($transportSQl);
						$vtransportQuery = $cn->query($transportSQl);
						$a = $transportQuery->num_rows;
						
						?>
							text: ['-Select Description-',<?php while($rowTransport = $transportQuery->fetch_object()){ ?>
								'<?php echo $rowTransport->des;?>',
								
										<?php
						}
					?>],
							value: ['',<?php while($rowVTransport = $vtransportQuery->fetch_object()){ ?>
								'<?php echo $rowVTransport->des;?>',
								
										<?php
						}
					?>]
					},
					
				}
				
			};

			// populate associated select list when page loads
			window.onload = function() {
				var form = document.forms['demoForm'];
				
				// reference to controlling select list
				var sel = form.elements['category'];
				sel.selectedIndex = 0;
				
				// name of associated select list
				var relName = 'choices[]';
				// reference to associated select list
				var rel = form.elements[ relName ];
				
				// get data for associated select list passing its name
				// and value of selected in controlling select list
				var data = Select_List_Data[ relName ][ sel.value ];
				
				// add options to associated select list
				//appendDataToSelect(rel, data);
			};

			</script>
	
	
	<?php
	
	}
	?>


	<?php
	if($_SESSION['tableCheck'] == 1){
	$reqClaimSQL = "SELECT * FROM $tableName";
	$reqClaimQuery = $cn->query($reqClaimSQL);
	while($rowClaim = $reqClaimQuery->fetch_object()){
			
			$userId = $rowClaim->user;
			
			$userNameSQL = "SELECT name FROM login WHERE user_id = $userId";
			//echo $userNameSQL."<br>";
			$userNameQuery = $cn->query($userNameSQL);
	while($rowUser = $userNameQuery->fetch_object()){
				$cat = $rowClaim->cat;
			$catSSQL = "SELECT category FROM claim_category WHERE id = $cat";
			$catSQuery = $cn -> query($catSSQL);
	while($rowSCat = $catSQuery->fetch_object()){
				$claimId = $rowClaim -> id;
	?>
	<tr>
		<td><?php echo $rowClaim->wo; ?></td>
		<td><?php echo $rowClaim->wo_date; ?></td>
		<td><?php echo $rowUser->name;?></td>
		<td><?php echo $rowSCat->category;?></td>
		<td><?php echo $rowClaim->descr;?></td>
		<td><?php echo $rowClaim->qty;?></td>
		<td><?php echo $rowClaim->rate;?></td>
		<td><?php echo $rowClaim->amount;?></td>
		
		<td class="table-danger" align = "center">
	
		<form action="" method="post">
		<input type="hidden" name="id" value="<?php echo $claimId; ?>"/>
				<Button type="submit" name="delete" style = "margin-left:10px;padding: 12px 16px;color:#ffffff;font-size: 16px;cursor: pointer;" class="btn btn-danger" ><i class="fa fa-trash"></i></button>
		</form>

		</td>
      </tr>

	<?php
			}
			}
		}
	}
	?>
		
	
			</tbody>
	
		</table>
		</div>
	</div>
		<div class="row" style="padding:5px 20px 5px 20px;">
			<div class="col-11">
			</div>
			<div class="col-1">
		<form action="" method="post">
		<Button type="submit" style="float:right;margin-bottom:10px;" name="req" class="btn btn-success">Submit</button>
		</form>
	</div>

		</div>
		
	</div>
		
</BODY>
</HTML>