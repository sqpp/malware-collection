<?php

require_once('config.php');

require_once('common.php');

require_once('myarray.php');

$roleAccess = array("a", "o", "f");

$access = checkLogin($roleAccess, "index.php");

include_once('classes/family.class.php');

$family= new Family(); 

include('header.php');

include('menu.php');



if(isset($_POST) && !empty($_POST)) {

	$data=array();

 	$edu =array();

    // Image upload script

	if(isset($_FILES['A_IMG']['name']) && !empty($_FILES['A_IMG']['name'])) {

		

		//image upload script

		$fname='AO_'.uniqid();

		$target_dir = "mylogo/admin/";

		$filename=$_FILES["A_IMG"]["name"];

		$extension=end(explode(".", $filename));

		$newfilename=$fname.'.'.$extension;

		$updir=$target_dir.$newfilename;

		$uploadOk = 1;

		// Check if file already exists

		if (file_exists($updir)) {

			echo "Sorry, file already exists.";

			$uploadOk = 0;

		}

		// Check file size

/*		if ($_FILES["A_IMG"]["size"] > 500000) {

			echo "Sorry, your file is too large.";

			$uploadOk = 0;

		}*/

		// Allow certain file formats

		if($extension != "jpg" && $extension != "png" && $extension != "jpeg"

		&& $extension != "gif" ) {

			echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";

			$uploadOk = 0;

		}

		// Check if $uploadOk is set to 0 by an error

		if ($uploadOk == 0) {

			echo "Sorry, your file was not uploaded.";

			$url=$_SERVER['REQUEST_URI'];

			echo "<br/><br/><a href='".$url."'><b style='color:red;'>Click to Go Back</b></a>";

			exit;

		// if everything is ok, try to upload file

		} else {

			move_uploaded_file($_FILES["A_IMG"]["tmp_name"],$updir);

			$data['A_IMG']				=$newfilename;

		}

	}


	if($_POST['A_STATE'] == 'other'){
		$New_state = $family->InsertState($_POST['state_oc']);
		$_POST['A_STATE'] = $New_state;
		}
	if($_POST['A_CITY'] == 'other'){
		$New_city = $family->InsertCity($_POST['A_STATE'],$_POST['city_oc']);
		$_POST['A_CITY'] = $New_city;
		}
	 $data['A_USERNAME']	    =$_POST['A_USERNAME'];

	 $data['A_PASSWORD']	    =$_POST['A_PASSWORD'];

	 $data['A_FULLNAME']	    =$_POST['A_FULLNAME'];

	 $data['A_SEX']	    		=$_POST['A_SEX'];

	 $data['A_ADDRESS']		    =$_POST['A_ADDRESS'];

	 $data['A_DOB']			    =date('Y-m-d'.strtotime($_POST['A_DOB']));

	 $data['A_CITY']		    =$_POST['A_CITY'];

	 $data['A_STATE']		    =$_POST['A_STATE'];

	 $data['A_COUNTRY']		    =$_POST['A_COUNTRY'];

	 $data['A_PINCODE']		    =$_POST['A_PINCODE'];

	 $data['A_PHONE']		    =$_POST['A_PHONE'];

	 $data['A_EMAIL']		    =$_POST['A_EMAIL'];

	 $data['A_REGISTERED']	    = NOW();

	 $data['A_DISPLAY_NAME']    =$_POST['A_FULLNAME'];

	 $data['A_ACTIVE']          =1;

	 $data['A_ROLE']            ='o';

	 

	 $family->InsertParentForm($data);
	 if(!empty($data['A_EMAIL'])){
		 $SuccessMailData['to'] = $data['A_EMAIL'];
		$SuccessMailData['sub'] = "Operator Registration Details";
		$SuccessMailData['fullname'] = 	$data['A_FULLNAME'].' '.$data['A_FATHER_NAME'].' '.$SurnameArr[$data['A_SURNAME']];
		$SuccessMailData['fullname'] = mb_strtoupper($SuccessMailData['fullname']);
		$SuccessMailData['familyno'] = $data['A_USERNAME'];
		$SuccessMailData['pass'] = $data['A_PASSWORD'];

		$message1 = '<html><body style="width=800px;height:600px;">';
		$message1 .= "<p><b>Dear Operator, ".$SuccessMailData['fullname'].",</b></p>"."\r\n";
		$message1 .= "<p>Thank you for registering at <a href='http://www.velanivasaniparivar.org'>www.velanivasaniparivar.org</a><br/>";
		$message1 .= "Your Operator account is created and must be activated before you can use it";
		$message1 .= "<p>Your Login Details .</p>"."\r\n";
		$message1 .= "<p><b>User Name :</b>".$SuccessMailData['familyno']."</p>"."\r\n";
		$message1 .= "<p><b>Password  :</b> ".$SuccessMailData['pass']."</p><br/>"."\r\n\n\n";
		$message1 .= "<p>Logon to <a href='http://www.velanivasaniparivar.org'>www.velanivasaniparivar.org</a>.</p>"."\r\n";
		$message1 .= "<p>Click here to browse <a href='http://www.velanivasaniparivar.org'>www.velanivasaniparivar.org</a></p>"."\r\n";
/*		$message1 .= "<h5>ખાસ નોંધ પાત્ર બાબતો.</h5>"."\r\n";
		$message1 .= "<ol style='color:gray;'>
                      <li>પરિવારના સર્વે સભ્યોને જય વેલદાદા જય વાલદાદા </li>
                      <li>આ ફૅમિલી રજીસ્ટ્રેસન  સોફ્ટવેર માત્ર ને માત્ર વેલાણી અને વાસાણી પરિવાર ના સભ્યો પુરતો જ મર્યાદિત  છે.  માટે જો આપ વેલાણી વાસાણી પરિવાર ના  સભ્યો હોય તોજ રજીસ્ટ્રેસન કરવા વિનંતી છે.</li>
                      <li>આપણાં સોફ્ટવેર માં સભ્યો  નું રજીસ્ટ્રેસન ફોન નંબરના આધારે કરવામાં આવે છે. એક નંબર પરથી એકજ વખત  રજીસ્ટ્રેસન થઈ શકસે અને સભ્યો ને વિનંતી છે કે જે નંબર તમારો કાયમી હોય તેજ નંબર  થી રજીસ્ટ્રેસન કરવું જેથી ભવિષ્યમાં સંસ્થાને તમારી જરૂર પડે તો તમારો સંપર્ક કરી  શકે.</li>
                      <li>સોફ્ટવેરમાં રજીસ્ટ્રેસન  કર્યા બાદ સભ્યોએ પોતાના પરિવારના દરેક સભ્યોની પૂરી વિગતવાર એન્ટ્રી કરવી.</li>
                      <li>સભ્યોના પરિવારમાં જે  નિયાણી (પરણિત કે અપરણિત) હોય તેની નામ સાથેની પૂરી વિગતવાર સોફ્ટવેર માં એન્ટ્રી  કરવી જરૂરી છે. તમે આપેલી નિયાણી ની યાદી મુજબ જ નિયાણી ને દાન ભેટ આપવામાં આવશે.  તેથી માત્ર એકજ વખત નિયાણીના નામ ની એન્ટ્રી કરવી.</li>
                      <li>સભ્યો જે પરિવારની વિગત  આપે જેવી કે પરિવારના સભ્યોના નામની યાદી, હાલનું કે વતનનું સરનામું, વ્યવસાય, અભ્યાસ, ફોન નંબર વગેરે અચૂક પણે સાચી આપવી જેથી ભવિષ્યમાં માં  સંસ્થા ને સંપર્ક કરવામાં સરળતા રહે.</li>
                      <li>નિયાણી ની યાદી બાબતે ખાસ  નોંધ.
                        <ol>
                          <li>પરિવાર માં એક દાદાના બે  દીકરા હોય તે બે દીકરા અલગ અલગ નામ થી રજીસ્ટ્રેશન કરાવે તો તેમની બહેનોની યાદી  કોઈ પણ એકજ ભાઈના ફોર્મ માં હોય તે ખાસ નોંધ લેવી.</li>
                          <li>બંને ભાઈએ  પોતાની પરણિત કે અપરણિત દીકરીની યાદી પોતાના  રજીસ્ટ્રેશન માં લેવી.</li>
                          <li>જે કોઈ રજીસ્ટ્રેશન  પિતાના નામે કરાવે તો તેમાં દીકરી, પૌત્રી, ફઈ કે ફઈબાની યાદી એકજ રજીસ્ટ્રેશન માં આવરી  લેવી.</li>
                        </ol>
                      </li>
                      <li>જે કોઈ પણ સભ્યને  રજીસ્ટ્રેશન કરવામાં કોઈ પણ પ્રશ્ન કે મુંજવણ હોય તો તે પોતાના કે નજીકના ગામના  નિમેલા કન્વિનર ભાઈઓ નો સંપર્ક કરવો. જો ત્યાં થી પણ નિવારણ ના આવે તો કમિટીનો  સંપર્ક કરવો.</li>
                    </ol>"."\r\n";*/
		$message1 .= "</body></html>";
		$SuccessMailData['msg'] = $message1;
		
		$family->send_mail($SuccessMailData);
		 
		 }
		 if(!empty($_POST['A_PHONE'])){
			  $user_data=array();

		$message = "Dear $name,\r\n";

		$message.="Your operator Account Created with Our Website. Your Login Details are as below.\r\n";

		$message.="UserName:".$data['A_USERNAME']."\r\n";

		$message.="Password  :".$_POST['A_PASSWORD']."\r\n";

		$message.="Login to www.kotdajadodar.org to active your profile."."\r\n";

		$user_data["mobiles"] 	= trim($_POST['A_PHONE']);

		$user_data["sms"] 		= trim($message);

		$user_data["senderid"] 	= "KMDSMJ";

		$user_data["version"] 	= "3";
				$family->send_sms($user_data);

			 }
	 
	 	
		
		
		
		
		

	 $user_id=mysql_insert_id();

	header("location:listoperators.php");

	exit;

}

?>

<link rel="stylesheet" type="text/css" href="js/date/mycalendar.css"/>

<div class="grid_12">

    <div class="box">

        <div class="header"> <img src="img/icons/packs/fugue/16x16/ui-text-field-format.png" alt="" width="16" height="16">

            <h3>Add Operator Details</h3>

            <span></span> </div>

        <form class="validate" id="myform" novalidate method="post" enctype="multipart/form-data">

            <div class="content">

                <div class="grid_3">

                    <fieldset>

                        <legend>My Profile</legend>

                        <div class="_100">

                            <p>

                                <input type="file" name="A_IMG" />

                            </p>

                        </div>

                    </fieldset>

                </div>

                <div class="grid_9">

                    <fieldset>

                        <legend>Personal Details</legend>

                        <div class="_25">

                            <label> Full Name <font color="#FF0000">*</font></label>

                            <p>

                                <input name="A_FULLNAME" type="text" placeholder=" Your Full name" class="required" />

                            </p>

                        </div>

                        <div class="_25">

                            <label> Username <font color="#FF0000">*</font></label>

                            <p>

                                <input name="A_USERNAME" type="text" placeholder=" Your User name" class="required" />

                            </p>

                        </div>

                        <div class="_25">

                            <label> Password <font color="#FF0000">*</font></label>

                            <p>

                                <input name="A_PASSWORD" id="password" type="password" placeholder=" Your Password" class="required" />

                            </p>

                        </div>

                        <div class="_25">

                            <label> Date of Birth </label>

                            <p>

                                <input name="A_DOB" type="text" id="date2"  />

                            </p>

                        </div>
                        
                        <div class="clear"></div>


                        <div class="_25">

                            <label> Sex <font color="#FF0000">*</font></label>

                            <p>

                                <?php foreach($sexArr as $k=>$v){?>

                                <?php echo $v;?> ::

                                <input type="radio" class="required" name="A_SEX" value="<?php echo $k;?>">

                                <?php }?>

                            </p>

                        </div>

                        <div class="_25">

                            <label> Email Id </label>

                            <p>

                                <input name="A_EMAIL" type="email" placeholder=" Your Email" />

                            </p>

                        </div>

                        <div class="_25">

                            <label> Mobile <font color="#FF0000">*</font></label>

                            <p>

                                <input name="A_PHONE" type="number" min="0" maxlength="10" placeholder=" Your Mobile" class="required" />

                            </p>

                        </div>

                      

                        <div class="clear"></div>

                    </fieldset>

                </div>

                <div class="clear"></div>
                
                <fieldset>
          <legend>Address</legend>
          <div class="_25">
            <label>Address </label>
            <p>
              <textarea name="A_ADDRESS" rows="5"  class="" placeholder=" હાલનુ સરનામું"></textarea>
            </p>
          </div>
          <div class="_75">
          <div class="_50">
            <label> State </label>
            <p>
              <select name="A_STATE" class="state" id="state" onchange="state_change(this);">
                <option value="">--Select State--</option>
                <?php
								 $state = $family->getStateList();
								  foreach( $state as $k3=>$v3){
									  

									echo "<option value='".$v3['id']."'>".$v3["state"]."</option>";	

								}?>
             <!--<option value="other">Add Other</option>--->

                                
                                </select>
                                 <input id="stateo" name="state_oc"  placeholder="Enter your State Name" >
            </p>
          </div>
          <div class="_50">
            <label> City </label>
            <p>
              <select name="A_CITY" class="city_list" id="city" onChange="city_change(this);">
                <option value="">--Select City--</option>
                <?php
                                 
                                  foreach( $city as $k3=>$v3){
                                      
    
                                   // echo "<option value='".$v3['id']."'>".$v3["city"]."</option>";	
    
                                }?>
                <!---<option value="other">Add Other</option>-->

                           
                                </select>
                                 <input id="cityo" name="city_oc"  placeholder="Enter your City Name" >
            </p>
          </div>
           <div class="clear"></div>
          <div class="_50">
            <label> Country </label>
            <p>
              <input name="A_COUNTRY" type="text" placeholder=" દેશ"  />
            </p>
          </div>
          <div class="_50">
            <label> Pincode </label>
            <p>
              <input name="A_PINCODE" type="number" maxlength="6" placeholder=" પિન નંબર"  />
            </p>
          </div>
          </div>
          
          
          <div class="clear"></div>
        </fieldset>

             
            </div>

            <div class="actions">

                <div class="actions-left">

                    <input type="reset" />

                </div>

                <div class="actions-right">

                    <input type="submit" value="Submit" />

                </div>

            </div>

        </form>

    </div>

    <!-- End of .box --> 

</div>
<script>
var city = '<?php echo $family->jsonCityList(); ?>';
</script>
<?php include('footer.php');?>


<script language="javascript" src="js/date/mydatepickr.js"></script>

<script>

new datepickr('date2',{

	'dateFormat': 'd-m-Y'

	});

</script>