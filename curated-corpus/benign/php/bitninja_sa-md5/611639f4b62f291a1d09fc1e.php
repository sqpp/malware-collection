<?php
session_start();
require_once('inc/autentic.inc');
include('inc/dbcn.inc');
require_once('inc/formvalidator.php');
$msg="";

if(isset($_POST['add']))
{
    		extract($_POST);
			$k_pic="";
			include('image-upload.php');
			
			if($_FILES['k_pic']['name']!='' && ($_FILES["k_pic"]["type"]=="image/jpeg" || $_FILES["k_pic"]["type"]=="image/jpg" || $_FILES["k_pic"]["type"]=="image/png"))
			{
				$k_pic=time().$_FILES['k_pic']['name'];
				move_uploaded_file($_FILES['k_pic']['tmp_name'],"../images/kidscorner/".$k_pic);
				
			}
			
			mysql_query("INSERT INTO mst_kcorner(k_heading,k_content,k_pic)
			VALUES (
			'".mysql_real_escape_string($k_heading)."',
			'".mysql_real_escape_string($k_content)."',
			'".mysql_real_escape_string($k_pic)."'
			)") or die("Insert Error".mysql_error());			
			header('Location:kids_corner.php?save=true');
}

else if(isset($_POST['update']))
{
			extract($_POST);
	
	if($_FILES['k_pic']['name']!='' && ($_FILES["k_pic"]["type"]=="image/jpeg" || $_FILES["k_pic"]["type"]=="image/jpg" || $_FILES["k_pic"]["type"]=="image/png"))
			{
			$k_pic=time().$_FILES['k_pic']['name'];
			move_uploaded_file($_FILES['k_pic']['tmp_name'],"../images/kidscorner/".$k_pic);
			
			mysql_query("UPDATE `mst_kcorner` SET 
			`k_pic`='".mysql_real_escape_string($k_pic)."'
			WHERE `k_id` =".$k_id."") or die(mysql_error());
		}
			mysql_query("UPDATE `mst_kcorner` SET 
			`k_heading`='".mysql_real_escape_string($k_heading)."',
			`k_content`='".mysql_real_escape_string($k_content)."'
			 WHERE `k_id` =".$k_id."") or die(mysql_error());
			 header('Location:kids_corner.php?update=true');
			
}

else if(isset($_GET['del_id']))
{
    $id=$_GET['del_id'];
    $qs="delete from mst_kcorner where k_id=$id";
    if(mysql_query($qs))
    {
        $msg="<div class='alert alert-danger alert-dismissable'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>Record Deleted Successfully.</div>";
	}
	
}
if(isset($_GET['save']))
{
	$msg="<div class='alert alert-success alert-dismissable'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>Record added Successfully.</div>";
}
if(isset($_GET['update']))
{
	$msg="<div class='alert alert-warning alert-dismissable'><button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>Record Updated Successfully.</div>";
}
?>
<!DOCTYPE html>
<html lang="en"> 
<head>   
    <meta charset="UTF-8" />
    <title>Kids Corner</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="Super Admin" name="description" />
	<meta content="Ankur Sinha" name="author" />
    <!-- GLOBAL STYLES -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/theme.css" />
    <link rel="stylesheet" href="assets/css/MoneAdmin.css" />
    <link rel="stylesheet" href="assets/plugins/Font-Awesome/css/font-awesome.css" />
    <!--END GLOBAL STYLES -->
    <!-- PAGE LEVEL STYLES  for date and time picker and tag input-->
    <link rel="stylesheet" href="assets/plugins/daterangepicker/daterangepicker-bs3.css" />
    <link rel="stylesheet" href="assets/plugins/datepicker/css/datepicker.css" />
    <link rel="stylesheet" href="assets/plugins/timepicker/css/bootstrap-timepicker.min.css" />
    <link rel="stylesheet" href="assets/plugins/tagsinput/jquery.tagsinput.css" />
    <!-- END PAGE LEVEL  STYLES -->
	<!-- PAGE LEVEL STYLES FOR FILE UPLOAD-->
	<link rel="stylesheet" href="assets/css/bootstrap-fileupload.min.css" />
    <!-- END PAGE LEVEL  STYLES -->
    <script language="javascript">
    function edit_data(id,heading,content,pic)
    {
		//alert('Function Is working......');
        document.frm1.k_id.value=id;
        document.frm1.k_heading.value=heading;
		document.frm1.k_content.value=content;
		document.getElementById("k_pic").src="../images/kidscorner/"+pic;
		document.frm1.update.disabled=false;
		document.frm1.add.disabled=true;
    }
    </script>
</head>
<body class="padTop53 " >
    <div id="wrap">
        <?php include('inc/header.inc'); ?>
        <?php include('inc/left.inc'); ?>       
        <div id="content">
            <div class="inner" style="min-height:700px;">
                <div class="row">  
					<br/>				
					<div class="col-lg-12">
                        <?php echo $msg; ?>
                    </div>					
                </div>
                <div class="row">
					<div class="col-lg-12">
						<div class="panel panel-default">
							<div class="panel-body">
								<div class="row">
									<div class="col-lg-6">                                    
										<form id="reg_form" method="post" action="#" name="frm1"  enctype="multipart/form-data">
											<input name="k_id" class="form-control" type="hidden"  required="required"/>                                        
											<div class="form-group">
												<label>Heading</label>
												<input name="k_heading" class="form-control" type="text" value=""  required="required"/>
											</div>
											<div class="form-group">
												<label for="autosize" class="control-label">Content</label>
												<textarea id="autosize" name="k_content" class="form-control"></textarea>
												
											</div>
											<button name="add" type="submit" class="btn btn-success">Save </button>
											<button name="update" disabled type="submit" class="btn btn-warning">Update </button>
									</div>   
									<div class="col-lg-6">                                    
											<!-- image upload --> 
											<div class="form-group">
												<div class="fileupload fileupload-new" data-provides="fileupload">
													<div class="fileupload-new thumbnail" style="width: 200px; height: 150px;"><img src="../images/kidscorner/<?php echo $k_pic; ?>" alt="" id="k_pic" /></div>
													<div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 20px;"></div>
													<div>
														<span class="btn btn-file btn-primary"><span class="fileupload-new">Select image</span><span class="fileupload-exists">Change</span><input type="file" name="k_pic" /></span>
														<a href="#" class="btn btn-danger fileupload-exists" data-dismiss="fileupload">Remove</a>
													</div>
												</div>
											</div>
									</div>
								</form>
								</div>
								
							</div>
						</div>
					</div>
                </div>
                <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <b><i class="icon-user "></i>Kids Corner</b>
                        </div>
                        <div class="panel-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                    <thead>
                                        <tr>
                                            <th>#</th>
											<th>Heading</th>
                                            <th>Content</th>
											<th>Pic</th>
                                            <th style="max-width:100px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <?php
                                    $qs="select * from mst_kcorner";
                                    $data=mysql_query($qs) or die(mysql_error());
                                    $no=1;
                                    while($row=mysql_fetch_array($data))
                                    {

                                    ?>
                                        <tr class="odd gradeX">
                                            <td><?php echo $no++; ?></td>
											<td><?php echo $row['k_heading'];?></td>
											<td><?php echo $row['k_content'];?></td>
											<td>
												<div class="">
                                                   <img src="../images/kidscorner/<?php echo $row['k_pic']; ?>" alt="..." class="fileupload-new thumbnail" style="width: 60px; height:50px;">
                                                </div>
											</td>
                                            <td class="center">
												&nbsp;&nbsp;&nbsp;<a class="label label-success" href="#" onclick="edit_data('<?php echo $row['k_id']?>','<?php echo $row['k_heading']?>','<?php echo $row['k_content']?>','<?php echo $row['k_pic']?>')"><i class="icon-edit"></i> EDIT</a>
												&nbsp;&nbsp;&nbsp;<a class="label label-danger" href="kids_corner.php?del_id=<?php echo $row['k_id']; ?>" onclick="return confirm('Are you sure want to Delete ?')"><i class="icon-trash"></i> DELETE</a> 
                                            </td>
                                        </tr>
                                    <?php
                                    }
                                    ?>
                                    </tbody>
                                </table>
                            </div>
                           
                        </div>
                    </div>
                </div>
            </div> 
            </div>
        </div>
    </div>

     <!--END MAIN WRAPPER -->

   <!-- FOOTER -->
    <?php include('inc/footer.inc'); ?>
    <!--END FOOTER -->
     <!-- GLOBAL SCRIPTS -->
    <script src="assets/plugins/jquery-2.0.3.min.js"></script>
     <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/plugins/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <!-- END GLOBAL SCRIPTS -->
    <!-- PAGE LEVEL SCRIPTS for data table -->
    <script src="assets/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="assets/plugins/dataTables/dataTables.bootstrap.js"></script>
     <script>
         $(document).ready(function () {
             $('#dataTables-example').dataTable();
         });
    </script>
     <!-- END PAGE LEVEL SCRIPTS -->
     
     <!-- PAGE LEVEL SCRIPT for date and time picker and advance form element-->
    <script src="assets/js/jquery-ui.min.js"></script>
    <script src="assets/plugins/uniform/jquery.uniform.min.js"></script>
    <script src="assets/plugins/inputlimiter/jquery.inputlimiter.1.3.1.min.js"></script>
    <script src="assets/plugins/chosen/chosen.jquery.min.js"></script>
    <script src="assets/plugins/colorpicker/js/bootstrap-colorpicker.js"></script>
    <script src="assets/plugins/tagsinput/jquery.tagsinput.min.js"></script>
    <script src="assets/plugins/validVal/js/jquery.validVal.min.js"></script>
    <script src="assets/plugins/daterangepicker/daterangepicker.js"></script>
    <script src="assets/plugins/daterangepicker/moment.min.js"></script>
    <script src="assets/plugins/datepicker/js/bootstrap-datepicker.js"></script>
    <script src="assets/plugins/timepicker/js/bootstrap-timepicker.min.js"></script>
    <script src="assets/plugins/switch/static/js/bootstrap-switch.min.js"></script>
    <script src="assets/plugins/jquery.dualListbox-1.3/jquery.dualListBox-1.3.min.js"></script>
    <script src="assets/plugins/autosize/jquery.autosize.min.js"></script>
    <script src="assets/plugins/jasny/js/bootstrap-inputmask.js"></script>
           <script src="assets/js/formsInit.js"></script>
            <script>
                $(function () { formInit(); });
            </script>
     <!--END PAGE LEVEL SCRIPT-->
	 <!-- PAGE LEVEL SCRIPTS -->
    <script src="assets/plugins/jasny/js/bootstrap-fileupload.js"></script>
    <!-- END PAGE LEVEL SCRIPTS -->
     
</body>
    <!-- END BODY-->
    
</html>
