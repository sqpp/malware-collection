<?php

include("class_data_handling_using_file.resources_core_library.php");
include("class_salat_time.php");

$current_gregorian_month = $_POST['month_english'];
$current_hijri_month = $_POST['month_arabic'];
$unformated_salat_times = $_POST['unformated_salat_times'];
$unformated_salat_times = explode("\n", $unformated_salat_times);
$array_of_lines = array();
foreach($unformated_salat_times as $line)
{
    if(strpos($line,'Day') !== false)
    {
        
    }
    else
    {
        $array_of_lines[] = $line;
    }
}

//echo "<pre>";print_r($array_of_lines);exit;

$_SESSION['current_hijri_month'] = $current_hijri_month;
$_SESSION['current_gregorian_month'] = $current_gregorian_month;
$_SESSION['array_of_lines'] = $array_of_lines;

$info = pathinfo($_FILES['fileToUpload']['name']);
$ext = $info['extension']; // get the extension of the file
if($ext=='csv')$newname = "salat_times_of_dhaka_by_hanafi_non_formated.".$ext;
else $newname = "newname.".$ext;

$target = dirname(__FILE__).'/'.$newname;
move_uploaded_file( $_FILES['fileToUpload']['tmp_name'], $target);


$name_of_unformated_input_file_with_path = "salat_times_of_dhaka_by_hanafi_non_formated.csv";
$name_of_formated_output_file_with_path = "salat_times_of_dhaka_by_hanafi_formated.csv";

//read the file
$contents_of_file = file_get_contents($name_of_unformated_input_file_with_path);

/*
To separate by tabs:

$comp = preg_split("/[\t]/", $var);

To separate by spaces/tabs/newlines:

$comp = preg_split('/\s+/', $var);

To seperate by spaces alone:

$comp = preg_split('/ +/', $var);

*/

if(isset($array_of_lines))
{
    $array_of_lines = $array_of_lines;
}
else
{
    //create array separate by new line
    $array_of_lines = explode("\n", $contents_of_file);
}

//now save formated data to file
unset($object_of_class_salat_time);
$object_of_class_salat_time = new class_salat_time( "Dhaka", $current_hijri_month, $current_gregorian_month, $array_of_lines );
$array_of_strings = $object_of_class_salat_time->get_array_of_formated_salat_times();

//now save formated data to file
unset($object_class_data_handling_using_file);
$object_class_data_handling_using_file = new class_data_handling_using_file();

$object_class_data_handling_using_file->function_delete_file($name_of_file_with_file_path=$name_of_formated_output_file_with_path);    

$object_class_data_handling_using_file->function_append_to_file_from_array($name_of_file_with_file_path=$name_of_formated_output_file_with_path,$array_of_column_headings,$array2d_of_row_data = $array_of_strings);    


echo 'Formated File save completed  !!!!!!!!!!<br>';

//now save formated data to file
unset($object_class_data_handling_using_file);
$object_class_data_handling_using_file = new class_data_handling_using_file();
$array_of_salat_times = $object_class_data_handling_using_file->function_parse_array_of_lines_from_text_file($name_of_file_with_file_path = $name_of_formated_output_file_with_path);
//echo "<pre>";print_r($array);exit;

?>

<html>
<head>
</head>
<body>
<table>
    <?php 
        foreach($array_of_salat_times as $key=>$value)
        {
            ?>
            <?php echo "<tr><td>".$value."</td></tr>"; ?>
    <?php
    
        }
    ?>
</table>
</body>
</html>
