<?php

/**
 * Byteseller Payment Gateway Module
 *
 * Payment Gateway modules allow you to integrate Byteseller payment solutions with the

 * For more information, please refer to the online documentation.
 * @copyright Copyright (c) WHMCSNINJA.com
 * @license http://www.whmcsninja.com/
 *
 * WHMCS BytesellerGateway
 * begin "byteseller_"
 * Author whmcsninja.com
 * 
 */
require_once __DIR__ . '/../../../init.php';
require_once __DIR__ . '/../../../includes/gatewayfunctions.php';
require_once __DIR__ . '/../../../includes/invoicefunctions.php';
// Detect module name from filename.
$gatewayModuleName = basename(__FILE__, '.php');
// Fetch gateway configuration parameters.
$gatewayParams = getGatewayVariables($gatewayModuleName);
// Die if module is not active.
if (!$gatewayParams['type']) {
    die("Module Not Activated");
}
$transaction_id = $_REQUEST['transaction_id'];
$subseller_id = $_REQUEST['subseller_id'];
$order_id2 = $_REQUEST['order_id'];
$amount = $_REQUEST['amount'];
$currency = $_REQUEST['currency'];
$description = $_REQUEST['description'];
$is_test = $_REQUEST['is_test'];
$status = $_REQUEST['status'];
$sign_get = $_REQUEST['signature'];
echo $transaction_id;
$sign_real = hash('sha512', $_REQUEST['transaction_id'] . $_REQUEST['subseller_id'] . $_REQUEST['order_id'] . $_REQUEST['amount'] . $_REQUEST['currency'] . $_REQUEST['is_test'] . $_REQUEST['status'] . $gatewayParams['api_password']);
    if ($sign_get != $sign_real) {
        logTransaction($gatewayParams['name'], $_REQUEST, 'Failed');
        $paymentSuccess = false;
    } else {
        if ($status == 4) {
            $invoiceId = checkCbInvoiceID($order_id2, $gatewayParams['name']);
            checkCbTransID($_REQUEST['transaction_id']);
            logTransaction($gatewayParams['name'], $_REQUEST, 'success');
            addInvoicePayment(
                    $order_id2, $_REQUEST['transaction_id'], $amount, $paymentFee, $gatewayModuleName
            );
            $paymentSuccess = true;
        } else {
            $paymentSuccess = false;
            logTransaction($gatewayParams['name'], $_REQUEST, 'Failed');
        }
    }
exit();