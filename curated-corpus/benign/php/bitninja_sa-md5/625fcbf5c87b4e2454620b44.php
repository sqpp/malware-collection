<?php 
session_start();
include_once'config.php';

//////////////////////////////////login script

if(isset($_POST['login']))
{
	$email = mysqli_real_escape_string($con,$_POST['email']);  
	$password = mysqli_real_escape_string($con,$_POST['password']);

	$select = mysqli_query($con,"select * from admin where user_email = '$email' AND user_password ='$password'");
	$sel_row = mysqli_num_rows($select);
	$sel_user = mysqli_fetch_array($select);
	if($sel_row == 1)
	{
		$_SESSION['name'] = $sel_user['name'];
		$_SESSION['txtmail'] = $sel_user['user_email'];
		$_SESSION['role'] = $sel_user['category'];
		$_SESSION['image'] = $sel_user['image'];
		header('location:index.php');
	}
	else
	{
		$select = mysqli_query($con,"select * from users where user_email = '$email' AND user_password ='$password'");
		$sel_row = mysqli_num_rows($select);
		$sel_user = mysqli_fetch_array($select);
		if($sel_row == 1)
		{
			$_SESSION['name'] = $sel_user['name'];
			$_SESSION['txtmail'] = $sel_user['user_email'];
			$_SESSION['role'] = $sel_user['category'];
			$_SESSION['image'] = $sel_user['image'];
			header('location:index.php');

		}
		else
		{
			$_SESSION['match'] = "wrong";
			header('location:login.php');
		}

	}

}

/////////////////////////////////add category.
if(isset($_POST['addcategory']))
{
$name=mysqli_real_escape_string($con,$_POST['name']);
$page=mysqli_real_escape_string($con,$_POST['page']);

$location=mysqli_real_escape_string($con,$_POST['location']);
$arrange=mysqli_real_escape_string($con,$_POST['arrange']);

$status=mysqli_real_escape_string($con,$_POST['status']) ;
$query=mysqli_query($con,"insert into main_category (name,page,location,arrange,status)values('$name','$page','$location','$arrange','$status')")or die (mysql_error());
if($query){
  $_SESSION['addcategory']='success';
  header('location:addmaincategory.php');
}
}
/////////////////////////////////////////update category
if(isset($_POST['update_category']))
{
$update_id=mysqli_real_escape_string($con,$_POST['update_id']);
$name=mysqli_real_escape_string($con,$_POST['name']);
$page=mysqli_real_escape_string($con,$_POST['page']);
$location=mysqli_real_escape_string($con,$_POST['location']);
$arrange=mysqli_real_escape_string($con,$_POST['arrange']);
$status=mysqli_real_escape_string($con,$_POST['status']);
$query=mysqli_query($con,"update main_category set name='$name',page='$page',location='$location',arrange='$arrange',status='$status' where main_id='$update_id'")or die(mysqli_error($query));
if($query){
$_SESSION['updatemaincategory']='suceess';
 header('location:updatemaincategory.php');
}
}

//////////////////////////////////////////////add sub category
if(isset($_POST['addsubcategory']))
{
$name=mysqli_real_escape_string($con,$_POST['subname']);
$page=mysqli_real_escape_string($con,$_POST['page']);
$main=mysqli_real_escape_string($con,$_POST['main_id']);


$query=mysqli_query($con,"insert into sub_category (sub_name,sub_main_id,link)values('$name','$main','$page')")or die (mysqli_error());
if ($query){
$_SESSION['addsubcategory']="success";
header('location:addsubcategory.php');
}
}
/////////////////////////////////////update sub category
if(isset($_POST['updatesubcategory']))
{
$update=mysqli_real_escape_string($con,$_POST['update_id']);
$name=mysqli_real_escape_string($con,$_POST['subname']);
$page=mysqli_real_escape_string($con,$_POST['page']);

$main=mysqli_real_escape_string($con,$_POST['main_id']);

$query=mysqli_query($con,"update sub_category set sub_name='$name', sub_main_id='$main', link='$page' where sub_cid='$update'")or die (mysqli_error());

if ($query){
$_SESSION['updatesubcategory']="success";
header('location:updatesubcategory.php');
}
}
////////////////////////////////////////////////////////////////addd product
if(isset($_POST['addproduct']))
{
$main_id=mysqli_real_escape_string($con,$_POST['main']);
$sub_category=mysqli_real_escape_string($con,$_POST['sub_cid']);
$blogger = mysqli_real_escape_string($con,$_POST['blogger_name']);

$title=mysqli_real_escape_string($con,$_POST['title']);
// $url=mysqli_real_escape_string($con,$_POST['url']);
// $name=mysqli_real_escape_string($con,$_POST['name']);

// $blog_date=mysqli_real_escape_string($con,$_POST['date']);
$short_details=mysqli_real_escape_string($con,$_POST['short_details']);
$full_details=mysqli_real_escape_string($con,$_POST['full_details']);

$status=mysqli_real_escape_string($con,$_POST['status']);




if(isset($_FILES["image"]["name"]) && $_FILES["image"]["name"] != '')
    {


    $file  = $_FILES["image"]["name"];
    
    $file = preg_replace("/\s+/","_",$file);
    
    $file_tmp = $_FILES["image"]["tmp_name"];
    
    $file_size = $_FILES["image"]["size"];
    
    $imageType  = pathinfo($file,PATHINFO_EXTENSION);
    
    $file = pathinfo($file, PATHINFO_FILENAME);
    
    $file_name = $file."_".date("mjYHis").".".$imageType;
    

      if($file_size <= 2000000)
      {
        if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
        {
          $final_file = "../uploads/thumbnail/".$file_name;
          
          
            $image = $file_name ;
                
          
        }
        else
        {
          $_SESSION['imageformat']="success";
          header('location:addblog.php');
         
        }

      }
      else
      {
        $_SESSION['imagesize']="success";
          header('location:addblog.php');
       
      }
    }
     else
    {
           $_SESSION['selectthumb']="success";
          header('location:addblog.php'); 
        
    
    }
    

  // script for second image
  if(isset($_FILES["image1"]["name"]) && $_FILES["image1"]["name"] != '')
  {
      $file1  = $_FILES["image1"]["name"];
    
    $file1 = preg_replace("/\s+/","_",$file1);
    
    $file_tmp1 = $_FILES["image1"]["tmp_name"];
    
    $file_size1 = $_FILES["image1"]["size"];
    
    $imageType1  = pathinfo($file1,PATHINFO_EXTENSION);
    
    $file1 = pathinfo($file1, PATHINFO_FILENAME);
    
    $file_name1 = $file1."_".date("mjYHis").".".$imageType1;
      
    
    if($file_size1 <= 2000000)
      {
        if($imageType1 == "jpg" || $imageType1 == "jpeg" || $imageType1 == "png" )
        {
          $final_file1 = "../uploads/blogs/".$file_name1;
          
            $image1 = $file_name1 ;

          
        }
        else
        {
           $_SESSION['blogimage']="success";
          header('location:addblog.php'); 

        }

      }
      else
      {
        $_SESSION['blogimagesize']="success";
          header('location:addblog.php'); 
        
      }
  }


/////////////
// $sql = "INSERT INTO `blogs`(`blogger_name`, `main_cat_id`, `sub_cat_id`, `title`, `short_detail`, `description`, `thumbnail`, `blog_image`, `status`) VALUES ('$blogger','$main_id','$sub_category','$title','$short_details','$full_details','$image','$image1','$status')";

$add_blog= mysqli_query($con,"insert into blogs (blogger_name,main_cat_id,sub_cat_id,title,short_detail,description,thumbnail,blog_image,status)values('$blogger','$main_id','$sub_category','$title','$short_details','$full_details','$image','$image1','$status')") or die (mysqli_error()) ;


if($add_blog){
    move_uploaded_file($file_tmp, $final_file);
    move_uploaded_file($file_tmp1, $final_file1);

  $_SESSION['addproduct']="success";
  header('location:addblog.php');
  }	

}
//////////////////////////////////////////////////////end add  blog

////////////////////////////////////////////////////////////////update_blog
if(isset($_POST['update_blog']))
{

$update_id = mysqli_real_escape_string($con,$_POST['update_id']);

$main_id=mysqli_real_escape_string($con,$_POST['main']);
$sub_category=mysqli_real_escape_string($con,$_POST['sub_cid']);
$blogger = mysqli_real_escape_string($con,$_POST['blogger_name']);

$title=mysqli_real_escape_string($con,$_POST['title']);

$short_details=mysqli_real_escape_string($con,$_POST['short_details']);
$full_details=mysqli_real_escape_string($con,$_POST['full_details']);

$status=mysqli_real_escape_string($con,$_POST['status']);


// Upload Primary Image Script
    
        
    $target= "../uploads/thumbnail/";

    $file  = $_FILES["image"]["name"];
    
    $file = preg_replace("/\s+/","_",$file);
    
    $file_tmp = $_FILES["image"]["tmp_name"];
    
    $file_size = $_FILES["image"]["size"];
    
    $imageType  = pathinfo($file,PATHINFO_EXTENSION);
    
    $file = pathinfo($file, PATHINFO_FILENAME);
    
    $file_name = $file."_".date("mjYHis").".".$imageType;
    

    // content of second image

     $target1= "../uploads/blogs/";

    $file1  = $_FILES["image1"]["name"];
    
    $file1 = preg_replace("/\s+/","_",$file1);
    
    $file_tmp1 = $_FILES["image1"]["tmp_name"];
    
    $file_size1 = $_FILES["image1"]["size"];
    
    $imageType1  = pathinfo($file1,PATHINFO_EXTENSION);
    
    $file1 = pathinfo($file1, PATHINFO_FILENAME);
    
    $file_name1 = $file1."_".date("mjYHis").".".$imageType1;


    $old = mysqli_query($con,"select * from blogs where blog_id = '$update_id'");
    $old_image = mysqli_fetch_array($old);

    $old_thumb = $old_image['thumbnail'];
    $old_blog_image = $old_image['blog_image'];

if(isset($file_name))
    {
      if($file_size <= 2000000)
      {
        if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
        {
          

          $get_final_file = "../uploads/thumbnail/".$old_thumb;

          unlink($get_final_file);

          

          $final_file = "../uploads/thumbnail/".$file_name;

          $old_thumb = $file_name;
              
          $upload = move_uploaded_file($file_tmp, $final_file);


          
        }
        else
        {
          $_SESSION['update'] = "Please select Thumbnail in jpg, jpeg, png format only !";
          header("location:manageblog.php");
        }

      }
      else
      {
        $_SESSION['update'] = "Thumbnail image size is too big !";
        header("location:manageblog.php");
      }
    
    }

  // script for second image
  if(isset($file_name1))
  {
      
      
    
    if($file_size1 <= 2000000)
      {
        if($imageType1 == "jpg" || $imageType1 == "jpeg" || $imageType1 == "png" )
        {
          
          $get_final_file1 = "../uploads/blogs/".$old_blog_image;

          unlink($get_final_file1);

          

          $final_file1 = "../uploads/blogs/".$file_name1;

          $old_blog_image = $file_name1;
              
          $upload = move_uploaded_file($file_tmp1, $final_file1);

          
        }
        else
        {
          $_SESSION['update'] = "Please select Blog image in jpg, jpeg, png format only !";
          header("location:manageblog.php");
        }

      }
      else
      {
        $_SESSION['update'] = "Blog image size is too big !";
        header("location:manageblog.php");
      }
  }

  if(empty($_FILES['image']['name']) && empty($_FILES['image1']['name']))
  {

    $sql = "UPDATE `blogs` SET `main_cat_id`='$main_id',`sub_cat_id`='$sub_category',`title`='$title',`short_detail`='$short_details',`description`='$full_details',`status`='$status' WHERE `blog_id` = '$update_id'";
    $update = mysqli_query($con,$sql);

  }
  else
  {
    $sql = "UPDATE `blogs` SET `main_cat_id`='$main_id',`sub_cat_id`='$sub_category',`title`='$title',`short_detail`='$short_details',`description`='$full_details',`thumbnail`='$old_thumb',`blog_image`='$old_blog_image',`status`='$status' WHERE `blog_id` = '$update_id'";
    $update = mysqli_query($con,$sql);

  }

  if($query){

  	$_SESSION['update']="Blog has been successfully updated.";
  header('location:manageblog.php');
  }

}
//////////////////////////////////////////////////////////add promo code
if(isset($_POST['addpromo'])){
	$code=mysqli_real_escape_string($con,$_POST['code']);
$status=mysqli_real_escape_string($con,$_POST['status']);
$query=mysqli_query($con,"insert into promocode(code,status)values('$code','$status')");

if($query){
	$_SESSION['addpromocode']="success";
header('location:addpromocode.php');
}
}
///////////////////////////////update promocode
if(isset($_POST['updatepromo'])){
	$update=mysqli_real_escape_string($con,$_POST['update_id']);
	$code=mysqli_real_escape_string($con,$_POST['code']);
$status=mysqli_real_escape_string($con,$_POST['status']);
$query=mysqli_query($con,"update promocode set code='$code',status='$status' where id='$update'");

if($query){
	$_SESSION['updatepromocode']="success";
header('location:updatepromocode.php');
}
}

////////////////////Add User

if(isset($_POST['adduser']))
{
	$category = mysqli_real_escape_string($con,$_POST['cat']);
	$name = mysqli_real_escape_string($con,$_POST['name']);
	$url = mysqli_real_escape_string($con,$_POST['url']);
	//$image = mysqli_real_escape_string($con,$_POST['image']);
	$about = mysqli_real_escape_string($con,$_POST['about']);
	$status = mysqli_real_escape_string($con,$_POST['status']);
	$email = mysqli_real_escape_string($con,$_POST['email']); 
	$password = mysqli_real_escape_string($con,$_POST['password']);

	

	//////////////// INSERTING IMAGE 

  if(isset($_FILES["image"]["name"]) && $_FILES["image"]["name"] != '')
    {
      $file  = $_FILES["image"]["name"];
    
      $file = preg_replace("/\s+/","_",$file);
      
      $file_tmp = $_FILES["image"]["tmp_name"];
      
      $file_size = $_FILES["image"]["size"];
      
      $imageType  = pathinfo($file,PATHINFO_EXTENSION);
      
      $file = pathinfo($file, PATHINFO_FILENAME);
      
      $file_name = $file."_".date("mjYHis").".".$imageType;

        if($file_size <= 2000000)
        {
              if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
              {
                $final_file = "../uploads/users/".$file_name;
                
                
                  $image = $file_name ;
                     
                     
                      
                      
                          $sql = "INSERT INTO `users`(`name`, `category`, `user_email`, `user_password`, `url`, `image`, `about`, `status`) VALUES ('$name','$category','$email','$password','$url','$image','$about','$status')";
						  
						  $run = mysqli_query($con,$sql);

                            if($run)
                            {
                              move_uploaded_file($file_tmp, $final_file);
                              
                              $_SESSION['useradded'] = "success";
                              header('location:add-user.php');
                            }
                            else
                            {
                            	$_SESSION['querynotrun'] = "success";	
                              	header('location:add-user.php');
                            }
                     
              }
              else
              {
                $_SESSION['imageformat'] = "success";
               	header('location:add-user.php');
              }
        }
        else
        {
        	$_SESSION['sizebig'] = "success";
          	header('location:add-user.php');
        }

    }
     else
    {
    	$_SESSION['selectimage'] = "success";
         header('location:add-user.php');   
        
    
    }

	
}


////////////////////End Add User

//////////////////// Update User

if(isset($_POST['updateuser']))
{

	$update_id = mysqli_real_escape_string($con,$_POST['update_id']);
	$category = mysqli_real_escape_string($con,$_POST['cat']);
	$name = mysqli_real_escape_string($con,$_POST['name']);
	$url = mysqli_real_escape_string($con,$_POST['url']);
	$about = mysqli_real_escape_string($con,$_POST['about']);
	$status = mysqli_real_escape_string($con,$_POST['status']);
	$email = mysqli_real_escape_string($con,$_POST['email']); 
	$password = mysqli_real_escape_string($con,$_POST['password']);

	//////////////////////// UPDATE IMAGE


      $file  = $_FILES["image"]["name"];
    
      $file = preg_replace("/\s+/","_",$file);
      
      $file_tmp = $_FILES["image"]["tmp_name"];
      
      $file_size = $_FILES["image"]["size"];
      
      $imageType  = pathinfo($file,PATHINFO_EXTENSION);
      
      $file = pathinfo($file, PATHINFO_FILENAME);
      
      $file_name = $file."_".date("mjYHis").".".$imageType;

      $select_old = mysqli_query($con,"SELECT * FROM `users` WHERE `user_id` = '$update_id'");
      $fetch_old = mysqli_fetch_assoc($select_old);
      $old_image = $fetch_old['image'];


  if(!empty($file_name))
    {
      

        if($file_size <= 2000000)
        {
              if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
              {

                //first inlink the old image from directory

                $get_final_file = "../uploads/users/".$old_image;

                unlink($get_final_file);

                $final_file = "../uploads/users/".$file_name;
                
                
                 $update_image = $file_name;
                     
                    
                     move_uploaded_file($file_tmp, $final_file);
                    
                     $up_query = "UPDATE `users` SET `name`='$name',`category`='$category',`user_email`='$email',`user_password`='$password',`url`='$url',`image`='$file_name',`about`='$about',`status`='$status' WHERE `user_id` = '$update_id'";
              }
              else
              {	
              	$_SESSION['upimageformat'] = "success";
   				 header('location:add-user.php');
                
              }
        }
        else
        {
        	$_SESSION['upsizebig'] = "success";
        	 header('location:add-user.php');
          
        }

    }
     
     
    
    	$up_query = "UPDATE `users` SET `name`='$name',`category`='$category',`user_email`='$email',`user_password`='$password',`url`='$url',`about`='$about',`status`='$status' WHERE `user_id` = '$update_id'";

    	

//////////// REDIRECT TO LIST PAGE

    $run_up = mysqli_query($con,$up_query);
  if($run_up)
  {
  	$_SESSION['userupdated'] = "success";
    header('location:manageuser.php');
  }





  ////////////// END UPDATE IMAGE
}


////////////////////End Update User


//////////////////// Add adsense

if(isset($_POST['addadsense']))
{
  $place = mysqli_real_escape_string($con,$_POST['place']);
  $code  = mysqli_real_escape_string($con,$_POST['code']);

  $sql = "INSERT INTO `adsense`(`position`, `code`) VALUES ('$place','$code')";
  $query = mysqli_query($con,$sql);

  if($query)
  {
    $_SESSION['add_adsense'] = "Adsense applied successfully.";
    header('location:add-adsense.php');
  }
}

//////////////////// End add adsense


////////////////////Update adsense
if(isset($_POST['update_adsense']))
{
  $place = mysqli_real_escape_string($con,$_POST['place']);
  $code  = mysqli_real_escape_string($con,$_POST['code']);
  $update_id = mysqli_real_escape_string($con,$_POST['update_id']);

  $sql = "UPDATE `adsense` SET `position`='$place',`code`='$code' WHERE `ad_id`='$update_id'";
  $query = mysqli_query($con,$sql);

  if($query)
  {
    $_SESSION['update_adsense'] = "Adsense updated successfully.";
    header('location:manage-adsense.php');
  }

}

/////////////////// Add Media
if(isset($_POST['addmedia']))
{
      //////////////// INSERTING IMAGE 

  if(isset($_FILES["image"]["name"]) && $_FILES["image"]["name"] != '')
    {
      $file  = $_FILES["image"]["name"];
    
      $file = preg_replace("/\s+/","_",$file);
      
      $file_tmp = $_FILES["image"]["tmp_name"];
      
      $file_size = $_FILES["image"]["size"];
      
      $imageType  = pathinfo($file,PATHINFO_EXTENSION);
      
      $file = pathinfo($file, PATHINFO_FILENAME);
      
      $file_name = $file."_".date("mjYHis").".".$imageType;

        if($file_size <= 2000000)
        {
              if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
              {
                $final_file = "../uploads/media/".$file_name;
                
                
                  $image = $file_name ;
                     
                     
                      
                      
                          $sql = "INSERT INTO `media`(`image`) VALUES ('$image')";
              
              $run = mysqli_query($con,$sql);

                            if($run)
                            {
                              move_uploaded_file($file_tmp, $final_file);
                              
                              $_SESSION['media'] = "Image has been successfully added.";
                              header('location:add-media.php');
                            }
                            else
                            {
                              $_SESSION['media'] = "Image is not added."; 
                                header('location:add-media.php');
                            }
                     
              }
              else
              {
                $_SESSION['media'] = "Please select image in jpg, jpeg, png format only !";
                header('location:add-media.php');
              }
        }
        else
        {
          $_SESSION['media'] = "Image size is too big.";
            header('location:add-media.php');
        }

    }
     else
    {
      $_SESSION['media'] = "Please select an image.";
         header('location:add-media.php');   
        
    
    }

  


}
if(isset($_POST['addgallery']))
{
  $tag = mysqli_real_escape_string($con,$_POST['alt']);
  $sub_cid = mysqli_real_escape_string($con,$_POST['main_id']);

  $sel_sub = mysqli_query($con,"select * from sub_category where sub_cid = '$sub_cid'");
  $sub_fetch = mysqli_fetch_array($sel_sub);
  $sub_name = $sub_fetch['sub_name'];

  //////////////// INSERTING IMAGE 

  if(isset($_FILES["image"]["name"]) && $_FILES["image"]["name"] != '')
    {
      $file  = $_FILES["image"]["name"];
    
      $file = preg_replace("/\s+/","_",$file);
      
      $file_tmp = $_FILES["image"]["tmp_name"];
      
      $file_size = $_FILES["image"]["size"];
      
      $imageType  = pathinfo($file,PATHINFO_EXTENSION);
      
      $file = pathinfo($file, PATHINFO_FILENAME);
      
      $file_name = $file."_".date("mjYHis").".".$imageType;

        if($file_size <= 2000000)
        {
              if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
              {
                $final_file = "../uploads/gallery/".$file_name;
                
                
                  $image = $file_name ;
                     
                     
                      
                          $sql = "INSERT INTO `gallery`(`sub_cid`, `sub_name`, `alt_tag`, `image`) VALUES ('$sub_cid','$sub_name','$tag','$image')";
              
              $run = mysqli_query($con,$sql);

                            if($run)
                            {
                              move_uploaded_file($file_tmp, $final_file);
                              
                              $_SESSION['media'] = "Image has been successfully added.";
                              header('location:add-gallery.php');
                            }
                            else
                            {
                              $_SESSION['media'] = "Image is not added."; 
                                header('location:add-gallery.php');
                            }
                     
              }
              else
              {
                $_SESSION['media'] = "Please select image in jpg, jpeg, png format only !";
                header('location:add-gallery.php');
              }
        }
        else
        {
          $_SESSION['media'] = "Image size is too big.";
            header('location:add-gallery.php');
        }

    }
     else
    {
      $_SESSION['media'] = "Please select an image.";
         header('location:add-gallery.php');   
        
    
    }
}

if(isset($_POST['update_gallery']))
{
  $tag = mysqli_real_escape_string($con,$_POST['alt']);
  $update_id = mysqli_real_escape_string($con,$_POST['update_id']);
  $sub_cid = mysqli_real_escape_string($con,$_POST['main_id']);

  $sel_sub = mysqli_query($con,"select * from sub_category where sub_cid = '$sub_cid'");
  $sub_fetch = mysqli_fetch_array($sel_sub);
  $sub_name = $sub_fetch['sub_name'];

  // $sel_sub1 = mysqli_query($con,"select * from gallery where sub_cid = '$sub_cid'");
  // $sub_fetch1 = mysqli_fetch_array($sel_sub);
  // $sub_name = $sub_fetch['sub_name'];
  
  //////////////////////// UPDATE IMAGE


      $file  = $_FILES["image"]["name"];
    
      $file = preg_replace("/\s+/","_",$file);
      
      $file_tmp = $_FILES["image"]["tmp_name"];
      
      $file_size = $_FILES["image"]["size"];
      
      $imageType  = pathinfo($file,PATHINFO_EXTENSION);
      
      $file = pathinfo($file, PATHINFO_FILENAME);
      
      $file_name = $file."_".date("mjYHis").".".$imageType;

      $select_old = mysqli_query($con,"SELECT * FROM `gallery` WHERE `g_id` = '$update_id'");
      $fetch_old = mysqli_fetch_assoc($select_old);
      $old_image = $fetch_old['image'];


if(isset($file_name))
    {
      if($file_size <= 2000000)
      {
        if($imageType == "jpg" || $imageType == "jpeg" || $imageType == "png" )
        {
          

          $get_final_file = "../uploads/gallery/".$old_thumb;

          unlink($get_final_file);

          

          $final_file = "../uploads/gallery/".$file_name;

          $old_gal_image = $file_name;
              
          $upload = move_uploaded_file($file_tmp, $final_file);


          
        }
        else
        {
          $_SESSION['gallery'] = "Please select Thumbnail in jpg, jpeg, png format only !";
          header("location:add-gallery.php");
        }

      }
      else
      {
        $_SESSION['gallery'] = "Thumbnail image size is too big !";
        header("location:add-gallery.php");
      }
    
    }
  
     
     if(empty($_FILES['image']['name']))
     {
   
       $up_query = "UPDATE `gallery` SET `sub_cid`='$sub_cid', `sub_name`='$sub_name', `alt_tag`='$tag' WHERE `g_id` ='$update_id'";
    
      }
      else
      {

          $up_query = "UPDATE `gallery` SET `sub_cid`='$sub_cid', `sub_name`='$sub_name', `alt_tag`='$tag', `image`='$old_gal_image' WHERE `g_id` ='$update_id'";

      }

//////////// REDIRECT TO LIST PAGE

    $run_up = mysqli_query($con,$up_query);
  if($run_up)
  {
    $_SESSION['galleryupdated'] = "Gallery image successfully updated.";
    header('location:manage-gallery.php');
  }

}

//////////////////////Add Videos

if(isset($_POST['addvideos']))
{
  $title = mysqli_real_escape_string($con,$_POST['title']);
  $link = mysqli_real_escape_string($con,$_POST['link']);

  $sql ="INSERT INTO `videos`(`title`, `link`) VALUES ('$title','$link')";

  $run = mysqli_query($con,$sql);
  if($run)
  {
    $_SESSION['videos'] = "Video added successfully.";
    header('location:add-yt-vids.php');
  }
}

if(isset($_POST['updatevideos']))
{
  $vids_id = mysqli_real_escape_string($con,$_POST['update_id']);
  $title = mysqli_real_escape_string($con,$_POST['title']);
  $link = mysqli_real_escape_string($con,$_POST['link']); 

  $sql = mysqli_query($con,"UPDATE `videos` SET `title`='$title',`link`='$link' WHERE `vid_id`='$vids_id'");

  if($sql == TRUE)
  {
      $_SESSION['videosupdated'] = "Video updated successfully.";
    header('location:youtube-vids.php'); 
  }
}





///////////////////////////////////////////// add product
if(isset($_POST['add_product']))
{
   $product_name=mysqli_real_escape_string($con,$_POST['product_name']); 
   $product_price=mysqli_real_escape_string($con,$_POST['product_price']); 
   $product_description=mysqli_real_escape_string($con,$_POST['product_description']); 
   $web_link=mysqli_real_escape_string($con,$_POST['web_link']); 
   $date=date("Y-m-d");
   $img=rand("1000","10000")._.$_FILES["product_image"]["name"];
   $tmp_img=$_FILES["product_image"]["tmp_name"];
   move_uploaded_file($tmp_img,"uploads/product_image/$img");
   
   if($_FILES["product_image"]["name"]!='')
   {
   $query_add=mysqli_query($con,"insert into tbl_product(product_name,product_price,product_image,product_description,web_link,date)VALUES('$product_name','$product_price','$img','$product_description','$web_link','$date')");
   }
   else
   {
    $query_add=mysqli_query($con,"insert into tbl_product(product_name,product_price,product_image,product_description,web_link,date)VALUES('$product_name','$product_price','','$product_description','$web_link','$date')");   
   }
   if($query_add)
   {
    $_SESSION['success']="Successfully Added";
    header("location:add_product.php");   
   }
   else
   {
    $_SESSION['success_error']="Something Went Wrong";
    header("location:add_product.php");    
   }
}


////////////////////////////////////// update product
if(isset($_POST['update_product']))
{
   $update_id=mysqli_real_escape_string($con,$_POST['update_id']);
   $product_name=mysqli_real_escape_string($con,$_POST['product_name']); 
   $product_price=mysqli_real_escape_string($con,$_POST['product_price']); 
   $product_description=mysqli_real_escape_string($con,$_POST['product_description']); 
   $web_link=mysqli_real_escape_string($con,$_POST['web_link']); 
   $date=date("Y-m-d");
   if($_FILES["product_image"]["name"]!='')
   {
   $img=rand("1000","10000")._.$_FILES["product_image"]["name"];
   $tmp_img=$_FILES["product_image"]["tmp_name"];
   move_uploaded_file($tmp_img,"uploads/product_image/$img");
   }
   else
   {
    $img=$_POST['product_image_old'];   
   }
  
   $query_update=mysqli_query($con,"UPDATE tbl_product SET product_name='$product_name',product_price='$product_price',product_image='$img',product_description='$product_description',web_link='$web_link' WHERE product_id='$update_id'");
   
  
   if($query_update)
   {
    $_SESSION['success_update']="Successfully Updated";
    header("location:manage_product.php");   
   }
   else
   {
    $_SESSION['success_update_error']="Something Went Wrong";
    header("location:manage_product.php");    
   }   
}
?>

