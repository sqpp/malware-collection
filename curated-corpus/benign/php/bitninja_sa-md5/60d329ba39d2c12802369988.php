<?php 
    include_once 'config.php';   
    include_once 'login-check.php'; 
    $sno = "";
    if(isset($_GET["sno"])){
        $sno = $_GET["sno"];
    }
   
    $query = "SELECT `auction_id`, `bid_amount`, `bid_type`, `user_id`, `winning_bid`, `created`, `status` FROM auction_bids WHERE sno=? "; 
    $stmt1 = $conn->prepare($query);
    $stmt1 ->bind_param("s", $sno);
    $stmt1 -> execute();
    $stmt1 -> store_result();
    $stmt1 -> bind_result($auction_id, $bid_amount,  $bid_type,  $biduser_id, $winning_bid, $bitcreated, $bidstatus);
    $stmt1 -> fetch();
    if($bidstatus == "A") { $bidstatus="Active"; } else { $bidstatus="Deleted"; }

    $query = "SELECT `name`, `short_description`, `description`, `start_price`, `buy_price`, `min_bid_price`,  `inc_bid_amount`, `featured_image`, `start_date`, `end_date`, `win_bid_amount`, `status`, `created` FROM `auction_main` WHERE sno=? "; 
    $stmt = $conn->prepare($query);
    $stmt ->bind_param("s", $auction_id);
    $stmt -> execute();
    $stmt -> store_result();
    $stmt -> bind_result($name, $short_description, $description, $start_price, $buy_price, $min_bid_price, $inc_bid_amount,  $featured_image, $start_date , $end_date, $win_bid_amount, $aucstatus, $auccreated);
    $stmt -> fetch();
    $featured_image_id = array('path','auction_gallery', 'sno', 's');
    if($aucstatus == "A") { $aucstatus="Active"; } else { $aucstatus="Deleted"; }

    $query = "SELECT user_name, profile_image_name, path, mobile, email, status FROM auction_user WHERE sno=? "; 
    $stmt2 = $conn->prepare($query);
    $stmt2 ->bind_param("s", $biduser_id);
    $stmt2 -> execute();
    $stmt2 -> store_result();
    $stmt2 -> bind_result($user_name, $profile_image_name, $path, $mobile, $email,  $userstatus);
    $stmt2 -> fetch();
    if($userstatus == "A") { $userstatus="Active"; } else { $userstatus="Deleted"; }
    $profile = "images/faces/face6.jpg";
    if($profile_image_name != "")
    {
        $profile = $path.$profile_image_name;
    }

    include_once 'head-includes.php';
?>

<title>Bid</title>
<?php
   include_once 'header.php';
?>
<div class="content-wrapper">
  <div class="row">
    <div class="col-md-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
        <h4 class="card-title">Auction</h4>
          <div class="row">
            <div class="col-md-2">
              <address class="text-center ">
                <img src ="<?= get_setup_table_name($featured_image, $featured_image_id); ?>" class='img-responsive imgGallery mb-3' style='cursor:pointer;margin:0 auto;width: 80%' alt=''>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Dispaly Name</p>
                <p class="mb-2"><?= $name; ?></p>
                <p class="font-weight-bold">Auction Status</p>
                <p><?= $aucstatus; ?></p>
                <p class="font-weight-bold">Start Price</p>
                <p><?= $start_price; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Buy Now Price</p>
                <p class="mb-2"><?= $buy_price; ?></p>
                <p class="font-weight-bold">Minimum Bid Price</p>
                <p><?= $min_bid_price; ?></p>
                <p class="font-weight-bold">Increament Bid Price</p>
                <p class="mb-2"><?= $inc_bid_amount; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Win Bid Amount</p>
                <p><?= $win_bid_amount; ?></p>
                <p class="font-weight-bold">Bid Start</p>
                <p><?= $start_date; ?></p>
                <p class="font-weight-bold">Bid End</p>
                <p class="mb-2"><?= $end_date; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Short Description</p>
                <p><?= $short_description; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Description</p>
                <p class="mb-2"><?= $description;  ?></p>
              </address>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">User & Bid Details</h4>
          <div class="row">
            <div class="col-md-2 text-center">
              <img src ="<?=$profile;?> " class='img-responsive imgGallery mb-3' style='cursor:pointer;margin:0 auto;width: 60%' alt=''>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Username</p>
                <p class="mb-2"><?= $user_name;  ?></p>
                <p class="font-weight-bold">Email</p>
                <p><?= $email; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Mobile</p>
                <p class="mb-2"><?= $mobile; ?></p>
                <p class="font-weight-bold">User Status</p>
                <p><?= $userstatus; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Bid Amount</p>
                <p class="mb-2"><?= $bid_amount; ?></p>
                <p class="font-weight-bold">Bid Type</p>
                <p><?= $bid_type; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Winning Bid</p>
                <p class="mb-2"><?= $winning_bid; ?></p>
                <p class="font-weight-bold">Bid Created</p>
                <p><?= $bitcreated; ?></p>
              </address>
            </div>
            <div class="col-md-2">
              <address class="text">
                <p class="font-weight-bold">Bid Status</p>
                <p class="mb-2"><?= $bidstatus; ?></p>
              </address>
            </div>
          </div>
        </div>
      </div>
    </div> 
    <div class="col-md-12">
      <?php
        if($passwordsave == "yes")
        {
          echo '<button type="button" class="btn btn-danger btn-sm float-lg-right" data-toggle="modal" data-target="#exampleModal-1">Delete the Bid<i class="mdi mdi-play-circle ml-1"></i></button>';
        }
        else
        {
          echo '<button type="button" class="btn btn-danger btn-sm float-lg-right"" data-toggle="modal" data-target="#exampleModal-2">Delete the Bid<i class="mdi mdi-play-circle ml-1"></i></button>';
        }
      ?>
      <div class="modal fade" id="exampleModal-1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel-1" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel-1">Delete</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <h5 class="modal-title" id="exampleModalLabel">Are you sure delete the ""?</h5>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-success" onclick="data_delete();">Yes</button>
              <button type="button" class="btn btn-light" data-dismiss="modal">No</button>
            </div>
          </div>
        </div>
      </div>  
      <div class="modal fade" id="exampleModal-2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel-2" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel-2">Are Your sure want to delete the " " ?</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-lg-12">
                  <div class="form-group">
                    <label for="name">Password *</label>
                    <input type="password"  class="form-control" name="password" id="password" required placeholder="Kindly type your login password" >
                  </div>
                </div>
                <div class="col-lg-12">
                  <div class="form-group">
                    <input type="checkbox" name="passwordsave" id="passwordsave" value="1"/> Store the password (It will apply this session only) ???
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-success" onclick="data_delete_store();">Submit</button>
              <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
<script>
   function data_delete_store() 
   {
      var passwordsave = "";
      if ($('#passwordsave').is(":checked")) {
        var passwordsave = "1";
      }
   	  var password = $("#password").val();
      var sno = $("#sno").val();
      var dataString = 'password=' + password+ '&sno=' + sno+ '&passwordsave=' + passwordsave;
      if(password == "")
      {
        alert("Kindly Type the password");
      }
      else
      {
        $.ajax({
        type: "POST",
        url: "bid-delete.php",
        data: dataString,
        cache: false,
        success: function(data) {
        if(data == 1)
          { 
            showSwal('delete-message');
            $("#exampleModal-2").modal('hide');
            window.location = 'bid.php';
          }	
          else 
          {
            alert("Your Password is incorrect.......!!!");
          }
        }
      });
      }
   }

   function data_delete() 
   {
      var sno = $("#sno").val();
      var directdelete = "directdelete";
      var dataString = 'sno=' + sno+ '&directdelete=' + directdelete;
      $.ajax({
      type: "POST",
      url: "bid-delete.php",
      data: dataString,
      cache: false,
      success: function(data) {
      if(data == 1)
      { 
        showSwal('delete-message');
        $("#exampleModal-2").modal('hide');
        window.location = 'bid.php';
      }	
      else 
      {
        alert("No data");
      }
      }
    });
   }

</script>
<script src="<?= dashboardUrl; ?>node_modules/sweetalert/dist/sweetalert.min.js"></script>
<script src="<?= dashboardUrl; ?>js/alerts.js"></script>
<?php  
   include_once 'footer.php';     
   ?>