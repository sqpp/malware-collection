<?php
    //https://api.telegram.org/bot1589294929:AAGRjGBgAYzRQK8_iJDmTYhPsoA4P4tkw1g/setwebhook?url=https://hamidmoeeni.ir/OLD_DATA/Telegram/Mafia.php
    //https://api.telegram.org/bot1830382546:AAETeeui6lMtcyqsvyIbpj88toKb7j9Muaw/setwebhook?url=https://hamidmoeeni.ir/OLD_DATA/Telegram/Mafia-Update.php

    //لینک ها
    $my_bot_id       = 1589294929;
    $my_bot_username = "@MafiaCityGamesBot";
    $my_bot_username2= "MafiaCityGamesBot";
    $bot_url         = "https://api.telegram.org/bot1589294929:AAGRjGBgAYzRQK8_iJDmTYhPsoA4P4tkw1g";
    //$my_bot_id       = 1830382546;
    //$my_bot_username = "@Mafia_city_game_bot";
    //$my_bot_username2= "Mafia_city_game_bot";
    //$bot_url      = "https://api.telegram.org/bot1830382546:AAETeeui6lMtcyqsvyIbpj88toKb7j9Muaw";
    
    
    $file_link1    = "/home3/hamidmoe/public_html/OLD_DATA/Telegram/List1.txt";
    $file_link2    = "/home3/hamidmoe/public_html/OLD_DATA/Telegram/List2.txt";
    $file_link3    = "/home3/hamidmoe/public_html/OLD_DATA/Telegram/List3.txt";
    $file_link4    = "/home3/hamidmoe/public_html/OLD_DATA/Telegram/List4.txt";
    $file_link5    = "/home3/hamidmoe/public_html/OLD_DATA/Telegram/List5.txt";
    $file_link6    = "/home3/hamidmoe/public_html/OLD_DATA/Telegram/List6.txt";

    $update       = file_get_contents("php://input");
    $update_array = json_decode($update, true);
    //file_put_contents("/home3/hamidmoe/public_html/OLD_DATA/Telegram/checked.json", $update);

    //متغییرهای ثابت
    $r_u_sure_to_clear_data        = "برای شروع بازی جدید، اطلاعات بازی قبلی حذف خواهد شد. آیا برای شروع اطمینان دارید?";
    $you_r_NOT_admin               = "شما ادمین نیستید!";
    $clearing_data_NOT_allowded    = "فقط ادمین ها می توانند اطلاعات بازی قبلی را حذف کنند.";
    $number_of_players             ="تعداد کل بازیکن ها را مشخص کنید:";
    $number_of_players_range       = "تعداد بازیکن ها باید یک عدد صحیح بین 6 تا 30 باشد.";
    $already_registered            = "شما قبلا ثبت نام کرده اید!";
    $enter_who_would_play          = "برای خودتان میخواهید ثبت نام کنید یا یک شخص دیگر:";
    $enter_player_another_id       = "لطفا آیدی عدد بازیکن مورد نظرتان را به طور دقیق وارد کنید:";
    $entering_player_NOT_allowed   = "فقط ادمین ها می توانند شخص دیگری را ثبت نام کنند.";
    $already_registered_another    = "ایشان قبلا ثبت نام کرده اند.";
    $enter_another_number          = "شماره بازیکن موردنظر خود را وارد کنید:";
    $enter_another_name            = "نام بازیکن موردنظر خود را به فارسی وارد کنید:";
    $enter_your_name               = "نام خود را به فارسی وارد کنید:";
    $enter_your_name2              = "نام جدید خود را به فارسی وارد کنید:";
    $enter_your_name_in_persian    = "تمام یا بخشی از نام وارد شده توسط شما فارسی نیست. لطفا فقط از کاراکترهای فارسی استفاده کنید.";
    $enter_your_number             = "شماره خود در بازی را انتخاب کنید:";
    $enter_your_number_answer      = "این شماره قبلا انتخاب شده است. لطفا دوباره روی دکمه اعلام حضور کلیک کرده و شماره دیگری انتخاب کنید";
    $enter_your_number_range1      = "شماره بازیکن باید یک عدد صحیح بین 1 تا ";
    $enter_your_number_range2      = " باشد.لطفا پس از چند ثانیه دوباره تلاش کنید.";
    $enter_who_would_remove        = "ثبت نام خود را میخواهید کنسل کنید یا یک شخص دیگر را:";
    $enter_player_number_remove    = "لطفا شماره بازیکنی که میخواهید ثبت نامش را کنسل کنید وارد کنید:";
    $player_NOT_found              = "بازیکنی با این شماره یافت نشد.";
    $removing_player_NOT_allowed   = "فقط ادمین ها می توانند ثبت نام شخص دیگری را کنسل کنند.";
    $enter_event_number            = "لطفا شماره ایونت را وارد کنید";
    $enter_event_number_range      = "شماره ایونت باید یک عدد صحیح بین 1 تا 10000 باشد.";
    $enter_date                    = "لطفا تاریخ ایونت را وارد کنید. ترجیحا با این فرمت:"  .   "\n"  .  "پنجشنبه 20 آبان 1400";
    $enter_time                    = "لطفا ساعت شروع ایونت را وارد کنید. ترجیحا با فرمت زیر:"  .  "\n"  .  "16:00";
    $choose_scenario               = "سناریوی بازی را انتخاب کنید:";
    $enter_scenario                = "لطفا نام سناریوی موردنظر خود را وارد کنید:";
    $enter_who_is_god              = "گاد بازی خودتان هستید یا شخص دیگری است:";
    $enter_god_you                 = "لطفا نام خود را به عنوان گاد بازی وارد کنید";
    $enter_god_another_id          = "لطفا آیدی عددی گاد بازی را به طور دقیق وارد کنید:";
    $enter_god_another             = "لطفا نام شخصی که میخواهید گاد بازی باشد را بنویسید:";
    $enter_group                   = "لطفا نام گروه خود را وارد کنید:";
    $scenario_NOT_allows_change_NOP= "سناریوی انتخابی برای بازی، اجازه تغییر تعداد بازیکن را نمیدهد. در صورتی که میخواهید با تعدادی غیر از این بازی کنید، سناریو را روی گزینه سایر قرار دهید.";
    $entering_lower_NOP            = "اگر تعداد بازیکن ها را کاهش دهید افراد انتهای لیست حذف می شوند، آیا مطمئن هستید:";
    $entering_NOP_NOT_allowed      = "فقط ادمین ها می توانند تعداد بازیکن ها را تعیین کنند.";
    $entering_event_NOT_allowed    = "فقط ادمین ها می توانند شماره ایونت را تغییر دهند.";
    $entering_date_NOT_allowed     = "فقط ادمین ها می توانند تاریخ بازی را تغییر دهند.";
    $entering_time_NOT_allowed     = "فقط ادمین ها می توانند ساعت شروع بازی را تغییر دهند.";
    $scenario_name_NOT_allowed     = "نام سناریو نباید با هیچکدام از سناریوهای تعریف شده یکسان باشد. لطفا دوباره تلاش کنید.";
    $entering_scenario_NOT_allowed = "فقط ادمین ها می توانند سناریوی بازی را تغییر دهند.";
    $entering_god_NOT_allowed      = "فقط ادمین ها می توانند اسم گاد بازی را تغییر دهند.";
    $entering_group_NOT_allowed    = "فقط ادمین ها می توانند نام گروه را وارد کنند.";
    $opening_list_NOT_allowded     = "فقط ادمین ها میتوانند لیست بازی را باز کنند.";
    $finalization_conditions       = "برای نهایی کردن باید اطلاعات بازی شامل شماره، تاریخ، ساعت، سناریو، نام گاد و نام گروه قبلا وارد شده باشد.";
    $finalization_NOT_allowed      = "فقط ادمین ها می توانند به مرحله بعد بروند";
    $r_u_sure_for_finalization     = "درصورت نهایی کردن لیست، امکان تغییر اطلاعات بازی شامل شماره، تاریخ، ساعت، سناریو و گاد بازی امکان پذیر نمیباشد. آیا برای نهایی کردن مطمئن هستید؟";
    $you_have_alreary_seid_ready   = "شما قبلا اعلام حضور کرده اید";
    $you_should_register_first     = "برای اعلام حضور، اگر لیست تکمیل نشده باشد، ابتدا باید ثبت نام کنید.";
    $roles_should_have_already_sent= "برای رفتن به مرحله بعد، نقش ها حتما باید قرعه کشی و برای بازیکن ها ارسال شده باشد.";
    $roles_sent_successfuly        = "نقش ها با موفقیت به پیوی بازیکن ها ارسال گردید. اکنون میتوانید بازی را شروع کنید.";
    $all_should_ready              = "برای رفتن به مرحله بعد باید لیست تکمیل و همه اعلام حضور کرده باشند.";
    $who_would_you_deadlive        = "شماره بازیکنی که میخواهید وضعیت آن را تغییر دهید به انگلیسی وارد کنید:";
    $who_would_you_warning         = "شماره بازیکنی که میخواهید اخطار دهید را وارد کنید:";
    $dead_could_NOT_get_warning    = "شخص مرده نمیتواند اخطار دریافت کند";
    $deadlive_NOT_allowed          = "فقط گاد بازی می تواند وضعیت بازیکن ها را تغییر دهد.";
    $warning_NOT_allowed           = "فقط گاد بازی می تواند به بازیکن ها اخطار دهد.";
    $you_r_NOT_in_registered_list  = "شما در لیست ثبت نام کننده ها قرار ندارید.";
    $previous_NOT_allowed          = "فقط ادمین ها می توانند به مرحله قبل برگردند.";
    $drawing_NOT_allowed           = "فقط گاد بازی می تواند قرعه کشی کند.";    
    $next_step_NOT_allowed         = "فقط گاد بازی می تواند به مرحله بعد برود.";
    $all_players_should_go_to_bot  = "برای دریافت نقش، همه بازیکن ها باید وارد ربات شوید. برای اینکار روی لینک زیر کلیک کنید و دکمه start را بزنید. همچنین میتوانید یک پیام دلخواه به ربات بدهید:";
    $sending_roles_NOT_allowed     = "فقط گاد بازی می تواند نقش های قرعه کشی شده را ارسال کند.";
    $initial_drawed_roles          = "نقش ها قرعه کشی شد و به پیوی شما ارسال گردید، اگر لیست نقش ها مورد تایید شماست، با زدن دکمه «ارسال نقش»، نقش ها را برای بازیکن ها ارسال کنید. در غیر اینصورت دوباره قرعه کشی کنید.";
    $u_r_NOT_admin                 = "شما ادمین نیستید!";
    $Situation_0                   = "گاد در حال انتخاب لیست است.";
    $Situation_1                   = "گاد در حال ورود اطلاعات است.";
    $Situation_2                   = "بازیکن ها در حال ثبت نام هستند.";
    $Situation_3                   = "بازیکن ها در حال اعلام حضورند.";
    $Situation_4                   = "گاد در حال قرعه کشی است.";
    $Situation_5                   = "بازی در حال انجام است.";
    $Situation_6                   = "گاد در حال تعیین نتیجه است.";
    $Situation_city1               = "نتیجه بازی: برد شهروند";
    $Situation_city2               = "نتیجه: برد کلین شیت شهروند";
    $Situation_mafia1              = "نتیجه بازی: برد مافیا";
    $Situation_mafia2              = "نتیجه: برد کلین شیت مافیا";
    $who_would_you_justify         = "شماره بازیکنی که میخواهید به آن مجوز کارت حرکت آخر دهید را وارد کنید:";
    $welcome_please_wait           = "خوش آمدی عزیز!" . "\n" . "اگر در بازی ثبت نام کرده اید منتظر بمانید تا گاد بازی نقش شما را همین جا ارسال کند.";
    
    
    
    //کارت های حرکت آخر
    $cart1 = "مسیر سبز";
    $cart2 = "ذهن زیبا";
    $cart3 = "سرگیجه";
    $cart4 = "فرش قرمز";
    $cart5 = "شلیک نهایی";
    $cart6 = "بی خوابی";
    $cartlist = [$cart1, $cart2, $cart3, $cart4, $cart5, $cart6];
    
    //نقش ها و سناریو ها
    $Role1  = "دکتر";
    $Role2  = "کارآگاه";
    $Role3  = "تفنگدار";
    $Role4  = "تکاور";
    $Role5  = "نگهبان";
    $Role6  = "تک‌تیرانداز";
    $Role7  = "خبرنگار";
    $Role8  = "زره‌پوش";
    $Role9  = "شهرساده";
    $Role10 = "گادفادر";
    $Role11 = "ناتو";
    $Role12 = "گروگانگیر";
    $Role13 = "مذاکره‌کننده";
    $Role14 = "مافیاساده";
    $Role15 = "تروریست";
    $Role16 = "خرابکار";
    $Role17 = "جاسوس";
    $Role18 = "ناتاشا";
    $Role19 = "فراماسون";
    $Role20 = "تایلر";
    $Role21 = "روئین‌تن";
    $Role22 = "فرمانده";
    $Role23 = "کشیش";
    $Role24 = "قاضی";
    $Role25 = "جراح";
    $Role26 = "کابوی";
    $Role27 = "آهنگر";
    $Role28 = "محافظ";
    $Role29 = "شهردار";
    $Role30 = "حرفه‌ای";
    $Role31 = "جان‌سخت";
    $Role32 = "روانشناس";
    $Role33 = "دکتر لکتر";
    $Role34 = "لیدی وودو";
    $Role35 = "بمب‌ساز";
    $Role36 = "نخبه";
    $Role37 = "ساقی";
    $Role38 = "فدائی";
    $Role39 = "تِرَکِر";
    $Role40 = "بازجو";
    $Role41 = "دزد";
    $Role42 = "معشوقه";
    $Role43 = "بمب‌ساز";
    $Role44 = "شب‌خسب";
    $Role45 = "کلانتر";
    $Role46 = "جادوگر";
    $Role47 = "گورکن";
    $Role48 = "صبا";
    $Role49 = "دست‌کج";
    $Role50 = "هزارچهره";
    
    $rolelist1 = [$Role10, $Role13, $Role14, $Role1, $Role2, $Role6, $Role7, $Role8, $Role9, $Role9];
    $rolelist2 = [$Role10, $Role13, $Role14, $Role14, $Role1, $Role2, $Role6, $Role7, $Role8, $Role9, $Role9, $Role9];
    $rolelist3 = [$Role10, $Role11, $Role12, $Role1, $Role2, $Role4, $Role3, $Role5, $Role9, $Role9];
    $rolelist4 = [$Role10, $Role11, $Role15, $Role17, $Role1, $Role19, $Role6, $Role3, $Role39, $Role21, $Role9, $Role9];
    $rolelist5 = [$Role10, $Role18, $Role15, $Role1, $Role23, $Role6, $Role21, $Role9, $Role9, $Role9];
    $rolelist6 = [$Role10, $Role18, $Role15, $Role16, $Role1, $Role23, $Role6, $Role21, $Role3, $Role9, $Role9, $Role9];
    $rolelist7 = [$Role10, $Role18, $Role15, $Role16, $Role11, $Role1, $Role23, $Role6, $Role21, $Role3, $Role24, $Role37, $Role9, $Role9, $Role9];
    $rolelist8 = [$Role10, $Role33, $Role14, $Role14, $Role1, $Role2, $Role30, $Role32, $Role29, $Role31, $Role9, $Role9];
    $rolelist9 = [$Role10, $Role15, $Role17, $Role1, $Role19, $Role6, $Role21, $Role9, $Role9, $Role9];
    $rolelist10= [$Role10, $Role15, $Role17, $Role14, $Role1, $Role19, $Role6, $Role21, $Role9, $Role9, $Role9, $Role9];
    $rolelist11= [$Role10, $Role15, $Role17, $Role16, $Role18, $Role1, $Role19, $Role6, $Role21, $Role3, $Role24, $Role23, $Role9, $Role9, $Role9];
    $rolelist12= [$Role10, $Role15, $Role17, $Role16, $Role18, $Role11, $Role1, $Role19, $Role6, $Role21, $Role3, $Role24, $Role23, $Role22, $Role37, $Role9, $Role9, $Role9];
    $rolelist13= [$Role10, $Role15, $Role14, $Role1, $Role6, $Role21, $Role24, $Role9, $Role9, $Role9];
    $rolelist14= [$Role10, $Role15, $Role16, $Role11, $Role18, $Role1, $Role37, $Role6, $Role21, $Role3, $Role24, $Role23, $Role9, $Role9, $Role9];
    $rolelist15= [$Role10, $Role15, $Role16, $Role11, $Role14, $Role1, $Role40, $Role6, $Role3, $Role24, $Role21, $Role9, $Role9, $Role9, $Role9];
    $rolelist16= [$Role10, $Role15, $Role16, $Role11, $Role17, $Role41, $Role1, $Role19, $Role20, $Role6, $Role22, $Role3, $Role24, $Role21, $Role5, $Role37, $Role9, $Role9];
    $rolelist17= [$Role10, $Role42, $Role43, $Role44, $Role25, $Role1, $Role29, $Role45, $Role46, $Role38, $Role47, $Role48, $Role24, $Role49, $Role50];
    $rolelist18= [$Role10, $Role14, $Role1, $Role9, $Role9, $Role9, $Role9];


    $Rs       = ["R1", "R2", "R3", "R4", "R5", "R6", "R7", "R8", "R9", "R10", "R11", "R12", "R13", "R14", "R15", "R16", "R17", "R18", "R19", "R20", "R21"];
    
    //دکمه ها
    $keyboard_OK   = [[['text' => "OK"  ,  'callback_data' =>  "OK"]]];
    $keyboard_cleardata = [
                                [
                                    [ 'text' => "بله"  ,  'callback_data' =>   "clearyes"],
                                    [ 'text' => "خیر" ,  'callback_data' =>    "clearNo"]
                                ]
                           ];
    $keyboard_step0     = [
                        [
                            [ 'text' => "پرسپولیس",     'callback_data' =>  "list3"    ],
                            [ 'text' => "استقلال"  ,    'callback_data' =>   "list2"    ],
                            [ 'text' => "ذوب آهن"  ,  'callback_data' =>   "list1"    ]
                        ],
                        [
                            [ 'text' => "تولد",       'callback_data' =>  "list6"    ],
                            [ 'text' => "خروس",       'callback_data' =>  "list5"    ],
                            [ 'text' => "سپاهان",       'callback_data' =>  "list4"    ]
                        ],
                        [
                            [ 'text' => "مرحله بعد"  ,  'callback_data'   =>   "step0" ],
                        ]
                   ];
    $keyboard_NOP       = [
                        [
                            [ 'text' => "بله"  ,  'callback_data' =>   "NOPyes"],
                            [ 'text' => "خیر" ,  'callback_data' =>    "NOPNo"]
                        ]
                    ];
    $keyboard_scenario  = [
                            [
                                [ 'text' => "تِرَکِر12"  ,  'callback_data'   =>   "track12" ],
                                [ 'text' => "ناتویی10"  ,  'callback_data'   =>   "nato10" ],
                                [ 'text' => "مذاکره12"  ,  'callback_data'   =>   "moza12" ],
                                [ 'text' => "مذاکره10"  ,  'callback_data'   =>   "moza10" ]
                            ],
                            [
                                [ 'text' => "شب‌مافیا12" ,  'callback_data' =>   "night12"],
                                [ 'text' => "ناتاشا15"    ,  'callback_data' =>   "nata15"],
                                [ 'text' => "ناتاشا12"    ,  'callback_data' =>   "nata12"],
                                [ 'text' => "ناتاشا10"    ,  'callback_data' =>   "nata10"]
                            ],
                            [
                                [ 'text' => "ماسون18"    ,'callback_data'   =>  "mason18" ],
                                [ 'text' => "ماسون15"    ,'callback_data'   =>  "mason15" ],
                                [ 'text' => "ماسون12"    ,'callback_data'   =>  "mason12" ],
                                [ 'text' => "ماسون10"    ,'callback_data'   =>  "mason10" ]

                            ],
                            [
                                [ 'text' => "دزد18"    ,'callback_data'    =>   "dozd18"   ],
                                [ 'text' => "بازجو15"    ,'callback_data'   =>   "bazjo15"  ],
                                [ 'text' => "ساقی15"    ,'callback_data'   =>   "saghi15"  ],
                                [ 'text' => "قاضی10"    ,'callback_data'   =>  "ghazi10"  ]
                            ],
                            [
                                [ 'text' => "سایر سناریوها"    ,'callback_data'   =>  "otherSC" ],
                                [ 'text' => "دکتر7"         ,'callback_data'   =>  "doctor7"  ],
                                [ 'text' => "هزارچهره15"    ,'callback_data'   =>  "hezar15"  ]
                            ]
                        ];
    $keyboard_god       = [
                        [
                            [ 'text' => "خودم"  ,  'callback_data' =>   "godmyself"],
                            [ 'text' => "دیگری" ,  'callback_data' =>   "godanother"]
                        ]
                     ];
    $keyboard_step1     = [
                        [
                            [ 'text' => "تاریخ"  ,  'callback_data' =>   "date"    ],
                            [ 'text' => "ایونت"  ,  'callback_data' =>   "event"   ],
                            [ 'text' => "تعداد"  ,  'callback_data' =>   "NOP"   ]
                        ],
                        [
                            [ 'text' => "گاد"    ,  'callback_data' =>   "god"     ],
                            [ 'text' => "سناریو"  ,  'callback_data' =>   "scenario"],
                            [ 'text' => "ساعت"  ,  'callback_data' =>   "time"    ]
                        ],
                        [
                            [ 'text' => "مرحله بعد"  , 'callback_data'   =>  "step1" ],
                            [ 'text' => "نام گروه"   , 'callback_data'   =>   "group" ],
                            [ 'text' => "بازگشت"    , 'callback_data'   =>  "previous0" ]
                        ]
                   ];
    $keyboard_step2     = [
                        [
                            [ 'text' => "تغییر نام"         ,'callback_data'  =>  "changename"] ,
                            [ 'text' => "انصراف"          , 'callback_data' =>   "cancel"],
                            [ 'text' => "ثبت نام دیگران"      ,'callback_data' =>  "registeranother"] 
                        ],
                        [
                            [ 'text' => "مرحله بعد"    ,'callback_data'    =>  "step2"],
                            [ 'text' => "بازگشت"       ,'callback_data' =>   "previous1" ]
                        ]
                      ];
    $keyboard_register  = [
                        [
                            [ 'text' => "خودم"  ,  'callback_data' =>   "registermyself"],
                            [ 'text' => "دیگری" ,  'callback_data' =>   "registeranother"]
                        ]
                     ];
    $keyboard_cancel    = [
                        [
                            [ 'text' => "خودم"  ,  'callback_data' =>   "cancelmyself"],
                            [ 'text' => "دیگری" ,  'callback_data' =>   "cancelanother"]
                        ]
                     ];
    $keyboard_step3     = [
                        [
                            [ 'text' => "اعلام حضور"    ,'callback_data' =>   "ready"   ]
                        ],
                        [
                            [ 'text' => "مرحله بعد"    ,'callback_data'    =>  "step3"],
                            [ 'text' => "بازگشت"       ,'callback_data' =>   "previous2" ]
                        ]
                      ];
    $keyboard_step4     = [
                        [
                            [ 'text' => "ارسال نقش"      ,'callback_data' =>   "sendroles" ],
                            [ 'text' => "قرعه کشی"      ,'callback_data' =>   "drawing"   ], 
                            [ 'text' => "ورود به ربات"    ,'url'   =>  "t.me/$my_bot_username2"  ]
                            
                        ],
                        [
                            [ 'text' => "مرحله بعد"    ,'callback_data'    =>  "step4"],
                            [ 'text' => "بازگشت"       ,'callback_data' =>   "previous3"]
                        ]
                      ];
    $keyboard_step5     = [
                            [
                                [ 'text' => "وضعیت"  ,  'callback_data' =>   "deadlive"],
                                [ 'text' => "اخطار"   ,  'callback_data' =>   "warning"]
                            ],
                            [
                                [ 'text' => "اتمام بازی"   ,'callback_data' =>   "finish" ],
                                [ 'text' => "بازگشت"    ,'callback_data' =>   "previous4" ]
                            ]
                        ];
    $keyboard_step5_1   = [
                            [
                                [ 'text' => "اتمام"   ,'callback_data' =>   "finish"],
                                [ 'text' => "وضعیت"  ,  'callback_data' =>   "deadlive"],
                                [ 'text' => "اخطار"   ,  'callback_data' =>   "warning"],
                                [ 'text' => "بازگشت"    ,'callback_data' =>   "previous4"]
                            ],
                            [
                                ['text' => "کارت حرکت آخر"   ,'callback_data' =>   "finalcart"],
                                ['text' => "مجوز کارت"     ,'callback_data' => "justification"]

                            ]
                        ];
    $keyboard_step5_2   = [
                            [
                                [ 'text' => "اتمام"   ,'callback_data' =>   "finish"],
                                [ 'text' => "وضعیت"  ,  'callback_data' =>   "deadlive"],
                                [ 'text' => "اخطار"   ,  'callback_data' =>   "warning"],
                                [ 'text' => "بازگشت"    ,'callback_data' =>   "previous4"]
                            ],
                            [
                                ['text' => "5"   ,'callback_data' =>   "5"],
                                ['text' => "4"   ,'callback_data' =>   "4"],
                                ['text' => "3"   ,'callback_data' =>   "3"],
                                ['text' => "2"   ,'callback_data' =>   "2"],
                                ['text' => "1"   ,'callback_data' =>   "1"],
                            ],   
                            [   
                                ['text' => "10"  ,'callback_data' =>  "10"],
                                ['text' => "9"   ,'callback_data' =>   "9"],
                                ['text' => "8"   ,'callback_data' =>   "8"],
                                ['text' => "7"   ,'callback_data' =>   "7"],
                                ['text' => "6"   ,'callback_data' =>   "6"],
                            ]
                        ];
    $keyboard_step6     = [
                            [
                                [ 'text' => "برد مافیا"    ,  'callback_data' =>   "mafia1"],
                                [ 'text' => "برد شهروند"  ,  'callback_data' =>   "city1"]
                            ],
                            [
                                [ 'text' => "برد کلین شیت مافیا"     ,'callback_data' =>   "mafia2" ],
                                [ 'text' => "برد کلین شیت شهروند"   ,'callback_data' =>   "city2" ]
                            ],
                            [
                                [ 'text' => "بازگشت"   ,'callback_data' =>   "previous5" ]
                            ]
                        ];
    $keyboard_step7     = [
                            [
                                [ 'text' => "بست سه"    ,  'callback_data' =>   "best3" ],
                                [ 'text' => "بست دو"    ,   'callback_data' =>   "best2"],
                                [ 'text' => "بست یک"    ,  'callback_data' =>   "best1"]
                            ],
                            [
                                [ 'text' => "ارسال نقش ها"  ,'callback_data' =>   "sendroles2" ],
                                [ 'text' => "حذف بست"      ,'callback_data' =>   "removebest" ],
                                [ 'text' => "بازگشت"      ,'callback_data' =>   "previous6" ]
                            ]
                        ];
    $keyboard_step8     = [
                            [
                                [ 'text' => "خسته نباشی گاد عزیز"    ,  'callback_data' =>   "nakhaste" ]
                            ]
                        ];
    $keyboard_chalenge  = [
                                [
                                    [ 'text' => "نمیدم"    ,  'callback_data' => "nemidam" ],
                                    [ 'text' => "چـــالـــش"    ,  'callback_data' => "chalenge" ]
                                ]
                          ];
    $keyboard_like      = [
                                [
                                    [ 'text' => "👍"    ,  'callback_data' => "like"    ],
                                    [ 'text' => "👎"    ,  'callback_data' => "dislike" ],
                                    [ 'text' => "👍👎"  ,  'callback_data' => "abstain" ]
                                ]
                          ];

    
    // خواندن اطلاعات ورودی و دستور به اجرای توابع اصلی
    if(isset($update_array["callback_query"])){
        $data              = $update_array["callback_query"]["data"];
        $callback_query_id = $update_array["callback_query"]["id"];
        $user_id           = $update_array["callback_query"]["from"]["id"];
        $username          = $update_array["callback_query"]["from"]["username"];
        $first_name        = $update_array["callback_query"]["from"]["first_name"];
        $last_name         = $update_array["callback_query"]["from"]["last_name"];
        $chat_id           = $update_array["callback_query"]["message"]["chat"]["id"];
        $msg_id            = $update_array["callback_query"]["message"]["message_id"];
        $reply             = $update_array["callback_query"]["message"]["text"];
        $userprofile       = array($user_id, $username, $first_name, $last_name);
        detect_callback_received_and_reply();
    }  
    else if(isset($update_array["message"])){
        $text              = $update_array["message"]["text"];
        $chat_id           = $update_array["message"]["chat"]["id"];
        $msg_id_text       = $update_array["message"]["message_id"];
        $user_id           = $update_array["message"]["from"]["id"];
        $username          = $update_array["message"]["from"]["username"];
        $first_name        = $update_array["message"]["from"]["first_name"];
        $last_name         = $update_array["message"]["from"]["last_name"];
        $userprofile       = array($user_id, $username, $first_name, $last_name);
        $ch                = substr($text, 0, 1);

        if(isset($update_array["message"]["reply_to_message"])) {
            $text_replied      = $update_array["message"]["reply_to_message"]["text"];
            $msg_id_replied    = $update_array["message"]["reply_to_message"]["message_id"];
            $bot_id            = $update_array["message"]["reply_to_message"]["from"]["id"];
            if($ch == '/'){Select_command();}
            else {detect_text_received_and_reply();}
        }
        else if($ch == '/'){Select_command();}
    }

    //-------------------------------------------
    
    function Select_command(){
        $text           =  $GLOBALS['text'];         
        $text_replied   =  $GLOBALS['text_replied'];
        $msg_id_replied =  $GLOBALS['msg_id_replied'];
        $msg_id_text    =  $GLOBALS['msg_id_text'];
        $chat_id        =  $GLOBALS['chat_id'];
        $user_id        =  $GLOBALS['user_id'];
        $username       =  $GLOBALS['username'];
        $first_name     =  $GLOBALS['first_name'];
        $last_name      =  $GLOBALS['last_name'];
        $userprofile    =  $GLOBALS['userprofile'];
        $bot_id         =  $GLOBALS['bot_id'];
        $number         =  intval(substr($text,1,1));
        if     ($number == 0){$number  =  intval(substr($text,2,1));}
        else if($number != 0){$number  =  intval(substr($text,1,2));}
        $GameInfos = read_database("GameInfo");
        switch($text){
            case "/startt"   : remove_data(); break;
            
            case "/start"    : welcome_to_bot(); break;

            case ((strpos($text, $GLOBALS['my_bot_username']) == true or $msg_id_replied == $GameInfos[2]) and is_numeric($number) == true and strpos($text, "best1") == false and strpos($text, "best2") == false and strpos($text, "best3") == false and strpos($text, "RemoveBest") == false and strpos($text, "chalenge") == false):{
                
                //حذف دستور شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                
                if (is_god($user_id) == true){exit();}
                
                //خواندن اطلاعات بازی
                $GameInfos = read_database("GameInfo");

                //چک کردن اینکه آیا شماره در رنج مناسب هست یا خیر
                if ($number < 1 or $number > $GameInfos[3]){exit();}
                
                //چک کردن اینکه شماره بازیکن قبلا انتخاب نشده باشد
                $connection = connect_to_db();
                $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id AND Number = $number");
                while($row = $result -> fetch_assoc()) { 
                    $No          = $row['No'];
                    $user_id2    = $row['UserID'];
                    $persianname = $row['PersianName'];
                    if (empty($persianname) == false){exit();}
                    else if (empty($persianname) == true){
                        sleep(2);
                        $persianname = $row['PersianName'];
                        if (empty($persianname) == false){exit();}
                        else if (empty($persianname) == true){
                            $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND No = $No");
                        }
                    }
                }
                
                //چک کردن اینکه آیا قبلا ثبت نام انجام شده است یا خیر
                $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id AND UserID = $user_id");
                while($row = $result -> fetch_assoc()) {
                    $No          =  $row['No'];
                    $persianname = $row['PersianName'];
                    if (empty($persianname) == false){exit();}
                    else{$connection -> query("DELETE FROM User WHERE No = $No");} 
                }
                
                //نوشتن اطلاعات شخصی که روی دکمه ثبت نام کلیک کرده است در دیتابیس
                $connection -> query("INSERT INTO User (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection -> query("UPDATE User SET UserID    =  $user_id      WHERE No = $No");
                $connection -> query("UPDATE User SET Username  = '$username'    WHERE No = $No");
                $connection -> query("UPDATE User SET Firstname = '$first_name'  WHERE No = $No");
                $connection -> query("UPDATE User SET Lastname  = '$last_name'   WHERE No = $No");
                $connection -> query("UPDATE User SET Number    =  $number       WHERE No = $No");

                //نوشتن اسم فارسی فرد از پلیر نیم در یوزر
                $playername =  mysqli_fetch_array($connection -> query("SELECT * FROM PlayerNames WHERE UserID = $user_id"));
                if (empty($playername[2]) == false){
                    $connection -> query("UPDATE User SET PersianName = '$playername[2]' WHERE ChatID = $chat_id AND UserID = $user_id");
            
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
                    
                    //دکمه های بازی
                    if      ($GameInfos[11] == 0){$keyboard = $GLOBALS['keyboard_step0'];}
                    else if ($GameInfos[11] == 1){$keyboard = $GLOBALS['keyboard_step1'];}
                    else if ($GameInfos[11] == 2){$keyboard = $GLOBALS['keyboard_step2'];}
                    else if ($GameInfos[11] == 3){$keyboard = $GLOBALS['keyboard_step3'];}
                    else if ($GameInfos[11] == 4){$keyboard = $GLOBALS['keyboard_step4'];}
                    else if ($GameInfos[11] == 5){$keyboard = $GLOBALS['keyboard_step5'];}
                    $inline_kb_options = ['inline_keyboard' => $keyboard];
                    $json_kb = json_encode($inline_kb_options);
                    
                    $setlines = set_lines($GameInfos);
                    $Lines    = $setlines[0];
                    $Last_Line= $setlines[1];
                    $Lines = write_info($GameInfos, $Lines, $Last_Line);
                    $Lines = rewrite_players($Lines, 1);
        
                    $reply       =  implode("" , $Lines);
                    $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                    $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                    $result      =  send_reply($url, $post_params);
                }
                
                //ارسال درخواست وارد کردن نام فارسی
                else if (empty($playername[2]) == true){
                    
                    $url            = $GLOBALS['bot_url'];
                    $textmessage    = $GLOBALS['enter_your_name'];
                    $markup_options = ['force_reply' => true ,  'selective' => true];
                    $parsemodes     = "HTML";
                    $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                    $result_array   = json_decode($result, true);
                }
                $connection -> close();  
                remove_notifications();
                
            }; break;

            case (strpos($text, $GLOBALS['my_bot_username']) == true and is_numeric($number) == true and is_god($user_id) == true and strpos($text, "best1") == true ):{

                //حذف دستور شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);

                //خواندن اطلاعات بازی
                $GameInfos = read_database("GameInfo");
                
                //چک کردن اینکه آیا شماره در رنج مناسب هست یا خیر
                if ($number < 1 or $number > $GameInfos[3]){exit();}

                //نوشتن واژه بست یک در یوزر
                $connection = connect_to_db();
                $connection -> query("UPDATE User SET Best = 'best1' WHERE ChatID = $chat_id AND Number = $number");
                $connection -> close();
                
                //دکمه های بازی
                $keyboard          = $GLOBALS['keyboard_step7'];
                $inline_kb_options = ['inline_keyboard' => $keyboard];
                $json_kb           = json_encode($inline_kb_options);
        
                //بازنویسی لیست بازی
                $GameInfos = read_database("GameInfo");
                $setlines = set_lines($GameInfos);
                $Lines    = $setlines[0];
                $Last_Line= $setlines[1];
                $Lines = write_info($GameInfos, $Lines, $Last_Line);
                $Lines = rewrite_players($Lines, 4);
    
                $reply       =  implode("" , $Lines);
                $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                $result      =  send_reply($url, $post_params);
                
            } break;

            case (strpos($text, $GLOBALS['my_bot_username']) == true and is_numeric($number) == true and is_god($user_id) == true and strpos($text, "best2") == true ):{
                
                //حذف دستور شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                
                //خواندن اطلاعات بازی
                $GameInfos = read_database("GameInfo");

                //چک کردن اینکه آیا شماره در رنج مناسب هست یا خیر
                if ($number < 1 or $number > $GameInfos[3]){exit();}

                //نوشتن واژه بست یک در یوزر
                $connection = connect_to_db();
                $connection -> query("UPDATE User SET Best = 'best2' WHERE ChatID = $chat_id AND Number = $number");
                $connection -> close();
                
                //دکمه های بازی
                $keyboard          = $GLOBALS['keyboard_step7'];
                $inline_kb_options = ['inline_keyboard' => $keyboard];
                $json_kb           = json_encode($inline_kb_options);
        
                //بازنویسی لیست بازی
                $GameInfos = read_database("GameInfo");
                $setlines = set_lines($GameInfos);
                $Lines    = $setlines[0];
                $Last_Line= $setlines[1];
                $Lines = write_info($GameInfos, $Lines, $Last_Line);
                $Lines = rewrite_players($Lines, 5);
    
                $reply       =  implode("" , $Lines);
                $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                $result      =  send_reply($url, $post_params);
                
            } break;

            case (strpos($text, $GLOBALS['my_bot_username']) == true and is_numeric($number) == true and is_god($user_id) == true and strpos($text, "best3") == true ):{
                
                //حذف دستور شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                
                //خواندن اطلاعات بازی
                $GameInfos = read_database("GameInfo");

                //چک کردن اینکه آیا شماره در رنج مناسب هست یا خیر
                if ($number < 1 or $number > $GameInfos[3]){exit();}

                //نوشتن واژه بست یک در یوزر
                $connection = connect_to_db();
                $connection -> query("UPDATE User SET Best = 'best3' WHERE ChatID = $chat_id AND Number = $number");
                $connection -> close();
                
                //دکمه های بازی
                $keyboard          = $GLOBALS['keyboard_step7'];
                $inline_kb_options = ['inline_keyboard' => $keyboard];
                $json_kb           = json_encode($inline_kb_options);
        
                //بازنویسی لیست بازی
                $GameInfos = read_database("GameInfo");
                $setlines = set_lines($GameInfos);
                $Lines    = $setlines[0];
                $Last_Line= $setlines[1];
                $Lines = write_info($GameInfos, $Lines, $Last_Line);
                $Lines = rewrite_players($Lines, 6);
    
                $reply       =  implode("" , $Lines);
                $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                $result      =  send_reply($url, $post_params);
                
            } break;
        
            case (strpos($text, $GLOBALS['my_bot_username']) == true and is_numeric($number) == true and is_god($user_id) == true and strpos($text, "RemoveBest") == true ):{
                
                //حذف دستور شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                
                //خواندن اطلاعات بازی
                $GameInfos = read_database("GameInfo");

                //چک کردن اینکه آیا شماره در رنج مناسب هست یا خیر
                if ($number < 1 or $number > $GameInfos[3]){exit();}

                //نوشتن واژه بست یک در یوزر
                $connection = connect_to_db();
                $connection -> query("UPDATE User SET Best = '' WHERE ChatID = $chat_id AND Number = $number");
                $connection -> close();
                
                //دکمه های بازی
                $keyboard          = $GLOBALS['keyboard_step7'];
                $inline_kb_options = ['inline_keyboard' => $keyboard];
                $json_kb           = json_encode($inline_kb_options);
        
                //بازنویسی لیست بازی
                $GameInfos = read_database("GameInfo");
                $setlines = set_lines($GameInfos);
                $Lines    = $setlines[0];
                $Last_Line= $setlines[1];
                $Lines = write_info($GameInfos, $Lines, $Last_Line);
                $Lines = rewrite_players($Lines, 7);
    
                $reply       =  implode("" , $Lines);
                $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                $result      =  send_reply($url, $post_params);
                
            } break;
            
            case (strpos($text, $GLOBALS['my_bot_username']) == true and is_numeric($number) == true and strpos($text, "chalenge") == true ):{

                //حذف دستور چالش
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                
                //خواندن نام و آیدی عددی چالش گیرنده
                $connection = connect_to_db();
                $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
                while($row = $result  -> fetch_assoc()) {
                    $number2      = $row['Number'];
                    if ($number2 == $number){            
                        $chalname = $row['PersianName'];
                        $chal_id  = $row['UserID'];
                    }
                }
                
                //خواندن مسیج آیدی از یوزر 3
                $connection = connect_to_db();
                $result = $connection -> query("SELECT * FROM User3 WHERE ChatID = $chat_id AND UserID = $user_id AND Thanks = 'chal'");
                while($row = $result  -> fetch_assoc()) {
                    $msg_id      = $row['MessageID'];
                }
                    
                //دکمه های بازی
                $keyboard          = $GLOBALS['keyboard_like'];
                $inline_kb_options = ['inline_keyboard' => $keyboard];
                $json_kb           = json_encode($inline_kb_options);
                
                //ادیت پیام چالش به پیام لایک
                $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id AND UserID = $user_id");
                while($row = $result  -> fetch_assoc()) {
                    $number2      = $row['Number'];
                    $turn         = $row['Turn'];
                    $persianname = $row['PersianName'];
                    if ($turn == "yes"){
                        
                        $persianname = "<a href='tg://user?id=$user_id'>$persianname</a>";
                        $reply = "صبحت شماره " . $number2 . ": " . $persianname . "\n";
                        $reply.= "👍"   . " /Like"    . $number2 . " : " . "\n";
                        $reply.= "👎"   . " /DisLike" . $number2 . " : " . "\n";
                        $reply.= "👍👎" . " /abstain" . $number2 . " : " . "\n";
                        
                        $chalname = "<a href='tg://user?id=$chal_id'>$chalname</a>";
                        $reply.= "چالش برای شماره " . $number . ": " . $chalname . "\n";
                        $reply.= "👍"   . " /Like"    . $number . " : " . "\n";
                        $reply.= "👎"   . " /DisLike" . $number . " : " . "\n";
                        $reply.= "👍👎" . " /abstain" . $number . " : " . "\n";
                        
                        $url          = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params  = [ 'chat_id' => $chat_id , 'text' => $reply,'message_id' => $msg_id, 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result2      = send_reply($url, $post_params);
                        $result_array = json_decode($result2, true);
                    }
                }
            } break;
        }
    }

    //-------------------------------------
    
    function welcome_to_bot(){
        
        //ارسال پیام خوشامدگویی
        $url            = $GLOBALS['bot_url'];
        $userprofile    = $GLOBALS['userprofile'];
        $chat_id        = $GLOBALS['chat_id'];
        $textmessage    = $GLOBALS['welcome_please_wait'];
        $parsemodes     = "HTML";
        $result         = send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
        $result_array   = json_decode($result, true);
        exit();
    }
    
    //-------------------------------------
    
    function remove_data(){
        
        if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
            
            //ارسال پیغام اینکه آیا برای حذف اطلاعات قبلی مطمئن هستید
            $url            = $GLOBALS['bot_url'];
            $userprofile    = $GLOBALS['userprofile'];
            $chat_id        = $GLOBALS['chat_id'];
            $textmessage    = $GLOBALS['r_u_sure_to_clear_data'];
            $markup_options = ['inline_keyboard' => $GLOBALS['keyboard_cleardata']];
            $parsemodes     = "HTML";
            $result         = send_message_adv($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
            $result_array   = json_decode($result, true);
            exit();
        }
        else {
            
            // ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند لیست بازی را باز کنند
            $url             = $GLOBALS['bot_url'];
            $userprofile     = $GLOBALS['userprofile'];
            $chat_id         = $GLOBALS['chat_id'];
            $textmessage     = $GLOBALS['opening_list_NOT_allowded'];
            $keyboard        = $GLOBALS['keyboard_OK'];
            $markup_options  = ['inline_keyboard' => $keyboard];
            $parsemodes      = "HTML";
            $result          = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
            exit();
        }        
    }
    
    //-------------------------------------
    
    function detect_callback_received_and_reply(){
        
        $callback_data     =  $GLOBALS['data'];
        $callback_query_id =  $GLOBALS['callback_query_id'];
        $data              =  $GLOBALS['data'];
        $user_id           =  $GLOBALS['user_id'];
        $username          =  $GLOBALS['username'];
        $first_name        =  $GLOBALS['first_name'];
        $last_name         =  $GLOBALS['last_name'];
        $userprofile       =  $GLOBALS['userprofile'];
        $chat_id           =  $GLOBALS['chat_id'];
        $msg_id            =  $GLOBALS['msg_id'];
        $reply             =  $GLOBALS['reply']; 
        $url               =  $GLOBALS['bot_url'];
        
        $BB     = strpos($reply, $username);
        $CC     = strpos($reply, $first_name  .  " "  .  $last_name);
        $admin  = is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']);
        if (is_numeric($callback_data) == false){
            
            switch($callback_data){
                
                //مرحله صفر
                case "OK"             :{
                    
                    //بسته شدن پیغام
                    $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                    $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                    $result      = send_reply($url, $post_params);
                    
                } break;
    
                case "clearyes"       :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                        
                        //حذف اطلاعات بازی های قبلی از دیتابیس
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM GameInfo WHERE ChatID = $chat_id");
                        $connection -> query("DELETE FROM User     WHERE ChatID = $chat_id");
                        $connection -> query("DELETE FROM RoleList WHERE ChatID = $chat_id");
                        $connection -> query("DELETE FROM CartList WHERE ChatID = $chat_id");
                        $connection -> query("DELETE FROM Another  WHERE ChatID = $chat_id");
                        $connection -> query("DELETE FROM User3    WHERE ChatID = $chat_id");
                        $connection -> close();
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //خواندن نام گروه از گروپ نیم
                        $connection =  connect_to_db();
                        $groupname =  mysqli_fetch_array($connection -> query("SELECT * FROM GroupNames WHERE ChatID = $chat_id"));
                        $connection -> close();
    
                        //بازنویسی لیست بازی
                        $Situation_0 = $GLOBALS['Situation_0'];
                        $GameInfos = ["", "", "", 10, "", "", "", "", "", "", $groupname[2], "", "", 1, $Situation_0];               
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines[0]            = "💚#ایونت_" . $GameInfos[4] . " " . $GameInfos[10] ."💚" . "\n";
                        $Lines[$Last_Line]   = "💚#ایونت_" . $GameInfos[4] . " " . $GameInfos[10] ."💚" . "\n";
                        $Lines[$Last_Line-3] = "          " . $GameInfos[14] . "\n";
                        
                        //بازکردن لیست خام بازی
                        $reply  = implode("" , $Lines);
                        $url = $GLOBALS['bot_url'] . "/sendMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'reply_markup' => $json_kb ];
                        $result = send_reply($url, $post_params);
                        $result_array = json_decode($result, true);
                        
                        //نوشتن اطلاعات اولیه در گیم اینفو
                        $msg_id     = $result_array["result"]["message_id"];
                        $connection =  connect_to_db();
                        $connection -> query("INSERT INTO GameInfo (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection -> query("UPDATE GameInfo SET MessageID  =  $msg_id         WHERE No = $No");
                        $connection -> query("UPDATE GameInfo SET NOP        =  10              WHERE No = $No");
                        $connection -> query("UPDATE GameInfo SET Final      =  0               WHERE No = $No");
                        $connection -> query("UPDATE GameInfo SET List       =  1               WHERE No = $No");
                        $connection -> query("UPDATE GameInfo SET GroupName  = '$groupname[2]'  WHERE No = $No");
                        $connection -> query("UPDATE GameInfo SET Step       = '$Situation_0'   WHERE No = $No");
                        
                        //نوشتن چت آیدی و مسیج آیدی در رول لیست
                        $connection  -> query("INSERT INTO RoleList (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection  -> query("UPDATE RoleList SET MessageID  = $msg_id   WHERE No = $No");

                        //نوشتن چت آیدی و سایر کارت های حرکت آخر در کارت لیست
                        $cartlist = $GLOBALS['cartlist'];
                        $connection  -> query("INSERT INTO CartList (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection  -> query("UPDATE CartList SET C1  = '$cartlist[0]'   WHERE No = $No");
                        $connection  -> query("UPDATE CartList SET C2  = '$cartlist[1]'   WHERE No = $No");
                        $connection  -> query("UPDATE CartList SET C3  = '$cartlist[2]'   WHERE No = $No");
                        $connection  -> query("UPDATE CartList SET C4  = '$cartlist[3]'   WHERE No = $No");
                        $connection  -> query("UPDATE CartList SET C5  = '$cartlist[4]'   WHERE No = $No");
                        $connection  -> query("UPDATE CartList SET C6  = '$cartlist[5]'   WHERE No = $No");
                        $connection -> close();

                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند لیست قبلی را پاکسازی کنند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['clearing_data_NOT_allowded'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                    
                } break;
                
                case "clearNo"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند لیست قبلی را پاکسازی کنند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['you_r_NOT_admin'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                    
                } break;
                
                case "list1"          :{
    
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "List", 1, 1);
                        $GameInfos= read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "list2"          :{
                    
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "List", 2, 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
    
                } break;
                
                case "list3"          :{
                    
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "List", 3, 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
                
                } break;
                
                case "list4"          :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "List", 4, 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
                
                } break;
                
                case "list5"          :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "List", 5, 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
                
                } break;
                
                case "list6"          :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "List", 6, 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
                
                } break;
    
                case "step0"          :{
                    
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 1, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_1'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
            
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                        remove_notifications();
                    }
                    
                } break;
                
                //مرحله یک
                case "NOP"            :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //خواندن سناریوی بازی از دیتابیس
                        $connection =  connect_to_db();
                        $result = $connection -> query("SELECT * FROM GameInfo");
                        while($row = $result -> fetch_assoc()) {
                            $chat_id2 = $row['ChatID'];
                            if ($chat_id2 == $chat_id){
                                $scenario = $row['Scenario'];
                            }
                        }
                        if($scenario == "ناتویی 12 نفره" or $scenario == "مذاکره 12 نفره" or $scenario =="ناتویی 10 نفره" or $scenario == "مذاکره 10 نفره"){
                            
                            //ارسال پیغام مبنی براینکه سناریوی انتخابی اجازه تغییر تعداد بازیکن را نمی دهد
                            $url = $GLOBALS['bot_url'];
                            $reply       = $GLOBALS['scenario_NOT_allows_change_NOP'];
                            $result = alert_user ($url, $reply, $callback_query_id);
                            exit();
                        }
                        else{
                            //ارسال پیغام مبنی براینکه کاهش تعداد بازیکن ها باعث حذف افراد انتهایی می شود
                            $url             = $GLOBALS['bot_url'];
                            $userprofile     = $GLOBALS['userprofile'];
                            $chat_id         = $GLOBALS['chat_id'];
                            $textmessage     = $GLOBALS['entering_lower_NOP'];
                            $keyboard        = $GLOBALS['keyboard_NOP'];
                            $markup_options  = ['inline_keyboard' => $keyboard];
                            $parsemodes      = "HTML";
                            $result          = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                            
                            remove_notifications();
                            exit();
                        }
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند تعداد بازیکن ها را وارد کنند
                        $reply  = $GLOBALS['entering_NOP_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
                
                case "NOPyes"         :{
    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                        
                        //درخواست وارد کردن تعداد بازیکن ها
                        $url            = $GLOBALS['bot_url'];
                        $userprofile    = $GLOBALS['userprofile'];
                        $chat_id        = $GLOBALS['chat_id'];
                        $textmessage    = $GLOBALS['number_of_players'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        $result_array   = json_decode($result, true);
                    }
                } break;
                
                case "NOPNo"          :{
    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "event"          :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیغام مبنی بر وارد کردن شماره ایونت
                        $textmessage    = $GLOBALS['enter_event_number'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        remove_notifications();
                        exit();
                    }
                    else {
                        $reply  = $GLOBALS['entering_event_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
                
                case "date"           :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
    
                        //ارسال پیغام مبنی بر وارد کردن تاریخ شروع ایونت
                        $textmessage    = $GLOBALS['enter_date'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        remove_notifications();
                        exit();
                    }
                    else {
                        $reply       = $GLOBALS['entering_date_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
                
                case "time"           :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیغام مبنی بر وارد کردن ساعت شروع ایونت
                        $textmessage    = $GLOBALS['enter_time'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        remove_notifications();
                        exit();
                    }
                    else {
                        $reply       = $GLOBALS['entering_time_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
    
                case "scenario"       :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیغام مبنی بر وارد کردن سناریوی بازی
                        $textmessage    = $GLOBALS['choose_scenario'];
                        $keyboard        = $GLOBALS['keyboard_scenario'];
                        $markup_options  = ['inline_keyboard' => $keyboard];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        remove_notifications();
                        exit();
                    }
                    else {
                        $reply       = $GLOBALS['entering_scenario_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
                
                //سناریوها
                case "moza10"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 10;
                        $MN  = 3;
                        $SCN = "مذاکره 10 نفره";
                        $rolelist = $GLOBALS['rolelist1'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "moza12"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 12;
                        $MN  = 4;
                        $SCN = "مذاکره 12 نفره";
                        $rolelist = $GLOBALS['rolelist2'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }

                } break;
                
                case "nato10"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){

                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 10;
                        $MN  = 3;
                        $SCN = "ناتویی 10 نفره";
                        $rolelist = $GLOBALS['rolelist3'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }

                } break;
                
                case "track12"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 12;
                        $MN  = 4;
                        $SCN = "تِرَکِر 12 نفره";
                        $rolelist = $GLOBALS['rolelist4'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }

                } break;
                
                case "nata10"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                       
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 10;
                        $MN  = 3;
                        $SCN = "ناتاشا 10 نفره";
                        $rolelist = $GLOBALS['rolelist5'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "nata12"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                       
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 12;
                        $MN  = 4;
                        $SCN = "ناتاشا 12 نفره";
                        $rolelist = $GLOBALS['rolelist6'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "nata15"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                       
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 15;
                        $MN  = 5;
                        $SCN = "ناتاشا 15 نفره";
                        $rolelist = $GLOBALS['rolelist7'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "night12"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                       
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 12;
                        $MN  = 4;
                        $SCN = "شب‌مافیا 12 نفره";
                        $rolelist = $GLOBALS['rolelist8'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);  
                    }
                } break;
                
                case "mason10"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 10;
                        $MN  = 3;
                        $SCN = "فراماسون 10 نفره";
                        $rolelist = $GLOBALS['rolelist9'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "mason12"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 12;
                        $MN  = 4;
                        $SCN = "فراماسون 12 نفره";
                        $rolelist = $GLOBALS['rolelist10'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "mason15"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 15;
                        $MN  = 5;
                        $SCN = "فراماسون 15 نفره";
                        $rolelist = $GLOBALS['rolelist11'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "mason18"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 18;
                        $MN  = 6;
                        $SCN = "فراماسون 18 نفره";
                        $rolelist = $GLOBALS['rolelist12'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
 
                case "ghazi10"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 10;
                        $MN  = 3;
                        $SCN = "قاضی 10 نفره";
                        $rolelist = $GLOBALS['rolelist13'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "saghi15"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 15;
                        $MN  = 5;
                        $SCN = "ساقی 15 نفره";
                        $rolelist = $GLOBALS['rolelist14'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "bazjo15"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 15;
                        $MN  = 5;
                        $SCN = "بازجو 15 نفره";
                        $rolelist = $GLOBALS['rolelist15'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "dozd18"         :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 18;
                        $MN  = 6;
                        $SCN = "دزد و نگهبان 18 نفره";
                        $rolelist = $GLOBALS['rolelist16'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
                
                case "hezar15"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 15;
                        $MN  = 5;
                        $SCN = "هزارچهره 15 نفره";
                        $rolelist = $GLOBALS['rolelist17'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;

                case "doctor7"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                       
                        //دکمه های بازی
                        $keyboard_step1 = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //اطلاعات سناریو
                        $TN  = 7;
                        $MN  = 2;
                        $SCN = "دکتر 7 نفره";
                        $rolelist = $GLOBALS['rolelist18'];
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Scenario", $SCN, 1);
                        update_database("GameInfo", "NOP", $TN, 1);
                        $GameInfos = read_database("GameInfo");
                        $connection  =  connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number > $GameInfos[3]");
                        $connection  -> close();            
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش های سناریوی مربوطه در گروه
                        $lengRL    = count($rolelist) - 1;
                        $textmessage = "سناریوی " ."<b>$SCN</b>" . ":" . "\n" . "\n";
                        $textmessage .= "🩸گروه مافیاها🩸" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){
                                if ($i == $MN){
                                    $textmessage .= "\n";
                                    $textmessage .= "💧گروه شهروندها💧" . "\n" . "\n";
                                    $textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";
                                }
                                else{$textmessage .= $i+1 . "- " . $rolelist[$i] . "\n";}
                            }
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
                    }
                } break;
    
                case "otherSC"        :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //بسته شدن پیغام لیست سناریوها
                        $url         = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال پیغام مبنی بر وارد کردن سناریوی بازی
                        $url         = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['enter_scenario'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        exit();
                    }
                } break;
    
                //ادامه مرحله یک
                case "god"            :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیغام مبنی براینکه گاد خودتان هستید یا دیگری
                        $keyboard_god   = $GLOBALS['keyboard_god'];
                        $markup_options = ['inline_keyboard' => $keyboard_god];
                        $textmessage    = $GLOBALS['enter_who_is_god'];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        
                        remove_notifications();
                        exit();
                    }
                    else {
                        $reply       = $GLOBALS['entering_god_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
                
                case "godmyself"      :{
    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //حذف پیام مبنی بر اینکه گاد خودتان هستید یا دیگری
                        $url = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id ];
                        send_reply($url, $post_params);
                        
                        update_database("GameInfo", "GodID", $user_id, 1);
                        $connection =  connect_to_db();
                        $playername =  mysqli_fetch_array($connection -> query("SELECT * FROM PlayerNames WHERE UserID = $user_id"));
    
                        //نوشتن اسم فارسی فرد از پلیر نیم در یوزر
                        if (empty($playername[2]) == false){
                            $connection -> query("UPDATE User SET PersianName = '$playername[2]' WHERE ChatID = $chat_id AND UserID = $user_id");
                    
                            //آپدیت و خواندن اطلاعات بازی
                            update_database("GameInfo", "God", $playername[2], 1);
                            $GameInfos = read_database("GameInfo");
                            
                            //دکمه های بازی
                            if      ($GameInfos[11] == 0){
                                $keyboard = $GLOBALS['keyboard_step0'];
                            }
                            else if ($GameInfos[11] == 1){
                                $keyboard = $GLOBALS['keyboard_step1'];
                            }
                            else if ($GameInfos[11] == 2){
                                $keyboard = $GLOBALS['keyboard_step2'];
                            }
                            else if ($GameInfos[11] == 3){
                                $keyboard = $GLOBALS['keyboard_step3'];
                            }
                            else if ($GameInfos[11] == 4){
                                $keyboard = $GLOBALS['keyboard_step4'];
                            }
                            else if ($GameInfos[11] == 5){
                                $keyboard = $GLOBALS['keyboard_step5'];
                            }
                            $inline_kb_options = ['inline_keyboard' => $keyboard];
                            $json_kb = json_encode($inline_kb_options);
                            
                            $setlines = set_lines($GameInfos);
                            $Lines    = $setlines[0];
                            $Last_Line= $setlines[1];
                            $Lines = write_info($GameInfos, $Lines, $Last_Line);
                            $Lines = rewrite_players($Lines, 1);
                
                            $reply       =  implode("" , $Lines);
                            $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                            $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                            $result      =  send_reply($url, $post_params);
                        }
                        
                        //ارسال درخواست وارد کردن نام فارسی
                        else if (empty($playername[2]) == true){
                            
                            $url            = $GLOBALS['bot_url'];
                            $textmessage    = $GLOBALS['enter_god_you'];
                            $markup_options = ['force_reply' => true ,  'selective' => true];
                            $parsemodes     = "HTML";
                            $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                            $result_array   = json_decode($result, true);
                        }
                        $connection -> close();  
                        remove_notifications();
                    }
                } break;
    
                case "godanother"     :{
    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //حذف پیام قبلی مبنی بر اینکه گاد خودتان هستید یا دیگری
                        $url = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id ];
                        send_reply($url, $post_params);
                        
                        //ارسال پیام مبنی براینکه آیدی شخصی که میخواهید گاد باشد را وارد کنید
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['enter_god_another_id'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        exit(); 
                    }
                } break;
                
                case "group"          :{
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیغام مبنی بر وارد کردن نام گروه
                        $textmessage    = $GLOBALS['enter_group'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        
                        remove_notifications();
                        exit();
                    }
                    else {
                        $reply       = $GLOBALS['entering_group_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                } break;
    
                case "previous0"      :{
                    
                    if ($admin == true){
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step0'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 0, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_0'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند به مرحله قبل بروند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
    
                } break;
                
                case "step1"          :{
                    
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
    
                    if (
                        empty($GameInfos[3])  == false and
                        intval($GameInfos[4]) > 0 and
                        empty($GameInfos[5])  == false and
                        empty($GameInfos[6])  == false and
                        empty($GameInfos[7])  == false and
                        empty($GameInfos[8])  == false and
                        empty($GameInfos[9])  == false and
                        empty($GameInfos[10]) == false and
                        is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true
                       )
                    {
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step2'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 2, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_2'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
            
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                        remove_notifications();
    
                    }
                    else if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
    
                        //ارسال پیام مبنی براینکه باید شرایط نهایی کردن برقرار باشد
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['finalization_conditions'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();
                    }
                    else {
                        
                        //ارسال پیام مبنی براینکه فقط ادمین ها میتوانند به مرحله بعد بروند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['finalization_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
                
                //مرحله دو
                case "registeranother":{
                    
                    if ($admin == true){
                        
                        //ارسال پیام مبنی براینکه آیدی شخصی که میخواهید ثبت نام کنید را وارد کنید
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['enter_player_another_id'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        remove_notifications();
                        exit(); 
                    }
                    else {
                        
                        //فقط ادمین ها میتوانند بجای دیگران ثبت نام کنند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['entering_player_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
                
                case "cancel"         :{
                    
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیغام مبنی براینکه خودتان انصراف میدهید یا دیگری
                        $keyboard       = $GLOBALS['keyboard_cancel'];
                        $markup_options = ['inline_keyboard' => $keyboard];
                        $textmessage    = $GLOBALS['enter_who_would_remove'];
                        $parsemodes     = "HTML";
                        $result = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        remove_notifications();
    
                        exit();
                    }
                    else{
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step2'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $connection  = connect_to_db();
                        $connection  -> query("DELETE FROM User WHERE ChatID = $chat_id AND UserID = $user_id");
                        $connection  -> close();
                        $Lines = rewrite_players($Lines, 1);
    
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }
                    
                } break;
                
                case "cancelmyself"   :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //حذف پیام مبنی براینکه ثبت نام خود را کنسل میکنید یا دیگری
                        $url = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id ];
                        send_reply($url, $post_params);
            
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step2'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $connection  = connect_to_db();
                        $connection  -> query("DELETE FROM User WHERE ChatID = $chat_id AND UserID = $user_id");
                        $connection  -> close();
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                    }                
                } break;
                
                case "cancelanother"  :{
                    
                    if ($admin == true and ($BB == true or $CC == true)){
                        
                        //حذف پیام قبلی مبنی براینکه ثبت نام خود را میخواهید کنسل کنید یا دیگری
                        $url = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id ];
                        send_reply($url, $post_params);
                        
                        //ارسال پیام مبنی براینکه شماره بازیکنی که میخواهید ثبت نامش را کنسل کنید وارد کنید
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['enter_player_number_remove'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        exit(); 
                    }
                } break;
                
                case "changename"     :{
                    
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['enter_your_name2'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        $result_array   = json_decode($result, true);
                        
                } break;
                
                case "previous1"      :{
                    
                    if ($admin == true){
                        
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step1'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
    
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 1, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_1'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط گاد بازی میتواند به مرحله قبل برگردد
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
    
                case "step2"          :{
    
                    if ($admin == true){
                        
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step3'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 3, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_3'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                        remove_notifications();
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها می توانند به مرحله بعد بروند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['finalization_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                    
                    
                } break;
                
                //مرحله سه
                case "ready"          :{
                    
                    //دکمه های بازی
                    $keyboard          = $GLOBALS['keyboard_step3'];
                    $inline_kb_options = ['inline_keyboard' => $keyboard];
                    $json_kb           = json_encode($inline_kb_options);
                    
                    //بازنویسی لیست بازی
                    update_database("User", "Ready", "yes", 2);
                    $GameInfos = read_database("GameInfo");
                    $setlines = set_lines($GameInfos);
                    $Lines    = $setlines[0];
                    $Last_Line= $setlines[1];
                    $Lines = write_info($GameInfos, $Lines, $Last_Line);
                    $Lines = rewrite_players($Lines, 1);
                    
                    $reply       =  implode("" , $Lines);
                    $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                    $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                    $result      =  send_reply($url, $post_params);
                    
                } break;
    
                case "previous2"      :{
    
                    if ($admin == true){
                        
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step2'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 2, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_2'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط گاد بازی میتواند لیست را نهایی کند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break; 
                
                case "step3"          :{
                    
                    //حذف همه ثبت نام های ناقص در گروه مربوطه
                    $connection = connect_to_db();
                    $connection -> query("DELETE  FROM User WHERE ChatID = $chat_id AND PersianName = '' ");
                    $connection -> query("DELETE  FROM User WHERE ChatID = $chat_id AND Number      =  0 ");
                    
                    //چک کردن اینکه لیست تکمیل و همه اعلام حضور کرده باشند
                    $i = 0;
                    $j = 0;
                    $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
                    while($row = $result -> fetch_assoc()){
                        $No       = $row['No'];
                        $persianname = $row['PersianName'];
                        $ready = $row['Ready'];
                        if ($ready == "yes"){
                            $i = $i + 1;
                        }
                        if (empty($persianname) == false){
                            $j = $j + 1;
                        }
                    }
                    
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
    
                    if ($i == $GameInfos[3] and $j == $GameInfos[3] and $admin == true){
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step4'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 4, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_4'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else if ($i != $NOP or $j != $NOP){
                        
                        //ارسال پیغام مبنی براینکه برای رفتن به مرحله بعد همه باید اعلام حضور کرده باشند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['all_should_ready'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها می توانند به مرحله بعد بروند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['finalization_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                    
                } break;
                
                //مرحله چهار
                case "gotobot"        :{
                    
                    //خواندن اطلاعات بازی از دیتابیس
                    $connection = connect_to_db();
                    $result = $connection -> query("SELECT * FROM GameInfo");
                    while($row = $result -> fetch_assoc()){
                        $No       = $row['No'];
                        $chat_id2 = $row['ChatID'];
                        if ($chat_id2 == $chat_id){
                            $msg_id   = $row['MessageID'];
                            $NOP      = $row['NOP'];
                            $event    = $row['Event'];
                            $date     = $row['Date'];
                            $time     = $row['Time'];
                            $scenario = $row['Scenario'];
                            $god      = $row['God'];
                            $god_id   = $row['GodID'];
                            $group    = $row['GroupName'];
                            $final    = $row['Final'];
                        }
                    }
                    $connection  -> close();
                    
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
    
                    if (is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']) == true){
                        
                        //ارسال پیام مبنی براینکه همه پلیرها وارد ربات شوید
                        $url          =  $GLOBALS['bot_url'];
                        $textmessage  =  $GLOBALS['all_players_should_go_to_bot'] . "\n" . $GLOBALS['my_bot_username'];
                        $parsemodes   =  "HTML";
                        $result       =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                        $result_array =  json_decode($result, true);
                        
                        //نوشتن مسیج آیدی پیام مبنی براینکه همه باید وارد ربات شوند در دیتابیس
                        $msg_id_text =  $result_array["result"]["message_id"];
                        $connection  =  connect_to_db();
                        $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                        $connection  -> close();    
                        }
                    else if ($user_id != $god_id){
                        
                        //ارسال پیام مبنی براینکه فقط گاد بازی میتواند قرعه کشی کند
                        $url    = $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['u_r_NOT_admin'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();     
                    }
                    
                } break;
                
                case "drawing"        :{
    
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
                    
                    if ($user_id == $GameInfos[9]){
                        
                        //حذف همه ثبت نام های ناقص در گروه مربوطه
                        $connection = connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND PersianName = '' ");
                        if      ($GameInfos[7] == "مذاکره 10 نفره"){$rolelist = $GLOBALS['rolelist1'];}
                        else if ($GameInfos[7] == "مذاکره 12 نفره"){$rolelist = $GLOBALS['rolelist2'];}
                        else if ($GameInfos[7] == "ناتویی 10 نفره"){$rolelist = $GLOBALS['rolelist3'];}
                        else if ($GameInfos[7] == "تِرَکِر 12 نفره"){$rolelist = $GLOBALS['rolelist4'];}
                        else if ($GameInfos[7] == "ناتاشا 10 نفره"){$rolelist = $GLOBALS['rolelist5'];}
                        else if ($GameInfos[7] == "ناتاشا 12 نفره"){$rolelist = $GLOBALS['rolelist6'];}
                        else if ($GameInfos[7] == "ناتاشا 15 نفره"){$rolelist = $GLOBALS['rolelist7'];}
                        else if ($GameInfos[7] == "شب‌مافیا 12 نفره"){$rolelist = $GLOBALS['rolelist8'];}
                        else if ($GameInfos[7] == "فراماسون 10 نفره"){$rolelist = $GLOBALS['rolelist9'];}
                        else if ($GameInfos[7] == "فراماسون 12 نفره"){$rolelist = $GLOBALS['rolelist10'];}
                        else if ($GameInfos[7] == "فراماسون 15 نفره"){$rolelist = $GLOBALS['rolelist11'];}
                        else if ($GameInfos[7] == "فراماسون 18 نفره"){$rolelist = $GLOBALS['rolelist12'];}
                        else if ($GameInfos[7] == "قاضی 10 نفره"){$rolelist = $GLOBALS['rolelist13'];}
                        else if ($GameInfos[7] == "ساقی 15 نفره"){$rolelist = $GLOBALS['rolelist14'];}
                        else if ($GameInfos[7] == "بازجو 15 نفره"){$rolelist = $GLOBALS['rolelist15'];}
                        else if ($GameInfos[7] == "دزد و نگهبان 18 نفره"){$rolelist = $GLOBALS['rolelist16'];}
                        else if ($GameInfos[7] == "هزارچهره 15 نفره"){$rolelist = $GLOBALS['rolelist17'];}
                        else if ($GameInfos[7] == "دکتر 7 نفره"){$rolelist = $GLOBALS['rolelist18'];}

                        //قرعه کشی نقش ها و ذخیره در متغییر آرایه ای دی ال
                        $DL1       = $rolelist;
                        $lengRL    = count($rolelist) - 1;
                        $i = 0;
                        while($i <= $lengRL) {
                            $CI = array_rand($rolelist, 1);
                            $DL1[$i] = $rolelist[$CI];
                            unset($rolelist[$CI]);
                            $rolelist = array_values($rolelist);
                            $i = $i + 1;
                        }
                        $i = 0;
                        while($i <= $lengRL) {
                            $CI = array_rand($DL1, 1);
                            $DL[$i] = $DL1[$CI];
                            unset($DL1[$CI]);
                            $DL1 = array_values($DL1);
                            $i = $i + 1;
                        }
        
                        //ارسال پیغام مبنی براینکه نقش ها قرعه کشی شد
                        $url    = $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['initial_drawed_roles'];
                        $result = alert_user ($url, $reply, $callback_query_id);
    
                        //ارسال لیست اولیه نقش های قرعه کشی شده به پیوی گاد بازی
                        $textmessage = "لیست اولیه نقش های قرعه کشی شده:" . "\n" . "\n";
                        $i = 0;
                        while ($i<=$lengRL+1){
                            if ($i <=$lengRL){$textmessage .= $i+1 . " " . $DL[$i] . "\n";}
                            else {$textmessage .= "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";}
                            $i = $i + 1;
                        }
                        $url            =  $GLOBALS['bot_url']."/sendMessage";
                        $post_params = [ 'chat_id' => $user_id , 'text' => $textmessage , 'parse_mode'=> "HTML"];
                        $result      = send_reply($url, $post_params);
    
                        //نوشتن نقش های قرعه کشی شده در دیتابیس رول لیست
                        $Rs = $GLOBALS['Rs'];
                        $result = $connection -> query("SELECT * FROM RoleList WHERE ChatID = $chat_id");
                        while($row = $result -> fetch_assoc()) { 
                            $No         =  $row['No'];
                            $i = 0;
                            while($i <= $lengRL) {
                                $connection  -> query("UPDATE RoleList SET $Rs[$i] = '$DL[$i]'   WHERE No = $No");        
                                $i = $i + 1;
                            }
                        }
                        $connection  -> close();
                    }
                    
                    else if ($user_id != $god_id){
                        
                        //ارسال پیام مبنی براینکه فقط گاد بازی میتواند قرعه کشی کند
                        $url    = $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['drawing_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();     
                    }
                } break;
                
                case "sendroles"      :{
                    
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
    
                    if ($user_id == $GameInfos[9]){
                        
                        //حذف همه ثبت نام های ناقص در گروه مربوطه
                        $connection = connect_to_db();
                        $connection -> query("DELETE FROM User WHERE ChatID = $chat_id AND PersianName = '' ");
    
                        //خواندن نقش ها از دیتابیس
                        $DL = mysqli_fetch_array($connection -> query("SELECT * FROM RoleList WHERE ChatID = $chat_id"));
                        $i = 0;
                        while($i <= 20) {
                            $DL2[$i] = $DL[$i+3];
                            $i = $i + 1;
                        }
                        $DL = $DL2;
    
                        //ارسال نقش ها به پیوی افراد
                        $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
                        while($row = $result -> fetch_assoc()) {
                            $No        = $row['No'];
                            $chat_id2  = $row['ChatID'];
                            $user_id2  = $row['UserID'];
                            $username2 = $row['Username'];
                            $firstname2= $row['Firstname'];
                            $lastname2 = $row['Lastname'];
                            $number    = $row['Number'];
                            $i         = $number - 1;
                            $BDL       = "<b>$DL[$i]</b>";
                            $url            = $GLOBALS['bot_url'];
                            $userprofile    = [$user_id2, $username2, $firstname2, $lastname2];
                            $textmessage    = "#ایونت_" .$GameInfos[4] . " " . $GameInfos[10] . " " . "ساعت " . $GameInfos[6] . ":" . "\n" . "نقش شما «" . $BDL . "» است." . "\n" . "💙" . $GLOBALS['my_bot_username'] . "💙" . "\n";
                            $parsemodes     = "HTML";
                            $result2        = send_message_notification($url, $userprofile, $user_id2, $textmessage, $parsemodes);
                            $result_array   = json_decode($result2, true);
                        }
    
                        //بازنویسی لیست بازی
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 3);
                        
                        //ارسال لیست نهایی نقش ها به پیوی گاد و خودم
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/sendMessage";
                        $post_params = [ 'chat_id' => $user_id , 'text' => $reply  , 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        $post_params = [ 'chat_id' => '116687279' , 'text' => $reply  , 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //نوشتن تاییدیه ارسال نقش ها در دیتابیس
                        $connection -> query("UPDATE GameInfo SET IsDrawed = 'yes'  WHERE ChatID = $chat_id");
                        
                        //ارسال پیغام نقش ها با موفقیت به پیوی بازیکن ها ارسال شد
                        $url    = $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['roles_sent_successfuly'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                    }
    
        
                    else if ($user_id != $god_id){
                        
                        //فقط گاد بازی می تواند نقش ها را ارسال کند
                        $url    = $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['sending_roles_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();     
                    }
                    
                } break;
                
                case "previous3"      :{
    
                    if ($admin == true){
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step3'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 3, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_3'], 1);                
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط گاد بازی میتواند لیست را نهایی کند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
    
                case "step4"          :{
                    
                    //حذف ثبت نام های ناقص در گروه مربوطه
                    $connection = connect_to_db();
                    $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
                    while($row = $result -> fetch_assoc()) {
                        $No          = $row['No'];
                        $persianname = $row['PersianName'];
                        if (empty($persianname) == true){
                            $connection -> query("DELETE FROM User WHERE No = $No");
                        }
                    }
    
                    //خواندن اطلاعات بازی
                    $GameInfos = read_database("GameInfo");
    
                    if ($user_id == $GameInfos[9] and $GameInfos[12] == "yes"){

                        //دکمه های بازی
                        if ($GameInfos[7] == "شب‌مافیا 12 نفره"){$keyboard = $GLOBALS['keyboard_step5_1'];}
                        else{$keyboard = $GLOBALS['keyboard_step5'];}
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 5, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_5'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $connection  = connect_to_db();
                        $connection -> query("UPDATE User SET DeadLive  =  'live' WHERE ChatID = $chat_id AND DeadLive = '' ");
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                    else if ($user_id == $GameInfos[9]){
                        
                        //ارسال پیام مبنی براینکه برای رفتن به مرحله بعد باید نقش های قرعه کشی شده برای بازیکن ها ارسال شده باشد
                        $url    =  $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['roles_should_have_already_sent'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();     
                    }
                    else{
                        
                        //ارسال پیام مبنی براینکه فقط گاد بازی میتواند به مرحله بعد برود                    
                        $url    = $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['next_step_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();    
                    }
                    } break;
                    
                //مرحله پنج
                case "deadlive"       :{
                    if (is_god($user_id) == true){
                    
                        remove_notifications();
    
                        //ارسال درخواست وارد کردن شماره بازیکن برای تغییر وضعیت
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['who_would_you_deadlive'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        $result_array   = json_decode($result, true);
                    }
                    else {
                        
                        //ارسال پیام مبنی براینکه فقط گاد بازی میتواند وضعیت بازیکن ها را تغییر دهد
                        $url    =  $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['deadlive_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();      
                    }
                } break;
                
                case "warning"        :{
                    
                    if (is_god($user_id) == true){
                        
                        //ارسال درخواست وارد کردن شماره بازیکن برای دادن اخطار
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['who_would_you_warning'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        $result_array   = json_decode($result, true);
                        remove_notifications();
                    }
                    else {
                        
                        //ارسال پیام مبنی براینکه فقط گاد بازی میتواند وضعیت بازیکن ها را تغییر دهد
                        $url    =  $GLOBALS['bot_url'];
                        $reply  = $GLOBALS['warning_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit();      
                    }
                    
                } break;
                
                case "justification"  :{
                    
                    if (is_god($user_id) == true){
                        
                        //ارسال پیام مبنی براینکه به کدام بازیکن میخواهید مجوز کارت حرکت آخر دهید
                        $url            = $GLOBALS['bot_url'];
                        $textmessage    = $GLOBALS['who_would_you_justify'];
                        $markup_options = ['force_reply' => true ,  'selective' => true];
                        $parsemodes     = "HTML";
                        $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
                        $result_array   = json_decode($result, true);
                        remove_notifications();
                    } 
                    
                } break;

                case "finalcart"      :{
                    
                    //نوشتن واژه یس در ستون جاستیفیکیشن جلوی اسم بازیکن مربوطه
                    $connection = connect_to_db();
                    $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id AND UserID = $user_id");
                    while($row = $result  -> fetch_assoc()) {
                        $No           = $row['No'];
                        $persianname  = $row['PersianName'];
                        $justification= $row['Justification'];
                        if ($justification == "yes"){
                            
                            //لغو مجوز کارت حرکت آخر
                            $connection -> query("UPDATE User SET Justification  =  '' WHERE No = $No");
                            
                            //خواندن نقش ها از دیتابیس
                            $CL = mysqli_fetch_array($connection -> query("SELECT * FROM CartList WHERE ChatID = $chat_id"));
                            $i = 0;
                            while($i <= 5) {
                                $CL2[$i] = $CL[$i+2];
                                $i = $i + 1;
                            }
                            $cartlist = $CL2;
                            
                            if (empty($cartlist[5]) == true){unset($cartlist[5]);$cartlist = array_values($cartlist);}
                            if (empty($cartlist[4]) == true){unset($cartlist[4]);$cartlist = array_values($cartlist);}
                            if (empty($cartlist[3]) == true){unset($cartlist[3]);$cartlist = array_values($cartlist);}
                            if (empty($cartlist[2]) == true){unset($cartlist[2]);$cartlist = array_values($cartlist);}
                            if (empty($cartlist[1]) == true){unset($cartlist[1]);$cartlist = array_values($cartlist);}
                            
                            $CI = array_rand($cartlist, 1);
                            $selectedcart = $cartlist[$CI];
                            unset($cartlist[$CI]);
                            $cartlist = array_values($cartlist);
                            
                            //ارسال کارت حرکت آخر در گروه
                            $persianname = "<a href='tg://user?id=$user_id'>$persianname</a>";
                            $reply       = "کارت حرکت آخر برای " . $persianname . ":" . "\n";
                            $reply      .= "<b>$selectedcart</b>";
                            $url         = $GLOBALS['bot_url'] . "/sendMessage";
                            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply  , 'parse_mode'=>'HTML'];
                            $result2      = send_reply($url, $post_params);
                            
                            //بازنویسی کارت های باقیمانده در کارت لیست
                            $connection -> query("UPDATE CartList SET C1  =  '$cartlist[0]' WHERE ChatID = $chat_id");
                            $connection -> query("UPDATE CartList SET C2  =  '$cartlist[1]' WHERE ChatID = $chat_id");
                            $connection -> query("UPDATE CartList SET C3  =  '$cartlist[2]' WHERE ChatID = $chat_id");
                            $connection -> query("UPDATE CartList SET C4  =  '$cartlist[3]' WHERE ChatID = $chat_id");
                            $connection -> query("UPDATE CartList SET C5  =  '$cartlist[4]' WHERE ChatID = $chat_id");
                            $connection -> query("UPDATE CartList SET C6  =  '$cartlist[5]' WHERE ChatID = $chat_id");
                            $connection  -> close();
                        }
                    }

                    
                } break;
                
                case "previous4"      :{
    
                    if ($admin == true){
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step4'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 4, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_4'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 1);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط گاد بازی میتواند لیست را نهایی کند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
                
                //مرحله شش
                case "finish"         :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step6'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 6, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_6'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $connection  = connect_to_db();
                        $connection -> query("UPDATE User SET DeadLive  =  'live' WHERE ChatID = $chat_id AND DeadLive = '' ");
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
                
                case "city1"          :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
    
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", "city1", 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_city1'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                        /*
                        //ارسال لیست نقش ها به گروه
                        $Lines       = rewrite_players($Lines, 3);
                        $reply       =  implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply  , 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        */
                    }
                } break;
    
                case "city2"          :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", "city2", 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_city2'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
    
                case "mafia1"         :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
    
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", "mafia1", 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_mafia1'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
                
                case "mafia2"         :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", "mafia2", 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_mafia2'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $connection  = connect_to_db();
                        $connection -> query("UPDATE User SET DeadLive  =  'live' WHERE ChatID = $chat_id AND DeadLive = '' ");
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
    
                case "previous5"      :{
    
                    if ($admin == true){
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step5'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 5, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_5'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 2);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند به مرحله قبل بروند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
                
                //مرحله هفت
                case "best1"          :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 4);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
                
                case "best2"          :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 5);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
                
                case "best3"          :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 6);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }
                } break;
                
                case "removebest"     :{
                    
                  $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
                        
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step7'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 7);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                    }  
                } break;
    
                case "sendroles2"     :{
                    
                    $GameInfos = read_database("GameInfo");
                    if ($user_id == $GameInfos[9]){
    
                        //دکمه های بازی
                        $keyboard = $GLOBALS['keyboard_step8'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 2);
    
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $GLOBALS['chat_id'] , 'text' => $reply , 'message_id' => $GameInfos[2], 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
                        
                        //ارسال لیست نقش ها به گروه اصلی
                        $Lines       = rewrite_players($Lines, 3);
                        $reply       = implode("" , $Lines);
                        $url         = $GLOBALS['bot_url'] . "/sendMessage";
                        $post_params = [ 'chat_id' => $chat_id , 'text' => $reply, 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      = send_reply($url, $post_params);
                        
                        //ارسال لیست نقش ها به گروه چت
                        if ($chat_id == -1001278202951 or $chat_id == -1001421719499 or $chat_id == -1001195542511){
                            $Lines       = rewrite_players($Lines, 3);
                            $reply       = implode("" , $Lines);
                            $url         = $GLOBALS['bot_url'] . "/sendMessage";
                            $post_params = [ 'chat_id' => -1001494413297 , 'text' => $reply, 'parse_mode'=>'HTML'];
                            $result      = send_reply($url, $post_params);
                        }
                    }
                } break;
    
                case "previous6"      :{
    
                    if ($admin == true){
    
                        //دکمه های بازی
                        $keyboard          = $GLOBALS['keyboard_step6'];
                        $inline_kb_options = ['inline_keyboard' => $keyboard];
                        $json_kb           = json_encode($inline_kb_options);
                        
                        //بازنویسی لیست بازی
                        update_database("GameInfo", "Final", 6, 1);
                        update_database("GameInfo", "Step", $GLOBALS['Situation_6'], 1);
                        $GameInfos = read_database("GameInfo");
                        $setlines = set_lines($GameInfos);
                        $Lines    = $setlines[0];
                        $Last_Line= $setlines[1];
                        $Lines = write_info($GameInfos, $Lines, $Last_Line);
                        $Lines = rewrite_players($Lines, 2);
                        
                        $reply       =  implode("" , $Lines);
                        $url         =  $GLOBALS['bot_url'] . "/editMessageText";
                        $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result      =  send_reply($url, $post_params);
    
                    }
                    else {
                        
                        //ارسال پیغام مبنی براینکه فقط ادمین ها میتوانند به مرحله قبل بروند
                        $url         = $GLOBALS['bot_url'];
                        $reply       = $GLOBALS['previous_NOT_allowed'];
                        $result = alert_user ($url, $reply, $callback_query_id);
                        exit(); 
                    }
                } break;
                
                case "nakhaste"       :{
    
                    $connection = connect_to_db();
                    $thanks=mysqli_fetch_array($connection -> query("SELECT Thanks FROM User3 WHERE ChatID = $chat_id AND UserID = $user_id"));
                    $connection  -> close();
    
                    if (empty($thanks[0]) == true){
                        
                        $GameInfos    = read_database("GameInfo");
                        $godname      = $GameInfos[8];
                        $god_id       = $GameInfos[9];
                        $mention      = "<a href='tg://user?id=$god_id'>$godname</a>";
                        $nakhaste1    = "🌺خسته نباشی " . $mention . " جونم❤️" . "\n";
                        $nakhaste2    = "خدا قوّت " . $mention . "، عشقمی به خدا💙" . "\n"; 
                        $nakhaste3    = "مرسی که بازی ران کردی " . $mention . " جان🌹" . "\n";
                        $nakhaste4    = "فدای گاد مهربون، " . $mention . " جونم بشم من الهی😘" . "\n";
                        $nakhaste5    = "عجب گاد صبور و  با جنبه ای داریم. دمت گرم " . $mention . " جان🌺 "  . "\n";
                        $nakhaste6    = "اینجانب از " . $mention . " عزیز سپاسگزاری میکنم.🌺";
                        $nakhaste7    = "دمت گرم " . $mention . " خیلی گلی به خدا💋";
                        $nakhaste8    = "تنت سالم باشه " . $mention . " ای گاد با اقتدار💪";
                        $nakhaste9    = $mention . " جون یدونه باشه، کفشای سفید پاشه👟";
                        $nakhaste10   = "حالا یک دو سه، " . $mention . " کارش دُرُسّه🌺" . "\n";
                        $nakhaste11   = "حالا چار پنچ شیش، " . $mention . " گلی از پس و از پیش🌺" . "\n";
                        $nakhaste12   = "حالا هفت هشت نه " . $mention . " بهترین گاد قرنُ🌺" . "\n";
                        $nakhasteList = [$nakhaste1, $nakhaste2, $nakhaste3, $nakhaste4, $nakhaste5, $nakhaste6, $nakhaste7, $nakhaste8, $nakhaste9, $nakhaste10, $nakhaste11, $nakhaste12];
                        $i            = array_rand($nakhasteList, 1);
                        $nakhaste     = $nakhasteList[$i];
                        $mention      = $first_name  .  " "  .  $last_name ;
                        $mention      = "<a href='tg://user?id=$user_id'>$mention</a>";
                        $nakhaste    .= "از طرف " . $mention;
                        $url          = $GLOBALS['bot_url'] . "/sendMessage";
                        $post_params  = [ 'chat_id' => $chat_id , 'text' => $nakhaste, 'parse_mode'=>'HTML'];
                        $result2       = send_reply($url, $post_params);
                        $result_array = json_decode($result2, true);
                        
                        //نوشتن اطلاعات تشکر کننده در یوزر 3
                        $msg_id     = $result_array["result"]["message_id"];
                        $connection =  connect_to_db();
                        $connection -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection -> query("UPDATE User3 SET UserID   =  $user_id  WHERE No = $No");
                        $connection -> query("UPDATE User3 SET MessageID=  $msg_id   WHERE No = $No");
                        $connection -> query("UPDATE User3 SET Thanks   =  'yes'     WHERE No = $No");
                    }
                } break;
                
                //فاز روز
                case "chalenge"       :{
                    
                    //دکمه های بازی
                    $keyboard          = $GLOBALS['keyboard_chalenge'];
                    $inline_kb_options = ['inline_keyboard' => $keyboard];
                    $json_kb           = json_encode($inline_kb_options);
                    
                    $connection = connect_to_db();
                    $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
                    while($row = $result  -> fetch_assoc()) {
                        $user_id2    = $row['UserID'];
                        $number      = $row['Number']; 
                        if ($user_id2 == $user_id){
                            if ($number < 10){$number = "0" . $number;}
                            if (strpos($reply, "/" . $number . "chalenge") == false){
                                $reply.= "\n" . "/" . $number . "chalenge";
                                $url          = $GLOBALS['bot_url'] . "/editMessageText";
                                $post_params  = [ 'chat_id' => $chat_id , 'text' => $reply, 'message_id' => $msg_id, 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                                $result       = send_reply($url, $post_params);
                                $result_array = json_decode($result, true);
                            }
                        }
                    }
                    $connection  -> close();
                } break;
            }
        }
        else if (is_numeric($callback_data) == true) {

            if (is_god($user_id) == true){
                
                //آپدیت ستون ترن در یوزر
                $connection = connect_to_db();
                $connection -> query("UPDATE User SET Turn  =  'no' WHERE ChatID = $chat_id");
                $connection -> query("UPDATE User SET Turn  =  'yes' WHERE ChatID = $chat_id AND Number = $callback_data");
                $connection -> query("DELETE FROM User3 WHERE ChatID = $chat_id AND Thanks = 'chal'");
                
                //دکمه های بازی
                $keyboard          = $GLOBALS['keyboard_chalenge'];
                $inline_kb_options = ['inline_keyboard' => $keyboard];
                $json_kb           = json_encode($inline_kb_options);
                
                //ارسال پیام گرفتن چالش
                $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
                while($row = $result  -> fetch_assoc()) {
                    $NO = $row['No'];
                    $user_id2    = $row['UserID'];
                    $number      = $row['Number']; 
                    $persianname = $row['PersianName'];
                    if ($number == $callback_data){
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $reply   = "صحبت شماره " . $callback_data . ":" . $persianname;
                        $url          = $GLOBALS['bot_url'] . "/sendMessage";
                        $post_params  = [ 'chat_id' => $chat_id , 'text' => $reply, 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
                        $result2      = send_reply($url, $post_params);
                        $result_array = json_decode($result2, true);

                        //نوشتن اطلاعات تشکر کننده در یوزر 3
                        $msg_id     = $result_array["result"]["message_id"];
                        $connection -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection -> query("UPDATE User3 SET UserID   =  $user_id2  WHERE No = $No");
                        $connection -> query("UPDATE User3 SET MessageID=  $msg_id    WHERE No = $No");
                        $connection -> query("UPDATE User3 SET Thanks   =  'chal'     WHERE No = $No");

                    }
                }
                $connection  -> close();
            }
        }
    }
    
     //-------------------------------------
    
    function detect_text_received_and_reply() {
        
        $text           =  $GLOBALS['text'];         
        $text_replied   =  $GLOBALS['text_replied'];
        $msg_id_replied =  $GLOBALS['msg_id_replied'];
        $msg_id_text    =  $GLOBALS['msg_id_text'];
        $chat_id        =  $GLOBALS['chat_id'];
        $user_id        =  $GLOBALS['user_id'];
        $username       =  $GLOBALS['username'];
        $first_name     =  $GLOBALS['first_name'];
        $last_name      =  $GLOBALS['last_name'];
        $userprofile    =  $GLOBALS['userprofile'];
        $bot_id         =  $GLOBALS['bot_id'];

        $AA     = $bot_id == $GLOBALS['my_bot_id'];
        $BB     = strpos($text_replied, $username);
        $CC     = strpos($text_replied, $first_name  .  " "  .  $last_name);
        $admin  = is_admin($GLOBALS['chat_id'] , $GLOBALS['user_id'] , $GLOBALS['bot_url']);
        $god    = is_god($user_id);

        if (strpos($text_replied, $GLOBALS['number_of_players']) == true and $admin == true and $AA == true){
            
            $text = convertNumbers($text);
            $text = intval($text);
            
            //چک کردن اینکه حداکثر تعداد بازیکن یک عدد صحیح انگلیسی در رنج مناسب باشد
            if ($text < 2 or $text > 30){

                //حذف پیام های مربوط به شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                send_reply($url, $post_params);
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                    
                //ارسال پاسخ مبنی براینکه حداکثر تعداد بازیکن باید یک عدد صحیح انگلیسی بین 6 تا 30 باشد
                $url                 = $GLOBALS['bot_url'];
                $textmessage  =  $GLOBALS['number_of_players_range'];
                $parsemodes   =  "HTML";
                $result       =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                $result_array =  json_decode($result, true);
                
                //نوشتن مسیج آیدی و چت آیدی پیام «حداکثر تعداد بازیکن باید در رنج مناسب باشد» در دیتابیس
                $msg_id_text =  $result_array["result"]["message_id"];
                $connection  =  connect_to_db();
                $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                $connection  -> close();
                exit();
            }
            
            //حذف پیام های مربوط به تعداد بازیکن ها
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            send_reply($url, $post_params);
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            send_reply($url, $post_params);    
            
            //حذف اسامی انتهای لیست
            $connection  =  connect_to_db();
            $result = $connection -> query("SELECT * FROM GameInfo");
            while($row = $result -> fetch_assoc()){
                $chat_id2 = $row['ChatID'];
                $NOP2 = $row['NOP'];
                if ($chat_id2 == $chat_id and $text < $NOP2){
                    $result = $connection -> query("SELECT * FROM User");
                    while($row = $result -> fetch_assoc()) {
                        $No     = $row['No'];
                        $chat_id2 = $row['ChatID'];
                        $number = $row['Number'];
                        if ($chat_id2 == $chat_id and $number > $text){
                            $connection -> query("DELETE FROM User WHERE No = $No");
                        }
                    }
                }
            }
            
            //دکمه های بازی
            $keyboard = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            update_database("GameInfo", "NOP", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       =  implode("" , $Lines);
            $url         =  $GLOBALS['bot_url'] . "/editMessageText";
            $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      =  send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_player_another_id']) == true and $admin == true and $AA == true){
            
            //حذف پیام های مربوط به وارد کردن آیدی بازیکن
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
            
            //چک کردن اینکه آیا قبلا ثبت نام انجام شده است یا خیر
            $connection = connect_to_db();
            $result = $connection -> query("SELECT * FROM User");
            while($row = $result -> fetch_assoc()) {
                $No         =  $row['No'];
                $chat_id2    = $row['ChatID'];
                $user_id2    = $row['UserID'];
                $persianname = $row['PersianName'];
                if ($chat_id2 == $chat_id and $user_id2 == $text and empty($persianname) == false){
                    
                    //ارسال پیام مبنی براینکه این شخص قبلا ثبت نام کرده است
                    $url            =  $GLOBALS['bot_url'];
                    $textmessage    =  $GLOBALS['already_registered_another'];
                    $parsemodes     =  "HTML";
                    $result         =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                    $result_array   =  json_decode($result, true);
    
                    //نوشتن مسیج آیدی و چت آیدی پیام «ایشان قبلا ثبت نام کرده اند» در دیتابیس
                    $msg_id_text =  $result_array["result"]["message_id"];
                    $connection  =  connect_to_db();
                    $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                    $No = $connection -> insert_id;
                    $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                    $connection  -> close();
                    exit(); 
                }
                else if ($chat_id2 == $chat_id and $user_id2 == $text){
                    $connection -> query("DELETE FROM User WHERE No = $No");
                }
            }
            $connection -> close();
            
            //ارسال درخواست وارد کردن شماره بازیکن
            $url            = $GLOBALS['bot_url'];
            $textmessage    = $GLOBALS['enter_another_number'];
            $markup_options = ['force_reply' => true ,  'selective' => true];
            $parsemodes     = "HTML";
            $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
            $result_array   = json_decode($result, true);
            $M3             = $result_array["result"]["message_id"];

            //نوشتن اطلاعات کسی که میخواهیم بجایش ثبت نام کنیم در دیتابیس انودر و یوزر
            $connection = connect_to_db();
            $connection -> query("INSERT INTO User (ChatID) VALUES ($chat_id)");
            $No = $connection -> insert_id;
            $connection -> query("UPDATE User SET UserID  = $text    WHERE No = $No");
            
            $connection -> query("INSERT INTO Another (ChatID) VALUES ($chat_id)");
            $No = $connection -> insert_id;
            $connection -> query("UPDATE Another SET AnotherID  = $text              WHERE No = $No");
            $connection -> query("UPDATE Another SET M1         = $msg_id_replied    WHERE No = $No");
            $connection -> query("UPDATE Another SET M2         = $msg_id_text       WHERE No = $No");
            $connection -> query("UPDATE Another SET M3         = $M3                WHERE No = $No");
            $connection -> close();


        }
        
        if ((strpos($text_replied, $GLOBALS['enter_your_number']) == true or strpos($text_replied, $GLOBALS['enter_another_number']) == true) and $AA == true and ($BB == true or $CC == true) ) {
            
            $text = convertNumbers($text);
                  
            //چک کردن اینکه شماره بازیکن قبلا انتخاب نشده باشد
            $number = $GLOBALS['text'];
            $connection = connect_to_db();
            $result = $connection -> query("SELECT * FROM User");
            while($row = $result -> fetch_assoc()) { 
                $No          = $row['No'];
                $chat_id2    = $row['ChatID'];
                $user_id2    = $row['UserID'];
                $number2     = $row['Number'];
                $persianname = $row['PersianName'];
                if ($chat_id2 == $chat_id and $number2 == $number){
                    if (empty($persianname) == false){
                        
                        //حذف پیام های مربوط به شماره بازیکن
                        $url = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                        send_reply($url, $post_params);
                        $url = $GLOBALS['bot_url'] . "/deleteMessage";
                        $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                        send_reply($url, $post_params);
               
                        //حذف همه ثبت نام های ناقص با شماره صفر
                        $connection = connect_to_db();
                        $connection -> query("DELETE  FROM User WHERE ChatID = $chat_id AND Number      =  0 ");

                        //ارسال پاسخ مبنی بر اینکه این شماره قبلا انتخاب شده است
                        $url            =  $GLOBALS['bot_url'];
                        $textmessage    =  $GLOBALS['enter_your_number_answer'];
                        $parsemodes     =  "HTML";
                        $result         =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                        $result_array   =  json_decode($result, true);
                        
                        //نوشتن مسیج آیدی و چت آیدی پیام «این شماره قبلا انتخاب شده است» در دیتابیس
                        $msg_id_text =  $result_array["result"]["message_id"];
                        $connection  =  connect_to_db();
                        $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                        $No = $connection -> insert_id;
                        $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                        $connection  -> close();
                        exit(); 
                    }
                    else if (empty($persianname) == true){
                        sleep(5);
                        $persianname = $row['PersianName'];
                        if (empty($persianname) == false){
                            
                            //حذف پیام های مربوط به شماره بازیکن
                            $url = $GLOBALS['bot_url'] . "/deleteMessage";
                            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                            send_reply($url, $post_params);
                            $url = $GLOBALS['bot_url'] . "/deleteMessage";
                            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                            send_reply($url, $post_params);
        
                            //ارسال پاسخ مبنی بر اینکه این شماره قبلا انتخاب شده است
                            $url            =  $GLOBALS['bot_url'];
                            $textmessage    =  $GLOBALS['enter_your_number_answer'];
                            $parsemodes     =  "HTML";
                            $result         =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                            $result_array   =  json_decode($result, true);
                            
                            //نوشتن مسیج آیدی و چت آیدی پیام «این شماره قبلا انتخاب شده است» در دیتابیس
                            $msg_id_text =  $result_array["result"]["message_id"];
                            $connection  =  connect_to_db();
                            $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                            $No = $connection -> insert_id;
                            $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                            $connection  -> close();
                            exit();
                        }
                        else if (empty($persianname) == true){
                            $connection -> query("DELETE FROM User WHERE No = $No");
                        }
                    }
                }
            } 

            //خواندن تعداد بازیکن ها از دیتابیس گیم اینفو
            $connection  = connect_to_db();
            $result = $connection -> query("SELECT * FROM GameInfo");
            while($row = $result -> fetch_assoc()){
                $No       = $row['No'];
                $chat_id2 = $row['ChatID'];
                if ($chat_id2 == $chat_id){
                    $NOP      = $row['NOP'];
                }
            }
            
            //چک کردن اینکه آیا شماره در رنج مجاز هست یا خیر
            $number  =  intval($text);
            if ($number < 1 or $number > $NOP){

                //حذف پیام های مربوط به شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                send_reply($url, $post_params);
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                
                //حذف همه ثبت نام های ناقص با شماره صفر
                $connection = connect_to_db();
                $connection -> query("DELETE  FROM User WHERE ChatID = $chat_id AND Number      =  0 ");
                    
                //ارسال پاسخ مبنی بر اینکه شماره بازیکن باید در رنج مجاز باشد
                $url                 = $GLOBALS['bot_url'];
                $textmessage  =  $GLOBALS['enter_your_number_range1'] . $NOP . $GLOBALS['enter_your_number_range2'];
                $parsemodes   =  "HTML";
                $result       =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                $result_array =  json_decode($result, true);
                
                //نوشتن مسیج آیدی و چت آیدی پیام «شماره باید در رنج مناسب باشد» در دیتابیس
                $msg_id_text =  $result_array["result"]["message_id"];
                $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                $connection  -> close();
                exit();
            }

            //ارسال درخواست وارد کردن نام فارسی
            $url            = $GLOBALS['bot_url'];
            if (strpos($text_replied, $GLOBALS['enter_your_number']) == true){
                $textmessage    = $GLOBALS['enter_your_name'];
            }
            else if (strpos($text_replied, $GLOBALS['enter_another_number']) == true){
                $textmessage    = $GLOBALS['enter_another_name'];    
            }
            $markup_options = ['force_reply' => true ,  'selective' => true];
            $parsemodes     = "HTML";
            $result         = send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
            $result_array   = json_decode($result, true);
            $M5             = $result_array["result"]["message_id"];

            //نوشتن شماره بازیکن در دیتابیس 1
            $connection = connect_to_db();
            if (strpos($text_replied, $GLOBALS['enter_your_number']) == true){
                $result = $connection -> query("SELECT * FROM User");
                while($row = $result -> fetch_assoc()) {
                    $No       = $row['No'];
                    $chat_id2 = $row['ChatID'];
                    $user_id2 = $row['UserID'];
                    if ($chat_id2 == $chat_id and $user_id2 == $user_id){
                        $connection -> query("UPDATE User SET Number   =  $text   WHERE No = $No");    
                    }
                }
            }
            else if (strpos($text_replied, $GLOBALS['enter_another_number']) == true){
                $result = $connection -> query("SELECT * FROM Another");
                while($row = $result -> fetch_assoc()) {
                    $No        = $row['No'];
                    $chat_id2  = $row['ChatID'];
                    $M3        = $row['M3'];
                    if ($chat_id2 == $chat_id and $M3 == $GLOBALS['msg_id_replied']){
                        $player_id  = $row['AnotherID'];
                        $connection -> query("UPDATE Another SET M4   =  $msg_id_text   WHERE No = $No");
                        $connection -> query("UPDATE Another SET M5   =  $M5            WHERE No = $No");
                    }
                }
                $result = $connection -> query("SELECT * FROM User");
                while($row = $result -> fetch_assoc()) {
                    $No = $row['No'];
                    $chat_id2  = $row['ChatID'];
                    $user_id2  = $row['UserID'];
                    if ($chat_id2 == $chat_id and $user_id2 == $player_id){
                        $connection -> query("UPDATE User SET Number   =  $number   WHERE No = $No");    
                    }
                }                
            }
            
            //حذف پیام های مربوط به شماره بازیکن
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            send_reply($url, $post_params);
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            send_reply($url, $post_params);
            

        }
    
        if ((strpos($text_replied, $GLOBALS['enter_your_name']) == true or strpos($text_replied, $GLOBALS['enter_your_name2']) == true or strpos($text_replied, $GLOBALS['enter_another_name']) == true or strpos($text_replied, $GLOBALS['enter_god_you']) == true) and $AA == true and ($BB == true or $CC == true) ) {
            
            //چک کردن اینکه آیا نام وارد شده فارسی هست یا خیر؟
            $new_text       = str_replace(' ', '', $text);
            $text_length    = mb_strlen($new_text , 'utf-8');
            $pattern        = '/[\x{0590}-\x{05ff}\x{0600}-\x{06ff}]/u';
            $matches_number = preg_match_all($pattern, $new_text);
            if ($matches_number != $text_length){

                //حذف پیام های مربوط به شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                send_reply($url, $post_params);
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                 
                //حذف همه ثبت نام های ناقص با شماره صفر
                $connection = connect_to_db();
                $connection -> query("DELETE  FROM User WHERE ChatID = $chat_id AND Number      =  0 ");
   
                //ارسال پاسخ مبنی بر اینکه نام وارد شده حتما باید فارسی باشد
                $url            =  $GLOBALS['bot_url'];
                $textmessage    =  $GLOBALS['enter_your_name_in_persian'];
                $parsemodes     =  "HTML";
                $result         =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                $result_array   =  json_decode($result, true);

                //نوشتن مسیج آیدی و چت آیدی پیام «نام حتما باید فارسی باشد» در دیتابیس
                $msg_id_text =  $result_array["result"]["message_id"];
                $connection  =  connect_to_db();
                $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                $connection  -> close();
                exit();    
            }
            
            //نوشتن اسم فارسی و آیدی عددی در پلیرنیمز
            $connection = connect_to_db();
            if (strpos($text_replied, $GLOBALS['enter_another_name']) == false){
                $i = 0;
                $result = $connection -> query("SELECT * FROM PlayerNames");
                while($row = $result -> fetch_assoc()) {
                    $No = $row['No'];
                    $user_id2  = $row['UserID'];
                    if ($user_id2 == $user_id){
                        $connection -> query("UPDATE PlayerNames SET PlayerName   =  '$text'   WHERE No = $No");
                        $i = 1;
                    }
                }
                if ($i == 0){
                    $connection  -> query("INSERT INTO PlayerNames (UserID) VALUES ($user_id)");
                    $No = $connection -> insert_id;
                    $connection  -> query("UPDATE PlayerNames SET PlayerName  =   '$text'    WHERE No = $No");
                }
            }
            $connection -> close();

            //نوشتن اسم فارسی در یوزر یا گیم اینفو
            if (strpos($text_replied, $GLOBALS['enter_another_name']) == false){
                update_database("User", "PersianName", $text, 2);
                $GameInfos = read_database("GameInfo");
                if ($GameInfos[9] == $user_id){
                    update_database("GameInfo", "God", $text, 1);
                }
            }
            else if (strpos($text_replied, $GLOBALS['enter_another_name']) == true){
                $connection = connect_to_db();
                $result = $connection -> query("SELECT * FROM Another");
                while($row = $result -> fetch_assoc()) {
                    $No        = $row['No'];
                    $chat_id2  = $row['ChatID'];
                    $M5        = $row['M5'];
                    if ($chat_id2 == $chat_id and $M5 == $msg_id_replied){
                        $player_id  = $row['AnotherID'];
                        $connection -> query("UPDATE Another SET M6  =  $msg_id_text   WHERE No = $No");
                    }
                }
                $result = $connection -> query("SELECT * FROM User");
                while($row = $result -> fetch_assoc()) {
                    $No = $row['No'];
                    $chat_id2  = $row['ChatID'];
                    $user_id2  = $row['UserID'];
                    if ($chat_id2 == $chat_id and $user_id2 == $player_id){
                        $connection -> query("UPDATE User SET PersianName   =  '$text'   WHERE No = $No");    
                    }
                }
                $connection -> close();
            }

            //حذف پیام های مربوط به وارد کردن نام فارسی
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
            
            //خواندن اطلاعات بازی
            $GameInfos = read_database("GameInfo");
            
            //دکمه های بازی
            if      ($GameInfos[11] == 1){
                $keyboard = $GLOBALS['keyboard_step1'];
            }
            else if ($GameInfos[11] == 2){
                $keyboard = $GLOBALS['keyboard_step2'];
            }
            else if ($GameInfos[11] == 3){
                $keyboard = $GLOBALS['keyboard_step3'];
            }
            else if ($GameInfos[11] == 4){
                $keyboard = $GLOBALS['keyboard_step4'];
            }
            else if ($GameInfos[11] == 5){
                $keyboard = $GLOBALS['keyboard_step5'];
            }
            $inline_kb_options = ['inline_keyboard' => $keyboard];
            $json_kb = json_encode($inline_kb_options);
            
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);

            $reply       =  implode("" , $Lines);
            $url         =  $GLOBALS['bot_url'] . "/editMessageText";
            $post_params =  [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      =  send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_player_number_remove']) == true and $admin == true and $AA == true) {
            
            $text = convertNumbers($text);
            
            //حذف پیام های مربوط به وارد کردن شماره بازیکن برای کنسل کردن ثبت نام
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
            
            //خواندن اطلاعات بازی
            $GameInfos = read_database("GameInfo");
            
            //چک کردن اینکه آیا شماره در رنج مجاز هست یا خیر
            $number  =  intval($text);
            if ($number < 1 or $number > $GameInfos[3]){

                //حذف پیام های مربوط به شماره بازیکن
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                send_reply($url, $post_params);
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                    
                //ارسال پاسخ مبنی بر اینکه شماره بازیکن باید در رنج مجاز باشد
                $url                 = $GLOBALS['bot_url'];
                $textmessage  =  $GLOBALS['enter_your_number_range1'] . $NOP . $GLOBALS['enter_your_number_range2'];
                $parsemodes   =  "HTML";
                $result       =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                $result_array =  json_decode($result, true);
                
                //نوشتن مسیج آیدی و چت آیدی پیام «شماره بازیکن باید در رنج مناسب باشد» در دیتابیس
                $msg_id_text =  $result_array["result"]["message_id"];
                $connection  =  connect_to_db();
                $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                $connection  -> close();
                exit();
            }

            //دکمه های بازی
            $keyboard = $GLOBALS['keyboard_step2'];
            $inline_kb_options = ['inline_keyboard' => $keyboard];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $connection  = connect_to_db();
            $connection  -> query("DELETE FROM User WHERE ChatID = $chat_id AND Number = '$text'");
            $connection  -> close();
            $Lines = rewrite_players($Lines, 1);

            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);               
            exit();

        }
        
        if (strpos($text_replied, $GLOBALS['enter_event_number']) == true and $admin == true and $AA == true) {
            
            $text = convertNumbers($text);
            
            //چک کردن اینکه آیا شماره ایونت در رنج مجاز هست یا خیر
            if (intval($text) < 1 or intval($text) > 10000){

                //حذف پیام های مربوط به شماره ایونت
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
                send_reply($url, $post_params);
                $url = $GLOBALS['bot_url'] . "/deleteMessage";
                $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
                send_reply($url, $post_params);
                    
                //ارسال پاسخ مبنی بر اینکه شماره ایونت باید در رنج مجاز باشد
                $url          = $GLOBALS['bot_url'];
                $textmessage  =  $GLOBALS['enter_event_number_range'];
                $parsemodes   =  "HTML";
                $result       =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                $result_array =  json_decode($result, true);
                
                //نوشتن مسیج آیدی و چت آیدی پیام «شماره ایونت باید  در رنج مناسب باشد» در دیتابیس
                $msg_id_text =  $result_array["result"]["message_id"];
                $connection  =  connect_to_db();
                $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                $connection  -> close();
                exit(); 
            }

            //حذف پیام های مربوط به وارد کردن شماره ایونت
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);

            //دکمه های بازی
            $keyboard_step1 = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            update_database("GameInfo", "Event", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_date']) == true and $admin == true and $AA == true) {

            //حذف پیام های مربوط به وارد کردن تاریخ ایونت
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
          
            //دکمه های بازی
            $keyboard_step1 = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            update_database("GameInfo", "Date", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_time']) == true and $admin == true and $AA == true) {
            
            //حذف پیام های مربوط به وارد کردن تاریخ ایونت
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
           
            //دکمه های بازی
            $keyboard_step1 = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
            $json_kb = json_encode($inline_kb_options);

            //بازنویسی لیست بازی
            update_database("GameInfo", "Time", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_scenario']) == true and $admin == true and $AA == true) {

            //حذف پیام های مربوط به وارد کردن سناریوی بازی
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
            
            //چک کردن اینکه نام سناریوی انتخابی شبیه به سناریوهای تعریف شده نباشد
            if($text == "ناتویی 12 نفره" or $text == "مذاکره 12 نفره" or $text =="ناتویی 10 نفره" or $text == "مذاکره 10 نفره"){
                
                //ارسال پاسخ مبنی براینکه نام سناریو نباید شبیه به سناریوهای تعریف شده باشد
                $url            =  $GLOBALS['bot_url'];
                $textmessage    =  $GLOBALS['scenario_name_NOT_allowed'];
                $parsemodes     =  "HTML";
                $result         =  send_message_notification($url, $userprofile, $chat_id, $textmessage, $parsemodes);
                $result_array   =  json_decode($result, true);

                //نوشتن مسیج آیدی و چت آیدی پیام «نام حتما باید فارسی باشد» در دیتابیس
                $msg_id_text =  $result_array["result"]["message_id"];
                $connection  =  connect_to_db();
                $connection  -> query("INSERT INTO User3 (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE User3 SET MessageID  = $msg_id_text   WHERE No = $No");
                $connection  -> close();
                exit();
            }
            
            //دکمه های بازی
            $keyboard_step1 = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            update_database("GameInfo", "Scenario", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_god_another_id']) == true and $admin == true and $AA == true) {
            
            //حذف پیام های مربوط به وارد کردن آیدی گاد بازی
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
            
            //آپدیت اطلاعات بازی در دیتابیس گیم اینفو
            $connection  = connect_to_db();
            $result = $connection -> query("SELECT * FROM GameInfo");
            while($row = $result -> fetch_assoc()){
                $No       = $row['No'];
                $chat_id2 = $row['ChatID'];
                if ($chat_id2 == $chat_id){
                    $connection  -> query("UPDATE GameInfo SET GodID = $text  WHERE No = $No");
                }
            }
            $connection  -> close();

            //ارسال پیام مبنی براینکه نام دیگری را به عنوان گاد بازی وارد کنید
            $url            = $GLOBALS['bot_url'];
            $textmessage    = $GLOBALS['enter_god_another'];
            $markup_options = ['force_reply' => true ,  'selective' => true];
            $parsemodes     = "HTML";
            $result         = send_message_adv($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes);
            exit(); 
        }
        
        if (strpos($text_replied, $GLOBALS['enter_god_another']) == true and $admin == true and $AA == true) {

            //حذف پیام های مربوط به وارد کردن نام گاد بازی
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
           
            //دکمه های بازی
            $keyboard_step1 = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            update_database("GameInfo", "God", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['enter_group']) == true and $admin == true and $AA == true) {
            
            //حذف پیام های مربوط به وارد کردن نام گروه
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            $result      = send_reply($url, $post_params);
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            $result      = send_reply($url, $post_params);
            
            //نوشتن چت آیدی و نام گروه در گروپ نیم
            $connection = connect_to_db();
            $i = 0;
            $result = $connection -> query("SELECT * FROM GroupNames");
            while($row = $result -> fetch_assoc()) {
                $No = $row['No'];
                $chat_id2  = $row['ChatID'];
                if ($chat_id2 == $chat_id){
                    $connection -> query("UPDATE GroupNames SET GroupName   =  '$text'   WHERE No = $No");
                    $i = 1;
                }
            }
            if ($i == 0){
                $connection  -> query("INSERT INTO GroupNames (ChatID) VALUES ($chat_id)");
                $No = $connection -> insert_id;
                $connection  -> query("UPDATE GroupNames SET GroupName  =   '$text'    WHERE No = $No");
            }
            $connection -> close();
            
            //دکمه های بازی
            $keyboard_step1 = $GLOBALS['keyboard_step1'];
            $inline_kb_options = ['inline_keyboard' => $keyboard_step1];
            $json_kb = json_encode($inline_kb_options);

            //بازنویسی لیست بازی
            update_database("GameInfo", "GroupName", $text, 1);
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $Lines = rewrite_players($Lines, 1);
            
            $reply       = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }

        if (strpos($text_replied, $GLOBALS['who_would_you_deadlive']) == true and $god == true and $AA == true){
            
            $text = convertNumbers($text);
            
            //حذف پیام های مربوط به شماره بازیکن
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            send_reply($url, $post_params);
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            send_reply($url, $post_params);
           
            //دکمه های بازی
            $GameInfos = read_database("GameInfo");
            if ($GameInfos[7] == "شب‌مافیا 12 نفره"){$keyboard = $GLOBALS['keyboard_step5_1'];}
            else{$keyboard = $GLOBALS['keyboard_step5'];}
            $inline_kb_options = ['inline_keyboard' => $keyboard];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            $connection  =  connect_to_db();
            $deadlive    =  mysqli_fetch_array($connection -> query("SELECT DeadLive FROM User WHERE ChatID = $chat_id AND Number = $text"));
            if ($deadlive[0] == "live"){
                $connection  -> query("UPDATE User SET DeadLive  = 'dead' WHERE ChatID = $chat_id AND Number = $text");
            }
            else if ($deadlive[0] == "dead"){
                $connection  -> query("UPDATE User SET DeadLive  = 'live' WHERE ChatID = $chat_id AND Number = $text");
            }
            $connection  -> close();
            $Lines = rewrite_players($Lines, 2);

            $reply = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params);
        }
        
        if (strpos($text_replied, $GLOBALS['who_would_you_warning']) == true and $god == true and $AA == true){
            
            $text = convertNumbers($text);
            
            //حذف پیام های مربوط به اخطار
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            send_reply($url, $post_params);
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            send_reply($url, $post_params);

            //دکمه های بازی
            $GameInfos = read_database("GameInfo");
            if ($GameInfos[7] == "شب‌مافیا 12 نفره"){$keyboard = $GLOBALS['keyboard_step5_1'];}
            else{$keyboard = $GLOBALS['keyboard_step5'];}
            $inline_kb_options = ['inline_keyboard' => $keyboard];
            $json_kb = json_encode($inline_kb_options);
            
            //بازنویسی لیست بازی
            $GameInfos = read_database("GameInfo");
            $setlines = set_lines($GameInfos);
            $Lines    = $setlines[0];
            $Last_Line= $setlines[1];
            $Lines = write_info($GameInfos, $Lines, $Last_Line);
            
            $connection  =  connect_to_db();
            $deadlive    =  mysqli_fetch_array($connection -> query("SELECT * FROM User WHERE ChatID = $chat_id AND Number = $text"));
            if      ($deadlive[11] != "yes"){
                $connection  -> query("UPDATE User SET Warning1  = 'yes' WHERE ChatID = $chat_id AND Number = $text");
            }
            else if ($deadlive[12] != "yes"){
                $connection  -> query("UPDATE User SET Warning2  = 'yes' WHERE ChatID = $chat_id AND Number = $text");
            }
            else if ($deadlive[13] != "yes"){
                $connection  -> query("UPDATE User SET Warning3  = 'yes' WHERE ChatID = $chat_id AND Number = $text");
            }
            else {
                $connection  -> query("UPDATE User SET Comment  = 'کیک'  WHERE ChatID = $chat_id AND Number = $text");
            }
            $connection  -> close();
            $Lines = rewrite_players($Lines, 2);

            $reply = implode("" , $Lines);
            $url         = $GLOBALS['bot_url'] . "/editMessageText";
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'message_id' => $GameInfos[2] , 'reply_markup' => $json_kb, 'parse_mode'=>'HTML'];
            $result      = send_reply($url, $post_params); 
        }
        
        if (strpos($text_replied, $GLOBALS['who_would_you_justify']) == true and $god == true and $AA == true){
        
            $text = convertNumbers($text);
            
            //حذف پیام های مربوط به صدور مجوز کارت حرکت آخر
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_replied ];
            send_reply($url, $post_params);
            $url = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $GLOBALS['chat_id'] , 'message_id' => $msg_id_text ];
            send_reply($url, $post_params);

            //نوشتن واژه یس در ستون جاستیفیکیشن جلوی اسم بازیکن مربوطه
            $connection = connect_to_db();
            $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
            while($row = $result  -> fetch_assoc()) {
                $connection -> query("UPDATE User SET Justification  =  '' WHERE ChatID = $chat_id");
            }
            $connection -> query("UPDATE User SET Justification  =  'yes' WHERE ChatID = $chat_id AND Number = $text");
            $connection  -> close();
            exit();
        }

    }
    
    //-------------------------------------
    
    function send_reply($url, $post_params) {
        
        $cu = curl_init();
        curl_setopt($cu, CURLOPT_URL, $url);
        curl_setopt($cu, CURLOPT_POSTFIELDS, $post_params);
        curl_setopt($cu, CURLOPT_RETURNTRANSFER, true);  // get result
        $result = curl_exec($cu);
        curl_close($cu);
        return $result;
    }
    
    //-------------------------------------
    
    function is_admin($chat_id, $user_id, $url) {    
        $url          = $url . "/getChatMember";
        $post_params  = ['chat_id' => $chat_id, 'user_id' => $user_id  ];
        $result       = send_reply($url, $post_params);
        $result_array = json_decode($result, true);
        $status       = $result_array["result"]["status"];

        if ($status == "creator" || $status =="administrator"){ 
            return true;
        }
        else{
            return false;
        }
    }
    
    //-------------------------------------
    
    function send_message_adv ($url, $userprofile, $chat_id, $textmessage, $markup_options, $parsemodes){
        
        $url        = $url . "/sendMessage";
        $user_id    = $userprofile[0];
        $username   = $userprofile[1];
        $first_name = $userprofile[2];
        $last_name  = $userprofile[3];
        $json       = json_encode($markup_options);
        
        if(empty($username) == false){
            $reply       = "@"   .   $username   .   "\n"   .   $textmessage;
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'reply_markup' => $json , 'parse_mode'=> $parsemodes];
            $result      = send_reply($url, $post_params);
            $result_array= json_decode($result , true);
            return $result;
        }
        else if(empty($username) == true){
            $mention     = $first_name  .  " "  .  $last_name ;
            $mention     = "<a href=  'tg://user?id=$user_id' >  $mention</a>";
            $reply       = $mention  .   "\n"   .   $textmessage;
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply ,'reply_markup' => $json , 'parse_mode'=> $parsemodes];
            $result      = send_reply($url, $post_params);
            $result_array= json_decode($result , true);
            return $result;
        }
    }
    
    //-------------------------------------
    
    function send_message_notification ($url, $userprofile, $chat_id, $textmessage, $parsemodes){
        
        $url        = $url . "/sendMessage";
        $user_id    = $userprofile[0];
        $username   = $userprofile[1];
        $first_name = $userprofile[2];
        $last_name  = $userprofile[3];

        if(empty($username) == false or $username != ""){
            $reply       = "@"   .   $username   .   "\n"   .   $textmessage;
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'parse_mode'=> $parsemodes];
            $result      = send_reply($url, $post_params);
            $result_array= json_decode($result , true);
            return $result; 
        }
        else if(empty($username) == true or $username == ""){
            $mention     = $first_name  .  " "  .  $last_name ;
            $mention     = "<a href=  'tg://user?id=$user_id' >  $mention</a>";
            $reply       = $mention  .   "\n"   .   $textmessage;
            $post_params = [ 'chat_id' => $chat_id , 'text' => $reply , 'parse_mode'=> $parsemodes];
            $result      = send_reply($url, $post_params);
            $result_array= json_decode($result , true);
            return $result;
        }
    }
    
    //-------------------------------------
    
    function alert_user ($url, $reply, $callback_query_id){
        $url         = $url."/answerCallbackQuery";
        $post_params =  [
            'callback_query_id'=> $callback_query_id,
            'text'             => $reply,
            'show_alert'       => true
        ];
        $result      = send_reply($url, $post_params);
        $result_array= json_decode($result , true);
        return $result;
    }
    
    //-------------------------------------
    
    function is_god($user_id){
        
        //خواندن اطلاعات بازی از دیتابیس
        $connection  = connect_to_db();
        $result = $connection -> query("SELECT * FROM GameInfo");
        while($row = $result -> fetch_assoc()){
            $chat_id2 = $row['ChatID'];
            if ($chat_id2 == $GLOBALS['chat_id']){
                $god_id = $row['GodID'];
            }
        }
        if ($user_id == $god_id){
            return true; 
        }
        else {
            return false;
        }
        $connection  -> close();
    }
    
    //-------------------------------------
    
    function convertNumbers($text){
        $en_num = array('0','1','2','3','4','5','6','7','8','9');
        $fa_num = array('۰','۱','۲','۳','۴','۵','۶','۷','۸','۹');
        return str_replace($fa_num, $en_num, $text);     
    }
    
    //-------------------------------------
    
    function update_database($table, $column, $text, $type){
    
        $chat_id   = $GLOBALS['chat_id'];
        $user_id   = $GLOBALS['user_id'];
        $connection= connect_to_db();
        if ($type == 1){$result = $connection -> query("SELECT * FROM $table WHERE ChatID = $chat_id");}
        else if($type == 2){$result = $connection -> query("SELECT * FROM $table WHERE ChatID = $chat_id AND UserID = $user_id");}
        while($row = $result -> fetch_assoc()){
            $No         =  $row['No'];
            $connection -> query("UPDATE $table SET $column = '$text'  WHERE No = $No");
        }
        $connection  -> close();
    }
    
     //-------------------------------------
    
    function read_database($table){
       
        $chat_id = $GLOBALS['chat_id'];
        $connection  = connect_to_db();
        $result = $connection -> query("SELECT * FROM $table WHERE ChatID = $chat_id");
        while($row = $result -> fetch_assoc()){
            $No       = $row['No'];
            $chat_id2 = $row['ChatID'];
            $msg_id   = $row['MessageID'];
            $NOP      = $row['NOP'];
            $event    = $row['Event'];
            $date     = $row['Date'];
            $time     = $row['Time'];
            $scenario = $row['Scenario'];
            $god      = $row['God'];
            $god_id   = $row['GodID'];
            $group    = $row['GroupName'];
            $final    = $row['Final'];
            $isdrawed = $row['IsDrawed'];
            $list     = $row['List'];
            $step     = $row['Step'];
        }
        $connection  -> close();
        return [$No, $chat_id2, $msg_id, $NOP, $event, $date, $time, $scenario, $god, $god_id, $group, $final, $isdrawed, $list, $step];
    }
    
    //-------------------------------------
    
    function set_lines($GameInfos){
        
        switch($GameInfos[13]){
            
            case "1" :{$Lines = file($GLOBALS['file_link1']);} break;
            case "2" :{$Lines = file($GLOBALS['file_link2']);} break;
            case "3" :{$Lines = file($GLOBALS['file_link3']);} break;
            case "4" :{$Lines = file($GLOBALS['file_link4']);} break;
            case "5" :{$Lines = file($GLOBALS['file_link5']);} break;
            case "6" :{$Lines = file($GLOBALS['file_link6']);} break;
        }
        
        $NOP      = $GameInfos[3];
        $B1 = 9;
        $B2 = 7;
        $i = 1;
        
        while($i <= $B2) {
            $ii          = $B1 + $i;
            $Lines2[$i]  = $Lines[$ii];
            $i = $i + 1;
        }
        $i = 1;
        while($i <= $NOP) {
            $ii          = $B1 + $i;
            if ($i <10){
              $Lines[$ii]  = "/" . "0" . $i  .  "- "  .    "\n" ;
            }
            else{
              $Lines[$ii]  = "/" . $i  .  "- "  .    "\n" ;
            }
            $i = $i + 1;
        }
        $i = 1;
        while($i <= $B2) {
            $ii          = $B1 + $NOP + $i;
            $Lines[$ii]  = $Lines2[$i];
            $i = $i + 1;
        }
        $Last_Line = $B1 + $NOP + $B2;
        return [$Lines, $Last_Line];
    }
    
    //-------------------------------------
    
    function write_info($GameInfos, $Lines, $Last_Line){

        switch($GameInfos[13]){
            case "1" :{
                $C0 = "💚";
                $C1 = "💚#ایونت_"; 
                $C2 = "📆💚 تاریخ: ";
                $C3 = "🕓💚 ساعت: ";
                $C4 = "📜💚 سناریو: ";
                $C5 = "🧿💚 گاد: ";
            } break;
            case "2" :{
                $C0 = "💙";
                $C1 = "💙#ایونت_"; 
                $C2 = "📆💙 تاریخ: ";
                $C3 = "🕓💙 ساعت: ";
                $C4 = "📜💙 سناریو: ";
                $C5 = "🧿💙 گاد: ";
            } break;
            case "3" :{
                $C0 = "❤️";
                $C1 = "❤️#ایونت_"; 
                $C2 = "📆❤️ تاریخ: ";
                $C3 = "🕓❤️ ساعت: ";
                $C4 = "📜❤️ سناریو: ";
                $C5 = "🧿❤️ گاد: ";
            } break;
            case "4" :{
                $C0 = "💛";
                $C1 = "💛#ایونت_"; 
                $C2 = "📆💛 تاریخ: ";
                $C3 = "🕓💛 ساعت: ";
                $C4 = "📜💛 سناریو: ";
                $C5 = "🧿💛 گاد: ";
            } break;
            case "5" :{
                $C0 = "🐔";
                $C1 = "🐔#ایونت_"; 
                $C2 = "📆🐔 تاریخ: ";
                $C3 = "🕓🐔 ساعت: ";
                $C4 = "📜🐔 سناریو: ";
                $C5 = "🧿🐔 گاد: ";
            } break;
            case "6" :{
                $C0 = "🎊";
                $C1 = "🎊#ایونت_"; 
                $C2 = "📆🎊 تاریخ: ";
                $C3 = "🕓🎊 ساعت: ";
                $C4 = "📜🎊 سناریو: ";
                $C5 = "🧿🎊 گاد: ";
            } break;
        }
        switch($GameInfos[11]){
            case "0" :{$C6 = $GLOBALS['Situation_0'];} break;
            case "1" :{$C6 = $GLOBALS['Situation_1'];} break;
            case "2" :{$C6 = $GLOBALS['Situation_2'];} break;
            case "3" :{$C6 = $GLOBALS['Situation_3'];} break;
            case "4" :{$C6 = $GLOBALS['Situation_4'];} break;
            case "5" :{$C6 = $GLOBALS['Situation_5'];} break;
            case "6" :{$C6 = $GLOBALS['Situation_6'];} break;
            case "city1" :{$C6 = $GLOBALS['Situation_city1'];}  break;
            case "city2" :{$C6 = $GLOBALS['Situation_city2'];}  break;
            case "mafia1":{$C6 = $GLOBALS['Situation_mafia1'];} break;
            case "mafia2":{$C6 = $GLOBALS['Situation_mafia2'];} break;
        }
        //بازنویسی اطلاعات بازی
        $god_id =   $GameInfos[9];
        $god    =   $GameInfos[8];
        $Lines[0]   =$C1 . $GameInfos[4] . " " . $GameInfos[10] . $C0 . "\n";
        $Lines[2]   =$C2 . $GameInfos[5] . "\n";
        $Lines[3]   =$C3 . $GameInfos[6] . "\n";
        $Lines[4]   =$C4 . $GameInfos[7] . "\n";
        $Lines[5]   =$C5 . "<a href='tg://user?id=$god_id'>$god</a>" . "\n";
        $Lines[$Last_Line-3] = "         " . $C6 . "\n";
        $Lines[$Last_Line]   = $C1 . $GameInfos[4] . " " . $GameInfos[10] . $C0 . "\n";
        return $Lines;
    }
    
    //-------------------------------------
                    
    function rewrite_players($Lines, $type){
        
        $chat_id = $GLOBALS['chat_id'];
        
        //خواندن نقش ها از دیتابیس
        $connection = connect_to_db();
        $DL = mysqli_fetch_array($connection -> query("SELECT * FROM RoleList WHERE ChatID = $chat_id"));
        $i = 0;
        while($i <= 20) {
            $DL2[$i] = $DL[$i+3];
            $i = $i + 1;
        }
        $DL = $DL2;
        
        $B0 = 9;
        $GameInfos = read_database("GameInfo");
        switch($GameInfos[13]){
        
            case "1" :{$C0 = "💚";} break;
            case "2" :{$C0 = "💙";} break;
            case "3" :{$C0 = "❤️";} break;
            case "4" :{$C0 = "💛";} break;
            case "5" :{$C0 = "🐔";} break;
            case "6" :{$C0 = "🎉";} break;
        }
        
        $result = $connection -> query("SELECT * FROM User WHERE ChatID = $chat_id");
        while($row = $result  -> fetch_assoc()) {
            $No          = $row['No'];
            $chat_id2    = $row['ChatID'];
            $user_id2    = $row['UserID'];
            $number      = $row['Number']; 
            $persianname = $row['PersianName'];
            $ready       = $row['Ready'];
            $deadlive    = $row['DeadLive'];
            $warning1    = $row['Warning1'];
            $warning2    = $row['Warning2'];
            $warning3    = $row['Warning3'];
            $comment     = $row['Comment'];
            $best        = $row['Best'];
            if ($number < 10){$number = "0" . $number;}
            
            switch($type){
                
                case "1" :{
                    
                    if ($ready == "yes"){
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .   "✅"   .   "\n" ;    
                    }
                    else if ($ready != "yes" and empty($persianname) == false){
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   "\n" ;    
                    }
                } break;
                case "2" :{
                    if ($deadlive  == "dead" ){
                        if ($warning1 != "yes" and $warning2 != "yes" and $warning3 != "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .    "❌"   .   "\n" ; 
                        }
                        else if ($warning1 == "yes" and $warning2 != "yes" and $warning3 != "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .   "❌"   . " "  ."❗️".   "\n" ; 
                        }
                        else if ($warning1 == "yes" and $warning2 == "yes" and $warning3 != "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .    "❌"   . " "  ."‼️".  "\n" ; 
                        }
                        else if ($warning1 == "yes" and $warning2 == "yes" and $warning3 == "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .    "❌"   . " "  ."‼️"."❗️". "\n" ; 
                        }
                    }
                    else if ($deadlive  == "live" ){
                        if ($warning1 != "yes" and $warning2 != "yes" and $warning3 != "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .    "🟢"  .   "\n" ; 
                        }
                        else if ($warning1 == "yes" and $warning2 != "yes" and $warning3 != "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .   "🟢"  . " "  ."❗️".   "\n" ; 
                        }
                        else if ($warning1 == "yes" and $warning2 == "yes" and $warning3 != "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .    "🟢" . " "  ."‼️️".  "\n" ; 
                        }
                        else if ($warning1 == "yes" and $warning2 == "yes" and $warning3 == "yes"){
                            $ii          = $B0 + $number;
                            $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                            $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  .    "🟢"  . " "  ."‼️"."❗️". "\n" ; 
                        }
                    }                    
                } break;
                case "3" :{
                    
                    if ($best == "best1"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " ➲ "  . $DL[$i] . " 🥇" . "\n" ;    
                    }
                    else if ($best == "best2"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " ➲ "  . $DL[$i] . " 🥈" . "\n" ;    
                    }
                    else if ($best == "best3"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " ➲ "  . $DL[$i] . " 🥉" . "\n" ;    
                    }
                    else {
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " ➲ "  . $DL[$i] . "\n" ;    
                    }
                    
                } break;
                case "4" :{
                    
                    if ($best == "best1"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥇" . "\n" ;    
                    }
                    else if ($best == "best2"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥈" . "\n" ;    
                    }
                    else if ($best == "best3"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥉" . "\n" ;    
                    }
                    else {
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " /" . $number . "best1". "\n" ;    
                    }
                    
                } break;
                case "5" :{
                    
                    if ($best == "best1"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥇" . "\n" ;    
                    }
                    else if ($best == "best2"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥈" . "\n" ;    
                    }
                    else if ($best == "best3"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥉" . "\n" ;    
                    }
                    else {
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " /" . $number . "best2". "\n" ;    
                    }
                    
                } break;
                case "6" :{
                    
                    if ($best == "best1"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥇" . "\n" ;    
                    }
                    else if ($best == "best2"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥈" . "\n" ;    
                    }
                    else if ($best == "best3"){
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . " 🥉" . "\n" ;    
                    }
                    else {
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " /" . $number . "best3". "\n" ;    
                    }
                    
                } break;
                case "7" :{
                    if (empty($best) == false) {
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname   .   " /" . $number . "RemoveBest". "\n" ;    
                    }
                    else {
                        $i           = $number - 1;
                        $ii          = $B0 + $number;
                        $persianname = "<a href='tg://user?id=$user_id2'>$persianname</a>";
                        $Lines[$ii]  = $C0 . $number  .  "- "  .  $persianname  . "\n" ;    
                    }
                } break;
            }
        }
        $connection  -> close();
        return $Lines;
    }
    
    //-------------------------------------
    
    function remove_notifications(){
        
        $chat_id = $GLOBALS['chat_id'];
        $connection = connect_to_db();
        $result = $connection -> query("SELECT * FROM User3 WHERE ChatID = $chat_id");
        while($row = $result -> fetch_assoc()){
            $No       = $row['No'];
            $msg_id2  = $row['MessageID'];
            $url         = $GLOBALS['bot_url'] . "/deleteMessage";
            $post_params = [ 'chat_id' => $chat_id , 'message_id' => $msg_id2 ];
            $result1      = send_reply($url, $post_params);
            $connection -> query("DELETE FROM User3 WHERE No = $No");
        }
        $connection -> close();
    }

    //-------------------------------------
    
    function connect_to_db() {

        $connection = new mysqli("localhost", "hamidmoe_HM", "123456789", "hamidmoe_Mafia");
        
        if ($connection -> connect_error)
            echo "Failed to connect to db: " . $connection -> connect_error;
            
        $connection -> query("SET NAMES utf8");
        $connection -> set_charset('utf8mb4');
        
        return $connection;
    }
?>