<?php include('header.php'); 
if(isset($_POST['submit']))
    {
        $result='';
        $name=$_POST['name'];
        $type=$_POST['type'];
        $target_dir="uploads/banner/";
        $target_file = basename($_FILES["image"]["name"]);
        move_uploaded_file($_FILES["image"]["tmp_name"], $target_dir. $target_file);
        
        $sql = "INSERT INTO home_banner (name, type, banner_image) VALUES ('$name', '$type', '$target_file')";

        if (mysqli_query($conn, $sql)) 
        {   
            $result="<div class='alert alert-success' role='alert'>Banner Added Successfully!!</div>";
                echo "<script>setTimeout(function(){window.location.href = 'home-banner.php';},3000);</script>";
        }
           
        else 
        {
            echo "Error: " . $sql . "<br>" . mysqli_error($conn);
        }

        mysqli_close($conn);
    
    }
    
    if($_GET['action']=='delete')
    {
        $del_id=$_GET['id'];
        require_once("connection.php");
        $sql = "DELETE FROM home_banner WHERE id='".$del_id."'";
    
        if (mysqli_query($conn, $sql)) {
            $result2="<div class='alert alert-success' role='alert'>Banner Deleted Successfully!!</div>";
                echo "<script>setTimeout(function(){window.location.href = 'home-banner.php';},3000);</script>";
        } else {
            echo "Error deleting record: " . mysqli_error($conn);
        }
    
        mysqli_close($conn);
    }

?>
  <body>

    <?php include('sidemenu.php'); ?>
      
    <?php include('topbar.php'); ?>

    <div class="br-mainpanel">
      <div class="br-pageheader">
        <nav class="breadcrumb pd-0 mg-0 tx-12">
          <a class="breadcrumb-item" href="javascript:void(0)">Wedding Triangle</a>
          <span class="breadcrumb-item active">Add Banner</span>
        </nav>
      </div><!-- br-pageheader -->
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                      <div class="br-pagebody">
                        <div class="br-section-wrapper">
                    <?= $result; ?>
                         <h6 class="br-section-label mb-3">Add Banner</h6>
                          <form method="post" enctype="multipart/form-data" data-parsley-validate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group mg-b-30">
                                      <label for="exampleInputPassword1">Banner Tag Line (Small)</label>
                                        <input type="text" name="name" class="form-control" required>
                                    </div><!-- form-group -->
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group mg-b-30">
                                      <label for="exampleInputPassword1">Banner Tag Line (Big)</label>
                                        <input type="text" name="type" class="form-control" required>
                                    </div><!-- form-group -->
                                </div>
                                <div class="col-md-12 mg-b-30">
                                <label>Cycle Image:</label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <img src="img/img11.jpg" class="img-fluid" alt="" id="blah">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="file" name="image" id="file-2" class="inputfile" data-multiple-caption="{count} files selected" multiple>
                                        <label for="file-2" class="if-outline if-outline-info">
                                          <ion-icon name="cloud-upload-outline"></ion-icon>
                                          <span>Choose a file...</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                                <input type="hidden" value="<?= $row['id']; ?>" name="id">
                                <div class="col-md-12">
                                    <button type="submit" name="submit" class="btn btn-info tx-11 pd-y-12 tx-uppercase tx-spacing-2"><ion-icon name="save-outline"></ion-icon> Save</button>
                                </div>
                            </div>
                          </form>
                        </div><!-- br-section-wrapper -->
                    </div><!-- br-pagebody -->
                </div>
                <div class="col-md-6">
                    <div class="br-pagebody">
                        <div class="br-section-wrapper">
                        <h6 class="br-section-label mb-3">Banner List</h6>
                            <?= $result2; ?>
                          <div class="table-wrapper">
            <table id="datatable1" class="table display responsive nowrap">
              <thead>
                <tr>
                  <th>Sr. No</th>
                  <th>Banner Image</th>
                  <th>Banner Name</th>
                  <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <?php
                    
                    require_once("connection.php");
                    
                    $sql = "SELECT * FROM home_banner";
                    $result = mysqli_query($conn, $sql);

                    if (mysqli_num_rows($result) > 0) {
                        // output data of each row
                        $a=1;
                        while($row = mysqli_fetch_assoc($result)) {
                            
                            ?>
                                <tr>
                                  <td><?= $a; ?></td>
                                  <td><img src="uploads/banner/<?= $row['banner_image']?>" width="200" height="100"></td>
                                  <td><?= $row['name']?></td>
                                  <td><a href="home-banner.php?action=delete&id=<?= $row['id']?>"><ion-icon name="trash-outline"></ion-icon></a></td>
                                </tr>
                            <?php
                        $a++;
                        }
                    } 
                ?>             
                </tbody>
            </table>
          </div><!-- table-wrapper -->
                        </div><!-- br-section-wrapper -->
                      </div><!-- br-pagebody -->
                </div>
            </div>
      </div>
      
<?php include('footer.php'); ?>
