<?php session_start();
$sessionid=$_SESSION['username'];
if(!isset($sessionid)){
    header("location:../index.php");
}
include('config.php');
$q1=mysqli_query($con,"select * from admin where username='$sessionid'");
if(mysqli_num_rows($q1)>0){
$name=$_POST['name'];
$category=$_POST['category'];
$oprice=$_POST['oprice'];
$price=$_POST['price'];
$stock=$_POST['stock'];
$status=$_POST['status'];
$descr=$_POST['descr'];
$size=$_POST['size'];
$colors=$_POST['colors'];
$tags=$_POST['tags'];
$subcat=$_POST['subcat'];

if(mysqli_query($con,"insert into products (name,category,price,stock,descr,status,tags,subcat,oprice) values ('$name','$category','$price','$stock','$descr','$status','$tags','$subcat','$oprice')")){
  $pid=mysqli_insert_id($con);
  $sizes=explode(",",$size);
  foreach($sizes as $i){
    mysqli_query($con,"insert into sizes (pid,sizes) values('$pid','$i')");
  }
  $colorss=explode(",",$colors);
  foreach($colorss as $j){
    mysqli_query($con,"insert into colors (pid,color) values('$pid','$j')");
  }
  $countfiles = count($_FILES['file']['name']);
  for($i=0;$i<$countfiles;$i++){
    $filename = $_FILES['file']['name'][$i];
    if(move_uploaded_file($_FILES['file']['tmp_name'][$i],'../../products/'.$filename)){
      mysqli_query($con,"insert into pimages (pid,image) values ('$pid','$filename')");
    }else{
      echo "$filename is not uploaded<br>";
    }
  }
  header("location:products.php");
}
}else{
  header("location:../index.php");
}
?>