<?php

//Evitar cache, para trabajar en tiempo real
header("Cache-Control: no-cache, must-revalidate"); // HTTP/1.1
header("Expires: Sat, 1 Jul 2000 05:00:00 GMT"); // Fecha en el pasado
header("Access-Control-Allow-Origin: *");


//LLamado a las funciones
header("Content-type:application/json");
require_once ('../MySQL/functions.php');
$db = get_conection();


//VALIDAMOS LA CAPTURA DE PARAMETROS CORRECTOS
if( 
  isset($_POST['START']) && 
  isset($_POST['LENGTH']) && 
  isset($_POST['TABLE']) && 
  isset($_POST['FIELDS']) && 
  isset($_POST['FILTER']) && 
  isset($_POST['GET_ALL']) 
  ){

  $ROW          = $_POST['START'];  //NÚMERO DE PAGINACIÓN
  $ROWSPERPAGE  = $_POST['LENGTH']; //CANTIDAD POR PÁGINA
  $TABLE        = $_POST['TABLE'];
  $FIELDS       = json_decode ($_POST['FIELDS'], true);
  $FILTERS      = json_decode ($_POST['FILTER'], true);
  $GET_ALL      = $_POST['GET_ALL'];

}else{ exit; }


//FILTROS
if($GET_ALL!=1){
  foreach ($FILTERS as $FILTER) {
    $db  -> where ($FILTER[0], $FILTER[1], $FILTER[2]);  }}


//CONSULTA PÁGINADA
$db->pageLimit = $ROWSPERPAGE;
                 $db->orderBy("ID","DESC");//Las ultimas primero
$DATAFILTERED  = $db->withTotalCount()->get($TABLE, Array($ROW, $ROWSPERPAGE), $FIELDS);


//MOSTRAR
echo json_encode($DATAFILTERED);

 ?>
