<?php session_start();
require("../funkcije/sito.php");
require("../../../pisarnica_log.ini");
require("../../../pisarnica.ini");
header("Content-Security-Policy: default-src 'none'; style-src 'self'; img-src 'self';");
if(isset($_POST['pristupi'])){
$korisnik = "sabacebr_" . sito($_POST['korisnik'], 20, 1);
$lozinka = sito($_POST['lozinka'], 20, 1);
$veza = new mysqli($h, $k, $l, $b);
if($veza->connect_errno){
die("MariaDB: nemam vezu (log)");
}
$veza->set_charset("utf8");
$sql = $veza->prepare("insert into tbl_log (korisnik, adresa, akcija) values (?, ?, 'p')");
if(! $sql){
$veza->close();
die("MariaDB: komanda nije izvrsena (log)");
}
$sql->bind_param("ss", $korisnik, $_SERVER['REMOTE_ADDR']);
$sql->execute();
$sqlstate = $veza->sqlstate;
$sql->close();
$veza->close();
if($sqlstate != 0000){
die("MariaDB: " . $sqlstate . " (log)");
}
$veza = mysqli_connect($host, $korisnik, $lozinka, $baza) or die("Problem: nepoznat korisnik");
$rez = mysqli_query($veza, "select * from tbl_zaposleni where korisnicko_ime = '" . $korisnik . "';");
mysqli_close($veza);
$red = mysqli_fetch_assoc($rez);
extract ($red);
$_SESSION['korisnik'] = $korisnik;
$_SESSION['lozinka'] = $lozinka;
$_SESSION['adresa'] = $_SERVER['REMOTE_ADDR'];
$_SESSION['velicina'] = 20971520;
$_SESSION['ekstenzije'] = array("pdf", "PDF", "doc", "docx");
$_SESSION['uloga'] = $uloga;
if ($uloga == "pisar") {
header("location:pisar.php");
exit;
}
if ($uloga == "administrator") {
header("location:administrator.php");
exit;
}
if ($uloga == "referent") {
header("location:referent.php");
exit;
}
}
?>
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Пријава корисника</title>
<link rel="stylesheet" href="css/pristup.css">
</head>
<body>
<p id="kor">Општина Владимирци</p>
<br>
<p id="nas">ПРИЈАВА КОРИСНИКА</p>
<br>
<form action="pristup.php" method="post">
<label id="l_korisnik" for="korisnik">Корисник</label>
<br>
<input type="text" id="korisnik" name="korisnik" maxlength="20" required="required">
<br>
<label id="l_lozinka" for="lozinka">Лозинка</label>
<br>
<input type="password" id="lozinka" name="lozinka" maxlength="20" required="required">
<br>
<input type="submit" id="pristupi" name="pristupi" value="Приступи">
</form>
<img id="grb" src="../slike/Grb.jpg" alt="Grb opštine Vladimirci">
</body>
</html>
