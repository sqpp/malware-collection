<?php
    require_once 'lib/_config.php'; 
    require_once 'lib/_functions.php'; 
  sec_session_start();
  if (login_check($link) == true)
  {
    extract($_POST);
    
    if (isset($save)) {
        
        
        
        $report_id = $_POST['name'];
        $sql=$link->query("select * from `report` where report_id='$name' ");
    $checkrows=mysqli_num_rows($sql);

   if($checkrows>0) {
      echo '<script language="javascript">';
echo 'alert("Report Id Already Exist")';
echo '</script>';
   } else {


        $pan_i = strtolower(pathinfo($_FILES['image']['name'], PATHINFO_EXTENSION));
        $all_details=rand(1, 9999).'_'.time().'.'.$pan_i;
        $data_base_path='d_image/'.$all_details;
        $pan_img_path= 'd_image/'.$all_details;   // File store in
        move_uploaded_file($_FILES['image']['tmp_name'],$pan_img_path);
        $gggg=explode(' ', $name);
        $name=implode('-', $gggg);
        $sql=$link->query("INSERT INTO `report` (`pic`, `report_id`) VALUES ('$data_base_path', '".htmlentities(addslashes(strip_tags(trim($name))))."') ");
         
         if ($sql) {
             
          header('Location: at_a_glance.php');
          echo '<script language="javascript">';
echo 'alert("Successfully Inserted")';
echo '</script>';
        }



    }
    }


    if (isset($update)) {
      
$gggg=explode(' ', $name);
        $name=implode('-', $gggg);
        if ($_FILES['pic']['report_id']!='') {
         
           $sql=$link->query("SELECT * FROM `report` WHERE `id`='$u_id' ");

           $jjj=@mysqli_fetch_assoc($sql);

           unlink('../'.$jjj['image']);


        $pan_i = strtolower(pathinfo($_FILES['pic']['report_id'], PATHINFO_EXTENSION));
        $all_details=rand(1, 9999).'_'.time().'.'.$pan_i;
        $data_base_path='images/'.$all_details;
        $pan_img_path= '../images/'.$all_details;   // File store in
        move_uploaded_file($_FILES['image']['tmp_name'],$pan_img_path);

        $ss=$link->query("UPDATE `report` SET `pic`='$data_base_path',  `name`='".htmlentities(addslashes(strip_tags(trim($name))))."' WHERE `id`='$u_id' ");
      }else{
         $ss=$link->query("UPDATE `report` SET  `report_id`='".htmlentities(addslashes(strip_tags(trim($name))))."' WHERE `id`='$u_id' ");
      }
       

        if ($ss) {
          header('Location: at_a_glance.php');
        }


    }


    if (isset($_GET[del_id])) {
      
      $sql=$link->query("SELECT * FROM `report` WHERE `id`='".$_GET[del_id]."' ");

           $jjj=@mysqli_fetch_assoc($sql);

           unlink('../'.$jjj['image']);


      $sql=$link->query("DELETE FROM `report` WHERE `id`='".$_GET[del_id]."'");
      if ($sql) {
          header('Location: at_a_glance.php');
        }
    }
    
  
?>
<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from thevectorlab.net/flatlab/dynamic_table.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 21 Nov 2017 06:57:25 GMT -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="img/favicon.html">

    <?php require_once 'lib/_title.php'; ?>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />

    <!--dynamic table-->
    <link href="assets/advanced-datatable/media/css/demo_page.css" rel="stylesheet" />
    <link href="assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/data-tables/DT_bootstrap.css" />
      <!--right slidebar-->
      <link href="css/slidebars.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  
  
  <style>
   .innbutton{
     width:100%;
     float:left;
     margin:0px;
     padding:0px;
   }
   
   .innbutton a{
     width:100%;
     float:left;
     font-size: 20px;
   }
   
   .innbutton2{
     width:100%;
     float:left;
     margin:0px;
     padding:0px;
   }
   
   .hidden_destiny {
    display:none;
}
  </style>
  
  
  
  </head>

  <body>

  <section id="container" class="">
      <?php require 'imp_head.php';require_once 'lib/_header.php'; ?>
      <!--sidebar start-->
      <?php require_once 'lib/_menu.php'; ?>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
              
        
              <div class="row">
                <div class="col-sm-12">
              <section class="panel" style="padding:12px;">
             
              <div class="panel-body">
             <section class="panel">
              <header class="panel-heading">
        <font size="5" color="#ff6633" face="Constantia"><strong>Achiments Category</strong> <small></small></font>       
              </header>
              <div class="panel-body">
        
           

                <form name="myform" method="POST" enctype="multipart/form-data">
                  
                  <div class="col-sm-3">
                    <label>Image</label>
                    <input type="file" name="image" class="form-control" placeholder="Image">
                  </div>


                  <div class="col-sm-3">
                    <label>Report Id</label>
                    <input type="text" name="name" class="form-control" placeholder="Report Id">
                  </div>

                  
                  <div class="col-sm-3">
                    <button class="btn btn-success" name="save" style="margin: 21px 0 0 0;" type="submit">Save</button>
                  </div>

                </form>


                 

                <style type="text/css">
                  table,tr,th,td{
                    border: 1px solid black;
                    border-collapse: collapse;
                  }
                  table{
                    width: 100%;
                    height: auto;
                  }
                </style>




         
              </div>
              </section>
              </div>
              </section>
              </div>
              </div>
              <!-- page end-->
          </section>
      </section>
     <?php require_once 'lib/_footer.php'; ?>
  </section>

    <!-- js placed at the end of the document so the pages load faster -->

    <script src="js/jquery.js"></script>
    <script src="js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="js/jquery-migrate-1.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="js/jquery.scrollTo.min.js"></script>
    <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
    <script type="text/javascript" language="javascript" src="assets/advanced-datatable/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="assets/data-tables/DT_bootstrap.js"></script>
    <script src="js/respond.min.js" ></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" ></script>

    <!--right slidebar-->
    <script src="js/slidebars.min.js"></script>

    <!--dynamic table initialization -->
    <script src="js/dynamic_table_init.js"></script>


    <!--common script for all pages-->
    <script src="js/common-scripts.js"></script>

  
  <script type="text/javascript">
    $(document).ready( function () {
    $('#myTable').DataTable();
} );
  </script>
  </body>

<!-- Mirrored from thevectorlab.net/flatlab/dynamic_table.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 21 Nov 2017 06:57:27 GMT -->
</html>
<?php 
  }
  else
  {
    header("Location:index");
    session_destroy();
  }
  @mysqli_free_result($LoginData);
@mysqli_close($link); ?>