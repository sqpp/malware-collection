<?php

if ($_SERVER['REQUEST_METHOD'] === 'GET') {
    die(':((((');
}

header('Content-Type: application/json');
if (!isset($_POST["token"]) || empty($_POST["token"]))
    die('{"Code":1,"CodeTranslate":"Authentication Failed :("}');

$token = $_POST["token"];
if ($token != '8780a3bfa40d57417958f766828268b0')
    die('{"Code":1,"CodeTranslate":"Authentication Failed :("}');

if (!isset($_POST["_catId"]) || empty($_POST["_catId"]))
    die('{"Code":2,"CodeTranslate":"No CatID Specfied :/"}');

$catid = $_POST["_catId"];


$servername = "localhost";
$username = "swagbuck_2";
$password = "321654987";
$dbname = "swagbuck_allkey";


$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn->connect_error) {
    die('{"Code":3,"CodeTranslate":"CONNECTION_ERROR :0"}');
}
mysqli_set_charset($conn, "utf8");

$sql = "select meta_value from `wp_postmeta` where post_id=(SELECT post_id FROM `wp_postmeta` WHERE meta_value='" . $catid . "') and meta_key='_price' limit 1";

$result = $conn->query($sql);

if ($result->num_rows > 0) {
    // output data of each row
    while ($row = $result->fetch_assoc()) {
        die('{"Code":0,"CodeTranslate":"DONE :)","Price":' . $row['meta_value'] . '}');
    }
} else {
    die('{"Code":4,"CodeTranslate":"PRODUCT_NOT_FOUND X_X"}');
}
