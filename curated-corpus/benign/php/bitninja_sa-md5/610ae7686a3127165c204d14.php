<?php
require_once('dbconnection.php');
if(isset($_SESSION['user_id'])=='')
 {
   header("Location:login.php");
 } 
$id = $_GET['id'];
$sql = "SELECT * FROM parks WHERE id='$id'";
$result_set =$conn->query($sql)->fetch(PDO::FETCH_ASSOC);
if($_SERVER['REQUEST_METHOD'] == 'POST')
{
   
   extract($_POST);
   $title = $_POST['title'];
    $video = $_POST['video'];
   $description = $_POST['description'];
    $short_description = $_POST['short_description'];
   $updateddate = date('Y-m-d');
   $file_name = $_FILES['filename']['name'];
   $im='';
   $image_upload='';
   $filename  = basename($_FILES['filename']['name']);
   $file_size = $_FILES['filename']['size'];
   $file_tmp  = $_FILES['filename']['tmp_name'];
   $file_ext= pathinfo($filename, PATHINFO_EXTENSION);
   $extension  = array("jpeg","jpg","png");
   $file_name= time()."_".$file_name;
         move_uploaded_file($file_tmp,"uploads/".$file_name);
               
               if(isset($file_name) && $file_name!=='')
               {
                  $im =$file_name;
               }
            
      
     
     if($_FILES['filename']['name']=='')
     {
        echo "old_image:$old_image";
        $image_upload = $old_image;
        echo "image_upload:$image_upload";
     }else{
        $image_upload = $im;
        echo "im:$image_upload";
     }
     
     if(isset($image_upload))
     {
       $sql = "UPDATE parks SET `image`='$image_upload',title='$title',video='$video',updated_at='$updateddate' WHERE id='$id'";
          $statement = $conn->prepare($sql);
                    
        if ($statement->execute() === TRUE)
          {
             $_SESSION['message']= "updated successfully";
           
            header("Location:parks_table.php");
            die();
                 
          }
    }
    else
     {
                 
        echo "message";
              
      }

}

?>
<?php include 'includes/header.php'; ?>
<section>
   <div class="container-fluid">
      <!-- <a type="button" style="margin-left:;"class="btn btn-info">ADD</a> -->
      <div class="row justify-content-center">
         <div class="col-md-10">

            <div class="card mb-12">
              
                 <div><a style="margin-left:90%;margin-top:13px;background-color:#132151;color: white;border-radius: 15px  15px;" class="btn btn-outline-secondary" href="parks_table.php"><i class="fal fa-chevron-left mr-1"></i>Back</a>
                  <div class="card-header">Park Update</div>
               </div>
               <div class="card-body">
                  <form action="" method="post" enctype="multipart/form-data">
                     <div class="row">
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Title</label>
                              <input type="hidden" name="old_image" value="<?php echo $result_set['image'];?>">
                              <input type="text" class="form-control" name="title" value="<?php echo $result_set["title"] ;?>" >
                           </div>
                        </div>
                        <div class="col-md-12">
                           <div class="form-group">
                           <label>Video</label>
                               <img style="width:500px;height:120px;" src="uploads/youtube.gif">
                              <input type="text" class="form-control" name="video"  value="<?php echo $result_set["video"] ;?>" >
                               <label><i style="color:red;">Note:Please follow the image</i></label>
                           </div>
                        </div>
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Image</label>
                              <img style="width:80px;height:80px;" src="uploads/<?php echo $result_set["image"];?>">
                              <input type="file" name="filename" class="form-control" id="filename" onchange="check_image_type_and_size(this.id);" >
                             
                              <label><i>Note: file size should be(357*223) and 
                                          file Extension should be(jpg,jpeg,png)</i>
                              </label>
                           </div>
                        </div>
                        <div class="col-12">
                           <button type="reset" class="btn btn-secondary">Reset</button>
                           <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                     </div>
                  </form>
               </div>
           </div>
      </div>
   </div>
</section>

<?php include 'includes/footer.php'; ?>