<?php
include "core.php";

if($_POST)
{
	$adi = $_POST['sl_adi'];
	$s_id= $_POST['sl_id'];
	$link= $_POST['sl_link'];
	$sl_sira = $_POST['sl_sira'];
	$sl_resim= $_POST['sl_resim'];
	
	if (empty($adi)){
	echo "Tüm boşlukları doldurun! <br /> <a href='slider_ayar.php'>Geri dön</a>";
	redirectw(5, "slider_ayar.php");
	include "_footer.php";
	exit;
	}
	
	$kaynak = $_FILES["resim"]["tmp_name"];  
	$dosya = $_FILES["resim"]["name"];
	$uzanti = explode(".", $_FILES["resim"]["name"]); 
	$random = rand(0,9999);
	$yeni_isim = $random."_".$dosya;
	$hedef  = "../img/slider/".$yeni_isim;
	$gitti=move_uploaded_file($kaynak,$hedef);
	
	if($dosya=="")
	$hedef=$sl_resim;
	
																   
	$sliderguncelle=SQL::query("UPDATE slider SET 		`slider_resim` = '$hedef', 
										`slider_baslik` = '$adi',
										`slider_link` = '$link',
										`slider_sira` = '$sl_sira'
										
										WHERE id = '$s_id'");
										
	
		if (!$sliderguncelle) 
		{
		logyaz(4, "Slider güncellenemedi.");
		hatamesaj();
		}else{
		echo "Güncellendi. <br /> <a href='slider_ayar.php'>Geri dön</a>";
		redirectw(1, "slider_ayar.php");
		require_once("_footer.php");
		exit; 
		}
}


if($_GET){
	$islem=$_GET['islem'];
	$id=$_GET['id'];
	$slider=SQL::getRow("SELECT * FROM slider WHERE id=$id");

	$sql_slideradi=$slider->slider_baslik;
	$sql_sliderlink=$slider->slider_link;
	$sql_sliderresim=$slider->slider_resim;
	$sql_slidersira=$slider->slider_sira;
	switch ($islem) {
		case "duzenle":
		?>
<ul class="breadcrumb">
	<li><a href="index.php">Panel</a></li>
	<li class="active">Kayan Resim Ayarları</li>
</ul>
			<form class="form-horizontal" action="sliderislem.php" method="post" enctype="multipart/form-data">
				<fieldset>
				<legend>Slider Güncelle</legend>
					<div class="form-group">
						<label for="sliderIsim" class="col-lg-1 control-label">Yazı</label>
						<div class="col-lg-10">
							<input type="text" class="form-control" id="sliderIsim" name="sl_adi" value="<?php echo $sql_slideradi; ?>" size="30" maxlength="120" required />
						</div>
					</div>
					<div class="form-group">
						<label for="sliderSira" class="col-lg-1 control-label">Sıra</label>
						<div class="col-lg-10">
							<input type="tel" class="form-control" id="sliderSira" name="sl_sira" value="<?php echo $sql_slidersira; ?>" size="30" maxlength="2" placeholder="1" required />
						</div>
					</div>
					<div class="form-group">
						<label for="sliderLink" class="col-lg-1 control-label">Link</label>
						<div class="col-lg-10">
							<input type="text" class="form-control" id="sliderLink" name="sl_link" value="<?php echo $sql_sliderlink; ?>" size="30" maxlength="150" placeholder="#" required />
						</div>
					</div>
					<div class="form-group">
						<label for="sliderResim" class="col-lg-1 control-label">Resim</label>
						<div class="col-lg-10">
							<input type="file" class="form-control" id="sliderResim"name="resim" />
						</div>
					</div>
					<input type="hidden" value="<?= $sql_sliderresim; ?>" name="sl_resim" />
					<input type="hidden" value="<?= $id; ?>" name="sl_id" />
					<div class="form-group">
						<div class="col-lg-10 col-lg-offset-1">
							<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-repeat"></span> Güncelle</button>
						</div>
					</div>

				</fieldset>
			</form>
		<?php
		break;
		
		
		case "aktif":
			$aktif=SQL::query("UPDATE slider SET `slider_durum` = '1' WHERE id = $id");

			if (!$aktif) 
			{
			hatamesaj();
			logyaz(4, "Slider aktif edilemedi");
			}else{
			redirect("slider_ayar.php");
			echo "Güncellendi. <br /> <a href='slider_ayar.php'>Geri dön</a>";
			require_once("_footer.php");
			exit; 
			}
		break;
		
		case "deaktif":
			$deaktif=SQL::query("UPDATE slider SET `slider_durum` = '0' WHERE id = $id");

			if (!$deaktif) 
			{
			hatamesaj();
			logyaz(4, "Slider deaktif edilemedi");
			}else{
			redirect("slider_ayar.php");
			echo "Güncellendi. <br /> <a href='slider_ayar.php'>Geri dön</a>";
			require_once("_footer.php");
			exit; 
			}
		break;
		
		default:
			redirect("slider_ayar.php");
		}
	}else{
		redirect("slider_ayar.php");
}
require_once("_footer.php");
?>


