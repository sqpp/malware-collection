<?php
session_start();
require 'class_file.php';
$user_id = $_SESSION['user']; $company_id = $_SESSION['company']; $session_id='NA'; $page_id=$_SESSION['page']; $modify_date=date('Y-m-d'); $modify_cause ='Updated';
$id=$_POST['id']; $ctn=$_POST['ctn']; $remark=$_POST['remark']; $type1=$_POST['type']; $order=$_POST['order']; $country=$_POST['country']; $pkgmde=$_POST['pkgmde']; 
$piece=$_POST['piece']; $piecewt=$_POST['pcwt']; $brandid=$_POST['brand']; $pkgdate=$_POST['pkgdate']; $pkgins=$_POST['pkginsid']; $stdwt=$_POST["stdwt"]; 
$tot_wt=$_POST["tot_wt"]; if($stdwt=='No') $unit_weight='NSW'; else $unit_weight=$_POST["unit"]; $exdate=$_POST["expdate"]; $produnit=$_POST["prdunit"];
if($id !='' && $unit_weight !=''  && $ctn !='' && $tot_wt !=''){
$conn->beginTransaction();
try {
 
$row=$ord_query->crr_loading_delete_item_data($conn,$id);
$pkid=$row['pk_pro_ord_loainsitem_id']; $cmpid=$row['fk_cnf_company_id']; $ssid=$row['fk_cnf_session_id']; $pkginsid=$row['fk_pro_ord_packinginstruc_id'];
$loadid=$row['fk_pro_ord_loadingins_id']; $item=$row['fk_pro_mtm_item_code']; $brand=$row['fk_pro_mtm_brand_id']; $ctn_weight=$row['unit_weight'];
$carton=$row['total_units']; $tot_wt1=$row['total_weight']; $prdunit=$row['production_unit']; $cntrid=$row['fk_pro_ord_container_id']; $remark1=$row['item_remark']; 
$country1=$row['order_country']; $status=$row['transaction_status']; $ins_by=$row['ins_by']; $ins_date1=$row['ins_date']; $ins_time=$row['ins_time']; 
$device=$row['ins_device']; $ins_ip=$row['ins_ip']; $update_by=$row['update_by']; $update_date=$row['update_date']; $update_time=$row['update_time']; 
$update_ip=$row['update_ip']; $orderid=$row['fk_pro_ord_cusorder_id']; $pkgmodeid=$row['fk_pro_pcm_packingtype_id']; $piece_no=$row['piece_no']; $pcwt=$row['piece_weight'];
$ordtype=$row['order_type']; $store=$row['fk_pro_pcm_coldstorage_id']; $section=$row['fk_pro_pcm_storagesection_id']; $pdate=$row['packing_date']; $expdate=$row['expiry_date'];

$result1 = $ord_query->insert_pro_loading_tns_delt_item($conn,$cmpid,$ssid,$pkid,$orderid,$loadid,$item,$brand,$ctn_weight,$carton,$tot_wt1,$pkginsid,$prdunit,$remark1,$country1,$status,$ins_by,$ins_date1,$ins_time,$device,$ins_ip,$update_by,$update_date,$update_time,$update_ip,$user_id,$modify_date,$modify_cause,$cntrid,$pkgmodeid,$piece_no,$pcwt,$ordtype,$store,$section,$pdate,$expdate,$reftp);

$result = $ord_query->update_pro_loading_item($conn,$id,$unit_weight,$ctn,$tot_wt,$exdate,$remark,$type1,$order,$country,$pkgmde,$piece,$piecewt,$brandid,$pkgdate,$pkgins,$produnit,$user_id,$ins_date,$ip);

$conn->commit();
echo "1";
}catch(PDOException $e){
$conn->rollBack();
echo "3"; }
} else echo "0";
?>