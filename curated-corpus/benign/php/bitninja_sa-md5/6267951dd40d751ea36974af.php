<?php

/*ini_set('session.save_path', 'tmp');

ob_start();

session_start();*/

ini_set('session.save_path', 'files');

session_save_path('../../tmp/');

session_start();

include '../db/conn.php';

	

if(empty($_SESSION['admn_id'])){

	header('Location: index.php');

}



?>



<?php

function add_projects(){

	if(isset ($_POST['add_project'])){

		$pro_category = addslashes($_POST['pro_category']);

		$pro_section = addslashes($_POST['pro_section']);

		$pro_unit = addslashes($_POST['pro_unit']);

		$pro_name = addslashes($_POST['pro_name']);

		$pro_client = addslashes($_POST['pro_client']);

		$pro_status = addslashes($_POST['pro_status']);

		$pro_sum = addslashes($_POST['pro_sum']);

		$pro_commencement = addslashes($_POST['pro_commencement']);

		$pro_complete = addslashes($_POST['pro_complete']);

		$pro_duration = addslashes($_POST['pro_duration']);

		$pro_contract = addslashes($_POST['pro_contract']);

		$pro_location = addslashes($_POST['pro_location']);
		
		$pro_description = addslashes($_POST['pro_description']);

		$pro_vname = addslashes($_POST['pro_vname']);

		$pro_vlink = addslashes($_POST['pro_vlink']);



		$pro_img1_name = $_FILES['pro_img_one']['name'];

		$pro_img1_tem_name = $_FILES['pro_img_one']['tmp_name'];

		$pro_img1_type = explode(".",$pro_img1_name);

		$pro_img1_new_name = "cesl_project_img_one"."_".rand(1,100000)."_"."cesl"."_".rand(1,100000)."_"."project".".".end($pro_img1_type); 

		

		$pro_img2_name = $_FILES['pro_img_two']['name'];

		$pro_img2_tem_name = $_FILES['pro_img_two']['tmp_name'];

		$pro_img2_type = explode(".",$pro_img2_name);

		$pro_img2_new_name = "cesl_project_img_two"."_".rand(1,100000)."_"."cesl"."_".rand(1,100000)."_"."project".".".end($pro_img2_type); 

		

		$pro_img3_name = $_FILES['pro_img_three']['name'];

		$pro_img3_tem_name = $_FILES['pro_img_three']['tmp_name'];

		$pro_img3_type = explode(".",$pro_img3_name);

		$pro_img3_new_name = "cesl_project_img_three"."_".rand(1,100000)."_"."cesl"."_".rand(1,100000)."_"."project".".".end($pro_img3_type); 

		

		$pro_img4_name = $_FILES['pro_img_four']['name'];

		$pro_img4_tem_name = $_FILES['pro_img_four']['tmp_name'];

		$pro_img4_type = explode(".",$pro_img4_name);

		$pro_img4_new_name = "cesl_project_img_four"."_".rand(1,100000)."_"."cesl"."_".rand(1,100000)."_"."project".".".end($pro_img4_type); 

		

		if ($pro_status == "Completed"){

			$pro_img1_location = "../images/projects/completed/";

			$pro_img1_db_path = "images/projects/completed/".$pro_img1_new_name;

			

			$pro_img2_location = "../images/projects/completed/";

			$pro_img2_db_path = "images/projects/completed/".$pro_img2_new_name;

			

			$pro_img3_location = "../images/projects/completed/";

			$pro_img3_db_path = "images/projects/completed/".$pro_img3_new_name;

			

			$pro_img4_location = "../images/projects/completed/";

			$pro_img4_db_path = "images/projects/completed/".$pro_img4_new_name;

		}

		else{

			$pro_img1_location = "../images/projects/ongoing/";

			$pro_img1_db_path = "images/projects/ongoing/".$pro_img1_new_name;

			

			$pro_img2_location = "../images/projects/ongoing/";

			$pro_img2_db_path = "images/projects/ongoing/".$pro_img2_new_name;

			

			$pro_img3_location = "../images/projects/ongoing/";

			$pro_img3_db_path = "images/projects/ongoing/".$pro_img3_new_name;

			

			$pro_img4_location = "../images/projects/ongoing/";

			$pro_img4_db_path = "images/projects/ongoing/".$pro_img4_new_name;

		}

	if(empty($pro_category) || empty($pro_section) || empty($pro_name) || empty($pro_img1_name) || empty($pro_img2_name) || empty($pro_img3_name) || empty($pro_img4_name)){

		echo '<p style="color:#F00; text-align:center;">* Fields Are Require</p>';

		return false;

	}else{

			mysql_query("insert into projects values (

			'',

			'$pro_category',

			'$pro_section',

			'$pro_unit',

			'$pro_name',

			'$pro_client',

			'$pro_sum',

			'$pro_status',

			'$pro_commencement',

			'$pro_complete',

			'$pro_duration',

			'$pro_contract',

			'$pro_location',
			
			'$pro_description',

			'$pro_img1_db_path',

			'$pro_img2_db_path',

			'$pro_img3_db_path',

			'$pro_img4_db_path',

			'$pro_vname',

			'$pro_vlink'

			)");

			

			move_uploaded_file($pro_img1_tem_name, $pro_img1_location.$pro_img1_new_name);

			move_uploaded_file($pro_img2_tem_name, $pro_img2_location.$pro_img2_new_name);

			move_uploaded_file($pro_img3_tem_name, $pro_img3_location.$pro_img3_new_name);

			move_uploaded_file($pro_img4_tem_name, $pro_img4_location.$pro_img4_new_name);

			echo '<p style="text-align:center;" class="text-success">*** Project Added Successfully ***</p>';

			

		}
	

	}
	

}



?>



<!DOCTYPE html>

<html lang="en">

  <head>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="">

    <meta name="author" content="">



    <title>CESL Admin | Upload Project Details</title>

	<link rel="shortcut icon" href="../images/favicon.png">

    <!-- Bootstrap core CSS -->

    <link href="css/bootstrap.css" rel="stylesheet">



    <!-- Add custom CSS here -->

    <link href="css/sb-admin.css" rel="stylesheet">

    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">

    <!-- Page Specific CSS -->

    <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.4.3.min.css">

    <link rel="stylesheet" href="css/style.css">

  </head>



  <body style="height:850px;">



    <div id="wrapper">



      <!-- Sidebar -->

     <?php include "../include/headerAdmin.php"; ?>



      <div id="page-wrapper">



        <div class="row">

          <div class="col-lg-12" style="margin-top:5%;">

            <h1>Upload  / Edit <small>Projects</small></h1>

            <ol class="breadcrumb">

              <li><a href="home.php"><i class="fa fa-dashboard"></i> Dashboard</a></li>

              <li class="active"><i class="fa fa-upload"></i> Upload Projects</li>

            </ol>

            

          </div>

        </div><!-- /.row -->



        <div class="row">

          <div class="col-lg-12">

            <h3 style="font-weight:bold; text-shadow:1px 1px 1px #fff;"><i class="fa fa-upload"></i> Upload Projects to Website</h2>

  

            <div class="panel panel-primary col-lg-9">

             <form action="" method="post" enctype="multipart/form-data" style="padding-left:20px" id="uploadForm">

                    <fieldset>

                        

                            <p> <?php add_projects() ?> </p>

                            <div class="form-group col-lg-6" style="margin-top:15px;">

                                <label>Project Category *</label> <span style="color:#F30"> Select Corrrect Category</span>

                                	<select name="pro_category" class="form-control" style="width:200px" required>

                                      <option value="Buildings">Buildings</option>

                                      <option value="Roads">Roads</option>

                                      <option value="Bridges and Culverts">Bridges and Culverts</option>

                                      <option value="Irrigation Structures">Irrigation Structures</option>

                                      <option value="Other Special Projects">Other Special Projects</option>

                                	</select>

                                    

              				</div>

                            

                            <div class="form-group col-lg-6" style="margin-top:15px;">

                                <label>COE Section *</label> <span style="color:#F30"> Select Corrrect Section</span>

                                	<select name="pro_section" class="form-control" style="width:200px" required>

                                     	<?php

										$getSection = mysql_query("SELECT * FROM section"); 

										while($nameSection = mysql_fetch_array($getSection)){
					
										?>


                                      <option value="<?php echo $nameSection['sec_section'] ?>"><?php echo $nameSection['sec_section'] ?></option>

                                      <?php

									  }

									  ?>

                                	</select>
                         

              				</div>

                            

                            <div class="form-group col-lg-6">

                                <label>SOE Unit</label><br/>

                                <input type="text" name="pro_unit">

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Project Name *</label>

                                <input type="text" name="pro_name" style="width:100%;" required> 

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Client</label><br/>

                                <input type="text" name="pro_client">

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Current Status *</label><span style="color:#F30"> Select Corrrect Status</span>

                                <select name="pro_status" class="form-control" style="width:200px" required>

                                      <option value="Completed">Completed</option>

                                      <option value="Ongoing">Ongoing</option>

                                </select>

                            </div>

                            

                            <div class="form-group col-lg-4">

                                <label>Contract Sum</label>

                                <input type="text" name="pro_sum">

                            </div>

                            

                            <div class="form-group col-lg-4">

                                <label>Commencement Date</label>

                                <input type="date" name="pro_commencement">

                            </div>

                            

                            <div class="form-group col-lg-4">

                                <label>Completion Date</label>

                                <input type="date" name="pro_complete">

                            </div>

                            

                            <div class="form-group col-lg-4">

                                <label>Duration</label>

                                <input type="text" name="pro_duration">

                            </div>

                            

                            <div class="form-group col-lg-4">

                                <label>Type of Contract</label>

                                <select name="pro_contract" class="form-control" style="width:220px">

                                      <option value="Assigned through CECB">Assigned through CECB</option>

                                      <option value="Assigned directly to CESL">Assigned directly to CESL</option>

                                      <option value="On Tender">On Tender</option>

                                </select>

                            </div>

                            

                            <div class="form-group col-lg-4">

                                <label>Location</label>

                                <input type="text" name="pro_location">

                               

                            </div>
                           <div style="clear:both;"></div> 
                            <div class="form-group col-lg-12">

                                <label>Project Description</label>
                                
                                <textarea rows="4" cols="50" name="pro_description" style="width:100%">
</textarea>

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Project Image1 *</label>

                                <span style="color:#f00;">(Size should be 900x700 pixels)</span>

                                <input type="file" name="pro_img_one" id="file" required><br>
  

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Project Image2 *</label>

                                <span style="color:#f00;">(Size should be 900x700 pixels)</span>

                                <input type="file" name="pro_img_two" id="file2" required><br>

                            </div>

                           

                           	<div class="form-group col-lg-6">

                                <label>Project Image3 *</label>

                                <span style="color:#f00;">(Size should be 900x700 pixels)</span>

                                <input type="file" name="pro_img_three" id="file3" required><br>   

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Project Image4 *</label>

                                <span style="color:#f00;">(Size should be 900x700 pixels)</span>

                                <input type="file" name="pro_img_four" id="file4" required><br>
  

                            </div>

                            <div style="clear:both;"></div>

                            <div class="form-group col-lg-6">

                                <label>Video Name</label>

                                <input type="text" name="pro_vname">  

                            </div>

                            

                            <div class="form-group col-lg-6">

                                <label>Video Link</label>

                                <input type="text" name="pro_vlink">

                            </div>

                            <div style="clear:both;"></div>

                            <div class="form-group col-lg-12" style="padding-bottom:20px;">

                            	<input id="add_pro" type="submit" name="add_project" value="Upload Project"/>

                      		</div>

                    </fieldset>

                </form>
           

            </div>

          </div>

        </div><!-- /.row -->

		

        <div class="row" style="margin-top:20px;">

          <div class="col-lg-12">

           

            <h3 style="font-weight:bold; text-shadow:1px 1px 1px #fff;"><i class="fa fa-pencil-square"></i> Edit Projects from the Website</h3>

  

            <div class="panel panel-primary" style="padding-left:20px" id="edit_bottom_slider">

           	  <div class="form-group">

                

                                <label style="margin-top:20px;">Select The Category You Want To Edit</label>

                                    	<?php

											$getproCategory = @$_GET['procat'];

											$quary1 = "select * from category";

											$result = mysql_query ($quary1) ;

											while ($gal_rows = mysql_fetch_array($result)){

											 ?>

                                     <a href="upload_projects.php?procat=<?php echo stripslashes($gal_rows['cat_category']); ?>#projects"> <option value=""><?php echo $gal_rows['cat_category']; ?></option></a>

                                      

                                      <?php } ?>

                                	

               </div>

              <div class="table-responsive">

              <table class="table table-bordered table-hover tablesorter" id="projects">

                <tr>

                    <th>Project Category</th>

                    <th>COE Section</th>

                    <th>SOE Unit</th>

                    <th>Project Name</th>

                    <th>Image</th>

                    <th>Action</th>

                </tr>

				 <?php 

                 						$getproCategory = @$_GET['procat'];


                 $select_cols = mysql_query("select * from projects where pro_cat ='$getproCategory'");

                 while($cols_row = mysql_fetch_array($select_cols)){ ?>

                        <tr>

                            <td style="width:10%"><p><?php echo  stripslashes($cols_row['pro_cat']);?></p></td>

                            <td style="width:10%"><p><?php echo  stripslashes($cols_row['pro_sec']);?></p></td>

                            <td style="width:10%"><p><?php echo  stripslashes($cols_row['pro_unit']);?></p></td>

                            <td style="width:59%"><p><?php echo  stripslashes($cols_row['pro_name']);?></p></td>

                            <td style="width:5%"><img src="../<?php echo  $cols_row['pro_img_one'];?>" width="70px"/></td>

                            <td style="width:6%"><a href="edit_projects.php?project_id=<?php echo stripslashes($cols_row['pro_id']); ?>&&procat=<?php echo  stripslashes($cols_row['pro_cat']);?>"><i class="fa fa-pencil-square-o"></i> Edit</a></td>

                        </tr>
        

                    <?php  } ?>      
                

              </table> 
       

            	</div>

             </div>  				

          </div>

       	</div><!--row-->

      </div><!-- /#page-wrapper -->

    </div><!-- /#wrapper -->



    <!-- JavaScript -->

    <script src="js/jquery-1.10.2.js"></script>

    <script src="js/bootstrap.js"></script>


    <!-- Page Specific Plugins -->

    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>

    <script src="http://cdn.oesmith.co.uk/morris-0.4.3.min.js"></script>

    <script src="js/morris/chart-data-morris.js"></script>

    <script src="js/tablesorter/jquery.tablesorter.js"></script>

    <script src="js/tablesorter/tables.js"></script>

	<script src="js/flot/jquery.flot.js"></script>

	<script src="js/flot/jquery.flot.tooltip.min.js"></script>

	<script src="js/flot/jquery.flot.resize.js"></script>

	<script src="js/flot/jquery.flot.pie.js"></script>

	<script src="js/flot/chart-data-flot.js"></script>


  </body>

</html>