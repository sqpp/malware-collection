<?php include 'header3.php'; 
if(isset($_POST['add_category'])){
	 		$name 	= $_POST['name'];
	 		$sql="INSERT INTO blogs_category(name) VALUES('".$name."')";
 		    $exe = mysqli_query($conn,$sql);
 		    if($exe){
 		    $cat_success= 'Category added successfully';
 		    }else{
 		    $cat_error= 'Category could not added';

 		    }

}
if(isset($_POST['update_category'])){
	$id=$_POST['id'];
	 		$name 	= $_POST['name'];
	 		$sql="UPDATE blogs_category set name='".$name."' WHERE id='".$id."'";
	        $exe=mysqli_query($conn,$sql);
 		    if($exe){
 		    $cat_success= 'Category updated successfully';
 		    }else{
 		    $cat_error= 'Category could not updated';

 		    }

}
 	if(isset($_POST['submit'])){
 	 
 		$category_id 	= $_POST['category_id'];
 		$date 	= $_POST['date'];  
 		$title1 	= $_POST['title1'];  
 		$title2 	= $_POST['title2'];  
 		$heading 	= mysqli_escape_string($conn,$_POST['heading']);
//  		print_r($heading);
//  		die();
 		$description= mysqli_escape_string($conn,$_POST['description']);
 		
 		$description1=html_entity_decode($description);
 		$short_description= mysqli_escape_string($conn,$_POST['short_description']);
 		
 		$short_description1=html_entity_decode($short_description);
 		$fn 		= $_FILES['image']['name'];
 		
 	    $fnUP = true;
 		$pdfu = $fnu = $exe = false;
 		$filename = $pdf1 = '';
 		
    	if(!empty($_FILES['image']['name'])){
    		$imageExt = explode('.', $fn);
	 		$filename = time().'.'.$imageExt[1];
   			$picpath="blogs/".$filename;
    		if(move_uploaded_file($_FILES["image"]["tmp_name"],$picpath)){
    			$fnu = true;
    		}else{
    			$fn = false;
    		}
    	}
 		if($fnUP == true){
 			$sql="INSERT INTO blogs(category_id,date,name,title1,title2,short_description,description,images) VALUES('".$category_id."','".$date."','".$heading."','".$title1."','".$title2."','".$short_description1."','".$description1."','".$filename."')";
 		  // print_r("INSERT INTO blogs(category_id,name,short_description,description,images) VALUES('".$category_id."','".$heading."','".$short_description1."','".$description1."','".$filename."')");
 			
	        $exe = mysqli_query($conn,$sql);
	        if($exe){
	 			$success= 'Successful Inserted Data';
			} else{
	 			$error = 'Unsuccessful Inserted Data';
			}
 		}

 		if($exe){
 			$success= 'Successful Inserted Data';
 		} else{
 			$error = 'Unsuccessful Inserted Data';
 		}	
 	}
 	if (isset($_POST['update'])) {
 		$id=$_POST['id'];
 		$category_id=mysqli_escape_string($conn,$_POST['category_id']);
 		$date=$_POST['date'];
 		$title1 = $_POST['title1'];  
 		$title2 = $_POST['title2'];  
 	
 		$heading=mysqli_escape_string($conn,$_POST['heading']);
 		$description=mysqli_escape_string($conn,$_POST['description']);
 		$description1=html_entity_decode($description);
 		$short_description=mysqli_escape_string($conn,$_POST['short_description']);
 		$short_description1=html_entity_decode($short_description);
 		$fn=$_FILES['image']['name'];
 	
 		$pdfUP = $fnUP = true;
 		$pdfu = $fnu = $exe = false;
 		$filename = $pdf1 = '';
 		$sql = "SET category_id='".$category_id."',date='".$date."',name='".$heading."',title1='".$title1."',title2='".$title2."',short_description='".$short_description1."',description='".$description1."'";
 	
    	if(null !== $_FILES['image']['name']){
			$imageExt = explode('.', $fn);
	 		$filename = time().'.'.$imageExt[1];
   			$picpath="blogs/".$filename;
    		if(move_uploaded_file($_FILES["image"]["tmp_name"],$picpath)){
    			$fnu = true;
    			$sql .= ", images='".$filename."'";
    		}else{
    			$fn = false;
    		}
    	}
 		if($fnUP == true){
 			$sql12 = mysqli_query($conn,"SELECT * FROM blogs WHERE id='".$id);
			$res = mysqli_fetch_assoc($sql12);
 			$sql="UPDATE blogs ".$sql." WHERE id='".$id."'";
 			print_r("UPDATE blogs ".$sql." WHERE id='".$id."'");
	        $exe=mysqli_query($conn,$sql);
			if($exe){
	 			$success= 'Successful Updated Data';
			}else{
	 			$error = 'Unsuccessful Updated Data';
			}
	 	}

 	}

?>
<script language="javascript" type="text/javascript">


function delete_blogs_category(id){


	if(confirm('Are you sure to delete this category.'))


	window.location.href='action.php?loc=<?php echo base64_encode('add_blogs.php')?>&action=delete_blogs_category&id='+id;


	}


</script>

	<!-- Main content -->
			<div class="content-wrapper">

				<!-- Page header -->
				<div class="page-header page-header-default">
					<div class="page-header-content">
						<div class="page-title">
							<h4><i class="icon-arrow-left52 position-left"></i> <span class="text-semibold">Home</span> - Add Blogs  </h4>
						</div>
					</div>

					<div class="breadcrumb-line">
						<ul class="breadcrumb">
							<li><a href="index.php"><i class="icon-home2 position-left"></i> Home</a></li>
							<li class="active">Add Blogs</li>
						</ul>

					</div>
				</div>
				<!-- /page header -->
				<div class="content">

					<!-- Vertical form options -->
					<div class="row">
					<!-- cat start -->
						<?php 
								if(isset($_REQUEST['action'])=='cat_edit' && isset($_REQUEST['id'])!=''){
									$id=$_REQUEST['id'];
									$sql1=mysqli_query($conn,"SELECT * FROM blogs_category WHERE id='".$id."'");
									$res1=mysqli_fetch_assoc($sql1);
									
							?>
					 <form action="#" method="POST">
								<div class="panel panel-flat">
									<div class="panel-heading">
									  <h5 class="panel-title">Add Category </h5>
									  <?php if(isset($cat_success)){
									  		echo '<h2 style="color : green;"> '.$cat_success.'</h2>';
									  }
									  if(isset($cat_error)){
									  	    echo '<h2 style="color : red;">'.$cat_error.'</h2>';
									  }
									  ?>
									</div>
								<div class="panel-body">
									<div class="col-md-6">
										<div class="form-group">
											<label> Name :</label>
											<input type="hidden" value="<?php echo $id ?>" name="id" >
											<input type="text" name="name" id="name" class="form-control" placeholder="Enter Category" value="<?php echo $res1['name']; ?>" >
										</div>
										 <div class="text-right">
											<button  name="update_category" type="submit" class="btn btn-primary" >Submit form <i class="icon-arrow-right14 position-right"></i></button>
										</div>
										
									</div>
									</form>
									<?php }else{ ?>
										 <form action="#" method="POST">
								<div class="panel panel-flat">
									<div class="panel-heading">
									  <h5 class="panel-title">Add Category </h5>
									  <?php if(isset($cat_success)){
									  		echo '<h2 style="color : green;"> '.$success.'</h2>';
									  }
									  if(isset($cat_error)){
									  	    echo '<h2 style="color : red;">'.$error.'</h2>';
									  }
									  ?>
									</div>
								<div class="panel-body">
									<div class="col-md-6">
										<div class="form-group">
											<label> Name :</label>
											<input type="text" name="name" id="name" class="form-control" placeholder="Enter Category">
										</div>
										 <div class="text-right">
											<button  name="add_category" type="submit" class="btn btn-primary" >Submit form <i class="icon-arrow-right14 position-right"></i></button>
										</div>
										
									</div>
									</form>
									<?php } ?>
									 <div class="col-md-6">
									 	<table class="table datatable-show-all">
							<thead>
								<tr>
									<th>SR No</th>
									<th>Category</th>
 								
								    <th class="text-center">Actions</th>
								</tr>
							</thead>
							<tbody>
								<?php 
								$i=1;
									$sql=mysqli_query($conn,"SELECT * FROM blogs_category");
									while($res=mysqli_fetch_assoc($sql)){
										
										///print_r($res1);

								?>
								<tr>
									<td><?php echo $i++; ?></td>
									 <td><?php echo $res['name']; ?></td> 
 									
									<td><a href="add_blogs.php?action=cat_edit&id=<?php echo $res['id']; ?>" title="Edit Category" ><i class="icon-pencil3"></i></a> | <a onClick="javascript:delete_blogs_category('<?php echo base64_encode($res['id']);?>')" title="Delete Category" ><i class="icon-trash" ></i></a></td>
									
								</tr>
								<?php } ?>
							</tbody>
						</table>
									 
									   
							    	</div>
										
										
									</div>
								</div>
							
					<!-- cat end -->
							<?php 
								if(isset($_REQUEST['action'])=='edit' && isset($_REQUEST['id'])!=''){
									$id=$_REQUEST['id'];
									$sql1=mysqli_query($conn,"SELECT * FROM blogs WHERE id='".$id."'");
									$res1=mysqli_fetch_assoc($sql1);
									
							?>
							<form method="POST"  enctype="multipart/form-data" action="<?php echo $_SERVER['PHP_SELF'];?>">
								<div class="panel panel-flat">
									<div class="panel-heading">
									  <h5 class="panel-title">Edit Blogs</h5>
									  <?php if(isset($success)){
									  		echo '<h2 style="color : green;"> '.$success.'</h2>';
									  }
									  if(isset($error)){
									  	    echo '<h2 style="color : red;">'.$error.'</h2>';
									  }
									  ?>
									</div>
								<div class="panel-body">
									<div class="col-md-6">
										<div class="form-group">
											<label>Tab :</label>
											<!-- <input type="text" name="title" class="form-control" placeholder="Enter Title"> -->
											<select class="form-control" name="category_id">
												<option value="0">-----Select Category----</option>
												<?php $sql=mysqli_query($conn,"SELECT * FROM blogs_category");
												      while($res=mysqli_fetch_assoc($sql)){ ?>
												<option value="<?php echo $res['id']; ?>" <?php if($res['id']==$res1['category_id']){ echo 'selected="selected"'; } ?> ><?php echo $res['name']; ?></option>
												<?php } ?>
											</select>
											<input type="hidden" name="id" value="<?php echo $_REQUEST['id']?>">
										</div>
										
										
										<div class="form-group">
											<label>Heading :</label>
											<input type="text" name="heading" class="form-control" value="<?php echo $res1['name']; ?>">
										</div>
										
										<div class="form-group">
											<label>Title1 :</label>
											<input type="text" name="title1" class="form-control" value="<?php echo $res1['title1']; ?>">
										</div>
										
										<div class="form-group">
											<label>Title2 :</label>
											<input type="text" name="title2" class="form-control" value="<?php echo $res1['title2']; ?>">
										</div>
										
										
										<div class="form-group">
											<label>Date :</label>
										<input type="date" name="date"  class="form-control"  value="<?php echo $res1['date']; ?>">
										</div>
									
										<div class="form-group">
											<label>Add Picture:</label>
											<input type="file" name="image" class="file-styled imageEdit" value="<?php echo $res1['images']; ?>">
											<span class="help-block">Accepted formats: gif, png, jpg, jpeg. Max file size  1Mb</span>
											<?php
												$display= 'none';
												if(!empty($res1['images'])){ 
													$display= 'block';
												} 
											?>
											<img class="imageEditPreview" style="display:<?php echo($display); ?>;" src="<?php echo "blogs/".$res1['images']; ?>" alt="your image" width="180px"  height="180px" />
										</div>
										
										<div class="form-group">
											<label>Short Description:</label>
											<div class="panel-body">

											 <textarea id="short_description" name="short_description" rows="15" cols="80"><?php echo $res1['short_description'];?></textarea>
										    </div>
									    </div>
									</div>
								<div class="col-md-6">
									
										<div class="form-group">
											<label>Description:</label>
											<div class="panel-body">

											 <textarea id="description" name="description" rows="15" cols="80"><?php echo $res1['description'];?></textarea>
										    </div>
									    </div>
									    <div class="text-right">
											<button type="submit" name="update" class="btn btn-primary">Submit form <i class="icon-arrow-right14 position-right"></i></button>
										</div>
								</div>
										
										
									</div>
							</form>
							<?php } else{ ?>
							<!-- Basic layout-->

                           <!-- category start -->

                              <!-- category end -->


							<form action="#" method="POST"  enctype="multipart/form-data">
								<div class="panel panel-flat">
									<div class="panel-heading">
									  <h5 class="panel-title">Add Pages</h5>
									  <?php if(isset($success)){
									  		echo '<h2 style="color : green;"> '.$success.'</h2>';
									  }
									  if(isset($error)){
									  	    echo '<h2 style="color : red;">'.$error.'</h2>';
									  }
									  ?>
									</div>
								<div class="panel-body">
									<div class="col-md-6">
										<div class="form-group">
											<label>Category :</label>
											
											<select class="form-control" id="" name="category_id">
												<option value="0">-----Select Category----</option>
												<?php $sql=mysqli_query($conn,"SELECT * FROM blogs_category ");
												      while($res=mysqli_fetch_assoc($sql)){ ?>
												<option value="<?php echo $res['id']; ?>"><?php echo $res['name']; ?></option>
												<?php } ?>
											</select>
										</div>
									
										<div class="form-group">
											<label> Name :</label>
											<input type="text" name="heading" class="form-control" placeholder="Enter Title 1">
										</div>
										
											<div class="form-group">
											<label> Title 1  :</label>
											<input type="text" name="title1" class="form-control" placeholder="Enter Title 2">
										</div>
										
											<div class="form-group">
											<label> Title 2 :</label>
											<input type="text" name="title2" class="form-control" placeholder="Enter Heading">
										</div>
										
										
											<div class="form-group">
											<label> Date :</label>
											<input type="date" name="date" class="form-control" placeholder="Date">
										</div>
										
										
										<div class="form-group">
											<label>Add Picture:</label>
											<input type="file" name="image" class="file-styled imageUpload">
											<span class="help-block">Accepted formats: gif, png, jpg, jpeg. Max file size  1Mb</span>
											<img class="imageUploadPreview" style="display:none;" src="#" alt="your image" width="180px"  height="180px" />
										</div>
										<div class="form-group">
        									<label>Short Description:</label>
        									<div class="panel-body">
        									  <textarea id="short_description" name="short_description" rows="15" cols="80"></textarea>
        									 </div>
							            	</div>
										
									</div>
									 <div class="col-md-6">
									 	
										<div class="form-group">
        									<label>Description:</label>
        									<div class="panel-body">
        									  <textarea id="description" name="description" rows="15" cols="80"></textarea>
        									 </div>
							            	</div>
									    <div class="text-right">
											<button type="submit" id="submitData" name="submit" class="btn btn-primary">Submit form <i class="icon-arrow-right14 position-right"></i></button>
										</div>
							    	</div>
										
										
									</div>
								</div>
							</form>
							<?php } ?>
							<!-- /basic layout -->

						</div>

						
					</div>
<?php include 'footer.php'; ?>
<script>
	function readURL(input,divType) {
	  	if (input.files && input.files[0]) {
		    var reader = new FileReader();
		    reader.onload = function(e) {
		      	$('.'+divType+'Preview').attr('src', e.target.result);
		    }
		    reader.readAsDataURL(input.files[0]);
		    $('.'+divType+'Preview').show();
	  	}
	}

	$(".imageUpload").change(function() {
	  	readURL(this,'imageUpload');
	});

	$(".imageEdit").change(function() {
	  	readURL(this,'imageEdit');
	});
</script>
<script type="text/javascript">
    
	$('#main_tab').change(function(){
		var id=$(this).val();
		 $.ajax({  
            url:"ajax/category.php",  
            method:"POST", 
           // dataType: 'JSON', 
            data:{id:id},  
            success:function(data){
             // console.log(data);
            
             $('#category').html(data); 
              
           }  
         });
	
	});
	$('#category').change(function(){
		var id=$(this).val();
		//alert(id);
		 $.ajax({  
            url:"ajax/sub_category.php",  
            method:"POST", 
           // dataType: 'JSON', 
            data:{id:id},  
            success:function(data){
             $('#sub_category').html(data); 
              
           }  
         });
	
	});


</script>
