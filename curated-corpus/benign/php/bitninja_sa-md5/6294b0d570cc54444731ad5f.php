<?php include('session.php');

 
	if (isset($_POST['sign_up'])){

    $sql = $conn->prepare("INSERT INTO  photos (photo,caption,album) VALUES (?,?,?)");  

    $photo = 'photo' . date('Y-m-d-H-i-s') . '_' . uniqid() . '.jpg';
    move_uploaded_file($_FILES["photo"]["tmp_name"], "../midea/photos/" . $photo);
    $caption = $_POST['caption'];
    $album = $_POST['album'];
  
  
  
    $sql->bind_param("sss", $photo,$caption,$album); 
      
      if($sql->execute()) {
  
        echo ("<script LANGUAGE='JavaScript'>
        window.alert('Succesfully Uploaded');
        window.location.href='photo_upload.php';
        </script>");
  
      }
    }
    
    include('header.php');
 

?>

<script type="text/javascript">
  function remove(id) {
    if (confirm(' Sure to remove this photo ? ')) {
      window.location = 'photo_delete.php?remove_id=' + id;
    }
  }
</script>


<div class="container">

  <div class="mt-4 page-title">
    Dashboard <i class="fas fa-angle-right"></i> Media <i class="fas fa-angle-right"></i> Photo Upload
  </div>

  <form name="sign_up" enctype="multipart/form-data" method="post">
    <div class="card mb-4">
      <div class="card-body">
        <form name="sign_up" enctype="multipart/form-data" method="post">
          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label> Caption:</label>
                <input name="caption" type="text" autofocus required class="form-control" id="title" pattern="[^&lt;&gt;,]+" tabindex="1" size="50" />
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label> Album</label>
                <select class="form-control" name="album" required>
                  <option>---</option>
                  <?php
                  $sql = "SELECT * FROM photo_album";
                  $result = $conn->query($sql);

                  if ($result->num_rows > 0) {
                    while ($category = $result->fetch_assoc()) {
                  ?>
                      <option value="<?php echo $category["title"]; ?>"><?php echo $category["title"]; ?></option>
                  <?php
                    }
                  }
                  ?>
                </select>
              </div>
            </div>
            <div class="col-md-7">
              <div class="form-group">
                <label> Photo:</label>
                <input name="photo" type="file" required class="form-control" id="f" tabindex="11" onchange="ValidateSingleInput(this);" accept=".jpg,.png" />
              </div>
            </div>
          </div>
          <hr>
          <button type="submit" class="btn btn-success" name="sign_up"><i class="fa fa-upload"></i> Upload</button>
          <button type="submit" class="btn btn-secondary"> Reset</button>
        </form>
        <?php include('footer.php'); ?>