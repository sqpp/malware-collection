<?php
ini_set('display_errors',1);
$page_ID=12;
include("req/common-variable.php");
include("php-function/db-connection.php");
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- CONTACT US -->
<html>
<title><?php echo $title[0]; ?></title>
<meta name="description" content="<?php echo $description[0]; ?>">
<meta name="keywords" content="<?php echo $keywords[0]; ?>">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<meta name="ROBOTS" content="index,follow">
<meta name="revisit-after" content="1 Days">
<meta name="rating" content="GENERAL">
<meta name="distribution" content="GLOBAL">

<link rel='stylesheet' type='text/css' href='<? echo $website_css_address ?>'>

<script src="js/AC_RunActiveContent.js" type="text/javascript"></script>
<script src="js/date.js" type="text/javascript"> </script>
<script src="js/terms_open.js" type="text/javascript"> </script>

<script type='text/javascript'>
   function focus_onload()
	{
		 document.form1.name.focus();
	}

   function adv_validate(name, email, phone, comments)
   {
	 if(name.length > 28)
	 {
	   alert("Name maximum length is 28 characters");
	   document.form1.name.focus();
	   return false
	 }
	 if(email.length > 40)
	 {
	   alert("Email maximum length is 40 characters");
	   document.form1.email.focus();
	   return false
	 }
	 if(phone.length < 10)
	 {
	   alert("Contact Number should be at least 10 numbers including area code");
	   document.form1.phone.focus();
	   return false
	 }
	 if(comments.length > 1000)
	 {
	   alert("Comments & Enquries maximum length is 1000 characters");
	   document.form1.comments.focus();
	   return false
	 }
}

 function validate(name, email, phone, comments, response)
 {
	 var missingArray = new Array();
	 var counter = 0;
	 var whichFocus = "";
	 if( 2 > 10)
	 {
	 alert(name + email + phone + comments + response);
	 return false
	 }
	 if(name == "")
	 {
	   missingArray[counter] = "Name";
	   if(counter == 0)
	   {
		 whichFocus = "name";
	   }
	   counter++;
	 }

	 if(email == "")
	 {
	   missingArray[counter] = "Email";
	   if(counter == 0)
	   {
		 whichFocus = "email";
	   }
	   counter++;
	 }

	 if(phone == "")
	 {
	   missingArray[counter] = "Contact Number";
	   if(counter == 0)
	   {
		 whichFocus = "phone";
	   }
	   counter++;
	 }

	 if(comments == "")
	 {
	   missingArray[counter] = "Comments and Enquiries";
	   if(counter == 0)
	   {
		 whichFocus = "comments";
	   }
	   counter++;
	 }
response = grecaptcha.getResponse();
if(response.length == 0)
{
    // Captcha is not Passed
    missingArray[counter] = "Security key not match";
	if(counter == 0)
	   {
		 whichFocus = "comments";
	   }
	   counter++;
}
	 var missingString = "";
	 for (loop=0; loop < missingArray.length; loop++)
	 {
	   missingString = missingString + missingArray[loop]+"\n";

	 }
	 if(missingArray.length >= 1)
	 {
	   alert("Please fill in the following entries \n" + missingString);
	   var y = "document.form1."+whichFocus;
	   //alert(y);
	   eval(y).focus();
	   //document.form1.name.focus();
	   return false;
	 }
	 return adv_validate(name, email, phone, comments, response);
 }
</script>
<script src='https://www.google.com/recaptcha/api.js'></script>
</head>
<body>


<?php
 include("req/admin_header.php");
?>

<div id='container'>
	<div class='content'>			
		<?php if($h1[0] != ""){ echo "<h1>".$h1[0]."</h1>";} ?>
        <?php if($h2[0] != ""){ echo "<h2>".$h2[0]."</h2>";} ?>
        <?php if($p[0] != ""){ echo "<p>".$p[0]."</p>";} ?>
        <?php if($h2[1] != ""){ echo "<h2>".$h2[1]."</h2>";} ?>
        <?php if($p[1] != ""){ echo "<p>".$p[1]."</p><br>";} ?>
        <br><br>
        <h4><b><? echo $accommodation; ?></b></h4>
        <?php if($p[2] != ""){ echo "<p style='color:#000000;'><strong>".$p[2]."</strong></p>";} ?>
        <table cellspacing='0' cellpadding='0' border='0'>
            <tr>
                <td style='width:100px'><p style='margin-bottom:0;padding:0;'><strong>Phone</strong></p></td>
                <td><p style='margin-bottom:0;padding:0;'><strong>&nbsp;:&nbsp;</strong></p></td>
                <td><?php if($p[3] != ""){ echo "<p style='margin-bottom:0;padding:0;'>".$p[3]."</p>";} ?></td>
            </tr>
            <tr>
                <td><p style='margin-bottom:0;padding:0;'><strong>Email</strong></p></td>
                <td><p style='margin-bottom:0;padding:0;'><strong>&nbsp;:&nbsp;</strong></p></td>
                <td><?php if($p[4] != ""){ echo "<p style='margin-bottom:0;padding:0;'>".$p[4]."</p>";} ?></td>
            </tr>
            <tr>
                <td><p style='margin-bottom:0;padding:0;'><strong>Website</strong></p></td>
                <td><p style='margin-bottom:0;padding:0;'><strong>&nbsp;:&nbsp;</strong></p></td>
                <td><?php if($p[5] != ""){ echo "<p style='margin-bottom:0;padding:0;'>".$p[5]."</p>";} ?></td>
            </tr>
        </table>         	
        <br><br>
        <?php
        //////////////////////////////// getting Prop email address///////////////////////////////
        if($_POST)
		{
		 // 	echo"post V";
		 // print_r($_POST);	
		  $update = $_POST["update"]; 
		  $name=$_POST["name"] ;
		  $email=$_POST["email"];
		  $phone=$_POST["phone"];
		  $comments=$_POST["comments"];
		  $response = $_POST["g-recaptcha-response"];
		}
					
		if(!empty($update) && $update)
        {
         //echo"Update set";
		 //////////////////////////////////Data validation///////////////////////////////
        $counter=0;
        $missingArray=array();
        if(empty($name))
        {
        $missingArray[$counter]="Name";               
        $counter++;
        }
        
        if(empty($email))
        {
        $missingArray[$counter]="Email";
        $counter++;
        }
        
        if(empty($phone))
        {
        $missingArray[$counter]="Contact Number";
        $counter++;
        }
        
        if(empty($comments))
        {
        $missingArray[$counter]="Comments & Enquiries";
        $counter++;
        }

		if(empty($response))
        {
        $missingArray[$counter]="Real Person check failed";
        $counter++;
        }
		
        if(count($missingArray) > 0)
        {
            echo 'Please go back and fill the following fields:- <br >';
            for ($loop=0; $loop < count($missingArray); $loop++)
            {
            echo $missingArray[$loop]. "<br >";
            }
            echo"<form><input type=button value='Take me back' onclick='history.back()'></form>";
            echo"</td>
            </tr>
            </table>
            </html>
            </body>";
            exit();
        }
        $counter=0;
        unset($missingArray);
        $missingArray=array();
        
        if(strlen($name) > 28)
        {
        $missingArray[$counter]="Name maximum length is 28 characters";
        $counter++;
        }
        
        if(strlen($email) > 40)
        {
        $missingArray[$counter]="Email maximum length is 40 characters";
        $counter++;
        }
        
        if(strlen($phone) < 10)
        {
        $missingArray[$counter]="Contact Number should be at least 10 numbers including area code";
        $counter++;
        }
        
        if(strlen($comments) > 1000)
        {
        $missingArray[$counter]="Comments & Enquiries maximum length is 1000 characters";
        $counter++;
        }
        if(strlen($response) < 200)
        {
        $missingArray[$counter]="Real Person check failed";
        $counter++;
        }
		//###################################################
		$verify_url="https://www.google.com/recaptcha/api/siteverify?response=$response&secret=6Leb-i4UAAAAAMrvGxM31kb_Q1M1GPykPJHl4YMh";
				
		$get_file=file_get_contents($verify_url);
		
		$json_file=json_decode($get_file,true);
		//print_r($get_file);
		if($json_file['success']==true)
		{
		//echo"captcha code success";
		}
		else
		{
			$missingArray[$counter]="error in captcha code";
			$counter++;
		}
		//$response_array=json_decode($get_file);	
		//print_r($response_array);
			//print_r($response_array['success']);
		 //$privatekey = "";
		 

		 /*if (preg_match) {
		   // What happens when the CAPTCHA was entered incorrectly
		   die ("The reCAPTCHA wasn't entered correctly. Go back and try it again." .
				"(reCAPTCHA said: " . $resp->error . ")");
		 } 
		 else 
		 {
		  echo "successful verification";
		 }*/
		//###################################################
		
        if(count($missingArray) > 0)
        {
        echo 'Please go back and address the following issues:- <br >';
        for ($loop=0; $loop < count($missingArray); $loop++)
        {
            echo $missingArray[$loop]. "<br >";
        }
        echo"<form><input type=button value='Take me back' onclick='history.back()'></form>";
        echo"</td>
        </tr>
        </table>
        </html>
        </body>";
        exit();
        }
		
		

       // echo"Property Email : ".$propemail ;
        $toString= "Name : ".$name ."\n"
        ."Email : ".$email ."\n"
        ."Contact Number : ".$phone ."\n"
        ."Comments & Enquiries : ".$comments ."\n";
        
		//$prop_email='vikram.update247@gmail.com';
        $prop_email=$client_email;
        //echo"<br>Property Email 2 : ".$prop_email ;
        $additionalheader= "From: ".$email."\n"."Reply-To: ".$email;
            
            if(mail($prop_email, 'Best Friend Holiday Retreat - Contact Us Form',$toString, $additionalheader))
            {
            echo"
            <div style='text-align:center; margin-bottom:10px; padding:10px 30px 0px 0px; border-top:solid 1px #f4e4d2; border-bottom:solid 1px #f4e4d2;'><h3 style='color:#f24e00; font-size:12px; margin-bottom:0px;           padding-bottom:0px;'><b>Your Enquiry / Comments has been sent successfully to<br> Best Friend Holiday Retreat.<br>Our Staff will get in touch with you soon.</b></h3><br></div>
            ";
            }      
            else
            {
                echo"Enquiry <span class = 'red'> not sent</span>, Please try again.";
            }
            $query="insert into enquiry (enquiryid, name, email, phone, enquiry_date, enquiry)  values ('','".$name."','".$email."','".$phone."',now(),'".htmlentities($comments)."' )";
       $result=mysql_query($query);
       if($result)
       {
//             echo" Insert Date ";
//             echo mysql_affected_rows()."added <br >";
       }
       else
       {
//          echo "Sales something wrong <br >";
         echo mysql_error();
       }
        }
		else
		{
			//echo"Update not set";
			//print_r($_POST);	
		}
        ?>
		<script>
window.onload = function() {
  var recaptcha = document.forms["myForm"]["g-recaptcha-response"];
  recaptcha.required = true;
  recaptcha.oninvalid = function(e) {
    // do something
    alert("Please complete the captcha");
  }
}
</script>
        <h4 class='form'><?php echo $accommodation ;?> &ndash; Contact Us Form</h4>
        <form name="form1" action="contact-us.php" method="post" onsubmit="return validate(name.value, email.value, phone.value, comments.value)" >    <?php
					
			?>		
            <table border='0' cellpadding='0' cellspacing='1' class='contact-form'>                    
                <tr>
                <td><b>Name:</b></td>
                <td><input type='text' name = 'name' size='30'></td>
                </tr>
                
                <tr>
                <td><b>E-mail:</b></td>
                <td><input type='text' name = 'email'  size='30'></td>
                </tr>
                
                <tr>
                <td><b>Contact Number</b> (include area code):</td>
                <td><input type='text' name = 'phone' size='30' ></td>
                </tr>
                
                <tr>
                <td valign='top'><b>Comments and Enquiries:</b></td>
                <td><textarea class='textareaField'  name='comments' rows='5' cols='40'></textarea>
                </td>
                </tr>  
                <tr>
				<td valign='top'><b>Security Key:</b></td>
				<td><div class="g-recaptcha" data-sitekey="6Leb-i4UAAAAAD6vtwvOILOTrBOYy-MZwiP5Gcl0"></div>	</td>
				</tr>				
                <tr>
                <td><input type='hidden' name='update' value=true ></td>
                <td><input type='submit' value = 'Send'></td>
                </tr>
            </table>  
					
        </form>
        <br><br>
        <?php
		 include("req/sub-menu.php");
		?>
    </div>

    <?php
	 include("req/right-col.php");
	?>
    <!-- Do not delete clear div -->
    <div class='clear'></div> 

</div>


<?php
  include("req/footer.php");
?>

</body>
</html>