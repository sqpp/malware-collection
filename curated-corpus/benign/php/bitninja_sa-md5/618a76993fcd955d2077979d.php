<?php
require('config.php');

if (isset($_POST['category_name'])) {
    $category_name            = filter_var($_POST['category_name'], FILTER_SANITIZE_STRING, FILTER_FLAG_STRIP_HIGH);
    if ($stmt = $db_handle->prepare("SELECT Product_Id,Product_Name,Unit_Price,Description,Available_Units,Discount_Percentage,Primary_Image,Vendor_Id
                                    FROM Products WHERE Product_Group = '" . $category_name . "'")) {
        $stmt->execute();
        $db_handle->error;
        $stmt->bind_result($Id, $Product_Name, $Unit_Price, $Description, $Available_Units, $Discount_Percentage, $Primary_Image, $Vendor_Id);
        $products = array();
        $items_array = array();
    } else {
        printf('errno: %d, error: %s', $db_handle->errno, $db_handle->error);
        die;
    }

    while ($stmt->fetch()) {
        $items_array['Id'] = $Id;
        $items_array['Product_Name'] = $Product_Name;
        $items_array['Unit_Price'] = $Unit_Price;
        $items_array['Description'] = $Description;
        $items_array['Available_Units'] = $Available_Units;
        $items_array['Discount_Percentage'] = $Discount_Percentage;
        $items_array['Primary_Image'] = $Primary_Image;
        $items_array['Vendor_Id'] = $Vendor_Id;

        array_push($products, $items_array);
    }
    echo json_encode($products);
    mysqli_close($db_handle);
}
