<?php

require_once "../backend/functions.php";
require '../backend/SimpleImage.php';
dbconn();

//upload image
$filedata = $_FILES['image'];
$tempfile = safehtml($filedata['tmp_name']);
$namafile = safehtml($filedata['name']);
$destfile = "../images/logo/" . $namafile . "";

$allowed_types = ['image/jpeg', 'image/png', 'image/gif', 'image/jpg'];

if (in_array($_FILES['image']['type'], $allowed_types)) {
 move_uploaded_file($_FILES["image"]["tmp_name"], "" . $destfile);
} else {

 bahaya("Sila upload file berformat image sahaja.");

}

try {
 // Create a new SimpleImage object
 $image = new \claviska\SimpleImage();

 // Magic!
 $image
  ->fromFile($destfile) // load image.jpg
  ->autoOrient() // adjust orientation based on exif data
  ->resize(300, 300) // resize to 320x200 pixels
  ->toFile($destfile); // convert to PNG and save a copy to new-image.png

 // And much more!
} catch (Exception $err) {
 // Handle errors
 echo $err->getMessage();
}

if (file_exists("../images/logo/" . $namafile . "")) {

 echo "<img width='100' style='margin-top:10px' src=\"images/logo/" . $namafile . "\">";

 $beres = mysqli_query($con, "UPDATE sripi_sekolah SET logo = '$namafile' WHERE id = '$CURUSER[company]'");

} else {

 echo "Upload failed!, please upload again.";

}