<?php
	require_once('navbar.php');
	$roleId = $_SESSION['roleid'];
	$UserPersonId=$_SESSION['UserPersonId'];
?>
	<link type="text/css" href="css/muktai.css" rel="stylesheet" />
	<link rel='stylesheet' type='text/css' href='css/styles.css' />
	<link rel='stylesheet' type='text/css' href='css/header.css' />	
	<link rel="stylesheet" href="autocomplete/jquery.auto-complete.css">
	<link rel="shortcut icon" href="img/pramukhime.ico" type="image/x-icon"/>
	<link type="text/css" href="css/ReportCustome.css" rel="stylesheet" />
	<link rel='stylesheet' type='text/css' href='css/font-awesome.min.css' />	
	<style media='print'>
		.uppercasetag{
			text-transform: uppercase;
		}
		@page {
			margin : 0mm;
		}
		body {
			padding : 20mm 10mm 20mm 10mm;
		}
		.SRCls{
			width:5%;
		}
		.ItemCls{
			width:75%;
		}
		.QtyCls{
			width:15%;
		}
	</style>	
	<style>	
		// input{ border:none; }
		.pursalesrside1 {
			width: 18%;
			height: 28px;
			display: block;
			float: left;
			margin-bottom: 0px;
			border: none;
		}
		
		.form-style-3 fieldset{
		border-radius: 10px;
		-webkit-border-radius: 10px;
		-moz-border-radius: 10px;
		margin: 0px 0px 5px 0px;
		border: 1px solid #BCBCBC;
		padding: 15px;
		background: #FDFEFE;
		box-shadow: inset 0px 0px 15px #E6E6FA;
		-moz-box-shadow: inset 0px 0px 15px #E6E6FA;
		-webkit-box-shadow: inset 0px 0px 15px #E6E6FA;
		}
		.form-style-3 fieldset legend{
		color: #FFA0C9;
		border-top: 1px solid #BCBCBC;
		border-left: 1px solid #BCBCBC;
		border-right: 1px solid #BCBCBC;
		border-radius: 5px 5px 0px 0px;
		-webkit-border-radius: 5px 5px 0px 0px;
		-moz-border-radius: 5px 5px 0px 0px;
		background: #FDFEFE;
		padding: 0px 8px 3px 8px;
		box-shadow: inset 0px 0px 15px #E6E6FA;
		-moz-box-shadow: inset 0px 0px 15px #E6E6FA;
		-webkit-box-shadow: inset 0px 0px 15px #E6E6FA;
		font-weight: normal; 
		width:230px;
		}
		.input-sm{ width: 50%;}
		@media only screen and (max-width: 650px){
			.scroll {
				overflow-x: scroll;
				margin: 2px;
			}
			#ReportHeader{
				font-size:19px;
			}
			.field1{
				display:none;
			}
			.Rtable {
				margin-left: 0px;
			}
			.NameR{
				width: 92% !important;
				margin-left: 15px;
				margin-bottom: 6px;
			}
			.dtinput {
					width: 47% !important;
					margin-bottom: 3px;
					margin-left: 4px;
					padding:5px;
				}
			.pursalesrside{ 
				width: 50%;
				
			}.PRegRow{ 
				padding:2px;
			}
			.field{
				display:none;
			}
			.form-style-3{
				margin-top: -25px;
			}
		}
	</style>
    <script>
		$(document).ready(function(){
			$('.chkboxselectall').on('click',function(){
				if(this.checked){
					$('.clmncheckboxm').each(function(){
						this.checked = true;
					});
				}else{
					 $('.clmncheckboxm').each(function(){
						this.checked = false;
					});
				}
			});
			
			$('.clmncheckboxm').on('click',function(){
				if($('.clmncheckboxm:checked').length == $('.clmncheckboxm').length){
					$('.chkboxselectall').prop('checked',true);
				}else{
					$('.chkboxselectall').prop('checked',false);
				}
			});
			$('.resetbtn').on('click',function(){
				$("#myformreset")[0].reset();
				if($('.clmncheckboxm:checked').length == $('.clmncheckboxm').length){
					$('.chkboxselectall').prop('checked',true);
				}else{
					$('.chkboxselectall').prop('checked',false);
				}
			});
			if($('.clmncheckboxm:checked').length == $('.clmncheckboxm').length){
				$('.chkboxselectall').prop('checked',true);
			}else{
				$('.chkboxselectall').prop('checked',false);
			}
		});
       	$(function(){
				$('#searchCust').autoComplete({
					minChars: 1,
					source: function(term, response){
						try { xhr.abort(); } catch(e){}
						xhr = $.getJSON('SearchPersonName.php', { q : term }, function(data){ response(data); });
					}
				});
			});

		$(document).ready(function(){
			$('#select_all').on('click',function(){
				if(this.checked){
					$('.checkbox').each(function(){
						this.checked = true;
					});
				}else{
					 $('.checkbox').each(function(){
						this.checked = false;
					});
				}
			});
			
			$('.checkbox').on('click',function(){
				if($(this).prop('checked') == false){
					var idchk=$(this).attr('id');
					console.log(idchk);
					$('#'+idchk+'_idSales').prop('checked',false);
				}else{
					var idchk=$(this).attr('id');
					console.log(idchk);
					$('#'+idchk+'_idSales').prop('checked',true);
				}
				if($('.checkbox:checked').length == $('.checkbox').length){
					$('#select_all').prop('checked',true);
				}else{
					$('#select_all').prop('checked',false);
				}
			});
			savecustomesetting();
		});
		function savecustomesetting(){
			var path = window.location.pathname;
			var pageurlname = path.split("/").pop();
			$('tr').find('th,td').each(function(index){
				// var abc=index + 1;
				var abc=index;
				// console.log('abc=='+abc);
				$('td:eq('+abc+')').show();
				$('th:eq('+abc+')').show();
			});
			var columnname = [];
			$.each($("input[name='clmn_select_chbox']:checked"), function(){            
				columnname.push($(this).val());
			});
			var arrlength = columnname.length;
			for(var i=0; i<arrlength; i++){
				var index = $('[name='+columnname[i]).attr('name').substr(3,6);
				// var checkedornot = $('input[value='+columnname[i]).prop('checked');
				// console.log('checkedornot=='+checkedornot);
				index--;
				// $chk.prop('checked', true);
				$('table tr').each(function(){
					// $('td:eq('+index+')',this).toggle();
					$('td:eq('+index+')',this).hide();
					// $('th:eq('+index+')',this).toggle();
					$('th:eq('+index+')',this).hide();
				});
			}
			var req = $.ajax({
				url : 'savecustomesetting.php',
				type : 'post',
				cache : false,
				data : {chkboxnames:columnname,pageurlname:pageurlname}
			});
			req.done(function(){
				// $('#Submit').click();
			});
		}
	</script>
</head>
<?php
	Error_Reporting('E_ALL');
	include("includes/connection.php");
	require_once("includes/SoftwareLanguage.php");
	require_once("includes/StockLebelsLanguage.php");
	
	include('includes/LSLmysql.php');
	require_once('includes/config.php');
	require_once('Item_Class.php');	
?>
<body>
	<div id="wrapper"  style="">
		<div id="page-wrapper" style="">
			<?php
			if (isset($_POST['Cancel'])) {
				header('location:GenerateAllPrint.php');
			}
			session_start();
			$_SESSION['DealerName'] = $_POST['DealerName'];
			$ComapnyIdSession=$_SESSION['companyId']; 
			?>
		<form method="post" action="" id="myformreset">
		<div class="modal fade" id="myModal" role="dialog">
			<div class="modal-dialog">
				 <div class="modal-content">
					<div class="modal-header text-center">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title"><?php echo $TableSelectionColumn; ?></h4>
					</div>
					<div class="modal-body">
						<?php 
						$SQLCriteriaSelect = "SELECT * FROM dimcriteriachk WHERE ReportType= 'DelivaryReportPrint.php'";
						$ResCriteriaSelect = mysql_query($SQLCriteriaSelect);
						$ResCriteriaNum = mysql_fetch_Array($ResCriteriaSelect);
						$tags=explode(',',$ResCriteriaNum['Criteria']);
						?>
						<input class="chkboxselectall" type="checkbox" name="chkboxselectall" id="chkboxselectall" value="selectall" > <b style="color: teal;"><?php echo $SelectAlllbl; ?></b></input>
							<span class="pull-right" style="font-size:13px;color:red"><b>Note :- <img src="images/checkbox1.png" width="20px;" height="20px;"> Fields Are Hide</b></span>
						<br>
						<hr style="margin:2px;" />
						<div class="chkboxlist">
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col1" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col1'){ echo "checked='checked'"; } } } ?> ><?php echo 'SELECT ALL'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col2" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col2'){ echo "checked='checked'"; } } } ?> ><?php echo 'GRNO'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col3" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col3'){ echo "checked='checked'"; } } } ?> ><?php echo 'BUYER NAME'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col4" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col4'){ echo "checked='checked'"; } } } ?> ><?php echo 'ROUTE NAME'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col5" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col5'){ echo "checked='checked'"; } } } ?> ><?php echo 'BUYER ADDRESS'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col6" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col6'){ echo "checked='checked'"; } } } ?> ><?php echo 'BUYER MOBILE'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col7" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col7'){ echo "checked='checked'"; } } } ?> ><?php echo 'SUPERVISOR NAME'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col8" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col8'){ echo "checked='checked'"; } } } ?> ><?php echo 'SUPERVISOR MOBILE'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col9" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col9'){ echo "checked='checked'"; } } } ?> ><?php echo 'VEHICLE NO'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col10" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col10'){ echo "checked='checked'"; } } } ?> ><?php echo 'DRIVER NAME'; ?></input><br>
							<input class="clmncheckboxm" type="checkbox" name="clmn_select_chbox" value="col11" <?php foreach($tags as $i =>$key){ if($i >0){ if($key == 'col11'){ echo "checked='checked'"; } } } ?> ><?php echo 'DRIVER MOBILE'; ?></input><br>
						</div>
						<input type="button" class="btn btn-success" onclick="savecustomesetting();" name="ok" id="ok" value="<?php echo $OKlbl; ?>" data-dismiss="modal" >
						<input type="button" class="btn btn-warning resetbtn" name="resetbtn" id="resetbtn" value="<?php echo "Reset"; ?>" >
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal"><?php echo "Close"; ?></button>
					</div>
				</div>
			</div>
		</div>
	</form>	
		<div class="row" id='hidediv' style="margin-left:0px;margin-right:0px;">
		 <form method ="post" id="contactsFrom" action="">
			<div class="muktai" style='margin-bottom: 0px;'>
				<div class="form-style-3" > 
					<fieldset id="hdn" style="height:auto">
						<legend style="margin-bottom:2px;width:auto">
							<a href="DashBoard.php">
								<img src="images/back.png" class="hidden-xs" style="width:40px">
								<font face="cambriya" color="red"><span id="ReportHeader">Order Delivery Invoice Print</span></font>
							</a>
						</legend>
						<div class="row">
							<div class="PRegRow">
								<label class ="lside1 hidden-xs"> DISPATCH DATE : </label>
								<input type="date" class="pursalesrside dtinput  " name="PDPurchaseDateFrom" tabindex="1" id="PDPurchaseDateFrom" value = "<?php if(isset($_POST['PDPurchaseDateFrom'])){ $FromDate = str_replace('/', '-', $_POST['PDPurchaseDateFrom']); echo date('Y-m-d',strtotime($FromDate)); }else{ echo date('Y-m-d'); } ?>" />
								
								<label class ="lside1 hidden-xs">BUYER :</label>
								<input type="text" id="DealerName" name="DealerName" class="pursalesrside dtinput " placeholder="Enter Buyer Name" autofocus value="<?php echo $_SESSION['DealerName'];?>" onchange="ChkBillPersonExist('Person');" onfocus="this.select();" >
							</div>
							<div class="PRegRow">
								<label class ="lside1 hidden-xs">ROUTE NAME :</label>
								<input type="text" id="RouteName" name="RouteName" class="pursalesrside dtinput " placeholder="Enter Route Name" autofocus value="<?php echo $_POST['RouteName'];?>" onchange="ChkBillPersonExist('Route');" onfocus="this.select();">
								<label class ="lside1 hidden-xs">VEHICLE&nbsp;NO :</label>
								<input type="text" id="vehicleno" name="vehicleno" class="pursalesrside dtinput " placeholder="Enter Vehicle No" autofocus value="<?php echo $_POST['vehicleno'];?>" onchange="ChkBillPersonExist('vehicleno');" onfocus="this.select();">
							</div>
							<div class="PRegRow">
								<label class ="lside1 hidden-xs">PRINT COPY :</label>
								<select id="printcopy" name="printcopy" class="pursalesrside dtinput">
									<option value="" <?php if($_POST['printcopy']=='') { echo "selected"; } ?>>All</option>
									<option value="CC" <?php if($_POST['printcopy']=='CC') { echo "selected"; } ?>>CC</option>
									<option value="OC" <?php if($_POST['printcopy']=='OC') { echo "selected"; } ?>>OC</option>
								</select>
							</div>
							<div class="PRegRow">
								<div class="col-md-12 text-center">
								
									<input type="submit" class="btn btn-primary btn-sm"  tabindex="7" name="Submit" value="Search" id='Submit'>
									<input type="button" class="btn btn-success btn-sm" value="Generate Print" name="generateAll" id="generateAll" >
									<button type="button" class="hidden-xs btn btn-info btn-sm" aria-hidden="true" data-toggle="modal" data-target="#myModal" style="color: white; background-color: #9c0b70;border-color: #9c0b70;">
										Custome&nbsp;<i class="fa fa-cogs" style="padding:3px; color: white; background-color: #9c0b70;cursor: pointer;border-radius: 5px;"  ></i>
									</button>
								</div>	 
							</div>
						</div>
					</fieldset>	
				</div>	
			</div>
						
			<div class="Rtable" style='overflow:auto;'>
				<table class="table table-bordered" style='white-space:nowrap;'>
				<?php 
					if(isset($_POST['Submit'])){
						$From1 = str_replace('/', '-', $_POST['PDPurchaseDateFrom']);
						$From = date('Y-m-d', strtotime($From1));
						
						$DealerName = stripslashes($_POST['DealerName']);
						$RouteName = stripslashes($_POST['RouteName']);
						$vehicleno = stripslashes($_POST['vehicleno']);
						$printcopy1 = stripslashes($_POST['printcopy']);
							   
							$SQLSalesDtls = "SELECT s.idSales,s.GRNo,s.RouteName,s.vehicleno,s.ReferenceName,s.DriverName,s.SupplyRECContact,p.idPerson ,p.personAddress as customerAddress,p.personName,p.personMobilePrimary FROM tblsales s
									JOIN tblsalesdetails sd ON s.idSales = sd.salesId 
									JOIN tblperson p ON s.PersonId = p.idPerson";
									
							$strWHERE = "";
			 
							if ($DealerName != "") {
								if ($strWHERE != ""){
									$strWHERE = $strWHERE." and s.customerName = " . $DealerName;
								} else 
								$strWHERE = " Where s.customerName ='".$DealerName."'";	
							}
							if ($RouteName != "") {
								if ($strWHERE != ""){
									$strWHERE = $strWHERE." and s.RouteName = " . $RouteName;
								} else 
								$strWHERE = " Where s.RouteName ='".$RouteName."'";	
							}if ($vehicleno != "") {
								if ($strWHERE != ""){
									$strWHERE = $strWHERE." and s.vehicleno = " . $vehicleno;
								} else 
								$strWHERE = " Where s.vehicleno ='".$vehicleno."'";	
							}
							if ($From != "" AND $From != "") {
								if ($strWHERE != "") {
									$strWHERE = $strWHERE." and s.DispatchDate  between '".$From."' AND '".$From."'";
								} else {
									$strWHERE = " and s.DispatchDate  between '".$From."' AND '".$From."'";
								}
							}
							if ($strWHERE != "") {
								$SQLSalesDtls = $SQLSalesDtls.$strWHERE ." and sd.SchemeOffer !='Yes' and sd.DeleteStatus !='Y' Group By s.idSales DESC";//Group By s.PersonId DESC
							}	
									
						} else {
							$From= date('Y-m-d'); //'2018-10-23';
							
							$SQLSalesDtls = "SELECT s.idSales,s.GRNo,s.RouteName,s.ReferenceName,s.DriverName,s.SupplyRECContact,p.idPerson,p.personName,p.personAddress as customerAddress,p.personMobilePrimary FROM tblsales s
								JOIN tblsalesdetails sd ON s.idSales = sd.salesId
								JOIN tblperson p ON s.PersonId = p.idPerson
								and s.DispatchDate  between '".$From."' AND '".$From."' 
								and SchemeOffer !='Yes'  and sd.DeleteStatus !='Y' Group By s.idSales DESC";//Group By s.PersonId DESC
						}
						// echo $SQLSalesDtls;
						if(isset($_POST['submit'])) {
							$searchRes = mysql_query ($sqlsear); //run the query
							$rowcount = mysql_num_rows($searchRes);
							if($rowcount <= 0){
									echo "<center><font color='red'><h3><strong>Sorry</strong>... No such Customer Record Found..<strong>OR</strong></h3></font></center>";
							}
						} else {
							$searchRes = mysql_query ($SQLSalesDtls); //run the query
							$rowcount = mysql_num_rows($searchRes);
						}
					?>
					<tr bgcolor="#E6E6FA">
						<th class="text-center col-md-1" id="thname" name="col1">SELECT&nbsp;ALL&nbsp;&nbsp;<input type="checkbox" id="select_all" name="" value=""></th>		
						<th class="text-center col-md-5" name="col2">GRNO</th>
						<th class="text-center col-md-5" name="col3">BUYER&nbsp;NAME</th>
						<th class="text-center col-md-4" name="col4">ROUTE&nbsp;NAME</th>
						<th class="text-center col-md-4" name="col5">BUYER&nbsp;ADDRESS</th>
						<th class="text-center col-md-2" name="col6">BUYER&nbsp;MOBILE</th>
						<th class="text-center col-md-2" name="col7">SUPERVISOR&nbsp;NAME</th>
						<th class="text-center col-md-2" name="col8">SUPERVISOR&nbsp;MOBILE</th>
						<th class="text-center col-md-2" name="col9">VEHICLE&nbsp;NO</th>
						<th class="text-center col-md-2" name="col10">DRIVER&nbsp;NAME</th>
						<th class="text-center col-md-2" name="col11">DRIVER&nbsp;MOBILE</th>
					</tr>
					<?php  $i=1;
					while($RowDisplay = mysql_fetch_array($searchRes)){ ?>
					<tr>
						<td class="text-center" id="tdaname">
							<input class="hidden" type="text" id="printcopy1_<?php echo $RowDisplay['idSales'];?>" name="printcopy1_<?php echo $RowDisplay['idSales'];?>" value="<?php echo $printcopy1;?>" >
							<input class="checkbox" type="checkbox" checkorno="checkorno" id="CustomerId_<?php echo $RowDisplay['idSales'];?>" name="CustomerId[]" value="<?php echo $RowDisplay['idPerson'];?>">
							<input class="checkbox hidden" type="checkbox" id="CustomerId_<?php echo $RowDisplay['idSales'];?>_idSales" name="idSales[]" value="<?php echo $RowDisplay['idSales'];?>">
						</td>
						<td class="text-left" ><?php echo $RowDisplay['GRNo'];?></td>
						<td class="text-left" ><?php echo $RowDisplay['personName'];?>
							<input type="hidden" id="CustName<?php echo $i;?>" name="CustName<?php echo $i;?>" value="<?php echo $RowDisplay['customerName'];?>">
						</td>
						<td class="text-left" ><?php echo $RowDisplay['RouteName'];?></td>
						<td class="text-left" ><?php echo $RowDisplay['customerAddress'];?>
							<input type="hidden" id="customerAddress<?php echo $i;?>" name="customerAddress<?php echo $i;?>" value="<?php echo $RowDisplay['customerAddress'];?>">
						</td>
						<td class="text-left" ><?php echo $RowDisplay['personMobilePrimary'];?>
							<input type="hidden" id="personMobilePrimary<?php echo $i;?>" name="personMobilePrimary<?php echo $i;?>" value="<?php echo $RowDisplay['personMobilePrimary'];?>"></td>	
						<td class="text-left" ><?php echo $RowDisplay['ReferenceName'];?></td>
						<td class="text-left" ><?php echo $RowDisplay['SupplyRECContact'];?></td>
						<td class="text-left" ><?php echo $RowDisplay['vehicleno'];?></td>
						<td class="text-left" ><?php if($RowDisplay['DriverName']!='0') { echo $RowDisplay['DriverName']; }  ?></td>
						<td class="text-left" ><?php 
							$s = "SELECT p.personMobilePrimary FROM tblperson p where p.personName='".$RowDisplay['DriverName']."' and p.personName!=''";
							$w = mysql_query($s); //run the query
							$rw = mysql_fetch_array($w);
							echo $rw['personMobilePrimary'];
							?>
						</td>
					</tr>
					<?php $i++; } ?>
				</table>
				<div class="text-center">
				<input type="hidden" name="rowcount" value="<?php echo $rowcount ?>" >	
				<input type="date" class="pursalesrside hidden" name="From" id="From" value="<?php if(isset($_POST['PDPurchaseDateFrom'])){ $FromDate = str_replace('/', '-', $_POST['PDPurchaseDateFrom']); echo date('Y-m-d',strtotime($FromDate)); }else{ echo date('Y-m-d'); } ?>" />
				</div>
			
		   </div>
		</form>
	</div>
	</div>
		<div class="row hidden" >
			<div class="col-lg-8">
				<div class="panel panel-default">
					<div id="morris-area-chart"></div>
				</div>
				<div class="panel panel-default hidden">
					<div class="panel-body">
						<!-- /.col-lg-4 (nested) -->
						<div class="col-lg-8">
							<div id="morris-bar-chart"></div>
						</div>
						<!-- /.col-lg-8 -->
						<div class="col-lg-4 hidden">
							<!-- /.panel -->
							<div class="panel panel-default">
								<div id="morris-donut-chart"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
<?php require_once('CreateDateFormat.php'); ?>
<script>
		$('#vehicleno').autoComplete({
					minChars: 1,
					source: function(term, response){
						try { xhr.abort(); } catch(e){}
						xhr = $.getJSON('SearchVehicleNoFromTransp.php', { q : term }, function(data){ response(data); });
					}
		});
	$(document).ready(function() {
        $("#generateAll").on("click", function (e) {
			var columnname = [];
			$.each($("input[checkorno='checkorno']:checked"), function(){            
				columnname.push($(this).val());
			});
			var arrlength = columnname.length;
			if(arrlength>0){
				$('#contactsFrom').attr('action', "DelivaryPrint.php");
				$("#contactsFrom").submit();
				e.preventDefault();
			}else{
				alert('Please Select Atleast One Bill...!');
				return false;
			}
        });
    });
	function ChkBillPersonExist(val) {
		var params = new Array();
		params['id'] = 1;
		if(val == 'Person'){
			var customerName = document.getElementById("DealerName").value.trim();
			params["AllPersonName"] = customerName;	
		}else if(val == 'Route'){
			var RouteName = document.getElementById("RouteName").value.trim();
			params["RouteName"] = RouteName;	
		}	
			
			var querystr = buildQueryString(params);
			if(val == 'Route'){ var url = "ChkRouteExist.php";}
			if(val == 'Person'){ var url = "ChkPersonNameExist.php"; }
				
			var hr = new XMLHttpRequest();
			var vars = querystr;
			hr.open("POST", url, true);
			hr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			hr.onreadystatechange = function() {
				if(hr.readyState == 4 && hr.status == 200) {
					var return_data = hr.responseText; //alert(return_data);
					 var str = return_data.split('|');  
					var return_data1 = str[0];	
					  if(return_data1 == 1){
						// alert("Bill no Already Exist");
						// return false;
					  }else{ 
						if(val == 'Person'){
							var FocusText = 'DealerName';
						}else if(val == 'Route'){
							val = 'Route';
							var FocusText = 'RouteName';
						}
						alert(val+" not Exist..");
						document.getElementById(FocusText).value='';
						document.getElementById(FocusText).focus();
						return true; 
					  }
				}
			}
			hr.send(vars); 
		}
	$('#RouteName').autoComplete({
		minChars: 1,
		source: function(term, response){
			try { xhr.abort(); } catch(e){}
			xhr = $.getJSON('SearchRootName.php', { q : term,RouteType:'Sales' }, function(data){ response(data); });
		}
	});
	$('#DealerName').autoComplete({
		minChars: 1,
		source: function(term, response){
			try { xhr.abort(); } catch(e){}
			xhr = $.getJSON('SearchAllFarmerName.php', { q : term }, function(data){ response(data); });
		}
	});
</script>
<script type='text/javascript' src='includes/LSLcommon.js'></script>
</body>
</html>
