<?php
require_once("../backend/functions.php");
require_once("../themes/default/block.php");
dbconn();
//loggedinonly();

?>
<script>
    $(function() {
        $('.tobesar').keyup(function() {
            this.value = this.value.toUpperCase();
        });
        $('.buangdash').keyup(function() {
            this.value = this.value.replace(/ /g, "").replace(/[^a-zA-Z 0-9]+/g, "");
        });
    })
</script>
<link href="https://fonts.googleapis.com/css?family=Archivo+Narrow&display=swap" rel="stylesheet">
<?

if ($_POST['mode'] == "editinfo") {

    $uid = $_POST['uid'];
    $namapenuh = mysqli_real_escape_string($con, $_POST['namapenuh']);
    $alamat = mysqli_real_escape_string($con, $_POST['address']);
    $notel = mysqli_real_escape_string($con, $_POST['notel']);
    $emel = mysqli_real_escape_string($con, $_POST['emel']);
    $nokp = mysqli_real_escape_string($con, $_POST['nokp']);
    $sekolah = $_POST['sekolah'];
    $nmsekolah = mysqli_real_escape_string($con, infoSekolah($sekolah, "nama"));
    $negeri = $_POST['negeri'];
    $ppd = $_POST['ppd'];
    $kodppd = $_POST['kodppd'];
    $kodjab = $_POST['kodjab'];
    $kodsek = $CURUSER["username"];
    $penyelaras = mysqli_real_escape_string($con, $_POST['penyelaras']);
    $notelsek = mysqli_real_escape_string($con, $_POST['notelsek']);
    $emelsek = mysqli_real_escape_string($con, $_POST['emelsek']);
    $pegppd = mysqli_real_escape_string($con, $_POST['peg']);
    $telpeg = mysqli_real_escape_string($con, $_POST['tpeg']);
    $juper = mysqli_real_escape_string($con, $_POST['jper']);
    $teljuper = mysqli_real_escape_string($con, $_POST['teljp']);
    $jukhas = mysqli_real_escape_string($con, $_POST['jukh']);
    $teljukhas = mysqli_real_escape_string($con, $_POST['telkh']);
    $alir = $_POST['alir'];
    $lokasi = $_POST['lokasi'];
    $almt = mysqli_real_escape_string($con, $_POST['almt']);
    $jnssek = $_POST['jnssek'];
    $poskod = mysqli_real_escape_string($con, $_POST['poskod']);
    $bandar = mysqli_real_escape_string($con, $_POST['bandar']);
    $nofax = mysqli_real_escape_string($con, $_POST['nofax']);
    $gb = mysqli_real_escape_string($con, $_POST['gb']);
    $hpgb = mysqli_real_escape_string($con, $_POST['hpgb']);
    $pk1 = mysqli_real_escape_string($con, $_POST['pk1']);
    $hppk1 = mysqli_real_escape_string($con, $_POST['hppk1']);
    $pkkhas = mysqli_real_escape_string($con, $_POST['pkkhas']);
    $hppkkhas = mysqli_real_escape_string($con, $_POST['hppkkhas']);
    $kp = mysqli_real_escape_string($con, $_POST['kp']);
    $hpkp = mysqli_real_escape_string($con, $_POST['hpkp']);
    $penye = mysqli_real_escape_string($con, $_POST['penye']);
    $hppenye = mysqli_real_escape_string($con, $_POST['hppenye']);
    $khas = mysqli_real_escape_string($con, $_POST['khas']);
    $hpkhas = mysqli_real_escape_string($con, $_POST['hpkhas']);
    $pafa = mysqli_real_escape_string($con, $_POST['pafa']);
    $hppafa = mysqli_real_escape_string($con, $_POST['hppafa']);
    $pkcj = mysqli_real_escape_string($con, $_POST['pkcj']);
    $hppkcj = mysqli_real_escape_string($con, $_POST['hppkcj']);
    $surau = mysqli_real_escape_string($con, $_POST['surau']);
    $stasurau = mysqli_real_escape_string($con, $_POST['stasurau']);
    $bjqaf = mysqli_real_escape_string($con, $_POST['bjqaf']);
    $stabilikjqaf = mysqli_real_escape_string($con, $_POST['stabilikjqaf']);
    $makmaljqaf = mysqli_real_escape_string($con, $_POST['makmaljqaf']);
    $bhselektif = mysqli_real_escape_string($con, $_POST['bhselektif']);
    $b1 = mysqli_real_escape_string($con, $_POST['b1']);
    $b2 = mysqli_real_escape_string($con, $_POST['b2']);
    $b3 = mysqli_real_escape_string($con, $_POST['b3']);
    $b4 = mysqli_real_escape_string($con, $_POST['b4']);
    $b5 = mysqli_real_escape_string($con, $_POST['b5']);
    $b6 = mysqli_real_escape_string($con, $_POST['b6']);
    $b7 = mysqli_real_escape_string($con, $_POST['b7']);

    /*    Update Maklumat Akaun */
    $op = mysqli_query($con, "UPDATE users SET namapenuh = '$namapenuh', notel = '$notel', email = '$emel', nokp = '$nokp', sekolah = '$sekolah', negeri = '$negeri', ppd = '$ppd', penyelaras = '$penyelaras', pegppd = '$pegppd', telpeg = '$telpeg', juperdana = '$juper', teljuper = '$teljuper', jukhas = '$jukhas', teljukhas = '$teljukhas' WHERE id = '$uid'");

    if ($CURUSER["class"] == "2") {

        /*    Update Data Sekolah table ep_sekolah */
        mysqli_query($con, "UPDATE ep_sekolah SET statuskhas = '$alir', alamat = '$almt', lokasi = '$lokasi', jenis = '$jnssek', notel = '$notelsek', emelsek = '$emelsek' WHERE id = '$sekolah'");

        /*    Pengesahan Sekolah oleh Ketua Panitia */
        if ($CURUSER["title"] == "KP") {
            $jo = mysqli_query($con, "UPDATE ep_sekolah SET sahpds = 'YA', tarikhpds = NOW() WHERE id = '$sekolah'");
        }

        /*    Update Data Sekolah table tdatasekolah */

        $datasek = get_row_count("tdatasekolah", "WHERE KODSEK = '$kodsek'");

        if ($datasek != "0") {

            if ($gb == "" || $hpgb == "" || $pk1 == "" || $hppk1 == "" || $pkkhas == "" || $hppkkhas == "" || $kp == "" || $hpkp == "" || $penye == "" || $hppenye == "" || $khas == "" || $hpkhas == "" || $pafa == "" || $hppafa == "") {
                $masalah = "Sila isi maklumat pentadbir dan penyelaras sekolah dengan lengkap.";
            } else {

                if ($b2 == "undefined") {
                    $b2 = "0";
                } else {
                    $b2 = $b2;
                }
                if ($b3 == "undefined") {
                    $b3 = "0";
                } else {
                    $b3 = $b3;
                }
                if ($b4 == "undefined") {
                    $b4 = "0";
                } else {
                    $b4 = $b4;
                }
                if ($b5 == "undefined") {
                    $b5 = "0";
                } else {
                    $b5 = $b5;
                }
                if ($b6 == "undefined") {
                    $b6 = "0";
                } else {
                    $b6 = $b6;
                }
                if ($b7 == "undefined") {
                    $b7 = "0";
                } else {
                    $b7 = $b7;
                }

                if ($pkkhas == "undefined") {
                    $pkkhas = "TIDAK BERKENAAN";
                } else {
                    $pkkhas = $pkkhas;
                }

                if ($hppkkhas == "undefined") {
                    $hppkkhas = "0000";
                } else {
                    $hppkkhas = $hppkkhas;
                }

                if ($khas == "undefined") {
                    $khas = "TIDAK BERKENAAN";
                } else {
                    $khas = $khas;
                }

                if ($hpkhas == "undefined") {
                    $hpkhas = "00000";
                } else {
                    $hpkhas = $hpkhas;
                }

                mysqli_query($con, "UPDATE tdatasekolah SET
        AlamatLokasiSekolah = '$almt',
        BandarLokasiSekolah = '$bandar',
        PoskodLokasiSekolah = '$poskod',
        KodLokasiPendaftaran = '$lokasi',
        KodLokasiSemasa = '$lokasi',
        AlamatSurat = '$almt',
        NoTelefon = '$notelsek',
        NoFax = '$nofax',
        JENISSEK = '$jnssek',
        STATUSKHAS = '$alir',
        Email = '$emelsek',
        PGB = '$gb',
        HPPGB = '$hpgb',
        KP = '$kp',
        HPKP = '$hpkp',
        PK1 = '$pk1',
        HPPK1 = '$hppk1',
        PENYELARAS = '$penye',
        HPPENYELARAS = '$hppenye',
        BILIKJQAF = '$bjqaf',
        STABILIKJQAF = '$stabilikjqaf',
        MAKMALJQAF = '$makmaljqaf',
        SURAU = '$surau',
        STASURAU = '$stasurau',
        JUMTAWARBAHASA = '$bhselektif',
        TAWARB1 = '$b1',
        TAWARB2 = '$b2',
        TAWARB3 = '$b3',
        TAWARB4 = '$b4',
        TAWARB5 = '$b5',
        TAWARB6 = '$b6',
        TAWARB7 = '$b7',
        PTPAFA = '$pafa',
        PTPAFAHP = '$hppafa',
        KHAS2 = 'TIDAK BERKENAAN',
        PKKHAS = '$pkkhas',
        HPPKKHAS = '$hppkkhas',
        PENYELARASKHAS = '$khas',
        HPPENYELARASKHAS = '$hpkhas'
        WHERE KODSEK = '$kodsek'");

                $masalah = "";
            }
        } else {

            if ($gb == "" || $hpgb == "" || $pk1 == "" || $hppk1 == "" || $pkkhas == "" || $hppkkhas == "" || $kp == "" || $hpkp == "" || $penye == "" || $hppenye == "" || $khas == "" || $hpkhas == "" || $pafa == "" || $hppafa == "") {
                $masalah = "Sila isi maklumat pentadbir dan penyelaras sekolah dengan lengkap.";
            } else {

                if ($b2 == "undefined") {
                    $b2 = "0";
                } else {
                    $b2 = $b2;
                }
                if ($b3 == "undefined") {
                    $b3 = "0";
                } else {
                    $b3 = $b3;
                }
                if ($b4 == "undefined") {
                    $b4 = "0";
                } else {
                    $b4 = $b4;
                }
                if ($b5 == "undefined") {
                    $b5 = "0";
                } else {
                    $b5 = $b5;
                }
                if ($b6 == "undefined") {
                    $b6 = "0";
                } else {
                    $b6 = $b6;
                }
                if ($b7 == "undefined") {
                    $b7 = "0";
                } else {
                    $b7 = $b7;
                }

                if ($pkkhas == "undefined") {
                    $pkkhas = "TIDAK BERKENAAN";
                } else {
                    $pkkhas = $pkkhas;
                }

                if ($hppkkhas == "undefined") {
                    $hppkkhas = "0000";
                } else {
                    $hppkkhas = $hppkkhas;
                }

                if ($khas == "undefined") {
                    $khas = "TIDAK BERKENAAN";
                } else {
                    $khas = $khas;
                }

                if ($hpkhas == "undefined") {
                    $hpkhas = "00000";
                } else {
                    $hpkhas = $hpkhas;
                }

                if ($CURUSER["class"] == "2" && $CURUSER["title"] == "") {

                    mysqli_query($con, "INSERT INTO tdatasekolah (`KODSEK`, `SEKOLAH`, `AlamatLokasiSekolah`, `BandarLokasiSekolah`, `PoskodLokasiSekolah`, `KodNegeriLokasiSekolah`, `AlamatSurat`, `BandarSurat`, `PoskodSurat`, `KodNegeriSurat`, `NoTelefon`, `NoFax`, `Email`, `KodStatusSekolah`, `NomborPendaftaranSekolah`, `KodLokasiPendaftaran`, `KodLokasiSemasa`, `TarikhTubuhSekolah`, `TarikhSekolahTutup`, `JENISSEK`, `GRED`, `KodJenisBantuan`, `KodPeringkat`, `KodJenisMurid`, `KodBahasaPengantar`, `KodSejarahSekolah`, `KodSesi`, `NEGERI`, `KodDaerah`, `Mukim`, `KodParlimen`, `KodDUN`, `PPD`, `KodPKG`, `KodKerajaanTempatan`, `KoordinatXX`, `KoordinatYY`, `STATUSJQAF`, `KOHORTPERDANA`, `KOHORTKHAS`, `KOHORTPELAPORAN`, `KUITIPAN`, `PGB`, `HPPGB`, `KP`, `HPKP`, `PK1`, `HPPK1`, `PENYELARAS`, `HPPENYELARAS`, `BILIKJQAF`, `STABILIKJQAF`, `MAKMALJQAF`, `SURAU`, `STASURAU`, `JUMTAWARBAHASA`, `TAWARB1`, `TAWARB2`, `TAWARB3`, `TAWARB4`, `TAWARB5`, `TAWARB6`, `TAWARB7`, `PTPAFA`, `PTPAFAHP`, `STALAPORDATA`, `STATUSKHAS`, `KATEGORIKHAS`, `KHAS1`, `KHAS2`, `KHAS3`, `PKKHAS`, `HPPKKHAS`, `PENYELARASKHAS`, `HPPENYELARASKHAS`) 
        VALUES ('$kodsek','$nmsekolah','$almt','$bandar','$poskod','$kodjab','$almt','$bandar','$poskod',$kodjab,'$notelsek','$nofax','$emelsek','00','$kodsek','$lokasi','$lokasi','TIDAK BERKENAAN','TIDAK BERKENAAN','$jnssek','TIDAK BERKENAAN','00','00','00','00','00','00','$kodjab','00','00','00','00','$kodppd','00','00','00','00','00','0','TIDAK BERKENAAN','TIDAK BERKENAAN','1','$gb','$hpgb','$kp','$hpkp','$pk1','$hppk1','$penye','$hppenye','$bjqaf','$stabilikjqaf','$makmaljqaf','$surau','$stasurau','$bhselektif','$b1','$b2','$b3','$b4','$b5','$b6','$b7','$pafa','$hppafa','0','$alir','00','00','TIDAK BERKENAAN','TIDAK BERKENAAN','$pkkhas','$hppkkhas','$khas','$hpkhas')") or trigger_error(mysqli_error($con));
                }

                $masalah = "";
            }
        }
    }

    if ($op) {

        if ($masalah) {
            echo $masalah;
        } else {
            echo "Kemaskini maklumat sekolah berjaya";
        }
        if ($CURUSER["class"] > 2) {
            echo "Kemaskini berjaya.";
        }

        write_log("" . $CURUSER['namapenuh'] . " telah mengemaskini maklumat akaun.");
    } else {

        echo "Kemaskini tidak berjaya (" . mysqli_error($con) . ")";
    }
}

if ($_POST['mode'] == "tukarpass") {

    $chpassword = $_POST['pass'];
    $passagain = $_POST['passagain'];
    $uid = $_POST['psid'];

    if ($chpassword != "") {
        $res = mysqli_query($con, "SELECT id, password, secret, enabled FROM users WHERE id = '$uid' AND status = 'confirmed'");
        $row = mysqli_fetch_array($res);

        if (strlen($chpassword) < 6)
            $message = "" . PASS_TOO_SHORT . "";
        if ($chpassword != $passagain)
            $message = "" . PASSWORDS_NOT_MATCH . "";
        $chpassword = md5($chpassword);
    }

    if ((!$chpassword) || (!$passagain))
        $message = "Sila isi ruang yang diperlukan.";

    if (!$message) {
        mysqli_query($con, "UPDATE users SET password = " . sqlesc($chpassword) . "  WHERE id = '$uid'") or die(mysqli_error($con));
        echo "Katalaluan telah ditukar.";
    } else {
        echo $message;
    }
}

if ($_POST['mode'] == "analisissah") {

    $sahgb = get_row_count("ep_sekolah", "WHERE `sahsek` LIKE 'YA' AND `akuangb` LIKE 'ya'");
    $xsahgb = get_row_count("ep_sekolah", "WHERE `sahsek` LIKE 'TIDAK' AND `akuangb` LIKE 'tidak'");

    echo "<div class='row'>
<div class='col-md-6'>";

    begin_kad("Sekolah Disahkan");

    echo "<div style='font-size:30px'>";
    echo number_format($sahgb);
    echo "</div>";

    end_kad();

    echo "</div><div class='col-md-6'>";

    begin_kad("Sekolah Tidak Disahkan");

    echo "<div style='font-size:30px'>";
    echo number_format($xsahgb);
    echo "</div>";

    end_kad();

    echo "</div></div>";
}

if ($_POST['mode'] == "analisismurid") {

    if ($CURUSER["class"] == "2") {

        $kodsekolah = infoSekolah($CURUSER["sekolah"], "kod");
        $aliran = infoAwan($CURUSER["sekolah"], "statuskhas", "ep_sekolah");
        $level = "WHERE KODSEK = '$kodsekolah' AND SB6 = '1'";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $level = "WHERE CatatPlakuOkt = '$ppd' AND SB6 = '1'";
        $aliran = "0";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);

        $level = "WHERE CatatPlakuJun = '$kodneg' AND SB6 = '1'";
        $aliran = "0";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
    } elseif ($CURUSER["class"] > "4") {

        $level = "WHERE SB6 = '1'";
        $aliran = "0";
        $tajuk = "KEBANGSAAN";
        $guna = $CURUSER["username"];
    }

    analisamurid($aliran);
}

if ($_POST['mode'] == "analisisralat") {

    $kutipan = $SETTINGS["namakutipan"];
    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    if ($CURUSER["class"] == "2") {

        $kodsek = $CURUSER["username"];
        $level = "WHERE KODSEK = '$kodsek'";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $pipd = $CURUSER['ppd'];
        $level = "WHERE CatatPlakuOkt = '$ppd'";
        $levelsek = "WHERE PPD = '$ppd'";
        $sekk = "WHERE sekolah = 0 AND ppd = '$pipd' AND class='2'";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);
        $level = "WHERE CatatPlakuJun = '$kodneg'";
        $levelsek = "WHERE NEGERI = '$kodneg'";
        $sekk = "WHERE sekolah = 0 AND negeri = '$neg' AND class='2'";
    } elseif ($CURUSER["class"] > "4") {

        $level = "WHERE SB6 = '1'";
    }

    $stat1 = get_row_count("tdatajqaf", "$level AND STATUSMURID NOT IN (3,4,5,6,7,8,31,33,34,35) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1'", "2");
    $stat2 = get_row_count("tdatajqaf", "$level AND STATUSMURID IN (3,4,5,6,7,8,31) AND `KODTINGKATAN/TAHUN` = 'KHAS' AND SB6 = '1'", "2");
    $khat = get_row_count("tdatajqaf", "$level AND $kolkh = '7' AND STATUSMURID IN (3,4,5,6,7,8,31) AND $kolms IS NULL AND SB6 = '1' AND KODAGAMA = '01'", "2");
    $khat2 = get_row_count("tdatajqaf", "$level AND $kolkh = '' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND SB6 = '1' AND KODAGAMA = '01'", "2");
    $khat3 = get_row_count("tdatajqaf", "$level AND $kolkh IN (1,2,3,4,5,6) AND STATUSMURID IN (3,4,5,6,7,8,31) AND `KODTINGKATAN/TAHUN` != 'KHAS' AND $kolms != '0' AND SB6 = '1' AND KODAGAMA = '01'", "2");
    $khat4 = get_row_count("tdatajqaf", "$level AND $kolkh = '8' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND $kolms != '604' AND SB6 = '1' AND KODAGAMA = '01'", "2");
    $khat5 = get_row_count("tdatajqaf", "$level AND $kolkh = '7' AND `KODTINGKATAN/TAHUN` != 'KHAS' AND $kolms = '604' AND SB6 = '1' AND KODAGAMA = '01'", "2");

    echo "<ul class='list-group'>";
    echo "<li class='list-group-item'>Status Murid KHAS pada PERDANA <span class='badge' onclick='paparralat(\"tdatajqaf\",\"ralatstat1\")' style='background:red'>$stat1</span></li>";
    echo "<li class='list-group-item'>Al-Quran tiada Mukasurat <span class='badge' onclick='paparralat(\"tdatajqaf\",\"ralatkhat1\")' style='background:red'>$khat</span></li>";
    echo "<li class='list-group-item'>Tiada data bacaan sebenar Al-Quran/Iqra <span onclick='paparralat(\"tdatajqaf\",\"ralatkhat2\")' class='badge' style='background:red'>$khat2</span></li>";
    echo "<li class='list-group-item'>Iqra tapi letak Mukasurat Al-Quran <span class='badge' onclick='paparralat(\"tdatajqaf\",\"ralatkhat3\")' style='background:red'>$khat3</span></li>";
    echo "<li class='list-group-item'>Khatam mukasurat bukan 604 <span class='badge' onclick='paparralat(\"tdatajqaf\",\"ralatkhat4\")' style='background:red'>$khat4</span></li>";
    echo "<li class='list-group-item'>Al-Quran mukasurat 604 <span class='badge' onclick='paparralat(\"tdatajqaf\",\"ralatkhat5\")' style='background:red'>$khat5</span></li>";
    echo "</ul>";
}

if ($_POST['mode'] == "liveupload") {

    $kod = $_POST['kod'];
    $id = $_POST['id'];

    if ($CURUSER["class"] == "3") {

        $levelz = "WHERE ppd = '$id'";
        $level = "WHERE CatatPlakuOkt = '$kod'";
        $levelsek = "WHERE ppd = '$id' AND kod IN (SELECT KODSEK FROM tdatajqaf)";
        $sekk = "WHERE sekolah = 0 AND ppd = '$id' AND class='2'";
        $lapor = "WHERE ppd = '$id' AND lapor NOT IN (0,1)";
    } elseif ($CURUSER["class"] == "4") {

        $levelz = "WHERE negeri = '$id'";
        $level = "WHERE CatatPlakuJun = '$kodneg'";
        $levelsek = "WHERE negeri = '$id' AND kod IN (SELECT KODSEK FROM tdatajqaf)";
        $sekk = "WHERE sekolah = 0 AND negeri = '$neg' AND class='2'";
        $lapor = "WHERE ppd = '$id' AND lapor NOT IN (0,1)";
    } elseif ($CURUSER["class"] > "4") {

        $levelz = "";
        $level = "";
        $levelsek = "";
        $id = "";
        $kod = "";
        $lapor = "WHERE lapor NOT IN (0,1)";
    }

    $jumlahsek = get_row_count("ep_sekolah", $levelz,"2");
    $jumlahupload = get_row_count("ep_sekolah", $levelsek,"2");
    $jumlahsektaklapor = get_row_count("ep_sekolah", $lapor,"2");
    $jumbenar = $jumlahupload + $jumlahsektaklapor;

    $peratusbenar = ($jumbenar / $jumlahsek) * 100;

    if ($peratusbenar < 40) {

        $warna = "progress-bar-danger progress-bar-striped";
    } elseif ($peratusbenar < 70) {

        $warna = "progress-bar-warning progress-bar-striped";
    } elseif ($peratusbenar <= 100) {

        $warna = "progress-bar-success progress-bar-striped";
    }

    echo "<div class='progress' style='background:#C0C0C0;margin:0'>
<div class='progress-bar progress-bar-lg $warna wd-" . number_format($peratusbenar) . "p' role='progressbar' aria-valuenow='" . number_format($peratusbenar,2) . "' aria-valuemin='0' aria-valuemax='100' style='text-align:center; width: " . number_format($peratusbenar) . "%;'>
<span style='margin-left:5px'>" . number_format($peratusbenar,2) . "% ($jumbenar/$jumlahsek) </span>
</div>

</div>";
}

if ($_POST['mode'] == "livetaksek") {

    $ppd = $CURUSER['ppd'];
    $kod = $CURUSER['username'];

    $jumlahsek = get_row_count("ep_sekolah", "WHERE ppd = '$ppd'","2");
    $belum = get_row_count("ep_sekolah", "WHERE ppd = '$ppd' AND kod NOT IN (SELECT KODSEK FROM tdatajqaf)","2");
    $i = 1;

    begin_kad("", "belum");

    echo "<div style='font-size:1cm;text-align:center'>$belum</div>";

    end_kad();

    echo "<div style='overflow:auto;height:150px'><ul class='list-group'>";
    $sendah = mysqli_query($con, "SELECT * FROM ep_sekolah WHERE ppd = '$ppd' AND kod NOT IN (SELECT KODSEK FROM tdatajqaf)");
    while ($sr = mysqli_fetch_array($sendah)) {
        extract($sr);

        echo "<li class='list-group-item'>$i. $nama</li>";
        $i++;
    }
    echo "</ul></div>";
}

if ($_POST['mode'] == "livemurid") {

    $kod = $_POST['kod'];
    $id = $_POST['id'];

    if ($CURUSER["class"] == "3") {

        $levelz = "WHERE ppd = '$id'";
        $level = "WHERE CatatPlakuOkt = '$kod'";
        $levelsek = "WHERE ppd = '$id' AND kod IN (SELECT KODSEK FROM tdatajqaf)";
        $sekk = "WHERE sekolah = 0 AND ppd = '$id' AND class='2'";
        $lapor = "WHERE ppd = '$id' AND lapor NOT IN (0,1)";
    } elseif ($CURUSER["class"] == "4") {

        $levelz = "WHERE negeri = '$id'";
        $level = "WHERE CatatPlakuJun = '$kodneg'";
        $levelsek = "WHERE negeri = '$id' AND kod IN (SELECT KODSEK FROM tdatajqaf)";
        $sekk = "WHERE sekolah = 0 AND negeri = '$neg' AND class='2'";
        $lapor = "WHERE ppd = '$id' AND lapor NOT IN (0,1)";
    } elseif ($CURUSER["class"] > "4") {

        $levelz = "";
        $level = "";
        $levelsek = "";
        $id = "";
        $kod = "";
        $lapor = "WHERE lapor NOT IN (0,1)";
    }

    $jumurid = get_row_count("tdatajqaf", "$level AND SB6 = 1 AND KODAGAMA = '01'","2");
    $jumuridper = get_row_count("tdatajqaf", "$level AND STATUSMURID IN (3,4,5,6,7,8,31) AND SB6 = 1 AND KODAGAMA = '01'","2");
    $jumuridkhas = get_row_count("tdatajqaf", "$level AND STATUSMURID IN (32,33,34,35,36,37,38,40) AND SB6 = 1 AND KODAGAMA = '01'","2");

    echo "<div class='row'>";
    echo "<div class='col-md-4'>";
    begin_kad("Enrolmen Murid", "in");
    echo "<div style='font-size:1cm'>" . number_format($jumurid) . "</div>";
    end_kad();
    echo "</div>";
    echo "<div class='col-md-4'>";
    begin_kad("Enrolmen PERDANA", "in");
    echo "<div style='font-size:1cm'>" . number_format($jumuridper) . "</div>";
    end_kad();
    echo "</div>";
    echo "<div class='col-md-4'>";
    begin_kad("Enrolmen KHAS", "in");
    echo "<div style='font-size:1cm'>" . number_format($jumuridkhas) . "</div>";
    end_kad();
    echo "</div>";
    echo "</div>";
}

if ($_POST['mode'] == "livesekolah") {

    $ppd = $CURUSER['ppd'];

    $i = 1;

    begin_kad("", "dah");

    $bilsek = get_row_count("ep_sekolah", "WHERE ppd = '$ppd' AND kod IN (SELECT KODSEK FROM tdatajqaf)");
    echo "<div style='font-size:1cm;text-align:center'>$bilsek</div>";

    end_kad();

    echo "<div style='overflow:auto;height:150px'><ul class='list-group'>";
    $sendah = mysqli_query($con, "SELECT * FROM ep_sekolah WHERE ppd = '$ppd' AND kod IN (SELECT KODSEK FROM tdatajqaf) ORDER BY kod ASC");
    while ($sr = mysqli_fetch_array($sendah)) {
        extract($sr);

        $chck = checksekolah($kod, $statuskhas);

        echo "<li class='list-group-item'>$i. $nama $chck</li>";
        $i++;
    }
    echo "</ul></div>";
}

if ($_POST['mode'] == "sah1") {

    $id = $CURUSER['id'];

    $ok = mysqli_query($con, "SELECT * FROM users WHERE id = '$id'");
    $oo = mysqli_fetch_assoc($ok);

    $namapenuh = $oo["namapenuh"];
    $notel = $oo["notel"];
    $emel = $oo["email"];
    $negeri = $oo["negeri"];
    $ppd = $oo["ppd"];
    $sekolah = $oo["sekolah"];
    $penyelaras = $oo["penyelaras"];
    $pegppd = $oo["pegppd"];
    $telpeg = $oo["telpeg"];
    $juperdana = $oo["juperdana"];
    $teljuper = $oo["teljuper"];
    $jukhas = $oo["jukhas"];
    $teljukhas = $oo["teljukhas"];
    $notelsek = infoAwan($sekolah, "notel", "ep_sekolah");
    $almtsek = infoAwan($sekolah, "alamat", "ep_sekolah");
    $emelsek = infoAwan($sekolah, "emelsek", "ep_sekolah");
    $kodsek = infoAwan($sekolah, "kod", "ep_sekolah");
    $kodppd = infoAwan($ppd, "kodppd", "ep_ppd");
    $kodjpn = infoAwan($negeri, "kod", "ep_negeri");
    $jnssek = infoAwan($sekolah, "jenis", "ep_sekolah");
    $lokasi = infoAwan($sekolah, "lokasi", "ep_sekolah");
    $statusaliran = infoAwan($sekolah, "statuskhas", "ep_sekolah");
    $poskod = infoAwan($sekolah, "poskod", "ep_sekolah");

    $myppd = $CURUSER['ppd'];
    $disebel = "disabled";

    $sekolah = $CURUSER['sekolah'];
    $kodsek = infoSekolah($sekolah, "kod");

    $datasek = get_row_count("tdatasekolah", "WHERE KODSEK = '$kodsek'");

    echo "<div style='position:relative'>";

    /*        if ($datasek == "0") {

echo "<div style='background:rgba(0,0,0,0.5); position:absolute; top:0; left:0; z-index:99999; height:100%; width:100%'>
<div style='position:absolute; top:50%; left:50%; transform: translate(-50%,-50%); -ms-transform: translate(-50%,-50%); color:white'>
<div style='font-size:13px; background:#D1380C; text-align:center; font-weight:bold; border-radius:10px; padding:10px; width:200px'>PAPARAN INI DITUTUP kerana DATA SEKOLAH anda belum DIUPLOAD!</div></div></div>";  

} 
*/

    $disalamat = getSekolah($kodsek, "AlamatLokasiSekolah");
    $disposkod = getSekolah($kodsek, "PoskodLokasiSekolah");
    $disbandar = getSekolah($kodsek, "BandarLokasiSekolah");

    if ($datasek == "0" || $disalamat == "" || $disposkod == "" || $disbandar == "") {

        $disebel = "";
    } else {

        $disebel = "disabled";
    }

    begin_block("Pengesahan 1: Maklumat Asas Sekolah", "", "panel-primary");

    info("Maklumat ini akan disimpan dan dieksport untuk kegunaan Sistem e-Pelaporan j-QAF");

    echo "<ul class='nav nav-tabs' role='tablist'>
<li role='presentation' class='active'><a href='#asas' aria-controls='asas' class='small' role='tab' data-toggle='tab'>Maklumat Asas</a></li>
<li role='presentation'><a href='#pentadbir' aria-controls='pentadbir' class='small'  role='tab' data-toggle='tab'>Maklumat Pentadbir</a></li>";
    /*echo "<li role='presentation'><a href='#jqaf' aria-controls='jqaf' role='tab' class='small' data-toggle='tab'>Maklumat JQAF</a></li>";*/
    echo "</ul>

<!-- Tab panes -->
<div class='tab-content'>
<div role='tabpanel' class='tab-pane active' id='asas' style='padding-top:10px'>";

?>


    <div class="row">
        <div class="container-fluid">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="kodjab">Kod Jabatan</label>
                    <input type="text" class="form-control" id="kodjab" value='<?= infoAwan($negeri, 'kod', 'ep_negeri') ?>' placeholder="Kod Jabatan" readonly>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="negeri">Negeri</label>
                    <? pilih("negeri", "ep_negeri", $negeri, "updateppd()", "disabled") ?>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="kodppd">Kod PPD</label>
                    <input type="text" class="form-control" id="kodppd" value='<?= infoAwan($ppd, 'kodppd', 'ep_ppd') ?>' placeholder="Kod PPD" readonly>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="ppd">PPD</label>
                    <div id="divppd">
                        <? pilih("ppd", "ep_ppd", $ppd, "updetsek()", "disabled") ?>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="kodsek">Kod Sekolah</label>
                    <input type="text" class="form-control" id="kodsek" value='<?= $kodsek ?>' placeholder="Kod Sekolah" disabled="<?= $disebel ?>">
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="sekolah">Sekolah</label>
                    <div id="divsek">
                        <? pilih("sekolah", "ep_sekolah", $sekolah, "", "disabled", "WHERE ppd = '$myppd'") ?>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="row">
        <div class="container-fluid">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="alamat">Alamat Sekolah</label>
                    <textarea class='form-control tobesar' name='alamat' id='alamat' row='4' <?= $disebel ?>><?= getSekolah($kodsek, 'AlamatLokasiSekolah') ?></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="poskod">Poskod</label>
                    <input type="text" id="poskod" class="form-control" value="<?= getSekolah($kodsek, 'PoskodLokasiSekolah') ?>" <?= $disebel ?>>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="sekolah">Bandar</label>
                    <input type="text" id="bandar" class="form-control tobesar" value="<?= getSekolah($kodsek, 'BandarLokasiSekolah') ?>" <?= $disebel ?>>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="poskod">Telefon</label>
                    <input type="text" id="notelsek" class="form-control buangdash" value="<?= getSekolah($kodsek, 'NoTelefon') ?>" readonly>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="lokasi">Faks</label>
                    <input type="text" id="nofax" class="form-control  buangdash" value="<?= getSekolah($kodsek, 'NoFax') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="poskod">E-mel Sekolah</label>
                    <input type="text" id="emelsek" class="form-control" value="<?= getSekolah($kodsek, 'Email') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid bg-warning" style="padding-top:10px;padding-bottom:10px">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="jnssek">Jenis Sekolah</label>
                    <? pilihwei("jnssek", "ep_jenissek", getSekolah($kodsek, 'JENISSEK'), "", "$disebel") ?>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="lokasi">Lokasi Sekolah</label>
                    <? pilih("lokasi", "ep_lokasi", getSekolah($kodsek, 'KodLokasiPendaftaran'), "", "$disebel") ?>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="lokasi">Status Aliran</label>
                    <? pilihwei("statusaliran", "ep_statusaliran", getSekolah($kodsek, 'STATUSKHAS'), "", "$disebel") ?>
                </div>
            </div>
        </div>
    </div>

    <?php

    echo "</div>
<div role='tabpanel' class='tab-pane' id='pentadbir' style='padding-top:10px'>";

    begin_content("Pentadbir");
    ?>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-8">
                <div class="form-group">
                    <label for="poskod">Guru Besar <span style="color:red">*</span></label>
                    <input type="text" id="gb" class="form-control tobesar" value="<?= getSekolah($kodsek, 'PGB') ?>" readonly>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                    <input type="text" id="hpgb" class="form-control  buangdash" value="<?= getSekolah($kodsek, 'HPPGB') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-8">
                <div class="form-group">
                    <label for="poskod">Penolong Kanan Pentadbiran <span style="color:red">*</span></label>
                    <input type="text" id="pk1" class="form-control tobesar" value="<?= getSekolah($kodsek, 'PK1') ?>" readonly>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                    <input type="text" id="hppk1" class="form-control buangdash" value="<?= getSekolah($kodsek, 'HPPK1') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <? if ($statusaliran != "-1") { ?>

        <div class="row">
            <div class="container-fluid">
                <div class="col-md-8">
                    <div class="form-group">
                        <label for="poskod">Penolong Kanan Khas <span style="color:red">*</span></label>
                        <input type="text" id="pkkhas" class="form-control tobesar" value="<?= getSekolah($kodsek, 'PKKHAS') ?>" readonly>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                        <input type="text" id="hppkkhas" class="form-control buangdash" value="<?= getSekolah($kodsek, 'HPPKKHAS') ?>" readonly>
                    </div>
                </div>
            </div>
        </div>

    <? } ?>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-8">
                <div class="form-group">
                    <label for="poskod">Ketua Panitia Pendidikan Islam <span style="color:red">*</span></label>
                    <input type="text" id="kp" class="form-control tobesar" value="<?= getSekolah($kodsek, 'KP') ?>" readonly>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                    <input type="text" id="hpkp" class="form-control buangdash" value="<?= getSekolah($kodsek, 'HPKP') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <?php

    end_content();

    begin_content("Penyelaras");

    ?>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-8">
                <div class="form-group">
                    <label for="poskod">Penyelaras Data Sekolah (PDS) <span style="color:red">*</span></label>
                    <input type="text" id="penye" class="form-control tobesar" value="<?= getSekolah($kodsek, 'PENYELARAS') ?>" readonly>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                    <input type="text" id="hppenye" class="form-control buangdash" value="<?= getSekolah($kodsek, 'HPPENYELARAS') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <? if ($statusaliran != "-1") { ?>

        <div class="row">
            <div class="container-fluid">
                <div class="col-md-8">
                    <div class="form-group">
                        <label for="poskod">Penyelaras Data KHAS <span style="color:red">*</span></label>
                        <input type="text" id="khas" class="form-control tobesar" value="<?= getSekolah($kodsek, 'PENYELARASKHAS') ?>" readonly>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                        <input type="text" id="hpkhas" class="form-control buangdash" value="<?= getSekolah($kodsek, 'HPPENYELARASKHAS') ?>" readonly>
                    </div>
                </div>
            </div>
        </div>

    <? } ?>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-8">
                <div class="form-group">
                    <label for="poskod">Ketua Pentaksir PAFA Sekolah <span style="color:red">*</span></label>
                    <input type="text" id="pafa" class="form-control tobesar" value="<?= getSekolah($kodsek, 'PTPAFA') ?>" readonly>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="sekolah">No. Telefon <span style="color:red">*</span></label>
                    <input type="text" id="hppafa" class="form-control buangdash" value="<?= getSekolah($kodsek, 'PTPAFAHP') ?>" readonly>
                </div>
            </div>
        </div>
    </div>

    <?

    function noTel($nama, $kodsek)
    {

        global $con;

        $y = mysqli_query($con, "SELECT KODSEK, KODPERINGKATINSTITUSI, NAMA FROM tdataguru WHERE KODSEK = '$kodsek' AND NAMA = '$nama'");
        $h = mysqli_fetch_assoc($y);

        return $h["KODPERINGKATINSTITUSI"];
    }

    $pkcj = getSekolah($kodsek, 'KHAS2');

    ?>

    <?php

    end_content();

    echo "</div>
<div role='tabpanel' class='tab-pane' id='jqaf' style='padding-top:10px'>";

    //////// SURAU ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIADA',
        '1' => 'ADA'
    );

    $menu_name = 'surau';
    $selected_value = getSekolah($kodsek, 'SURAU');
    $surau = select_menu($menu_name, $options, $selected_value, "", "disabled");
    //////////////////////////////////////////////////////////////////////

    //////// STATUS SURAU ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIADA',
        '1' => 'MENGIKUT PELAN',
        '2' => 'UBAI SUAI KEKAL',
        '3' => 'UBAI SUAI SEMENTARA'
    );
    $menu_name = 'stasurau';
    $selected_value = getSekolah($kodsek, 'STASURAU');
    $stasurau = select_menu($menu_name, $options, $selected_value, "", "disabled");
    //////////////////////////////////////////////////////////////////////

    //////// BILIK JQAF ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIADA',
        '1' => 'ADA'
    );

    $menu_name = 'bilikjqaf';
    $selected_value = getSekolah($kodsek, 'BILIKJQAF');
    $bjqaf = select_menu($menu_name, $options, $selected_value, "", "disabled");
    //////////////////////////////////////////////////////////////////////

    //////// STATUS BILIK JQAF ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIADA',
        '1' => 'MENGIKUT PELAN',
        '2' => 'UBAI SUAI KEKAL',
        '3' => 'UBAI SUAI SEMENTARA'
    );

    $menu_name = 'stabilikjqaf';
    $selected_value = getSekolah($kodsek, 'STABILIKJQAF');
    $stabjqaf = select_menu($menu_name, $options, $selected_value, "", "disabled");
    //////////////////////////////////////////////////////////////////////

    //////// MAKMAL JQAF ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIADA',
        '1' => 'ADA'
    );

    $menu_name = 'makmaljqaf';
    $selected_value = getSekolah($kodsek, 'MAKMALJQAF');
    $mjqaf = select_menu($menu_name, $options, $selected_value, "", "disabled");
    //////////////////////////////////////////////////////////////////////

    //////// BAHASA ELEKTIF ///////////////////////////////////////////////////////
    $options = array(
        '1' => '1',
        '2' => '2',
        '3' => '3',
        '4' => '4',
        '5' => '5',
        '6' => '6',
        '7' => '7'
    );

    $menu_name = 'bhselektif';
    $selected_value = getSekolah($kodsek, 'JUMTAWARBAHASA');
    $bhselek = select_menu($menu_name, $options, $selected_value, 'paparbilikbhs()', "disabled");
    //////////////////////////////////////////////////////////////////////

    //////// BAHASA PILIHAN 1 ///////////////////////////////////////////////////////
    $options = array(
        '0' => 'TIDAK MENYERTAI',
        '1' => 'BAHASA ARAB',
        '2' => 'BAHASA CINA',
        '3' => 'BAHASA TAMIL',
        '4' => 'BAHASA IBAN',
        '5' => 'BAHASA KADAZANDUSUN',
        '6' => 'BAHASA SEMAI'
    );

    $menu_name1 = 'tawarb1';
    $selected_value1 = getSekolah($kodsek, 'TAWARB1');
    $bhspilih = select_menu($menu_name1, $options, $selected_value1, "", "disabled");

    $menu_name2 = 'tawarb2';
    $selected_value2 = getSekolah($kodsek, 'TAWARB2');
    $bhspilih2 = select_menu($menu_name2, $options, $selected_value2, "", "disabled");

    $menu_name3 = 'tawarb3';
    $selected_value3 = getSekolah($kodsek, 'TAWARB3');
    $bhspilih3 = select_menu($menu_name3, $options, $selected_value3, "", "disabled");

    $menu_name4 = 'tawarb4';
    $selected_value4 = getSekolah($kodsek, 'TAWARB4');
    $bhspilih4 = select_menu($menu_name4, $options, $selected_value4, "", "disabled");

    $menu_name5 = 'tawarb5';
    $selected_value5 = getSekolah($kodsek, 'TAWARB5');
    $bhspilih5 = select_menu($menu_name5, $options, $selected_value5, "", "disabled");

    $menu_name6 = 'tawarb6';
    $selected_value6 = getSekolah($kodsek, 'TAWARB6');
    $bhspilih6 = select_menu($menu_name6, $options, $selected_value6, "", "disabled");

    $menu_name7 = 'tawarb7';
    $selected_value7 = getSekolah($kodsek, 'TAWARB7');
    $bhspilih7 = select_menu($menu_name7, $options, $selected_value7, "", "disabled");
    //////////////////////////////////////////////////////////////////////   

    ?>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-7">
                <div class="form-group">
                    <label for="poskod">Surau</label>
                    <?= $surau ?>
                </div>
            </div>
            <div class="col-md-5">
                <div class="form-group">
                    <label for="sekolah">Status</label>
                    <?= $stasurau ?>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-7">
                <div class="form-group">
                    <label for="poskod">Bilik j-QAF</label>
                    <?= $bjqaf ?>
                </div>
            </div>
            <div class="col-md-5">
                <div class="form-group">
                    <label for="sekolah">Status</label>
                    <?= $stabjqaf ?>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="poskod">Makmal j-QAF</label>
                    <?= $mjqaf ?>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container-fluid">
            <div class="col-md-7">
                <div class="form-group">
                    <label for="poskod">Tawaran Bahasa Elektif</label>
                    <?= $bhselek ?>
                </div>
            </div>
            <div class="col-md-5">
                <div class="form-group">
                    <label for="sekolah">Bahasa Pilihan</label>
                    <div id='divbhs'>

                        <?

                        if (is_numeric(getSekolah($kodsek, 'TAWARB1'))) {

                            echo "<div id='divbhs1'>$bhspilih</div>";
                        }

                        if (is_numeric(getSekolah($kodsek, 'TAWARB2'))) {

                            echo "<div id='divbhs1'><div style='padding-top:5px'>$bhspilih2</div></div>";
                        }

                        if (is_numeric(getSekolah($kodsek, 'TAWARB3'))) {

                            echo "<div id='divbhs1'><div style='padding-top:5px'>$bhspilih3</div></div>";
                        }

                        if (is_numeric(getSekolah($kodsek, 'TAWARB4'))) {

                            echo "<div id='divbhs1'><div style='padding-top:5px'>$bhspilih4</div></div>";
                        }

                        if (is_numeric(getSekolah($kodsek, 'TAWARB5'))) {

                            echo "<div id='divbhs1'><div style='padding-top:5px'>$bhspilih5</div></div>";
                        }

                        if (is_numeric(getSekolah($kodsek, 'TAWARB6'))) {

                            echo "<div id='divbhs1'><div style='padding-top:5px'>$bhspilih6</div></div>";
                        }

                        if (is_numeric(getSekolah($kodsek, 'TAWARB7'))) {

                            echo "<div id='divbhs1'><div style='padding-top:5px'>$bhspilih7</div></div>";
                        }

                        ?>

                    </div>
                </div>
            </div>
        </div>
    </div>

<?
    echo "</div>
</div>
";

    echo "<button onclick='paparsah(\"sah2\")' class='btn btn-success btn-block'>SETERUSNYA >>></button>";

    end_block();

    echo "</div>";
}

if ($_POST['mode'] == "sah2") {

    $kodsek = $CURUSER['info'];

    $jumurid = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek' AND SB6 = 1 AND KODAGAMA = '01'");
    $jumuridper = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek'  AND STATUSMURID IN (3,4,5,6,7,8,31) AND SB6 = 1 AND KODAGAMA = '01'");
    $jumuridkhas = get_row_count("tdatajqaf", "WHERE KODSEK = '$kodsek'  AND STATUSMURID IN (32,33,34,35,36,37,38,40) AND SB6 = 1 AND KODAGAMA = '01'");

    begin_block("Pengesahan 2: Enrolmen Murid Keterlibatan j-QAF", "", "panel-primary");

    info("Maklumat ini adalah enrolmen murid yang terlibat dengan program j-QAF.");

    echo "<div class='row'>";
    echo "<div class='col-md-4'>";
    begin_kad("Enrolmen Murid", "default");
    echo "<div style='font-size:1cm'>" . number_format($jumurid) . "</div>";
    end_kad();
    echo "</div>";
    echo "<div class='col-md-4'>";
    begin_kad("Jumlah Murid PERDANA", "default");
    echo "<div style='font-size:1cm'>" . number_format($jumuridper) . "</div>";
    end_kad();
    echo "</div>";
    echo "<div class='col-md-4'>";
    begin_kad("Jumlah Murid KHAS", "default");
    echo "<div style='font-size:1cm'>" . number_format($jumuridkhas) . "</div>";
    end_kad();
    echo "</div>";
    echo "</div>";

    echo "<button onclick='paparsah(\"sah3\")' class='btn btn-success btn-block'>SETERUSNYA >>></button>";

    end_block();
}

if ($_POST['mode'] == "sah3") {

    begin_block("Pengesahan 3: Analisis Pencapaian Murid", "", "panel-primary");

    info("Maklumat ini adalah analisis pencapaian murid j-QAF untuk kutipan Oktober.");

    $kutipan = $SETTINGS["namakutipan"];

    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    if ($CURUSER["class"] == "2") {

        $kodsekolah = $CURUSER['info'];
        $aliran = infoAwan($CURUSER["sekolah"], "statuskhas", "ep_sekolah");
        //$aliran = "2";
        $level = "WHERE KODSEK = '$kodsekolah' AND SB6 = '1'";
        $tajuk = $CURUSER["namapenuh"];
        $guna = $CURUSER["username"];
        $ch = "";
    }

    echo "<div style='overflow:auto;height:300px'>";

    if ($aliran == "-1" || $aliran == "0") {

        begin_analisa("PENCAPAIAN MENGIKUT MODEL KESELURUHAN (PERDANA)<br>$tajuk");

        function kira_analisa($kodsekolah, $jns, $thn, $aliran)
        {

            global $level, $koljawi, $kolba, $kolkh, $ch;

            if ($jns == "2") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek $koljawi IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "1") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek $kolkh IN (7,8) AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "3") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODBAHASA = '1' AND  $jenissek $kolba IN (3,4,5,6) AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "4") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek (W5 + W6 + W7 + W8 + W10 + W11) = '6' AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "6") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND $jenissek (SB7 + SB9 + SB15 + SB16) = '4' AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            if ($jns == "5") {

                $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek (SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) = '7' AND `KODTINGKATAN/TAHUN` = '$thn'", "$ch");

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }
        }

        analisapencapaian("", 1);

        end_analisa();

        begin_analisa("ANALISIS PENCAPAIAN AL-QURAN");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_juz_quran($jnssek, $thn, $col, $val, $juz, $aliran)
        {

            global $kodsekolah, $level, $kolms;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            if ($juz == 1) {
                $juzbrp = "$kolms < 102";
            } elseif ($juz == 2) {
                $juzbrp = "$kolms > 101 AND $kolms < 201";
            } elseif ($juz == 3) {
                $juzbrp = "$kolms > 200 AND $kolms < 302";
            } elseif ($juz == 4) {
                $juzbrp = "$kolms > 301 AND $kolms < 402";
            } elseif ($juz == 5) {
                $juzbrp = "$kolms > 401 AND $kolms < 502";
            } elseif ($juz == 6) {
                $juzbrp = "$kolms > 501 AND $kolms <= 604";
            }

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND $juzbrp AND `KODTINGKATAN/TAHUN` = '$thn'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kira_kum_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col IN ($val) AND `KODTINGKATAN/TAHUN` = '$thn'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (3,4,5,6,7,8,31) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        analisaquran();

        end_analisa();

        if ($aliran == "0") {

            begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)");

            function kira_khas($jnssek, $thn, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_khas($jnssek, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40)";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
            echo "<tr class='tengah small boldo'>
<td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
<td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
</tr>
<tr class='tengah small boldo'>        

<td width='5%' class='bgprime'>BIL</td>           
<td width='5%' class='bgprime'>%</td>       

</tr>
";

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
            $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

                $iq1 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq1p = @($iq1 / $jumlahbwh) * 100;
                } else {
                    $iq1p = "0";
                }
                $iq2 = kira_khas($jnssek, $kod, $aliran);
                if ($jumlahtepi != 0) {
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                } else {
                    $iq2p = "0";
                }

                echo "<tr class='tengah small'>
    <td style='text-align:left'>$darjah ($kod)</td>
    <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
    </tr>";
            }

            $jiq1 = kolum_khas($jnssek, $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;

            echo "<tr class='bgprime tengah small'>
<td style='text-align:left'>JUMLAH KESELURUHAN</td>
<td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
</tr>";

            echo "</table>";

            end_analisa();

            begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (PPKI)");

            function kira_quran_ppki($jnssek, $thn, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND KategoriKhas = '$thn'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            function kolum_quran_ppki($jnssek, $col, $val, $aliran)
            {

                global $kodsekolah, $level, $cn;

                $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";

                $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'", $cn);

                if ($bilangan > 0) {

                    return $bilangan;
                } else {

                    return "0";
                }
            }

            echo "<table class='table table-striped table-bordered table-hover vercell  table-condensed'>";
            echo "<tr class='tengah small boldo'>
<td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
<td width='5%' colspan='2' class='bgprime'>IQ1</td>          
<td width='5%' colspan='2' class='bgprime'>IQ2</td>           
<td width='5%' colspan='2' class='bgprime'>IQ3</td>          
<td width='5%' colspan='2' class='bgprime'>IQ4</td>          
<td width='5%' colspan='2' class='bgprime'>IQ5</td>          
<td width='5%' colspan='2' class='bgprime'>IQ6</td>          
<td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
<td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
<td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
</tr>
<tr class='tengah small boldo'>        

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td>          

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td>         

</tr>
";

            $jenissek = "STATUSMURID IN (32,36,37,38,40) AND";
            $jenisseks = "STATUSMURID IN (32,36,37,38,40)";

            $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

            $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam'");
            while ($kbb = mysqli_fetch_array($kcc)) {

                $darjah = $kbb["nama"];
                $id = $kbb["id"];
                $kod = $kbb["kod"];

                $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'", $cn);

                if ($jumlahtepi != 0) {
                    $iq1 = kira_quran_ppki($jnssek, $kod, $kolkh, "1", $aliran);
                    $iq1p = @($iq1 / $jumlahtepi) * 100;
                    $iq2 = kira_quran_ppki($jnssek, $kod, $kolkh, "2", $aliran);
                    $iq2p = @($iq2 / $jumlahtepi) * 100;
                    $iq3 = kira_quran_ppki($jnssek, $kod, $kolkh, "3", $aliran);
                    $iq3p = @($iq3 / $jumlahtepi) * 100;
                    $iq4 = kira_quran_ppki($jnssek, $kod, $kolkh, "4", $aliran);
                    $iq4p = @($iq4 / $jumlahtepi) * 100;
                    $iq5 = kira_quran_ppki($jnssek, $kod, $kolkh, "5", $aliran);
                    $iq5p = @($iq5 / $jumlahtepi) * 100;
                    $iq6 = kira_quran_ppki($jnssek, $kod, $kolkh, "6", $aliran);
                    $iq6p = @($iq6 / $jumlahtepi) * 100;
                    $iq7 = kira_quran_ppki($jnssek, $kod, $kolkh, "7", $aliran);
                    $iq7p = @($iq7 / $jumlahtepi) * 100;
                    $iq8 = kira_quran_ppki($jnssek, $kod, $kolkh, "8", $aliran);
                    $iq8p = @($iq8 / $jumlahtepi) * 100;
                } else {
                    $iq1 = kira_quran_ppki($jnssek, $kod, $kolkh, "1", $aliran);
                    $iq1p = "0";
                    $iq2 = kira_quran_ppki($jnssek, $kod, $kolkh, "2", $aliran);
                    $iq2p = "0";
                    $iq3 = kira_quran_ppki($jnssek, $kod, $kolkh, "3", $aliran);
                    $iq3p = "0";
                    $iq4 = kira_quran_ppki($jnssek, $kod, $kolkh, "4", $aliran);
                    $iq4p = "0";
                    $iq5 = kira_quran_ppki($jnssek, $kod, $kolkh, "5", $aliran);
                    $iq5p = "0";
                    $iq6 = kira_quran_ppki($jnssek, $kod, $kolkh, "6", $aliran);
                    $iq6p = "0";
                    $iq7 = kira_quran_ppki($jnssek, $kod, $kolkh, "7", $aliran);
                    $iq7p = "0";
                    $iq8 = kira_quran_ppki($jnssek, $kod, $kolkh, "8", $aliran);
                    $iq8p = "0";
                }

                echo "<tr class='tengah small'>
    <td style='text-align:left'>$darjah</td>
    <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
    <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
    <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
    <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
    <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
    <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
    <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
    <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

    <td>" . number_format($jumlahtepi) . "</td>
    </tr>";
            }

            $jiq1 = kolum_quran_ppki($jnssek, $kolkh, "1", $aliran);
            $jiq1p = @($jiq1 / $jumlahbwh) * 100;
            $jiq2 = kolum_quran_ppki($jnssek, $kolkh, "2", $aliran);
            $jiq2p = @($jiq2 / $jumlahbwh) * 100;
            $jiq3 = kolum_quran_ppki($jnssek, $kolkh, "3", $aliran);
            $jiq3p = @($jiq3 / $jumlahbwh) * 100;
            $jiq4 = kolum_quran_ppki($jnssek, $kolkh, "4", $aliran);
            $jiq4p = @($jiq4 / $jumlahbwh) * 100;
            $jiq5 = kolum_quran_ppki($jnssek, $kolkh, "5", $aliran);
            $jiq5p = @($jiq5 / $jumlahbwh) * 100;
            $jiq6 = kolum_quran_ppki($jnssek, $kolkh, "6", $aliran);
            $jiq6p = @($jiq6 / $jumlahbwh) * 100;
            $jiq7 = kolum_quran_ppki($jnssek, $kolkh, "7", $aliran);
            $jiq7p = @($jiq7 / $jumlahbwh) * 100;
            $jiq8 = kolum_quran_ppki($jnssek, $kolkh, "8", $aliran);
            $jiq8p = @($jiq8 / $jumlahbwh) * 100;

            $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

            echo "<tr class='bgprime tengah small'>
<td style='text-align:left'>JUMLAH KESELURUHAN</td>
<td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
<td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
<td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
<td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
<td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
<td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
<td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
<td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

<td>" . number_format($jumlahbwh) . "</td> 
</tr>";

            echo "</table>";

            end_analisa();
        }
    }

    if ($aliran == "1") {

        begin_analisa("ANALISIS MURID MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK)");

        function kira_khas($jnssek, $thn, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (33,34,35) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$thn'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_khas($jnssek, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (33,34,35)";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
<td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
<td width='5%' colspan='2' class='bgprime'>ENROLMEN</td>
<td rowspan='2' width='5%' class='bgprime' style='vertical-align: middle !important'>JUMLAH</td>

</tr>
<tr class='tengah small boldo'>        

<td width='5%' class='bgprime'>BIL</td>           
<td width='5%' class='bgprime'>%</td>       

</tr>
";

        $jenissek = "STATUSMURID IN (33,34,35) AND";
        $jenisseks = "STATUSMURID IN (33,34,35)";

        $jumlahbwh = get_row_count("tdatajqaf", "$level AND $jenisseks");

        $kcc = mysqli_query($con, "SELECT * FROM ep_kategorikhas WHERE jns = 'khatam' ORDER BY kod ASC");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek KategoriKhas = '$kod'");

            $iq1 = kira_khas($jnssek, $kod, $aliran);
            if ($jumlahtepi != 0) {
                $iq1p = @($iq1 / $jumlahtepi) * 100;
            } else {
                $iq1p = "0";
            }
            $iq2 = kira_khas($jnssek, $kod, $aliran);
            if ($jumlahtepi != 0) {
                $iq2p = @($iq2 / $jumlahtepi) * 100;
            } else {
                $iq2p = "0";
            }

            echo "<tr class='tengah small'>
    <td style='text-align:left'>$darjah ($kod)</td>
    <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
    <td>" . number_format($jumlahtepi) . "</td>
    </tr>";
        }

        $jiq1 = kolum_khas($jnssek, $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;

        echo "<tr class='bgprime tengah small'>
<td style='text-align:left'>JUMLAH KESELURUHAN</td>
<td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
<td>" . number_format($jumlahbwh) . "</td> 
</tr>";

        echo "</table>";

        end_analisa();

        begin_analisa("PENCAPAIAN AL-QURAN DAN TASMIK MENGIKUT KATEGORI MURID BERKEPERLUAN KHAS (SKPK)");

        function kira_peratus_quran($jnssek, $thn, $col, $val, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (33,34,35) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val' AND `KODTINGKATAN/TAHUN` = '$thn'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        function kolum_peratus_quran($jnssek, $col, $val, $aliran)
        {

            global $kodsekolah, $level;

            $jenissek = "STATUSMURID IN (33,34,35) AND";

            $bilangan = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek $col = '$val'");

            if ($bilangan > 0) {

                return $bilangan;
            } else {

                return "0";
            }
        }

        echo "<table class='table table-striped table-bordered table-hover vercell table-condensed'>";
        echo "<tr class='tengah small boldo'>
<td rowspan='2' class='bgprime' style='vertical-align: middle !important'>KATEGORI</td>
<td width='5%' colspan='2' class='bgprime'>IQ1</td>          
<td width='5%' colspan='2' class='bgprime'>IQ2</td>           
<td width='5%' colspan='2' class='bgprime'>IQ3</td>          
<td width='5%' colspan='2' class='bgprime'>IQ4</td>          
<td width='5%' colspan='2' class='bgprime'>IQ5</td>          
<td width='5%' colspan='2' class='bgprime'>IQ6</td>          
<td width='6%' colspan='2' class='bgprime'>AL-QURAN</td>         
<td width='5%' colspan='2' class='bgprime'>KHATAM</td>          
<td rowspan='2' width='5%' class='bgprime'>JUMLAH</td>         
</tr>
<tr class='tengah small boldo'>        

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td>          

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td> 

<td width='2%' class='bgprime'>M</td>           
<td width='2%' class='bgprime'>%</td>         

</tr>
";

        $jenissek = "STATUSMURID IN (33,34,35) AND";
        $jenisseks = "STATUSMURID IN (33,34,35)";

        $jumlahbwh = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenisseks");

        $kcc = mysqli_query($con, "SELECT * FROM ep_darjah");
        while ($kbb = mysqli_fetch_array($kcc)) {

            $darjah = $kbb["nama"];
            $id = $kbb["id"];
            $kod = $kbb["kod"];

            $jumlahtepi = get_row_count("tdatajqaf", "$level AND KODAGAMA = '01' AND SB6 = '1' AND $jenissek `KODTINGKATAN/TAHUN` = 'D$id'");

            $iq1 = kira_peratus_quran($jnssek, "D$id", $kolkh, "1", $aliran);
            $iq1p = @($iq1 / $jumlahtepi) * 100;
            $iq2 = kira_peratus_quran($jnssek, "D$id", $kolkh, "2", $aliran);
            $iq2p = @($iq2 / $jumlahtepi) * 100;
            $iq3 = kira_peratus_quran($jnssek, "D$id", $kolkh, "3", $aliran);
            $iq3p = @($iq3 / $jumlahtepi) * 100;
            $iq4 = kira_peratus_quran($jnssek, "D$id", $kolkh, "4", $aliran);
            $iq4p = @($iq4 / $jumlahtepi) * 100;
            $iq5 = kira_peratus_quran($jnssek, "D$id", $kolkh, "5", $aliran);
            $iq5p = @($iq5 / $jumlahtepi) * 100;
            $iq6 = kira_peratus_quran($jnssek, "D$id", $kolkh, "6", $aliran);
            $iq6p = @($iq6 / $jumlahtepi) * 100;
            $iq7 = kira_peratus_quran($jnssek, "D$id", $kolkh, "7", $aliran);
            $iq7p = @($iq7 / $jumlahtepi) * 100;
            $iq8 = kira_peratus_quran($jnssek, "D$id", $kolkh, "8", $aliran);
            $iq8p = @($iq8 / $jumlahtepi) * 100;

            echo "<tr class='tengah small'>
    <td style='text-align:left'>$darjah</td>
    <td>" . number_format($iq1) . "</td><td class='bgungumuda'>" . number_format($iq1p, 2) . "%</td>
    <td>" . number_format($iq2) . "</td><td class='bgungumuda'>" . number_format($iq2p, 2) . "%</td>
    <td>" . number_format($iq3) . "</td><td class='bgungumuda'>" . number_format($iq3p, 2) . "%</td>
    <td>" . number_format($iq4) . "</td><td class='bgungumuda'>" . number_format($iq4p, 2) . "%</td>
    <td>" . number_format($iq5) . "</td><td class='bgungumuda'>" . number_format($iq5p, 2) . "%</td>
    <td>" . number_format($iq6) . "</td><td class='bgungumuda'>" . number_format($iq6p, 2) . "%</td>
    <td>" . number_format($iq7) . "</td><td class='bgungumuda'>" . number_format($iq7p, 2) . "%</td>
    <td>" . number_format($iq8) . "</td><td class='bgungumuda'>" . number_format($iq8p, 2) . "%</td>

    <td>" . number_format($jumlahtepi) . "</td>
    </tr>";
        }

        $jiq1 = kolum_peratus_quran($jnssek, $kolkh, "1", $aliran);
        $jiq1p = @($jiq1 / $jumlahbwh) * 100;
        $jiq2 = kolum_peratus_quran($jnssek, $kolkh, "2", $aliran);
        $jiq2p = @($jiq2 / $jumlahbwh) * 100;
        $jiq3 = kolum_peratus_quran($jnssek, $kolkh, "3", $aliran);
        $jiq3p = @($jiq3 / $jumlahbwh) * 100;
        $jiq4 = kolum_peratus_quran($jnssek, $kolkh, "4", $aliran);
        $jiq4p = @($jiq4 / $jumlahbwh) * 100;
        $jiq5 = kolum_peratus_quran($jnssek, $kolkh, "5", $aliran);
        $jiq5p = @($jiq5 / $jumlahbwh) * 100;
        $jiq6 = kolum_peratus_quran($jnssek, $kolkh, "6", $aliran);
        $jiq6p = @($jiq6 / $jumlahbwh) * 100;
        $jiq7 = kolum_peratus_quran($jnssek, $kolkh, "7", $aliran);
        $jiq7p = @($jiq7 / $jumlahbwh) * 100;
        $jiq8 = kolum_peratus_quran($jnssek, $kolkh, "8", $aliran);
        $jiq8p = @($jiq8 / $jumlahbwh) * 100;

        $total_quran = $jiq1 + $jiq2 + $jiq3 + $jiq4 + $jiq5 + $jiq6 + $jiq7 + $jiq8;

        echo "<tr class='bgprime tengah small'>
<td style='text-align:left'>JUMLAH KESELURUHAN</td>
<td>" . number_format($jiq1) . "</td><td>" . number_format($jiq1p, 2) . "%</td>
<td>" . number_format($jiq2) . "</td><td>" . number_format($jiq2p, 2) . "%</td>
<td>" . number_format($jiq3) . "</td><td>" . number_format($jiq3p, 2) . "%</td>
<td>" . number_format($jiq4) . "</td><td>" . number_format($jiq4p, 2) . "%</td>
<td>" . number_format($jiq5) . "</td><td>" . number_format($jiq5p, 2) . "%</td>
<td>" . number_format($jiq6) . "</td><td>" . number_format($jiq6p, 2) . "%</td>
<td>" . number_format($jiq7) . "</td><td>" . number_format($jiq7p, 2) . "%</td>
<td>" . number_format($jiq8) . "</td><td>" . number_format($jiq8p, 2) . "%</td>

<td>" . number_format($jumlahbwh) . "</td> 
</tr>";

        echo "</table>";

        end_analisa();
    }

    echo "</div>";

?>
    <script>
        function papardivpengesahan() {

            $("#divpengesahan").show();

        }
    </script>
<?

    echo "<button onclick='papardivpengesahan()' class='btn btn-success btn-block'>SAHKAN >>></button>";

    end_block();
}

if ($_POST['mode'] == "analisismuridarab") {

    $kutipan = $SETTINGS["namakutipan"];
    if ($kutipan == "JUN") {

        $koljawi = "JW3";
        $kolba = "BA1";
        $kolkh = "KH1";
        $kolms = "KH2";
        $kolq = "KH5";
    } elseif ($kutipan == "OKT") {

        $koljawi = "JW4";
        $kolba = "BA2";
        $kolkh = "KH3";
        $kolms = "KH4";
        $kolq = "KH6";
    }

    if ($CURUSER["class"] == "2") {

        $kodsek = $CURUSER["username"];
        $level = "WHERE KODSEK = '$kodsek'";
    } elseif ($CURUSER["class"] == "3") {

        $ppd = $CURUSER['username'];
        $pipd = $CURUSER['ppd'];
        $level = "WHERE CatatPlakuOkt = '$ppd'";
        $levelsek = "WHERE PPD = '$ppd'";
        $sekk = "WHERE sekolah = 0 AND ppd = '$pipd' AND class='2'";
    } elseif ($CURUSER["class"] == "4") {

        $neg = $CURUSER['negeri'];
        $kodneg = sprintf("%02d", $neg);
        $level = "WHERE CatatPlakuJun = '$kodneg'";
        $levelsek = "WHERE NEGERI = '$kodneg'";
        $sekk = "WHERE sekolah = 0 AND negeri = '$neg' AND class='2'";
    } elseif ($CURUSER["class"] > "4") {

        $level = "WHERE SB6 = '1'";
    }

    echo "<table class='table table-bordered table-hover tablekecil tengah'>";
    echo "<tr class='boldo'><td>BIL</td><td>BAHASA</td><td>MURID ISLAM</td><td>MURID BUKAN ISLAM</td></tr>";

    $e = 1;

    $st1 = mysqli_query($con, "SELECT * FROM ep_bahasa");
    while ($st2 = mysqli_fetch_array($st1)) {

        $nama = $st2["nama"];
        $id = $st2["id"];
        $islam = get_row_count("tdatajqaf", "$level AND KODBAHASA = '$id' AND KODAGAMA = '01' AND SB6 = '1' AND STATUSMURID IN (3,4,5,6,7,8,31)");
        $nonislam = get_row_count("tdatajqaf", "$level AND KODBAHASA = '$id' AND KODAGAMA != '01' AND SB6 = '1' AND STATUSMURID IN (3,4,5,6,7,8,31)");

        echo "<tr><td>$e</td><td>$nama</td><td>" . number_format($islam) . "</td><td>" . number_format($nonislam) . "</td></tr>";
        $e++;
    }

    echo "</table>";
}

?>