<?php

    
    require ('../conexion/conexion.php');
    
   /* $id_certificado ='A-19/097576';
    $parametro ='1';
    $valor = '10.12';
    $comentario ='Modificacion';
    $usuario ='vtorres';*/



    $id_certificado =  $_POST['id_certificado'];
    $parametro =  $_POST['parametro'];
    $valor = $_POST['valor'];
    $comentario = $_POST['comentario'];
    $usuario = $_POST['usuario'];
    $value_after = $_POST['value_after'];



     $search = SearchAprobed($id_certificado);
     if($search==0)
     {
       
       $parametro_string="parametro_".$parametro;
       $banda ="band_edit_".$parametro;
       $sql =" update muestras set ".$parametro_string."='".$valor."',".$banda."='1' where id_certificado='".$id_certificado."'";
       $result = $conn->query($sql);
       $sql ="insert into ediciones_analista (id_certificado,valor_registrado,comentario,usuario,parametro,fecha,after) 
       VALUES ('".$id_certificado."','".$valor."','".$comentario."','".$usuario."','".$parametro."',NOW(),'".$value_after."')";
       $result = $conn->query($sql);
       $sql ="insert into indicador_cambios (id_certificado,indicador_p1,comentario) 
       VALUES ('".$id_certificado."','".$valor."','".$comentario."')";
       $result = $conn->query($sql);
       echo 1;
     }
     else
     {



       echo 0;


     }








   


     function SearchAprobed($id_certificado)
     {

            global $conn;
            $sql = "select count(*) as cantidad from muestras where id_certificado='".$id_certificado."' and estatus ='1' ";
            $result = $conn->query($sql);
            while ($row = $result->fetch_array(MYSQLI_ASSOC))
            {
               $cantidad = $row['cantidad'];
            }
            return $cantidad;

     }





   









?>