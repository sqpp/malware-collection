<?php 
session_start();

	if(@$_SESSION['userA']){
	    include("../config.php");
	

if(@$_POST['submit']){

	$title=addslashes($_POST['title']);

	$short_description=addslashes($_POST['short_description']);

	$detail=$_POST['detail'];

	$date=addslashes($_POST['date']);

	//$_POST['img_file'];

	if($_FILES['img_file']['error']==0)

{
      $target_file = basename($_FILES["img_file"]["name"]);
	$imageFileType = pathinfo($target_file,PATHINFO_EXTENSION);
	if($imageFileType != "jpg" && $imageFileType != "jpeg" && $imageFileType != "png" && $imageFileType != "gif" ) {
    echo "<script> alert('Sorry, only jpg, jpeg, png, gif are allowed.'); </script>";
		echo '<script> window.location="'.$url.'DASHBOARD/AddEvent.php"; </script>';
   
}else 
{

	$type = $_FILES['img_file']['type'];

	//echo $type;exit;

	

	$file_ex = explode("/", $type);

	//echo '<pre>'; print_r($file_ex); exit;

	$size = $_FILES['p_image']['size'];

	$i_name = preg_replace( "/[^a-z0-9\._]+/", "-", strtolower($title) );

	

	$length = 20;

	$key = '';

	$keys = array_merge(range(0, 9), range('a', 'z'), range('A', 'Z'));

	for ($i = 0; $i < $length; $i++) {

	$key .= $keys[array_rand($keys)];

	}

	$path = 'images/events/';

	$pname = $i_name.'_'.$key.'.'.$file_ex[1];
	
$sql1 = "INSERT INTO `events`(`title`, `short_description`, `detail`, `path`, `image`, `date`) VALUES ('$title','$short_description','$detail','$path','$pname','$date')";

$res = $db->query($sql1);

	if($res)

	{
        move_uploaded_file($_FILES['img_file']['tmp_name'],$path.$pname);
		echo '<script> alert("Your Event Is Added"); </script>';

		echo '<script> window.location="'.$url.'DASHBOARD/Events.php"; </script>';

		}

		else

		{

			echo '<script> alert("Your Event Is Not Added"); </script>';

		echo '<script> window.location="'.$url.'DASHBOARD/AddEvents.php"; </script>';

			}
}

}

	

}

?>

<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0"/>

  <!-- Latest compiled and minified CSS -->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">



<!-- jQuery library -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>



<!-- Latest compiled JavaScript -->

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>

function validateImage() {

	var img = $("#img_file").val();

 

	var exts = ['jpg','jpeg','png','gif', 'bmp'];

	// split file name at dot

	var get_ext = img.split('.');

	// reverse name to check extension

	get_ext = get_ext.reverse();

 

	if (img.length > 0 ) {

		if ( $.inArray ( get_ext[0].toLowerCase(), exts ) > -1 ){

		  return true;

		} else {

			 alert("Upload only jpg, jpeg, png, gif, bmp images");

			return false;

		}			

	} else {

		alert("please upload an image");

		return false;

	}

	return false;

}

</script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="froala_editor/css/froala_editor.css">

  <link rel="stylesheet" href="froala_editor/css/froala_style.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/code_view.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/colors.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/emoticons.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/image_manager.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/image.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/line_breaker.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/table.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/char_counter.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/video.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/fullscreen.css">

  <link rel="stylesheet" href="froala_editor/css/plugins/file.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/codemirror.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/at.js/1.4.0/css/jquery.atwho.min.css">



  <style>

      body {

        text-align: center;

      }



      div#editor {

        width: 81%;

        margin: auto;

        text-align: left;

      }



      .atwho-view-ul {

        text-align: left;

      }

  </style>

   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/codemirror.min.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/mode/xml/xml.min.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/at.js/1.4.0/js/jquery.atwho.min.js"></script>



  <script type="text/javascript" src="froala_editor/js/froala_editor.min.js" ></script>



  <script type="text/javascript" src="froala_editor/js/plugins/align.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/code_beautifier.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/code_view.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/colors.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/draggable.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/emoticons.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/font_size.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/font_family.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/image.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/file.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/image_manager.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/line_breaker.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/link.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/lists.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/paragraph_format.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/paragraph_style.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/video.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/table.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/url.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/entities.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/char_counter.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/inline_style.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/save.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/fullscreen.min.js"></script>

  <script type="text/javascript" src="froala_editor/js/plugins/quote.min.js"></script>



  <script>

  $(function() {

    $('textarea#froala-editor').froalaEditor()

  });

</script>

</head>



<body class="body">

  <div class="container">

      <div class="main_container">

      <div class="col-md-12 main_container">

      <div class="col-md-12"><h3 align="center">ADD Event </h3></div>

      </div>

              <div class="col-md-12 left_col" >

          <div class="left_col scroll-view">

            <div class="navbar nav_title" style="border: 0;">

            <form class="form-horizontal" method="post"  enctype="multipart/form-data" onSubmit="return validateImage();">

            		<div class="form-group">

			    <label class="control-label col-sm-2" for="pwd">Date :</label>

			    <div class="col-sm-10"> 

			      <input type="date" class="form-control" name="date" placeholder="Title" required="">

			    </div>

			  </div>

			  <div class="form-group">

			    <label class="control-label col-sm-2" for="pwd">Title :</label>

			    <div class="col-sm-10"> 

			      <input type="text" class="form-control" name="title" placeholder="Title">

			    </div>

			  </div>

			  <div class="form-group">

			    <label class="control-label col-sm-2" for="pwd">Short Description :</label>

			    <div class="col-sm-10"> 

			      <textarea class="form-control" name="short_description" ></textarea>

			    </div>

			  </div>

			  <div class="form-group">

			    <label class="control-label col-sm-2" for="pwd">Detail :</label>

			    <div class="col-sm-10"> 

			      <textarea class="form-control" id="froala-editor" name="detail"></textarea>

			    </div>

			  </div>

			  <div class="form-group">

			    <label class="control-label col-sm-2" for="pwd">Upload Image :</label>

			    <div class="col-sm-10"> 

			      <input type="file" name="img_file" id="img_file" />

			    </div>

			  </div>

			  <div class="form-group"> 

			    <div class="col-sm-offset-2 col-sm-10">

			      <input type="submit" name="submit" class="btn btn-default"value="Submit"/>

			      <a href="<?php echo $url; ?>DASHBOARD/Events.php" class="btn btn-info"> Cancel </a>

			    </div>

			  </div>

			</form>

            </div>



            <div class="clearfix"></div>

			</div>

			</div>

			</div>

			</div>

  

  

</body>

</html>
<?php
}else{

	echo '<script>window.location="../back-office"</script>';

}
?>