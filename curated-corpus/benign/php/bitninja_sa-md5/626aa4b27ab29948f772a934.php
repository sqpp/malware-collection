<?php
require_once "../backend/functions.php";
dbconn();
loggedinonly();

mysqli_query($con, 'SET NAMES UTF8;');

$jo       = mysqli_query($con, "SELECT * FROM ep_setting");
$jj       = mysqli_fetch_assoc($jo);
$ukutipan = $jj["namakutipan"];
$uyear    = $jj["tahunkutipan"];

if ($ukutipan == "OKT") {
 $ukutipan = "OKTOBER";
}

$kutipan = $SETTINGS["namakutipan"];

if ($kutipan == "JUN") {
 $koljawi = "JW3";
 $kolba   = "BA1";
 $kolkh   = "KH1";
 $kolms   = "KH2";
 $kolq    = "KH5";
} elseif ($kutipan == "OKT") {
 $koljawi = "JW4";
 $kolba   = "BA2";
 $kolkh   = "KH3";
 $kolms   = "KH4";
 $kolq    = "KH6";
}

if ($_POST['mode'] == "excelana") {

 $negeri  = $_POST["neg"];
 $ppd     = $_POST["ppd"];
 $jenis   = $_POST["jen"];
 $sek     = $_POST["sek"];
 $jnsdeta = $_POST["jnsdeta"];
 $deta    = $_POST['deta'];
 $kodneg  = sprintf("%02d", $negeri);

 $kutipan = $SETTINGS["namakutipan"];
 $tahunkutip = $SETTINGS["tahunkutipan"];

 if ($deta == "tdatajqaf") {
  $ktpn    = "$kutipan $tahunkutip";
  $kutipan = "OKT";
 } elseif ($deta == "tdatajqaf_okt2019") {
  $ktpn    = "OKT 2019";
  $kutipan = "OKT";
 }

 if ($kutipan == "JUN") {
  $koljawi = "JW3";
  $kolba   = "BA1";
  $kolkh   = "KH1";
  $kolms   = "KH2";
  $kolq    = "KH5";
 } elseif ($kutipan == "OKT") {
  $koljawi = "JW4";
  $kolba   = "BA2";
  $kolkh   = "KH3";
  $kolms   = "KH4";
  $kolq    = "KH6";
 }

 if ($CURUSER["class"] == 2) {
  $kodsekolah = $sek;
 } elseif ($CURUSER["class"] == 3) {
  $kodsekolah = $ppd;
 } elseif ($CURUSER["class"] == 3) {
  $kodsekolah = $negeri;
 } elseif ($CURUSER["class"] == 3) {
  $kodsekolah = "";
 }

 $clauses = array();
 $tjk     = array();
 $pdf     = array();
 $pdf[]   = "neg=$negeri";
 $pdf[]   = "ppd=$ppd";
 $pdf[]   = "sek=$sek";
 $pdf[]   = "jen=$jenis";

 $tjk[] = $ktpn;

 if ($negeri != "0") {
  $clauses[] = "CatatPlakuJun = '$kodneg'";
  $tjk[]     = infoKod($negeri, "ep_negeri", "kod", "nama");
 }

 if ($ppd != "0") {
  $clauses[] = "CatatPlakuOkt = '$ppd'";
  $tjk[]     = infoKod($ppd, "ep_ppd", "kodppd", "nama");
 }

 if ($sek != "0") {

  $clauses[] = "KODSEK = '$sek'";
  $tjk[]     = infoKod($sek, "ep_sekolah", "kod", "nama");
 } else {

  if ($jenis != "0") {

      if ($jenis == "101") {
            $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE jenis IN (101,102))";
      } else {
   $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE jenis = '$jenis')";
      }
      
   $tjk[]     = "MENGIKUT JENIS " . infoKod($jenis, "ep_jenissek", "kod", "fullname");
  }
 }

 $pdf[] = "jnsdeta=$jnsdeta";

 $clauses[] = "SB6 = '1'";
 //$trk = rsort($tjk);
 $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';
 $wuhu  = !empty($clauses) ? '' . implode(' AND ', $clauses) : '';
 $tjkk  = !empty($tjk) ? '' . implode('<br>', $tjk) : '';
 $pdfs  = !empty($pdf) ? '' . implode('&', $pdf) : '';

 //echo $where;

 //echo $jnsdeta;

 if ($CURUSER["class"] == "2") {

  $aliran = infoAwan($CURUSER["sekolah"], "statuskhas", "ep_sekolah");
  $level  = $where;
  $tajuk  = $CURUSER["namapenuh"];
  $guna   = $CURUSER["username"];
  $ch     = "";
 } elseif ($CURUSER["class"] == "3") {

  $ppd    = $CURUSER['username'];
  $level  = $where;
  $aliran = "-1";
  $tajuk  = $CURUSER["namapenuh"];
  $guna   = $CURUSER["username"];
  $ch     = "1";
 } elseif ($CURUSER["class"] == "4") {
  $neg    = $CURUSER['negeri'];
  $kodneg = sprintf("%02d", $neg);
  $level  = $where;
  $aliran = "-1";
  $tajuk  = $CURUSER["namapenuh"];
  $guna   = $CURUSER["username"];
  $ch     = "1";
 } elseif ($CURUSER["class"] > "4") {
  $level  = $where;
  $aliran = "-1";
  $tajuk  = "KEBANGSAAN";
  $guna   = $CURUSER["username"];
  $ch     = "1";
 }

 if ($jnsdeta == "0") {
  $jenisdeta = "KESELURUHAN";
  $or        = "L";
 } elseif ($jnsdeta == "1") {
  $jenisdeta = "AL-QURAN";
 } elseif ($jnsdeta == "2") {
  $jenisdeta = "BAHASA ARAB";
  $or        = "L";
 } elseif ($jnsdeta == "3") {
  $jenisdeta = "JAWI";
  $or        = "L";
 } elseif ($jnsdeta == "4") {
  $jenisdeta = "SOLAT";
 } elseif ($jnsdeta == "5") {
  $jenisdeta = "PPKI";
 }

 echo "<div style='position:absolute;right:30px'><a class='btn btn-outline-success btn-rounded' target='_blank' href='excel.php?mode=excelsek&$pdfs&deta=$deta'><i class='far fa-file-excel'></i> Eksport Excel</a></div>";
 echo "<div style='padding:10px;font-weight:bold;text-align:center'>LAPORAN PENCAPAIAN $jenisdeta<br>PROGRAM j-QAF ";
 echo "$tjkk";
 echo "</div>";

 analisaexcel("", 1, $deta);

}

if ($_POST['mode'] == "excelmur") {

$tahunkutip = $SETTINGS["tahunkutipan"];

 if ($deta == "tdatajqaf") {
  $ktpn    = "$kutipan $tahunkutip";
  $kutipan = "OKT";
 } elseif ($deta == "tdatajqaf_okt2019") {
  $ktpn    = "OKT 2019";
  $kutipan = "OKT";
 }

 $sek = infoSekolah($CURUSER["sekolah"], "nama");

 echo "<div style='position:absolute;right:30px'><a class='btn btn-outline-success btn-rounded' target='_blank' href='excel.php?mode=excelmurid&deta=$deta'><i class='far fa-file-excel'></i> Eksport Excel</a></div>";
 echo "<div style='padding:10px;font-weight:bold;text-align:center'>LAPORAN PENCAPAIAN MURID PROGRAM j-QAF<br>";
 echo "$sek";
 echo "</div>";

 analisaexcelmur($deta);

}

if ($_POST['mode'] == "analisison") {

 $analisisbuka = "BUKA";

 if ($analisisbuka == "TUTUP") {

  datax("Analisis ditutup sementara untuk memberi ruang proses upload data.");

 } else {

  $negeri  = $_POST["neg"];
  $ppd     = $_POST["ppd"];
  $jenis   = $_POST["jen"];
  $sek     = $_POST["sek"];
  $jnsdeta = $_POST["jnsdeta"];
  $deta    = $_POST['deta'];
  $kodneg  = sprintf("%02d", $negeri);

  $kutipan = $SETTINGS["namakutipan"];
  $tahunkutip = $SETTINGS["tahunkutipan"];

  if ($deta == "tdatajqaf") {
   $ktpn    = "$kutipan $tahunkutip";
   $kutipan = "OKT";
  } elseif ($deta == "tdatajqaf_okt2019") {
   $ktpn    = "OKT 2019";
   $kutipan = "OKT";
  }

  if ($kutipan == "JUN") {
   $koljawi = "JW3";
   $kolba   = "BA1";
   $kolkh   = "KH1";
   $kolms   = "KH2";
   $kolq    = "KH5";
  } elseif ($kutipan == "OKT") {
   $koljawi = "JW4";
   $kolba   = "BA2";
   $kolkh   = "KH3";
   $kolms   = "KH4";
   $kolq    = "KH6";
  }

  if ($CURUSER["class"] == 2) {
   $kodsekolah = $sek;
  } elseif ($CURUSER["class"] == 3) {
   $kodsekolah = $ppd;
  } elseif ($CURUSER["class"] == 4) {
   $kodsekolah = $negeri;
  } elseif ($CURUSER["class"] > 4) {
   $kodsekolah = "";
  }

  $clauses = array();
  $tjk     = array();
  $pdf     = array();
  $pdf[]   = "neg=$negeri";
  $pdf[]   = "ppd=$ppd";
  $pdf[]   = "sek=$sek";
  $pdf[]   = "jen=$jenis";

  $tjk[] = $ktpn;

  if ($negeri != "0") {
   $clauses[] = "CatatPlakuJun = '$kodneg'";
   $tjk[]     = infoKod($negeri, "ep_negeri", "id", "nama");
  }

  if ($ppd != "0") {
   $clauses[] = "CatatPlakuOkt = '$ppd'";
   $tjk[]     = infoKod($ppd, "ep_ppd", "kodppd", "nama");
  }

  if ($sek != "0") {

   $clauses[] = "KODSEK = '$sek'";
   $tjk[]     = infoKod($sek, "ep_sekolah", "kod", "nama");
  } else {

   if ($jenis != "0") {

      if ($jenis == "101") {
            $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE jenis IN (101,102))";
      } else {
   $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE jenis = '$jenis')";
      }
            
    $tjk[]     = "MENGIKUT JENIS " . infoKod($jenis, "ep_jenissek", "kod", "fullname");
   }
  }

  $pdf[] = "jnsdeta=$jnsdeta";

  $clauses[] = "SB6 = '1'";
  //$trk = rsort($tjk);

  $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';
  $wuhu  = !empty($clauses) ? '' . implode(' AND ', $clauses) : '';
  $tjkk  = !empty($tjk) ? '' . implode('<br>', $tjk) : '';
  $pdfs  = !empty($pdf) ? '' . implode('&', $pdf) : '';

  //echo $where;
  //echo $tjkk;

  //echo $jnsdeta;

  if ($CURUSER["class"] == "2") {

   $aliran = infoAwan($CURUSER["sekolah"], "statuskhas", "ep_sekolah");
   $level  = $where;
   $tajuk  = $CURUSER["namapenuh"];
   $guna   = $CURUSER["username"];
   $ch     = "";
  } elseif ($CURUSER["class"] == "3") {

   $ppd    = $CURUSER['username'];
   $level  = $where;
   $aliran = "-1";
   $tajuk  = $CURUSER["namapenuh"];
   $guna   = $CURUSER["username"];
   $ch     = "1";
  } elseif ($CURUSER["class"] == "4") {
   $neg    = $CURUSER['negeri'];
   $kodneg = sprintf("%02d", $neg);
   $level  = $where;
   $aliran = "-1";
   $tajuk  = $CURUSER["namapenuh"];
   $guna   = $CURUSER["username"];
   $ch     = "1";
  } elseif ($CURUSER["class"] > "4") {
   $level  = $where;
   $aliran = "-1";
   $tajuk  = "KEBANGSAAN";
   $guna   = $CURUSER["username"];
   $ch     = "1";
  }

  if ($jenis == "105") {
   $or        = "P";
   $jenisdeta = "KESELURUHAN";
  } else {
   if ($jnsdeta == "0") {
    $jenisdeta = "KESELURUHAN";
    $or        = "L";
   } elseif ($jnsdeta == "1") {
    $jenisdeta = "AL-QURAN";
    $or        = "L";
   } elseif ($jnsdeta == "2") {
    $jenisdeta = "BAHASA ARAB";
    $or        = "L";
   } elseif ($jnsdeta == "3") {
    $jenisdeta = "JAWI";
    $or        = "L";
   } elseif ($jnsdeta == "4") {
    $jenisdeta = "SOLAT";
   } elseif ($jnsdeta == "5") {
    $jenisdeta = "PPKI";
   } elseif ($jnsdeta == "6") {
    $jenisdeta = "SKPK";
   }
  }

  if ($ppd != "0") {
   $pipid = "&ppd=$ppd";
  } else {
   $pipid = "";
  }

  echo "<a class='btn btn-primary btn-rounded' style='color:white' target='_blank' href='cetakpdf.php?mode=analisison&$pdfs&jnsdeta=$jnsdeta&or=$or&deta=$deta'>PDF</a>";
  if ($CURUSER["class"] == "3") {
  echo " <a class='btn btn-success btn-rounded' style='color:white' href='excel.php?mode=slip&neg=$negeri$pipid'><i class='fe fe-download'></i> Pelaporan Tahun 6 Filtered<span class='float-right'></a> ";
  }
  echo "<div style='padding:10px;font-weight:bold;text-align:center'>LAPORAN PENCAPAIAN $jenisdeta<br>PROGRAM j-QAF ";
  echo "$tjkk";
  echo "</div>";

  if ($jenis == "105") {

   analisaskpk($deta);

  } else {

   if ($jnsdeta == "0") {

    analisapencapaian("", 1, $deta);
   }

   if ($jnsdeta == "1") {

    analisaquran("", $deta);
   }

   if ($jnsdeta == "2") {

    analisaarab("", $deta);
   }

   if ($jnsdeta == "3") {

    analisajawi("", $deta);
   }

   if ($jnsdeta == "4") {

    analisakbs("", $deta);
   }

   if ($jnsdeta == "5") {

    analisappki($deta);
   }

   if ($jnsdeta == "6") {

    analisaskpk($deta);
   }

  }

 }
}

if ($_POST['mode'] == "pivotkan") {

 $negeri  = $_POST['neg'];
 $ppd     = $_POST['ppd'];
 $sek     = $_POST['sek'];
 $jen     = $_POST['jen'];
 $kaum    = $_POST['kaum'];
 $aliran  = $_POST['alir'];
 $thn     = $_POST['thn'];
 $jan     = $_POST['jan'];
 $stamur  = $_POST['stamur'];
 $qur     = $_POST['quran'];
 $jaw     = $_POST['jawi'];
 $arab    = $_POST['arab'];
 $wuduk   = $_POST['wuduk'];
 $amali   = $_POST['amali'];
 $bacaan  = $_POST['bacaan'];
 $bahasa  = $_POST['bahasa'];
 $masalah = $_POST['masalah'];
 $brai    = $_POST['brai'];
 $juz = $_POST['juz'];

 $kodsek  = $sek;
 $kodppd  = $ppd;
 $kodnegg = infoAwan($negeri, "kod", "ep_negeri");
 $kodneg  = sprintf("%02d", $kodnegg);

 if ($aliran == "-1") {

  $stato  = "3,4,5,6,7,8,31";
  $seksta = "STATUSKHAS IN (-1,0) AND JENISSEK IN (101,102,103,104,106,107,108,207) AND";
 } elseif ($aliran == "0") {

  $stato  = "32,36,37,38,40";
  $seksta = "STATUSKHAS IN (0) AND JENISSEK IN (101,102,103,104,106,107,108,207) AND";
 } elseif ($aliran == "1") {

  $stato  = "33,34,40";
  $seksta = "STATUSKHAS = '1' AND JENISSEK = '105' AND";
 } elseif ($aliran == "2") {

  $stato  = "33,34,40";
  $seksta = "STATUSKHAS = '2' AND JENISSEK IN (106,108) AND";
 }

 echo "<div id=\"ajaxPage\">";

 $clauses = array();
 $tag     = array();

 if ($negeri != "0") {
  $clauses[] = "CatatPlakuJun = '$kodneg'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($negeri, "ep_negeri", "id", "nama") . "</span>";
 }

 if ($ppd != "0") {
  $clauses[] = "CatatPlakuOkt = '$kodppd'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($ppd, "ep_ppd", "kodppd", "nama") . "</span>";
 }

 if ($sek != "0") {
  $clauses[] = "KODSEK = '$kodsek'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($sek, "ep_sekolah", "kod", "nama") . "</span>";
 } else {
  if ($jen != "0") {
   $clauses[] = "KODSEK IN (SELECT kod FROM ep_sekolah WHERE jenis = '$jen')";
   $tag[]     = "<span class='label label-primary'>" . infoKod($jen, "ep_jenissek", "kod", "nama") . "</span>";
  }
 }

 if ($kaum != "0") {
  $clauses[] = "KODKAUM = '$kaum'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($kaum, "ep_kaum", "KodKaum", "Kaum") . "</span>";
 }

 if ($brai != "0") {
  $clauses[] = "KhatamKhasOkt = '$brai'";
  if ($brai == "KB1") {
   $braik = "Al-Quran Bercetak";
  } elseif ($brai == "KB2") {
   $braik = "Al-Quran Braille";
  } elseif ($brai == "KB3") {
   $braik = "Al-Quran Kod Tangan";
  }
  $tag[] = "<span class='label label-primary'>$braik</span>";
 }

 if ($bahasa != "0") {
  $clauses[] = "KODBAHASA = '$bahasa'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($bahasa, "ep_bahasas", "kodbahasa", "bahasa") . "</span>";
 }

 if ($aliran != "0") {
  $clauses[] = "STATUSMURID IN ($stato)";
  $tag[]     = "<span class='label label-primary'>" . infoKod($aliran, "ep_statusaliran", "kod", "nama") . "</span>";
 }

 if ($masalah != "0") {
  $clauses[] = "KategoriKhas = '$masalah'";
  $tag[]     = "<span class='label label-primary'>" . infoKhas($masalah) . "</span>";
 }

 if ($thn != "0") {
  $clauses[] = "`KODTINGKATAN/TAHUN` = '$thn'";
  $tag[]     = "<span class='label label-primary'>$thn</span>";
 }

 if ($juz != "0") {
     if ($juz == "6") {
          $clauses[] = "KH4 > '101' AND KH4 < '122'";
     } elseif ($juz == "7") {
          $clauses[] = "KH4 > '121' AND KH4 < '142'";
     } elseif ($juz == "8") {
          $clauses[] = "KH4 > '141' AND KH4 < '162'";
     } elseif ($juz == "9") {
          $clauses[] = "KH4 > '161' AND KH4 < '182'";
     } elseif ($juz == "10") {
          $clauses[] = "KH4 > '181' AND KH4 < '202'";
     } elseif ($juz == "16") {
            $clauses[] = "KH4 > '301' AND KH4 < '322'";
       } elseif ($juz == "17") {
            $clauses[] = "KH4 > '321' AND KH4 < '342'";
       } elseif ($juz == "18") {
            $clauses[] = "KH4 > '341' AND KH4 < '362'";
       } elseif ($juz == "19") {
            $clauses[] = "KH4 > '361' AND KH4 < '382'";
       } elseif ($juz == "20") {
            $clauses[] = "KH4 > '381' AND KH4 < '402'";
       } elseif ($juz == "21") {
            $clauses[] = "KH4 > '401' AND KH4 < '422'";
       } elseif ($juz == "22") {
            $clauses[] = "KH4 > '421' AND KH4 < '442'";
       } elseif ($juz == "23") {
            $clauses[] = "KH4 > '441' AND KH4 < '462'";
       } elseif ($juz == "24") {
            $clauses[] = "KH4 > '461' AND KH4 < '482'";
       } elseif ($juz == "25") {
            $clauses[] = "KH4 > '481' AND KH4 < '502'";
       } elseif ($juz == "26") {
            $clauses[] = "KH4 > '501' AND KH4 < '522'";
       } elseif ($juz == "27") {
            $clauses[] = "KH4 > '521' AND KH4 < '542'";
       } elseif ($juz == "28") {
            $clauses[] = "KH4 > '541' AND KH4 < '562'";
       } elseif ($juz == "29") {
            $clauses[] = "KH4 > '561' AND KH4 < '582'";
       } elseif ($juz == "30") {
            $clauses[] = "KH3 = '7' AND KH4 > '581' AND KH4 < '604'";
       } 

      $tag[]     = "<span class='label label-primary'>JUZUK $juz</span>";
}

 if ($jan != "0") {
  $clauses[] = "KODJANTINA = '$jan'";
  if ($jan == "L") {
   $jan = "LELAKI";
  } elseif ($jan == "P") {
   $jan = "PEREMPUAN";
  }
  $tag[] = "<span class='label label-primary'>$jan</span>";
 }

 if ($stamur != "0") {
  $clauses[] = "STATUSMURID = '$stamur'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($stamur, "ep_statusmurid", "kod", "nama") . "</span>";
 }

 $kutipan = $SETTINGS["namakutipan"];

 if ($kutipan == "JUN") {

  $koljawi = "JW3";
  $kolba   = "BA1";
  $kolkh   = "KH1";
  $kolms   = "KH2";
  $kolq    = "KH5";
 } elseif ($kutipan == "OKT") {

  $koljawi = "JW4";
  $kolba   = "BA2";
  $kolkh   = "KH3";
  $kolms   = "KH4";
  $kolq    = "KH6";
 }

 if ($qur != "0") {
  $clauses[] = "$kolkh = '$qur'";
  $clauses[] = "KODAGAMA = '01'";
  $tag[]     = "<span class='label label-primary'>" . infoKod($qur, "ep_bacaan", "id", "nama") . "</span>";
 }

 if ($jaw != "0") {
  $clauses[] = "$koljawi IN ($jaw)";
  $clauses[] = "KODAGAMA = '01'";
  $tag[]     = "<span class='label label-primary'>JAWI TP$jaw</span>";
 }

 if ($arab != "0") {
  $clauses[] = "$kolba IN ($arab)";
  $tag[]     = "<span class='label label-primary'>BAHASA ARAB TP$arab</span>";
 }

 if ($wuduk != "#") {
  $clauses[] = "(W5 + W6 + W7 + W8 + W10 + W11) $wuduk";
  $clauses[] = "KODAGAMA = '01'";
 }

 if ($amali != "#") {
  $clauses[] = "(SP1 + SP4 + SP5 + SP6 + SP7 + SP9 + SP12) $amali";
  $clauses[] = "KODAGAMA = '01'";
 }

 if ($bacaan != "#") {
  $clauses[] = "(SB7 + SB9 + SB15 + SB16) $bacaan";
  $clauses[] = "KODAGAMA = '01'";
 }

 $clauses[] = "SB6 = '1'";

 $where = !empty($clauses) ? ' WHERE ' . implode(' AND ', $clauses) : '';
 $tagg  = !empty($tag) ? '' . implode(' ', $tag) : '';

 if ($CURUSER["class"] == 7) {
  info($where);
 }

 if (!empty($tag)) {
  echo "<div style='background:#fff9c4;padding:10px;margin-bottom:10px'>FILTER ANDA: $tagg</div>";
 }

 $wh = rawurlencode($where);

 $tot = get_row_count("tdatajqaf", $where);

 echo "<div style='margin-bottom:10px;padding:10px'>Data Pivot dihadkan kepada 20 rekod sahaja. Sila muat turun rekod penuh ke Excel. <a href='excel.php?mode=pivot&s=$wh' class='btn btn-success btn-sm'>Download</a></div>";

 echo "<div class='row'>";
 echo "<div class='col-md-12'>";
 echo "<div class='mb-3' style='text-align:center;border-radius:10px;background:#00c853;padding:10px;color:white'>
 <div style='font-size:11px'>Enrolmen Terjana</div>
 <h3 style='margin-top:5px;font-size:25px !important'>$tot</h3></div>";
 echo "</div></div>";

 $e     = 1;
 $rqq   = "SELECT * FROM tdatajqaf $where ORDER BY KODSEK, `KODTINGKATAN/TAHUN` LIMIT 20";
 $resqq = mysqli_query($con, $rqq);
 if (mysqli_num_rows($resqq) == 0) {
  datax("Tiada data dijumpai.");
 } else {
  echo "<table class=\"table table-hover vercell table-bordered\">";
  echo "<thead><tr>
        <th width=\"2%\">Bil.</th>
        <th width='48'>#</th>
        <th width='45%'>Nama</th>
        <th style='text-align:center'>Darjah</th>
        <th style='text-align:center'>Nama Kelas</th>
        <th style='text-align:center' width='80' align=\"center\"><span class=\"glyphicon glyphicon-tasks\"></span></th></tr></thead><tbody>";
  while ($row = mysqli_fetch_array($resqq)) {

   $id           = $row["ID"];
   $kodsekolah   = $row["KODSEK"];
   $nama         = $row["NAMA"];
   $nokp         = $row["KPUTAMA"];
   $janti        = $row["KODJANTINA"];
   $update       = $row["UpdateKhatam"];
   $statusaliran = $row["STATUSMURID"];
   $sekolah      = infoKodSekolah($row["KODSEK"], "id");
   $nmsek        = infoKodSekolah($row["KODSEK"], "nama");
   $negeri       = infoAwan($sekolah, "negeri", "ep_sekolah");
   $ppd          = infoAwan($sekolah, "ppd", "ep_sekolah");
   $darjah       = $row["KODTINGKATAN/TAHUN"];
   $namakelas    = $row["NAMAKELAS"];

   if ($CURUSER["class"] > 2) {

    $linki = "javascript:maksekt(\"$kodsekolah\")";
   } else {

    $linki = "#";
   }

   if ($statusaliran == "3") {

    $status = "DISIPLIN";
   } elseif ($statusaliran == "4") {

    $status = "NORMAL";
   } elseif ($statusaliran == "5") {

    $status = "LINUS";
   } elseif ($statusaliran == "6") {

    $status = "SAUDARA BAHARU";
   } elseif ($statusaliran == "7") {

    $status = "SAKIT";
   } elseif ($statusaliran == "8") {

    $status = "TIDAK BERKENAN";
   } elseif ($statusaliran == "31") {

    $status = "INKLUSIF PENUH";
   } elseif ($statusaliran == "32") {

    $status = "INKLUSIF SEPARA";
   } elseif ($statusaliran == "33") {

    $status = "MASALAH PENGLIHATAN";
   } elseif ($statusaliran == "34") {

    $status = "MASALAH PENDENGARAN";
   } elseif ($statusaliran == "36") {

    $status = "PPKI PENGLIHATAN";
   } elseif ($statusaliran == "37") {

    $status = "PPKI PENDENGARAN";
   } elseif ($statusaliran == "38") {

    $status = "PPKI PEMBELAJARAN";
   } elseif ($statusaliran == "40") {

    $status = "TIDAK BOLEH DINILAI";
   }

   if ($janti == "L") {

    $janti = "<img width='48' src='images/avatar1.png'>";
   } elseif ($janti == "P") {

    $janti = "<img width='48' src='images/avatar2.png'>";
   }

   echo "<tr class='small'><td align='center'>$e</td>
            <td><a href='$linki'>$janti</a></td>
            ";

   if ($CURUSER["id"] == $user || $CURUSER["class"] >= "4") {
    $edit   = "<a title='Padam data murid' onclick=\"return confirm('Anda pasti mahu memadam data ini?');\" href='sekolah.php?mode=pdmsek&id=$id'><img width='24' src='images/icons/ragu.png'></a>";
    $export = "<a title='Eksport data murid' href='download.php?mode=exportdatamurid&id=$id'><img width='24' src='images/icons/database.png'></a>";
   } else {
    $edit   = "<span class='label label-warning'>LIMITED</span>";
    $export = "";
   }

   echo "<td><div style='font-size:9px'>$nmsek ($kodsekolah)</div><strong><a href='murid.php?mode=profil&id=$id'>$nama</a></strong><br>$nokp <span class='label label-primary'>$status</span></td>
            <td align='center'>$darjah</td>
            <td align='center'>$namakelas</td>
            <td width=50 align=center>
            $edit $export
            </td></tr>";
   $e++;
  }
  echo "</tbody></table>";
 }

 echo "</div>";
}