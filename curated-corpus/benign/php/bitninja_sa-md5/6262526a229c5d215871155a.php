<?php include("header.php");?>

				<div class="page-content">
					<div class="page-header position-relative">
						<h1>
							Add Blogs 
							<small>
								<i class="icon-double-angle-right"></i>
								 
							</small>
						</h1>
					</div><!--/.page-header-->


			
					<div class="row-fluid">
						<div class="span12">
							<!--PAGE CONTENT BEGINS-->
 
							<form class="form-horizontal" action="" method="post" enctype="multipart/form-data" >

 
 
  <div class="control-group">									
 <label class="control-label" for="form-field-2"> Heading</label>		
 <div class="controls">		
 <input type="text"   name="heading" id="form-field-2" placeholder=" Heading"/>	
 </div>	
 </div>
 
 
							 
								 
								<div class="control-group">
									<label class="control-label" for="form-field-2">Image</label>

									<div class="span4">
                           <input  name="files[]" type="file" id="id-input-file-3" />
 
									</div>
								</div>
								
							


								
								
								
								<div class="form-actions">
									<button class="btn btn-info" name="submit" type="submit">
										<i class="icon-ok bigger-110"></i>
										Submit
									</button>
 				 
</form>

									
								</div>

<?php
						 include("config.php");
 				if(isset($_POST['submit'])) 
 {
 //$id=$_GET['id'];
if(isset($_FILES['files'])){
		//This function reads the extension of the file. It is used to determine if the file  is an image by checking the extension.
 function getExtension($str) {
         $i = strrpos($str,".");
         if (!$i) { return ""; }
         $l = strlen($str) - $i;
         $ext = substr($str,$i+1,$l);
         return $ext;
 }
//$fn = $_POST['fn'];
    $errors= array();
	foreach($_FILES['files']['tmp_name'] as $key => $tmp_name ){
		$file_name = $key.$_FILES['files']['name'][$key];
		$file_size =$_FILES['files']['size'][$key];
		$file_tmp =$_FILES['files']['tmp_name'][$key];
		$file_type=$_FILES['files']['type'][$key];	
		if($file_size > 2222097152){
			$errors[]='File size must be less than 2 MB';
			
        }	
			//get the extension of the file in a lower case format
  		 $extension = getExtension($file_name);
 		$extension = strtolower($extension);
 	//if it is not a known extension, we will suppose it is an error and will not  upload the file,  
	//otherwise we will do more tests
 if (($extension != "jpg") && ($extension != "JPG") && ($extension != "jpeg") && ($extension != "png") && ($extension != "gif")) 
 		{
		//print error message
 			
 		 $errors=1;
 		}
		
		else
		{
        $desired_dir="gallery";
        if(empty($errors)==true){
            if(is_dir($desired_dir)==false){
                mkdir("$desired_dir", 0700);		// Create directory if it does not exist
            }
            if(is_dir("$desired_dir/".$file_name)==false){
                move_uploaded_file($file_tmp,"gallery/".$file_name);
            }else{									//rename the file if another one exist
                $new_dir="gallery/".$file_name.time();
                 rename($file_tmp,$new_dir) ;				
            }
            
        }		
	$heading=$_POST['heading'];
		
		 $query="INSERT INTO gallery(image,heading)
 VALUES('$file_name','$heading')";
if (!mysqli_query($con,$query)) 
{
  echo "Error Inserting Data";
  }			
		
		else{
                //print_r($errors);
        }
    }
	}
	if(!$errors){
		echo "<script language='javascript'>
{
  alert(' Uploaded Successfully.');	
   
}
</script>
<meta http-equiv='REFRESH' content='0;url=add-gallery.php'></HEAD>
 
<BODY>
Please wait...Redirecting to the Main Page
</BODY>'";
	}
	else
	{
	echo "<script language='javascript'>
{
  alert(' Choose only image files.');	
   
}
</script>
<meta http-equiv='REFRESH' content='0;url=add-gallery.php'></HEAD>
 
<BODY>
Please wait...Redirecting to the Main Page
</BODY>'";
	}
}
 }
 
?>
	
 


 					
											 
 
 

						 
						</div><!--/.span-->
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->

				<?php include("footer.php");?>