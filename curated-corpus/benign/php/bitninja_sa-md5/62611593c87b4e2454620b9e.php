<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<title>Booking Calendar - Create Calendar File</title>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />



</head>

<body>

 <?php

     function addDayToDate($timeStamp){

         // Add one day, mktime will accumulate to the next month / year.

         $thePHPDate = getdate($timeStamp);
         $thePHPDate['mday'] = $thePHPDate['mday'] + 1;
         $timeStamp = mktime($thePHPDate['hours'], $thePHPDate['minutes'], $thePHPDate['seconds'], $thePHPDate['mon'], $thePHPDate['mday'], $thePHPDate['year']);
         return $timeStamp;
    }

   ?>

<?php

    $today = date("d/m/y");

	$todayExp = explode("/", $today);

	$todayTS = mktime(0, 0, 0, $todayExp[1], $todayExp[0], $todayExp[2]);


	$roomname[] =  $_POST['room1'];

	$roomname[] =  $_POST['room2'];

	$roomname[] =  $_POST['room3'];

	$roomname[] =  $_POST['room4'];

	$roomname[] =  $_POST['room5'];

	$roomname[] =  $_POST['room6'];


?>

  <p>Creating Calendar CSV DataFile</p>

	<?php

	$CSVfile =  "calendar.csv";

	$file_handle = fopen($CSVfile, 'w');

	fwrite($file_handle, "Date");

	for ( $counter = 0; $counter <= 5; $counter += 1) {

	    if ( $roomname[$counter] <> "" ) {
		     $room =   ",". $roomname[$counter];
             fwrite($file_handle, $room );
             }
        }

	fwrite($file_handle, "\n");

				$availability = "";

			 for ( $counter = 0; $counter <= 5; $counter += 1) {

			 	    if ( $roomname[$counter] <> "" ) {
			 		     $availability =  $availability. ",v";
					    }
        }


		$dateTS = $todayTS;

		for ( $daycount = 0; $daycount <= 364; $daycount += 1) {


		 $availST =  $dateTS. $availability."\n";

		fwrite($file_handle, $availST );

		 $dateTS = addDayToDate($dateTS);

		 }

	fclose($file_handle);


	  ?>
   <p>Calendar CSV DataFile finished</P.


<!--	 $file_handle = fopen("make_calendar.csv", "w");

	 $line_of_text = fgetcsv($file_handle, 1024);

	  print $line_of_text[0]."   ". $line_of_text[1]. "    ". $line_of_text[2] . "<BR>";



	 while (!feof($file_handle)) {

      $line_of_text = fgetcsv($file_handle, 1024);


	 $calDateExp = explode("/", $line_of_text[0]);

	 $calTS = mktime(0, 0, 0, $calDateExp[2], $calDateExp[0], $calDateExp[1]);




	if ($calTS >= $todayTS)	{
	 print "  ". $line_of_text[0]."    ". $line_of_text[1]. "    ". $line_of_text[2] . "<BR>";

	   }
	 }

	 fclose($file_handle);	 -->



</body>
</html>
