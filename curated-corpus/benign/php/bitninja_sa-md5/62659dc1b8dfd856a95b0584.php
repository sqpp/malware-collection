<?php session_start(); ?>

<?php
include("include/conn.php");


$sel_query = "select * from tbl_careeer where del=0 and status='0'";
$sel_result1 = mysqli_query($conn,$sel_query);

if(isset($_GET['position'])&&isset($_GET['jobId']))
{
  $appPosition = $_GET['position'];
  $jobId = $_GET['jobId'];
}

if(isset($_POST['btnSave']) && $_POST['g-recaptcha-response']!="")
{
  $secret = '6LfJqVMUAAAAANw33ouTMowm4gwbpe41LufQDRbW';
  $verifyResponse = file_get_contents('https://www.google.com/recaptcha/api/siteverify?secret='.$secret.'&response='.$_POST['g-recaptcha-response']);
  $responseData = json_decode($verifyResponse);
  if($responseData->success)
  {
	  $txtFname = $_POST['txtFname'];
	  $txtAddress = $_POST['txtAddress'];
	  $txtCity = $_POST['txtCity'];
	  $txtEmail = $_POST['txtEmail'];
	  $txtPhone = $_POST['txtPhone'];
	  $txtHq = $_POST['txtHq'];
	  $txtWork = $_POST['txtWork'];
	  $txtEmplr = $_POST['txtEmplr'];
	  $txtNotice = $_POST['txtNotice'];
	  $txtApply = $_POST['txtApply'];
	  $txtDate = $_POST['txtDate'];

	  $selCanStatus = "select count(*) as counterCan from tbl_career_apply where apply_for=$txtApply and (email='$txtEmail' or phone='$txtPhone')";
	  $selResCS = mysqli_query($conn, $selCanStatus);
	  $selres2 = mysqli_fetch_array($selResCS);
	  if ($selres2['counterCan'] == 0)
	  {
	  	  $getjTitle = "select designation from tbl_careeer where car_id=$txtApply";
	  	  $selResJtitle = mysqli_query($conn, $getjTitle);
		  $getresJttile = mysqli_fetch_array($selResJtitle);
		  $curdesig = $getresJttile['designation'];

		  if(isset($_FILES['txtFile']))
		    {
		      $file1 = $_FILES['txtFile'];

		      //file properties

		      $file1_name=$file1['name'];
		      $file1_tmp=$file1['tmp_name'];
		      $file1_error=$file1['error'];

		      //file extension

		      $file_ext=explode('.',$file1_name);
		      $file_ext = strtolower($file1_name);

		      if($file1_error==0)
		      {
		        $file1_new = uniqid('',true).'.'.$file_ext;
		        $file1_destination='img_upload/'.$file1_new;
		        move_uploaded_file($file1_tmp,$file1_destination);
		      }

		      if(isset($file1_destination))
		      {
		        $txtFile=$file1_destination;
		        
		      }
		      else
		      {
		        $txtFile="";
		      }
		    }
		    else
		    {
		    	echo "file not found";
		    }


		  	$query = "insert into tbl_career_apply values(null,'{$txtFname}','{$txtAddress}','{$txtCity}','{$txtEmail}','{$txtPhone}','{$txtHq}','{$txtWork}','{$txtEmplr}','{$txtNotice}','{$txtApply}','{$txtFile}','{$txtDate}',1)";
		      
		        if(mysqli_query($conn,$query))
		        {
		          //header("Location:career-apply.php"); 
	                  echo '<script type="text/javascript">';
					  echo 'setTimeout(function () { swal(
						                                    "Thank you",
						                                    "You have successfully apply",
						                                    "success"
					                                      );';
					  echo '}, 1000);</script>';
		        }
		        else
		        {
		          //echo $query;
	                  echo '<script type="text/javascript">';
					  echo 'setTimeout(function () { swal(
					                                       "Oops...",
					                                       "Something went wrong",
					                                       "error"
					                                     );';
					  echo '}, 1000);</script>';
		        }

		        $txtEmail = $txtEmail;
		       	$message="Dear, $txtFname <br><br> you have successfully applied for the $curdesig position at Technobits Digital. <br><br>
		       		For any queries contact us on (0265)230-4988 or email at career@technobitsdigital.com<br><br>
		       		Regards<br><br>
		       		<h2>Technobits Digital</h2>
					Salman Pahadi<br>
					Technical Director,<br>
					m: +91 9726589144<br>
					e: career@technobitsdigital.com<br>
					w: www.technobitsdigital.com<br>
					";
		       	include("include/mail_apply_car.php");
	  }
	  else
	  {
			echo '<script type="text/javascript">';
			echo 'setTimeout(function () { swal(
			                               "Can\'t Proceed...",
			                               "You have already applied for this position",
			                               "warning"
			                             );';
			echo '}, 1000);</script>';
	  }
  }
}


?>

<!DOCTYPE html>
<html lang="en">
	<head>
		<?php include ("include/alexa-certify.php");?>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="images/favicon.png"/>
		<title>Technobits Digital | career-apply</title>
		<meta name="description" content="" />
		<meta name="Author" content="" />

		<!-- mobile settings -->
		<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0" />
		<!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->

		<!-- WEB FONTS : use %7C instead of | (pipe) -->
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600%7CRaleway:300,400,500,600,700%7CLato:300,400,400italic,600,700" rel="stylesheet" type="text/css" />

		<!-- CORE CSS -->
		<link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		
		<!-- SWIPER SLIDER -->
		<link href="css/swiper.min.css" rel="stylesheet" type="text/css" />

		<!-- THEME CSS -->
		<link href="assets/css/essentials.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/layout.css" rel="stylesheet" type="text/css" />

		<!-- PAGE LEVEL SCRIPTS -->
		<link href="assets/css/header-1.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/color_scheme/green.css" rel="stylesheet" type="text/css" id="color_scheme" />

		<!--Custom-->
		<link rel="stylesheet" type="text/css" href="css/custom.css">
		<link rel="stylesheet" type="text/css" href="css/custom2.css">
		<link rel="stylesheet" type="text/css" href="css/set2.css">
		<link rel="stylesheet" type="text/css" href="css/sweetalert2.css">
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">

        <!-- google recaptcha -->
        <script src='https://www.google.com/recaptcha/api.js'></script>
	</head>

	<!--
		AVAILABLE BODY CLASSES:
		
		smoothscroll 			= create a browser smooth scroll
		enable-animation		= enable WOW animations

		bg-grey					= grey background
		grain-grey				= grey grain background
		grain-blue				= blue grain background
		grain-green				= green grain background
		grain-blue				= blue grain background
		grain-orange			= orange grain background
		grain-yellow			= yellow grain background
		
		boxed 					= boxed layout
		pattern1 ... patern11	= pattern background
		menu-vertical-hide		= hidden, open on click
		
		BACKGROUND IMAGE [together with .boxed class]
		data-background="assets/images/_smarty/boxed_background/1.jpg"
	-->
	<body class="smoothscroll enable-animation">
		<?php include_once("include/analyticstracking.php") ?>
		<!-- SLIDE TOP -->
		
		<!-- /SLIDE TOP -->


		<!-- wrapper -->
		<div id="wrapper">

			<!-- 
				AVAILABLE HEADER CLASSES

				Default nav height: 96px
				.header-md 		= 70px nav height
				.header-sm 		= 60px nav height

				.b-0 		= remove bottom border (only with transparent use)
				.transparent	= transparent header
				.translucent	= translucent header
				.sticky			= sticky header
				.static			= static header
				.dark			= dark header
				.bottom			= header on bottom
				
				shadow-before-1 = shadow 1 header top
				shadow-after-1 	= shadow 1 header bottom
				shadow-before-2 = shadow 2 header top
				shadow-after-2 	= shadow 2 header bottom
				shadow-before-3 = shadow 3 header top
				shadow-after-3 	= shadow 3 header bottom

				.clearfix		= required for mobile menu, do not remove!

				Example Usage:  class="clearfix sticky header-sm transparent b-0"
			-->
			<?php include ("include/navbar.php");?>


			<!-- SLIDER -->
			<section id="slider" class="" style="background:url('images/particles_bg.jpg'); max-height: 300px;">
				<span class="overlay dark-2"><!-- dark overlay [0 to 9 opacity] --></span>

				<canvas id="canvas-particle" data-rgb="156,217,249"> <!--CANVAS PARTICLES--> </canvas>

				<div class="display-table">
					<div class="display-table-cell vertical-align-middle">
						
						<div class="container">
							
							<section class="page-header">
								<div class="" style="margin-top: 130px;">

									<h3>Apply Now</h3>

									<!-- breadcrumbs -->
									<ol class="breadcrumb" style="margin-top: 30px; color: #fff;">
										<li><a href="#" style="color: #fff;">Home</a></li>
										<li class=""><a href="#" style="color: #fff;">Career Page</a></li>
										<li class="active">Apply Now</li>
									</ol><!-- /breadcrumbs -->

								</div>
							</section>
							<!--
							<p class="lead font-lato fs-30 wow fadeInUp" data-wow-delay="0.7s">
								Over <span class="countTo" data-speed="4000">550</span> html files! 
								<span class="theme-color fw-400 font-style-italic">Admin included</span> &amp; RTL
							</p>
							-->
							

						</div>

					</div>
				</div>

			</section>
			<!-- /SLIDER -->

			<section class="">
					<div class="container">
						<div class="row">
							<div class="col-md-4 col-sm-4">
								<form action="career-apply.php" method="post" enctype="multipart/form-data">
									<fieldset>
										<h2>Application Form</h2>
										<div class="row">
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="Full Name" class="form-control custom-contact" name="txtFname" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="Address" class="form-control custom-contact" name="txtAddress" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="City" class="form-control custom-contact" name="txtCity" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="email" placeholder="Email" class="form-control custom-contact" name="txtEmail" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" class="form-control custom-contact" name="txtPhone" id="txtPhone" placeholder="Phone">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="Highest Qualification" class="form-control custom-contact" name="txtHq" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="Work Experience" class="form-control custom-contact" name="txtWork" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="Current Employer" class="form-control custom-contact" name="txtEmplr" id="">
											</div>
											<div class="col-md-12 mb-20">
												<input required type="text" placeholder="Notice Period" class="form-control custom-contact" name="txtNotice" id="">
											</div>

											<div class="col-md-12 mb-20">
												<select class="form-control pointer custom-contact" name="txtApply">
													<option value="">--- Apply for ---</option>
													<?php while ($selres4 = mysqli_fetch_array($sel_result1)){
                                    				?>
														<option value="<?php echo $selres4['car_id']; ?>" <?php if(isset($_GET['position'])&&isset($_GET['jobId'])) { if($jobId == $selres4['car_id']) { echo 'selected'; } } ?> ><?php echo $selres4['designation']; ?></option>
													<?php } ?>
												</select>
											</div>
										</div>
										<div class="row">
											<div class="col-md-12 mb-20">
												<!-- custom file upload -->
												<input class="custom-file-upload" type="file" id="txtFile" name="txtFile" data-btn-text="Select a File" placeholder="upload CV" />
												<small class="text-muted block">Attach only pdf file</small>

											</div>
											<div class="col-md-12 mb-20">
												<div class="g-recaptcha" data-sitekey="6LfJqVMUAAAAAOcorRHsM9LNVamqn5zr63l8mcNa"></div>
											</div>
										</div>
										<input type="date" name="txtDate" hidden value="<?php echo date("Y-m-d");?>">

										<div class="row">
											<div class="col-md-12 mb-20">
												<button type="submit" name="btnSave" id="btnSave" class="btn btn-primary"><i class="fa fa-check"></i>APPLY</button>
											</div>
										</div>
									</fieldset>

								</form>
							</div>
							<div class="col-md-8 col-sm-8 col-xs-12 text-center">
								<p class="dropcap" align="justify" style="color: #000; font-family: 'Raleway', sans-serif;">We’re a one of the most emerging global software company with a start-up mentality. Our leadership team is always available for help, believe in team work with positive attitude and fresh perspectives are not only encouraged, they’re celebrated.
								TechnoBits Digital was born from the idea to make this world more digital and provide technical IT solutions to real life challenges. After joining us you will find new challenge every day.  We believe that people have wisdom that’s worth listening to, learning from and acting on. Be one of those people at TechnoBits Digital.
								</p>
								<img src="/images/Jointeam4.png" class="img-responsive" width="600px">
							</div>
						</div>
					</div>
			</section>
			
			<!-- CALLOUT -->
			
			<!-- /CALLOUT -->



			<!-- FOOTER -->
			<?php include("include/footer.php");?>
			<!-- /FOOTER -->

		</div>
		<!-- /wrapper -->


		<!-- SCROLL TO TOP -->
		<a href="#" id="toTop"></a>


		<!-- PRELOADER -->
		<div id="preloader">
			<div class="inner">
				<span class="loader"></span>
			</div>
		</div><!-- /PRELOADER -->

		<!--fixed button-->
			<a href="request-quotation.php" id="fixed-button"><img src="images/Request_quotation-01.png" class="fixed-btn-img"></a>
		<!-- /fixed button-->

		<!-- JAVASCRIPT FILES -->
		<script type="text/javascript">var plugin_path = 'assets/plugins/';</script>
		<script type="text/javascript" src="assets/plugins/jquery/jquery-3.2.1.min.js"></script>

		<script type="text/javascript" src="assets/js/scripts.js"></script>
		
		<!-- STYLESWITCHER - REMOVE -->
		<script async type="text/javascript" src="demo_files/styleswitcher/styleswitcher.js"></script>

		<!-- PARTICLE EFFECT -->
		<script type="text/javascript" src="assets/plugins/effects/canvas.particles.js"></script>

		<!--Input type style-->
		<script src="js/classie.js"></script>
		
		<script src="js/sweetalert2.js"></script>

		<script>
			(function() {
				// trim polyfill : https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim
				if (!String.prototype.trim) {
					(function() {
						// Make sure we trim BOM and NBSP
						var rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
						String.prototype.trim = function() {
							return this.replace(rtrim, '');
						};
					})();
				}

				[].slice.call( document.querySelectorAll( 'input.input__field' ) ).forEach( function( inputEl ) {
					// in case the input is already filled..
					if( inputEl.value.trim() !== '' ) {
						classie.add( inputEl.parentNode, 'input--filled' );
					}

					// events:
					inputEl.addEventListener( 'focus', onInputFocus );
					inputEl.addEventListener( 'blur', onInputBlur );
				} );

				function onInputFocus( ev ) {
					classie.add( ev.target.parentNode, 'input--filled' );
				}

				function onInputBlur( ev ) {
					if( ev.target.value.trim() === '' ) {
						classie.remove( ev.target.parentNode, 'input--filled' );
					}
				}
			})();
		</script>

		<!-- /input type -->

	<script>
  
            $('#btnSave').click(function(e){
              var txtPhone = $('#txtPhone').val();
              var valid = true;
              var errmsg = "";

              var txtFile = $('#txtFile').val().split('.').pop().toLowerCase();
				if($.inArray(txtFile, ['pdf']) == -1) {
				    valid = false;
				    errmsg=errmsg + "Please upload CV in pdf format </br>";
				}


              if(txtPhone=="")
              {
                valid = false;
                errmsg=errmsg + "Enter Contact Number <br/>";
              }
              if (isNaN(txtPhone) == true)
              {
               valid = false;
               errmsg = errmsg + "Phone No Should be Numeric <br/>";
               }
              if (txtPhone.length != 10)
              {
               valid = false;
              errmsg = errmsg + "Phone No Should be of 10 Digits <br/>";
              }

			  if(valid==true)
              {
                return(true);
              }
              else
              {
                swal({
                title: 'Error!',
                html: errmsg,
                type: 'error',
                confirmButtonText: 'OK'
                })
                return(false);
              }

            });
            
        </script>
        <script type="text/javascript">
		  $('form').on('submit', function(e) {
		    if(grecaptcha.getResponse() == "") {
		      e.preventDefault();
		      sweetAlert("You can't proceed! Invalid Captcha");
		    }
		  });
		</script>
	</body>
</html>