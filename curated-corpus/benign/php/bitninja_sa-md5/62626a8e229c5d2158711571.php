<?php
	session_start();
	
	
	if(!isset($_SESSION['USER_ID']) || (trim($_SESSION['USER_ID']) == '')) 
	{
		session_destroy();		
		header("location:login.php");
		exit();
	}
	date_default_timezone_set('Asia/Colombo');
	require_once('config/config.php');				
	require_once('include/connect_to_db.php');
	$a=0;	
?>




<?php

include ("includes/db.php");
	if(isset($_POST['insert_property'])){


		global $con;
		//GETTING THE TEXT DATA FROM THE FIELDS

		$property_title=$_POST['property_title'];
		$property_owner=$_POST['property_owner'];
	
		$property_cat=$_POST['property_cat'];
		$property_type=$_POST['property_type'];
		
		$property_desc=$_POST['property_desc'];
		$bed=$_POST['bed'];
		$bath=$_POST['bath'];
		$property_loc=$_POST['property_loc'];
		$property_keywords=$_POST['property_keywords'];

		//GETTING THE IMAGE FROM THE FIELD
		$target_dir = "property_images/";
		$target_file = $target_dir . basename($_FILES["property_image"]["name"]);
		$uploadOk = 1;
		$imageFileType = pathinfo($target_file,PATHINFO_EXTENSION);


			if (move_uploaded_file($_FILES["property_image"]["tmp_name"], $target_file))
			{
				//echo "The file ". basename( $_FILES["fileToUpload"]["name"]). " has been uploaded.";
				$property_image=basename( $_FILES["property_image"]["name"]);



				$insert_list= "insert into property(property_cat,property_type,property_title,property_owner,property_image,property_desc,bed,bath,property_loc,property_keywords) values($property_cat,$property_type,'$property_title','$property_owner','$property_image','$property_desc',$bed,$bath,$property_loc,'$property_keywords')";


								$insert_pro=mysqli_query( $con,$insert_list);

						if ($insert_pro)
					{
						$added = '<div class="alert alert-success">
						  <strong>Success!</strong> Property has been successfully added to the property_list.<br>
						  "The file ". basename( $_FILES["property_image"]["name"]). " has been uploaded.";
						 </div>';
					}
					else
					{
						$added='<div class="alert alert-danger">
									<strong>Failed!</strong> contact System Adminstrator.'.mysqli_error().'
								</div>';
					}


			} else {
				$added='<div class="alert alert-danger">
				<strong>Failed!</strong> Sorry, there was an error uploading your file.
				</div>';
				echo "";
			}





	}
	?>

<!DOCTYPE html>
<?php include ("includes/db.php"); ?>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Admin</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <link rel="shortcut icon" href="">
    <link rel="stylesheet" href="dist/css/skins/skin-blue.min.css">
     <link href="bootstrap1/css/bootstrap.min.css" rel="stylesheet">
    <link href="/diva/style/style.css" rel="stylesheet">


    
  </head>
  
  <body class="hold-transition skin-blue  sidebar-mini" onload="startTime()">
    <div class="wrapper">

      <!-- Main Header -->
      <header class="main-header">

        <!-- Logo -->
        <a href="index.php" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels -->
          <span class="logo-mini"><b></b></span>
          <!-- logo for regular state and mobile devices -->
          <span class="logo-lg"><b><img src="" height=35% width=35%></b></span>
        </a>

        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" role="navigation">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
          <!-- Navbar Right Menu -->
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
      
              <!-- User Account Menu -->
              <li class="dropdown user user-menu">
                <!-- Menu Toggle Button -->
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <!-- The user image in the navbar-->
                  <img src="dist/img/avatar5.png" class="user-image" alt="User Image">
                  <!-- hidden-xs hides the username on small devices so only the image appears. -->
                  <span class="hidden-xs"><?php echo $_SESSION['NAME'].' ' ;?><i class="fa fa-gear "></i></span>
                </a>
                <ul class="dropdown-menu">
                  <!-- The user image in the menu -->
                  <li class="user-header">
                    <img src="dist/img/avatar5.png" class="img-circle" alt="User Image">
                    <p>Hello ! <?php echo $_SESSION['NAME'];?></p>
                  </li>
                  
                  <!-- Menu Footer-->
                  <li class="user-footer">
                    
                    <div class="pull-right">
                      <a href="login.php?logout=true" data-toggle="tooltip" data-original-title="Logout" class="btn btn-default btn-flat">Sign out</a>
                    </div>
                  </li>
                </ul>
              </li>
              <!-- Control Sidebar Toggle Button -->
              
            </ul>
          </div>
        </nav>
      </header>
      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">

        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">

          <!-- Sidebar user panel (optional) -->
          <div class="sidebar"> 
            <div class="small-box bg-aqua">
                <div class="inner">
                  <center><h1><b class="sidebar"><div id="clock"></div></b></h1>
                  <h4><?php echo  date("Y-m-d ");?></h4></center>
                </div>
				
             
              </div>
          </div>

          <!-- search form (Optional) -->
          <form action="#" method="get" class="sidebar-form">
            <div class="input-group">
              <input type="text" name="q" class="form-control" placeholder="Search...">
              <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button>
              </span>
            </div>
          </form>
          <!-- /.search form -->

          <!-- Sidebar Menu -->
          <ul class="sidebar-menu">
            <li class="header">MENU</li>
            <!-- Optionally, you can add icons to the links -->
			<li class="active"><a href="index.php"><i class="fa fa-dashboard"></i> <span>Dashboard</span></a></li>
            <li class="active"><a href="product.php"><i class="fa  fa-users"></i> <span>Product</span></a></li>
            <li class="active"><a href="edit.php"><i class="fa  fa-users"></i> <span>Edit</span></a></li>
            
            <li><a href="message.php"><i class="fa fa-envelope-o"></i> <span>message box</span></a></li>
				<li class="treeview">
              <a href="#"><i class="fa  fa-users"></i> <span>User</span> <i class="fa fa-angle-left pull-right"></i></a>
              <ul class="treeview-menu">
				<li><a href="user.php">Users List</a></li>
                <li><a href="adduser.php">Add new User</a></li>
              </ul>
            </li>
			
          </ul><!-- /.sidebar-menu -->
        </section>
        <!-- /.sidebar -->
      </aside>

      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <h1>
            DASH BOARD
            <small>Diva home designer and builder</small>
          </h1>
           <hr>
        </section>

        <!-- Main content -->
        <section class="content">
		<div class="row">
          
            
               
              
             
    <?php if(isset($added)){ echo $added.'</br>';} ?>
    <?php if(isset($id_error)){ echo $id_msg.'</br>';} ?>

	<form class="form-horizontal" action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post" enctype="multipart/form-data" >
	<fieldset>
                    <legend>Add Property </legend>
	<div class="form-group">
		<label class="control-label col-xs-3">Property Title :</label>
		<div class="col-xs-4">
			<input type="input" class="form-control" name="property_title" required >
		</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3">Property Owner :</label>
		<div class="col-xs-4">
		<input type="input" class="form-control" name="property_owner" required >
			
		</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3">Property Category :</label>
		<div class="col-xs-4">
		<select class="form-control" name="property_cat" required >
			<?php
				$get_cats="select * from categories";

				$run_cats=mysqli_query( $con,$get_cats);

				while($row_cats = mysqli_fetch_array($run_cats)){

					$cat_id=$row_cats['cat_id'];
					$cat_title=$row_cats['cat_title'];
					echo "<option value='$cat_id'>$cat_title</option>";
				}
			?>
		</select>
		</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3">Property Type:</label>
		<div class="col-xs-4">
		<select class="form-control" name="property_type" required>
			<?php
				$get_types="select * from types";

				$run_types=mysqli_query( $con, $get_types);

				while($row_types = mysqli_fetch_array($run_types)){

					$type_id=$row_types['type_id'];
					$type_title=$row_types['type_title'];
					echo "<option value='$type_id'>$type_title</option>";
				}
			?>
		</select>
	</div>
	</div>

	<div class="form-group">
		<label class="control-label col-xs-3">Property Image :</label>
		<div class="col-xs-4">
			<input type="file" class="form-control" name="property_image" required >
		</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3"></label>
		<div class="col-xs-4">
		
	</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3">Location :</label>
		<div class="col-xs-4">
		<select class="form-control" name="property_loc" required>
			<?php
				$get_location="select * from location";

				$run_location=mysqli_query( $con,$get_location);

				while($row_location = mysqli_fetch_array($run_location)){

					$location_id=$row_location['location_id'];
					$location_title=$row_location['location_title'];
					echo "<option value='$location_id'>$location_title</option>";
				}
			?>
		</select>
	</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3">Number of Bedrooms :</label>
		<div class="col-xs-4">
		<select class="form-control" name="bed" required>
			<?php
				$get_bed="select * from beds";

				$run_bed=mysqli_query( $con,$get_bed);

				while($row_bed = mysqli_fetch_array($run_bed)){

					$bed_id=$row_bed['bed_id'];
					$no_of_beds=$row_bed['no of beds'];
					echo "<option value='$bed_id'>$no_of_beds</option>";
				}
			?>
		</select>
	</div>
	</div>
	<div class="form-group" >
		<label class="control-label col-xs-3">Number of Bathsrooms:</label>
		<div class="col-xs-4">
		<select class="form-control" name="bath" required>
			<?php
				$get_bath="select * from baths";

				$run_bath=mysqli_query( $con,$get_bath);

				while($row_bath = mysqli_fetch_array($run_bath)){

					$baths_id=$row_bath['baths_id'];
					$no_of_baths=$row_bath['no_of_baths'];
					echo "<option value='$baths_id'>$no_of_baths</option>";
				}
			?>
		</select>
	</div>
	</div>
	<div class="form-group">
		<label class="control-label col-xs-3">Property Description:</label>
		<div class="col-xs-4">
			<textarea class="form-control" name="property_desc"  row="10"></textarea>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label col-xs-3">Property Keywords :</label>
		<div class="col-xs-4">
			<input type="input" class="form-control" name="property_keywords" required>
		</div>
	</div>

	<div class="form-group">
		<label class="control-label col-xs-3"></label>
		</div>
		<div class="col-xs-4">
	<input type="submit" name="insert_property" class="btn btn-primary" value="insert property">
	</div>
	</fieldset>
	</form>
	 </center>
  </div>
  </div>
  </div>

              
              
              
              
              
            </div><!-- ./col -->
                    
          </div>
        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->

      <!-- Main Footer -->
      <footer class="main-footer">
        <!-- To the right -->
        
        <!-- Default to the left -->
        <strong><center>Copyright &copy; 2020 Diva home designer and builder</strong> All rights reserved.</center>
      </footer>

  

    <!-- REQUIRED JS SCRIPTS -->

    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js"></script>
<script>
function startTime() {
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    document.getElementById('clock').innerHTML =
    h + ":" + m + ":" + s;
    var t = setTimeout(startTime, 500);
}
function checkTime(i) {
    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}
</script>
     <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap1/js/bootstrap.min.js"></script>
	<script type="text/javascript">
  </div>
  </body>
</html>
