
<?php
	session_start();
	include 'includes/conn.php';

	if(isset($_POST['verify'])){
		$birth = $_POST['birth_date'];
		$newDate = date("Y-m-d", strtotime($birth));
		$mName = strtoupper($_POST['middleName']);
		$sAccount = $_POST['shareAccount'];
		$id = $_POST['id'];

		if ($birth != ""  || $birth != null || $mName != ""  || $mName != null || $sAccount != ""  || $sAccount != null) {
			# code...

			$sql = "SELECT * FROM voters_info WHERE unique_num = '$id'";
			$query = $conn->query($sql);

				if($query->num_rows < 1){
					$_SESSION['error'] = 'System Error!';
				}
				else{
					$row = $query->fetch_assoc();
					$share_account = $row['share_account'];
					$middle = strtoupper($row['middle_name']);
					$ShareAccount = substr($share_account, -4);
					
					if($newDate == $row['birth_date'] && $row['birth_date'] != "" ){
						$_SESSION['voter'] = $row['unique_num'];
					}
					else if($mName == $middle && $middle != "" ){
						$_SESSION['voter'] = $row['unique_num'];
					}
					else if($sAccount == $ShareAccount && $ShareAccount != ""){
						$_SESSION['voter'] = $row['unique_num'];
					}
					else{
						$_SESSION['error'] = 'Incorrect input verification';
					}
				}
		}
		else{
			$_SESSION['error'] = 'Input verification first';
		}
		
	}
	else{
		$_SESSION['error'] = 'System Error!';
	}

	header('location: index.php');

?>