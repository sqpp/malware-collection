<?php
	include '../connection/connection.php';
	if(isset($_POST['updPackage']))
	{
		$tmpID = $_POST['tmpID'];
		$qry = "SELECT * FROM package WHERE id='$tmpID'";
		$res = mysqli_query($conn,$qry);
		$row = mysqli_fetch_array($res);
		// Form Data STARTS Here ///
		$mcat = $_POST['mcat'];
		$scat = $_POST['scat'];
		$sscat = $_POST['sscat'];
		$p_title = $_POST['p_title'];
		$image = $_FILES['image']['name'];
		$bimage = $_FILES['bimage']['name'];
		$day = $_POST['day'];
		$night = $_POST['night'];
		$hotspot = $_POST['hotspot'];
		$price = $_POST['price'];
		$person = $_POST['person'];
		$rating = $_POST['rating'];
		$services = implode(',',$_POST['services']);
		$overview = str_replace("'","",$_POST['overview']);
		
		// Iternery Data STARTS Here ///
		$d1info = str_replace("'","",$_POST['d1info']);
		$d2info = str_replace("'","",$_POST['d2info']);
		$d3info = str_replace("'","",$_POST['d3info']);
		$d4info = str_replace("'","",$_POST['d4info']);
		$d5info = str_replace("'","",$_POST['d5info']);
		$d6info = str_replace("'","",$_POST['d6info']);
		$d7info = str_replace("'","",$_POST['d7info']);
		$d8info = str_replace("'","",$_POST['d8info']);
		$d9info = str_replace("'","",$_POST['d9info']);
		$d10info = str_replace("'","",$_POST['d10info']);
		$d11info = str_replace("'","",$_POST['d11info']);
		$d12info = str_replace("'","",$_POST['d12info']);
		$d13info = str_replace("'","",$_POST['d13info']);
		$d14info = str_replace("'","",$_POST['d14info']);
		$d15info = str_replace("'","",$_POST['d15info']);
		
		// Iternery Data ENDS Here ///
		$inclusion = str_replace("'","",$_POST['inclusion']);
		$exclusion = str_replace("'","",$_POST['exclusion']);
		$terms = str_replace("'","",$_POST['terms']);
		
		// Processing Images STARTS Here //
		if(!$_FILES['image']['name']=='')
		{
			$imgext = pathinfo($_FILES['image']['name'],PATHINFO_EXTENSION);
			$newtit = explode(' ',$p_title);
			if($mcat==1)
				{
					$newMimg = 'AIR_'.$newtit[0].'.'.$imgext;
				}
			else
				{
					$newMimg = $newtit[0].'.'.$imgext;
				}
		}
		else
		{
			$newMimg = $row['image'];
		}
		if(!$_FILES['bimage']['name']=='')
		{
			$bimgext = pathinfo($_FILES['bimage']['name'],PATHINFO_EXTENSION);
			$newbtit = explode(' ',$p_title);
			if($mcat==1)
				{
					$newbimg = 'AIR_'.$newbtit[0].'_banner'.'.'.$bimgext;
				}
			else
				{
					$newbimg = $newbtit[0].'_banner'.'.'.$bimgext;
				}
		}
		else
		{
			$newbimg = $row['bimage'];
		}
		if(!$_FILES['d1img']['name']=='')
		{
			$d1imgext = pathinfo($_FILES['d1img']['name'],PATHINFO_EXTENSION);
			$newd1img = $newtit[0].'day1'.'.'.$d1imgext;
		}
		else
		{
			$newd1img = $row['d1img'];
		}
		if(!$_FILES['d2img']['name']=='')
		{
			$d2imgext = pathinfo($_FILES['d2img']['name'],PATHINFO_EXTENSION);
			$newd2img = $newtit[0].'day2'.'.'.$d2imgext;
		}
		else
		{
			$newd2img = $row['d2img'];
		}
		if(!$_FILES['d3img']['name']=='')
		{
			$d3imgext = pathinfo($_FILES['d3img']['name'],PATHINFO_EXTENSION);
			$newd3img = $newtit[0].'day3'.'.'.$d3imgext;
		}
		else
		{
			$newd3img = $row['d3img'];
		}
		if(!$_FILES['d4img']['name']=='')
		{
			$d4imgext = pathinfo($_FILES['d4img']['name'],PATHINFO_EXTENSION);
			$newd4img = $newtit[0].'day4'.'.'.$d4imgext;
		}
		else
		{
			$newd4img = $row['d4img'];
		}
		if(!$_FILES['d5img']['name']=='')
		{
			$d5imgext = pathinfo($_FILES['d5img']['name'],PATHINFO_EXTENSION);
			$newd5img = $newtit[0].'day5'.'.'.$d5imgext;
		}
		else
		{
			$newd5img = $row['d5img'];
		}
		if(!$_FILES['d6img']['name']=='')
		{
			$d6imgext = pathinfo($_FILES['d6img']['name'],PATHINFO_EXTENSION);
			$newd6img = $newtit[0].'day6'.'.'.$d6imgext;
		}
		else
		{
			$newd6img = $row['d6img'];
		}
		if(!$_FILES['d7img']['name']=='')
		{
			$d7imgext = pathinfo($_FILES['d7img']['name'],PATHINFO_EXTENSION);
			$newd7img = $newtit[0].'day7'.'.'.$d7imgext;
		}
		else
		{
			$newd7img = $row['d7img'];
		}
		if(!$_FILES['d8img']['name']=='')
		{
			$d8imgext = pathinfo($_FILES['d8img']['name'],PATHINFO_EXTENSION);
			$newd8img = $newtit[0].'day8'.'.'.$d8imgext;
		}
		else
		{
			$newd8img = $row['d8img'];
		}
		if(!$_FILES['d9img']['name']=='')
		{
			$d9imgext = pathinfo($_FILES['d9img']['name'],PATHINFO_EXTENSION);
			$newd9img = $newtit[0].'day9'.'.'.$d9imgext;
		}
		else
		{
			$newd9img = $row['d9img'];
		}
		if(!$_FILES['d10img']['name']=='')
		{
			$d10imgext = pathinfo($_FILES['d10img']['name'],PATHINFO_EXTENSION);
			$newd10img = $newtit[0].'day10'.'.'.$d10imgext;
		}
		else
		{
			$newd10img = $row['d10img'];
		}
		if(!$_FILES['d11img']['name']=='')
		{
			$d11imgext = pathinfo($_FILES['d11img']['name'],PATHINFO_EXTENSION);
			$newd11img = $newtit[0].'day11'.'.'.$d11imgext;
		}
		else
		{
			$newd11img = $row['d11img'];
		}
		if(!$_FILES['d12img']['name']=='')
		{
			$d12imgext = pathinfo($_FILES['d12img']['name'],PATHINFO_EXTENSION);
			$newd12img = $newtit[0].'day12'.'.'.$d12imgext;
		}
		else
		{
			$newd12img = $row['d12img'];
		}
		if(!$_FILES['d13img']['name']=='')
		{
			$d13imgext = pathinfo($_FILES['d13img']['name'],PATHINFO_EXTENSION);
			$newd13img = $newtit[0].'day13'.'.'.$d13imgext;
		}
		else
		{
			$newd13img = $row['d13img'];
		}
		if(!$_FILES['d14img']['name']=='')
		{
			$d14imgext = pathinfo($_FILES['d14img']['name'],PATHINFO_EXTENSION);
			$newd14img = $newtit[0].'day14'.'.'.$d14imgext;
		}
		else
		{
			$newd14img = $row['d14img'];
		}
		if(!$_FILES['d15img']['name']=='')
		{
			$d15imgext = pathinfo($_FILES['d15img']['name'],PATHINFO_EXTENSION);
			$newd15img = $newtit[0].'day15'.'.'.$d15imgext;
		}
		else
		{
			$newd15img = $row['d15img'];
		}
		
		// PDF Processing STARTS Here //
		if(!$_FILES['docfile']['name']=='')
		{
			$docext = pathinfo($_FILES['docfile']['name'],PATHINFO_EXTENSION);
			if($mcat==1)
				{
					$newDoc = 'AIR_'.$newtit[0].'doc'.'.'.$docext;
				}
			else
				{
					$newDoc = $newtit[0].'doc'.'.'.$docext;
				}
		}
		else
		{
			$newDoc = $row['pdf'];
		}
		
		$qry1 = " UPDATE package SET cat='$mcat',sCat='$scat',sScat='$sscat',name='$p_title',image='$newMimg',bimage='$newbimg',day='$day',night='$night',hotspots='$hotspot',price='$price',person='$person',rating='$rating',services='$services',overview='$overview',d1img='$newd1img',d2img='$newd2img',d3img='$newd3img',d4img='$newd4img',d5img='$newd5img',d6img='$newd6img',d7img='$newd7img',d8img='$newd8img',d9img='$newd9img',d10img='$newd10img',d11img='$newd11img',d12img='$newd12img',d13img='$newd13img',d14img='$newd14img',d15img='$newd15img',inclusion='$inclusion',exclusion='$exclusion',terms='$terms',pdf='$newDoc' WHERE id='$tmpID'";
		$res1 = mysqli_query($conn,$qry1);
		if($res1){
    		$qry1_1 = "UPDATE p_info1 SET d1info='$d1info',d2info='$d2info',d3info='$d3info',d4info='$d4info',d5info='$d5info' WHERE pid='$tmpID'";
    		$res1_1 = mysqli_query($conn,$qry1_1);
    		
    		$qry1_2 = "UPDATE p_info2 SET d6info='$d6info',d7info='$d7info',d8info='$d8info',d9info='$d9info',d10info='$d10info' WHERE pid='$tmpID'";
    		$res1_2 = mysqli_query($conn,$qry1_2);
    		
    		$qry1_3 = "UPDATE p_info3 SET d11info='$d11info',d12info='$d12info',d13info='$d13info',d14info='$d14info',d15info='$d15info' WHERE pid='$tmpID'";
    		$res1_3 = mysqli_query($conn,$qry1_3);
		}
		
		if($res1)
		{
			if(!$_FILES['image']['name']=='')
			{
				unlink("../uploads/package/$row[image]");
				move_uploaded_file($_FILES['image']['tmp_name'],'../uploads/package/'.$newMimg);
			}
			if(!$_FILES['bimage']['name']=='')
			{
				unlink("../uploads/package/$row[bimage]");
				move_uploaded_file($_FILES['bimage']['tmp_name'],'../uploads/package/'.$newbimg);
			}
			if(!$_FILES['d1img']['name']=='')
			{
				unlink("../uploads/package/$row[d1img]");
				move_uploaded_file($_FILES['d1img']['tmp_name'],'../uploads/package/'.$newd1img);
			}
			if(!$_FILES['d2img']['name']=='')
			{
				unlink("../uploads/package/$row[d2img]");
				move_uploaded_file($_FILES['d2img']['tmp_name'],'../uploads/package/'.$newd2img);
			}
			if(!$_FILES['d3img']['name']=='')
			{
				unlink("../uploads/package/$row[d3img]");
				move_uploaded_file($_FILES['d3img']['tmp_name'],'../uploads/package/'.$newd3img);
			}
			if(!$_FILES['d4img']['name']=='')
			{
				unlink("../uploads/package/$row[d4img]");
				move_uploaded_file($_FILES['d4img']['tmp_name'],'../uploads/package/'.$newd4img);
			}
			if(!$_FILES['d5img']['name']=='')
			{
				unlink("../uploads/package/$row[d5img]");
				move_uploaded_file($_FILES['d5img']['tmp_name'],'../uploads/package/'.$newd5img);
			}
			if(!$_FILES['d6img']['name']=='')
			{
				unlink("../uploads/package/$row[d6img]");
				move_uploaded_file($_FILES['d6img']['tmp_name'],'../uploads/package/'.$newd6img);
			}
			if(!$_FILES['d7img']['name']=='')
			{
				unlink("../uploads/package/$row[d7img]");
				move_uploaded_file($_FILES['d7img']['tmp_name'],'../uploads/package/'.$newd7img);
			}
			if(!$_FILES['d8img']['name']=='')
			{
				unlink("../uploads/package/$row[d8img]");
				move_uploaded_file($_FILES['d8img']['tmp_name'],'../uploads/package/'.$newd8img);
			}
			if(!$_FILES['d9img']['name']=='')
			{
				unlink("../uploads/package/$row[d9img]");
				move_uploaded_file($_FILES['d9img']['tmp_name'],'../uploads/package/'.$newd9img);
			}
			if(!$_FILES['d10img']['name']=='')
			{
				unlink("../uploads/package/$row[d10img]");
				move_uploaded_file($_FILES['d10img']['tmp_name'],'../uploads/package/'.$newd10img);
			}
			if(!$_FILES['d11img']['name']=='')
			{
				unlink("../uploads/package/$row[d11img]");
				move_uploaded_file($_FILES['d11img']['tmp_name'],'../uploads/package/'.$newd11img);
			}
			if(!$_FILES['d12img']['name']=='')
			{
				unlink("../uploads/package/$row[d12img]");
				move_uploaded_file($_FILES['d12img']['tmp_name'],'../uploads/package/'.$newd12img);
			}
			if(!$_FILES['d13img']['name']=='')
			{
				unlink("../uploads/package/$row[d13img]");
				move_uploaded_file($_FILES['d13img']['tmp_name'],'../uploads/package/'.$newd13img);
			}
			if(!$_FILES['d14img']['name']=='')
			{
				unlink("../uploads/package/$row[d14img]");
				move_uploaded_file($_FILES['d14img']['tmp_name'],'../uploads/package/'.$newd14img);
			}
			if(!$_FILES['d15img']['name']=='')
			{
				unlink("../uploads/package/$row[d15img]");
				move_uploaded_file($_FILES['d15img']['tmp_name'],'../uploads/package/'.$newd15img);
			}
			if(!$_FILES['docfile']['name']=='')
			{
				unlink("../uploads/pdf/$row[pdf]");
				move_uploaded_file($_FILES['docfile']['tmp_name'],'../uploads/pdf/'.$newDoc);
			}
			$_SESSION['smsg']='Data Updated Successfuly';
			header('location:../package.php');
		}
		else
			{
				$_SESSION['smsg']='ERROR';
				header('location:../package.php');
			}
	}
?>