<?php
/**
 * Nuova Voce Menù
 * leggimenu Admin
 *
 * Copyright 2020, WEBSELF S.r.l.
 *
 */

// Config
require_once('inc/config.php');

// Session
session_start();

// Check Access
$access->is_loggedin();

// Init Objects
$item = new Item();

// Get Categorie
$categorie = $item->get_categorie( $_SESSION['id'] );

// Get Impostazioni
$impostazioni = $item->get_impostazioni( $_SESSION['id'] );

// Get Allergeni
$allergeni = $item->get_allergeni( $_SESSION['id'] );

// Insert Data
if( $_POST ){
    $result =  $item->add_voce( $_POST, $_FILES );
}

// Header Options
$meta_title = 'leggimenu Admin - Nuova Voce Menù';
$custom_assets = '';
$active_menu = 'vocimenu';

// Header inclusion
include_once( ROOT_PATH.'/header.php' );
?>

<!-- begin:: Content Head -->
<div class="kt-subheader kt-grid__item" id="kt_subheader">

    <div class="kt-subheader__main">
        <h3 class="kt-subheader__title">Nuova Voce Menù</h3>
        <span class="kt-subheader__separator kt-subheader__separator--v"></span>
        <div class="kt-subheader__breadcrumbs">
            <a href="/index.php" class="kt-subheader__breadcrumbs-link">Home</a>
            <span class="kt-subheader__breadcrumbs-separator"></span>
            <span class="kt-subheader__breadcrumbs-link">Nuova Voce Menù</span>
        </div>
    </div>

    <?php include_once( ROOT_PATH.'/parts/quick-actions.php' ); ?>

</div>
<!-- end:: Content Head -->

<!-- begin:: Content -->
<div class="kt-content kt-grid__item kt-grid__item--fluid" id="kt_content">
    <div class="row">
        <div class="col-lg-12">

            <!--begin::Portlet-->
            <div class="kt-portlet kt-portlet--last kt-portlet--head-lg kt-portlet--responsive-mobile" id="kt_page_portlet">

                <div class="kt-portlet__head kt-portlet__head--lg">
                    <div class="kt-portlet__head-label">
                        <span class="kt-portlet__head-icon">
                            <i class="kt-font-brand fa fa-utensils"></i>
                        </span>
                        <h3 class="kt-portlet__head-title">Aggiungi una nuova Voce Menù</h3>
                    </div>
                    <div class="kt-portlet__head-toolbar">
                        <a href="<?php echo ROOT_URL.'/voci-menu.php'; ?>" class="btn btn-clean kt-margin-r-10">
                            <i class="la la-arrow-left"></i>
                            <span class="kt-hidden-mobile">Torna alla Lista</span>
                        </a>
                        <button type="button" class="btn btn-brand submit-form">
                            <i class="la la-check"></i>
                            <span class="kt-hidden-mobile">Salva</span>
                        </button>
                    </div>
                </div>

                <div class="kt-portlet__body">
                    <form class="kt-form" id="nuova-voce" method="post" enctype="multipart/form-data" autocomplete="off">
                        <div class="row">
                            <div class="col-xl-8">
                                <div class="kt-section kt-section--first">
                                    <div class="kt-section__body">
                                        <?php if( isset($result) && $result ){
                                            echo
                                            '<div class="alert alert-outline-danger fade show" role="alert">
                                                <div class="alert-icon"><i class="flaticon-danger"></i></div>
                                                <div class="alert-text">
                                                    <h5>Attenzione, si è verificato un errore durante la creazione della nuova Voce Menù.</h5>
                                                    '.$result.'
                                                </div>
                                                <div class="alert-close">
                                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                        <span aria-hidden="true"><i class="la la-close"></i></span>
                                                    </button>
                                                </div>
                                            </div>';
                                        } ?>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Categoria</label>
                                            <div class="col-10">
                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-folder-open"></i></span></div>
                                                    <select class="kt-select2 form-control" id="cat_id" name="cat_id">
                                                        <option value="">Seleziona</option>

                                                        <?php foreach( $categorie as $categoria ){ ?>
                                                            <option value="<?php echo $categoria['id']; ?>"><?php echo $categoria['titolo']; ?></option>
                                                        <?php } ?>

                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Titolo</label>
                                            <div class="col-10">

                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-utensils"></i></span></div>
                                                    <input type="text" name="titolo" id="titolo" class="form-control" value="" placeholder="Titolo" aria-describedby="basic-addon1">
                                                </div>

                                                <!-- Multilingua - Estensione #Applicazione -->
                                                <div class="accordion accordion-light accordion-toggle-plus" id="ml-titolo">

                                                        <div class="card">

                                                            <div class="card-header">
                                                                <div class="card-title collapsed " data-toggle="collapse" data-target="#ml-titolo-fields" aria-expanded="false" aria-controls="ml-titolo-fields">
                                                                    <i class="fas fa-globe"></i>
                                                                    Multilingua: traduci il titolo
                                                                </div>
                                                            </div>

                                                            <div id="ml-titolo-fields" class="collapse" data-parent="#ml-titolo">

                                                                <div class="card-body">

                                                                    <?php if( isset($licenza_2['stato']) && $licenza_2['stato'] == 1 ){ ?>

                                                                        <?php $ml_data = $item->get_ml_data( $_SESSION['id'] ); ?>

                                                                        <?php if( isset($ml_data['multilingua']) && $ml_data['multilingua'] == 2 && isset($ml_data['lingue_custom']) && count($ml_data['lingue_custom']) > 0 ){ ?>

                                                                            <?php foreach( $ml_data['lingue_custom'] as $code => $label ){ ?>

                                                                                <div class="input-group mt-2 mb-2">
                                                                                    <div class="input-group-prepend">
                                                                                <span class="input-group-text">
                                                                                    <img src="<?php echo ROOT_URL; ?>/assets/media/app/<?php echo $code; ?>.svg" width="18" alt="Titolo <?php echo $code; ?>">
                                                                                </span>
                                                                                    </div>
                                                                                    <input type="text" name="titolo_<?php echo $code; ?>" id="titolo-<?php echo $code; ?>" class="form-control" value="" placeholder="Titolo in <?php echo $label; ?>" aria-describedby="basic-addon1">
                                                                                </div>

                                                                            <?php } ?>

                                                                        <?php }else{ ?>

                                                                            Accertati di aver attivato il <b>Multilingua Avanzato</b> e di aver selezionato <b>almeno una lingua aggiuntiva</b> su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a>.

                                                                        <?php } ?>

                                                                    <?php }else{ ?>

                                                                        Attiva il Multilingua Avanzato su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a> per tradurre manualmente i tuoi titoli.

                                                                    <?php } ?>

                                                                </div>

                                                            </div>

                                                        </div>

                                                    </div>

                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Descrizione</label>
                                            <div class="col-10">

                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-file-alt"></i></span></div>
                                                    <textarea name="descrizione" id="descrizione" class="form-control" placeholder="Descrizione" aria-describedby="basic-addon1"></textarea>
                                                </div>

                                                <!-- Multilingua - Estensione #Applicazione -->
                                                <div class="accordion accordion-light accordion-toggle-plus" id="ml-descrizione">

                                                        <div class="card">

                                                            <div class="card-header">
                                                                <div class="card-title collapsed " data-toggle="collapse" data-target="#ml-descrizione-fields" aria-expanded="false" aria-controls="ml-descrizione-fields">
                                                                    <i class="fas fa-globe"></i>
                                                                    Multilingua: traduci la descrizione
                                                                </div>
                                                            </div>

                                                            <div id="ml-descrizione-fields" class="collapse" data-parent="#ml-descrizione">

                                                                <div class="card-body">

                                                                    <?php if( isset($licenza_2['stato']) && $licenza_2['stato'] == 1 ){ ?>

                                                                        <?php $ml_data = $item->get_ml_data( $_SESSION['id'] ); ?>

                                                                        <?php if( isset($ml_data['multilingua']) && $ml_data['multilingua'] == 2 && isset($ml_data['lingue_custom']) && count($ml_data['lingue_custom']) > 0 ){ ?>

                                                                            <?php foreach( $ml_data['lingue_custom'] as $code => $label ){ ?>

                                                                                <div class="input-group mt-2 mb-2">
                                                                                    <div class="input-group-prepend">
                                                                                    <span class="input-group-text">
                                                                                        <img src="<?php echo ROOT_URL; ?>/assets/media/app/<?php echo $code; ?>.svg" width="18" alt="Descrizione <?php echo $code; ?>">
                                                                                    </span>
                                                                                    </div>
                                                                                    <textarea name="descrizione_<?php echo $code; ?>" id="descrizione-<?php echo $code; ?>" class="form-control" placeholder="Descrizione in <?php echo $label; ?>" aria-describedby="basic-addon1"></textarea>
                                                                                </div>

                                                                            <?php } ?>

                                                                        <?php }else{ ?>

                                                                            Accertati di aver attivato il <b>Multilingua Avanzato</b> e di aver selezionato <b>almeno una lingua aggiuntiva</b> su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a>.

                                                                        <?php } ?>

                                                                    <?php }else{ ?>

                                                                        Attiva il Multilingua Avanzato su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a> per tradurre manualmente le tue descrizioni.

                                                                    <?php } ?>

                                                                </div>

                                                            </div>

                                                        </div>

                                                    </div>

                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Immagine</label>
                                            <div class="col-10">
                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="far fa-image"></i></span></div>
                                                    <div class="custom-file">
                                                        <input type="file" class="custom-file-input" id="img" name="img">
                                                        <label class="custom-file-label" id="img-label" for="img">Seleziona Immagine</label>
                                                        <div id="img-container" style="visibility: hidden;"></div>
                                                    </div>
                                                </div>
                                                <span class="form-text text-muted">Si consiglia di inserire un'immagine (jpg, png o gif) <b>orizzontale</b> per una migliore leggibilità del menù.</span>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Prezzo</label>
                                            <div class="col-10">
                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><?php echo $impostazioni['valuta']; ?></span></div>
                                                    <input type="text" name="prezzo" id="prezzo" class="form-control" value="0" aria-describedby="basic-addon1">
                                                </div>
                                                <p>Utilizzare il <b>punto</b> (<b>.</b>) per i decimali. Verrà utilizzata la valuta selezionata nelle impostazioni.</p>
                                            </div>
                                        </div>

                                        <div class="form-group row">

                                            <label class="col-2 col-form-label">Caratteristiche</label>

                                            <div class="col-5">

                                                <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="surgelato">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Contiene alimenti Surgelati
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-surgelato.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Surgelato" su questo prodotto.
                                                        </span>
                                                    </span>
                                                </label>

                                            </div>


                                            <div class="col-5">

                                                <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="noglutine">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Prodotto Senza Glutine
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-noglutine.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Senza Glutine" su questo prodotto.
                                                        </span>
                                                    </span>
                                                </label>

                                            </div>

                                        </div>

                                        <div class="form-group row">

                                                <label class="col-2 col-form-label"></label>

                                                <div class="col-5">

                                                    <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="abbattuto">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                        <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Contiene alimenti Abbattuti
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-abbattuto.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Abbattuto" su questo prodotto.
                                                        </span>
                                                    </span>
                                                    </label>

                                                </div>


                                                <div class="col-5">

                                                    <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="piccante">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                        <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Prodotto Piccante
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-piccante.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Piccante" su questo prodotto.
                                                        </span>
                                                    </span>
                                                    </label>

                                                </div>

                                            </div>

                                        <div class="form-group row">

                                            <label class="col-2 col-form-label"></label>

                                            <div class="col-5">

                                                <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="vegetariano">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Prodotto Vegetariano
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-vegetariano.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Vegetariano" su questo prodotto.
                                                        </span>
                                                    </span>
                                                </label>

                                            </div>


                                            <div class="col-5">

                                                <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="vegano">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Prodotto Vegano
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-vegano.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Vegano" su questo prodotto.
                                                        </span>
                                                    </span>
                                                </label>

                                            </div>

                                        </div>

                                        <div class="form-group row">

                                            <label class="col-2 col-form-label"></label>

                                            <div class="col-5">

                                                <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="nolattosio">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Prodotto Senza Lattosio
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-nolattosio.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Senza Lattosio" su questo prodotto.
                                                        </span>
                                                    </span>
                                                </label>

                                            </div>


                                            <div class="col-5">

                                                <label class="kt-option">
                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="biologico">
                                                            <span></span>
                                                        </label>
                                                    </span>
                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Prodotto Biologico
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <img class="caratteristiche-icon" src="/assets/media/app/icona-biologico.png">
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva l'icona "Biologico" su questo prodotto.
                                                        </span>
                                                    </span>
                                                </label>

                                            </div>

                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Allergeni</label>
                                            <div class="col-10">
                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-exclamation-circle"></i></span></div>
                                                    <select class="kt-select2 form-control" multiple="" id="allergeni" name="allergeni[]">
                                                        <option value="">Seleziona</option>

                                                        <?php if( isset($allergeni) && is_array($allergeni) && count($allergeni) > 0 ){ ?>
                                                            <?php foreach( $allergeni as $allergene ){ ?>
                                                                <option value="<?php echo $allergene['id']; ?>"><?php echo $allergene['titolo']; ?></option>
                                                            <?php } ?>
                                                        <?php } ?>

                                                    </select>
                                                </div>
                                                <p>Se non l'hai ancora fatto, inserisci gli allergeni tramite l'apposita sezione "<a href="allergeni.php">Allergeni</a>".</p>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                            </div>
                            <div class="col-xl-4">

                                <div class="alert alert-secondary" role="alert">
                                    <div class="alert-icon"><i class="flaticon-questions-circular-button"></i></div>
                                    <div class="alert-text">
                                        <h4>Suggerimenti</h4>

                                       Stai creando una nuova <strong>Voce Menù</strong>
                                        <br><br>
                                        <div class="kt-list-timeline">
                                            <div class="kt-list-timeline__items">

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Se non hai ancora creato almeno una categoria non potrai salvare alcuna voce menù</span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Lasciando vuoto il campo descrizione, quest'ultimo verrà disabilitato</span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Arricchisci la tua voce menù con una foto accattivante. </span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Impostando a 0 o lasciando vuoto il campo prezzo, quest'ultimo verrà disabilitato</span>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </form>
                </div>

                <div class="kt-portlet__foot kt-portlet__foot--lg">
                    <div class="kt-portlet__foot-toolbar">
                        <button type="button" class="btn btn-brand submit-form">
                            <i class="la la-check"></i>
                            <span class="kt-hidden-mobile">Salva</span>
                        </button>
                    </div>
                </div>

            </div>

            <!--end::Portlet-->
        </div>
    </div>
</div>
<!-- end:: Content -->

<?php
// Footer Options
$custom_scripts = '';

// Footer inclusion
include_once( ROOT_PATH.'/footer.php' );
