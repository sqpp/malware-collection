<?php
    use MirazMac\BanglaString\BanglaString;

    $root = $_SERVER["DOCUMENT_ROOT"];
    $type = "full";
    $title = "Bangladeshi Fake Old NID Card Maker";
    
    include $root."/inc/header.php";
    
    //Handling Third Party Server Usage
    $tpserver = false;
    $tpserver_url = "https://globaltelecommunicationbd.com/bd-nid";
    
    if($tpserver)
        $form_action = $tpserver_url.'/';
    else
        $form_action = "index.php";
?>
<meta name="keywords" content="bd fake nid card maker" />
<meta name="description" content="Best Free Bangladeshi Fake Old NID Card Maker Online. Make a BD Fake NID Card easily to verify your Facebook ID or just for Fun." />
</head>

<body>
    <header>
        <?php
            include $root."/inc/sub_full_head.php";
        ?>
    </header>
    <div class="content">
        <div class="main">
            <main>
                <h1>Fake NID Card Maker BD</h1>
                <div class="card border-dark mb-3">
                  <div class="card-header text-center">DISCLAIMER</div>
                  <div class="card-body text-dark">
                    <p class="card-text">কার্ডটি শুধুমাত্র ফেসবুক এবং অন্যান্য ওয়েবসাইটে ভেরিফিকেশন এর কাজে ব্যবহার করবেন। কোনো অবৈধ কাজে কার্ডটি ব্যবহার করবেন না।</p>
                  </div>
                </div>
                <br>
                <?php
                    if($_SERVER['REQUEST_METHOD'] == "POST" && $tpserver == false)
                    {
                        require $root.'/lib/banglastring/vendor/autoload.php';
                        
                        $style = $_POST['style'];
                        
                        $nameen = $_POST['nameen'];
                        $bday = date("d M Y", strtotime($_POST['bday']));
                        
                        $nameorig = $_POST['name'];
                        $name = new BanglaString($nameorig);
                        $name = $name->toBijoy();
                        
                        $fatherorig = $_POST['father'];
                        $father = new BanglaString($fatherorig);
                        $father = $father->toBijoy();
                        
                        $motherorig = $_POST['mother'];
                        $mother = new BanglaString($motherorig);
                        $mother = $mother->toBijoy();
                        
                        $signature = $_POST["signature"];
                        $nid = $_POST["nid"];
                        
                        $house = $_POST["house"];
                        $village = $_POST["village"];
                        $post = $_POST["post"];
                        $subdist = $_POST["subdist"];
                        $dist = $_POST["dist"];
                        
                        $address1 = "বাসা/হোল্ডিং: $house, গ্রাম/রাস্তা: $village,";
                        $address1 = new BanglaString($address1);
                        $address1 = $address1->toBijoy();
                        
                        $address2 = "ডাকঘর: $post, $subdist, $dist";
                        $address2 = new BanglaString($address2);
                        $address2 = $address2->toBijoy();
                        
                        $blood = $_POST["blood"];
                        
                        $issueDate = date("d/m/Y", strtotime($_POST['issuedate']));
                        $issueDate = new BanglaString($issueDate);
                        $issueDate = $issueDate->toBijoy();
                        
                        //Image
                        $img = $_FILES['img'];
                        
                        $imgName = $img['name'];
                        $imgTmpLoc = $img['tmp_name'];
                        $imgType = $img['type'];
                        $imgSize = $img['size'];
                        $imgError = $img['error'];
                        
                        $kaboom = explode(".", $imgName);
                        $imgExt = strtolower(end($kaboom));
                        
                        echo "<center>";
                        
                        //Form Checking
                        if($nameen == "" || $nameorig == "" || $fatherorig == "" || $motherorig == "" || $house == "" || $village == "" || $dist == "")
                        {
                            $msg = "Please, fill up all the fields.";
                        }
                        else if(!$style)
                        {
                            $msg = "Please, select a card style.";
                        }
                        else if($imgError)
                        {
                            $msg = "Error uploading Image!";
                        }
                        else if(!$imgTmpLoc)
                        {
                            $msg = "No Image Choosen!";
                        }
                        else if($imgSize > 800 * 1024)
                        {
                            $msg = "Image Size is too High!";
                        }
                        else if(!preg_match("/.(gif|jpg|jpeg|png)$/i", strtolower($imgName)))
                        {
                            $msg = "Unsupported Image Type!";
                        }
                        else
                        {
                            if(!move_uploaded_file($imgTmpLoc, "uploads/$imgName"))
                            {
                                $msg = "Image not uploaded! Try again.";
                                unlink($imgTmpLoc);
                            }
                            else
                            {
                                //Image Size
                                if($style == "norm") //Normal
                                {
                                    $rw = 206;
                                    $rh = 206;
                                }
                                else //Leminated
                                {
                                    $rw = 183;
                                    $rh = 183;
                                }
                                
                                //resize image
                                include_once($root."/inc/func/img_resizer.php");
                                resize_image("uploads/$imgName", "uploads/resized_$imgName", $rw, $rh, $imgExt);
                                
                                if($imgExt == "png")
                                    $resized_img = imagecreatefrompng("uploads/resized_$imgName");
                                else if($imgExt == "jpg" || $imgExt == "jpeg")
                                    $resized_img = imagecreatefromjpeg("uploads/resized_$imgName");
                                else
                                    $resized_img = imagecreatefromgif("uploads/resized_$imgName");
                                
                                $sx = imagesx($resized_img);
                                $sy = imagesy($resized_img);
                                
                                $filename = "bd-oldnid_".$style."_".mt_rand(100,999).substr(time(),-5).".jpg";
                                $output = "cards/$filename";
                                
                                if($style == "norm")
                                    $card = imagecreatefromjpeg("nid_norm.jpg");
                                else
                                    $card = imagecreatefromjpeg("nid_lem.jpg");
                                    
                                //imageAlphaBlending($card, true);
                                //imageSaveAlpha($card, true);
                                
                                $black = imagecolorallocate($card,0,0,0);
                                $fadedBlack = imagecolorallocatealpha($card,0,0,0,20);
                                $white = imagecolorallocate($card,255,255,255);
                                $red = imagecolorallocate($card,255,0,0);
                                
                                $txtAngle = 0;
                                $enFont = "Roboto-Regular.ttf";
                                $bnFont = "Kalpurush_ANSI-Regular.ttf";
                                
                                if($style == "norm") //Normal
                                {
                                    $entxtSize = 24;
                                    $bntxtSize = 26;
                                    
                                    $marge_right = 738;
                                    $marge_bottom = 910;
                                    
                                    imagecopy($card, $resized_img, imagesx($card) - $sx - $marge_right, imagesy($card) - $sy - $marge_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));
                                    
                                    imagettftext($card, 30, $txtAngle, 390, 286, $black, $bnFont, $name);
                                    imagettftext($card, $entxtSize, $txtAngle, 390, 340, $black, $enFont, strtoupper($nameen));
                                    imagettftext($card, 30, $txtAngle, 390, 404, $black, $bnFont, $father);
                                    imagefttext($card, 30, $txtAngle, 390, 460, $black, $bnFont, $mother);
                                    imagefttext($card, 25, $txtAngle, 535, 516, $red, $enFont, $bday);
                                    imagefttext($card, 34, $txtAngle, 445, 588, $red, "Roboto-Bold.ttf", $nid);
                                    imagefttext($card, 20, $txtAngle, 79, 538, $black, "lunabar.ttf", $signature);
                                    
                                    imagefttext($card, 23, 0, 132, 898, $black, $bnFont, $address1);
                                    imagefttext($card, 23, 0, 132, 933, $black, $bnFont, $address2);
                                    imagefttext($card, 24, $txtAngle, 382, 1032, $red, $enFont, $blood);
                                    imagefttext($card, $bntxtSize, $txtAngle, 772, 1169, $black, $bnFont, $issueDate);
                                }
                                else //Leminated
                                {
                                    $entxtSize = 22;
                                    $bntxtSize = 24;
                                    
                                    $marge_right = 712;
                                    $marge_bottom = 868;
                                    
                                    imagecopy($card, $resized_img, imagesx($card) - $sx - $marge_right, imagesy($card) - $sy - $marge_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));
                                    
                                    imagettftext($card, $bntxtSize, $txtAngle, 400, 272, $black, $bnFont, $name);
                                    imagettftext($card, $entxtSize, $txtAngle, 416, 326, $black, $enFont, strtoupper($nameen));
                                    imagettftext($card, $bntxtSize, $txtAngle, 405, 381, $black, $bnFont, $father);
                                    imagefttext($card, $bntxtSize, $txtAngle, 405, 434, $black, $bnFont, $mother);
                                    imagefttext($card, 23, $txtAngle, 535, 485, $red, $enFont, $bday);
                                    imagefttext($card, 30, $txtAngle, 460, 538, $red, "Roboto-Bold.ttf", $nid);
                                    imagefttext($card, 20, $txtAngle, 128, 490, $black, "lunabar.ttf", $signature);
                                    
                                    imagefttext($card, 22, 0, 176, 832, $fadedBlack, $bnFont, $address1);
                                    imagefttext($card, 22, 0, 176, 865, $fadedBlack, $bnFont, $address2);
                                    imagefttext($card, 23, $txtAngle, 380, 945, $red, $enFont, $blood);
                                    imagefttext($card, $bntxtSize, $txtAngle, 710, 1060, $fadedBlack, $bnFont, $issueDate);
                                }
                                
                                imagejpeg($card, $output);
                                
                                imagedestroy($resized_img);
                                imagedestroy($card);
                                
                                echo "<div class='alert alert-success'>Your NID Card is Ready!</div><br><img src='$output' style='width: 100%; max-width: 600px;'><br><br><a class='btn btn-primary' href='download.php?name=$filename'>Download</a>";
                            }
                        }
                        
                        if($msg)
                        {
                            echo "<div class='alert alert-warning'>$msg</div>";
                        }
                        
                        echo "</center><br>";
                    }
                    else if(isset($_GET["success"]) && $tpserver == true)
                    {
                        echo "<center>";
                        
                        if($_GET["success"] == "true")
                        {
                            $card = $_GET["card"];
                            echo "<div class='alert alert-success'>Your NID Card is Ready!</div><br><img src='$tpserver_url/cards/$card' style='width: 100%; max-width: 600px;'><br><br><a class='btn btn-primary' href='$tpserver_url/download.php?name=$card'>Download</a>";
                        }
                        else
                        {
                            $msg = $_GET["msg"];
                            echo "<div class='alert alert-warning'>$msg</div>";
                        }
                        
                        echo "</center><br>";
                    }
                ?>
                
                <?php
                    include $root."/inc/custom_main_ad.php";
                ?>
                
                <br>
                <form method="POST" enctype="multipart/form-data" action="<?=$form_action?>">
                    <div class="form-group">
                        <b>Select a Style:</b>
                        <div class="styles">
                            <div class="form-check">
                                <input class="form-check-input" id="norm" type="radio" name="style" value="norm" checked/> <label class="form-check-label" for="norm">Normal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" id="lem" type="radio" name="style" value="lem" /> <label class="form-check-label" for="lem">Leminated</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <b>Name <small>(in English)</small>:</b>
                        <input type="text" name="nameen" value="<?=$nameen;?>" class="form-control" pattern="[a-zA-Z:. ]{3,}" required>
                    </div>
                    <div id="namebn" class="form-group">
                        <b>নাম (বাংলায়):</b>
                        <input type="text" name="name" value="<?=$nameorig;?>" class="form-control" pattern="[^0-9a-zA-Z]{3,}">
                    </div>
                    <div class="form-group">
                        <b>পিতার নাম (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="father" value="<?=$fatherorig;?>" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <b>মাতার নাম (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="mother" value="<?=$motherorig;?>" class="form-control" required>
                    </div>
                    <div id="signature" class="form-group">
                        <b>Signature (in English):</b>
                        <input type="text" name="signature" value="<?=$signature;?>" class="form-control" pattern="[a-zA-Z ]{3,}" required>
                    </div>
                    <div class="form-group">
                        <b>Date of Birth:</b>
                        <input type="date" name="bday" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <b>NID No.:</b>
                        <input type="text" name="nid" value="<?=$nid;?>" class="form-control" pattern="[0-9]{10,17}" required>
                    </div>
                    <br>
                    <div class="form-group">
                        <b>বাসা/হোল্ডিং (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="house" value="<?=$house;?>" class="form-control" placeholder="#২৭৪">
                    </div>
                    <div class="form-group">
                        <b>গ্রাম (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="village" value="<?=$village;?>" class="form-control">
                    </div>
                    <div class="form-group">
                        <b>ডাকঘর (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="post" value="<?=$post;?>" class="form-control">
                    </div>
                    <div class="form-group">
                        <b>উপজেলা (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="subdist" value="<?=$subdist;?>" class="form-control">
                    </div>
                    <div id="signature" class="form-group">
                        <b>জেলা (বাংলায়):</b>
                        <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="dist" value="<?=$dist;?>" class="form-control">
                    </div>
                    <div class="form-group">
                        <b>রক্তের গ্রুপ:</b>
                        <select name="blood" class="form-control">
                            <option value="A+"> A+ </option>
                            <option value="A-"> A- </option>
                            <option value="B+"> B+ </option>
                            <option value="B-"> B- </option>
                            <option value="O+"> O+ </option>
                            <option value="O-"> O- </option>
                            <option value="AB+"> AB+ </option>
                            <option value="AB-"> AB- </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <b>কার্ড প্রদানের তারিখ:</b>
                        <input type="date" name="issuedate" class="form-control" value="<?= date('Y-m-d') ?>" required>
                    </div>
                    <div class="form-group">
                        <b>Image:</b> <small>(Choose a formal Pic, Max. 800 KB)</small>
                        <input type="file" name="img" class="form-control form-control-file" onchange="fileValidation(this, 800, ['jpg', 'jpeg', 'png', 'gif'])" accept=".jpg, .jpeg, .png, .gif" required>
                    </div>
                    <input type="submit" class="btn btn-primary" value="Submit">
                </form>
                <br>
                <?php
                    include $root."/inc/custom_main_ad.php";
                ?>
            </main>
            <br>
            <?php
                $bqlang = 'bn';
                include $root."/inc/bestquotes.php";
            ?>
        </div>
        <?php include $root."/inc/sidebar.php"; ?>
    </div>
    <footer>
        <?php
            include $root."/inc/sub_full_foot.php";
        ?>
    </footer>
    <script type="text/javascript" src="/assets/js/file-validation.js"></script>
</body>

</html>