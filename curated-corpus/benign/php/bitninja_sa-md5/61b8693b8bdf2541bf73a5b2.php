<?php

//fetch_cart.php

session_start();

$total_price = 0;
$total_tarif = 0;
$total_item = 0;

if(!empty($_SESSION["shopping_cart"]))
{
    
    $output.='<div class="row">
	                		<div class="col-lg-9">
	                			<table class="table table-cart table-mobile">
									<thead class="text-center">
										<tr>
											<th>Produit</th>
											<th>Prix</th>
											<th>Quantit&eacute;</th>
											<th>Total</th>
											<th></th>
										</tr>
									</thead>

									<tbody class="text-center">';
 foreach($_SESSION["shopping_cart"] as $keys => $values)
 {
    
 $output.='	
										<tr>
											<td class="product-col">
												<div class="product">
													<figure class="product-media">
														<a href="#">
														 <img src="../dashboard_na9el/fournitures/images_fournitures/'.$values["product_image"].'" alt="Product image" >
														</a>
													</figure>

													<h3 class="product-title" id="'.$values["product_id"].'">
													  <a href="" id="name'.$values["product_id"].'">'.$values["product_name"].'</a>
													</h3><!-- End .product-title -->
												</div><!-- End .product -->
											</td>
											<td class="price-col" id="tarif'.$values["product_id"].'">'.number_format($values["product_price"],3).'</td>
											<td class="quantity-col">
                                                <div class="details-filter-row details-row-size justify-content-center">
                                        
                                        <div class="product-details-quantity stepper">
                                        <div class="form-control-icon">
                                        <i class="fas fa-minus" id="minus'.$values["product_id"].'"></i>
                                            <input type="number" id="quantite'.$values["product_id"].'"  class="form-control" value="'.$values["product_quantity"].'" min="1" max="10" step="1" data-decimals="0" required>
                                            <span class="fas fa-plus" id="plus'.$values["product_id"].'"></span>
                                            </div>
                                        </div><!-- End .product-details-quantity -->
                                    </div><!-- End .details-filter-row -->
                                                    
                                            </td>';
                                             $total_tarif =($values["product_quantity"] * $values["product_price"]);
                                            
											$output.='<td class="total-col" id="total'. $values["product_id"].'">'.number_format($total_tarif,3).'</td>
											<td class="remove-col"><a  class="btn-remove delete" name="delete" id="'. $values["product_id"].'"  title="Remove Product"><i class="icon-close"></i></a>
                                        </td>
										</tr>';
								
								
 
  $total_price = $total_price + ($values["product_quantity"] * $values["product_price"]);

  $total_item = $total_item + $values["product_quantity"];
  
  
  $id_product=$values["product_id"];
  $name="name".$values["product_id"];
  $quantite="quantite".$values["product_id"];
  $tarif="tarif".$values["product_id"];
   $total="total".$values["product_id"];
   $plus="plus".$values["product_id"];
    $minus="minus".$values["product_id"];
 
  
 ?>
  
 <script>
 $(document).ready(function(){
    
    $('#<?php echo $plus; ?>,#<?php echo $minus; ?>').click(function(){
    
   var action="edit";
  var product_id = <?php echo $id_product; ?>;
  var product_name = $('#<?php echo $name; ?>').html();
  var product_price = $('#<?php echo $tarif; ?>').html();
  var product_quantity = $('#<?php echo $quantite; ?>').val();
  var total=parseInt(product_price * product_quantity).toFixed(3);
  $('#<?php echo $total; ?>').html(total);
  
  
   $.ajax({
    url:"action.php",
    method:"POST",
    data:{product_id:product_id, product_name:product_name, product_price:product_price, product_quantity:product_quantity,product_image:product_image, action:action},
    success:function(data)
    {
     load_cart_data();
  card_data();
      
    }
   })
 
  
  
 
 });
 });
 
 
 </script>
 
 <?php
 }
 
 $output.='	</tbody>
								</table><!-- End .table table-wishlist -->

	                			<div class="cart-bottom">
			            			<div class="cart-discount">
			            				<form action="#">
			            					<div class="input-group">
				        						<input type="text" class="form-control" required placeholder="coupon code">
				        						<div class="input-group-append">
													<button class="btn btn-outline-primary-2" type="submit"><i class="icon-long-arrow-right"></i></button>
												</div><!-- .End .input-group-append -->
			        						</div><!-- End .input-group -->
			            				</form>
			            			</div><!-- End .cart-discount -->

			            			<a href="#" class="btn btn-outline-dark-2"><span>UPDATE CART</span><i class="icon-refresh"></i></a>
		            			</div><!-- End .cart-bottom -->
	                		</div><!-- End .col-lg-9 -->
	                		<aside class="col-lg-3">
	                			<div class="summary summary-cart">
	                				<h3 class="summary-title">Cart Total</h3><!-- End .summary-title -->

	                				<table class="table table-summary">
	                					<tbody>
	                						<tr class="summary-subtotal">
	                							<td>Subtotal:</td>
	                							<td>'.number_format($total_price, 3).'</td>
	                						</tr><!-- End .summary-subtotal -->
	                						<tr class="summary-shipping">
	                							<td>Shipping:</td>
	                							<td>&nbsp;</td>
	                						</tr>

	                						<tr class="summary-shipping-row">
	                							<td>
													<div class="custom-control custom-radio">
														<input type="radio" id="free-shipping" name="shipping" class="custom-control-input">
														<label class="custom-control-label" for="free-shipping">Free Shipping</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>$0.00</td>
	                						</tr><!-- End .summary-shipping-row -->

	                						<tr class="summary-shipping-row">
	                							<td>
	                								<div class="custom-control custom-radio">
														<input type="radio" id="standart-shipping" name="shipping" class="custom-control-input">
														<label class="custom-control-label" for="standart-shipping">Standart:</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>$10.00</td>
	                						</tr><!-- End .summary-shipping-row -->

	                						<tr class="summary-shipping-row">
	                							<td>
	                								<div class="custom-control custom-radio">
														<input type="radio" id="express-shipping" name="shipping" class="custom-control-input">
														<label class="custom-control-label" for="express-shipping">Express:</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>$20.00</td>
	                						</tr><!-- End .summary-shipping-row -->

	                						<tr class="summary-shipping-estimate">
	                							<td>Estimate for Your Country<br> <a href="dashboard.html">Change address</a></td>
	                							<td>&nbsp;</td>
	                						</tr><!-- End .summary-shipping-estimate -->

	                						<tr class="summary-total">
	                							<td>Total:</td>
	                							<td>'.number_format($total_price, 3).'</td>
	                						</tr><!-- End .summary-total -->
	                					</tbody>
	                				</table><!-- End .table table-summary -->

	                				<a href="checkout.php" class="btn btn-outline-primary-2 btn-order btn-block ">PROCEED TO CHECKOUT</a>
	                			</div><!-- End .summary -->

		            			<a href="../materiels_demenagement__/" class="btn btn-outline-dark-2 btn-block mb-3"><span>CONTINUE SHOPPING</span><i class="icon-refresh"></i></a>
	                		</aside><!-- End .col-lg-3 -->
	                	</div><!-- End .row -->';
 
}
else
{
 $output .= '
  
      <div class="alert alert-info"><i class="fas fa-shopping-bag"></i>&nbsp;&nbsp;Panier Vide&nbsp;<i class="fas fa-exclamation-circle"></i></div>
    
    ';
}

echo $output;
?>



 
<style>
[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  height: auto;
}



.stepper input {
  width: 60%;
  height: 100%;
  text-align: center;
  border: 0;
  background: transparent;
  color: #000;
}

.stepper button {
  width: 40px;
  height: 40px;
  font-weight: 700;
  line-height: 0.1em;
  font-size: 17.6px;
  padding: 0;
  background: #000;
  color: #ffffff;
  border: none;
}
.stepper button:focus {
  outline: none;
  color: #fff;
}
</style>



<script>

var inc = document.getElementsByClassName("stepper");
for (i = 0; i < inc.length; i++) {
  var incI = inc[i].querySelector("input"),
    id = incI.getAttribute("id"),
    min = incI.getAttribute("min"),
    max = incI.getAttribute("max"),
    step = incI.getAttribute("step");
  document
    .getElementById(id)
    .previousElementSibling.setAttribute(
      "onclick",
      "stepperInput('" + id + "', -" + step + ", " + min + ")"
    ); 
  document
    .getElementById(id)
    .nextElementSibling.setAttribute(
      "onclick",
      "stepperInput('" + id + "', " + step + ", " + max + ")"
    ); 
}

function stepperInput(id, s, m) {
  var el = document.getElementById(id);
  if (s > 0) {
    if (parseInt(el.value) < m) {
      el.value = parseInt(el.value) + s;
    }
  } else {
    if (parseInt(el.value) > m) {
      el.value = parseInt(el.value) + s;
    }
  }
}
</script>