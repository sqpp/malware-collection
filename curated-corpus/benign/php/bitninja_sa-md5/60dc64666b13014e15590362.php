<?php
	error_reporting(E_ALL ^ E_NOTICE);
	require_once("../mod_conexion/db_funciones.php");
	$db = new DB_Funciones(); 
    
    $opcion = $_POST['opcion'];
    $data = "";

    if($opcion == "insertar"){

        $texto          = $_POST['texto'];
        $id_area        = $_POST['id_area'];
        $id_empleado    = $_POST['id_empleado'];
        
        $insert = $db->adminInsertaChat($id_area, $id_empleado, $texto);

        if ( $insert ){
            echo "success";
        }else{
            echo "error";
        }
    }

    if($opcion == "actualizaNumChats"){

        $id_area        = $_POST['id_area'];
        $id_empleado    = $_POST['id_empleado'];

        $update = $db->actualizaNumChats($id_empleado, $id_area);

        if ( $update ){
            echo "success";
        }else{
            echo "error";
        }
    }
    
    if($opcion == "consultar"){
        
        $id_area        = $_POST['id_area'];
        $id_empleado    = $_POST['id_empleado'];

        $return_arrChat = array();
        $consultaChat      = $db->adminConsultaChat($id_empleado, $id_area);
    
        if( $consultaChat != false ) 
        {
            for ( $i = 0; $i< sizeof($consultaChat); $i++ ) 
            {
                $row_arrayChat['total'] = $consultaChat[$i]['total'];

                array_push($return_arrChat, $row_arrayChat);
            }
            echo json_encode($return_arrChat);
        }

    }

    if($opcion == "consultarultimos"){

        $data                   = "";
        $return_arr             = array();
        $id_area                = $_POST['id_area'];
        $id_empleado            = $_POST['id_empleado'];
        $consultaUltimosChat    = $db->adminConsultaUltimosChat($id_area);
    
        if( $consultaUltimosChat != false ) 
        {
            for ( $j = 0; $j< sizeof($consultaUltimosChat); $j++ ) 
            {
                $texto             = $consultaUltimosChat[$j]['texto'];
                $fecha_mensaje     = $consultaUltimosChat[$j]['fecha_mensaje'];
                $empleado          = trim($consultaUltimosChat[$j]['id_empleado']);
                $nombres           = trim($consultaUltimosChat[$j]['nombres']);
                $estado_mensaje    = $consultaUltimosChat[$j]['estado_mensaje'];

                if($id_empleado == $empleado ){
                    $data .= "<div style='background-color:#A2DEF2; text-align:right; margin:10px; margin-left:120px; border-radius:5px; padding-right:10px'><p><b>$nombres</b><br>$fecha_mensaje<br>$texto</p>
                            </div>";
                }else{
                    $data .= "<div style='background-color:#CFFBC7; text-align:left; margin:10px; margin-right:120px;  border-radius:5px; padding-left:10px''><p><b>$nombres</b><br>$fecha_mensaje<br>$texto</p>
                            </div>";
                }
            }
            echo $data;
        }
    }
?>