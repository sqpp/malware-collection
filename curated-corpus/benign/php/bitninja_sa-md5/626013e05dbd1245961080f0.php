<?php 

      $id = $_GET['id'];
      $sql = $koneksi-> query("select * from tb_karyawan where id='$id'");
      $tampil = $sql-> fetch_assoc();

      $level = $tampil['level'];
      $tipe = $tampil['tipe'];
      $status = $tampil['status'];



 ?>

<div class="card card-info">
              <div class="card-header">
                <h3 class="card-title">Edit Karyawan</h3>
              </div>

                <form id="karyawan" method="POST" class="form-horizontal" enctype="multipart/form-data">
                <div class="card-body">
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">NIP</label>
                      <div class="col-sm-9">
                            <input type="text" name="nip" class="form-control" size="40" value="<?php echo $tampil['nip']; ?>" required="" />
                      </div>
                    </div>  
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Nama</label>
                      <div class="col-sm-9">
                            <input type="text" name="nama" class="form-control" size="40" value="<?php echo $tampil['nama']; ?>" required="" />
                      </div>
                    </div>  
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Jabatan</label>
                      <div class="col-sm-9">
                            <input type="text" name="jabatan" class="form-control" size="40" value="<?php echo $tampil['jabatan']; ?>" required="" />
                      </div>
                    </div>  
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Kode Jabatan</label>
                      <div class="col-sm-9">
                            <input type="text" name="kode_jabatan" class="form-control" size="40" value="<?php echo $tampil['kode_jabatan']; ?>" required="" />
                      </div>
                    </div>  
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Lokasi</label>
                      <div class="col-sm-9">
                            <select  name="id_lokasi" class="form-control select2" required="">
                                <?php

                                  $id_lokasi = $tampil['id_lokasi'];
                                  $lokasi = $koneksi-> query("select * from tb_lokasi where id='$id_lokasi'");
                                  $tampil_lokasi = $lokasi-> fetch_assoc();
                                  echo "<option value='$tampil_lokasi[id]' selected>$tampil_lokasi[lokasi]</option>";
                                  $lokasi2 = $koneksi-> query("select * from tb_lokasi order by lokasi");

                                  while ($tampil_lokasi2 = $lokasi2->fetch_assoc()){
                                    echo "<option value='$tampil_lokasi2[id]'>$tampil_lokasi2[lokasi]</option>"; 
                                  }

                                ?>
                            </select>
                      </div>
                    </div>  
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Telepon</label>
                      <div class="col-sm-9">
                            <input type="text" name="telepon" class="form-control" size="40" value="<?php echo $tampil['telepon']; ?>"/>
                      </div>
                    </div>  
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Tipe Pekerja</label>
                      <div class="col-sm-9">
                            <input name="tipe" value="PWTT" type="radio" id="radio_1" <?php if ($tipe=="PWTT"){ echo "checked";}?> />
                                  <label for="radio_1">PWTT</label>
                            <input name="tipe" value="TKJP" type="radio" id="radio_2" <?php if ($tipe=="TKJP"){ echo "checked";}?>/>
                                  <label for="radio_2">TKJP</label>
                      </div> 
                    </div>
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Foto</label>
                      <div class="col-sm-9">
                            <input type="file" name="foto" class="form-control" size="40" value="<?php echo $tampil['foto']; ?>" />
                      </div>
                    </div> 
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Username</label>
                      <div class="col-sm-9">
                            <input type="text" name="username" class="form-control" size="40" value="<?php echo $tampil['username']; ?>" required="" />
                      </div>
                    </div> 
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Password</label>
                      <div class="col-sm-9">
                            <input type="text" name="password" class="form-control" size="40" />
                      </div>
                    </div> 
                    
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Level</label>
                      <div class="col-sm-9">
                            <select class="form-control show-tick" id="level" name="level">
                                <option value="superadmin" <?php if ($level=="superadmin"){ echo "selected";}?>>Superadmin</option>
                                <option value="admin" <?php if ($level=="admin"){ echo "selected";}?>>Admin</option>
                                <option value="user" <?php if ($level=="user"){ echo "selected";}?>>User</option>
                                
                            </select>
                      </div>
                    </div> 
                    <div class="form-group row">
                      <label for="" class="col-sm-3 col-form-label">Status</label>
                      <div class="col-sm-9">
                           <input name="status" value="Aktif" type="radio" id="radio_3" <?php if ($status=="Aktif"){ echo "checked";}?> />
                                <label for="radio_3">Aktif</label>
                          <input name="status" value="Tidak Aktif" type="radio" id="radio_4" <?php if ($status=="Tidak Aktif"){ echo "checked";}?>/>
                                <label for="radio_4">Tidak Aktif</label>
                      </div>
                    </div>
                  </div> 

                  
                  <div class="card-footer">
                       <input type="submit" name="simpan" value="Simpan" class="btn btn-sm btn-success">
                        <a href="?page=karyawan" class="btn btn-sm btn-danger float-right">Batal</a>
                  </div>  

                </form>
  </div>





  <?php 

  if (isset($_POST['simpan'])) {

    $nip = $_POST['nip'];
    $nama = $_POST['nama'];
    $jabatan = $_POST['jabatan'];
    $kode_jabatan = $_POST['kode_jabatan'];
    $id_lokasi = $_POST['id_lokasi'];
    $telepon = $_POST['telepon'];
    $tipe = $_POST['tipe'];
    $foto = $_FILES['foto']['name'];
    $lokasi = $_FILES['foto']['tmp_name'];
    $username= $_POST['username'];
    $password= $_POST['password'];
    $level = $_POST['level'];
    $status = $_POST['status'];
    


    

    if (!empty($lokasi)) {
  
    $namafoto = explode(".", $foto);
    $namafotobaru = $nip.'.'.end($namafoto); 

    if(!empty($password)){
      $password2 = md5($password);
      $sql = $koneksi->query("update tb_karyawan set nip='$nip', nama='$nama', jabatan='$jabatan', kode_jabatan='$kode_jabatan', id_lokasi='$id_lokasi', telepon='$telepon', tipe='$tipe', foto='$namafotobaru', username='$username', password='$password2', level='$level', status='$status' where id='$id'");
    } else {
      $sql = $koneksi->query("update tb_karyawan set nip='$nip', nama='$nama', jabatan='$jabatan', kode_jabatan='$kode_jabatan', id_lokasi='$id_lokasi', telepon='$telepon', tipe='$tipe', foto='$namafotobaru', username='$username', level='$level', status='$status' where id='$id'");
    }

    $upload = move_uploaded_file($lokasi, "images/karyawan/".$namafotobaru);

    } else {

      if(!empty($password)){
        $password2 = md5($password);
        $sql = $koneksi->query("update tb_karyawan set nip='$nip', nama='$nama', jabatan='$jabatan', kode_jabatan='$kode_jabatan', id_lokasi='$id_lokasi', telepon='$telepon', tipe='$tipe', username='$username', password='$password2', level='$level', status='$status' where id='$id'");
      } else {
        $sql = $koneksi->query("update tb_karyawan set nip='$nip', nama='$nama', jabatan='$jabatan', kode_jabatan='$kode_jabatan', id_lokasi='$id_lokasi', telepon='$telepon', tipe='$tipe', username='$username', level='$level', status='$status' where id='$id'");
      }
    }
  
  if($sql) {

  ?>
    <script type="text/javascript">
          alert ("Data Berhasil Disimpan");
          window.location.href="?page=karyawan";
    </script>
  <?php
  } else {

  ?>
    <script type="text/javascript">
          alert ("Data Gagal Disimpan");
          window.location.href="?page=karyawan";
    </script>
  <?php

  }
}

 
?>

