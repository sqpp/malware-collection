<?php
error_reporting(0);
include('connection.php');

######   ENGLISH BANGLISH / BANGLA CLASS  ######

include('english-banglish-class.php');
include('bangla-class.php');
include('english-retrain-class.php');
include('banglish-retrain-class.php');
include('bangla-retrain-class.php');

$getmsisdn = $_COOKIE['usmsis'];
$getname = $_COOKIE['usname'];

$dt = new DateTime('now', new DateTimezone('Asia/Dhaka')); 
$dat= $dt->format('d-m-Y');
$tim=$dt->format('h:i a');
$bot="BOT";
 
$datec = strtotime($dat); 
$day= date('l') ; 
$month= date('F') ;
$year= date('Y') ;
$m_view = "1";

// $connection = mysqli_connect('localhost', 'preneurlabdigi_robiwebbot', 'robiwebbot@2018');


// if (!$connection) {
//     echo 'Server not connected';
// }
// $db = mysqli_select_db($connection, 'preneurlabdigi_robiwebbot');
// if (!$db) {
//     echo 'Database not connected';
// }

$anser = "Hello";

// echo  json_encode(array('ans'=>$anser,'q1'=>$anser));
// /*

session_id();
session_start();

if(isset($_SESSION['cust_id']))
{
     $id = $_SESSION['cust_id'];
      $cust = $_SESSION['name'];
     //echo $id;
}
else
 {     header('Location: login.php',TRUE,301);
 }


$get_name = "SELECT * FROM customer WHERE cust_id = '".$id."' ";
$get_name_res = mysqli_query($connection,$get_name);
$row_name = mysqli_fetch_array($get_name_res);
$name = $row_name['name'];
$phone = $row_name['phone'];
$u_id = $name."|".$phone;

mysqli_set_charset($connection, "utf8"); 
header("Content-type: text/javascript");

$str = $_POST['search'];

$rmc = $str[strlen($str)-1];

if($rmc === " "){
    $str = preg_replace('/\s+/', ' ',$str);
    $str = substr($str, 0, -1);
}

// $insert_as_human = "INSERT INTO user_chat_messages (message_content,username,date,date2timestamp,message_time,recipient,day,month,year,m_view) VALUES
//                     ('$str','$u_id','$dat','$datec','$tim','$bot','$day','$month','$year','$m_view') ";
// $insert_as_human_res = mysqli_query($connection,$insert_as_human);

$api_query = strtolower($str);

$api_query = str_replace("?","",$api_query);
$api_query = str_replace("'","",$api_query);
$api_query = str_replace("#","",$api_query);

$api_query = str_replace("4.5G ","4G ",$api_query);
$api_query = str_replace("৪.৫জি ","৪জি ",$api_query);
$api_query = str_replace("৪ জি ","৪জি ",$api_query); 
$api_query = str_replace("4.5 G ","4G ",$api_query);
$api_query = str_replace("৪.৫জি ","৪জি ",$api_query);
$api_query2 = str_replace(" ","%20",$api_query);
$api_query2 = str_replace(".","",$api_query);
$api_query = preg_replace('/\s+/', ' ',$api_query); 

$remove_words = array("`","\n","+",",",".","-","'","\"","&","!","?",":",";","#","~","=","/","$","£","^","(",")","_","<",">","{","}","[","]","।");
$api_query = str_replace($remove_words, "", $api_query);
$api_query = preg_replace('/\s+/', " ",$api_query);
$api_query2 = str_replace(" ", "%20", $api_query);

$app=$api_query2;

$check_language = explode('%20', $app);
$check_test=$check_language[0];
$english="ENGLISH";
$bangla="BANGLA";
$lang="";
if($api_query2 == "TNX" || $api_query2 == "TNQ" || $api_query2 == "TY")
{$api_query2 = "THANKS";}
if($api_query2 == "COMPLAIN" || $api_query2 == "COMPLIAN")
{$api_query2 = "COMPLAINT";}
if($api_query2=="HI" || $api_query2=="MAIN%20MENU" || $api_query2=="MAIN-MENU" || $api_query2=="START%20OVER" || $api_query2 == "TALK%20WITH%20ARQO%20AGAIN"){
    $api_query2="HELLO";
}
if($api_query2 == "স্টার্ট%20অভার" || $api_query2 == "স্টার্ট%20ওভার" || $api_query2 == "মূল%20মেন্যু" || $api_query2 == "মূল%20মেনু")
{$api_query2 = "হ্যালো";}

$eng=0;
$bn=0;


        $one_or_two=substr_count($api_query," ");
    
        if($one_or_two > 0){
    
          $check_language=explode(" ", $api_query);
    
          foreach ($check_language as $check_test) {
    
              if (!preg_match('/[^A-Za-z0-9]/', $check_test)){
                  $eng=$eng+1;
              } else {
                  $bn=$bn+1;
              }
                
    
          }
    
        }else{
    
          if (!preg_match('/[^A-Za-z0-9]/', $api_query)){
              $eng=$eng+1;
          } else {
              $bn=$bn+1;
          }
    
        }
        



// foreach ($check_language as $check_test) {

//   if (!preg_match('/[^A-Za-z0-9]/', $check_test)){
//       $eng=$eng+1;
//   } else {
//       $bn=$bn+1;
//   }
// }
    
if($api_query=="4G" ){
    $api_query="4.5G+";
}else if($api_query === "৪৫জি" || $api_query === "৪ জি"){
    $api_query = "৪জি";
}else if($api_query === "4 g" || $api_query === "45 g"){
    $api_query = "4g";
}

if($api_query2=="HI" || $api_query2=="HLW" ){
    $api_query2="HELLO";
}

// echo $eng." ".$bn;

if($eng>=$bn){
// echo "ENGLISH\n";

    $engbnglang = englishBanglishClass($api_query);   
    $api_data=json_decode($engbnglang, true);     
}else{
// echo "BANGLA\n";

    $banglalng = banglaClass($api_query); 
    $api_data=json_decode($banglalng, true);  
}



if($api_data['ambiguous1'] != null && $api_data['answer1'] == null){

    
    if($eng>=$bn){
    // echo "RRREEE\n";
        $remove_words = array("`","\n","+",",",".","-","'","\"","&","!","?",":",";","#","~","=","/","$","£","^","(",")","_","<",">","{","}","[","]","।");
        $app_train = str_replace($remove_words, "", $api_query);
        $app_train2 = $app_train; 
        $app_train = str_replace(" ", "%20", $app_train); 
    
        $eng_eng=0;
        $bn_bng=0;    
        $one_or_two=substr_count($app_train2," ");
    
        if($one_or_two > 0){
    
          $check_language=explode(" ", $app_train2);
    
          foreach ($check_language as $check_test) {
    
            $diff1 = "SELECT * FROM diff_bang_eng WHERE english_key like '% ".$check_test." %' AND find = '1' ";
            $diff_res1 = mysqli_query($connection,$diff1);
            $diff_row1 = mysqli_fetch_array($diff_res1);
            $diff_eng = $diff_row1['english_key'];
            if($diff_eng != null){
              $eng_eng ++;
            }
    
            $diff2 = "SELECT * FROM diff_bang_eng WHERE banglish_key like '% ".$check_test." %' AND find = '1' ";
            $diff_res2 = mysqli_query($connection,$diff2);
            $diff_row2 = mysqli_fetch_array($diff_res2);
            $diff_bng = $diff_row2['banglish_key'];
            if($diff_bng != null){
              $bn_bng ++;
            }
    
    
          }
    
        }else{
    
            $diff1 = "SELECT * FROM diff_bang_eng WHERE english_key like '% ".$app_train2." %' AND find = '1' ";
            $diff_res1 = mysqli_query($connection,$diff1);
            $diff_row1 = mysqli_fetch_array($diff_res1);
            $diff_eng = $diff_row1['english_key'];
            if($diff_eng != null){
              $eng_eng ++;
            }
    
            $diff2 = "SELECT * FROM diff_bang_eng WHERE banglish_key like '% ".$app_train2." %' AND find = '1' ";
            $diff_res2 = mysqli_query($connection,$diff2);
            $diff_row2 = mysqli_fetch_array($diff_res2);
            $diff_bng = $diff_row2['banglish_key'];
            if($diff_bng != null){
              $bn_bng ++;
            }
    
        }
        
        
        // echo "ENG R ".$eng_eng."\nBN R ".$bn_bng;
        
        
    	if($bn_bng ==0){
            $one = "ONE ENG";
            $englng = englishRetrainClass($api_query); 
            $api_data=json_decode($englng, true);        			
    	}else if($bn_bng!= 0) {
            $one = "TWO BNG";
            $banglng = banglishRetrainClass($api_query); 
            $api_data=json_decode($banglng, true); 	    
    	}else{
            $one = "THREE ENG";
            $englng = englishRetrainClass($api_query); 
            $api_data=json_decode($englng, true);        
          if( $api_data ['answer1'] == null){
            $one = "FOUR BNG";
            $banglng = banglishRetrainClass($api_query); 
            $api_data=json_decode($banglng, true);                 
          }       
        }	    
        
        // echo "\n".$one."\n";
    }else{
        // echo "RRRBBB\n";
        $bnlng = banglaRetrainClass($api_query); 
        $api_data=json_decode($bnlng, true);    
    }

    
}

    $qid = $api_data['id'];
    $greet = $api_data['greet_text'];
    $answer = $api_data['answer1']; 
    $link = $api_data['link']; 
    $payload1 = $api_data['payload1']; 
    $payload2 = $api_data['payload2']; 
    $payload3 = $api_data['payload3']; 
    $payload4 = $api_data['payload4']; 
    $payload5 = $api_data['payload5']; 
    $payload6 = $api_data['payload6']; 
    $payload7 = $api_data['payload7']; 
    $payload8 = $api_data['payload8']; 
    $pay = $api_data['pay']; 
    $element = $api_data['element']; 
    $length = $api_data['length']; 
    $acknowledge = $api_data['acknowledge']; 
    $feedback_flow = $api_data['feedback_flow']; 
    $carousel=$api_data['carousel'];
    // $answer = $answer."sdhdt\n".$qid."\n".$feedback_flow;
    

        if($payload1 != null){
            
             $q_e1 = '<script src="js/chat_2.js"></script><div class="bottom_wrapper'.$payload2.' clearfix"> <div class="send_message'.$payload2.'"> 
            <div class="message_input_wrapper'.$payload2.'" id="search'.$payload2.'"><input class="message_input'.$payload2.'" type="hidden" value="'.$payload1.'" />
            </div><div class="icon"></div><div class="text"><button>'.$payload1.'</button></div></div>';
        }
         
          if($payload3 != null){
            
             $q_e3 = '<script src="js/chat_3.js"></script><div class="bottom_wrapper'.$p3no.' clearfix"> <div class="send_message'.$p3no.'"> 
            <div class="message_input_wrapper'.$p3no.'" id="search'.$p3no.'"><input class="message_input'.$p3no.'" type="hidden" value="'.$payload3.'" />
            </div><div class="icon"></div><div class="text"><button>'.$payload3.'</button></div></div>';
        }
        
         if($payload4 != null){
            
             $q_e4 = '<script src="js/chat_4.js"></script><div class="bottom_wrapper'.$p4no.' clearfix"> <div class="send_message'.$p4no.'"> 
            <div class="message_input_wrapper'.$p4no.'" id="search'.$p4no.'"><input class="message_input'.$p4no.'" type="hidden" value="'.$payload4.'" />
            </div><div class="icon"></div><div class="text"><button>'.$payload4.'</button></div></div>';
        }
        
          if($payload5 != null){
            
             $q_e5 = '<script src="js/chat_5.js"></script><div class="bottom_wrapper'.$p5no.' clearfix"> <div class="send_message'.$p5no.'"> 
            <div class="message_input_wrapper'.$p5no.'" id="search'.$p5no.'"><input class="message_input'.$p5no.'" type="hidden" value="'.$payload5.'" />
            </div><div class="icon"></div><div class="text"><button>'.$payload5.'</button></div></div>';
        }
         if($payload6 != null){
            
             $q_e6 = '<script src="js/chat_6.js"></script><div class="bottom_wrapper'.$p6no.' clearfix"> <div class="send_message'.$p6no.'"> 
            <div class="message_input_wrapper'.$p6no.'" id="search'.$p6no.'"><input class="message_input'.$p6no.'" type="hidden" value="'.$payload6.'" />
            </div><div class="icon"></div><div class="text"><button>'.$payload6.'</button></div></div>';
        }
        
        if($payload7 != null){
            
             $q_e7 = '<script src="js/chat_7.js"></script><div class="bottom_wrapper'.$p7no.' clearfix"> <div class="send_message'.$p7no.'"> 
            <div class="message_input_wrapper'.$p7no.'" id="search'.$p7no.'"><input class="message_input'.$p7no.'" type="hidden" value="'.$payload7.'" />
            </div><div class="icon"></div><div class="text"><button>'.$payload7.'</button></div></div>';
        }
        
    if($link != null){
        if($acknowledge === "bangla"){
            $url = '<a class="c_agent" target="_self" href="'.$link.'">ক্লিক করুন</a>';
        }else{
            $url = '<a class="c_agent" target="_self" href="'.$link.'">Click here</a>';
        }         
    }    
   

    $buttons = $q_e1.$q_e2.$q_e3.$q_e4.$q_e5.$q_e6.$q_e7.$carousel;

if($feedback_flow === "customer_service"){
    if($acknowledge === "bangla"){
//        $answer1 = "দেশজুড়ে অসংখ্য রবি সেবা নিয়ে আমরা সবসময় আছি আপনার পাশে। আপনার নিকটবর্তী রবি সেবার ঠিকানা জানতে রবি সেবা পয়েন্ট বাটনটিতে ক্লিক করুন অথবা সরাসরি এজেন্টের সাথে কথা বলতে এজেন্ট বাটনটিতে ক্লিক করুন।";
//        $answer1 = "<br>হ্যালো! আপনাকে ধন্যবাদ এজেন্টের সাথে যোগাযোগ করার জন্য। একজন এজেন্ট শীঘ্রই আপনার সাথে যোগাযোগ করবেন। ইতিমধ্যে আপনি আমাদের সেবাসমূহ এবং অফারগুলো দেখতে পারেন আমার মাই রবি অ্যাপ্লিকেশন - bit.ly/myrobi1 ডাউনলোডের মাধ্যমে। <br>অথবা https://xho.to/hiaura (মোবাইল থেকে) এ ক্লিক করুন বা আপনার মোবাইলে +8801886664121 এই নাম্বারটি সংরক্ষণ করুন এবং রবি হোয়াটসঅ্যাপ চ্যানেলের সাথে চ্যাট করুন।<br>অথবা এজেন্টের সাথে কথা বলতে নীচের বাটনটি ক্লিক করুন।";
            // agent panel link https://forbangladesh.com/robi-webbot/robibot/e-count-contact-agent.php 8 apr 2021
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/bn/personal/customer-service">রবি সেবা পয়েন্ট</a>';
        $q_cb = '<a class="c_agent" target="_self"  href="https://airtelbot.forbangladesh.com/Appbot/a-index.php?user='.$getmsisdn.'&name='.$getname.'&br=r'.'">এজেন্ট</a>';
     
    }else{
//        $answer1 = "We have a huge number of Robi Sheba centers all over the country. To find the one near you, click Robi Sheba Center button or if you want to contact with agent directly click contact agent button.";
//        $answer1 = "<br>Hello! Thanks for reaching out. You can explore our services and exclusive offers by downloading My Robi App - bit.ly/myrobi1 <br>Or click on https://xho.to/hiaura (from mobile) or save +8801886664121 in your mobile and Chat with Robi WhatsApp Channel.<br>Or click the button below to talk to an agent.";

   
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/customer-service">Robi Sheba Center</a>';
        $q_cb = '<a class="c_agent"  target="_self" href="https://airtelbot.forbangladesh.com/Appbot/a-index.php?user='.$getmsisdn.'&name='.$getname.'&br=r'.'">Contact Agent</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce.$q_cb));   
    
} else if($feedback_flow === "complain_issue"){

    if($acknowledge === "bangla"){
        
        $q_cb = '<a class="c_agent" target="_self" href="'.$link.'">কমপ্লেইন করুন</a>';
     
    }else{
        
        $q_cb = '<a class="c_agent" target="_self" href="'.$link.'">Complain Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$q_cb));  
    
} else if($feedback_flow === "voice_combo_app"){

    $minute_deeplink = "https://f8uqp.app.goo.gl/GV8T7Jnk7GKjaaj3A";
    $combo_deeplink = "https://f8uqp.app.goo.gl/GV8T7Jnk7GKjaaj3A";

    if($acknowledge === "bangla"){
        // $but1 = "ভয়েস বান্ডল"; 
        $but2 = "কম্বো বান্ডল";
        // $q_ce = '<a class="c_agent" target="_self" href="'.$minute_deeplink.'">'.$but1.'</a>';
        $q_cb = '<a class="c_agent" target="_self" href="'.$combo_deeplink.'">'.$but2.'</a>';
    }else{
        $but1 = "Voice Bundle";
        $but2 = "Combo Bundle";
        // $q_ce = '<a class="c_agent" target="_self" href="'.$minute_deeplink.'">'.$but1.'</a>';
        $q_cb = '<a class="c_agent" target="_self" href="'.$combo_deeplink.'">'.$but2.'</a>';
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$q_cb));    

} else if($feedback_flow === "app_deeplinks"){

    $internet_pack_deeplink = "https://f8uqp.app.goo.gl/bYqARCGXhQ5pg6HT6";
    // $minute_bundle_deeplink = "https://f8uqp.app.goo.gl/GV8T7Jnk7GKjaaj3A";
    $combo_bundle_deeplink = "https://f8uqp.app.goo.gl/GV8T7Jnk7GKjaaj3A";

    if($acknowledge === "bangla"){
        
        $deeplink1 = "ইন্টারনেট প্যাকস";
        // $deeplink2 = "মিনিট বান্ডল";
        $deeplink3 = "কম্বো বান্ডল";
        
        $url1 = '<a class="c_agent"  target="_self" href="'.$internet_pack_deeplink.'">'.$deeplink1.'</a>';
        // $url2 = '<a class="c_agent"  target="_self" href="'.$minute_bundle_deeplink.'">'.$deeplink2.'</a>';
        $url3 = '<a class="c_agent"  target="_self" href="'.$combo_bundle_deeplink.'">'.$deeplink3.'</a>';
        
     
    }else{

        $deeplink1 = "Internet Packs";
        // $deeplink2 = "Voice Bundle";
        $deeplink3 = "Combo Bundle";
        
        $url1 = '<a class="c_agent"  target="_self" href="'.$internet_pack_deeplink.'">'.$deeplink1.'</a>';
        // $url2 = '<a class="c_agent"  target="_self" href="'.$minute_bundle_deeplink.'">'.$deeplink2.'</a>';
        $url3 = '<a class="c_agent"  target="_self" href="'.$combo_bundle_deeplink.'">'.$deeplink3.'</a>';
      
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$url1.$url3));   
    
} 
else if($feedback_flow === "new_connection_feedback"){

    if($acknowledge === "bangla"){
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/NYuLjAutNwUDYfbU8">নতুন সংযোগ</a>';
     
    }else{
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/NYuLjAutNwUDYfbU8">New Connection</a>';
      
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$q_ce));    

} 
else if($feedback_flow === "call_history"){

    if($acknowledge === "bangla"){
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/X4kHp4KPgjLWsqFe7">বিস্তারিত</a>';
     
    }else{
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/X4kHp4KPgjLWsqFe7">Call history</a>';
      
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$q_ce));    

} 
else if($feedback_flow === "vas_list"){

    if($acknowledge === "bangla"){
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/qCcN5veRfYgqzj2z5">ভ্যাস</a>';
     
    }else{
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/qCcN5veRfYgqzj2z5">Active VAS</a>';
      
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$q_ce));    

} 
else if($feedback_flow === "special_offer"){

    if($acknowledge === "bangla"){
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/f76FLdUmT1FMiAte6">স্পেশাল অফার</a>';
     
    }else{
        $q_ce = '<a class="c_agent" target="_self" href="https://f8uqp.app.goo.gl/f76FLdUmT1FMiAte6">Special Offer</a>';
      
    }

    echo  json_encode(array('ans'=>$answer,'q1'=>$q_ce));    

} 
else if($feedback_flow === "silent_sim_feedback"){

    if($acknowledge === "bangla"){
        $answer1 = "রবিতে আপনার জন্য রয়েছে আকর্ষণীয় বন্ধ সিম অফার! ফিরে আসুন রবির 4.5 জি নেটওয়ার্কে এবং উপভোগ করুন দারুন সব অফার।";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/bn/personal/offers/silent-sim-offer">অফার দেখুন</a>';
     
    }else{
        $answer1 = "Robi has exciting silent sim offers for you! Return to Robi's 4.5G network and enjoy!";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/offers/silent-sim-offer">Offer Details</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "kids_station"){

    if($acknowledge === "bangla"){
        $answer1 = "";
    
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/kids-station">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "star_zone"){

    if($acknowledge === "bangla"){
        $answer1 = "";
    
        $q_ce = '';
     
    }else{
        $answer1 = "StarZone allows you to talk with your favorite celebrities through your mobile. Service can be enjoyed whether celebrities are either ‘Online’ or ‘Offline’.";
    
        $q_ce = '<a class="c_agent" target="_self" href="http://robi.com.bd/en/personal/vas/starzone">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "smart_babies_app"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/smart-babies-app">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "entertainment_news_service"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/4dl-entertainment-news-service">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "my_own_number"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "chatbot_name"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "cricket_world"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/cricket-world">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

}else if($feedback_flow === "satv_entertainment_service"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/satv-entertainment-service">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "robo_golpo_bola"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/robi-golpo-bola">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "audio_book"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/audio-book">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "background_music_service"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/background-music-service">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "bhooter_ashor"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/bhooter-ashor">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

}else if($feedback_flow === "entertainment_world"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/entertainment-world">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "fun_portal"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/fun-portal">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

} else if($feedback_flow === "love_portal"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '<a class="c_agent" target="_self" href="https://www.robi.com.bd/en/personal/vas/love-portal">For Details Click Here</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

}else if($feedback_flow === "doorstep_service"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $answer1 = "";
    
        $q_ce = '';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce));    

}else if($feedback_flow === "weather"){

    if($acknowledge === "bangla"){
        $answer1 = "";
        
        $q_ce = '';
     
    }else{
        $data = file_get_contents('https://api.weatherbit.io/v2.0/current?key=94c158d99da841a5852ef4674a983b02&city=dhaka,bd');

        $data = json_decode($data, true);
        $condition = $data['data'][0]['weather']['description'];
        $temp = $data['data'][0]['temp'];
        $humidity = $data['data'][0]['rh'];
        $precip = $data['data'][0]['precip'];
        $icon = $data['data'][0]['weather']['icon'];
        $sunset = $data['data'][0]['sunset'];
        $sunset = date('h:i A', strtotime($sunset) + 21600);
        
        $text = " Bangladesh\n\nWeather Condition: " . $condition . "\n Temperature: " . $temp . "°C \n Humiditiy: " . $humidity .  "% \nSunset: " . $sunset . "\nRain Predictor: ";

        if ($precip < 0.1) {
            $text1 = "No chance of rain today.";

        } else if ($precip >= 0.1 && $precip < 2.5) {
            $text1 = "Light Rain";

        } else if ($precip >= 2.5 && $precip < 7.6) {
            $text1 = "Moderate Rain";

        } else if ($precip >= 7.6 && $precip < 50) {
            $text1 = "Heavy Rain";
        }
        $text = $text . " " . $text1;
    
        $q_ce = '';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$text,'q1'=>$q_ce));    

} else if($feedback_flow === "4g_network_coverage_feedback"){

    if($acknowledge === "bangla"){
        $answer1 = "আপনার কভারেজ এরিয়া দেখুন - ";
    
        $q_ce = '<a class="c_agent" target="_self" href="'.$link.'">অনুসন্ধান</a>';
        $q_cb = '<a class="c_agent" target="_self" href="'.$link.'">কভারেজ এরিয়া লিস্ট</a>';
     
    }else{
        $answer1 = "Check your coverage area here -";
    
        $q_ce = '<a class="c_agent" target="_self" href="'.$link.'">Check</a>';
        $q_cb = '<a class="c_agent" target="_self" href="'.$link.'">Coverage Area List</a>';
      
    }

    echo  json_encode(array('ans'=>$answer."\n".$answer1,'q1'=>$q_ce.$q_cb));
    
} else if($feedback_flow === "arqo_greet"){

    $rnd = (rand(20,30));
    $rnd1 = $rnd++;
        $q_e1 = '<script src="js/chat_2.js"></script><div class="bottom_wrapper'.$rnd.' clearfix"> <div class="send_message'.$rnd.'"> 
        <div class="message_input_wrapper'.$rnd.'" id="search'.$rnd.'"><input class="message_input'.$rnd.'" type="hidden" value="বাংলা" />
        </div><div class="icon"></div><div class="text"><button>বাংলা</button></div></div>'; 
        
        $q_e2 = '<script src="js/chat_3.js"></script><div class="bottom_wrapper'.$rnd1.' clearfix"> <div class="send_message'.$rnd1.'"> 
        <div class="message_input_wrapper'.$rnd1.'" id="search'.$rnd1.'"><input class="message_input'.$rnd1.'" type="hidden" value="English" />
        </div><div class="icon"></div><div class="text"><button>English</button></div></div>';     


    echo  json_encode(array('ans'=>$answer,'q1'=>$q_e1.$q_e2)); 

    
} else if($api_query === "english"){
    
    $rnd = (rand(50,57));
    $rnd1 = $rnd++;
    $rnd2 = $rnd++;
    $rnd3 = $rnd++;
    $rnd4 = $rnd++;
    $rnd5 = $rnd++;
    
    $answer1 = "Thanks for knocking us. Let me find out what you are looking for –";
    $answer2 = "I can also show you few amazing offers.";
    $answer3 = "You can also explore.";
    $but1 = "Internet Packs";
    $but2 = "Bundle Packs";
    $but3 = "New Connection";
    $but4 = "Call History";
    $but5 = "Active VAS List";
    $but6 = "Special Offer";
    $but7 = "4.5G Coverage";
    
    $internet_pack_deeplink = "https://f8uqp.app.goo.gl/bYqARCGXhQ5pg6HT6";
    $combo_bundle_deeplink = "https://f8uqp.app.goo.gl/GV8T7Jnk7GKjaaj3A";
    $new_connection_deeplink = "https://f8uqp.app.goo.gl/NYuLjAutNwUDYfbU8";
    $call_history_deeplink = "https://f8uqp.app.goo.gl/X4kHp4KPgjLWsqFe7";
    $vas_list_deeplink = "https://f8uqp.app.goo.gl/qCcN5veRfYgqzj2z5";
    $special_offer_deeplink = "https://f8uqp.app.goo.gl/f76FLdUmT1FMiAte6";
    
    $q_e1 = '<a class="c_agent"  target="_self" href="'.$internet_pack_deeplink.'">'.$but1.'</a>';
    
    $q_e2 = '<a class="c_agent"  target="_self" href="'.$combo_bundle_deeplink.'">'.$but2.'</a>';
    
    $q_e3 = '<a class="c_agent"  target="_self" href="'.$new_connection_deeplink.'">'.$but3.'</a>';
    
    $q_e4 = '<a class="c_agent"  target="_self" href="'.$call_history_deeplink.'">'.$but4.'</a>';
    
    $q_e5 = '<a class="c_agent"  target="_self" href="'.$vas_list_deeplink.'">'.$but5.'</a>';
    
    $q_e6 = '<a class="c_agent"  target="_self" href="'.$special_offer_deeplink.'">'.$but6.'</a>';
    
    $q_e7 = '<script src="js/chat_2.js"></script><div class="bottom_wrapper'.$rnd.' clearfix"> <div class="send_message'.$rnd.'"> 
        <div class="message_input_wrapper'.$rnd.'" id="search'.$rnd.'"><input class="message_input'.$rnd.'" type="hidden" value="'.$but7.'" />
        </div><div class="icon"></div><div class="text"><button>'.$but7.'</button></div></div></div>';
    
    echo  json_encode(array('ans'=>$answer1,'q1'=>$q_e1.$q_e2.$q_e3."<br>".$answer2."<br>".$q_e4.$q_e5."<br>".$answer3."<br>".$q_e6.$q_e7));
        
}else if($api_query === "bangla" || $api_query === "বাংলা" || $api_query === "বাঙলা"){

    $rnd = (rand(30,40));
  
    $rnd1 = $rnd++;
    $rnd2 = $rnd++;
    $rnd3 = $rnd++;
    $rnd4 = $rnd++;  
    $rnd5 = $rnd++;  
    $answer1 = "আমাদেরকে নক করার জন্য ধন্যবাদ। চলুন দেখে নেই আপনার জন্য কি রয়েছে-";
    $answer2 = "আমি আপনাকে আরও কিছু আকর্ষণীয় অফার প্রদর্শন করতে পারি।";
    $answer3 = "আপনি আরও অনুসন্ধান করতে পারেন।";    
    $answer = $answer1.$answer2.$answer3;

    
    $but1 = "ইন্টারনেট প্যাকস";
    $but2 = "বান্ডল প্যাক";
    $but3 = "নতুন সংযোগ";
    $but4 = "কল হিস্ট্রি";
    $but5 = "ভ্যাস";
    $but6 = "স্পেশাল অফার";
    $but7 = "৪.৫জি কভারেজ";
    
    $internet_pack_deeplink = "https://f8uqp.app.goo.gl/bYqARCGXhQ5pg6HT6";
    $combo_bundle_deeplink = "https://f8uqp.app.goo.gl/GV8T7Jnk7GKjaaj3A";
    $new_connection_deeplink = "https://f8uqp.app.goo.gl/NYuLjAutNwUDYfbU8";
    $call_history_deeplink = "https://f8uqp.app.goo.gl/X4kHp4KPgjLWsqFe7";
    $vas_list_deeplink = "https://f8uqp.app.goo.gl/qCcN5veRfYgqzj2z5";
    $special_offer_deeplink = "https://f8uqp.app.goo.gl/f76FLdUmT1FMiAte6";
    
    $q_e1 = '<a class="c_agent"  target="_self" href="'.$internet_pack_deeplink.'">'.$but1.'</a>';
    
    $q_e2 = '<a class="c_agent"  target="_self" href="'.$combo_bundle_deeplink.'">'.$but2.'</a>';
    
    $q_e3 = '<a class="c_agent"  target="_self" href="'.$new_connection_deeplink.'">'.$but3.'</a>';
    
    $q_e4 = '<a class="c_agent"  target="_self" href="'.$call_history_deeplink.'">'.$but4.'</a>';
    
    $q_e5 = '<a class="c_agent"  target="_self" href="'.$vas_list_deeplink.'">'.$but5.'</a>';
    
    $q_e6 = '<a class="c_agent"  target="_self" href="'.$special_offer_deeplink.'">'.$but6.'</a>';
    
    $q_e7 = '<script src="js/chat_2.js"></script><div class="bottom_wrapper'.$rnd.' clearfix"> <div class="send_message'.$rnd.'"> 
        <div class="message_input_wrapper'.$rnd.'" id="search'.$rnd.'"><input class="message_input'.$rnd.'" type="hidden" value="'.$but7.'" />
        </div><div class="icon"></div><div class="text"><button>'.$but7.'</button></div></div></div>';
    
    echo  json_encode(array('ans'=>$answer1,'q1'=>$q_e1.$q_e2.$q_e3."<br>".$answer2."<br>".$q_e4.$q_e5."<br>".$answer3."<br>".$q_e6.$q_e7));
    
}else if($answer != null){
    echo  json_encode(array('ans'=>$answer,'q1'=>$url.$buttons));
}else{
    
    if($eng>$bn){
        $answer1 = "I am sorry I did not understand what you said. Can you kindly use easier words for me to understand better since I am still in my learning phase? Or you can find help from the option below.";
    
        $q_cb = '<a class="c_agent"  target="_self" href="https://forbangladesh.com/robi-webbot/robibot/e-count-contact-agent.php?msisdn='.$getmsisdn.'&name='.$getname.'">Contact Agent</a>';
    }else{
        $answer1 = "আমি দুঃখিত, আমি আপনার প্রশ্নটি বুঝতে পারি নি। আরও ভালো বুঝার জন্য আপনি কি সহজ ভাষায় প্রশ্ন করবেন যেহেতু আমি এখনো শেখার পর্যায়ে আছি? অথবা আপনি নিচের মেন্যু থেকে সাহায্য নিতে পারেন।";
    
        $q_cb = '<a class="c_agent" target="_self"  href="https://forbangladesh.com/robi-webbot/robibot/e-count-contact-agent.php?msisdn='.$getmsisdn.'&name='.$getname.'">এজেন্ট</a>';
    }
    
    echo  json_encode(array('ans'=>$answer1,'q1'=>$q_cb));
    // $answer = "Sorry, we are contacting you through an automated system at the moment. The answer you are looking for is currently unavailable in our system database. To know the answer please click the below menu.
// দুঃখিত, এই মুহূর্তে আমরা একটি স্বয়ংক্রিয় সিস্টেমের মাধ্যমে আপনার সাথে যোগাযোগ করছি। আপনার প্রশ্নটির উত্তর এই মুহূর্তে আমাদের সিস্টেমে নেই। আপনার প্রশ্নের উত্তরটি জানতে নিচের মেন্যুতে ক্লিক করুন";

    // $q_ce = '<a class="c_agent"  target="_self" href="https://forbangladesh.com/robi-webbot/app-bot/count-contact-agent.php">Contact Agent</a>';
    // $q_cb = '<a class="c_agent"  target="_self" href="https://forbangladesh.com/robi-webbot/app-bot/count-contact-agent.php">এজেন্ট</a>';
    }

if($answer == ''){
    $answer = $answer1.$answer2;
}
$datTime= $dt->format('d-m-Y h:i a');

// $insert_as_bot = "INSERT INTO user_chat_messages (message_content,username,date,date2timestamp,message_time,recipient,day,month,year,m_view) VALUES
//                     ('$answer','$bot','$dat','$datec','$tim','$u_id','$day','$month','$year','$m_view') ";
// $insert_as_bot_res = mysqli_query($connection,$insert_as_bot);

// $insert_as_human = "INSERT INTO user_chat_messages (message_content,username,date,date2timestamp,message_time,recipient,day,month,year,m_view) VALUES
//                     ('$str','$u_id','$dat','$datec','$tim','$bot','$day','$month','$year','$m_view') ";
// $insert_as_human_res = mysqli_query($connection,$insert_as_human);
//$usmsis =$_SESSION['usmsis'];
 $insert_as_human = "INSERT INTO `chat_messages`(`user`, `phoneNumber`, `message`, `response`, `date`) VALUES ('$getmsisdn','$getmsisdn','$str','$answer','$datTime')";
 $insert_as_human_res = mysqli_query($connection,$insert_as_human);