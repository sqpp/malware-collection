<?php session_start();
if(isset($_POST['check_login'])) {
	include('includes/model.php');
	include('includes/library.php');
	$db = new Model();
		$mobile = $db->realTrim($_POST['mobile']);
		$password = $db->realTrim($_POST['password']);
		$today = date('d-m-Y');
if(!empty($mobile) && !empty($password)) {
	if (strlen($mobile)==10 AND is_numeric($mobile)) {
		$get_user = "SELECT * FROM users where mobile_no = '$mobile'";
		$res_user = $db->getSelect($get_user);
			$db_hash_pass = $res_user[0]['pass'];
	if($res_user[0]['user_role'] == 'admin') {
		if(password_verify($password, $db_hash_pass)) {
			if($res_user[0]['is_active'] == 'Yes') {
			$memuid = $res_user[0]['mem_uid'];
		$get_user_det = "SELECT * FROM user_details where mem_uid = '$memuid'";
		$res_user_det = $db->getSelect($get_user_det);

			$_SESSION['login_mem'] = $res_user[0]['mem_uid'];
			$_SESSION['login_mem_role'] = $res_user[0]['user_role'];
			$design_arr = explode(' ', $res_user_det[0]['designation']);
				$desig_area = strtolower($design_arr[0]);
					$_SESSION['err_msg'] = "<div class='alert alert-success'>Welcome to Shree Ram Sena.</div>";
	        		header("Location: ".$desig_area);
				} else {
					$_SESSION['err_msg'] = "<div class='alert alert-danger'>Your Account has been blocked. Contact Support!</div>";
	        		header("Location: ".$_SERVER['HTTP_REFERER']);
				}
					} else {
						$_SESSION['err_msg'] = "<div class='alert alert-danger'>Incorrect Password! Please Try again.</div>";
		        		header("Location: ".$_SERVER['HTTP_REFERER']);
					}
			} else {
				header('Location: login.php');
				$_SESSION['err_msg'] = "<div class='alert alert-danger'>You are not an Admin member.</div>";
			}
		} else {
			header('Location: login.php');
			$_SESSION['err_msg'] = "<div class='alert alert-danger'>Mobile No. should be 10 digit numeric.</div>";
		}
	} else {
		header('Location: login.php');
		$_SESSION['err_msg'] = "<div class='alert alert-danger'>Mobile No. and Password cannot be empty.</div>";
	}
} ?>