<?php

$hash = hash_init('sha256');

$challengeCode = '';
if ( isset($_GET['challenge_code']) ) {
	$challengeCode = $_GET['challenge_code'];
}
$jsonget = file_get_contents('php://input');
$verificationToken = 'ABCABCABCAABCABCABCAABCABCABCAAA';
$endpoint = 'https://domita.it/ebay_notification.php';

hash_update($hash, $challengeCode);
hash_update($hash, $verificationToken);
hash_update($hash, $endpoint);

$responseHash = hash_final($hash);

$data = [ 'challengeResponse' => $responseHash ];

file_put_contents('ebay_notification.txt', 'jsonget:'.print_r($jsonget, true)."\r\n", FILE_APPEND | LOCK_EX);
file_put_contents('ebay_notification.txt', 'post:'.print_r($_POST, true)."\r\n", FILE_APPEND | LOCK_EX);
file_put_contents('ebay_notification.txt', 'get:'.print_r($_GET, true)."\r\n", FILE_APPEND | LOCK_EX);
file_put_contents('ebay_notification.txt', 'responseHash: '.$responseHash."\r\n", FILE_APPEND | LOCK_EX);
file_put_contents('ebay_notification.txt', 'data: '.print_r($data, true)."\r\n", FILE_APPEND | LOCK_EX);

header('Content-Type: application/json');
echo json_encode($data);

?>