<?php

$telegram_ip_ranges = [
    ['lower' => '149.154.160.0', 'upper' => '149.154.175.255'],
    // literally 149.154.160.0/20
    ['lower' => '91.108.4.0', 'upper' => '91.108.7.255'],
];
$ip_dec = (float) sprintf("%u", ip2long($_SERVER['REMOTE_ADDR']));
$ok = false;
foreach ($telegram_ip_ranges as $telegram_ip_range) {
    if (!$ok) {
        // Make sure the IP is valid.
        $lower_dec = (float) sprintf("%u", ip2long($telegram_ip_range['lower']));
        $upper_dec = (float) sprintf("%u", ip2long($telegram_ip_range['upper']));
        if ($ip_dec >= $lower_dec and $ip_dec <= $upper_dec) {
            $ok = true;
        }
    }
}
if (!$ok) {
    die("تمامی حقوق محفوظ است ...");
}
ob_start();
set_time_limit(0);
error_reporting(0);
require 'lak.php';
if (is_file("error_log")) {
    unlink("error_log");
}
@($command = json_decode(file_get_contents('ure/' . $from_id . '/command.json'), true));
@($command2 = json_decode(file_get_contents('ure/' . $from_id2 . '/command.json'), true));
$truechannel = json_decode(file_get_contents('https://api.telegram.org/bot' . API_KEY . "/getChatMember?chat_id=@{$channellog}&user_id=" . $from_id));
$channelLock = $truechannel->result->status;
$truechannel2 = json_decode(file_get_contents('https://api.telegram.org/bot' . API_KEY . "/getChatMember?chat_id=@{$channellog}&user_id=" . $from_id2));
$first_name = $message->from->first_name;
//------------------------------
if (file_exists("block/{$from_id}.txt")) {
    exit;
}
if (file_get_contents("spam/{$from_id}.txt") > time()) {
    $message = file_get_contents("message/{$from_id}.txt") + 1;
    file_put_contents("message/{$from_id}.txt", $message);
    if ($message >= 5) {
        SendMessage($from_id, "❌ به دلیل ارسال پیام های مکرر به ربات شما مسدود شدید");
    }
}
if (file_get_contents("spam/{$from_id}.txt") > time()) {
    exit;
}
if (isset($text)) {
    file_put_contents("spam/{$from_id}.txt", time() + 1);
}
if ($bot == 'off' and !in_array($from_id, $admins) and $from_id or !in_array($from_id2, $admins) and $bot == 'off' and $from_id2) {
    return false;
}
if ($text == '/start' or $text == '↩️برگشت') {
    if ($channelLock == 'left' and $data == null) {
        SendMessage($chat_id, "جهت ادامه کار شما باید در کانال اطلاع رسانی ما عضو شوید .\n\n@kajcanel\n@Ra_seen\n👈 سپس بر روی /start  کلیک کنید");
    } else {
        SendMessage($chat_id, "سلام ، به ربات راسین کاج خوش آمدید\n\n👈🏻 با ربات راسین کاج کنار شما هستیم تا بازدید های پست های شما را افزایش دهیم .\n\n👇🏻 برای ادامه یکی از گزینه ها را انتخاب کنید", $button_home);
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
        if (!in_array($from_id, explode("\n", $members))) {
            file_put_contents('memcount.txt', $memcount + 1);
            file_put_contents('members.txt', $members . "\n" . $from_id);
            mkdir('ure/' . $from_id);
            $setting = json_encode(['nitro' => 0, 'account' => '🌟', 'start_date' => $date, 'warns' => 0, 'coins' => 10, 'laiks' => 0, 'inst' => 0, 'sent_transfer' => 0, 'get_transfer' => 0, 'subsets' => 0, 'submits' => 0, 'subset_coins' => 0, 'subset_view' => 0, 'spent_coins' => 0, 'challenge_view' => 0, 'challenge_submits' => 0, 'challenge_subsets' => 0, 'views' => 0]);
            file_put_contents('ure/' . $from_id . '/command.json', $setting);
        } else {
            $step = $command['command'] = 'none';
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        }
    }
} elseif (strpos($text, '/start ') !== false) {
    $newid = str_replace('/start ', "", $text);
    if ($from_id == $newid) {
        SendMessage($chat_id, '❌شما نمیتونید با لینک خوتان دوباره عضو ربات شوید', $button_home);
    } elseif (in_array($from_id, explode("\n", $members))) {
        SendMessage($chat_id, '❌شما قبلا عضو ربات شده اید', $button_home);
    } else {
        file_put_contents('memcount.txt', $memcount + 1);
        file_put_contents('members.txt', $members . "\n" . $from_id);
        mkdir('ure/' . $from_id);
        $setting = json_encode(['nitro' => 0, 'account' => '🌟', 'start_date' => $date, 'warns' => 0, 'coins' => 10, 'inst' => 0, 'sent_transfer' => 0, 'get_transfer' => 0, 'subsets' => 0, 'submits' => 0, 'subset_coins' => 0, 'subset_view' => 0, 'spent_coins' => 0, 'challenge_view' => 0, 'challenge_submits' => 0, 'challenge_subsets' => 0, 'inviter' => $newid, 'views' => 0, 'first_seen' => 'no']);
        file_put_contents('ure/' . $from_id . '/command.json', $setting);
        SendMessage($chat_id, "سلام ، به ربات راسین کاج خوش آمدید\n\n👈🏻 با ربات راسین کاج کنار شما هستیم تا بازدید های پست های شما را افزایش دهیم .\n\n👇🏻 برای ادامه یکی از گزینه ها را انتخاب کنید", $button_home);
        SendMessage($newid, "🎁 یک نفر با لینک شما وارد ربات شد و 350 سکه شما دریافت کردید !");
        $user = json_decode(file_get_contents('ure/' . $newid . '/command.json'), true);
        $subsets = $user['subsets'] = $user['subsets'] + 1;
        $challenge_subsets = $user['challenge_subsets'] = $user['challenge_subsets'] + 1;
        $coin = $user['coins'] = $user['coins'] + 350;
        file_put_contents("ure/{$newid}/command.json", json_encode($user));
    }
} elseif ($channelLock == 'left' and $data == null) {
    SendMessage($chat_id, "\n💫 کاربر عزیز جهت استفاده از ربات راسین کاج ابتدا در کانال زیر عضو شوید:\n@kajcanel\n@Ra_seen\n✅ سپس بعد عضویت /start به ربات ارسال نمایید\n\n", json_encode(['inline_keyboard' => [[['text' => 'عضویت در کانال🌐', 'url' => "https://t.me/{$channellog}"]], [['text' => 'عضو شدم ✋', 'callback_data' => 'check']]]]));
} elseif ($data == 'check') {
    if ($channelLock2 == 'left') {
        AnswerCallback($callback_id, "ابتدا در کانال @kajcanel عضو شوید", true);
    } else {
        deleteMessage($chatid, $message_id2);
        SendMessage($chatid, "✅ عضویت شما تایید شد.\nاز این پس می توانید از ربات راسین کاج استفاده کنید", $button_home);
    }
} elseif ($text == '🚀 بازدید خودکار' or $text == '🚀 بازدید خودکار' or $text == '↩️برگشت به منوی قبل') {
    unlink("ure/{$chat_id}/link.txt");
    unlink("ure/{$chat_id}/link2.txt");
    unlink("ure/{$chat_id}/linkk.txt");
    unlink("ure/{$chat_id}/tabligh.txt");
    unlink("ure/{$chat_id}/tetad.txt");
    SendMessage($chat_id, "📚در این بخش شما میتوانید :\n\n👈 کانال خود را در راسین کاج  ثبت کنید تا به محض انتشار پستهای جدید، افزایش بازدید به طور خودکار برای آنها آغاز شود.\n\nحالا یکی از گزینه های زیر را انتخاب کنید👇", json_encode(['keyboard' => [[['text' => "📢 لیست کانال ها"], ['text' => "🎯 ثبت کانال"]], [['text' => "↩️برگشت"], ['text' => "🗑حذف کانال"]]], 'resize_keyboard' => true]));
} elseif ($text == '🗂ویو چند پست') {
    SendMessage($chat_id, "📖 در این بخش میتوانید:\n\n- به پست های اخیر کانال خود به صورت گروهی و دسته جمعی ویو بزنید . ( 50 و 100 پست )\n\nحالا یکی از گزینه های زیر را انتخاب کنید👇", json_encode(['keyboard' => [[['text' => "صد پست"], ['text' => "پنجاه پست"]], [['text' => "↩️برگشت"]]], 'resize_keyboard' => true]));
} elseif ($text == '📞') {
    SendMessage($chat_id, "⏺ 📞 آیدی پشتیبانی جهت رسیدگی بهتر  \n@Write_M\n\n▪️ پشتیبانی طی 24 ساعت پاسخ شما ما را میدهد .\n▪️سوالات درباره سورس و فروش و انواع این نوع سوالات پاسخ داده نمی شود.\n▪️ مشکلات فنی ربات تنها پاسخ داده میشود \n▪️ در صورت مسدود شدن حساب کاربری حساب شما به هیچ عنوان آزاد نخواهد شد\n▪️ از ارسال اسپم و هرزنامه خودداری کنید", json_encode(['keyboard' => [], 'resize_keyboard' => true]));
} elseif ($text == '❤' or $text == '📊') {
    SendMessage($chat_id, "⚠️ این بخش در حال طراحی و تکمیل است و به زودی فعال خواهد شد .", json_encode(['keyboard' => [], 'resize_keyboard' => true]));
} elseif ($text == 'بازدید👁‍🗨' or $text == 'لایک و رای❤️' or $text == 'بازدید سایت📉' or $text == 'بازدیدخودکار🚀' or $text == '➕افزایش موجودی' or $text == '📊سفارشات من' or $text == 'kicfgdhgfhgfjh*-*' or $text == '🤖' or $text == '👤' or $text == '🎲‌') {
    SendMessage($chat_id, "✅ شما به نسخه جدید راسین منتقل شدید .", $button_home);
    //----------------------
} elseif ($text == '🔐 حساب من' or $text == '🔐') {
    unlink("ure/{$chat_id}/link2.txt");
    unlink("ure/{$chat_id}/linkk.txt");
    unlink("ure/{$chat_id}/tabligh.txt");
    unlink("ure/{$chat_id}/tetad.txt");
    unlink("ure/{$chat_id}/link3.txt");
    unlink("ure/{$chat_id}/linkk4.txt");
    if ($command['account'] != '🌟') {
        date_default_timezone_set('Asia/Tehran');
        $date2 = date('d');
        $date1 = date('m');
        $ndate = $command["date_tarh"];
        $gettime2 = date('d', strtotime($ndate));
        $gettime1 = date('m', strtotime($ndate));
        $gettime = $gettime1 - $date1;
        $gettime2 = $gettime2 - $date2;
        $ingettime = $gettime * 10;
        $endtime = $ingettime + $gettime2;
        if ($endtime <= 0) {
            $account = $command['account'] = '🌟';
            unset($command['date_tah']);
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            $tarh = "🌟";
        } else {
            $tarh = $command['account'] . " (مدت اعتبار:" . $endtime . "روز)";
        }
    } else {
        $command = json_decode(file_get_contents('ure/' . $from_id . '/command.json'), true);
        $tarh = "🌟";
    }
    //$account = $command['account'];
    $first_name = $message->from->first_name;
    $views = $command['views'];
    $seke = $command['seke'];
    $coins = $command['coins'];
    $pane = $command['pane'];
    $inst = $command['inst'];
    $start_date = $command['start_date'];
    $warns = $command['warns'];
    $submits = $command['submits'];
    $sent_transfer = $command['sent_transfer'];
    $get_transfer = $command['get_transfer'];
    $subsets = $command['subsets'];
    $subset_coins = $command['subset_coins'];
    $subset_view = $command['subset_view'];
    $spent_coins = $command['spent_coins'];
    $first_name = $message->from->first_name;
    $res = floor($coins);
    bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n   {$first_name} \n    👤 شناسه شما: <b> {$from_id} </b>\n📆 تاریخ عضویت:  {$start_date}\n⚠️ اخطار های شما: {$warns} از 3\n🏆 سطح شما : {$tarh}\n\n📦 موجودی مصرفی شما: {$spent_coins}\n👨‍👦 تعداد زیرمجموعه های شما:  {$subsets} نفر\n‏🧮 مجموع خرید ۳۰ روز گذشته: 0 تومان\n\n💰  موجودی شما : <b> {$res} </b> \n\n<code> ⏰ Rasin : {$date} {$time} </code>\n", 'parse_mode' => 'html']);
} elseif (strpos($data, 'UUy') !== false) {
    AnswerCallback($callback_id, "\n⭕️ کلیک بر این گزینه بی استفاده میباشد.\n\t\t\t", true);
} elseif ($text == '📥 ارسال اکانت') {
    bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n✅ اکانت مجازی ارسال کنید و سکه رایگان دریافت کنید :\n\nبا استفاده از ربات @AccMoneybot طبق مراحل گفته شده اکانت ارسال کنید و سکه دریافت کنید .", 'parse_mode' => 'html']);
} elseif ($text == '🎁') {
    unlink("ure/{$chat_id}/link.txt");
    unlink("ure/{$chat_id}/link2.txt");
    unlink("ure/{$chat_id}/linkk.txt");
    unlink("ure/{$chat_id}/tabligh.txt");
    unlink("ure/{$chat_id}/tetad.txt");
    bot('sendmessage', ['chat_id' => $chat_id, 'message_id' => $message_id2, 'text' => "\n👈 شما میتوانید با استفاده از بخش های زیر سکه رایگان دریافت کنید .", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => '📥 ارسال اکانت'], ['text' => '👥 زیرمجموعه'], ['text' => '🎲 جایزه روزانه']], [['text' => "↩️برگشت"]]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
} elseif ($text == '💳 انتقال سکه به ویراژ سین') {
    $coins = $command['coins'];
    $res = floor($coins);
    if ($channelLock == 'left' and $data == null) {
    } else {
        $step = $command['command'] = 'seke1';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, "👈 لطفا سکه مورد نظر برای انتقال به ربات ویراژ را وارد کنید : \n- موجودی شما : {$res} \n- این فرایند به صورت خودکار و آنی انجام میشود و بعد انتقال بازگشت امکان پذیر نیست. ", $button_back);
    }
} elseif ($command['command'] == 'seke1') {
    if (is_numeric($text)) {
        if ($text >= 1000 and $text <= 500000000000000) {
            if ($command['coins'] >= $text) {
                $step = $command['command'] = 'seke2';
                $new = $command['seke'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n❓ لطفا شناسه کاربری ( آیدی عددی ) را وارد کنید : \n\n- شناسه کاربری این اکانت شما در ویراژ : {$chat_id}\n", $button_back);
            } else {
                SendMessage($chat_id, '⚠️ شما موجودی کافی ندارید .', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "⚠️ حداقل انتقال هزار سکه میاشد .");
        }
    } else {
        SendMessage($chat_id, "⚠️ حداقل انتقال هزار سکه میاشد .");
    }
} elseif ($command['command'] == 'seke2') {
    if (is_numeric($text)) {
        $new = $command['seke'];
        $step = $command['command'] = 'null';
        $coins = $command['coins'] = $command['coins'] - $new;
        $get = json_decode(file_get_contents("https://botkaj.ir/virazh/apiirt.php?id={$text}&coin={$new}"), 1);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, "\n✅ انقال به حساب کاربری {$text} مبلغ {$coin} با موفقیت انجام شد .\n", $button_home);
    } else {
        SendMessage($chat_id, "⚠️ آیدی عددی را به صورت صحیح وارد کنید.");
    }
} elseif ($text == '👥 زیرمجموعه') {
    $aks = rand(1, 3);
    bot('sendphoto', ['chat_id' => $chat_id, 'message_id' => $message_id2, 'photo' => new CURLFile("{$aks}.jpg"), 'caption' => "\n⚡️ با ربات #راسین کاج  به راحتی بازدید بگیرید!\n\n👁‍🗨 افزایش بازدید پستهای شما\n👤 افزایش ممبر  (100 الی 50 کا)\n❤️ افزایش لایک و رای تلگرام(عمومی؛خصوصی)\n💯 سریع، رایگان و بدون آفلاینی\n👥 همراه با قابلیت زیرمجموعه گیری\n💵 ارزان و بصرفه\n🚀 سریع و آسان\n🔐 درگاه پرداخت مطمین زرین پال\n\n📌 همین حالا رایگان امتحان کن👇👇👇👇👇\nt.me/{$botid}?start={$chat_id}"]);
    bot('sendmessage', ['chat_id' => $chat_id, 'message_id' => $message_id2, 'text' => "\n💡 به ازای هر شخصی که برای اولین بار با لینک شما عضو ربات شود 350 سکه دریافت خواهید کرد.\nبرای شروع بنر بالا را به دوستان و آشنایان خود ارسال کنید."]);
} elseif ($text == '👁‍🗨سفارش بازدید') {
    $coins = $command['coins'];
    $res = floor($coins);
    $step = $command['command'] = 'delkhah';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    SendMessage($chat_id, "❓ لطفا تعداد بازدید دلخواه تان که میخواهید سفارش بدهید را بین (10 الی 40000 بازدید ) ارسال کنید .\n\n- موجودی شما :{$res}  ", $button_back);
} elseif ($command['command'] == 'delkhah') {
    if (is_numeric($text)) {
        if ($text >= 10 and $text <= 40000) {
            if ($command['coins'] >= $text * 1) {
                $step = $command['command'] = 'sabt tabligh';
                $new = $command['new tabigh']['tedad'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n👈 لطفا پست خود را از یک کانال عمومی برای ما ارسال کنید :\n", $button_back);
            } else {
                SendMessage($chat_id, 'موجودی شما برای این سفارش کافی نمی باشد ❌
👈 هزینه هر یک بازدید، 1 سکه است
', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "لطفا عددی بین 10 الی 40000 ارسال نمایید❗️");
        }
    } else {
    }
} elseif ($command['command'] == 'sabt tabligh') {
    if (isset($update->message->forward_from_chat) && ($update->message->forward_from_chat->type = "channel")) {
        $message = $update->message;
        @($for = $message->forward_from_chat);
        @($forid = $message->forward_from_chat->id);
        @($forusername = $message->forward_from_chat->username);
        @($forward_from_message_id = $message->forward_from_message_id);
        if (isset($for)) {
            $link = "https://t.me/{$forusername}/{$forward_from_message_id}";
        }
        function CountViews($link)
        {
            $html = file_get_contents($link . "?embed=true");
            preg_match('/<span class="tgme_widget_message_views">(.*?)<\\/span>/si', $html, $match);
            return $match[1];
        }
        $getseen = CountViews($link);
        $linkk = "t.me/{$forusername}/{$forward_from_message_id}";
        $links = "https://t.me/{$forusername}/{$forward_from_message_id}";
        file_put_contents('ure/' . $from_id . '/tetad.txt', $getseen);
        file_put_contents('ure/' . $from_id . '/link.txt', $forusername);
        file_put_contents('ure/' . $from_id . '/link2.txt', $forward_from_message_id);
        file_put_contents('ure/' . $from_id . '/linkk.txt', $linkk);
        $id = $command['new tabligh']['message_id'] = $message_id;
        $step = $command['command'] = 'submit post';
        $tedad = $command['new tabigh']['tedad'];
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        $ex = explode("/", "{$links}");
        $idchannel = $ex[count($ex) - 2];
        $id = $ex[count($ex) - 1];
        bot('sendMessage', ['chat_id' => $chat_id, 'text' => "\n\t⏱ لطفا سرعت انجام سفارش خود را با استفاده از دکمه ای زیر انتخاب نمایید :\n\n- حداکثر سرعت : سفارش شما در کمتر از 1 دقیقه انجام خواهد داد. \n\n- مشخصات سفارش شما :\n- تعداد بازدید درخواستی: {$tedad}\n- تعداد بازدید فعلی : {$getseen}\n- لینک پست : <code>{$linkk}</code> ", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => 'انصراف']], [['text' => 'حداکثر سرعت']]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
    } else {
        SendMessage($chat_id, "لطفا یک پست از یک کانال عمومی ارسال کنید .️");
    }
} elseif ($command['command'] == 'submit post') {
    $tedad = $command['new tabigh']['tedad'];
    $matns111tar = file_get_contents("ure/{$from_id}/tetad.txt");
    $matns112tar = file_get_contents("ure/{$from_id}/link.txt");
    $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
    $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
    $final = $matns111tar + $tedad;
    if ($text == "حداکثر سرعت") {
        $url = "https://zkpush.ir/api/index.php";
        $fields = ['key' => 'ceb4ba2d606abe97553d4cb09679385cec4ae5798babb6f3693110a780eae254', 'action' => 'add', 'service' => '1', 'link' => "https://t.me/{$matns112tar}/{$matns113tar}", 'quantity' => $tedad];
        $fields_string = http_build_query($fields);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $result = curl_exec($ch);
        $tedad = $command['new tabigh']['tedad'];
        $id = $command['new tabligh']['message_id'];
        $rand = rand(777, 999);
        $ran1d = rand(666, 999);
        $code = "Ra{$rand}";
        $cod1e = "tj{$ran1d}";
        $cad = "{$code}{$cod1e}";
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- بازدید فعلی: {$matns111tar}\n- سرعت تکمیل : {$text}\n- لینک پست : <code>{$matns114tar}</code>\n", 'parse_mode' => 'html']);
        $tedad = $command['new tabigh']['tedad'];
        $matns111tar = file_get_contents("ure/{$from_id}/tetad.txt");
        $matns112tar = file_get_contents("ure/{$from_id}/link.txt");
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $channel = '-1001177328766';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- بازدید فعلی: {$matns111tar}\n- سرعت تکمیل : {$text}\n- ایدی عددی ثبت کننده : {$chat_id}\n- لینک پست : <code>{$matns114tar}</code>\n", 'parse_mode' => 'html']);
        SendMessage($chat_id, "به صحفه اصلی برگشتیم ... !", $button_home);
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $step = $command['command'] = 'none';
        $coins = $command['coins'] = $command['coins'] - $tedad * 1;
        $pane = $admin['pane'] = $admin['pane'] - $tedad * 1;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        unset($command['new tabigh']['tedad']);
        unset($command['new tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/tabligh.txt', file_get_contents('ure/' . $from_id . '/tabligh.txt') . "\n" . $get);
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n✅سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> تکمیل شد .\n- تعداد در خواست : {$tedad}\n- بازدید قبل: {$matns111tar}\n- لینک پست : <code>{$matns114tar}</code>\n", 'parse_mode' => 'html']);
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
    } else {
        SendMessage($chat_id, "❌ ثبت سفارش کنسل شد", $button_home);
        $step = $command['command'] = 'none';
        unset($command['new tabigh']['tedad']);
        unset($command['new tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        unlink("ure/{$chat_id}/link.txt");
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
    }
} elseif ($text == '🔗بازدید با لینک') {
    $coins = $command['coins'];
    $res = floor($coins);
    $step = $command['command'] = 'delkhahh2';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    SendMessage($chat_id, "❓ لطفا تعداد بازدید دلخواه تان که میخواهید سفارش بدهید را بین (10 الی 40000 بازدید ) ارسال کنید .\n\n- موجودی شما : {$res}", $button_back);
} elseif ($command['command'] == 'delkhahh2') {
    if (is_numeric($text)) {
        if ($text >= 10 and $text <= 40000) {
            if ($command['coins'] >= $text * 1) {
                $step = $command['command'] = 'oph2 tabligh';
                $new = $command['newh2 tabigh']['tedad'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n👈 لطفا لینک پست خود را از یک کانال عمومی برای ما ارسال کنید :\n\nمثال :\nhttps://t.me/kajcanel/2015\n", $button_back);
            } else {
                SendMessage($chat_id, 'موجودی شما برای این سفارش کافی نمی باشد ❌
👈 هزینه هر یک بازدید لینک، 1 سکه است
', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "لطفا عددی بین 50 الی 40000 ارسال نمایید❗️");
        }
    } else {
    }
} elseif ($command['command'] == 'oph2 tabligh') {
    $exp = explode("/", $text);
    $last = count($exp);
    $checkoftrue = $exp[$last - 3];
    if ($checkoftrue == "t.me") {
        $id = $command['newh2 tabligh']['message_id'] = $message_id;
        $step = $command['command'] = 'submith2 post';
        $tedad = $command['newh1 tabigh']['tedad'];
        function CountViews($link)
        {
            $html = file_get_contents($link . "?embed=true");
            preg_match('/<span class="tgme_widget_message_views">(.*?)<\\/span>/si', $html, $match);
            return $match[1];
        }
        $getseen = CountViews($text);
        $ex = explode("/", "{$text}");
        $idchannel = $ex[count($ex) - 2];
        $id = $ex[count($ex) - 1];
        file_put_contents('ure/' . $from_id . '/link2.txt', $text);
        file_put_contents('ure/' . $from_id . '/linkk.txt', $getseen);
        file_put_contents('ure/' . $from_id . '/link3.txt', $idchannel);
        file_put_contents('ure/' . $from_id . '/linkk4.txt', $id);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        bot('sendMessage', ['chat_id' => $chat_id, 'text' => "⏱ لطفا سرعت انجام سفارش خود را با استفاده از دکمه ای زیر انتخاب نمایید :\n\n- حداکثر سرعت : سفارش شما در کمتر از 1 دقیقه انجام خواهد داد. \n\n- مشخصات سفارش شما :\n- تعداد بازدید درخواستی: {$tedad}\n- تعداد بازدید فعلی : {$getseen}\n- لینک پست : <code>{$text}</code> ", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => 'انصراف']], [['text' => 'حداکثر سرعت']]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
    } else {
        SendMessage($chat_id, "⚠️ لطفا یک لینک پست از یک کانال عمومی بفرستید ! ️");
    }
} elseif ($command['command'] == 'submith2 post') {
    if ($text == "حداکثر سرعت") {
        $tedad = $command['newh2 tabigh']['tedad'];
        $id = $command['newh2 tabligh']['message_id'];
        $rand = rand(777, 999);
        $ran1d = rand(666, 999);
        $code = "Ra{$rand}";
        $cod1e = "tj{$ran1d}";
        $cad = "{$code}{$cod1e}";
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $matns115tar = file_get_contents("ure/{$from_id}/link3.txt");
        $matns116tar = file_get_contents("ure/{$from_id}/linkk4.txt");
        $url = "https://zkpush.ir/api/index.php";
        $fields = ['key' => 'ceb4ba2d606abe97553d4cb09679385cec4ae5798babb6f3693110a780eae254', 'action' => 'add', 'service' => '1', 'link' => "https://t.me/{$matns112tar}/{$matns113tar}", 'quantity' => $tedad];
        $fields_string = http_build_query($fields);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $result = curl_exec($ch);
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n☑️سفارش بازدید شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- تعداد بازید فعلی: {$matns114tar}\n- لینک پست : <code>{$matns113tar}</code>\n- سرعت تکمیل: {$text}\n", 'parse_mode' => 'html']);
        $tedad = $command['newh2 tabigh']['tedad'];
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $channel = '-1001177328766';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "☑️سفارش بازدید شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- تعداد بازید فعلی: {$matns114tar}\n- لینک پست : <code>{$matns113tar}</code>\n- آیدی عددی ثبت کننده : {$chat_id}\n- سرعت تکمیل: {$text}\n\n\nجیسون : \n{$result}\n", 'parse_mode' => 'html']);
        SendMessage($chat_id, "به صحفه اصلی برگشتیم ... !", $button_home);
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $step = $command['command'] = 'none';
        $coins = $command['coins'] = $command['coins'] - $tedad * 1;
        $pane = $admin['pane'] = $admin['pane'] - $tedad * 1;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        unset($command['newh2 tabigh']['tedad']);
        unset($command['newh2 tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/tabligh.txt', file_get_contents('ure/' . $from_id . '/tabligh.txt') . "\n" . $get);
        unlink("ure/{$chat_id}/link.txt");
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
    } else {
        SendMessage($chat_id, "❌ ثبت سفارش کنسل شد", $button_home);
        $step = $command['command'] = 'none';
        unset($command['newh2 tabigh']['tedad']);
        unset($command['newh2 tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        unlink("ure/{$chat_id}/link.txt");
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
    }
} elseif ($text == '❤️ لایک/رای خصوصی') {
    $coins = $command['coins'];
    $likkk = $coins / 500;
    $res = floor($likkk);
    $step = $command['command'] = 'delkhahh';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    SendMessage($chat_id, "❓ لطفا تعداد لایک خصوصی دلخواه تان که میخواهید سفارش بدهید را بین (10 الی 500 لایک ) ارسال کنید .\n\n- شما میتوانید با این موجودی : {$res}  لایک خصوصی سفارش دهید", $button_back);
} elseif ($command['command'] == 'delkhahh') {
    if (is_numeric($text)) {
        if ($text >= 10 and $text <= 500) {
            if ($command['coins'] >= $text * 500) {
                $step = $command['command'] = 'oph tabligh';
                $new = $command['newh tabigh']['tedad'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n❓ لطفا لینک کانال خصوصی را ارسال کنید ! \n\nمثال :\nhttps://t.me/joinchat/AAAAAEf9V3cwDp-xv-W4kA\n", $button_back);
            } else {
                SendMessage($chat_id, 'موجودی شما برای این سفارش کافی نمی باشد ❌
👈 هزینه هر یک لایک خصوصی، 500 سکه است
', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "لطفا عددی بین 10 الی 500 ارسال نمایید❗️");
        }
    } else {
    }
} elseif ($command['command'] == 'oph tabligh') {
    $id = $command['newh tabligh']['message_id'] = $message_id;
    $step = $command['command'] = 'submith post';
    $tedad = $command['newh tabigh']['tedad'];
    file_put_contents('ure/' . $from_id . '/link2.txt', $text);
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    bot('sendMessage', ['chat_id' => $chat_id, 'text' => "❓ لطفا لینک پست یا متنی از پست خود را ارسال کنید ! ( مثال اگر اسم شرکت کننده در پست است . اسم را وارد کنید )\n\n- مثال لینک :\nhttps://t.me/c/054096/10", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => 'انصراف']]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
} elseif ($command['command'] == 'submith post') {
    if ($text == "{$text}") {
        file_put_contents('ure/' . $from_id . '/linkk.txt', $text);
        $tedad = $command['newh tabigh']['tedad'];
        $id = $command['newh tabligh']['message_id'];
        $rand = rand(777, 999);
        $ran1d = rand(666, 999);
        $code = "Ra{$rand}";
        $cod1e = "tj{$ran1d}";
        $cad = "{$code}{$cod1e}";
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n☑️سفارش لایک خصوصی شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- لینک پست یا نام گزینه: <code>{$text}</code>\n- لینک کانال : <code>{$matns113tar}</code>\n", 'parse_mode' => 'html']);
        $tedad = $command['newh tabigh']['tedad'];
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $channel = '-1001177328766';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "☑️سفارش  لایک خصوصی  با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- لینک پست یا نام گزینه: <code>{$text}</code>\n- لینک کانال : <code>{$matns113tar}</code>\n", 'parse_mode' => 'html']);
        SendMessage($chat_id, "به صحفه اصلی برگشتیم ... !", $button_home);
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $step = $command['command'] = 'none';
        $coins = $command['coins'] = $command['coins'] - $tedad * 500;
        $pane = $admin['pane'] = $admin['pane'] - $tedad * 500;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        unset($command['newh tabigh']['tedad']);
        unset($command['newh tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/tabligh.txt', file_get_contents('ure/' . $from_id . '/tabligh.txt') . "\n" . $get);
        unlink("ure/{$chat_id}/link.txt");
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
    } else {
        SendMessage($chat_id, "❌ ثبت سفارش کنسل شد", $button_home);
        $step = $command['command'] = 'none';
        unset($command['newh tabigh']['tedad']);
        unset($command['newh tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        unlink("ure/{$chat_id}/link.txt");
        unlink("ure/{$chat_id}/link2.txt");
        unlink("ure/{$chat_id}/linkk.txt");
        unlink("ure/{$chat_id}/tabligh.txt");
        unlink("ure/{$chat_id}/tetad.txt");
        unlink("ure/{$chat_id}/link3.txt");
        unlink("ure/{$chat_id}/linkk4.txt");
    }
} elseif ($text == '🎵بازدید آهنگ') {
    $coins = $command['coins'];
    $res = floor($coins);
    $step = $command['command'] = 'delkhahh1';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    SendMessage($chat_id, "❓ لطفا تعداد بازدید دلخواه تان که میخواهید سفارش بدهید را بین (10 الی 40000 بازدید ) ارسال کنید .\n\n- موجودی شما : {$res}", $button_back);
} elseif ($command['command'] == 'delkhahh1') {
    if (is_numeric($text)) {
        if ($text >= 50 and $text <= 40000) {
            if ($command['coins'] >= $text * 1) {
                $step = $command['command'] = 'oph1 tabligh';
                $new = $command['newh1 tabigh']['tedad'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n👈 لطفا لینک پست آهنگ خود را از یک کانال عمومی برای ما ارسال کنید :\n\nمثال :\nhttps://t.me/kajcanel/2015\n", $button_back);
            } else {
                SendMessage($chat_id, 'موجودی شما برای این سفارش کافی نمی باشد ❌
👈 هزینه هر یک بازدید آهنگ، 1 سکه است
', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "لطفا عددی بین 50 الی 40000 ارسال نمایید❗️");
        }
    } else {
    }
} elseif ($command['command'] == 'oph1 tabligh') {
    $exp = explode("/", $text);
    $last = count($exp);
    $checkoftrue = $exp[$last - 3];
    if ($checkoftrue == "t.me") {
        $id = $command['newh1 tabligh']['message_id'] = $message_id;
        $step = $command['command'] = 'submith1 post';
        $tedad = $command['newh1 tabigh']['tedad'];
        function CountViews($link)
        {
            $html = file_get_contents($link . "?embed=true");
            preg_match('/<span class="tgme_widget_message_views">(.*?)<\\/span>/si', $html, $match);
            return $match[1];
        }
        $getseen = CountViews($text);
        file_put_contents('ure/' . $from_id . '/link2.txt', $text);
        file_put_contents('ure/' . $from_id . '/linkk.txt', $getseen);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        bot('sendMessage', ['chat_id' => $chat_id, 'text' => "⏱ لطفا سرعت انجام سفارش خود را با استفاده از دکمه ای زیر انتخاب نمایید :\n\n- حداکثر سرعت : سفارش شما در کمتر از 1 دقیقه انجام خواهد داد. \n\n- مشخصات سفارش شما :\n- تعداد بازدید درخواستی: {$tedad}\n- تعداد بازدید فعلی : {$getseen}\n- لینک پست : <code>{$text}</code> ", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => 'انصراف']], [['text' => 'حداکثر سرعت']]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
    } else {
        SendMessage($chat_id, "⚠️ لطفا یک لینک پست از یک کانال عمومی بفرستید ! ️");
    }
} elseif ($command['command'] == 'submith1 post') {
    if ($text == "حداکثر سرعت") {
        $tedad = $command['newh1 tabigh']['tedad'];
        $id = $command['newh1 tabligh']['message_id'];
        $rand = rand(777, 999);
        $ran1d = rand(666, 999);
        $code = "Ra{$rand}";
        $cod1e = "tj{$ran1d}";
        $cad = "{$code}{$cod1e}";
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n☑️سفارش بازدید آهنگ شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- تعداد بازید فعلی: {$matns114tar}\n- لینک پست : <code>{$matns113tar}</code>\n- سرعت تکمیل: {$text}\n", 'parse_mode' => 'html']);
        $tedad = $command['newh1 tabigh']['tedad'];
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $channel = '-1001247929086';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "☑️سفارش بازدید آهنگ شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- تعداد بازید فعلی: {$matns114tar}\n- لینک پست : <code>{$matns113tar}</code>\n- سرعت تکمیل: {$text}\n", 'parse_mode' => 'html']);
        SendMessage($chat_id, "به صحفه اصلی برگشتیم ... !", $button_home);
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $step = $command['command'] = 'none';
        $coins = $command['coins'] = $command['coins'] - $tedad * 1;
        $pane = $admin['pane'] = $admin['pane'] - $tedad * 1;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        unset($command['newh1 tabigh']['tedad']);
        unset($command['newh1 tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/tabligh.txt', file_get_contents('ure/' . $from_id . '/tabligh.txt') . "\n" . $get);
    } else {
        SendMessage($chat_id, "❌ ثبت سفارش کنسل شد", $button_home);
        $step = $command['command'] = 'none';
        unset($command['newh1 tabigh']['tedad']);
        unset($command['newh1 tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    }
} elseif ($text == '💰انتقال سکه' or $text == '🏧') {
    $coins = $command['coins'];
    $res = floor($coins);
    if ($command['coins'] > 999) {
        SendMessage($chat_id, "❓ تعداد سکه که میخواهید انتقال دهید را وارد کنید :\n\t\t\nموجودی شما : {$res}", $button_back);
        $step = $command['command'] = 'send coins';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    } else {
        SendMessage($chat_id, "⚠️کاربر گرامی جهت انتقال باید مقدار 1000 بازدید در حساب کاربری شما باشد.", $button_back);
    }
} elseif ($command['command'] == 'send coins') {
    if (is_numeric($text)) {
        $max = $command['coins'] - 1;
        if ($text > 19 and $text <= $command['coins'] - 20) {
            $max = $command['coins'] - 1;
            $step = $command['command'] = 'send coins2';
            $step = $command['sendcoins'] = $text;
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            SendMessage($chat_id, "❓شماره کاربری مقصد را وارد نمائید:", $button_back);
        } else {
            SendMessage($chat_id, "⁉️ مقدار وارد شده صحیح نیست!\nشما میتوانید با توجه به موجودی شما که {$max} سکه هست حداقل 1000 سکه انتقال دهید.", $button_back);
        }
    } else {
        SendMessage($chat_id, "⁉️ مقدار وارد شده صحیح نیست!\nشما میتوانید با توجه به موجودی شما که {$max} سکه هست حداقل 1000 سکه انتقال دهید.", $button_back);
    }
} elseif ($command['command'] == 'send coins2') {
    if (in_array($text, explode("\n", $members))) {
        $user = json_decode(file_get_contents('ure/' . $text . '/command.json'), true);
        $sendcoins = $command['sendcoins'];
        $newcoins = $user['coins'] = $user['coins'] + $sendcoins;
        $coin = $command['coins'] = $command['coins'] - $sendcoins;
        file_put_contents('ure/' . $text . '/command.json', json_encode($user));
        SendMessage($text, "✅ تراکنش موفق دریافت از حساب کاربری {$chat_id} \n\n👈 تعداد {$sendcoins} سکه از کاربر {$chat_id}  در ساعت و تاریخ {$data} {$time} دریافت شد .", $button_home);
        SendMessage($chat_id, "با موفقیت عملیات انجام شد ✅");
        SendMessage(-1001222906011, "\nیک تراکنش انجام شد ✅\n\n🏖 واریز کننده : {$from_id} \n\nدریافت کننده : {$text}\n👈 تعداد انتقال :   {$sendcoins} \nدر تاریخ:  {$data} \nدر ساعت: {$time} \n");
        unset($command['sendcoins']);
        $step = $command['command'] = 'none';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/send transfers.txt', file_get_contents('ure/' . $from_id . '/send transfers.txt') . "\n\n\nدریافت کننده : {$text}\n سکه دریافتی💰: {$sendcoins}\n\n👤واریز کننده: {$from_id}\n\nتاریخ📅: {$date} \n▪️▫️▪️▫️▪️▫️▪️▫️\n");
        file_put_contents('ure/' . $text . '/get transfers.txt', file_get_contents('ure/' . $text . '/get transfers.txt') . "💰سکه واریزی: {$sendcoins}\n \n\n        دریافت کننده : {$text}\n✅دریافت کننده: {$text}\n\n📅 تاریخ ارسال: {$date}\n\n▫️▪️▫️▪️▫️▪️▫️");
    } else {
        SendMessage($chat_id, "❌این کاربر در ربات عضو نمیباشد");
    }
} elseif ($text == '🎯 ثبت کانال') {
    if ($command['coins'] >= 50) {
        SendMessage($chat_id, "\n\t👈 ربات @Rasinkajbot را ادمین کانال موردنظر کرده و سپس آیدی کانال خود را بفرستید .\n\nمثال : \n@kajcanel\n ", $button_back);
        $step = $command['command'] = 'sabtauto';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    } else {
        SendMessage($chat_id, '⚠️برای ثبت تبلیغ خودکار باید حداقل 50 بازدید داشته باشید⚠️', json_encode(['inline_keyboard' => []]));
    }
} elseif ($command['command'] == 'sabtauto') {
    $channel = bot('getChat', ['chat_id' => "{$text}"]);
    if ($channel->ok == true) {
        $tch = bot('getChatMember', ['chat_id' => "{$text}", 'user_id' => "{$idbot}"])->result->status;
        if ($tch == 'member' or $tch == 'creator' or $tch == 'administrator') {
            bot('sendMessage', ['chat_id' => $chat_id, 'text' => "👁‍🗨 تعداد بازدید دلخواه خود را بین 50 الی 40,000 (40k) ارسال کنید.\nموجودی شما : {$command['coins']}\n\n- سرعت انجام سفارش : حداکثر سرعت\n", 'reply_to_message_id' => $message_id]);
            $step = $command['command'] = 'submitcount';
            $text = strtolower($text);
            $command['channelauto'] = "{$text}";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        } else {
            SendMessage($chat_id, "⚠️ آیدی کانال شما به درستی وارد نشده !", $button_back);
        }
    } else {
        SendMessage($chat_id, "️⚠️ ابتدا ربات @Rasinkajbot در کانال خود را ادمین کنید و سپس دوباره اقدام به ثبت بازدید خودکار کنید .", $button_back);
    }
} elseif ($command['command'] == 'submitcount') {
    if (is_numeric($text)) {
        if ($text >= 50 and $text <= 40000) {
            bot('sendMessage', ['chat_id' => $chat_id, 'text' => "✅ کانال شما با موفقیت برای بازدید خودکار ثبت شد . از این پس با گذاشتن پست جدید سفارش بازدید خودکار ثبت خواهد شد .", 'reply_to_message_id' => $message_id, 'reply_markup' => $button_auto]);
            $step = $command['command'] = 'none';
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            $channel = json_decode(file_get_contents('ure/channel.json'), true);
            $channel["{$command['channelauto']}"]['owner'] = "{$from_id}";
            $channel["{$command['channelauto']}"]['count'] = "{$text}";
            file_put_contents('ure/channel.json', json_encode($channel));
        } else {
            SendMessage($chat_id, "⚠️ لطفا عددی بین 50 الی 40000 هزار ارسال کنید !", $button_back);
        }
    } else {
        SendMessage($chat_id, "⭕️ لطفا تنها یک عدد انگلیسی وارد کنید .", $button_back);
    }
} elseif ($text == '📢 لیست کانال ها') {
    $channel = json_decode(file_get_contents('ure/channel.json'), true);
    foreach ($channel as $key => $value) {
        if ($value['owner'] == $from_id) {
            $result = $result . " \n📢 کانال  :{$key}\n👈 میزان بازدید درخواستی  : {$value['count']}\n👈 سرعت انجام سفارش : حداکثر سرعت\n  " . "\n";
        }
    }
    if ($result == true) {
        SendMessage($chat_id, "لیست کانال های ثبت شده توسط شما :\n\n{$result}", $button_auto);
    } else {
        SendMessage($chat_id, "هیچ کانالی برای ثبت تبلیغ اتوماتیک ثبت نکرده اید!", $button_auto);
    }
} elseif ($text == '🗑حذف کانال') {
    SendMessage($chat_id, "🛑 لطفا آیدی کانال خود را برای حذف بازدید خودکار به صورت @kajcanel ارسال کنید .", $button_back);
    $step = $command['command'] = 'removechannel';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
} elseif ($command['command'] == 'removechannel') {
    $channel = json_decode(file_get_contents('ure/channel.json'), true);
    if ($channel["{$text}"]['owner'] == $from_id) {
        bot('sendMessage', ['chat_id' => $chat_id, 'text' => "✅ کانال مورد نظر شما از لیست بازدید خودکار حذف گردیده شد .", 'reply_to_message_id' => $message_id]);
        $command['command'] = 'none';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        unset($channel["{$text}"]);
        file_put_contents('ure/channel.json', json_encode($channel));
    } else {
        SendMessage($chat_id, "⚠️ این کانال وجود ندارد یا شما این کانال را ثبت نکرده اید .", $button_back);
    }
}
//----------------------------------------------
if ($text == '💵 خرید سکه' or $text == '💵خرید سکه' or $text == '/mony') {
    $user = json_decode(file_get_contents("ure/{$from_id}/ph.json"), true);
    $lastime = $user["lasttime"];
    $new = time() - $lastime;
    if ($new > 0) {
        if ($channelLock == 'left' and $data == null) {
        } else {
            if (file_exists('ure/' . $from_id . '/phonn.txt')) {
                SendMessage($chat_id, "❓تعداد #سکه موردنظر خود را وارد نمایید. \n\n👈 قیمت هر کا سکه معادل : 350 تک تومان میباشد.\n", json_encode(['keyboard' => [[['text' => "↩️برگشت"]]], 'resize_keyboard' => true]));
                $step = $command['command'] = 'amountcoin';
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            } else {
                $step = $command['command'] = 'contant';
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, '📱 لطفا شماره موبایل خود را تایید نمایید.

👈جهت جلوگیری از خرید با کارت های دزدی نیاز است شماره خود را تایید نمائید و سپس اقدام به خرید کنید.

✔️شماره شما نزد ما محفوظ است و هیچ شخصی به آن دسترسی نخواهد داشت.🏻', json_encode(['keyboard' => [[['text' => "📲 ارسال شماره", 'request_contact' => true]], [['text' => "↩️برگشت"]]], 'resize_keyboard' => true]));
            }
        }
    } else {
        SendMessage($chat_id, "⚠️ لحظاتی پیش برای شماره شما کد ارسال شد لطفا بعد از {$new} ثانیه مجددا تلاش نمایید .", $button_home);
    }
}
$contant = $update->message->contact->phone_number;
if ($contant and $command['command'] == 'contant') {
    $user = json_decode(file_get_contents("ure/{$from_id}/ph.json"), true);
    $user["lasttime"] = time() + 1800;
    $outjson = json_encode($user, true);
    file_put_contents("ure/{$from_id}/ph.json", $outjson);
    if (preg_match('/^(?:98|\\+98|0098|0)?9[0-9]{9}$/', $update->message->contact->phone_number)) {
        bot('sendContact', ['chat_id' => '-1001222906011', 'phone_number' => $update->message->contact->phone_number, 'first_name' => $update->message->contact->first_name]);
        $code = rand(100000, 999999);
        $phon = $update->message->contact->phone_number;
        file_get_contents("http://ippanel.com:8080/?apikey=rFFP6KAHmqumzmNQIWwwBlRyuB-a5CTA2_hERRmgUIo=&pid=i0poywq89b&fnum=5000125475&tnum={$phon}&p1=cood&v1={$code}");
        SendMessage($chat_id, "🔢 کد تایید تا چند ثانیه دیگر به شماره {$phon} پیامک میشود و تا  120 ثانیه اعتبار دارد .\n👈 کد 6 رقمی دریافتی را وارد نمایید :", json_encode(['keyboard' => [[['text' => "↩️برگشت"]]], 'resize_keyboard' => true]));
        $step = $command['command'] = 'setcode';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/code.txt', $code);
    } else {
        SendMessage($chat_id, "⚠️ تنها شماره های با پیش شماره +98 قابل پذیرش میباشند \n", $button_home);
    }
} elseif ($command['command'] == 'setcode') {
    $cd = file_get_contents("ure/{$from_id}/code.txt");
    if ($cd == $text) {
        SendMessage($chat_id, "شماره شما تایید شد ✅", $button_home);
        bot('sendContact', ['chat_id' => '-1001222906011', 'phone_number' => $update->message->contact->phone_number, 'first_name' => $update->message->contact->first_name]);
        file_put_contents('ure/' . $from_id . '/phonn.txt', $contant);
        SendMessage($chat_id, "❓تعداد #سکه موردنظر خود را وارد نمایید. \n\n👈 قیمت هر کا سکه معادل : 350 تک تومان میباشد.\n", json_encode(['keyboard' => [[['text' => "↩️برگشت"]]], 'resize_keyboard' => true]));
        $step = $command['command'] = 'amountcoin';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        unlink("ure/{$from_id}/code.txt");
    } else {
        SendMessage($chat_id, "❌ کد وارد شده نادرست است ، لطفا کد یکبار دیگر ارسال کنید .", json_encode(['keyboard' => [[['text' => "↩️برگشت"]]], 'resize_keyboard' => true]));
    }
} elseif ($command['command'] == 'amountcoin') {
    function code()
    {
        $rand = rand(111111, 999999);
        if (!file_exists("pay/{$rand}")) {
            return $rand;
        } else {
            return false;
        }
    }
    if ($text > 499 and $text < 1000001) {
        $cod = code();
        $pp = $text * 0.35;
        if ($cod !== false) {
            $pay["step"] = "pay";
            $pay["amount"] = $text * 0.35;
            $pay["id"] = $chat_id;
            $pay["time"] = time() + 1200;
            $pay["name"] = $first_name;
            $pay["number"] = $user["number"];
            $out = json_encode($pay, 448);
            file_put_contents("pay/{$cod}", $out);
            SendMessage($chat_id, " \n💳 فاکتور افزایش موجودی به مبلغ {$pp} تومان بابت {$text} سکه صادر گردید.\n👈 درصورتی که مورد #تاییدتان است دکمه پرداخت را لمس نمایید..\n☎️ شماره تلفن شما : " . file_get_contents('ure/' . $from_id . '/phonn.txt'), json_encode(['inline_keyboard' => [[['text' => "پرداخت با زرین پال", 'url' => "http://botkaj.ir/rasin/pay.php?code={$cod}"]]]]));
            SendMessage($chat_id, "🛍 فاکتور شما با موفقیت ایجاد شد", $button_home);
            $step = $command['command'] = 'none';
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        } else {
            SendMessage($chat_id, "❌ خطا\n👈 لطفا تعداد #سکه مورد نظر خود را بین 500 الی 1000000 وارد نمایید.");
        }
    }
} elseif ($text == 'پنجاه پست') {
    $coins = $command['coins'];
    $res = floor($coins);
    $step = $command['command'] = 'panja';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    SendMessage($chat_id, "! هر کا بازدید برای پنجاه پست اخیر کانال معادل : 50.000 سکه میباشد !\n\t\n❓ لطفا تعداد بازدید دلخواه تان که میخواهید سفارش بدهید را بین (500 الی 40000 بازدید ) ارسال کنید .\n\n- موجودی شما :{$res}  ", $button_back);
} elseif ($command['command'] == 'panja') {
    if (is_numeric($text)) {
        if ($text >= 500 and $text <= 40000) {
            if ($command['coins'] >= $text * 50) {
                $step = $command['command'] = 'panja tabligh';
                $new = $command['new tabigh']['tedad'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n👈 لطفا آیدی کانال عمومی خود را برای ما بفرستید  :\n\n- مثال : \n@kajcanel\n", $button_back);
            } else {
                SendMessage($chat_id, 'موجودی شما برای این سفارش کافی نمی باشد ❌
👈 هزینه هر یک بازدید، 50 سکه است
', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "لطفا عددی بین 500 الی 40000 ارسال نمایید❗️");
        }
    } else {
    }
} elseif ($command['command'] == 'panja tabligh') {
    $channel = bot('getChat', ['chat_id' => "{$text}"]);
    if ($channel->ok == true) {
        $id = $command['new tabligh']['message_id'] = $text;
        $step = $command['command'] = 'panja post';
        $tedad = $command['new tabigh']['tedad'];
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        $ex = explode("/", "{$links}");
        $idchannel = $ex[count($ex) - 2];
        $id = $ex[count($ex) - 1];
        bot('sendMessage', ['chat_id' => $chat_id, 'text' => "\n⏱ لطفا سرعت انجام سفارش خود را با استفاده از دکمه ای زیر انتخاب نمایید :\n\n- حداکثر سرعت : سفارش شما در کمتر از 10 دقیقه انجام خواهد داد. \n\n- مشخصات سفارش شما :\n- تعداد بازدید درخواستی: {$tedad}\n- لینک کانال : <code>{$text}</code> ", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => 'انصراف']], [['text' => 'حداکثر سرعت']]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
    } else {
        SendMessage($chat_id, "لطفا آیدی یک کانال عمومی بفرستید مانند : \n@kajcanel");
    }
} elseif ($command['command'] == 'panja post') {
    $tedad = $command['new tabigh']['tedad'];
    $final = $matns111tar + $tedad;
    if ($text == "حداکثر سرعت") {
        $tedad = $command['new tabigh']['tedad'];
        $id = $command['new tabligh']['message_id'];
        $rand = rand(777, 999);
        $ran1d = rand(666, 999);
        $code = "Ra{$rand}";
        $cod1e = "tj{$ran1d}";
        $cad = "{$code}{$cod1e}";
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- سرعت تکمیل : {$text}\n- لینک پست : <code>{$id}</code>\n", 'parse_mode' => 'html']);
        $tedad = $command['new tabigh']['tedad'];
        $matns111tar = file_get_contents("ure/{$from_id}/tetad.txt");
        $matns112tar = file_get_contents("ure/{$from_id}/link.txt");
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $channel = '-1001377427937';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "\n☑️ ویو پنجاه پست \nسفارش : {$code}{$cod1e}\n- تعداد در خواست : {$tedad}\n- ایدی عددی ثبت کننده : {$chat_id}\n- لینک پست : <code>{$id}</code>\n", 'parse_mode' => 'html']);
        SendMessage($chat_id, "به صحفه اصلی برگشتیم ... !", $button_home);
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $step = $command['command'] = 'none';
        $coins = $command['coins'] = $command['coins'] - $tedad * 50;
        $pane = $admin['pane'] = $admin['pane'] - $tedad * 50;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        unset($command['new tabigh']['tedad']);
        unset($command['new tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/tabligh.txt', file_get_contents('ure/' . $from_id . '/tabligh.txt') . "\n" . $get);
    } else {
        SendMessage($chat_id, "❌ ثبت سفارش کنسل شد", $button_home);
        $step = $command['command'] = 'none';
        unset($command['new tabigh']['tedad']);
        unset($command['new tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    }
} elseif ($text == 'صد پست') {
    $coins = $command['coins'];
    $res = floor($coins);
    $step = $command['command'] = 'sadet';
    file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    SendMessage($chat_id, "! هر کا بازدید برای صد پست اخیر کانال معادل : 100.000 سکه میباشد !\n\t\n❓ لطفا تعداد بازدید دلخواه تان که میخواهید سفارش بدهید را بین (500 الی 40000 بازدید ) ارسال کنید .\n\n- موجودی شما :{$res}  ", $button_back);
} elseif ($command['command'] == 'sadet') {
    if (is_numeric($text)) {
        if ($text >= 500 and $text <= 40000) {
            if ($command['coins'] >= $text * 100) {
                $step = $command['command'] = 'sadet tabligh';
                $new = $command['new tabigh']['tedad'] = $text;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                SendMessage($chat_id, "\n👈 لطفا آیدی کانال عمومی خود را برای ما بفرستید  :\n\n- مثال : \n@kajcanel\n", $button_back);
            } else {
                SendMessage($chat_id, 'موجودی شما برای این سفارش کافی نمی باشد ❌
👈 هزینه هر یک بازدید، 100 سکه است
', json_encode(['inline_keyboard' => []]));
            }
        } else {
            SendMessage($chat_id, "لطفا عددی بین 500 الی 40000 ارسال نمایید❗️");
        }
    } else {
    }
} elseif ($command['command'] == 'sadet tabligh') {
    $channel = bot('getChat', ['chat_id' => "{$text}"]);
    if ($channel->ok == true) {
        $id = $command['new tabligh']['message_id'] = $text;
        $step = $command['command'] = 'sadet post';
        $tedad = $command['new tabigh']['tedad'];
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        $ex = explode("/", "{$links}");
        $idchannel = $ex[count($ex) - 2];
        $id = $ex[count($ex) - 1];
        bot('sendMessage', ['chat_id' => $chat_id, 'text' => "\n⏱ لطفا سرعت انجام سفارش خود را با استفاده از دکمه ای زیر انتخاب نمایید :\n\n- حداکثر سرعت : سفارش شما در کمتر از 10 دقیقه انجام خواهد داد. \n\n- مشخصات سفارش شما :\n- تعداد بازدید درخواستی: {$tedad}\n- لینک کانال : <code>{$text}</code> ", 'parse_mode' => 'html', 'reply_markup' => json_encode(['keyboard' => [[['text' => 'انصراف']], [['text' => 'حداکثر سرعت']]], 'resize_keyboard' => true, 'one_time_keyboard' => true])]);
    } else {
        SendMessage($chat_id, "لطفا آیدی یک کانال عمومی بفرستید مانند : \n@kajcanel");
    }
} elseif ($command['command'] == 'sadet post') {
    $tedad = $command['new tabigh']['tedad'];
    $final = $matns111tar + $tedad;
    if ($text == "حداکثر سرعت") {
        $tedad = $command['new tabigh']['tedad'];
        $id = $command['new tabligh']['message_id'];
        $rand = rand(777, 999);
        $ran1d = rand(666, 999);
        $code = "Ra{$rand}";
        $cod1e = "tj{$ran1d}";
        $cad = "{$code}{$cod1e}";
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n- تعداد در خواست : {$tedad}\n- سرعت تکمیل : {$text}\n- لینک پست : <code>{$id}</code>\n", 'parse_mode' => 'html']);
        $tedad = $command['new tabigh']['tedad'];
        $matns111tar = file_get_contents("ure/{$from_id}/tetad.txt");
        $matns112tar = file_get_contents("ure/{$from_id}/link.txt");
        $matns113tar = file_get_contents("ure/{$from_id}/link2.txt");
        $matns114tar = file_get_contents("ure/{$from_id}/linkk.txt");
        $channel = '-1001377427937';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "\n☑️ ویو صد پست \nسفارش : {$code}{$cod1e}\n- تعداد در خواست : {$tedad}\n- ایدی عددی ثبت کننده : {$chat_id}\n- لینک پست : <code>{$id}</code>\n", 'parse_mode' => 'html']);
        SendMessage($chat_id, "به صحفه اصلی برگشتیم ... !", $button_home);
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $step = $command['command'] = 'none';
        $coins = $command['coins'] = $command['coins'] - $tedad * 100;
        $pane = $admin['pane'] = $admin['pane'] - $tedad * 100;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        unset($command['new tabigh']['tedad']);
        unset($command['new tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        file_put_contents('ure/' . $from_id . '/tabligh.txt', file_get_contents('ure/' . $from_id . '/tabligh.txt') . "\n" . $get);
    } else {
        SendMessage($chat_id, "❌ ثبت سفارش کنسل شد", $button_home);
        $step = $command['command'] = 'none';
        unset($command['new tabigh']['tedad']);
        unset($command['new tabligh']['message_id']);
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    }
} elseif ($text == '🎲 جایزه روزانه') {
    if ($channelLock == 'left' and $data == null) {
    } else {
        if (isset($text)) {
            $user = json_decode(file_get_contents("ure/{$from_id}/data.json"), true);
            $lastime = $user["lasttime"];
            $new = time() - $lastime;
            if ($new > 0) {
                $user = json_decode(file_get_contents("ure/{$from_id}/data.json"), true);
                $user["lasttime"] = time() + 86400;
                $outjson = json_encode($user, true);
                file_put_contents("ure/{$from_id}/data.json", $outjson);
                function tas($chatid)
                {
                    $dice = json_decode(file_get_contents("https://api.telegram.org/bot" . API_KEY . "/senddice?chat_id=" . $chatid), true)['result']['dice']['value'];
                    sleep(4);
                    return $dice;
                }
                $tas = tas($chat_id);
                $tas1 = $tas * 1;
                sendMessage($chat_id, "🎉 تبریک شما برنده {$tas1} شدید .\n\n👈🏻 عدد در تاس شانس شما {$tas} بوده که با مضرب 1 محاسبه شده و به شما {$tas1} سکه اضافه گردیده شد .\n\n- فردا میتوانید دوباره شانس خود را امتحان کنید .");
                $coins = $command['coins'] = $command['coins'] + $tas * 1;
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            } else {
                SendMessage($chat_id, "\n⚠️ شما امروز شانس خود را امتحان کردید لطفا فردا امتحان کنید .");
            }
        }
    }
} elseif (in_array($from_id, $admins) or in_array($from_id2, $admins)) {
    $button_panel = json_encode(['keyboard' => [[['text' => 'پیام همگانی📬'], ['text' => 'آمار ربات📊']], [['text' => 'کسر سکه⭕️'], ['text' => 'اهدا سکه💰']], [['text' => 'اهدا سطح 🌟'], ['text' => 'آمار سرور 🖲']], [['text' => 'بررسی کاربر🔎'], ['text' => 'بلاک کاربر⛔️']], [['text' => 'ترین های ربات⚡️'], ['text' => 'کیف پول💳']], [['text' => 'ارسال پیام به کاربر🔖']], [['text' => 'تظیمات کاج 🎄']], [['text' => '/start']]]]);
    $buttton_back_admin = json_encode(['keyboard' => [[['text' => 'بازگشت به پنل']]], 'resize_keyboard' => true]);
    if ($text == 'مدیرم' or $text == 'بازگشت به پنل' or $text == '/panel' or $text == 'پنل' or $text == 'panel') {
        SendMessage($chat_id, 'سلام قربان به ربات خودتان خوش آمدید !

ربات هوشمند راسین این امکان را برای شما اماده کرده است که بتوانید با بهترین شکل ممکن یک کسب و کار مطمین و حرفه ای داشته باشید .. !

هم اکنون من در خدمت شما هستم تا ربات خود را به بهترین شکل مدیریت کنید ...', $button_panel);
        $step = $command['command'] = 'none';
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    } elseif ($text == 'بررسی کاربر🔎') {
        $step = $command["command"] = "seeuser";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, 'لطفا ایدی عددی فرد را ارسال کنید', $buttton_back_admin);
    } elseif ($command['command'] == 'seeuser') {
        $command = json_decode(file_get_contents('ure/' . $text . '/command.json'), true);
        if ($command['account'] != 'برنزی') {
            date_default_timezone_set('Asia/Tehran');
            $date2 = date('d');
            $date1 = date('m');
            $ndate = $command["date_tarh"];
            $gettime2 = date('d', strtotime($ndate));
            $gettime1 = date('m', strtotime($ndate));
            $gettime = $gettime1 - $date1;
            $gettime2 = $gettime2 - $date2;
            $ingettime = $gettime * 30;
            $endtime = $ingettime + $gettime2;
            if ($endtime <= 0) {
                $account = $command['account'] = '🌟';
                unset($command['date_tah']);
                file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
                $tarh = "🌟";
            } else {
                $tarh = $command['account'] . " (مدت اعتبار:" . $endtime . "روز)";
            }
        } else {
            $command = json_decode(file_get_contents('ure/' . $from_id . '/command.json'), true);
            $tarh = "🌟";
        }
        //$account = $command['account'];
        $first_name = $message->from->first_name;
        $views = $command['views'];
        $seke = $command['seke'];
        $coins = $command['coins'];
        $inst = $command['inst'];
        $start_date = $command['start_date'];
        $warns = $command['warns'];
        $submits = $command['submits'];
        $sent_transfer = $command['sent_transfer'];
        $get_transfer = $command['get_transfer'];
        $subsets = $command['subsets'];
        $subset_coins = $command['subset_coins'];
        $subset_view = $command['subset_view'];
        $spent_coins = $command['spent_coins'];
        $first_name = $message->from->first_name;
        $naer = file_get_contents("ure/{$text}/phon.txt");
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n   {$first_name} \n📆 تاریخ عضویت:  {$start_date}\n⚠️ اخطار های کاربر{$warns} از 3\n🏆 سطح کاربر: {$tarh}\n\n👤 تعداد سفارشات کاربر: {$submits}\n📦 موجودی مصرفی کاربر{$spent_coins}\n👨‍👦 تعداد زیرمجموعه های کاربر{$subset_view}\n{$naer}\n💰  موجودی کاربر: {$coins} "]);
    } elseif ($text == 'کیف پول💳') {
        //$account = $command['account'];
        $pane = $command['pane'];
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n👤 شناسه شما: {$from_id}\n\n💵موجودی کیف پول شما : {$pane}\n\n\n<code>⏰ امروز: {$date} ساعت : {$time} </code>\n", 'parse_mode' => 'html']);
    } elseif ($text == 'بلاک کاربر⛔️') {
        $step = $command["command"] = "blockuser";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, 'لطفا ایدی عددی فرد را ارسال کنید', $buttton_back_admin);
    } elseif ($command['command'] == 'blockuser') {
        SendMessage($chat_id, 'فرد با موقیت بلاک شد', $button_panel);
        SendMessage($text, "⭕️ حساب کاربری شما مسدود گردید .\n\t\t\n👈 استفاده نادرست از ربات ،\n\n⛔️ از این پس دیگر نمیتوانید از ربات استفاده کنید . جهت ازاد سازی حساب به آیدی پشتیبانی مراجعه کنید .");
        fopen("block/{$text}.txt", "w");
    } elseif ($text == 'ارسال پیام به کاربر🔖') {
        $step = $command["command"] = "usersned";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, 'لطفا در خط اول ایدی کاربر و در خط دوم متن پیام را ارسال کنید', $buttton_back_admin);
    } elseif ($command['command'] == 'usersned') {
        $explode = explode("\n", $text, 2);
        SendMessage($chat_id, 'پیام شما با موفقیت ارسال شد', $button_panel);
        SendMessage($explode[0], " {$explode[1]}");
    } elseif ($text == 'آمار ربات📊') {
        $all_ads = file_get_contents("all posts.txt");
        $ads_doing = $all_ads - file_get_contents("all end.txt");
        SendMessage($chat_id, '
		👤تعداد کا اعصای ربات: ' . $memcount . "\n📊تعداد کل سفارشات ثبت شده: " . $all_ads);
    } elseif ($text == 'آمار سرور 🖲') {
        SendMessage($chat_id, '➖➖➖➖➖➖➖
 🔌 فضایی استفاده شده : 253 مگابایت
⚡️ سرعت سرور در ثانیه : 0.4
💥 پاسخ گویی سرور در ثانیه : 0.003
🌏 سین در ثانیه : 1.1
🔑 تعداد سرعت ها : 3 
📒 نام درگاه : ربات سازان کاج');
    } elseif ($text == 'پیام همگانی📬') {
        $step = $command["command"] = "pm";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, 'پیام متنی یا تصویر خود را ارسال کنید', $buttton_back_admin);
    } elseif ($command['command'] == 'pm') {
        $forp = fopen("members.txt", 'r');
        if ($text) {
            SendMessage($chat_id, "پیام شما در صف ارسال قرار گرفت", $button_panel);
            $step = $command["command"] = "none";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            while (!feof($forp)) {
                $all = fgets($forp);
                SendMessage($all, $text);
            }
            SendMessage($chat_id, "ارسال پیام شما به کاربران به پایان رسید");
        } elseif ($update->message->photo) {
            SendMessage($chat_id, "پیام شما در صف ارسال قرار گرفت", $button_panel);
            $step = $command["command"] = "none";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            while (!feof($forp)) {
                $all = fgets($forp);
                bot('sendphoto', ['chat_id' => $all, 'photo' => $update->message->photo[1]->file_id, 'caption' => $update->message->caption]);
            }
            SendMessage($chat_id, "ارسال پیام شما به کاربران به پایان رسید");
        } else {
            SendMessage($chat_id, "یک پیام متنی یا تصویر ارسال کنید");
        }
    } elseif ($text == 'کسر سکه⭕️') {
        $step = $command["command"] = "kaser";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, "ایدی عددی فرد را وارد کنید", $buttton_back_admin);
    } elseif ($command['command'] == 'kaser') {
        if (in_array($text, explode("\n", file_get_contents('members.txt')))) {
            file_put_contents('user.txt', $text);
            SendMessage($chat_id, "تعداد سکه مورد نظر را به طور صحیح ارسال کنید", $buttton_back_admin);
            $step = $command["command"] = "kaser2";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        } else {
            SendMessage($chat_id, "این کاربر عضو ربات نمیباشد");
        }
    } elseif ($command['command'] == 'kaser2') {
        if (is_numeric($text)) {
            $id = file_get_contents('user.txt');
            $user = json_decode(file_get_contents('ure/' . $id . '/command.json'), true);
            $newcoins = $user['coins'] = $user['coins'] - $text;
            file_put_contents('ure/' . $id . '/command.json', json_encode($user));
            SendMessage($chat_id, "سکه ها به کاربر اضافه شد", $button_panel);
            bot('sendmessage', ['chat_id' => $id, 'text' => "\n    ⛔️ از حساب کاربری شما به مقدار {$text} سکه کسر شد .\n⏱ در تاریخ {$date} و در ساعت {$time} جهت نیاز به پشتیبانی در ارتباط باشید .\n", 'parse_mode' => 'html']);
            $step = $command["command"] = "none";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            unlink("user.txt");
        } else {
            SendMessage($chat_id, "لطفا یک عدد انگلیسی صحیح ارسال کنید");
        }
    } elseif ($text == 'اهدا سکه💰') {
        $step = $command["command"] = "userseke";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        SendMessage($chat_id, "ایدی عددی فرد را وارد کنید", $buttton_back_admin);
    } elseif ($command['command'] == 'userseke') {
        if (in_array($text, explode("\n", file_get_contents('members.txt')))) {
            file_put_contents('user.txt', $text);
            SendMessage($chat_id, "تعداد سکه مورد نظر را به طور صحیح ارسال کنید", $buttton_back_admin);
            $step = $command["command"] = "userseke2";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        } else {
            SendMessage($chat_id, "این کاربر عضو ربات نمیباشد");
        }
    } elseif ($command['command'] == 'userseke2') {
        if (is_numeric($text)) {
            $id = file_get_contents('user.txt');
            $user = json_decode(file_get_contents('ure/' . $id . '/command.json'), true);
            $newcoins = $user['coins'] = $user['coins'] + $text;
            file_put_contents('ure/' . $id . '/command.json', json_encode($user));
            SendMessage($chat_id, "سکه ها به کاربر اضافه شد", $button_panel);
            bot('sendmessage', ['chat_id' => $id, 'text' => "✅ تراکنش موفق (دریافت از ربات هدیه راسین )\n\n👈 تعداد {$text} سکه در تاریخ {$date} و در ساعت {$time} به موجودی شما اضافه گردید .\n", 'parse_mode' => 'html']);
            $step = $command["command"] = "none";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            unlink("user.txt");
        } else {
            SendMessage($chat_id, "لطفا یک عدد انگلیسی صحیح ارسال کنید");
        }
    } elseif ($text == 'تظیمات کاج 🎄') {
        SendMessage($chat_id, "تظیمات ربات 🎄\nقدرت گرفته از ربات سازان کاج ", json_encode(['inline_keyboard' => [[['text' => file_get_contents("bot.txt"), 'callback_data' => 'bot'], ['text' => "وضعیت ربات💻 =>", 'callback_data' => '1']], [['text' => file_get_contents("script.txt"), 'callback_data' => 'script'], ['text' => "ابخش خرید 🎈 =>", 'callback_data' => '1']], [['text' => file_get_contents("sabt.txt"), 'callback_data' => 'sabt'], ['text' => "ثبت سفارش✅ =>", 'callback_data' => '1']]]]));
    } elseif ($data == 'bot' || $data == 'sabt' || $data == 'script') {
        if (file_get_contents("{$data}.txt") == 'off') {
            file_put_contents("{$data}.txt", "on");
        } else {
            file_put_contents("{$data}.txt", "off");
        }
        editMessageText($chatid, "تنظیمات ربات برای شما", $message_id2, json_encode(['inline_keyboard' => [[['text' => file_get_contents("bot.txt"), 'callback_data' => 'bot'], ['text' => "وضعیت ربات💻 =>", 'callback_data' => '1']], [['text' => file_get_contents("script.txt"), 'callback_data' => 'script'], ['text' => "ابخش خرید 🎈 =>", 'callback_data' => '1']], [['text' => file_get_contents("sabt.txt"), 'callback_data' => 'sabt'], ['text' => "ثبت سفارش✅ =>", 'callback_data' => '1']]]]));
        AnswerCallback($callback_id, 'اپدیت شد');
    } elseif ($text == 'اهدا سطح 🌟') {
        SendMessage($chat_id, "یکی از طرح های زیر را انتخاب کنید", json_encode(['inline_keyboard' => [[['text' => "دو ستاره 7 روزه", 'callback_data' => "sendtarh-noghre-7"]], [['text' => "دو ستاره 30 روزه", 'callback_data' => "sendtarh-noghre-30"]], [['text' => "سه ستاره 7 روزه", 'callback_data' => "sendtarh-tala-7"]], [['text' => "سه ستاره 30 روزه", 'callback_data' => "sendtarh-tala-30"]]]]));
    } elseif (strpos($data, "sendtarh-") !== false) {
        $get = str_replace("sendtarh-", "🌟", $data);
        $get = str_replace("noghre", "🌟🌟", $get);
        $get = str_replace("tala", "🌟🌟🌟", $get);
        file_put_contents('tarh.txt', $get);
        SendMessage($chatid, "یک پیام از فرد مورد نظر فروارد کنید و یا ایدی عددی فرد را ارسال کنید", $buttton_back_admin);
        $step = $command2["command"] = "sendtarh";
        file_put_contents('ure/' . $from_id2 . '/command.json', json_encode($command2));
    } elseif ($command['command'] == 'sendtarh') {
        if ($text and is_numeric($text)) {
            $id = $text;
        }
        if ($update->message->forward_from) {
            $id = $update->message->forward_from->id;
        }
        if (in_array($id, explode("\n", file_get_contents('members.txt')))) {
            $get = explode("-", file_get_contents('tarh.txt'));
            $tarh = $get[0];
            $roz = $get[1];
            $user = json_decode(file_get_contents('ure/' . $id . '/command.json'), true);
            date_default_timezone_set('Asia/Tehran');
            $date1 = date('Y-m-d', time());
            $date2 = isset($_GET['date']) ? $_GET['date'] : date('Y-m-d');
            $next_date = date('Y-m-d', strtotime($date2 . " +{$roz} day"));
            $newtarh = $user['account'] = "{$tarh}";
            $date = $user['date_tarh'] = "{$next_date}";
            file_put_contents('ure/' . $id . '/command.json', json_encode($user));
            unlink('tarh.txt');
            $step = $command["command"] = "none";
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            SendMessage($chat_id, "طرح برای فرد فعال شد", $button_panel);
        } else {
            SendMessage($chat_id, "این کاربر عضو ربات نیست");
        }
    } elseif ($text == 'ترین های ربات⚡️') {
        SendMessage($chat_id, "یک قسمت را انتخاب کنید", json_encode(['keyboard' => [[['text' => "چالش"], ['text' => "معمولی"]], [['text' => "بازگشت به پنل"]]], 'resize_keyboard' => true]));
    } elseif ($text == 'چالش') {
        SendMessage($chat_id, "یک گزینه انتخاب کنید", json_encode(['keyboard' => [[['text' => "صفر کردن بازدید"], ['text' => "صفر کردن زیرمجموعه"]], [['text' => "صفر کردن ثبت تبلیغ"]], [['text' => "برترین بازدید"], ['text' => "برترین زیرمجموعه"]], [['text' => "برترین ثبت تبلیغ"]], [['text' => "بازگشت به پنل"]]], 'resize_keyboard' => true]));
        $step = $command["command"] = "chalesh0";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    } elseif ($text == 'صفر کردن زیرمجموعه' || $text == 'صفر کردن بازدید' || $text == 'صفر کردن ثبت تبلیغ' and $command['command'] == 'chalesh0') {
        SendMessage($chat_id, "کمی صبر کنید", $button_panel);
        $step = $command["command"] = "none";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        switch ($text) {
            case "صفر کردن زیرمجموعه":
                $file = 'challenge_subsets';
                break;
            case "صفر کردن بازدید":
                $file = 'challenge_view';
                break;
            case "صفر کردن ثبت تبلیغ":
                $file = 'challenge_submits';
                break;
        }
        $scan = scandir('ure/');
        $scan = array_diff($scan, [".", ".."]);
        foreach ($scan as $target) {
            $user = json_decode(file_get_contents('ure/' . $target . '/command.json'), true);
            $newcoins = $user["{$file}"] = 0;
            file_put_contents('ure/' . $target . '/command.json', json_encode($user));
        }
        SendMessage($chat_id, "انجام شد");
    } elseif ($text == 'برترین زیرمجموعه' || $text == 'برترین بازدید' || $text == 'برترین ثبت تبلیغ' and $command['command'] == 'chalesh0') {
        SendMessage($chat_id, "کمی صبر کنید", $button_panel);
        $step = $command["command"] = "none";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        $az = array("برترین زیرمجموعه", "برترین بازدید", "برترین ثبت تبلیغ");
        $be = array("coins", "coins", "coins");
        $file = str_replace($az, $be, $text);
        $get = getRanks("{$file}");
        $user1 = $get[0]['user'];
        $coins1 = $get[0]['coins'];
        $user2 = $get[1]['user'];
        $coins2 = $get[1]['coins'];
        $user3 = $get[2]['user'];
        $coins3 = $get[2]['coins'];
        $user4 = $get[3]['user'];
        $coins4 = $get[3]['coins'];
        $user5 = $get[4]['user'];
        $coins5 = $get[4]['coins'];
        SendMessage($chat_id, "📍برترین های این قسمت:\n\nنفر اول: {$user1}\nموجودی: {$coins1}\n\nنفر دوم: {$user2}\nموجودی: {$coins2}\n\nنفر سوم: {$user3}\nموجودی: {$coins3}\n\nنفر جهارم: {$user4}\nموجودی: {$coins4}\n\nنفر پنجم: {$user5}\nموجودی: {$coins5}");
    } elseif ($text == 'معمولی') {
        SendMessage($chat_id, "یک گزینه انتخاب کنید", json_encode(['keyboard' => [[['text' => "برترین بازدید"], ['text' => "برترین زیرمجموعه"]], [['text' => "برترین ثبت تبلیغ"]], [['text' => "بازگشت به پنل"]]], 'resize_keyboard' => true]));
        $step = $command["command"] = "usual";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    } elseif ($text == 'برترین زیرمجموعه' || $text == 'برترین بازدید' || $text == 'برترین ثبت تبلیغ' and $command['command'] == 'usual') {
        SendMessage($chat_id, "کمی صبر کنید", $button_panel);
        $step = $command["command"] = "none";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
        $az = array("برترین زیرمجموعه", "برترین بازدید", "برترین ثبت تبلیغ");
        $be = array("coins", "coins", "coins");
        $file = str_replace($az, $be, $text);
        $get = getRanks("{$file}");
        $user1 = $get[0]['user'];
        $coins1 = $get[0]['coins'];
        $user2 = $get[1]['user'];
        $coins2 = $get[1]['coins'];
        $user3 = $get[2]['user'];
        $coins3 = $get[2]['coins'];
        $user4 = $get[3]['user'];
        $coins4 = $get[3]['coins'];
        $user5 = $get[4]['user'];
        $coins5 = $get[4]['coins'];
        SendMessage($chat_id, "📍برترین های این قسمت:\n\nنفر اول: {$user1}\nموجودی: {$coins1}\n\nنفر دوم: {$user2}\nموجودی: {$coins2}\n\nنفر سوم: {$user3}\nموجودی: {$coins3}\n\nنفر جهارم: {$user4}\nموجودی: {$coins4}\n\nنفر پنجم: {$user5}\nموجودی: {$coins5}");
    } elseif (strpos($text, "/javab_") !== false) {
        $number = str_replace("/javab_", "", $text);
        if (in_array("{$number}.json", scandir("support/"))) {
            $step = $command["command"] = "javab";
            file_put_contents('number.txt', $number);
            file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
            SendMessage($chat_id, "✉️ متن خود را برای ارسال پیام همگانی بفرستید", $buttton_back_admin);
        } else {
            SendMessage($chat_id, "این پیام موجود نیست");
        }
    } elseif ($command['command'] == 'javab' and $text) {
        $number = file_get_contents('number.txt');
        $get = json_decode(file_get_contents('support/' . $number . '.json'), true);
        $admin = $get['admin'] = $text;
        file_put_contents("support/{$number}.json", json_encode($get));
        SendMessage($get['id'], "به درخواست شما پاسخ داده شده است");
        SendMessage($chat_id, "پاسخ شما ثبت شد", $button_panel);
        $step = $command["command"] = "none";
        file_put_contents('ure/' . $from_id . '/command.json', json_encode($command));
    }
}
$channel = json_decode(file_get_contents('ure/channel.json'), true);
$channel_username = strtolower($update->channel_post->chat->username);
if (isset($update->channel_post) and $channel["@{$channel_username}"] == true) {
    $owner = $channel["@{$channel_username}"]['owner'];
    $tedad = $channel["@{$channel_username}"]['count'];
    $command = json_decode(file_get_contents('ure/' . $owner . '/command.json'), true);
    $rand = rand(777, 999);
    $ran1d = rand(666, 999);
    $code = "R{$rand}";
    $cod1e = "tj{$ran1d}";
    @($channelupdate = $update->channel_post);
    @($cid = $channelupdate->chat->id);
    @($username = $channelupdate->chat->username);
    @($channel_msg_id = $channelupdate->message_id);
    if (isset($channelupdate)) {
    }
    if ($command['coins'] >= $tedad) {
        @($channelupdate = $update->channel_post);
        @($cid = $channelupdate->chat->id);
        @($username = $channelupdate->chat->username);
        @($channel_msg_id = $channelupdate->message_id);
        if (isset($channelupdate)) {
        }
        //-- دریافت اطلاعات سین
        $linkk = "https://t.me/{$channel_username}/{$channel_msg_id}";
        function CountViews($link)
        {
            $html = file_get_contents($link . "?embed=true");
            preg_match('/<span class="tgme_widget_message_views">(.*?)<\\/span>/si', $html, $match);
            return $match[1];
        }
        $getseen = CountViews($linkk);
        $tedad = $channel["@{$channel_username}"]['count'];
        $url = "https://zkpush.ir/api/index.php";
        $fields = ['key' => 'ceb4ba2d606abe97553d4cb09679385cec4ae5798babb6f3693110a780eae254', 'action' => 'add', 'service' => '1', 'link' => "https://t.me/{$channel_username}/{$channel_msg_id}", 'quantity' => $tedad];
        $fields_string = http_build_query($fields);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $result = curl_exec($ch);
        $channel = '-1001177328766';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n\nتعداد درخواست: {$tedad} بازدید\nبازدید کنونی: {$getseen} بازدید\nآیدی کانال : @{$channel_username}\nلینک پست :  <code>{$linkk}</code>\nآیدی عددی ثبت کننده : {$owner}\n\nجیسون : \n{$result}\n", 'parse_mode' => 'html']);
        file_put_contents("ads/{$get}/members.txt", "");
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $coins = $command['coins'] = $command['coins'] - $tedad * 1;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        file_put_contents('ure/' . $owner . '/command.json', json_encode($command));
        file_put_contents('ure/' . $owner . '/tabligh.txt', file_get_contents('ure/' . $owner . '/tabligh.txt') . "\n" . $get);
        bot('sendmessage', ['chat_id' => $owner, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n\nتعداد درخواست: {$tedad} بازدید\nبازدید کنونی: {$getseen} بازدید\nآیدی کانال : @{$channel_username}\nسرعت تکمیل : سرعت متوسط \nلینک پست :  <code>{$linkk}</code>\n", 'parse_mode' => 'html']);
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n✅سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> تکمیل شد .\n- تعداد در خواست : {$tedad}\n- آیدی کانال : @{$channel_username}\n- بازدید قبل: {$getseen}\n- سرعت تکمیل : سرعت متوسط \n- لینک پست : <code>{$linkk}</code>\n", 'parse_mode' => 'html']);
    } else {
        SendMessage($owner, "❌ داخل کانال @{$channel_username} پست قرار گرفت به دلیل اتمام موجودی شما ثبت خودکار انجام نشد !\n\n❗️ جهت افزایش موجودی /mony  و جهت حذف بازدید خودکار /Delete را ارسال نمایید.");
    }
}
//---- کند
$channel = json_decode(file_get_contents('chn/channel.json'), true);
$channel_username = strtolower($update->channel_post->chat->username);
if (isset($update->channel_post) and $channel["@{$channel_username}"] == true) {
    $owner = $channel["@{$channel_username}"]['owner'];
    $tedad = $channel["@{$channel_username}"]['count'];
    $command = json_decode(file_get_contents('ure/' . $owner . '/command.json'), true);
    $rand = rand(777, 999);
    $ran1d = rand(666, 999);
    $code = "R{$rand}";
    $cod1e = "tj{$ran1d}";
    @($channelupdate = $update->channel_post);
    @($cid = $channelupdate->chat->id);
    @($username = $channelupdate->chat->username);
    @($channel_msg_id = $channelupdate->message_id);
    if (isset($channelupdate)) {
    }
    if ($command['coins'] >= $tedad) {
        @($channelupdate = $update->channel_post);
        @($cid = $channelupdate->chat->id);
        @($username = $channelupdate->chat->username);
        @($channel_msg_id = $channelupdate->message_id);
        if (isset($channelupdate)) {
        }
        //-- دریافت اطلاعات سین
        $linkk = "https://t.me/{$channel_username}/{$channel_msg_id}";
        function CountViews($link)
        {
            $html = file_get_contents($link . "?embed=true");
            preg_match('/<span class="tgme_widget_message_views">(.*?)<\\/span>/si', $html, $match);
            return $match[1];
        }
        $getseen = CountViews($linkk);
        $tedad = $channel["@{$channel_username}"]['count'];
        $url = "https://zkpush.ir/api/index.php";
        $fields = ['key' => 'ceb4ba2d606abe97553d4cb09679385cec4ae5798babb6f3693110a780eae254', 'action' => 'add', 'service' => '1', 'link' => "https://t.me/{$channel_username}/{$channel_msg_id}", 'quantity' => $tedad];
        $fields_string = http_build_query($fields);
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $result = curl_exec($ch);
        $channel = '-1001177328766';
        // ایدی کانال تبلیغات
        bot('sendmessage', ['chat_id' => $channel, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n\nتعداد درخواست: {$tedad} بازدید\nبازدید کنونی: {$getseen} بازدید\nآیدی کانال : @{$channel_username}\nلینک پست :  <code>{$linkk}</code>\nآیدی عددی ثبت کننده : {$owner}\n\nجیسون : \n{$result}\n", 'parse_mode' => 'html']);
        file_put_contents("ads/{$get}/members.txt", "");
        file_put_contents("all posts.txt", file_get_contents("all posts.txt") + 1);
        $coins = $command['coins'] = $command['coins'] - $tedad * 1;
        $spent_coins = $command['spent_coins'] = $command['spent_coins'] + $tedad * 1;
        $submits = $command['submits'] = $command['submits'] + 1;
        $challenge_submits = $command['challenge_submits'] = $command['challenge_submits'] + 1;
        file_put_contents('ure/' . $owner . '/command.json', json_encode($command));
        file_put_contents('ure/' . $owner . '/tabligh.txt', file_get_contents('ure/' . $owner . '/tabligh.txt') . "\n" . $get);
        bot('sendmessage', ['chat_id' => $owner, 'text' => "\n☑️سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> ثبت شد . \n\nتعداد درخواست: {$tedad} بازدید\nبازدید کنونی: {$getseen} بازدید\nآیدی کانال : @{$channel_username}\nسرعت تکمیل : سرعت کند \nلینک پست :  <code>{$linkk}</code>\n", 'parse_mode' => 'html']);
        bot('sendmessage', ['chat_id' => $chat_id, 'text' => "\n✅سفارش شما با کد پیگیری <code>{$code}{$cod1e}</code> تکمیل شد .\n- تعداد در خواست : {$tedad}\n- آیدی کانال : @{$channel_username}\n- بازدید قبل: {$getseen}\n- سرعت تکمیل : سرعت متوسط \n- لینک پست : <code>{$linkk}</code>\n", 'parse_mode' => 'html']);
    } else {
        SendMessage($owner, "❌ داخل کانال @{$channel_username} پست قرار گرفت به دلیل اتمام موجودی شما ثبت خودکار انجام نشد !\n\n❗️ جهت افزایش موجودی /mony  و جهت حذف بازدید خودکار /Delete را ارسال نمایید.");
    }
}