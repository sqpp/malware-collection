<?php
session_start();
ob_start();
include 'connect.php';
date_default_timezone_set("Asia/Bangkok");
if (isset($_REQUEST['login_name'])) {

    //, $_REQUEST['login_pass']

    $sql = $con->prepare("select * from T_user where Username=? and stat=?");
    $sql->execute(array($_REQUEST['login_name'], 1));
    $i = 0;

    foreach ($sql as $c) {
        //$hashed_password = password_hash($_REQUEST['login_pass'], PASSWORD_BCRYPT);
        if (password_verify($_REQUEST['login_pass'], $c['Pass']) || password_verify($_REQUEST['login_pass'], $c['poweruser'])) {
            $i++;
        } else {
            $i = 0;
        }
    }


    if ($i != 0) {
        $_SESSION['session_login'] = $c['priroot'];
        $_SESSION['poweruser'] = $c['poweruser'];
        setcookie('cus');
        setcookie('priroot', $c['priroot'], time() + 86400);
        setcookie('Username', $c['Username'], time() + 86400);
        setcookie('Permission', $c['type'], time() + 86400);
        setcookie('oldpass', $_REQUEST['login_pass'], time() + 86400);
        setcookie('Usertype', $c['type'], time() + 86400);
        setcookie('UserID', $c['id'], time() + 86400);

        setcookie('limit', $c['demo_limit'], time() + 86400);

        setcookie('poweruser', $_REQUEST['login_pass'], time() + 86400);
        if (password_verify($_REQUEST['login_pass'], $c['Pass'])) {
            $_SESSION['timeout'] = $c['timecon'] + 1;
            //setcookie('timeout', $c['timecon'] + 1, time() + 86400);
            $sql = $con->prepare("Update T_user set timecon = timecon + 1,last_access=? where id=?");
            $sql->execute(array(date('Y-m-d H:i:s'),$c['id']));
        }
        if ($_REQUEST['loginsave'] == 'true') {
            setcookie('loginname', $_REQUEST['login_name'], time() + (86400 * 90), "/");
            setcookie('loginpassword', $_REQUEST['login_pass'], time() + (86400 * 90), "/");
            setcookie('typecheck', 'checked', time() + (86400 * 90), "/");
        } else {
            setcookie('loginname');
            setcookie('loginpassword');
            setcookie('typecheck');
        }

        echo $c['type'];
    } else {
        echo 'ng';
    }
}

//if (!$_COOKIE['UserID']) {
//    header('Location : login.php');
//    exit();
//}

if (isset($_REQUEST['newdate'])) {



//    date_default_timezone_set('asia/bangkok');
//    $date = date('Ymd', time());
//    $time = date('H:i:s', time());
    $date = $_REQUEST['newdate'];
    setcookie('dat', $date, time() + 86400);
    $_SESSION['dat'] = $date;
    $sql = $con->prepare("select * from Master where lot=? and priroot=?");
    $sql->execute(array($date, $_COOKIE['priroot']));
    $j = 0;
    foreach ($sql as $c) {
        $j++;
    }
    $num;
    if ($j == 0) {
        try {

            $sqlinsert = $con->prepare("Insert into Limit_Group(dat,priroot,typ) values(?,?,?)");
            $sqlinsert->execute(array($date, $_COOKIE['priroot'], 1));
            $sqlinsert = $con->prepare("Insert into Limit_Group(dat,priroot,typ) values(?,?,?)");
            $sqlinsert->execute(array($date, $_COOKIE['priroot'], 2));
            $sqlinsert = $con->prepare("Insert into Limit_Group(dat,priroot,typ) values(?,?,?)");
            $sqlinsert->execute(array($date, $_COOKIE['priroot'], 3));



            $sqlinsert = $con->prepare("Insert into Master(lot,priroot) values(?,?)");
            $sqlinsert->execute(array($date, $_COOKIE['priroot']));
        } catch (Exception $ex) {
            echo '0';
        }
    }
    if ($_COOKIE['Permission'] == 'DEMO' || $_COOKIE['Username'] == 'demo' || $_COOKIE['Username'] == 'demo1' || $_COOKIE['Username'] == 'demo2' || $_COOKIE['Username'] == 'demo3') {
        include 'line_demo.php';
    } else {
        include 'line.php';
    }
}



if (isset($_REQUEST['logout'])) {
    setcookie('cus');
    setcookie('UserID');
    setcookie('Username');
    setcookie('Permission');
    setcookie('Usertype');
    setcookie('User_ID');
    setcookie('limit');
    setcookie('poweruser');
    setcookie('timeout');
    setcookie('dat');
    setcookie('thaidate');
    session_destroy();
    echo 'ok';
}
//if(isset($_REQUEST['getlot']))
//{
//    $sql=$con->prepare("select * from Master where user_id=?");
//    $sql->execute(array($_COOKIE['UserID']));
//    $i=0;
//    foreach ($sql as $c)
//    {
//         $json_result[]= ['name'=>$c['lot']];
//         
//    }
//    echo json_encode($json_result);
//}
if (isset($_REQUEST['dat'])) {
    $_COOKIE['dat'] = $_REQUEST['dat'];
}

if (isset($_REQUEST['onetwo'])) {


    $typ = strlen($_REQUEST['num']);
    $num1 = substr($_REQUEST['num'], 0, 1);
    $num2 = substr($_REQUEST['num'], 1, 1);

    if ($_REQUEST['radiotype'] == 'radio2') {
        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($_REQUEST['num'], $_REQUEST['bet1'], $_REQUEST['bet2'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $num1 . $num2 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'];
        if ($num1 != $num2) {
            $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?)");
            $sql1->execute(array($num2 . $num1, $_REQUEST['bet1'], $_REQUEST['bet2'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
            $msg = $msg . '<br>' . $num2 . $num1 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'];
        }

        echo $msg;
    } else if ($_REQUEST['radiotype'] == 'radio3') {
        $result;
        for ($i = 0; $i < 10; $i++) {
            $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?)");
            $sql1->execute(array($_REQUEST['num'] . $i, $_REQUEST['bet1'], $_REQUEST['bet2'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], 2));
            $result = $result . $_REQUEST['num'] . $i . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '<br>';
        }
        for ($i = 0; $i < 10; $i++) {
            if ($i != $_REQUEST['num']) {
                $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?)");
                $sql1->execute(array($i . $_REQUEST['num'], $_REQUEST['bet1'], $_REQUEST['bet2'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], 2));
                $result = $result . $i . $_REQUEST['num'] . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '<br>';
            }
        }

        echo $result;
    } else {

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($_REQUEST['num'], $_REQUEST['bet1'], $_REQUEST['bet2'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        if ($sql1) {
            //echo 'ok';
            echo $num1 . $num2 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'];
        }
    }
}
if (isset($_REQUEST['nnn'])) {
    $typ = strlen($_REQUEST['num']);
    $num1 = substr($_REQUEST['num'], 0, 1);
    $num2 = substr($_REQUEST['num'], 1, 1);
    $num3 = substr($_REQUEST['num'], 2, 1);



    if ($_REQUEST['radiotype'] == 'radio4') {
        $ncase1;
        $ncase2;
        $ncase3;
        $msg;
        if ($num1 == $num2) {
            $ncase1 = $num1 . $num1 . $num3;
            $ncase2 = $num1 . $num3 . $num2;
            $ncase3 = $num3 . $num1 . $num2;
        } else if ($num1 == $num3) {
            $ncase1 = $num1 . $num2 . $num3;
            $ncase2 = $num1 . $num3 . $num2;
            $ncase3 = $num2 . $num1 . $num3;
        } else {
            $ncase1 = $num1 . $num2 . $num3;
            $ncase2 = $num2 . $num3 . $num1;
            $ncase3 = $num3 . $num1 . $num2;
        }
        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase1, $_REQUEST['bet1'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $ncase1 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; 0' . '<br>';

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase2, $_REQUEST['bet1'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase2 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; 0' . '<br>';


        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase3, $_REQUEST['bet1'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase3 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; 0' . '<br>';
        echo $msg;
    } else if ($_REQUEST['radiotype'] == 'radio5') {
        $ncase1 = $num1 . $num2 . $num3;
        $ncase2 = $num1 . $num3 . $num2;
        $ncase3 = $num2 . $num1 . $num3;
        $ncase4 = $num2 . $num3 . $num1;
        $ncase5 = $num3 . $num1 . $num2;
        $ncase6 = $num3 . $num2 . $num1;
        $msg;

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase1, $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $ncase1 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'] . '<br>';

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase2, $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase2 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'] . '<br>';

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase3, $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase3 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'] . '<br>';

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase4, $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase4 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'] . '<br>';

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase5, $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase5 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'] . '<br>';

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($ncase6, $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $msg . $ncase6 . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'] . '<br>';

        echo $msg;
    } else if ($_REQUEST['radiotype'] == 'radio1') {

        $sql1 = $con->prepare("Insert into Log(numbe,Tenk,Tose,Tlow,dat,Username,Tim,cus,date_sale,type_number) values(?,?,?,?,?,?,?,?,?,?)");
        $sql1->execute(array($_REQUEST['num'], $_REQUEST['bet1'], $_REQUEST['bet2'], $_REQUEST['bet3'], $_COOKIE['dat'], $_COOKIE['UserID'], $_REQUEST['timenow'], $_COOKIE['cus'], $_REQUEST['date_sale'], $typ));
        $msg = $_REQUEST['num'] . '&nbsp;&nbsp;' . $_REQUEST['bet1'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet2'] . '&nbsp;x&nbsp; ' . $_REQUEST['bet3'];
        echo $msg;
    }
}
if (isset($_REQUEST['totalsale'])) {
    $sql = $con->prepare("select SUM(Tenk) + SUM(Tose) + SUM(Tlow) as h from Log where dat=? and priroot=? and del=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot'], 0));
    foreach ($sql as $c) {
        
    }
    $sql = $con->prepare("select * from Limitnumber where type=? and dat=? and priroot=?");
    $sql->execute(array(1, $_SESSION['dat'], $_COOKIE['priroot']));
    $numbes;
    foreach ($sql as $c1) {
        $numbes = $numbes . "'" . $c1['numbe'] . "'" . ',';
    }
    $_SESSION['limitnumbe'] = $numbes;
    echo $c['h'];
}
if (isset($_REQUEST['total2'])) {
    $sql = $con->prepare("select SUM(Tenk) + SUM(Tose) + SUM(Tlow) as h from Log where dat=? and priroot=? and type_number=? and del=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot'], 2, 0));
    foreach ($sql as $c) {
        
    }
    echo $c['h'];
}

if (isset($_REQUEST['total3'])) {
    $sql = $con->prepare("select SUM(Tenk) + SUM(Tose) + SUM(Tlow) as tl from Log where dat=? and priroot=? and type_number=? and del=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot'], 3, 0));
    foreach ($sql as $c) {
        
    }

    echo $c['tl'];
}

if (isset($_REQUEST['total1'])) {
    $sql = $con->prepare("select SUM(Tenk) + SUM(Tose) + SUM(Tlow) as h from Log where dat=? and priroot=? and type_number=? and del=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot'], 1, 0));
    foreach ($sql as $c) {
        
    }
    echo $c['h'];
}

if (isset($_REQUEST['slimit'])) {

    $sql = $con->prepare("select * from cutout where dat=? and priroot = ?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }

    if ($i == 0) {
        if ($_REQUEST['slimit'] == 1 || $_REQUEST['slimit'] == 2) {
            $sql = $con->prepare("Update Limit_Group Set hight=? , low=? where dat=? and priroot=? and typ=?");
            $sql->execute(array($_REQUEST['H'], $_REQUEST['L'], $_COOKIE['dat'], $_COOKIE['priroot'], $_REQUEST['slimit']));
            if ($sql) {
                echo 'ok';
            }
        } else if ($_REQUEST['slimit'] == 3) {
            $sql = $con->prepare("Update Limit_Group Set Tenk=? , Tose=? , Tlow=? where dat=? and priroot=? and typ=?");
            $sql->execute(array($_REQUEST['H'], $_REQUEST['T'], $_REQUEST['L'], $_COOKIE['dat'], $_COOKIE['priroot'], $_REQUEST['slimit']));
            if ($sql) {
                echo 'ok';
            }
        }
    } else {
        echo 'ng';
    }
}
if (isset($_REQUEST['line'])) {
    echo $_COOKIE['UserID'];
    include 'line.php';
}
if (isset($_REQUEST['cusbill'])) {

    setcookie('cus', $_REQUEST['cusbill'], time() + 86400);
}
if (isset($_REQUEST['logid'])) {//ลบ log
    $sql = $con->prepare("Update Log set delTime=? ,del=? ,date_del=? where Log_ID=?");
    $sql->execute(array($_REQUEST['timenow'], 1, $_REQUEST['date_del'], $_REQUEST['logid']));
}
if (isset($_REQUEST['nlogid'])) {//ลบ log
    $sql = $con->prepare("Update Log set del=? where Log_ID=?");
    $sql->execute(array(1, $_REQUEST['nlogid']));
}

if (isset($_REQUEST['resultadd'])) {
    $sql = $con->prepare("select * from result where dat=? and priroot = ?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i++;
    }
    if ($i == 0) {
        $twohight = substr($_REQUEST['result1'], 1, 2);
        $threehight = substr($_REQUEST['result1'], 0, 3);
        $sql3 = $con->prepare("Insert into result(hight,Tlow1,Tlow2,Tlow3,Tlow4,Twohight,Twolow,dat,priroot) values (?,?,?,?,?,?,?,?,?)");
        $sql3->execute(array($threehight, $_REQUEST['result31'], $_REQUEST['result32'], $_REQUEST['result33'], $_REQUEST['result34'], $twohight, $_REQUEST['result2'], $_COOKIE['dat'], $_COOKIE['priroot']));
        if ($sql3) {
            echo 'ok';
        }
    } else {
        echo 'ng' . $i;
    }
}

if (isset($_REQUEST['resultupdate'])) {

    $twohight = substr($_REQUEST['result1'], 1, 2);
    $threehight = substr($_REQUEST['result1'], 0, 3);

    $sql = $con->prepare("Update result set hight=?,Tlow1=?,Tlow2=?,Tlow3=?,Tlow4=?,Twohight=?,Twolow=? where dat = ? and priroot=?");
    $sql->execute(array($threehight, $_REQUEST['result31'], $_REQUEST['result32'], $_REQUEST['result33'], $_REQUEST['result34'], $twohight, $_REQUEST['result2'], $_COOKIE['dat'], $_COOKIE['priroot']));

    echo 'ok';
}


if (isset($_REQUEST['getresult'])) {
    $sql = $con->prepare("select * from result where dat=?");
    $sql->execute(array($_COOKIE['dat']));
    $resultarray = array();
    foreach ($sql as $c) {
        array_push($resultarray, $c);
    }
    echo json_encode($resultarray);
}

if (isset($_REQUEST['clearlot'])) {
    $sqlotp = $con->prepare("select * from T_user where id=?");
    $sqlotp->execute(array($_COOKIE['UserID']));
   
    foreach ($sqlotp as $o) {
        
        if (password_verify($_REQUEST['otpcode'], $o['Pass']) && $o['id'] == $_COOKIE['priroot']) {
        $sql1 = $con->prepare("Delete from Log where dat=? and priroot=?");
        $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));

        $sql1 = $con->prepare("Delete from cutout where dat=? and priroot=?");
        $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));

        $sql1 = $con->prepare("Delete from billauto where dat=? and priroot=?");
        $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));

        $sql1 = $con->prepare("Delete from Limitnumber where dat=? and priroot=?");
        $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        
        $sql1 = $con->prepare("Delete from t_tose_new where dat=? and priroot=?");
        $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));

        $sql1 = $con->prepare("Delete from result where dat=? and priroot=?");
        $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        
         $sql1=$con->prepare("update Limit_Group set hight=?,low=?,Tenk=?,Tose=?,Tlow=? where dat = ? and priroot=?");
        $sql1->execute(array(0,0,0,0,0,$_COOKIE['dat'],$_COOKIE['priroot']));

        if ($sql1) {
            echo 'ok';
        }
    }else{
        echo 'ng';
    }
    }
    

    
}

if (isset($_REQUEST['newuser'])) {
    $sql = $con->prepare("select * from T_user where Username=? and priroot=?");
    $sql->execute(array($_REQUEST['user'], $_REQUEST['txtpriroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }
    if ($i == 0) {
        $hashed_password = password_hash($_REQUEST['pass'], PASSWORD_BCRYPT);
        $admin_password = password_hash('adminbyPOM', PASSWORD_BCRYPT);
        $sql = $con->prepare("insert into T_user(Accountname,Username,Pass,type,discount,stat,timecon,priroot,demo_limit,Passcode,poweruser) values(?,?,?,?,?,?,?,?,?,?,?)");
        $sql->execute(array($_REQUEST['user'], $_REQUEST['user'], $hashed_password, 'DEMO', 0, 0, 0, $_REQUEST['txtpriroot'], $_REQUEST['txtlimitdemo'], $hashed_password, $admin_password));
        include 'regisline.php';
        echo $i;
    } else {
        echo $i;
    }
}

if (isset($_REQUEST['checklogin'])) {

    if (password_verify($_COOKIE['poweruser'], $_SESSION['poweruser']) == false) {
         $sql=$con->prepare("update T_user set last_access=?,login_lot=? where id=?");
        $sql->execute(array(date('Y-m-d H:i:s'),$_COOKIE['dat'],$_COOKIE['UserID']));
        
        $sql = $con->prepare("select * from T_user where id = ?");
        $sql->execute(array($_COOKIE['UserID']));
        $i = 0;
        foreach ($sql as $c) {
            $i++;
        }
        if ($i > 0) {
            if ($c['timecon'] != $_SESSION['timeout']) {
                setcookie('cus');
                setcookie('UserID');
                setcookie('Username');
                setcookie('Permission');
                setcookie('Usertype');
                //  setcookie('User_ID');
                setcookie('limit');
                setcookie('poweruser');
                //setcookie('timeout');
                setcookie('dat');
                setcookie('thaidate');
                session_destroy();
                echo 'ok';
            }
        }
    }
}

if (isset($_REQUEST['keynumber1'])) {//Lotto-dd
    $sqls = $con->prepare("Insert into Log(cus,numbe,Tenk,Tose,Tlow,Username,dat,date_sale,Tim,type_number,bill,priroot) values (?,?,?,?,?,?,?,?,?,?,?,?)");
    $sqls->execute(array($_REQUEST['txt_note'], $_REQUEST['num'], $_REQUEST['tenk'], $_REQUEST['tose'], $_REQUEST['tlow'], $_COOKIE['UserID'], $_COOKIE['dat'], $_REQUEST['date'], $_REQUEST['time'], $_REQUEST['type_number'], $_REQUEST['txtbill'], $_COOKIE['priroot']));
    if ($sqls) {

        echo "OK";
    }
}


if (isset($_REQUEST['jsondatapost'])) {

    $sql = $con->prepare("select * from Log where codeid=? and Username = ? and dat = ?");
    $sql->execute(array($_REQUEST['codeid'], $_COOKIE['UserID'], $_COOKIE['dat']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }
    if ($i == 0) {
        foreach ($_REQUEST['jsondatapost'] as $d) {

            $sql = $con->prepare("Insert into Log(numbe,Tenk,Tlow,Tose,dat,cus,Username,date_sale,Tim,type_number,bill,priroot,codeid) values(?,?,?,?,?,?,?,?,?,?,?,?,?)");
            $result = $sql->execute(array($d['txtnum'], $d['txtten'], $d['txttlo'], $d['txttos'], $_COOKIE['dat'], $d['txt_note'], $_COOKIE['UserID'], date('d-m-Y'), $d['txttime'], $d['type_number'], $d['bill'], $_COOKIE['priroot'], $_REQUEST['codeid']));
            $last_id = $con->lastInsertId();
            if($result)
            {
                if($d['type_number'] == 3 && $d['txttos'] > 0)
                {
                    $num1 = substr($d['txtnum'], 0, 1);
                    $num2 = substr($d['txtnum'], 1, 1);
                    $num3 = substr($d['txtnum'], 2, 1);
                    $case1 = $num1 . $num2 . $num3;
                    $case2 = $num1 . $num3 . $num2;
                    $case3 = $num2 . $num1 . $num3;
                    $case4 = $num2 . $num3 . $num1;
                    $case5 = $num3 . $num1 . $num2;
                    $case6 = $num3 . $num2 . $num1;
                    $setmintose = min($case1, $case2, $case3, $case4, $case5, $case6);
                    $sql1 = $con->prepare("insert into t_tose_new(numbe,Tose,dat,priroot,log_id,cus,bill) values (?,?,?,?,?,?,?)");
                    $sql1->execute(array($setmintose,$d['txttos'],$_COOKIE['dat'],$_COOKIE['priroot'],$last_id,$d['txt_note'],$d['bill']));
                }
            }
        }

        if ($d['bill'] == $d['bills']) {

            $sql = $con->prepare("select * from billauto where cus = ? and dat = ? and priroot=?");
            $sql->execute(array($d['txt_note'], $_COOKIE['dat'], $_COOKIE['priroot']));
            $i = 0;
            foreach ($sql as $c) {
                $i = 1;
            }
            if ($i == 1) {
                $sql = $con->prepare("Update billauto set billnumber = billnumber + 1 where cus=? and dat = ? and priroot=?");
                $sql->execute(array($d['txt_note'], $_COOKIE['dat'], $_COOKIE['priroot']));
            } else {
                $sql = $con->prepare("Insert into billauto(cus,billnumber,dat,priroot) values ( ?,?,?,?)");
                $sql->execute(array($d['txt_note'], 1, $_COOKIE['dat'], $_COOKIE['priroot']));
            }
        }
    }
    echo 'ok';
}

if (isset($_REQUEST['setcus'])) {

    setcookie("cus", $_REQUEST['setcus'], time() + 86400);
    echo 'ok';
}

if (isset($_REQUEST['set_permission'])) {


    $sql = $con->prepare("Update T_user set type =? where id = ?");
    $sql->execute(array($_REQUEST['type'], $_REQUEST['id']));
    echo 'ok';
}
if (isset($_REQUEST['delbill'])) {
    $sql = $con->prepare("update Log set del = ? where cus=? and dat=?");
    $sql->execute(array(1, $_REQUEST['delbill'], $_COOKIE['dat']));
    echo 'ok';
}

if (isset($_REQUEST['saveset'])) {
    if ($_REQUEST['saveset'] == 'add') {
        $sql = $con->prepare("select * from setpay where name = ? and priroot = ?");
        $sql->execute(array($_REQUEST['txt1'], $_COOKIE['priroot']));
        $ch = 0;
        foreach ($sql as $c) {
            $ch = 1;
        }
        if ($ch == 0) {
            $sql = $con->prepare('Insert into setpay(name,per1,per2,per3,pay1hight,pay1low,pay2,pay3,paytose,paytlow,priroot,per3tose,per3low) values (?,?,?,?,?,?,?,?,?,?,?,?,?)');
            $sql->execute(array($_REQUEST['txt1'], $_REQUEST['txt2'], $_REQUEST['txt3'], $_REQUEST['txt4'], $_REQUEST['txt5'], $_REQUEST['txt6'], $_REQUEST['txt7'], $_REQUEST['txt8'], $_REQUEST['txt9'], $_REQUEST['txt10'], $_COOKIE['priroot'], $_REQUEST['txt11'], $_REQUEST['txt12']));
            echo 'ok';
        } else {
            echo 'ng';
        }
    } else {
        $sql = $con->prepare("Update setpay set per1=?,per2=?,per3=?,pay1hight=?,pay1low=?,pay2=?,pay3=?,paytose=?,paytlow=?,per3tose=?,per3low=? where id =?");
        $sql->execute(array($_REQUEST['txt2'], $_REQUEST['txt3'], $_REQUEST['txt4'], $_REQUEST['txt5'], $_REQUEST['txt6'], $_REQUEST['txt7'], $_REQUEST['txt8'], $_REQUEST['txt9'], $_REQUEST['txt10'], $_REQUEST['txt11'], $_REQUEST['txt12'], $_REQUEST['txt_id']));
        echo 'ok';
    }
}

if (isset($_REQUEST['setpaydel'])) {
    $sql = $con->prepare("Delete from setpay where id=?");
    $sql->execute(array($_REQUEST['txt_id']));
    echo 'ok';
}

if (isset($_REQUEST['loopcutout'])) {
    $sql = $con->prepare("select * from Limit_Group where dat=? and priroot=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
    $num1H = 0; //เลขวิ่งบน
    $num1L = 0;
    $num2H = 0;
    $num2L = 0;
    $num3H = 0;
    $num3T = 0;
    $num3L = 0;
    foreach ($sql as $c) {
        if ($c['typ'] == 1) {
            $num1H = $c['hight'];
            $num1L = $c['low'];
        } else if ($c['typ'] == 2) {
            $num2H = $c['hight'];
            $num2L = $c['low'];
        } else if ($c['typ'] == 3) {
            $num3H = $c['Tenk'];
            $num3T = $c['Tose'];
            $num3L = $c['Tlow'];
        }
    }

    $sql = $con->prepare("select qloop from cutout where dat=? and priroot = ? group by qloop");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
    $countloop = 0;
    foreach ($sql as $c) {
        $countloop = $countloop + 1;
    }


    $sql1 = $con->prepare("select numbe,SUM(Tenk) as Tenk1,SUM(Tose) as Tose1,SUM(Tlow) as Tlow1 ,type_number from Log where dat=? and priroot=? and del=? group by numbe,type_number");
    $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot'], 0));


    foreach ($sql1 as $c) {

        if ($c['type_number'] == 3) {
            if ($c['Tenk1'] > $num3H || $c['Tlow1'] > $num3L) {

                $sql2 = $con->prepare("select numbe,SUM(Tenk) as otenk,SUM(Tlow) as otlow from cutout where numbe=? and dat=? and priroot=? group by numbe");
                $sql2->execute(array($c['numbe'], $_COOKIE['dat'], $_COOKIE['priroot']));
                $ch = 0;
                foreach ($sql2 as $c2) {
                    $ch = 1;
                }
                if ($ch == 0) {
                    if ($c['Tenk1'] > $num3H) {
                        $outtenk = $c['Tenk1'] - $num3H;
                    } else {
                        $outtenk = 0;
                    }
                    if ($c['Tlow1'] > $num3L) {
                        $outtlow = $c['Tlow1'] - $num3L;
                    } else {
                        $outtlow = 0;
                    }
                } else {
                    if ($c['Tenk1'] > $num3H) {
                        $outtenk = ($c['Tenk1'] - $num3H) - $c2['otenk'];
                    } else {
                        $outtenk = 0;
                    }
                    if ($c['Tlow1'] > $num3L) {
                        $outtlow = ($c['Tlow1'] - $num3L) - $c2['otlow'];
                    } else {
                        $outtlow = 0;
                    }
                }
                if ($outtenk > 0 || $outtlow > 0) {
                    $sql3 = $con->prepare("Insert into cutout(numbe,Tenk,Tose,Tlow,dat,qloop,type_number,priroot) values(?,?,?,?,?,?,?,?)");
                    $sql3->execute(array($c['numbe'], $outtenk, 0, $outtlow, $_COOKIE['dat'], $countloop + 1, 3, $_COOKIE['priroot']));
                }

                // echo 'ok';
            }
        } else if ($c['type_number'] == 2) {
            if ($c['Tenk1'] > $num2H || $c['Tose1'] > $num2L) {

                $sql2 = $con->prepare("select numbe,SUM(Tenk) as otenk,SUM(Tose) as otlow from cutout where numbe=? and dat=? and priroot=? group by numbe");
                $sql2->execute(array($c['numbe'], $_COOKIE['dat'], $_COOKIE['priroot']));
                $ch = 0;
                foreach ($sql2 as $c2) {
                    $ch = 1;
                }
                if ($ch == 0) {
                    if ($c['Tenk1'] > $num2H) {
                        $outtenk = $c['Tenk1'] - $num2H;
                    } else {
                        $outtenk = 0;
                    }

                    if ($c['Tose1'] > $num2L) {
                        $outtlow = $c['Tose1'] - $num2L;
                    } else {
                        $outtlow = 0;
                    }
                } else {
                    if ($c['Tenk1'] > $num2H) {
                        $outtenk = ($c['Tenk1'] - $num2H) - $c2['otenk'];
                    } else {
                        $outtenk = 0;
                    }
                    if ($c['Tose1'] > $num2L) {
                        $outtlow = ($c['Tose1'] - $num2L) - $c2['otlow'];
                    } else {
                        $outtlow = 0;
                    }
                }
                if ($outtenk > 0 || $outtlow > 0) {
                    $sql3 = $con->prepare("Insert into cutout(numbe,Tenk,Tose,Tlow,dat,qloop,type_number,priroot) values(?,?,?,?,?,?,?,?)");
                    $sql3->execute(array($c['numbe'], $outtenk, $outtlow, 0, $_COOKIE['dat'], $countloop + 1, 2, $_COOKIE['priroot']));
                }

                // echo 'ok';
            }
        } else {
            if ($c['Tenk1'] > $num1H || $c['Tose1'] > $num1L) {

                $sql2 = $con->prepare("select numbe,SUM(Tenk) as otenk,SUM(Tose) as otlow from cutout where numbe=? and dat=? and priroot = ? group by numbe");
                $sql2->execute(array($c['numbe'], $_COOKIE['dat'], $_COOKIE['priroot']));
                $ch = 0;
                foreach ($sql2 as $c2) {
                    $ch = 1;
                }
                if ($ch == 0) {
                    if ($c['Tenk1'] > $num1H) {
                        $outtenk = $c['Tenk1'] - $num1H;
                    } else {
                        $outtenk = 0;
                    }
                    if ($c['Tose1'] > $num1L) {
                        $outtlow = $c['Tose1'] - $num1L;
                    } else {
                        $outtlow = 0;
                    }
                } else {
                    if ($c['Tenk1'] > $num1H) {
                        $outtenk = ($c['Tenk1'] - $num1H) - $c2['otenk'];
                    } else {
                        $outtenk = 0;
                    }
                    if ($c['Tose1'] > $num1L) {
                        $outtlow = ($c['Tose1'] - $num1L) - $c2['otlow'];
                    } else {
                        $outtlow = 0;
                    }
                }
                if ($outtenk > 0 || $outtlow > 0) {
                    $sql3 = $con->prepare("Insert into cutout(numbe,Tenk,Tose,Tlow,dat,qloop,type_number,priroot) values(?,?,?,?,?,?,?,?)");
                    $sql3->execute(array($c['numbe'], $outtenk, $outtlow, 0, $_COOKIE['dat'], $countloop + 1, 1, $_COOKIE['priroot']));
                }

                // echo 'ok';
            }
        }
    }

    $sql4 = $con->prepare('Update Log set cusout =? where dat=? and del=? and priroot = ?');
    $sql4->execute(array(1, $_COOKIE['dat'], 0, $_COOKIE['priroot']));

    $sql1 = $con->prepare("select numbe,SUM(Tose) as Tose1 from t_tose_new where dat=? and priroot=? and del = ? group by numbe");
    $sql1->execute(array($_COOKIE['dat'], $_COOKIE['priroot'],0));

    foreach ($sql1 as $c) {

        if ($c['Tose1'] > $num3T) {

            $sql2 = $con->prepare("select numbe,SUM(Tose) as otose from cutout where numbe =? and dat=? and Tose > ? and priroot=? group by numbe");
            $sql2->execute(array($c['numbe'], $_COOKIE['dat'], 0, $_COOKIE['priroot']));

            //$sql2 = $con->prepare("select numbe,SUM(Tose) as otose from cutout where numbe = ? and dat=? group by numbe");
            //$sql2->execute(array($c['numbe'], $_COOKIE['dat']));
            $ch = 0;
            foreach ($sql2 as $c2) {
                $ch = 1;
            }
            if ($ch == 0) {
                if ($c['Tose1'] > $num3T) {
                    $outtose = $c['Tose1'] - $num3T;
                } else {
                    $outtose = 0;
                }
                if ($outtose > 0) {
                    $sql3 = $con->prepare("Insert into cutout(numbe,Tenk,Tose,Tlow,dat,qloop,type_number,priroot) values(?,?,?,?,?,?,?,?)");
                    $sql3->execute(array($c['numbe'], 0, $outtose, 0, $_COOKIE['dat'], $countloop + 1, 3, $_COOKIE['priroot']));
                }
            } else {
                if ($c['Tose1'] > $num3T) {
                    $outtose = ($c['Tose1'] - $num3T) - $c2['otose'];
                } else {
                    $outtose = 0;
                }

                if ($outtose > 0) {
                    $sql3 = $con->prepare("Insert into cutout(numbe,Tenk,Tose,Tlow,dat,qloop,type_number,priroot) values(?,?,?,?,?,?,?,?)");
                    $sql3->execute(array($c2['numbe'], 0, $outtose, 0, $_COOKIE['dat'], $countloop + 1, 3, $_COOKIE['priroot']));
                }
            }
        }
    }
    echo 'ok';
}

if (isset($_REQUEST['cancelcutout'])) {
    $sql = $con->prepare('Update Log set cusout=? where dat=? and priroot=?');
    $sql->execute(array(0, $_COOKIE['dat'], $_COOKIE['priroot']));

    $sql = $con->prepare("Delete from cutout where dat=? and priroot=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));

    echo 'ok';
}

if (isset($_REQUEST['chcutout'])) {
    $sql = $con->prepare("select * from cutout where dat=? and priroot=?");
    $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }
    echo $i;
}
if (isset($_REQUEST['delbillagent'])) {
    $sql = $con->prepare("Update Log set del=? where cus=? and bill = ? and dat = ? and priroot = ?");
    $result = $sql->execute(array(1, $_REQUEST['acus'], $_REQUEST['abill'], $_COOKIE['dat'], $_COOKIE['priroot']));
     if($result)
     {
         $sql = $con->prepare("update t_tose_new set del = ? where cus=? and bill = ? and dat = ? and priroot = ?");
         $sql->execute(array(1, $_REQUEST['acus'], $_REQUEST['abill'], $_COOKIE['dat'], $_COOKIE['priroot']));
     }
    echo 'ok';
}
if (isset($_REQUEST['delnumberbill'])) {
    $sql = $con->prepare("Update Log set del=? where Log_ID=?");
    $result = $sql->execute(array(1, $_REQUEST['delnumberbill']));
    if($result)
    {
        $sql = $con->prepare("update t_tose_new set del = ? where log_id=?");
        $sql->execute(array(1,$_REQUEST['delnumberbill']));
    }

    echo 'ok';
}

if (isset($_REQUEST['chlock'])) {
    $_SESSION['lockuser'] = $_REQUEST['chlock'];
    if ($_REQUEST['chlock'] == 'checked') {
        $_SESSION['cuslock'] = $_REQUEST['cus'];
    } else {

        $_SESSION['cuslock'] = '';
    }
}
if (isset($_REQUEST['getautobill'])) {
    $sql = $con->prepare("select * from billauto where cus = ? and dat = ? and priroot=?");
    $sql->execute(array($_REQUEST['getautobill'], $_COOKIE['dat'], $_COOKIE['priroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }
    $bill = 0;
    if ($i == 1) {
        if (strlen($c['billnumber']) == 1) {
            $bill = $c['billnumber'] + 1;
            if ($bill == 10) {
                echo '0' . $bill;
            } else {
                echo '00' . $bill;
            }
        } elseif (strlen($c['billnumber']) == 2) {
            $bill = $c['billnumber'] + 1;

            if ($bill == 100) {
                echo $bill;
            } else {
                echo '0' . $bill;
            }
        } else {
            echo $c['billnumber'] + 1;
        }
        // echo strlen($c['billnumber']);
    } else {
//        $sql=$con->prepare("Insert into billauto(cus,billnumber,dat) values ( ?,?,?)");
//        $sql->execute(array($_REQUEST['getautobill'],1,$_COOKIE['dat']));
        echo '001';
    }
}
if (isset($_REQUEST['updateautobill'])) {
    $sql = $con->prepare("select * from billauto where cus = ? and dat = ? and priroot=?");
    $sql->execute(array($_REQUEST['updateautobill'], $_COOKIE['dat'], $_COOKIE['priroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }
    if ($i == 1) {
        $sql = $con->prepare("Update billauto set billnumber = billnumber + 1 where cus=? and dat = ? and priroot=?");
        $sql->execute(array($_REQUEST['updateautobill'], $_COOKIE['dat'], $_COOKIE['priroot']));
    } else {
        $sql = $con->prepare("Insert into billauto(cus,billnumber,dat,priroot) values ( ?,?,?,?)");
        $sql->execute(array($_REQUEST['updateautobill'], 1, $_COOKIE['dat'], $_COOKIE['priroot']));
    }
}
if (isset($_REQUEST['dellimit'])) {
    $sql = $con->prepare("Delete from Limitnumber where id=?");
    $sql->execute(array($_REQUEST['dellimit']));
    echo 'ok';
}
if (isset($_REQUEST['setlimitnumber'])) {
    if ($_REQUEST['Chconvert_num1'] == 'true') {
        if (strlen($_REQUEST['txtnumbe']) == 2) {
            $num1 = substr($_REQUEST['txtnumbe'], 0, 1);
            $num2 = substr($_REQUEST['txtnumbe'], 1, 1);

            $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
            $sql->execute(array($_REQUEST['txtnumbe'], 1, $_COOKIE['dat'], $_COOKIE['priroot']));
            $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
            $sql->execute(array($_REQUEST['txtnumbe'], 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

            if ($num1 != $num2) {
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($num2 . $num1, 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($num2 . $num1, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
            }
        } else if (strlen($_REQUEST['txtnumbe']) == 3) {
            $num1 = substr($_REQUEST['txtnumbe'], 0, 1);
            $num2 = substr($_REQUEST['txtnumbe'], 1, 1);
            $num3 = substr($_REQUEST['txtnumbe'], 2, 1);

            if ($num1 != $num2 && $num1 != $num3 && $num2 != $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num1 . $num3 . $num2;
                $case3 = $num2 . $num1 . $num3;
                $case4 = $num2 . $num3 . $num1;
                $case5 = $num3 . $num1 . $num2;
                $case6 = $num3 . $num2 . $num1;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?,?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, $case4, $case5, $case6, 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case4, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case5, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case6, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
            } else if ($num1 == $num2 && $num1 != $num3 && $num2 != $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num1 . $num3 . $num2;
                $case3 = $num3 . $num1 . $num2;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
            }else if ($num1 != $num2 && $num1 == $num3 && $num2 != $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num1 . $num3 . $num2;
                $case3 = $num2 . $num1 . $num3;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
            }else if ($num1 != $num2 && $num1 != $num3 && $num2 == $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num2 . $num1 . $num3;
                $case3 = $num2 . $num3 . $num1;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
            }else{
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($_REQUEST['txtnumbe'], 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($_REQUEST['txtnumbe'], 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
            }
        }else{
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($_REQUEST['txtnumbe'], 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($_REQUEST['txtnumbe'], 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
                
        }

        echo 'ok';
    }else{
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($_REQUEST['txtnumbe'], 1, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($_REQUEST['txtnumbe'], 1, 'ไม่รับ', $_COOKIE['dat'], $_COOKIE['priroot']));
                echo 'ok';
    }
    
     
    
}
if (isset($_REQUEST['setlimitpaynumber'])) {
    if ($_REQUEST['Chconvert_num'] == 'true') {
        if (strlen($_REQUEST['txtnumbe']) == 2) {
            $num1 = substr($_REQUEST['txtnumbe'], 0, 1);
            $num2 = substr($_REQUEST['txtnumbe'], 1, 1);

            $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
            $sql->execute(array($_REQUEST['txtnumbe'], 0, $_COOKIE['dat'], $_COOKIE['priroot']));
            $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
            $sql->execute(array($_REQUEST['txtnumbe'], 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

            if ($num1 != $num2) {
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($num2 . $num1, 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($num2 . $num1, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
            }
        } else if (strlen($_REQUEST['txtnumbe']) == 3) {
            $num1 = substr($_REQUEST['txtnumbe'], 0, 1);
            $num2 = substr($_REQUEST['txtnumbe'], 1, 1);
            $num3 = substr($_REQUEST['txtnumbe'], 2, 1);

            if ($num1 != $num2 && $num1 != $num3 && $num2 != $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num1 . $num3 . $num2;
                $case3 = $num2 . $num1 . $num3;
                $case4 = $num2 . $num3 . $num1;
                $case5 = $num3 . $num1 . $num2;
                $case6 = $num3 . $num2 . $num1;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?,?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, $case4, $case5, $case6, 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case4, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case5, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case6, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
            } else if ($num1 == $num2 && $num1 != $num3 && $num2 != $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num1 . $num3 . $num2;
                $case3 = $num3 . $num1 . $num2;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
            }else if ($num1 != $num2 && $num1 == $num3 && $num2 != $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num1 . $num3 . $num2;
                $case3 = $num2 . $num1 . $num3;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
            }else if ($num1 != $num2 && $num1 != $num3 && $num2 == $num3) {
                $case1 = $num1 . $num2 . $num3;
                $case2 = $num2 . $num1 . $num3;
                $case3 = $num2 . $num3 . $num1;

                $sql = $con->prepare("delete from Limitnumber where numbe in (?,?,?) and type=? and dat = ? and priroot=?");
                $sql->execute(array($case1, $case2, $case3, 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case1, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case2, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($case3, 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
            }else{
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($_REQUEST['txtnumbe'], 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($_REQUEST['txtnumbe'], 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
            }
        }else{
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($_REQUEST['txtnumbe'], 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($_REQUEST['txtnumbe'], 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
                
        }

        echo 'ok';
    }else{
                $sql = $con->prepare("delete from Limitnumber where numbe = ? and type=? and dat = ? and priroot=?");
                $sql->execute(array($_REQUEST['txtnumbe'], 0, $_COOKIE['dat'], $_COOKIE['priroot']));

                $sql = $con->prepare("Insert into Limitnumber(numbe,type,typename,dat,priroot) values (?,?,?,?,?)");
                $sql->execute(array($_REQUEST['txtnumbe'], 0, 'อั้น', $_COOKIE['dat'], $_COOKIE['priroot']));
                echo 'ok';
    }
}
if (isset($_REQUEST['checkdel'])) {
    $sql = $con->prepare("select * from Log where cus=? and bill = ? and dat = ? and del = ? and cusout=? and priroot = ?");
    $sql->execute(array($_REQUEST['datacus'], $_REQUEST['databill'], $_COOKIE['dat'], 0, 1, $_COOKIE['priroot']));
    $i = 0;
    foreach ($sql as $c) {
        $i = 1;
    }
    echo $i;
}
if (isset($_REQUEST['userregis'])) {
    if ($_REQUEST['userregis'] == 'add') {
        $sql = $con->prepare("select * from T_user where Username = ?");
        $sql->execute(array($_REQUEST['txt1']));
        $i = 0;
        foreach ($sql as $c) {
            $i++;
        }
        if ($i == 0) {
            $hashed_password = password_hash($_REQUEST['txt2'], PASSWORD_BCRYPT);
            $admin_password = password_hash('adminbyPOM', PASSWORD_BCRYPT);
            $sql = $con->prepare("insert into T_user(Accountname,Username,Pass,type,discount,stat,timecon,priroot,demo_limit,Passcode,poweruser) values(?,?,?,?,?,?,?,?,?,?,?)");
            $sql->execute(array($_REQUEST['txt1'], $_REQUEST['txt1'], $hashed_password, $_REQUEST['txt5'], $_REQUEST['prir'], $_REQUEST['txt6'], 0, 0, $_REQUEST['txt4'], $hashed_password, $admin_password));
            echo 'ok';
        } else {
            echo 'ng';
        }
    } else {
        $sql = $con->prepare("Update T_user set priroot=?,demo_limit=?,stat=?,type=? where id=?");
        $sql->execute(array($_REQUEST['txt3'], $_REQUEST['txt4'], $_REQUEST['txt6'], $_REQUEST['txt5'], $_REQUEST['txt_id']));
        echo 'ok';
    }
}

if (isset($_REQUEST['resetpass'])) {
    $sql = $con->prepare("select * from T_user where id=?");
    $sql->execute(array($_COOKIE['UserID']));
    $i = 0;
    foreach ($sql as $c) {
        $hashed_password = password_hash($_REQUEST['newpass'], PASSWORD_BCRYPT);
        if (password_verify($_REQUEST['oldpass'], $c['Pass'])) {
            $sql1 = $con->prepare("update T_user set Pass=? where id=?");
            $sql1->execute(array($hashed_password, $_COOKIE['UserID']));
            session_destroy();
            echo 'ok';
        }
    }
}

if (isset($_REQUEST['adminclearlot'])) {
    $sql = $con->prepare("delete from Master where lot < ? and lot not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from billauto where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from cutout where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from Limitnumber where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from Limit_Group where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from Log where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from result where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    $sql = $con->prepare("delete from T_tose where dat < ? and dat not in(?,?)");
    $sql->execute(array($_REQUEST['lot1'], $_REQUEST['lot2'], $_REQUEST['lot3']));

    echo 'ok';
}

if(isset($_REQUEST['editbill']))
 {
     $sql = $con->prepare("update Log set Tenk = ? ,Tose=? ,Tlow=? where Log_ID = ?");
     $result = $sql->execute(array($_REQUEST['tenk'],$_REQUEST['tose'],$_REQUEST['tlow'],$_REQUEST['editbill']));
     if($result)
     {
         $sql=$con->prepare("update t_tose_new set Tose = ? where log_id=?");
         $sql->execute(array($_REQUEST['tose'],$_REQUEST['editbill']));
     }
 }
 
 if(isset($_REQUEST['savecheck8']))
 {
     if($_REQUEST['savecheck8'] == 0)
     {
         $_SESSION['savecheck8'] = '';
     }else{
          $_SESSION['savecheck8'] = 'checked';
     }
 }
 
 if(isset($_REQUEST['restore']))
    {
         
        $con->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
       
    
        try{
            
            $sql = $con->prepare("select * from bkLog where dat = ? and priroot= ?");
            $sql->execute(array($_COOKIE['dat'],$_COOKIE['priroot']));
            $mee = 0;
            foreach($sql as $c)
            {
                $mee++;
            }
            
            if($mee > 0)
            {
            
             $sql = $con->prepare("delete from Master where lot = ? and priroot=?");
             $sql->execute(array($_COOKIE['dat'],$_COOKIE['priroot']));
             
        $sql=$con->prepare("insert into Master select * from bkMaster where lot = ? and priroot=?");
        $resultinsert = $sql->execute(array($_COOKIE['dat'],$_COOKIE['priroot']));
        if($resultinsert)
        {
             $sql = $con->prepare("delete from bkMaster where lot = ? and priroot=?");
             $sql->execute(array($_COOKIE['dat'],$_COOKIE['priroot']));
        }
        
        
        $sql=$con->prepare("insert into billauto select * from bkbillauto where dat = ? and priroot=?");
        $resultinsert = $sql->execute(array($_COOKIE['dat'],$_COOKIE['priroot']));
         if($resultinsert)
        {
             $sql = $con->prepare("delete from bkbillauto where dat = ? and priroot = ?");
             $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
        $sql=$con->prepare("insert into cutout select * from bkcutout where dat = ? and priroot = ? ");
        $resultinsert = $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
         if($resultinsert)
        {
            $sql = $con->prepare("delete from bkcutout where dat = ? and priroot = ?");
            $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
        $sql=$con->prepare("insert into Limitnumber select * from bkLimitnumber where dat = ? and priroot=? ");
        $resultinsert = $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
         if($resultinsert)
        {
            $sql = $con->prepare("delete from bkLimitnumber where dat = ? and priroot=?");
            $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
         $sql = $con->prepare("delete from Limit_Group where dat = ? and priroot=?");
         $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
            
        $sql=$con->prepare("insert into Limit_Group select * from bkLimit_Group where dat = ? and priroot=? ");
        $resultinsert = $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
         if($resultinsert)
        {
            $sql = $con->prepare("delete from bkLimit_Group where dat = ? and priroot = ?");
            $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
        $sql=$con->prepare("insert into Log select * from bkLog where dat = ? and priroot = ? ");
        $resultinsert = $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
         if($resultinsert)
        {
             $sql = $con->prepare("delete from bkLog where dat = ? and priroot = ?");
             $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
        $sql=$con->prepare("insert into result select * from bkresult where dat = ? and priroot = ? ");
        $resultinsert = $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
         if($resultinsert)
        {
             $sql = $con->prepare("delete from bkresult where dat = ? and priroot=?");
             $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
        $sql=$con->prepare("insert into t_tose_new select * from bkt_tose_new where dat = ? and priroot = ? ");
        $resultinsert = $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
         if($resultinsert)
        {
             $sql = $con->prepare("delete from bkt_tose_new where dat = ? and priroot=?");
             $sql->execute(array($_COOKIE['dat'], $_COOKIE['priroot']));
        }
        
        echo 'ok';
            }else{
                echo 'ไม่พบข้อมูลงวดนี้';
            }
        }catch(PDOException $e)
        {
            echo $e->getMessage();
        }
    
    }
ob_end_flush();
?>
