<?php
    require("../controller/databaseCon.php");
    session_start();
    if ($_SESSION['login'] == true){
        header("Location: ../view/html/index.php");
      }
    $_SESSION['noID'] = false;
    if (!empty($_POST['loginUsername']) && !empty($_POST['loginPassword'])) {
        $username = $_POST['loginUsername'];
        $password = $_POST['loginPassword'];
        try {
            $stmt = $conn->prepare("SELECT userID, userTypeID, password FROM user WHERE username=:user");
            $stmt->bindParam(':user', $username);
            $stmt->execute();
            $loginResult = $stmt->fetch();
           
            if($password == $loginResult['password']){
                $_SESSION["username"] = $username;
                $_SESSION["login"]    = true;
                $userID = $loginResult['userID'];
                $_SESSION["userID"] = $userID;
                $_SESSION["userTypeID"] = $loginResult['userTypeID'];
                header("Location: ../view/html/index.php");
            } else{
                $_SESSION["loginIncorrect"] = true;
                header("Location: ../view/html/login.php");
            }
            
        }
        catch (PDOException $e) {
            $e->getMessage();
            die();
        }
    } else {
	$_SESSION["loginIncorrect"] = true;
        header("Location: ../view/html/login.php");
    }
?>