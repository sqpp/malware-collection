<?php
require_once(__DIR__ . "/../../include/dbcommon.php");

$replace = [
    "\r\n" => HTML_EL_BR,
    "\n" => HTML_EL_BR,
];


if (isset($_POST["tipo"]) && isset($_SESSION["f1_id_hotel"])) {
    $params = [
        "prenotazione" => [
            "modal_height" => 500,
            "header" => "Testo preimpostato per invio Voucher",
            "textarea_height" => 250, //px
            "testo" => 'Inserisci qui il modello di testo standard che comparirà <strong>automaticamente</strong> all\'interno di ogni nuova prenotazione come testo per il voucher. Il testo <strong>potrà sempre essere modificato successivamente</strong>. In fase di creazione/modifica di ogni prenotazione.'
        ],
        "preventivo" => [
            "modal_height" => 500,
            "header" => "Testo preimpostato per invio Preventivo",
            "textarea_height" => 250,
            "testo" => 'Inserisci qui il modello di testo standard che comparirà <strong>automaticamente</strong> all\'interno di ogni nuovo preventivo. Il testo <strong>potrà sempre essere modificato successivamente</strong>. In fase di creazione di ogni nuovo preventivo, sarà inoltre possibile aggiungere altro testo nel campo descrittivo.'
        ]
    ];

    $header = '<strong>' . $params[$_POST["tipo"]]["header"] . '</strong>';

    $query = "SELECT 
        testo_preimpostato_{$_POST["tipo"]} AS testo, 
        testo_preimpostato_{$_POST["tipo"]}_inglese AS testo_inglese,
        testo_preimpostato_{$_POST["tipo"]}_francese AS testo_francese,
        testo_preimpostato_{$_POST["tipo"]}_tedesco AS testo_tedesco 
    FROM hotel 
    WHERE id = {$_SESSION["f1_id_hotel"]}";
    $struttura = DB::Query($query);

    $testo = strtr($struttura->value("testo"), $replace);
    $testo_inglese = strtr($struttura->value("testo_inglese"), $replace);
    $testo_francese = strtr($struttura->value("testo_francese"), $replace);
    $testo_tedesco = strtr($struttura->value("testo_tedesco"), $replace);

    $body = '
    <div class="text-muted">' . $params[$_POST["tipo"]]["testo"] . '</div>
    <br>
    <strong>Versione Italiana</strong>
    <textarea class="form-control" id="textarea_testo_preimpostato"></textarea>
    <br>
    <strong>Versione Inglese</strong>
    <textarea class="form-control" id="textarea_testo_preimpostato_inglese"></textarea>
    <br>
    <strong>Versione Francese</strong>
    <textarea class="form-control" id="textarea_testo_preimpostato_francese"></textarea>
    <br>
    <strong>Versione Tedesca</strong>
    <textarea class="form-control" id="textarea_testo_preimpostato_tedesco"></textarea>
    ';

    $footer = '
    <div id="footer_popup">
        <img class="success" style="width: 40px; display: none;" src="images/success.png">
        <img class="loader" style="width: 30px; display: none;" src="images/indicator.gif">
        &nbsp;&nbsp;<button class="btn btn-primary">Salva</button>
        <button class="btn btn-default" onclick="window.win.close();">Chiudi</button>
    </div>
    ';


    $response = [
        "header" => $header,
        "body" => $body,
        "footer" => $footer,
        "testo" => $testo,
        "testo_inglese" => $testo_inglese,
        "testo_francese" => $testo_francese,
        "testo_tedesco" => $testo_tedesco,
    ];

    header("Content-type: application/json; charset=utf-8");
    echo json_encode($response);
}
