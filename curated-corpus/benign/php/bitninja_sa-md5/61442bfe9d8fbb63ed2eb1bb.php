<?php

if (isset($_POST['token']) && $_POST['token']) {
    require('config.php');
    $data = array('response' => $_POST['token'], 'secret' => $config['recaptcha_key']);
    if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR']) {
        $data['remoteip'] = $_SERVER['REMOTE_ADDR'];
    }
    $ch = curl_init();
    $url = 'https://www.google.com/recaptcha/api/siteverify';
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));
    $result = curl_exec ($ch);
    curl_close ($ch);

    $result = json_decode($result);
    if ($result && isset($result->success) && $result->success) {
        echo 'ok';
    }
}
