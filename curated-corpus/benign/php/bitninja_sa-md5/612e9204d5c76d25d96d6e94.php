<?php
	// set_time_limit(120);
	header("Content-Type: text/html; charset=UTF-8");

	include("../defines.php");
	include("../framework/FrameWork.php");
	
	$filename="termek_export.csv";
	
	if(isset($_FILES["import"]) && $_FILES["import"]['name']!='') {
		move_uploaded_file($_FILES["import"]['tmp_name'], $filename);
	}
	
	if (($handle = fopen($filename, "r")) !== false){
	
		while (($v = fgetcsv($handle, 2000, ";")) !== false) {
		
			$res=main_query("select termekkod from ".db_fix."termek where termekkod='".texttodb($v[1])."' limit 1");
			if (main_row_number($res)>0){
				main_query("
					update ".db_fix."termek set
						kod='".$v[0]."',
						cikkszam='".texttodb($v[2])."',
						nev='".texttodb($v[3])."',
						raktar='".$v[4]."',
						szabadraktar='".$v[5]."',
						mee='".texttodb($v[6])."',
						afakulcs='".$v[7]."',
						ar1='".round($v[8]*1.25)."', 
						ar2='".round($v[9]*1.25)."',
						ar3='".round($v[10]*1.25)."',
						ar4='".round($v[11]*1.25)."',
						netto_ar1='".$v[8]."',
						netto_ar2='".$v[9]."',
						netto_ar3='".$v[10]."',
						netto_ar4='".$v[11]."',
						fkat1='".texttodb($v[12])."',
						kat1='".texttodb($v[13])."',
						fkat2='".texttodb($v[14])."',
						kat2='".texttodb($v[15])."',
						fkat3='".texttodb($v[16])."',
						kat3='".texttodb($v[17])."',
						aktiv='".(($v[18]==1 || $v[5]<1)?0:1)."'
					where 
						termekkod='".texttodb($v[1])."'
				");
			}
			else {
				main_query("
					insert into ".db_fix."termek (
						kod, 
						termekkod, 
						cikkszam, 
						nev, 
						raktar, 
						szabadraktar, 
						mee, 
						afakulcs, 
						ar1, 
						ar2, 
						ar3, 
						ar4, 
						netto_ar1, 
						netto_ar2, 
						netto_ar3, 
						netto_ar4, 
						fkat1, 
						kat1, 
						fkat2, 
						kat2, 
						fkat3, 
						kat3, 
						aktiv
					) values (
						'".texttodb($v[0])."', 
						'".$v[1]."', 
						'".texttodb($v[2])."', 
						'".texttodb($v[3])."', 
						'".$v[4]."', 
						'".$v[5]."', 
						'".texttodb($v[6])."', 
						'".$v[7]."', 
						'".round($v[8]*1.25)."', 
						'".round($v[9]*1.25)."', 
						'".round($v[10]*1.25)."', 
						'".round($v[11]*1.25)."', 
						'".$v[8]."', '".$v[9]."', 
						'".$v[10]."', 
						'".$v[11]."', 
						'".texttodb($v[12])."', 
						'".texttodb($v[13])."', 
						'".texttodb($v[14])."', 
						'".texttodb($v[15])."', 
						'".texttodb($v[16])."', 
						'".texttodb($v[17])."', 
						'".(($v[18]==1)?0:1)."'
					)
				");
			}
		} 
		
	}
	
?>