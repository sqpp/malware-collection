<?php
include('../configuracion.php');
$comuna = isset($_POST['comuna']) ? $_POST['comuna'] : NULL;
$alto = isset($_POST['alto']) ? $_POST['alto'] : 10;
$ancho = isset($_POST['ancho']) ? $_POST['ancho'] : 10;
$largo = isset($_POST['largo']) ? $_POST['largo'] : 10;
$peso = isset($_POST['peso']) ? $_POST['peso'] : 1;

$id_shipit = $db->getvar('comunas_shipit','id_shipit',"id_comuna='$comuna'");
$to_commune_id = $id_shipit;




$sendpost = array(
  "parcel"=>array(
    "length"=>$largo,
    "width"=>$ancho,
    "height"=>$alto,
    "weight"=>$peso,
    "origin_id"=>308,
    "destiny_id"=>$to_commune_id,
    "type_of_destiny"=>"domicilio",
    "algorithm"=>"1",
    "algorithm_days"=>"2"
  ));




$payload = json_encode($sendpost);


$curl = curl_init();

curl_setopt_array($curl, array(
  CURLOPT_URL => "https://api.shipit.cl/v/rates",
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => "",
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 0,
  CURLOPT_FOLLOWLOCATION => true,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => "POST",
  CURLOPT_POSTFIELDS =>$payload,
  CURLOPT_HTTPHEADER => array(
    "Content-Type: application/json",
    "Accept: application/vnd.shipit.v4",
    "X-Shipit-Email: ventas@csdcolocolo.cl",
    "X-Shipit-Access-Token: iFiAtuxsZujmhwzBS-na",
    "Content-Type: text/plain"
  ),
));

$response = curl_exec($curl);

curl_close($curl);
//echo $response;

$someArray =  json_decode($response,true);
$stocklist = $someArray["prices"];

$retorno = Array();
/*
foreach($stocklist as $k => $v){

	array_push($retorno,array("original_courier"=>$stocklist[$k]["original_courier"],"price"=>$stocklist[$k]["price"],"days"=>$stocklist[$k]["days"]));
}



*/

//echo json_encode($retorno);


//print_r($stocklist);


?>

<table class="table">
<tr>
<td colspan="5" class="text-left"><i class="fa fa-exclamation-circle mr-md"></i>Debido a la contingencia actual producto del Covid-19 y la repercusión que tiene en las labores de CSD Colo Colo y operadores asociados, queremos informar que los tiempos de despacho informados pueden verse retrasados. Agradecemos la comprensión y paciencia</td>
</tr>
<tr>
<th colspan="2">Seleccione Empresa para despacho</th>
<th class="text-center logo-empresa-shipit">Empresa</th>
<th class="text-center">Días Hábiles Aprox.</th>
<th class="text-center">Valor.</th>
</tr>

<?php foreach($stocklist as $k => $v){?>

<tr>
<td><input name="courier_for_client" value="<?php echo $stocklist[$k]["original_courier"]?>" type="radio" class="form-control courier_for_client" data-token="<?php echo funcion::encriptar($stocklist[$k]["price"])?>" data-price="<?php echo $stocklist[$k]["price"]?>" style="min-width: 10px;"></td>
<td class="logo-empresa-shipit"><img src="https://app.shipit.cl/static/couriers_logo/<?php echo $stocklist[$k]["original_courier"]?>.png" height="auto" style="max-width: 100px;" class="laimagenship"/></td>
<td><?php echo $stocklist[$k]["original_courier"]?></td>
<td><?php echo $stocklist[$k]["days"]+4?></td>
<td>$<?php echo funcion::formatoPrecio($stocklist[$k]["price"])?></td>
</tr>
<?php }?>
</table>