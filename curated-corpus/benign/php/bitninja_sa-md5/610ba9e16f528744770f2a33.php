<?php 

$email = $_POST['email'];
$phone = $_POST['phone'];
$nome = $_POST['nome'];
$valore = $_POST['valore'] ;

if($valore == "true")
{
     $email = $_POST['email'];
     $phone = $_POST['phone'];
     $nome = $_POST['nome'];
     if(isset($nome) && isset($phone) && isset($email))
     {
        AddContact($nome, $phone, $email);
     }
   
}
if($valore == "false")
{

    if(isset($email))
    {
       RemoveContact($email);
    }
   

}




function AddContact($nome, $telefono, $email ){
    $curl = curl_init();

   curl_setopt_array($curl, [
     CURLOPT_URL => "https://api.sendinblue.com/v3/contacts",
     CURLOPT_RETURNTRANSFER => true,
     CURLOPT_ENCODING => "",
     CURLOPT_MAXREDIRS => 10,
     CURLOPT_TIMEOUT => 30,
     CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
     CURLOPT_CUSTOMREQUEST => "POST",
     CURLOPT_POSTFIELDS => "{\"attributes\":{\"nome\":\"" . $nome .  "\",\"email\":\"" . $email . "\",\"tel\":\"" . $telefono . "\"},\"listIds\":[16],\"updateEnabled\":false, \"email\":\"" . $email . "\"}",
     CURLOPT_HTTPHEADER => [
       "Accept: application/json",
       "Content-Type: application/json",
       "api-key: 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"
     ],
   ]);
   
   $response = curl_exec($curl);
   $err = curl_error($curl);
   
   curl_close($curl);
   
   if ($err) {
     //echo "cURL Error #:" . $err;
     $file = fopen("data.txt","w");
     fwrite($file, $err);
     
   } else {
    $file = fopen("data.txt","w");
    fwrite($file, $response);
    //echo $response;
   }
   }
   
   function RemoveContact($email)
   {
   $curl = curl_init();
   $ris = str_replace( "@", "%40", $email);

   curl_setopt_array($curl, [
     CURLOPT_URL => "https://api.sendinblue.com/v3/contacts/" . $ris . "",
     CURLOPT_RETURNTRANSFER => true,
     CURLOPT_ENCODING => "",
     CURLOPT_MAXREDIRS => 10,
     CURLOPT_TIMEOUT => 30,
     CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
     CURLOPT_CUSTOMREQUEST => "DELETE",
     CURLOPT_HTTPHEADER => [
       "Accept: application/json",
       "api-key: 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"
     ],
   ]);
   
   $response = curl_exec($curl);
   $err = curl_error($curl);
   
   curl_close($curl);
   
   if ($err) {
     $file = fopen("data.txt","w");
     fwrite($file, $email);
     echo "cURL Error #:" . $ris;
   } else {
     echo $response;
   }
   }
   


?>