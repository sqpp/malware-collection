<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Blog;
use Carbon\Carbon;

class PostsController extends Controller
{

    public function ShowPosts()
    {
        return view('web.blog-posts');
    }


    public function SavePost(Request $request)
    {
        if ($request->hasFile('picture')) {
            //get file name with extension
            $filenameWithExt = $request->file('picture')->getClientOriginalName();

            //get just filename
            $filename = pathinfo($filenameWithExt, PATHINFO_FILENAME);

            //Get Just Ext
            $extension = $request->file('picture')->getClientOriginalExtension();

            //filename tostore
            $fileNameToStore = $filename . '_' . time() . '.' . $extension;


            //upload video
            $path = $request->file('picture')->storeAs('public/blog', $fileNameToStore);
        }




        //Get first bottom picture
        if ($request->hasFile('picture_2')) {
            //get file name with extension
            $picture_2_filenameWithExt = $request->file('picture_2')->getClientOriginalName();

            //get just filename
            $picture_2_filename = pathinfo($picture_2_filenameWithExt, PATHINFO_FILENAME);

            //Get Just Ext
            $picture_2_extension = $request->file('picture_2')->getClientOriginalExtension();

            //filename tostore
            $picture_2_fileNameToStore = $picture_2_filename . '_' . time() . '.' . $picture_2_extension;


            //upload video
            $picture_2_path = $request->file('picture_2')->storeAs('public/blog', $picture_2_fileNameToStore);
        } else {
            $picture_2_fileNameToStore = '';
        }



        //store from the form
        $post = new Blog();
        $post->title = $request->input('title');
        $post->date = $request->input('date');
        $post->description = $request->input('body');
        $post->top_image = $fileNameToStore;
        $post->bottom_image = $picture_2_fileNameToStore;


        $post->save();

        return back();
    }


    //Retrieve List ostudents
    public function GetAllPosts()
    {

        $data = Blog::orderBy('id', 'desc')->get();

        $post = array('posts' => array());
        for ($i = 0; $i < count($data); $i++) {
            $post['posts'][] = array(
                'id' => $data[$i]['id'],
                'title' => $data[$i]['title'],
                'body' => $data[$i]['description'],
                'top_image' => $data[$i]['top_image'],
                'bottom_image' => $data[$i]['bottom_image'],
                'date' =>  $data[$i]['date']
            );
        }
        return $post;
    }






    //Delete Post
    function DeletePost(Request $request)
    {
        $post = Blog::findOrFail($request->id);
        try {
            $post->delete();
            $response['success'] = true;
            $response['message'] = 'Post deleted successfully.';
        } catch (\Exception $e) {
            $response['success'] = false;
            $response['message'] = $e->getMessage();
        }

        return $response;
    }
}
