<?php
require_once "commoncode.php";
$response = array();
//If all required Prameters are not passed
$chkParams = chkParamsPassed(array("uid", "api_key"));
// $chkParams = chkParamsPassed(array("name", "country_code", "contact_number", "device_token", "device_type"));
if(startsWith($chkParams, "false.missing.")){
    $response["success"] = false;
    $missing_param = str_replace("false.missing.", "", $chkParams);
    $response["message"] = "error. Required parameters are not available! (Parameter '" . $missing_param . "' missing)";
    echo json_encode($response, JSON_PRETTY_PRINT);
    die();
}
if ($_POST['api_key'] != $api_key ) {
    $response["success"] = false;
    $missing_param = str_replace("false.missing.", "", $chkParams);
    $response["message"] = "error. Unauthorized access to Server Detected!";
    echo json_encode($response, JSON_PRETTY_PRINT);
    die();
}

$uid = $_POST['uid'];
// $student_id = $_POST['student_id'];

$database = getDbInstance($uid);
if ($database === 0) {
    $response["success"] = false;
    $response["message"] = "error. Invalid UID!";
    echo json_encode($response, JSON_PRETTY_PRINT);
    die();
}

#region Get About School Info
$recs = $database -> select("settings", [
        "strType(type)", "strContent(content)"
    ], [
        "strType" => ["strAboutInfoMobApp", "strAppHeaderImgExt"],
        "ORDER" => ["strType" => "ASC"]
        // "LIMIT" => 2
]);
// echo $database -> last();
$cnt = count($recs);
// echo $cnt;

$about_info = "";
$app_header_img = "";

if ($cnt > 0) {
    for ($i=0; $i < $cnt; $i++) { 
        if ($recs[$i]['type'] == "strAboutInfoMobApp") {
            $about_info = $recs[$i]['content'];
        }
        else if ($recs[$i]['type'] == "strAppHeaderImgExt") {
            $app_header_img = $recs[$i]['content'];
        }
    }
    $app_header_img = "http://login.eacademics.in/data/images/app_header_imgs/" . $uid . "." . $app_header_img;
    $response["success"] = true;
    $response["message"] = "success. Data loaded";
    $response["data"] = array(
        "about_info" => $about_info,
        "app_header_img" => $app_header_img
    );
}
else{
    $response["success"] = true;
    $response["message"] = "success. No data!";
}
echo json_encode($response, JSON_PRETTY_PRINT);
#endregion
?>