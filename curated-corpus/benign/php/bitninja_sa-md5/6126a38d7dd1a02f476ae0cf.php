<?php require_once 'connection.php';
global $objAdmin;
class Admin  extends Connection
{

	public function AddAlumitni(){ extract($_REQUEST); 
		$firstname=$this->clean('firstname');
		$lastname=$this->clean('lastname');
		$mobileno=$this->clean('mobileno');
		$mobileno_alt=$this->clean('mobileno_alt');
		$gender=$this->clean('gender');
		$dob=str_replace("/","-",$dob);
		$dob=date("Y-m-d",strtotime($dob));
		$emailid=$this->clean('emailid');
		$marital_status=$this->clean('marital_status');
		$present_address=$this->clean('present_address');
		$permanent_address=$this->clean('permanent_address');
		$register_no=$this->clean('register_no');
		$course=$this->clean('course');
		$year_from=$this->clean('year_from');
		$year_to=$this->clean('year_to');
		$job=$this->clean('job');

		$qry="";

		$destinationpath=DIR_ALUMINI;
		if(isset($_FILES['image_path']) && $_FILES['image_path']['name']!=""){
				$rnd=rand(999,10000);
				$image_path =$rnd."_".basename($_FILES['image_path']['name']);
				$targetpath=$destinationpath.$image_path;
				$res=move_uploaded_file($_FILES['image_path']['tmp_name'],$targetpath);			
				$qry.=",image_path='".$image_path."'";
		}

		if($job=='1'){
			$job='Employed';
			$emp_company_name=$this->clean('emp_company_name');
			$emp_designation=$this->clean('emp_designation');
			$emp_department=$this->clean('emp_department');
			$emp_mobileno=$this->clean('emp_mobileno');
			$emp_address=$this->clean('emp_address');
			$qry.=" ,emp_company_name='".$emp_company_name."', emp_designation='".$emp_designation."', emp_department='".$emp_department."', emp_mobileno='".$emp_mobileno."', emp_address='".$emp_address."'";
		} else if($job=='2'){
			$job='Business';
			$business_name=$this->clean('business_name');
			$business_mobile=$this->clean('business_mobile');
			$business_address=$this->clean('business_address');
			$qry.=" ,business_name='".$business_name."', business_mobile='".$business_mobile."', business_address='".$business_address."'";
		} else if($job=='3'){
			$job='Higher Studies';
			$college_name=$this->clean('college_name');
			$course_name=$this->clean('course_name');
			$emp_department=$this->clean('emp_department');
			$emp_mobileno=$this->clean('emp_mobileno');
			$emp_address=$this->clean('emp_address');
			$qry.=" ,college_name='".$college_name."', course_name='".$course_name."', hod_name='".$hod_name."'";
		} else if($job=='4'){
			$job='Unemployed';
			$remarks=$this->clean('remarks');
			$emp_designation=$this->clean('emp_designation');
			$emp_department=$this->clean('emp_department');
			$emp_mobileno=$this->clean('emp_mobileno');
			$emp_address=$this->clean('emp_address');
			$qry.=" ,remarks='".$remarks."'";
		}
		mysqli_query($this->connection, "insert into alumini set firstname='".$firstname."', lastname='".$lastname."', mobileno='".$mobileno."', mobileno_alt='".$mobileno_alt."', gender='".$gender."', dob='".$dob."', emailid='".$emailid."', marital_status='".$marital_status."', present_address='".$present_address."', permanent_address='".$permanent_address."', register_no='".$register_no."', course='".$course."', year_from='".$year_from."', year_to='".$year_to."', job='".$job."', posted_date='".date("Y-m-d H:i:s")."'".$qry);
		$id=mysqli_insert_id($this->connection);
		$i=0;
		foreach($mname as $member){
			mysqli_query($this->connection, "insert into alumini_family set mname='".$mname[$i]."', relationship='".$relationship[$i]."', dob='".date("Y-m-d H:i:s",strtotime($fdob[$i]))."', marriage_date='".date("Y-m-d H:i:s",strtotime($marriage_date[$i]))."', alumini_id='".$id."'");
			$i++;
		}
		mysqli_query($this->connection, "insert into alumini_feedback set alumini_id='".$id."', question_1='".$question_1."', question_2='".$question_2."', question_3='".$question_3."', question_4='".$question_4."', question_5='".$question_5."', question_6='".$question_6."', question_7='".$question_7."', question_8='".$question_8."', question_9='".$question_9."', question_10='".$question_10."', question_11='".$question_11."',question_12='".$question_12."'");
		header("location:http://tsatamilcas.edu.in/alumni-registration.php?msg=success");
	}

	public function clean($str) {
		$str = @$_POST[$str];
		$str = @trim($str);
		if(get_magic_quotes_gpc()) {
			$str = stripslashes($str);
		}
		return mysqli_real_escape_string($this->connection,$str);
	}
	
}
$objAdmin = new Admin();
$objAdmin->AddAlumitni();

?>