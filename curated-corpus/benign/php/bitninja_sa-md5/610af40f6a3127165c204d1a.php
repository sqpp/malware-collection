<?php
require_once('dbconnection.php');
if(isset($_SESSION['user_id'])=='')
 {
   header("Location:login.php");
 } 
$id = $_GET['id'];
$venture_title = $_GET['venture_title'];

$sql = "SELECT * FROM v_gallery WHERE id=$id";
$result_set =$conn->query($sql)->fetch(PDO::FETCH_ASSOC);
// print_r($project_id);
// print_r($id);
if($_SERVER['REQUEST_METHOD'] == 'POST')
{
	extract($_POST);
	$title = $_POST['title'];
	$updateddate = date('Y-m-d');
	 $filename  = $_FILES['image']['name'];
   // $image = $_FILES['image']['name'];
   $image  = basename($_FILES['image']['name']);
   $file_size = $_FILES['image']['size'];
   $file_tmp  = $_FILES['image']['tmp_name'];
   $file_ext= pathinfo($image, PATHINFO_EXTENSION);
   $extension  = array("jpeg","jpg","png");
   $image= time()."_".$image;  
   move_uploaded_file($file_tmp,"uploads/".$image);
   $mi='';
   $image_upload='';
   $old_image;

   if(isset($image) && $image!=='')
	    {
	        $mi =$image;
	    }


	if($_FILES['image']['name']=='')
   {
      // print_r($old_image);
      $image_upload = $old_image;
      // echo "image_upload:$image_upload";
      echo ($image_upload);
   }
   else{
      $image_upload = $mi;
      // echo "im:$image_upload";
   }
    echo $sql = "UPDATE v_gallery SET `image`='$image_upload',`title`='$title',
   updated_at='$updateddate' WHERE id='$id'";
    $statement = $conn->prepare($sql);
                  
               if ($statement->execute() === TRUE)
               {
                        $_SESSION['message']= "updated successfully";
                        header("Location:v_gallery_table.php?venture_title=$venture_title");
                        die();
               } 
                     
             
         
          else
          {
               
            echo "message";
            
          }

}

?>
<?php include 'includes/header.php'; ?>
<section>
   <div class="container-fluid">
      
      <div class="row justify-content-center">
         <div class="col-md-10">

            <div class="card mb-12">
                <div><a class="btn btn-outline-secondary" style="margin-left:90%;margin-top:13px;background-color:#132151;color: white;border-radius: 15px  15px;" href="v_gallery_table.php?venture_title=<?=$venture_title?>"><i class="fal fa-chevron-left mr-1"></i>Back</a>
                  <div class="card-header">Add Gallery Details</div>
               <div class="card-body">
                  <form action="" method="post" enctype="multipart/form-data">
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Title</label>
                              <!-- <input type="hidden" class="form-control" name="project_id"> -->
                              <input type="hidden" name="old_image" value="<?php echo $result_set['image'];?>">
                              <input type="text" class="form-control" name="title" placeholder="Title comes here" value="<?php echo $result_set['title'];?>"  >
                           </div>
                        </div>
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Image</label>
                              <img style="width:80px;height:80px;" src="uploads/<?php echo $result_set["image"];?>">
                              <input type="file" name="image" class="form-control" id="filename" onchange="check_image_type_and_size(this.id);" >
                              <label><i>Note: file size should be(470*315) and 
                                          file Extension should be(jpg,jpeg,png)</i>
                              </label>
                           </div>
                        </div>
                        <div class="col-12">
                           <button type="reset" class="btn btn-secondary">Reset</button>
                           <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                     </div>
                  </form>
               </div>
           </div>
      </div>
   </div>
</section>

<?php include 'includes/footer.php'; ?>
