<?php
    //ini_set("display_errors", "off");
    //this turns off sql errors
    //php code at the bottom of index page
    require("../controller/databaseCon.php");
    session_start();
        if(!empty($_POST) && isset($_FILES['imageUpload']) )
        {
            $userID = $_SESSION['userID'];
            $category = $_POST['category'];
            $itemName = $_POST['itemName'];
            $quantity = $_POST['quantity'];
            $totalPrice = $_POST['totalPrice'];
            $itemDesc = $_POST['itemDesc'];
            $itemAddress = $_POST['address'];
            
            if($_FILES['imageUpload']['size'] == 0){
                $image = "noImage.png";
            } else {
                $date = date_create();
                $timestamp = date_timestamp_get($date);
                //This chunk of code renames the image to add the date_timestamp_get to the end of name
                //But before extension so that it doesn't override other images with the same name
                $name = $_FILES['imageUpload']['name'];
                //end explode code found on stackoverflow
                $ext = end((explode(".", $name)));
                //pathinfo found on stackoverflow
                $filename = pathinfo($_FILES['imageUpload']['name'], PATHINFO_FILENAME);
                move_uploaded_file($_FILES['imageUpload']['tmp_name'], "../view/images/" . $_FILES['imageUpload'][''] . $timestamp . $filename . '.' . $ext);
                $image = $_FILES['imageUpload'][''] . $timestamp . $filename . '.' . $ext;
                sleep(1);
            }
            
            try{
                $sql = "INSERT INTO pendingProducts(userID, categoryID, itemName, itemQuantity, totalPrice, itemDesc, itemAddress, itemImage) VALUES (:userID, :category, :itemName, :quantity, :totalPrice, :itemDesc, :itemAddress, :itemImage)";
                $stmt = $conn->prepare($sql);
                $stmt->bindValue(':userID', $userID);
                $stmt->bindValue(':category', $category);
                $stmt->bindValue(':itemName', $itemName);
                $stmt->bindValue(':quantity', $quantity);
                $stmt->bindValue(':totalPrice', $totalPrice);
                $stmt->bindValue(':itemDesc', $itemDesc);
                $stmt->bindValue(':itemAddress', $itemAddress);
                $stmt->bindValue(':itemImage', $image);
                $result = $stmt->execute();

                header("Location: ../view/html/index.php");
            }
                catch(PDOException $e){
                    $e->getMessage();
                    die();
        }
    }
?>