<?php 
ob_start();
include 'includes/db_connect.php';
 if(isset($_POST['save']))
{
 $j = 0;     
	$target_path = "images/";     
	for ($i = 0; $i < count($_FILES['file']['name']); $i++) {  
		$ext = explode('.', basename($_FILES['file']['name'][$i]));   
		$target_path = $target_path  . md5(uniqid()) ."." . $ext[count($ext) - 1].",";  
		//$target_path1 = $target_path  . md5(uniqid()) ."." . $ext[count($ext) - 1];
		$j = $j + 1;  
		if($j>0){
		    $ext = explode(',',$target_path);
		    $ext11=rtrim($ext1[$i], ",");
		    $upload= "images/".$ext11;  
		    if (move_uploaded_file($_FILES['file']['tmp_name'][$i], $upload)) {
		  } 
		}
		    if (move_uploaded_file($_FILES['file']['tmp_name'][$i], $target_path)) {
		}
}
        $title=addslashes($_POST['title']);
				$description=addslashes($_POST['description']);
				$dat=$_POST['dat'];
				$tit=$_POST['imgtitle'];
				$imgtitle= implode(",",$tit);
	
			 $sql=mysql_query("insert into news set title = '$title',description_title='',description='$description',dat='$dat',image = '$target_path',imagetitle='$imgtitle' " );
				
				 if (!$sql)
					{
						die('Invalid query: ' . mysql_error());
			 		}

				header('Location:viewnews.php');
					
		}
?>
<?php require('includes/header.php'); ?>
<input type="hidden" name="imagepath" id="imgpath">
<form action='' method='post' enctype="multipart/form-data">
     
     <table width="100%"  border="0" style="border:1px solid red;" cellspacing="1" cellpadding="3" bgcolor="#FFFFFF">
			<tr>
        	 	<td class="head_2"  align="Right" bgcolor="#FFFFFF" colspan="2"> 
					<table width="100%"  border="0" cellspacing="1" cellpadding="3" bgcolor="#E5E5E5">
						<tr>
							<td class="head_1" colspan="2" align="left" >&nbsp;</td>
							<td class="head_1" colspan="2" align="center" >Add News</td>
							<td class="head_1" colspan="2" align="right">&nbsp;</td>
						</tr>
				</table>
			</td>
	  </tr>
	   <tr>
	  <td class="head_2" align="left" valign="top">
		<b>News Title: </b>    	  </td>
	  <td  align="left">
		  <input type="text" name="title" class="input_stl" style="width:295px;"   >           </td>
   </tr>
	<tr>
	  <td height="17" class="head_2" align="left" valign="top">
		<b>News Date: </b>    	  </td>
	  <td  align="left">
		  <input type="date" name="dat" class="input_stl" style="width:295px;" value="<?php echo date("Y-m-d");?>" >           </td>
   </tr>
   
   <tr>
	  <td class="head_2" align="left" valign="top">
		<b>Description</b>    	  </td>
	  <td  align="left">
		  <?php  
			/*   $oFCKeditor = new FCKeditor('page_content'); // the variable which will use in storing data
			   $oFCKeditor->BasePath = FCK_ED_PATH;  //path for the editor
			   $finalmsg=$temp_header.$edmsg;
			   $oFCKeditor->Value ="$page_content";  // the variable which will use in editing
			   if ( isset($_GET['Lang']) )
			   {
					$oFCKeditor->Config['AutoDetectLanguage']= false ;
					$oFCKeditor->Config['DefaultLanguage']= $_GET['Lang'] ;
			   }
			   else
			   {
					$oFCKeditor->Config['AutoDetectLanguage']= true ;
					$oFCKeditor->Config['DefaultLanguage']='en' ;
				}
			
					$oFCKeditor->Width  = '100%' ;
					$oFCKeditor->Height = '500' ;
					$oFCKeditor->Create() ;*/
					
			?>		
		  <textarea name="description" class="input_stl" style="width:295px;" cols="25" rows="5" ></textarea>   </td>

   </tr>
    <tr>
	  <td class="head_2" align="left" valign="top">
		<b>Select Images: </b>    	  </td>
	  <td  align="left">
	<div id="filediv"><input name="file[]" type="file" id="file"/></div>
	<br><div id="titl">Image Title :<input name="imgtitle[]" type="text" id="imgtitle"/></div><br/>
        <input type="button" id="add_more" class="upload" value="Add More Files"/>
	  </td>
   </tr>
   <tr>
		<td>&nbsp;</td>
	   <td>
		  <table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
			  <td width="8%"> <input type="submit" class="stl_button" name="save" value=" &nbsp;Save " id="upload" class="upload">  </td>
			  <td width="90%" align="left"><input type="submit" class="stl_button" name="cancel" value="Cancel" onClick="javascript:history(-1)"></td>
			</tr>
		  </table>
		</td>
   </tr>
</table>
</form>
<?php require('includes/footer.php'); ?>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
var abc = 0;      // Declaring and defining global increment variable.
$(document).ready(function() {
//  To add new input file field dynamically, on click of "Add More Files" button below function will be executed.
$('#add_more').click(function() {
$(this).before($("<div/>", {
id: 'filediv'
}).fadeIn('slow').append($("<input/>", {
name: 'file[]',
type: 'file',
id: 'file'
}), $("<br/><br/>")));
$(this).before($("<div/>", {
id: 'titl'
}) .fadeIn('slow').append($("<input/>", {
name: 'imgtitle[]',
type: 'text',
id: 'imgtitle'
}), $("<br/><br/>")));
});
// Following function will executes on change event of file input to select different file.
$('body').on('change', '#file', function() {
if (this.files && this.files[0]) {
abc += 1; // Incrementing global variable by 1.
var z = abc - 1;
var x = $(this).parent().find('#previewimg' + z).remove();
$(this).before("<div id='abcd" + abc + "' class='abcd'><img id='previewimg" + abc + "' src=''/></div>");
var reader = new FileReader();
reader.onload = imageIsLoaded;
reader.readAsDataURL(this.files[0]);
$(this).hide();
$("#abcd" + abc).append($("<img/>", {
id: 'img',
src: 'x.png',
alt: 'delete'
}).click(function() {
$(this).parent().parent().remove();
}));
}
});
// To Preview Image
function imageIsLoaded(e) {
$('#previewimg' + abc).attr('src', e.target.result);
};
$('#upload').click(function(e) {
var name = $(":file").val();
});
});
</script>