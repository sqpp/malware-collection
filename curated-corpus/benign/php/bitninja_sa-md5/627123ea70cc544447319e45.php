<?php
session_start();
include('include/connection.php');

?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Believe1st Private Limited</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"/>
  <link rel="stylesheet" href="main.css"/>
</head>
<style type="text/css">

  body{

    padding: 10px;
    background-color: teal;

  }
  h2#swal2-title {
    font-size: 17px;
    padding: 7px;
}
 .form-login{

  max-width: 400px;
  padding: 40px;
  border-radius: 30px;
  background-color: #e9e9e9;
  margin: 0 auto;
  margin-top: 100px;
 } 

 .form-login .form-login-header{

  color: #337ab7;
  text-align: center;

 }

 .form-login .form-login-control{

  position: relative;;
  height: auto;
  box-sizing: border-box;
  padding: 10px;
  font-size: 16px;

 }
 .form-login  input[type="text"]{

margin-bottom: 5px;
border-top-right-radius: 5;
border-top-left-radius: 5;

 }
.form-login  input[type="password"]{

margin-bottom: 10px;
border-top-right-radius: 5px;
border-top-left-radius: 5px;
}
.form-login .forget-password{
text-align: center;
margin-bottom: 0px;
margin-top: 30px;

}
</style>

<body>
  <div class="container">
  <div class="tab-content profile-tab" id="myTabContent">
  <div  class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
    <form class="form-login" action="index.php" method="POST">
      <h2 class="form-login-header">Team Login</h2><br>
      <input type="text"  class="form-control" name="username" value="<?php if(isset($_POST['username'])) echo $_POST['username'] ?>" placeholder="Enter your Email" required=""><br>

      <input type="password" class="form-control" name="password" placeholder="Password" required="">
      <a   id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="true" style="float: right;
                        margin-top: -11px;">Forgot Password</a>
                        <br>
                        <br>
     <center> <button class="btn btn-primary btn-lg btn-block" type="submit" name="login">Login</button></center>
<h4 class="forget-password">
  
</a></h4>
 
    
  </form>
  </div>

  <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <form class="form-login" action="" method="POST">
            
                        <span class="form-group">Please enter registered mobile number</span>

                        <input type="number" class="form-control" value="<?php  if(isset($_POST['number'])) echo $_POST['number'] ?>" name="number" placeholder="Enter your mobile number" required="" style="margin-top:7px">
                        <br><br>
                        <center> <button class="btn btn-primary btn-lg btn-block"  type="submit" name="otp">SEND OTP</button></center>

                        <a href="https://www.believe1st.com/admin/index.php" style="float: right;">Go Back</a>
                    </form>
                </div>
            </div>
        </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="script.js"></script>
</body>
</html>

<?php

if (isset($_POST['login'])) {


$query=mysqli_query($conn,"select * from role where email_id='".$_POST['username']."' and pass=md5('".$_POST['password']."') and Approval='Approved'");


if (mysqli_num_rows($query)>0) {
    
    while($row=mysqli_fetch_array($query)){
    
    $Role=$row['Role'];

  
 $_SESSION['email_id']=$_POST['username'];
  $_SESSION['pass']=md5($_POST['password']);
  
  
  if($Role=='shoper'){
      
        $index='dashboards.php?customer_id';
      
      
  }elseif($Role=='agent'){
      
        $index='dashboards.php?dash';
      
      
      
  }else{
      
        //$index='dashboards.php';
      
       
      
  }
  
    }
  
  echo "
  <script src='//cdn.jsdelivr.net/npm/sweetalert2@10'></script>  
<script type='text/javascript'>
const Toast = Swal.mixin({
  toast: true,
  position: 'top-end',
  showConfirmButton: false,
  timer:2000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

Toast.fire({
 
  icon: 'success',
  title: 'You are login Successfully'
})
</script>";
echo "<script>
var myFunc = function() {
  window.open('$index','_self')
}
window.onload = function() {
  setTimeout(myFunc, 2000);
}
</script>";
}
else{

echo "
  <script src='//cdn.jsdelivr.net/npm/sweetalert2@10'></script>  
<script type='text/javascript'>
const Toast = Swal.mixin({
  toast: true,
  position: 'top-end',
  showConfirmButton: false,
  timer:3000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

Toast.fire({
 
  icon: 'error',
  title: 'something went wrong please try again'
})
</script>";
echo "<script>
var myFunc = function() {

}
window.onload = function() {
  setTimeout(myFunc, 3000);
}
</script>";

}

  }
  
  
?>
<?php 

//Customer forgot password
        if (isset($_POST['otp'])) {
            
            $c_number=$_POST['number'];
            $number=$_POST['number'];

            $sql="select * from role where (mob_no='$c_number')";
            $res=mysqli_query($conn,$sql);
            $row = mysqli_fetch_array($res);
            $custo_id=$row['agent_id'];
            if ($c_number==$row['mob_no']){
                $Otp = rand(1000, 9999);
                $otp_c=md5($Otp);
                $update_otp="UPDATE role SET otp='$otp_c' , is_expired='0' WHERE agent_id='$custo_id'";
                $query=mysqli_query($conn,$update_otp);

                $fields = array(
                    "sender_id" => "BFIRST",
                    "message" => "
                    Dear user,
                    Your verification code is. 
                    Please do not share this
                    
                    Regards,
                    Believe1st private limited.",
                    "variables_values" => "$Otp",
                    "route" => "dlt",
                    "numbers" => "$c_number",
                    "route" => "dlt",
                    "message" => "119710",           
                );
                $curl = curl_init();

                curl_setopt_array($curl, array(
                    CURLOPT_URL => "https://www.fast2sms.com/dev/bulkV2",
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 30,
                    CURLOPT_SSL_VERIFYHOST => 0,
                    CURLOPT_SSL_VERIFYPEER => 0,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "POST",
                    CURLOPT_POSTFIELDS => json_encode($fields),
                    CURLOPT_HTTPHEADER => array(
                        "authorization: wjXBwuRRdQpwmUTlRFNSih9pZZsNOW7ehNHGhRsuvMDlidCYlAETy7Xicc3y",
                        "accept: */*",
                        "cache-control: no-cache",
                        "content-type: application/json"
                    ),
                ));
                $response = curl_exec($curl);
                $err = curl_error($curl);
                curl_close($curl);

                if ($err) {
                
                } else {
                
                }
                echo "<script>window.open('otp.php?no=$number','_self')</script>";

            }else{

                echo "<script src='//cdn.jsdelivr.net/npm/sweetalert2@10'></script>  
                    <script type='text/javascript'>
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer:2000,   timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })
                        Toast.fire({
                            icon: 'info',
                            title: 'You mobile number not registered'
                        })

                    </script>";

                echo "<script>
                        var myFunc = function() {
                        
                        }
                        window.onload = function() {
                            setTimeout(myFunc,3000);
                        }
                    </script>";

            }
        }
    
?>


