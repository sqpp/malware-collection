<?php

header("Content-type: text/html; charset=utf-8");
// Csatlakozás, adatbázis kiválasztása
setlocale(LC_ALL,'hungarian');

include "db.inc";
logincheck();

echo '<center>
<table>
<tr>
<td align="left">';

if ( isset($_POST['submit']) && isset($_FILES['file']))
{
$move = move_uploaded_file($_FILES['file']['tmp_name'], 'product_img/'.basename($_FILES['file']['name']));
echo '<h1>';
echo ($move) ? 'Sikeres' : 'Sikertelen';
echo ' feltöltés!</h1>';
$img2 = "litle_img/".$_FILES['file']['name'];

// Kép átméretezése
$imgdir="product_img/";
$img= $_FILES['file']['name'];
$tndir="litle_img/";
$tndir_med="litle_img_med/";
$tndir_kicsi="litle_img_kicsi/";
$img_uj= $_FILES['file']['name'];
$img_uj_med= $_FILES['file']['name'];
$img_uj_kicsi= $_FILES['file']['name'];
$tn_h="750"; //uj magasság
$tn_h_med="560"; //uj magasság med
$tn_h_kicsi="515"; //uj magasság kicsi

#-+ Beolvassa az átméretezendő file-t
$src_img_src=$imgdir.$img;
$src_img = ImageCreateFromJPEG($src_img_src);

#-+ Beolvassa az eredeti magasságot, szélességet
$org_h = imagesy($src_img);
$org_w = imagesx($src_img);

#-+ Kiszámolja az uj kép magasságát
$tn_w = floor($tn_h * $org_w / $org_h);
$tn_w_med = floor($tn_h_med * $org_w / $org_h);
$tn_w_kicsi = floor($tn_h_kicsi * $org_w / $org_h);

#-+ Elkésziti az uj képet
$dst_img = ImageCreateTrueColor($tn_w,$tn_h);
$dst_img_med = ImageCreateTrueColor($tn_w_med,$tn_h_med);
$dst_img_kicsi = ImageCreateTrueColor($tn_w_kicsi,$tn_h_kicsi);

#-+ Átméretezi
ImageCopyResampled($dst_img, $src_img, 0, 0, 0, 0, $tn_w, $tn_h, $org_w, $org_h);
ImageCopyResampled($dst_img_med, $src_img, 0, 0, 0, 0, $tn_w_med, $tn_h_med, $org_w, $org_h);
ImageCopyResampled($dst_img_kicsi, $src_img, 0, 0, 0, 0, $tn_w_kicsi, $tn_h_kicsi, $org_w, $org_h);

#-+ Elmenti...
$imgjpg_dst=$tndir.$img_uj;
$imgjpg_dst_med=$tndir_med.$img_uj_med;
$imgjpg_dst_kicsi=$tndir_kicsi.$img_uj_kicsi;
ImageJPEG($dst_img, $imgjpg_dst, 100);
ImageJPEG($dst_img_med, $imgjpg_dst_med, 100);
ImageJPEG($dst_img_kicsi, $imgjpg_dst_kicsi, 100);
}
else
{
}
?>
<form action="<?php echo htmlspecialchars ( $_SERVER['PHP_SELF'] ); ?>" method="post" enctype="multipart/form-data" >
<input type="file" name="file" /><br>
<input type="submit" name="submit" value="Feltöltés!" /><input type="submit" value="Töröl" id="torol" name="torol">
</form>

<?php

if (file_exists("litle_img/plakat.jpg")) {
echo "Jelenleg van plakát feltöltve!<br>
<a href=\"product_img/plakat.jpg\" target=\"_blank\"><img src='litle_img/plakat.jpg' alt='' /></a>";
} else {
echo 'Jelenleg nincs fent plakát...';
}

$imgdirb="litle_img/plakat.jpg";
$imgdirb_med="litle_img_med/plakat.jpg";
$imgdirb_kicsi="litle_img_kicsi/plakat.jpg";
$imgdirc="product_img/plakat.jpg";

if (isset($_POST["torol"])){
if (file_exists("litle_img/plakat.jpg") && file_exists("product_img/plakat.jpg") && file_exists("litle_img_med/plakat.jpg") && file_exists("litle_img_kicsi/plakat.jpg") ) {
unlink($imgdirb);
unlink($imgdirb_med);
unlink($imgdirb_kicsi);
unlink($imgdirc);
echo 'Plakát törölve!';
echo'
<script language="JavaScript" type="text/javascript">
window.parent.location="index.php";
</script>';
} else {
echo 'Nincs mit törölni, előbb tölts fel plakátot!';
}
}
echo '
</td>
</tr>
</table>
</center>';