<?php 
session_start();
//include 'connect.php';
$con = new PDO('mysql:host=localhost; dbname=vipslott_yeeke888; charset=utf8;','vipslott_admin','adminbyPOM@4671');
date_default_timezone_set("Asia/Bangkok");
if(isset($_REQUEST['gettime']))
{
    header('Content-Type: application/json');
    if (date('H') != '00') {
        $selectedTime = date('H:i:s');
        $Time1 = strtotime("-60 minutes", strtotime($selectedTime));
        $Time2 = strtotime("0 minutes", strtotime($selectedTime));
        $sql = $con->prepare("select * from loop_master where loop_text < ? and loop_text > ?");
        $sql->execute(array(date('H:i:s', $Time2), date('H:i:s', $Time1)));
        foreach ($sql as $c) {
            $current_loop_text = $c['loop_text'];
            $current_loop_num = $c['loop_num'];
        }

        $sql = $con->prepare("select * from result where dt=? and loop_num=?");
        $sql->execute(array(date('Y-m-d'), $current_loop_num));
        foreach ($sql as $c) {
            $result_tenk = $c['result_tenk'];
            $result_tlow = $c['result_tlow'];
        }



        $data = array();
        $data = array(
            "loop_num" => $current_loop_num,
            "loop_text" => $current_loop_text,
            "result_tenk" => $result_tenk,
            "result_tlow" => $result_tlow
        );
        echo json_encode($data);
    } else {

        $date = strtotime(date('Y/m/d'));
        $date = strtotime("-1 day", $date);


        $sql = $con->prepare("select * from result  where dt=? and loop_num=?");
        $sql->execute(array(date('Y-m-d', $date), 24));
        foreach ($sql as $c) {

            $result_tenk = $c['result_tenk'];
            $result_tlow = $c['result_tlow'];
        }



        $data = array();
        $data = array(
            "loop_num" => '24',
            "loop_text" => '24:00',
            "result_tenk" => $result_tenk,
            "result_tlow" => $result_tlow
        );
        echo json_encode($data);
    }
    
}
if(isset($_REQUEST['getnexttime']))
{
    $selectedTime = date('H:i:s');
    $Time1 = strtotime("+60 minutes", strtotime($selectedTime));
    $Time2 = strtotime("0 minutes", strtotime($selectedTime));
    $sql = $con->prepare("select * from loop_master where loop_text > ? and loop_text < ?");
    $sql->execute(array(date('H:i:s', $Time2),date('H:i:s', $Time1)));
    foreach($sql as $c)
    {
        $current_loop_text1 = $c['loop_text'];
        $current_loop_num1 = $c['loop_num'];
    }
   
    echo date('Y-m-d') . ' ' . $current_loop_text1;
}

if(isset($_REQUEST['getresult']))
{
      include 'function.php';
      header('Content-Type: application/json');
      $data = array();
      $data = array(
          "result_tenk" => randomresult(5),
          "result_tlow" => randomresult(5)
      );
      echo json_encode($data);
      
}
if(isset($_REQUEST['getresulttenk']))
{
     $sql=$con->prepare("select * from result where dt=? and loop_num=?");
     $sql->execute(array(date('Y-m-d'),$_REQUEST['getresulttenk']));
     foreach($sql as $c)
     {
         echo $c['result_tenk'];
     }
}
?>