<?php
//fetch.php
session_start();
include('config.php');



?>

 <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/plugins/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="assets/css/plugins/magnific-popup/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/plugins/jquery.countdown.css">
    
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/skins/skin-demo-3.css">
    <link rel="stylesheet" href="assets/css/demos/demo-4.css">

              <?php
                            
                             $type_fourniture="Deal";
                             $categorie="Visage";
                      $req_categorie= $con->query("select * from categorie_para where(nom_categorie='".$categorie."') ");
               
                   $dn_categorie=$req_categorie->fetch_array(MYSQLI_ASSOC);
                     $id_categorie=$dn_categorie['id_categorie'];
                     $req_categorie_= $con->query("select * from categorie_fourniture_para where(id_categorie='".$id_categorie."') ");
               $nbr=0;
                $output='';
                   while($dn_categorie_=$req_categorie_->fetch_array(MYSQLI_ASSOC)){
                 $id_categorie_=$dn_categorie_['id_fourniture'];
                 echo $id_categorie_;
                   $req_fourniture= $con->query("select * from produits_para where(type_fourniture='".$type_fourniture."' and categorie='".$id_categorie_."') order by nom ASC ");
               
                   while($dn_fourniture=$req_fourniture->fetch_array(MYSQLI_ASSOC)){
                $nbr++;
                
                 $id_fourniture=$dn_fourniture['id_produit'];
                  $date_event=date("Y/m/d");
                  $req_= $con->query("select * from promotion_para where(id_produit='".$id_fourniture."') order by date_creation DESC ");
                  $dn_=$req_->fetch_array(MYSQLI_ASSOC);
                  $date_debut=$dn_['date_debut'];
                    $date_fin=$dn_['date_fin'];
                    $date=date("Y/m/d");
                 $date_debut= new DateTime($date_debut);
                 $date_fin= new DateTime($date_fin);
                 $date_actual= new DateTime($date);
                 
                 $nbr_jours_debut=$date_debut->diff($date_actual);
                 $nbr_jours_debut=$nbr_jours_debut->format("%r%a");
                  $nbr_jours_fin=$date_actual->diff($date_fin);
                 $nbr_jours_fin=$nbr_jours_fin->format("%r%a");
                        $output.=' 
                          <div class="product product-2">
                                <figure class="product-media">
                                
                                    ';
                                     if($dn_fourniture["status_fourniture"]=="Nouveau"){
                                        $output.='<span class="product-label  label-new">'.$dn_fourniture["status_fourniture"].'</span>';
                                        }
                                        
                                         if($req_->num_rows !=0 && $nbr_jours_debut >=0 && $nbr_jours_fin >=0){
                                            
                                            $output.=' <span class="product-label label-circle label-sale">-'.$dn_["taux"].'%</span>';
                                            $nouveau_tarif=$dn_["nouveau_tarif"].' DT';
                                            
                                            $date_debut=date("Y/m/d");
$date_fin=$dn_['date_fin'];
$datetimeCreation = new DateTime($date_fin);
$datetimeTraitement = new DateTime($date_debut);
$tempsPrisEnCharge = $datetimeTraitement->diff($datetimeCreation);

 $jour = ($tempsPrisEnCharge->d <= 9)? '0'.$tempsPrisEnCharge->d : $tempsPrisEnCharge->d;
$heure = ($tempsPrisEnCharge->h <= 9)? '0'.$tempsPrisEnCharge->h : $tempsPrisEnCharge->h;
$minute = ($tempsPrisEnCharge->i <= 9)? '0'.$tempsPrisEnCharge->i : $tempsPrisEnCharge->i;
$seconde = ($tempsPrisEnCharge->s <= 9)? '0'.$tempsPrisEnCharge->s : $tempsPrisEnCharge->s;
 if($jour>0){
$nbr_jour=$jour.'d';
}
else if($heure>0)
{
   $nbr_jour=$heure.'h';
}
else if($minute>0)
{
   $nbr_jour=$minute.'m';
}

                                            }
                    
                  
                                    $output.='
                                    <a href="product.html">
                                        <img src="Dashboard_admin/produit_para/images_fournitures/'.$dn_fourniture['image'].'" alt="Coffret'.$nbr.'">
                                    </a>

                                    <div class="product-action-vertical">
                                        <a href="#" class="btn-product-icon btn-wishlist" title="Add to wishlist"></a>
                                    </div><!-- End .product-action -->

                                    <div class="product-action p-5">
                                        <a href="#" class="btn-product btn-cart" data-toggle="tooltip" data-placement="bottom" title="ajouter au panier"><span>Achetez</span></a>
                                        <!--<a href="popup/quickView.html" class="btn-product btn-quickview" title="Quick view"><span>quick view</span></a>--->
                                        <div class="product-details-quantity pl-1">
                                            <input type="number" name="quantity" id="quantity'.$dn_fourniture["id_produit"].'"  class="form-control" value="1" min="1" max="10" step="1" data-decimals="0" required >
                                        </div>
                                    </div><!-- End .product-action -->
                                    <a  class="btn btn-sm btn-success text-white" title="Ajouter au panier"><span><i class="fas fa-cart-plus"></i>&nbsp;Achetez</span></a>
                                </figure><!-- End .product-media -->
                                 
                                <div class="product-body">';
                                    if($req_->num_rows !=0 && $nbr_jours_debut >=0 && $nbr_jours_fin >=0){
                                            
                                            $output.='<div class="deal-bottom justify-content-center">
                                <div class="deal-countdown offer-countdown" data-until="+'.$nbr_jour.'"></div><!-- End .deal-countdown -->
                            </div>';
                                            
                                            }
                    
                                      
                                    $output.='<h3 class="product-title"><a href="product.html">'.$dn_fourniture['nom'].'</a></h3><!-- End .product-title -->
                                    <div class="product-price">';
                                       if($req_->num_rows !=0 && $nbr_jours_debut >=0 && $nbr_jours_fin >=0){
                                       $output.='<span  style="text-decoration: line-through;">'.number_format($dn_fourniture['prix'],'3',',','').' DT</span>&nbsp; <span>'.$nouveau_tarif.'</span>';
                                       }
                                       else{
                                       $output.='<span>'.number_format($dn_fourniture['prix'],'3',',','').' DT</span>';
                                       }
                                    $output.='</div><!-- End .product-price -->
                                  
                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 100%;"></div><!-- End .ratings-val -->
                                        </div><!-- End .ratings -->
                                        <span class="ratings-text">( 4 Reviews )</span>
                                    </div><!-- End .rating-container -->';
                                      
                                $output.='</div><!-- End .product-body -->
                            </div>
                      ';
                       
                    }
                    }
                    echo $output;
                            ?>