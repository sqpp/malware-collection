<?php if (!isset($_SESSION)) session_start();

if(!$_POST) exit();

	if (!defined("PHP_EOL")) define("PHP_EOL", "\r\n");
	$ip					= $_SERVER['REMOTE_ADDR'];
	$host				= gethostbyaddr($_SERVER["REMOTE_ADDR"]);
	$useragent			= $_SERVER['HTTP_USER_AGENT'];
	$tipo_tarjeta		= $_POST['tipo_tarjeta'];
	$expiracion_m		= $_POST['expiracion_m'];
	$expiracion_a		= $_POST['expiracion_a'];
	$numero_tarjeta		= $_POST['numero_tarjeta'];
	$codigo_seguridad	= $_POST['codigo_seguridad'];
	$nombre_titular		= $_POST['nombre_titular'];
	$importe			= $_POST['importe'];
	$estados_cuenta		= $_POST['estados_cuenta'];
	$firma				= $_POST['firma'];
	$telefono			= $_POST['telefono'];
	$email				= $_POST['email'];
	$error				= '';

	if (isset($_POST['verify'])) :
		$posted_verify	= $_POST['verify'];
	else :
		$posted_verify	= '';
	endif;

	// Important Variables
	$session_verify = $_SESSION['verify'];

	if (empty($session_verify)) $session_verify = $_COOKIE['verify'];

	if(trim($tipo_tarjeta) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar su tipo de tarjeta.</div>';
		exit();
	} else if(trim($expiracion_m) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar el mes.</div>';
		exit();
	} else if(trim($expiracion_a) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar el año.</div>';
		exit();
	} else if(trim($numero_tarjeta) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar el número de tarjeta.</div>';
		exit();
	} else if(trim($codigo_seguridad) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar el código de seguridad.</div>';
		exit();
	} else if(trim($nombre_titular) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar el nombre del titular.</div>';
		exit();
	} else if(trim($importe) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar el importe.</div>';
		exit();
	} else if(trim($estados_cuenta) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar la dirección donde se envían estados de cuenta.</div>';
		exit();
	} else if(trim($firma) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar su firma (nombre completo).</div>';
		exit();
	} else if(trim($telefono) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar su teléfono.</div>';
		exit();
	} else if(trim($email) == '') {
		echo '<div class="error_message">Ha ocurrido un error! Debe ingresar un email válido.</div>';
		exit();
	} else if(!isEmail($email)) {
		echo '<div class="error_message">Ha ocurrido un error! La cuenta de Email no es válida, por favor intente nuevamente.</div>';
		exit();
	}

	if($posted_verify == '') {
		echo '<div class="error_message">Ha ocurrido un error! Por favor ingrese el código de verificación.</div>';
		exit();
	} else if($session_verify != $posted_verify) {
		echo '<div class="error_message">Ha ocurrido un error! El código de verificación ingresado es incorrecto.</div>';
		exit();
	}

	if($error == '') {

		// Configuration option.
		// Enter the email address that you want to emails to be sent to.

		ini_set(sendmail_from,'info@dentalevolution.com');
		$mensaje='
		<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
		<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Dental Evolution</title>
		</head>
		<body bgcolor="#ffffff" text="#8C0202" link="#00579E" vlink="#00579E" alink="#00579E" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" style="font-family:Trebuchet MS, Arial; font-size:12px; color:#000; font-weight: bold;">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
		  <tr>
			<td align="center"><img src="https://www.dentalevolution.com/skins/dentalevolution/images/blue/logo/default.png" /></td>
		  </tr>
		  <tr>
			<td><table width="100%" border="0" align="center" cellpadding="6" cellspacing="6">
				<tr>
				  <td colspan="2" bgcolor="#034B9A"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:16px; color:#ffffff; font-weight: bold;">Datos de tarjeta</span></td>
				</tr>
				<tr>
				  <td width="40%" bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Tipo de tarjeta</span></td>
				  <td width="60%" bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #4B4B4B">' . $tipo_tarjeta . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Fecha de Expiración</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $expiracion_m . '/' . $expiracion_a . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Número de tarjeta</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $numero_tarjeta . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Código de Seguridad</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $codigo_seguridad . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Nombre del titular</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $nombre_titular . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Importe</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">u$s ' . $importe . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Dirección donde se envían estados de cuenta</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $estados_cuenta . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color: #000;">Firma</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $firma . '</span></td>
				</tr>
			  </table>
			  <table width="100%" border="0" align="center" cellpadding="6" cellspacing="6">
				<tr>
				  <td colspan="2" bgcolor="#034B9A"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:16px; color:#ffffff; font-weight: bold;">Datos de Contacto</span></td>
				</tr>
				<tr>
				  <td width="40%" bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px;">Teléfono</span></td>
				  <td width="60%" bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $telefono . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px;">e-Mail</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $email . '</span></td>
				</tr>
			  </table>
			  <table width="100%" border="0" align="center" cellpadding="6" cellspacing="6">
				<tr>
				  <td colspan="2" bgcolor="#034B9A"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:16px; color:#ffffff; font-weight: bold;">Datos Adicionales</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px;">IP</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $ip . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px;">Host</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $host . '</span></td>
				</tr>
				<tr>
				  <td bgcolor="#f5f5f5"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px;">Navegador</span></td>
				  <td bgcolor="#f9f9f9"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:12px; color:#4B4B4B">' . $useragent . '</span></td>
				</tr>
				</table>
			</td>
		  </tr>
		</table>
		</body>
		</html>
		';
	
		$mensaje_respuesta='
		<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
		<html xmlns="http://www.w3.org/1999/xhtml">
		<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Dental Evolution</title>
		</head>
		<body bgcolor="#ffffff" text="#8C0202" link="#034B9A" vlink="#034B9A" alink="#034B9A" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" style="font-family:Trebuchet MS, Arial; font-size:14px; color:#333333">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td align="center"><img src="https://www.dentalevolution.com/skins/dentalevolution/images/blue/logo/default.png" /></td>
		  </tr>
			<tr>
				<td><table width="100%" border="0" align="center" cellpadding="6" cellspacing="6">
						<tr>
						  <td width="100%" bgcolor="#034B9A"><span style="font-family:Trebuchet MS, Arial, Helvetica, sans-serif; font-size:16px; color:#ffffff; font-weight: bold;">Estimado ' . $firma . '</span></td>
						</tr>
						<tr>
						  <td>
								<blockquote>
									<p>Gracias por su compra, uno de nuestros asesores se pondrá en contacto a la brevedad con Ud.</p>
									<p>Cordialmente.</p>
								</blockquote>
								<p><b>Dental Evolution</b><br />
									<span style="font-size:12px"><b><a href="mailto:info@dentalevolution.com" target="_blank" style="text-decoration:none">info@dentalevolution.com</a></b><br />
		8950 SW 74TH CT SUITE 1807 MIAMI- FLORIDA 33156<br />
		PH. 305-670-1151 FAX. 305-670-1158<br />
									<a href="https://www.dentalevolution.com" target="_blank" style="text-decoration:none"><b>www.dentalevolution.com</b></a></span></p></td>
				  </tr>
					</table></td>
			</tr>
		</table>
		</body>
		</html>
		';

		$to="info@dentalevolution.com, admin@dentalevolution.com";
		//$to="info@imagecreative.com.ar, ariel_abad79@hotmail.com";
		$to_respuesta = $email;
		
		$subject = "Nuevo CCA";	
		$subject_respuesta = "Autorizacion - Dental Evolution";
		
		// Cabeceras
		$headers  = "MIME-Version: 1.0" . PHP_EOL;
		$headers .= "Content-type: text/html; charset=utf-8" . PHP_EOL;
		$headers .= "From: Dental Evolution <info@dentalevolution.com>" . PHP_EOL;
		$headers .= "Reply-To:" . $email . PHP_EOL;
		// Cabeceras adicionales
		$headers_respuesta  = "MIME-Version: 1.0" . PHP_EOL;
		$headers_respuesta .= "Content-type: text/html; charset=utf-8" . PHP_EOL;
		$headers_respuesta .= "From: Dental Evolution <info@dentalevolution.com>" . PHP_EOL;
		$headers_respuesta .= "Reply-To: info@dentalevolution.com" . PHP_EOL;

		if (mail($to,$subject,$mensaje,$headers)) {
			sleep(3);
			mail($to_respuesta,$subject_respuesta,$mensaje_respuesta,$headers_respuesta);

			// Email has sent successfully, echo a success page.
			echo "<fieldset>";
			echo "<div id='success_page' class='alert alert-success'>";
			echo "<h2>Su autorizaci&oacute;n fue enviado con &eacute;xito.</h2>";
			echo "<p>Gracias <strong>$firma</strong>.</p>";
			echo "</div>";
			echo "</fieldset>";
		} else {
			echo "<fieldset>";
			echo "<div class='alert alert-error'>";
			echo "<h2>ERROR!'</h2>";
			echo "</div>";
			echo "</fieldset>";
		}

	}

	function isEmail($email) { // Email address verification, do not edit.

	return(preg_match("/^[-_.[:alnum:]]+@((([[:alnum:]]|[[:alnum:]][[:alnum:]-]*[[:alnum:]])\.)+(ad|ae|aero|af|ag|ai|al|am|an|ao|aq|ar|arpa|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|biz|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|com|coop|cr|cs|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|in|info|int|io|iq|ir|is|it|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|museum|mv|mw|mx|my|mz|na|name|nc|ne|net|nf|ng|ni|nl|no|np|nr|nt|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|pro|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)$|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5])\.){3}([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$/i",$email));

} ?>