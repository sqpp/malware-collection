<?php 
header('Content-type: text/html; charset=UTF-8') ;
mb_internal_encoding("UTF-8");
include_once("../inc/header_be.php");
include_once("../inc/check-login_admin.php"); 
include_once("../lib/validation.php");
include_once("../inc/general.php");

$obj_config = new class_config();
$obj_tdg  = new class_tdg();
$error_msg = '';

if(count($_POST)>0){
    
    array_walk($_POST, 'copy_array');
	array_walk($new_post, 'put_slash');
	
    $err_msg = "";
	
	$obj_tdg->update_tdg($new_post);    
	$confirm_msg = 'TDG data updated successfully';
}

$tdg_arr = $obj_tdg->list_tdg();

$tdg_byline			=    $tdg_arr[0][1];
$tdg_forward		=    $tdg_arr[0][2];

//print_r($course_arr);

if ($_REQUEST['del_tdg_chapter_id'] <> ''){
	$obj_tdg->delete_tdg_chapter($_REQUEST['del_tdg_chapter_id']);
}


//$blog_id = 0, $ord='', $ordfield='', $pg = 1, $numrecspg = 10, $pagination = 'N'
$tdg_chapter_arr = $obj_tdg->list_tdg_chapter(0, $ord, $ordfield, $current_pg, $numrecspg, 'N');
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title><?php echo $obj_config->site_name;?></title>
<style type="text/css">
<!--
@import url("<?php echo $obj_config->site_url.$obj_config->site_bossadmin.'/'.$obj_config->site_admin_css;?>/admin-screen.css");
-->
</style>

<script type="text/javascript" src="../js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="../js/jquery-ui-1.8.18.custom.min.js"></script> 

<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script> -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-lite.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-lite.js"></script>

<script type="text/javascript" language="javascript">
	$(document).ready(function() {
		$('#tdg_forward').summernote({
		  toolbar: [
			// [groupName, [list of button]]
			['style', ['bold', 'italic', 'underline', 'clear']],
			['font', ['strikethrough', 'superscript', 'subscript']],
			['fontsize', ['fontsize']],
			['color', ['color']],
			['insert', ['link', 'picture']],
			['para', ['ul', 'ol', 'paragraph']],
			['height', ['height']]
		  ],
			callbacks: {
                onImageUpload: function(files) {
                    uploadFile(files[0]);
                }
            }	
		});
    });

	function uploadFile(file) {
		data = new FormData();
		data.append("file", file);

		$.ajax({
			data: data,
			type: "POST",
			url: "http://www.tiereddemocraticgovernance.org/admin/summernote_fileupload.php", //replace with your url
			cache: false,
			contentType: false,
			processData: false,
			success: function(url) {
				$('#tdg_forward').summernote("insertImage", url);
			}
		});
	}    
	
	function validate() {
		var all_ok = true;
		var err_msg = "";
		var fld = "";
		
		if (all_ok == false){
			alert("The following errors have taken place - " + err_msg); 
		}
		return all_ok;    
	}

</script>

</head>

<body id="bodyBg">
<div id="adminContainer2">
	<?php include_once("../inc/header_admin.php");?>
	<div class="clear"></div>
	<?php include_once("../inc/admin_left_menu.php");?>
	<!-- right side start-->
	<div id="midAreaWidth">
	<div id="breadcrumb"><a href="dashboard.php">Dashboard</a>   &#8250; Edit TDG</div>
    <h1>Add / Edit Blog</h1>

		<div id="tabNavigation">
            <ul>
                <li><span class="tabBlueLeft"></span><div>Edit TDG</div><span class="tabBlueRight"></span></li>
            </ul>
        </div>

 		<div class="tabClear"></div>
		<div id="midArea">
			<div id="midAreaTop">
				<span id="midAreaRight"></span>
				<span id="midAreaLeft"></span>
			</div>
			<div  id="midAreaCont">
			<?php if ($confirm_msg <> '') {?>
					<div class="successMsg"><ul><li><?php echo $confirm_msg;?></li></ul></div>
                    
			<?php } if ($del_msg <> '') {?>
					<div class="successMsg"><ul><li><?php echo $del_msg;?></li></ul></div>
			<?php } ?>
            <div class="successMsg" id="activemsg" style="display:none;"><ul><li></li></ul></div>
            
					
			<!--red box start -->
			<?php
				if($error_msg!="") {
			?>
				<div class="error-msg">
					<ul>
						<?php echo $error_msg?>
					</ul>
				</div>
			<?php 
				} 
			?>
			<!--red box end -->
                    
			<!--table start -->
				<div>
					<div>
						<div class="adminReqTxt" style="float:left;">&nbsp;<span class="red bold">*</span>Denotes required field</div>
					</div>
					<div class="clear"></div>
					<form name="frmreport" action="<?php echo $_SERVER['PHP_SELF']?>" onsubmit="return validate(this);" enctype="multipart/form-data" method="post" accept-charset="utf-8">
						
					  <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center" class="tblDisplay" id="form">

							<tr class="odd">
								<td><label>By Line</label></td>
								<td>
									<textarea name="tdg_byline" id="tdg_byline" style='width:100%;height:50px'><?php echo $tdg_byline?></textarea>
								</td>
							</tr>

							<tr class="even">
								<td><label>Foward<!-- <span class="red">*</span> --></label></td>
								<td>
									<textarea name="tdg_forward" id="tdg_forward"><?php echo $tdg_forward?></textarea>
								</td>
							</tr>
							<tr>
								<td colspan="2" id="greyStrap">
									<input name="submit" type="submit" value="Save" />&nbsp;
								</td>
							</tr>
					  </table>
					</form>

					<table cellpadding="0" cellspacing="0" class="tblFilterArea print">
						<tr>
							<td>
							   <div align="left">
									<input type="button" class="btn" onclick="javascript:open_tdg_chapter_edit(0)" value="Add TDG Chapter" />                     
							   </div>
						   </td>
						</tr>
					</table>
					
					<table  border="0" cellspacing="0" cellpadding="0" class="tblDisplay widthPc2" id="form">
						<tr class="even">
							<th width="50%" class="center">Chapter Title</th>  
							<th width="50%" class="center print">Option</th>
						</tr>
						<?php
							if (count($tdg_chapter_arr) > 0) {
								$ctr=0;
								
								foreach ($tdg_chapter_arr as $value) {
									$i = $ctr % 2;
									if($i == 0){
										$trclass = "odd";
									}else{
										$trclass = "even";
									}
									
									$delete_link = "add_edit_tdg.php?mode=del&del_tdg_chapter_id=" . $value[0];
					?>
									<tr id="row_<?php echo $ctr?>" class="<?php echo $trclass?>" onmouseover="change_row_color('row_<?php echo $ctr?>','trHover');" onmouseout="change_row_color('row_<?php echo $ctr?>','<?php echo $trclass;?>');">
										<td align='center'>
											<?php 
												echo $value[1];
											?>&nbsp;
										</td>   
										<td class="center print">
											<div>
												<a href="javascript:void()" onClick="javascript:open_tdg_chapter_edit(<?php echo $value[0];?>)"><img src="img/icons/icon-edit.gif" alt="edit" title="Edit" border="0" /></a>&nbsp;&nbsp;
												<a href="<?php echo $delete_link; ?>" onClick='return confirm("Are you sure?")'><img src="img/icons/icon-delete.gif" alt="Delete" title="Delete" border="0" /></a>
											</div>
										</td>
									  </tr>
						<?php
									$ctr++;
								}
							} else {
						?>
								<tr class="odd">
									<td colspan="2">No TDG Chapters listed</td>
								</tr>   
						<?php
						  }
						?>
					</table>
				</div>
			<!--table end -->
			</div>
			<div id="midAreaBot">
				<span id="midBotRight"></span>
				<span id="midBotLeft"></span>
			</div>
		</div>
		<?php include_once("../inc/footer_admin.php");?>
	</div>
		<!-- right side end-->
</div>			
<div class="clear"></div>
         

</body>
 
<style>
	.note-editor.note-frame .note-editing-area .note-editable {
		height:250px;
	}
</style>
<SCRIPT LANGUAGE="JavaScript">
<!--
	function open_tdg_chapter_edit(tdg_chapter_id)
	{
		window.open('add_edit_tdg_chapter_pop.php?tdg_chapter_id='+tdg_chapter_id, 'tdg_chapter_pop', 'toolbar=no,menubar=no,width=900,height=800');
	}
//-->
</SCRIPT>
</html>