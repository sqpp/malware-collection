<?php
## 1 - Beállítások ################################################################################
$upload_dir = "nemkell"; //Ahova menteni fogja a feltöltött fájlokat(az attribútomot állítsd 777-re)

if ($_POST[uploadform] != "")
    {
    echo "Feltöltés a /".$aktualis_id."/ mappába folyamatban!<br>";
    $upload_dir = $aktualis_id."/"; //Ahova menteni fogja a feltöltött fájlokat(az attribútomot állítsd 777-re)
    }

$size_bytes = 3024000; //max fájl méret
$extlimit   = "yes"; //Ne piszkáld jó így ahogy van
$limitedext = array (".jpg"); //megengedett formátumok
## 2 - Mappa hibakódok ################################################################################
//Hibakódot ír ha nem létezik a megadott mappa
if (!is_dir("$upload_dir"))
    {
    //echo "Hiba: a megadott mappa <b>/$upload_dir/</b> nem létezik!<br><a href=\"$_SERVER[PHP_SELF]\">Vissza</a>";
    mkdir($upload_dir, 0777);
    exit();
    }
//Hibakódot ír ha nincs beállítva a 777-es attribútom
if (!is_writeable("$upload_dir"))
    {
    die("<font color=red><b>Hiba: a megadott mappának<b>($upload_dir)</b> állíts be 777-es attribútomot! )");
    }


## 3 - Általános hibakódok ################################################################################

if (isset($_POST['uploadform']))
    {
    $file_tmp  = $_FILES['filetoupload']['tmp_name'];
    $file_name = $_FILES['filetoupload']['name'];
    $file_size = $_FILES['filetoupload']['size'];

    //Hibakódot ír ha nincs kiválasztott fájl
    if (!is_uploaded_file($file_tmp))
        {
        echo "<font color=red><b>Hiba: válassza ki a feltöltendő fájlt! </b></font><br><a href=\"$_SERVER[PHP_SELF]\">Vissza</a>";
        echo "<meta http-equiv=Refresh content=3;url=".$PHP_SELF.">";
        exit();
        }

    //Hibakódot ír ha a feltöltendő fájl meghaladta a max méretet
    if ($file_size > $size_bytes)
        {
        echo "<font color=red><b>Hiba: A fájl meghaladta a Max. <b>".$size_bytes / 1024 ."</b> KB méretet! <br><a href=\"$_SERVER[PHP_SELF]\">Vissza</a>";
        exit();
        }
    //Hibakódot ír ha helytelen a fájl kiterjesztés
    $ext = strrchr($file_name, '.');
    if (($extlimit == "yes") && (!in_array(strtolower($ext), $limitedext)))
        {
        echo "<font color=red><b>Hiba: helytelen fájl kiterjesztés! </b></font><br><a href=\"$_SERVER[PHP_SELF]\">Vissza</a>";
        echo "<meta http-equiv=Refresh content=3;url=".$PHP_SELF.">";
        exit();
        }

    // Check if file is Already EXISTS.
    if (file_exists($upload_dir.$file_name))
        {
        echo "<font color=red><b>Hiba: Már van ilyen fájl név<b>($file_name)!</b></font><br><a href=\"$_SERVER[PHP_SELF]\">Vissza</a>";
        exit();
        }

    $file_name = str_replace(' ', '_', $file_name);
    if (move_uploaded_file($file_tmp, $upload_dir.$file_name))
        {
        //echo "Fájl (<a href=\"$upload_dir$file_name\">$file_name</a>) sikeresen feltöltve! <br>";
        echo "<meta http-equiv=Refresh content=1;url=".$PHP_SELF.">";
        }
    else
        {
        //Hibakódot ha progléma van a fájl mozgatásában
        echo "Valami probléma van a fájl mozgatásánál. <br><a href=\"$_SERVER[PHP_SELF]\">Vissza</a>";
        exit();
        }
    }
## 4 - Űrlap ################################################################################
else
    {
    for ($i = 0; $i < count($limitedext); $i++)
        {
        if (($i <> count($limitedext) - 1))
            $commas = ", ";else
            $commas = "";

        list($key, $value) = each($limitedext);
        $all_ext .= $value.$commas;
        }

    echo "<br>Képek feltöltése a /$aktualis_id/ mappába<br>"
    ."<form method=\"post\" enctype=\"multipart/form-data\" action=\"$PHP_SELF\">"
    ."<input type=\"file\" name=\"filetoupload\" size=55 ><br>"
    ."<input type=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"$size_bytes\"><br>";
    
    include "scaviani_post.php";
    
    echo "<input type=\"Submit\" name=\"uploadform\" value=Feltöltés>"
    ."</form>";
    }
/// end of űrlap ################################################################################

clearstatcache();
?>