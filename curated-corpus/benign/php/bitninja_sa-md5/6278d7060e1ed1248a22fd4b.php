<?php 
session_start();
include("common/config.php");
include("common/crud.php");
include("header.php");
include("menu1.php");
$picture_id=0;
if(isset($_GET['action'])&& $_GET['action']=="update")
{
$cond="photo_id=".$_GET['id'];
$picture_update=$crud->FindRow('portfolio',array(),array($cond));
$picture_id=$picture_update['photo_id'];

$cond1="photo_id=".$_GET['id'];
$portfolio=$crud->FindRow('portfolio',array(),array($cond1));
}


$target_dir = "uploads/portfolio/";
error_reporting(0);
$target_file = $target_dir .time(). basename($_FILES["image"]["name"]);
$uploadOk = 1;
if(isset($_POST['submit']))
{
	
if(isset($_FILES["image"]["tmp_name"]) && !empty($_FILES["image"]["tmp_name"]))
{
$cond="photo_id=".$picture_update['photo_id']; 
$edit_image=$crud->FindRow('portfolio', array(),array($cond));
unlink("../".$edit_image['image']); 
move_uploaded_file($_FILES["image"]["tmp_name"],"../".$target_file) ;
$uploadOk=2;

}
else
 {
	 echo "error";
 }

$crud = new CRUD('portfolio','photo_id');
$saveData = array();
$saveData['description']=$_POST['description'];
$saveData['name']=$_POST['name'];

if($uploadOk==2)
$saveData['image']=$target_file;
if($picture_id>0)
$saveData['photo_id']=$picture_update['photo_id'];
$insert_id=$crud->save($saveData);
if($insert_id>0)
echo "<script>alert('Data Add Successfully')</script>";
unset($_GET);
}
$crud=new CRUD();
$picture=$crud->FindAll('portfolio',array(),array());
?>
                
<?php
include("html/portfolio.html");
include("footer.php");
?>