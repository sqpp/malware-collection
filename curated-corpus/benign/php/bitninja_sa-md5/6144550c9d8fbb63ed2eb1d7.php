<?php

	// showinternationals.php

	require '../includes.php';
	//require 'isleagueready.php';
	$positions = unserialize (ShortPositions); // 'FullPositions' is defined in the include file. Extract it here since it'll be used for quite a few of the decoded messages.

	
	$db = Connect();

	try {
		$query = $db->Prepare("SELECT * FROM internationals");
		$query->execute();
		$InternationalsArray = $query->fetchAll(PDO::FETCH_CLASS, 'international');

		//echo "<pre>",print_r($InternationalsArray),"</pre>";
		
		// Make an array of all of the internationals, sending back as little information as necessary (to lower bandwidth). The java only needs the team names, the scores and any players involved in the game.
		
		foreach ($InternationalsArray as $International) {
			$International->JSONDecodeAll();

			echo "<tr>";
			$t = $International->Teams[0];
			echo "<td class = 'ittl'>$t</td>";
			$t = $International->Scores[0];
			echo "<td class = 'ittn'>$t</td>";
			echo "<td class = 'ittn'>-</td>";
			$t = $International->Scores[1];
			echo "<td class = 'ittn'>$t</td>";
			$t = $International->Teams[1];
			echo "<td class = 'ittr'>$t</td>";
			echo "</tr>";					
			
			$Team1PlayerCount = count($International->Players[0]);
			if (empty($International->Players[0])) { $Team1PlayerCount = 0; } // I don't know why 'count' gives 1 for an empty array above. Botch-fix.
			$Team2PlayerCount = count($International->Players[1]);
			if (empty($International->Players[1])) { $Team2PlayerCount = 0; } // I don't know why 'count' gives 1 for an empty array above. Botch-fix.
			$MaxLineUp = max($Team1PlayerCount,$Team2PlayerCount);
			if ($MaxLineUp > 0) {
				for ($x = 0; $x < $MaxLineUp; $x ++) {
				echo "<tr>";
					echo "<td class = 'ittl internationalplayers'>";
					if ($Team1PlayerCount > $x) {
					$t = "(" . $International->Players[0][$x]->League . " - " . $International->Players[0][$x]->Team . ") " . $International->Players[0][$x]->Name . " " . $positions[$International->Players[0][$x]->Position - 1];
						echo $t;
					}
					echo "</td>";
					echo "<td class = 'ittn'></td>";
					echo "<td class = 'ittn'></td>";
					echo "<td class = 'ittn'></td>";
					echo "<td class = 'ittr internationalplayers'>";
					if ($Team2PlayerCount > $x) {
						$t = $positions[$International->Players[1][$x]->Position - 1] . " - " . $International->Players[1][$x]->Name . " (" . $International->Players[1][$x]->Team . " - " . $International->Players[1][$x]->League . ")";
						echo $t;
					}
					echo "</td>";
				echo "</tr>";
				}
			}
		}
		

		
	} catch (PDOException $ex) {
		Echo $ex->getMessage();
	}



	

	