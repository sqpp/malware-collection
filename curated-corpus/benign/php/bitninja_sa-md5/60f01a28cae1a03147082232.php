<?php 
include 'header.php';
require_once('connect.php');

if(!isset($_SESSION['username'])){
	echo "<script>window.location.href='login.php';</script>"; 
}

if(isset($_POST) & !empty($_POST)){

	$extarray=array();
		
	$temp = explode(".", $_FILES["testimonial_image"]["name"]);
	$ptestimonial_img = 'Testimonial-'.mt_rand(1000,9000). '.' . end($temp);
	array_push($extarray,end($temp));
	
	$target_dir = "Images/Testimonial/";
	
	$testimonial_name = $_POST['testimonial_name'];
	$testimonial_text = $_POST['testimonial_text'];
	$testimonial_image = $_FILES["testimonial_image"]["name"];

	 
	move_uploaded_file($_FILES["testimonial_image"]["tmp_name"], $target_dir.$ptestimonial_img); 
	
	$sql = "INSERT INTO testimonial (testimonial_name, testimonial_text, testimonial_image) VALUES ('$testimonial_name', '$testimonial_text','$ptestimonial_img')";
	$result = mysqli_query($connection, $sql); 
	if($result){ 
		$smsg = "Testimonial Add successfull";
	}else{
		$fmsg = "Testimonial Add failed". $sql . "<br>" . $connection->error;;
	}
}

?>	
                <!-- Page Sidebar Ends-->
                <div class="page-body">
                    <div class="container-fluid">
                        <div class="page-header">
                            <div class="row">
                                <div class="col">
                                    <div class="page-header-left">
                                        <h3>Add Testimonial</h3>
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item">
                                                <a href="index.php"><i data-feather="home"></i></a>
                                            </li>
                                            <li class="breadcrumb-item">Dashboard</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Container-fluid starts-->
                    <div class="container-fluid">
                        <div class="row">
							<div class="card col-md-12">
								  <div class="card-body">
										<?php if(isset($smsg)){ ?><div class="alert alert-success" role="alert"> <?php echo $smsg; ?> </div><?php } ?>
										<?php if(isset($fmsg)){ ?><div class="alert alert-danger" role="alert"> <?php echo $fmsg; ?> </div><?php } ?>
										<form method="POST" enctype="multipart/form-data">
										  <div class="form-row">
											<div class="col-md-12 mb-3">
												<label>Testimonial Name</label>
												<input class="form-control" id="testimonial_name" name="testimonial_name" type="text" placeholder="Testimonial name" required="">
											</div>
											<div class="col-md-12 mb-3">
												<label for="validationDefault02">Testimonial Text</label>
												 <textarea class="form-control" id="testimonial_text" name="testimonial_text" rows="3" placeholder="Testimonial Text" required=""></textarea>
											</div>
											<div class="col-md-3 mb-3">
												<label for="validationDefault02">Testimonial Image</label>
												<div class="custom-file">
													<input hidden class="custom-file-input" id="testimonial_image" name="testimonial_image" type="file" required="" onchange="backpreviewFile(this);"> 
													<label class="custom-btn-1" for="testimonial_image">Choose file...</label>
												</div>
											</div>
											<div class="col-md-3 mb-3">
												<img style="width: 125px;" id="backpreviewImg" src="Images/Testimonial/Testimonial-7012.jpg" alt="Profile Image">
											</div> 
											<div class="col-md-12 mb-3">
												<button class="btn btn-primary" type="submit">Submit Testimonial</button>
											</div>
										</form>
								  </div>
							</div>
                        </div>
                    </div>
                    <!-- Container-fluid Ends-->
                </div>
                
<?php include 'footer.php';?>
<script>
 
$(document).ready(function() {
	$('.mdb-select').materialSelect();
});

function backpreviewFile(input){
	var file = $("#testimonial_image").get(0).files[0];

	if(file){
		var reader = new FileReader();

		reader.onload = function(){
			$("#backpreviewImg").attr("src", reader.result);
		}

		reader.readAsDataURL(file);
	}
}

</script>