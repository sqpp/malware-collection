<?php
ini_set('display_errors',1);
error_reporting(E_ALL);
session_start();
date_default_timezone_set('Asia/Kolkata');
if($_REQUEST['action']=="add_blog")
{
 add_blog();
}
if($_REQUEST['action']=="delete_blog")
{
 delete_blog();
}
if($_REQUEST['action']=="add_video")
{
 add_video();
}
if($_REQUEST['action']=="delete_video")
{
 delete_video();
}
if($_REQUEST['action']=="add_category")
{
 add_category();
}
if($_REQUEST['action']=="delete_category")
{
 delete_category();
}

if($_REQUEST['action']=="delete_photo")
{
 delete_photo();
}

function add_blog()
{
 $R=$_REQUEST;
 include_once("../database/config.php");
 $photos=$_FILES['blog_img'];
		///Creating the new name////
		if($photos['name'])
		{
			$photo_name = explode(".",$photos['name']);
			$photo_name = $photo_name[0]."_".time().".".$photo_name[1];
			$location = $photos['tmp_name'];
			$newLocation = "../uploads/".$photo_name;
			move_uploaded_file($location,$newLocation);
		}
         else
{
   $photo_name=$R['blogImg'];
}
  $date=date('Y-m-d');
  $title=mysqli_real_escape_string($conn,$R['title']);
  $short_description=mysqli_real_escape_string($conn,$R['short_description']);
  $description=mysqli_real_escape_string($conn,$R['description']);
  if($R['bg_id'])
{
  $SQL="UPDATE blog SET category='$R[category]',title='$title',short_description='$short_description',description='$description',status='1',blog_img='$photo_name' WHERE bg_id='$R[bg_id]'";
 $result=mysqli_query($conn,$SQL);
  if($result)
  {
    $_SESSION['Message']='Blog has been updated successfully';
	header("Location:../list_blog.php");
  }
  else
  {
    $_SESSION['Message']='Something Went Wrong. Please try again';
	header("Location:../add_blog.php?id='$R[bg_id]'");
  }
}
else
{
  $SQL="INSERT INTO blog (`category`,`title`,`short_description`,`description`,`status`,`posted_by`,`blog_img`,`created_date`) VALUES('$R[category]','$title','$short_description','$description','1','Tavamitra','$photo_name','$date')";
 $result=mysqli_query($conn,$SQL);
  if($result)
  {
    $_SESSION['Message']='Blog has been added successfully';
	header("Location:../list_blog.php");
  }
  else
  {
    $_SESSION['Message']='Something Went Wrong. Please try again';
	header("Location:../add_blog.php");
  }
}
 
}

function add_video()
{
 $R=$_REQUEST;
 include_once("../database/config.php");
  
  $title=mysqli_real_escape_string($conn,$R['vg_title']);
  $meta_tags=mysqli_real_escape_string($conn,$R['meta_tags']);
  $description=mysqli_real_escape_string($conn,$R['meta_description']);
  if($R['vg_id'])
{
  $SQL="UPDATE videos SET vg_title='$R[vg_title]',meta_tags='$meta_tags',meta_description='$R[meta_description]',video_link='$R[video_link]' WHERE vg_id='$R[vg_id]'";
  $result=mysqli_query($conn,$SQL);
  if($result)
  {
    $_SESSION['Message']='Video has been Updated successfully';
	header("Location:../list_videos.php");
  }
  else
  {
    $_SESSION['Message']='Something Went Wrong. Please try again';
	header("Location:../add_video.php?id='$R[vg_id]'");
  }
}
else
{
  $date=date('Y-m-d');
  $SQL="INSERT INTO videos (`vg_title`,`meta_tags`,`meta_description`,`video_link`,`uploaded_date`) VALUES('$title','$meta_tags','$description','$R[video_link]','$date')";
  $result=mysqli_query($conn,$SQL);
  if($result)
  {
    $_SESSION['Message']='Video has been Added successfully';
	header("Location:../list_videos.php");
  }
  else
  {
    $_SESSION['Message']='Something Went Wrong. Please try again';
	header("Location:../add_video.php");
  }
}
  
}


function  add_category()
{
  $R=$_REQUEST;
 
  if($R[cat_id])
  {
   include_once("../database/config.php");
  $SQL="UPDATE category SET cat_title='$R[cat_title]',cat_status='$R[status]' WHERE cat_id='$R[cat_id]'";
  $result=mysqli_query($conn,$SQL);
  if($result)
  {
    $_SESSION['Message']='Category data has been updated to database';
	header("Location:../list_category.php");
  }
  else
  {
    $_SESSION['Message']='Something went wrong. Please try again';
	header("Location:../add_category.php?cat_id='$R[cat_id]'");
  } 
  }
  else
  {
   include_once("../database/config.php");
  $date=date('Y-m-d');
  $SQL="INSERT INTO category(`cat_title`,`cat_status`,`created_date`) VALUES('$R[cat_title]','$R[status]','$date')";
  $result=mysqli_query($conn,$SQL);
  if($result)
  {
    $_SESSION['Message']='Category has been added to database';
	header("Location:../list_category.php");
  }
  else
  {
    $_SESSION['Message']='Something went wrong. Please try again';
	header("Location:../add_category.php");
  }
 }
}


function delete_category()
{
 $R=$_REQUEST;
 include_once("../database/config.php");
 $SQL="DELETE FROM category WHERE `cat_id`='$R[cat_id]'";
$result=mysqli_query($conn,$SQL);
if($result)
{
 $_SESSION['Message']='The record has been successfully deleted.';
 header("Location:../list_category.php");
 exit;
}
}
function delete_blog()
{
 $R=$_REQUEST;
 include_once("../database/config.php");
 $SQL="DELETE FROM blog WHERE `bg_id`='$R[bg_id]'";
$result=mysqli_query($conn,$SQL);
if($result)
{
 $_SESSION['Message']='The record has been successfully deleted.';
 header("Location:../list_blog.php");
 exit;
}
}

function delete_photo()
{
 $R=$_REQUEST;
 include_once("../database/config.php");
 $SQL="UPDATE blog SET blog_img='' WHERE `bg_id`='$R[id]'";
$result=mysqli_query($conn,$SQL);
if($result)
{
 echo 'Image has been successfully deleted.';
}
else
{ 
  echo 'Something Went Wrong. Please try again';
}
}

function delete_video()
{
 $R=$_REQUEST;
 include_once("../database/config.php");
 $SQL="DELETE FROM videos WHERE `vg_id`='$R[id]'";
$result=mysqli_query($conn,$SQL);
if($result)
{
 $_SESSION['Message']='The record has been successfully deleted.';
 header("Location:../list_videos.php");
 exit;
}
}
?>