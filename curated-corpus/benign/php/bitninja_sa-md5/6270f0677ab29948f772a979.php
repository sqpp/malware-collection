<?php
ob_start();

require_once("../../tcpdf/tcpdf.php");

include('../../server.php');
if (empty($_SESSION['username'])) {
    header('location: ../../login.php');
    }
 if (isset($_SESSION["username"])){
         $ID = $_SESSION['username'];
        $session = $_SESSION['session'];
        $semester = $_SESSION['semester'];

        }
   
// Extend the TCPDF class to create custom Header and Footer
class MYPDF extends TCPDF {

    //Page header
    public function Header() {

        include('../../server.php');

        if (isset($_SESSION["username"])){
         $ID = $_SESSION['username'];
        $session = $_SESSION['session'];
        $semester = $_SESSION['semester'];
        }

        $level = $_GET['lev'];
        $session = $_GET['sess'];
        $semester = $_GET['sem'];
        $getDate = $_GET['getDate'];
        $sub_dpt_ID = $_GET['sub_dpt'];
        $getDate= str_replace('_', ' ', $getDate);
         $result_status = mysqli_query($conn,"SELECT * from department inner join faculty on department.fac_ID = faculty.fac_ID where HOD ='$ID'");
          $checkRole=mysqli_query($conn,"SELECT * FROM department inner join faculty on department.fac_ID = faculty.fac_ID inner join role on department.dpt_ID = role.dpt_ID where role.staffID ='$ID' and task='HOD' and role4='Yes'");
           if((mysqli_num_rows($result_status) > 0) ||  (mysqli_num_rows($checkRole)>0)) {
           if(mysqli_num_rows($result_status) > 0) {
                                       $row=mysqli_fetch_array($result_status);
                                      } elseif (mysqli_num_rows($checkRole) > 0) {
                                        $row=mysqli_fetch_array($checkRole);
                                      } else { 
                                         ?><script type="text/javascript"> location.href ="#/";</script><?php
                                      }
            $dpt_ID = $row['dpt_ID'];
            $dptName = $row['dpt_name'];
            $facName = $row['fac_name'];
            $programme = $row['programme'];
          } 

          $sql = mysqli_query($conn,"SELECT * from session where year ='$session'");
          while ($row = mysqli_fetch_array($sql)) {
            $sessionName = $row['session'];
          } 

          $sql = mysqli_query($conn,"SELECT * from semester where semester_ID ='$semester'");
          while ($row = mysqli_fetch_array($sql)) {
            $semesterName = $row['semester'];
          } 

          $sql = mysqli_query($conn,"SELECT * from level where year ='$level'");
          while ($row = mysqli_fetch_array($sql)) {
            $level = $row['level'];
          } 

          $sql = mysqli_query($conn,"SELECT * from sub_department where sub_dpt_ID ='$sub_dpt_ID'");
          while ($row = mysqli_fetch_array($sql)) {
            $sub_dpt_name = $row['sub_dpt_name'];
            $sub_programme = $row['sub_programme'];
          } 

          if (!empty($sub_programme)) {
            $programme = $sub_programme;
          } 


        
        // Logo
        $image_file = '../../'.$siteLogo2;
        $this->Image($image_file, 10, 10, 15, '', 'PNG', '', 'T', false, 300, '', false, false, 0, false, false, false);
        // Set font
        $this->SetFont('Times', 'B', 18);
        // Title
        $this->SetTextColor(0, 153, 51);
        $this->Cell(0, 12, 'BAMIDELE OLUMILUA UNIVERSITY OF EDUCATION, SCIENCE AND TECHNOLGY', 0, 1, 'C', 0, '', 0, false, 'M', 'M');
        $this->SetFont('Times', 'B', 10);
        $this->SetTextColor(0,0,0);
        $this->Cell(0, 4, "FACULTY OF {$facName}", 0, 1, 'C', 0, '', 0, false, 'M', 'M');
        $this -> Cell(0, 4, " DEPARTMENT OF {$dptName}", 0, 1, 'C');
        $this -> Cell(0, 4, " {$sessionName} {$semesterName} EXAMINATION RESULTS", 0, 1, 'C');
        $this -> Cell(0, 4, "MARK SHEETS", 0, 1, 'C');
        $this->SetFont('Times','', 10);
        $txt = "<b>Date Printed:</b> ".date('l jS, M Y');
        $this->WriteHTML("{$programme} {$sub_dpt_name} - {$level}", '', 0, 'L', true, 'L', false, false, 0);
        $this->WriteHTML($txt, '', 0, 'R', true, 'R', false, false, 0);
        $style = array('width' => 0.2, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0);
        $this->Line(10, 36, 290, 36, $style);
        $this->Line(10, 37, 290, 37, $style);
        $this->StartTransform();
        $this->SetTextColor(0,0,0);
        $this->Rotate(90, 130, 150);
        //$this->Cell(0, 0, 'Â© '.$session.'. Ekiti State University', 0, 0, 'L', 0, '', 0, false, 'M', 'M');
        //$this->Cell(0, 0, 'Best Printed with Color', 0, 1, 'R', 0, '', 0, false, 'M', 'M');
        $this->Rotate(270, 150, 150);
        $this->StopTransform();

        $this->Ln(10);



       
       




        

    $this->StartTransform();
    $this->SetFont('times','B',50);
    $this->SetTextColor(255,222,203);
    $this->Rotate(40, -70, 200);
    $this->Cell(0, 12, 'RESULT         SHEET', 0, 1, 'C', 0, '', 0, false, 'M', 'M');
    $this->StopTransform();







   


   
    }

    // Page footer
    public function Footer() {
        $this->SetY(-15);
        // Set font
        $this->SetFont('helvetica', 'B', 8);
        // Page number
         $style = array('width' => 0.2, 'cap' => 'butt', 'join' => 'miter', 'dash' => 0);
        $this->Line(10, 285, 200, 285, $style);


        $this->Cell(0, 10, 'Page '.$this->getAliasNumPage().'/'.$this->getAliasNbPages(), 0, false, 'R', 0, '', 0, false, 'T', 'M');
        $this->SetFooterMargin(PDF_MARGIN_FOOTER);
    }
}

// create new PDF document
$pdf = new MYPDF('L', PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);

// set document information
$pdf->SetCreator(PDF_CREATOR);
$pdf->SetAuthor('Ekiti State University');
$pdf->SetTitle('Student Result');
$pdf->SetSubject('Student Result');
$pdf->SetKeywords('TCPDF, PDF, example, test, guide');

// set default header data
$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);

// set header and footer fonts
$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));
$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));

// set default monospaced font
$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);

// set margins
$pdf->SetMargins(PDF_MARGIN_LEFT, '40', PDF_MARGIN_RIGHT);
$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);

// set auto page breaks
$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);



$pdf->SetHeaderData('','', 'Document Title', 'Document Header Text');

// set image scale factor
$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);

// set some language-dependent strings (optional)
if (@file_exists(dirname(__FILE__).'/lang/eng.php')) {
    require_once(dirname(__FILE__).'/lang/eng.php');
    $pdf->setLanguageArray($l);
}

// ---------------------------------------------------------

// set font
$pdf->SetFont('times', 'BI', 12);

// add a page
$pdf->AddPage();

$pdf -> SetFont ("helvetica", '', 8);


// -- set new background ---
include_once '../../module/get_students_max_unit.php';

 
$html = '
<style>
.courses{
            width: 10px;
            background: #000;
            height: 40px;
            float: left;
            text-align: center;
            color: black;
            display: grid;
        }
        .courses2{
            width: 43px;
            float: left;
            text-align: center;
            color: black;
            display: grid;
        }
</style>';


$html .= '

           <table  cellspacing="0" cellpadding="1" border="1">
                    <thead>
                       <tr >
                            <th width="30"  rowspan="2" ><b>S/N</b></th>
                            <th width="70" rowspan="2" ><b>REG NO</b></th>
                            <th width="234" rowspan="2" ><b>CURRENT SEMESTER</b></th>
                            <th rowspan="2"  width="30"><b>SEM RMK</b></th>
                            <th width="74" rowspan="2" ><b>SEM REPEAT</b></th>
                             <th width="147" rowspan="2" ><b>OUTSTANDING COURSES</b></th>
                            
                            
                            <th colspan="4" width="112" ><b>PRESENT</b></th>
                            <th colspan="4" width="112" ><b>PREVIOUS</b></th>
                            <th colspan="4" width="112" ><b>CUMULATIVE</b></th>
                            <th rowspan="2" width="35"><b>RMK</b></th>
                        </tr>
                        <tr>
                            <th ><div>TCP</div></th>
                            <th ><div>TLU</div></th>
                            <th ><div>TUP</div></th>
                            <th ><div>GPA</div></th>
                            <th ><div>TCP</div></th>
                            <th ><div>TLU</div></th>
                            <th ><div>TUP</div></th>
                            <th ><div>GPA</div></th>
                            <th ><div>TCP</div></th>
                            <th ><div>TLU</div></th>
                            <th ><div>TUP</div></th>
                            <th ><div>GPA</div></th>                            
                        </tr>
                        </thead>

                       ';

$myActiveSession = $session;
$myActiveSemester = $semester;
$pc_id = $_GET['lev'];
$session = $_GET['sess'];
$semester = $_GET['sem'];
$gD = $_GET['gD'];
$sub_dpt_ID = $_GET['sub_dpt'];
$getDate= str_replace('_', ' ', $gD);

 if (!empty($getDate)) {
     $provideBatch = "and hodApprovalDate='$getDate'";
   } else {
    $provideBatch = "";
   }

$result_status = mysqli_query($conn,"SELECT * from department inner join faculty on department.fac_ID = faculty.fac_ID where HOD ='$ID'");
          $checkRole=mysqli_query($conn,"SELECT * FROM department inner join faculty on department.fac_ID = faculty.fac_ID inner join role on department.dpt_ID = role.dpt_ID where role.staffID ='$ID' and task='HOD' and role4='Yes'");
           if((mysqli_num_rows($result_status) > 0) ||  (mysqli_num_rows($checkRole)>0)) {
           if(mysqli_num_rows($result_status) > 0) {
                                       $row=mysqli_fetch_array($result_status);
                                      } elseif (mysqli_num_rows($checkRole) > 0) {
                                        $row=mysqli_fetch_array($checkRole);
                                      } else { 
                                         ?><script type="text/javascript"> location.href ="#/";</script><?php
                                      }
            $dpt_ID = $row['dpt_ID'];
            $dptName = $row['dpt_name'];
            $facName = $row['fac_name'];
            $programme = $row['programme'];
            $hod= $row['HOD'];
            $dean = $row['dean'];
          } 
$pass=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and semRemark='PASS'"));
   if ($pass==0) {
     $pass='Nil';
   }
  $CSO=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and semRemark='REP'"));
  if ($CSO==0) {
     $CSO='Nil';
   }
   $NR1=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and semRemark='NR'"));
  if ($NR1==0) {
     $NR1='Nil';
   }

   $NR2=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and semRemark='NR II'"));
  if ($NR2==0) {
     $NR2='Nil';
   }


  $LOA=mysqli_num_rows(mysqli_query($conn, "SELECT students.matricNo FROM  students INNER JOIN leave_of_absence ON students.matricNo = leave_of_absence.matricNo where leave_of_absence.absenceSession = '$session' and (leave_of_absence.absenceSemester = '$semester' || leave_of_absence.absenceSemester = '') and leave_of_absence.appliedLevel = '$pc_id' and students.dpt_ID='$dpt_ID' and students.sub_dpt_ID='$sub_dpt_ID' and leave_of_absence.status='Approved'"));
  if ($LOA==0) {
     $LOA='Nil';
   }



  $PROB=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and curRemark='PROB'"));
  if ($PROB==0) {
     $PROB='Nil';
   }
  $WDR=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and curRemark='WDR'"));
  if ($WDR==0) {
     $WDR='Nil';
   }
  $TRF=mysqli_num_rows(mysqli_query($conn, "SELECT matricNo FROM  transfer where session = '$session' and appliedLevel = '$pc_id' and outgoingDpt='$dpt_ID' and outgoingSubDpt='$sub_dpt_ID' and status='Approved'"));
  if ($TRF==0) {
     $TRF='Nil';
   }
  $WRN=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and curRemark='WRN'"));
  if ($WRN==0) {
     $WRN='Nil';
   }
  $TOS=mysqli_num_rows(mysqli_query($conn, "SELECT studentslevel.matricNo FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID INNER JOIN level ON studentslevel.Level = level.year where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch  and curRemark='TOS'"));
  if ($TOS==0) {
     $TOS='Nil';
   }


                                $i=$start;
                                $uniqueCourse = array();
                              $sql="SELECT * FROM studentslevel INNER JOIN students ON studentslevel.matricNo = students.matricNo INNER JOIN department ON students.dpt_ID = department.dpt_ID where studentslevel.session = '$session' and studentslevel.semester = '$semester' and studentslevel.level = '$pc_id' and studentslevel.sdpt_ID='$dpt_ID' and studentslevel.ssub_dpt_ID='$sub_dpt_ID' and studentslevel.hodApproval='Approved' $provideBatch ORDER BY students.matricNo ASC";
                              $result_status=mysqli_query($conn,$sql);
                              $numEXamined= mysqli_num_rows($result_status);
                              while($row=mysqli_fetch_array($result_status))
                              {
                                $matricNo = $row['matricNo'];
                                $studentDpt = $row['sdpt_ID'];
                                $pc_id = $row['level'];
                                $studentLev = $pc_id;

                                $levelSem = $studentLev.$semester;
                                $SessionSem = $session.$semester;
                                $i++;

                                $EntryYear =$DEntryMode = $row['EntryYear'];
                                $entrymode = $row['entrymode'];

                                $sub_dpt_ID=$row['ssub_dpt_ID'];

                                $peakLevel = $row['courseDuration'];


                                $entrymode = $row['entrymode'];
                                if (($studentLev==1) and $entrymode=='TRANSFER') {$entrymode = 'UTME';} 
                                if (($studentLev>'1' and empty($row['transferEntryYearStart'])) || ($studentLev>=$row['transferEntryYearStart'] and !empty($row['transferEntryYearStart'])) and !empty($row['transferEntryYear'])) {$EntryYear = $row['transferEntryYear'];}

                                $maxUnit = get_students_max_info('maxUnit', $studentDpt, $sub_dpt_ID, $pc_id,$semester,$entrymode,$conn); //defaultUnit minUnit maxUnit courseDuration
                                //$minUnit = get_students_max_info('minUnit', $studentDpt, $sub_dpt_ID, $pc_id,$semester,$entrymode,$conn); //defaultUnit minUnit maxUnit courseDuration

                                $print_color = "black; background: white;";
                                if (($maxUnit<$row['currentTLU']) || $row['currentTLU']<12) {$print_color= "red; background:yellow; font-style: bold";}

                                if ($entrymode=='UTME') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and putmeCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } elseif ($entrymode=='DIRECT ENTRY') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and deCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } elseif ($entrymode=='TRANSFER') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and transferCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } elseif ($entrymode=='PREDEGREE') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and putmeCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } else{
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and putmeCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                }

                                $fetchRegUnit = mysqli_query($conn,"SELECT SUM(curriculum.curriculumUnit) as RegUnit FROM rawscore INNER JOIN curriculum ON rawscore.courseCode = curriculum.courseCode  where matricNo = '$matricNo' and curriculum.dpt_ID='$studentDpt' AND session = '$session' and rawscore.semester = '$semester' and approvalStatus = 'Approved' and HodApproval = 'Approved' and regdate!='' $studentCurr");
                                $fRegUnit = mysqli_fetch_assoc($fetchRegUnit);
                                $RegUnit = $fRegUnit['RegUnit'];
                                $fetchDptIfo = mysqli_query($conn,"SELECT * FROM department where dpt_ID='$studentDpt'");
                                $rowDpt = mysqli_fetch_assoc($fetchDptIfo);                            
                                $minCourseUnit = $rowDpt['minCourseUnit'];     

                                // $sqlStLev="SELECT * FROM studentslevel  where matricNo = '$matricNo' AND session = '$session' and semester = '$semester' ";
                                //     $result_stLev=mysqli_query($conn,$sqlStLev);
                                //     $row=mysqli_fetch_array($result_stLev);

                    $html.='
                        <tr style="color: '.$print_color.';">
                            <td width="30" >'.$i.'</td>
                            <td width="70">'.$row['matricNo'].'</td>
                            <td width="234">
                            <table>
                            ';
                    $mi=0;
                    $totalITem =0;
                    $sql2="SELECT rawscore.courseCode, total, grade, curriculumUnit FROM rawscore INNER JOIN curriculum ON rawscore.courseCode = curriculum.courseCode  where matricNo = '$matricNo' and dpt_ID='$studentDpt' AND session = '$session' and rawscore.semester = '$semester' and approvalStatus = 'Approved' and HodApproval = 'Approved' and regdate!='' $studentCurr order by rawscore.courseCode asc";
                              $result_status2=mysqli_query($conn,$sql2);
                               if(($lastItem=mysqli_num_rows($result_status2)) > 0){

                                //if ($RegUnit>=$minCourseUnit) {
                                      while($rows=mysqli_fetch_array($result_status2))
                                      {
                                        $totalITem++;

                                        if ($mi==0) {
                                           $html .= '<tr>
                                           ';
                                        }
                                        $mi++;
                                        $html .= '<td><span>'. $rows['courseCode']. " <br/>(" .$rows['curriculumUnit']. "):  <br/>" .$rows['total'].$rows['grade'].' </span> </td>
                                        ';
                                        $myCourseCode = $rows['courseCode'];
                                        $arrayData = array("$myCourseCode");
                                        $getDup = join(",", $arrayData);
                                        $uniqueCourse[$getDup] = true;
                                        if ($mi>4) {
                                           $html.= '</tr>
                                           ';
                                           $mi=0;
                                        } elseif ($totalITem==$lastItem) {
                                             $html.= '</tr>
                                           ';
                                           $mi=0;
                                        }
                                        }
                                     // } else {
                                        //$html .= '<tr>NR</tr>';
                                      //}


                              } else {
                                $html .= '<tr>NR</tr>';
                              }


                    





                    $html.='
                            </table>
                            </td> 
                            <td width="30">'.$row['semRemark'].'</td>';

                    //REGISTERED BUT FAILED //COURSE IN YOUR CURR AND YOU FAIL
                        // $myCourseRep = array();
                        // $getFirstStatusRegFail =0;
                        // $fetchCurr2 = mysqli_query($conn,"SELECT * FROM curriculum  where curriculumLevel <= '$pc_id' $studentCurr and dpt_ID='$studentDpt'");
                        // while ($fet2 = mysqli_fetch_assoc($fetchCurr2)) {
                        //           $curCourse = $fet2['courseCode'];
                        //           $curLev = $fet2['curriculumLevel'];
                        //           $curSem = $fet2['semester'];
                        //           $curlevelSem = $curLev.$curSem;
                        //       if ($peakLevel!=$pc_id) {
                        //       if ($curlevelSem <= $levelSem) {
                        //         $myCourseRep[] = $fet2['courseCode'];
                        //       }
                        //     } else {
                        //       $myCourseRep[] = $fet2['courseCode'];
                        //     }
                        //     }
                        // $carryOver = "'" . implode("', '", $myCourseRep ) . "'";

                  $html.='<td width="74">';

                  $sr_courses = array();
                  $seme_rep = mysqli_query($conn,"SELECT rawscore.courseCode,courseRemark FROM rawscore where matricNo = '$matricNo' AND session = '$session' and rawscore.semester = '$semester' and courseRemark!='PASS' and approvalStatus = 'Approved' and HodApproval = 'Approved' and (regdate!='' || regdate is not null) and rawscore.courseCode IN (SELECT DISTINCT courseCode FROM curriculum WHERE curriculumLevel = '$pc_id' $studentCurr and semester  = '$semester' and dpt_ID='$studentDpt')");
                  while ($fetchrowout = mysqli_fetch_array($seme_rep)) {
                    $curCourse = $fetchrowout['courseCode'];
                    $sr_courses[] = $fetchrowout['courseCode'];
                    $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                    $myCourseCode = $curCourse;
                    $arrayData = array("$myCourseCode");
                    $getDup = join(",", $arrayData);
                    $uniqueCourse[$getDup] = true;
                     }
                    $sr_courses_array_converter = "'" . implode("', '", $sr_courses ) . "'";













                        //                    $fetchRawScore2 = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' AND session <= '$session' and courseRemark!='PASS' and approvalStatus = 'Approved' and HodApproval = 'Approved' and regdate!='' and rawscore.courseCode IN (". $carryOver .") group by courseCode");
                        //  while ($fetchrowout = mysqli_fetch_array($fetchRawScore2)) {
                        //           $curCourse = $fetchrowout['courseCode'];
                        //           $curSess = $fetchrowout['session'];
                        //           $curSem = $fetchrowout['semester'];
                                  
                        //           $curSessSem = $curSess.$curSem;
                        //           if ($curSessSem==$SessionSem) {
                        //             $ftchHigher1 = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' and rawscore.courseCode='$curCourse'  and rawscore.session <= '$session' and regdate!='' and approvalStatus='Approved' and HodApproval = 'Approved' and courseRemark='PASS'");
                        //                     if (mysqli_num_rows($ftchHigher1) >0) {
                        //                       $getSem = mysqli_fetch_assoc($ftchHigher1);
                        //                       $getResultSession = $getSem['session'];
                        //                       $getResultSem = $getSem['semester'];
                        //                       $analyszeSessSem = $getResultSession.$getResultSem;
                        //                       if ($analyszeSessSem<=$SessionSem) {
                        //                         # code...
                        //                       } else {

                        //                         $getFirstStatusRegFail++;
                        //                         $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                        //                         $myCourseCode = $curCourse;
                        //                             $arrayData = array("$myCourseCode");
                        //                             $getDup = join(",", $arrayData);
                        //                             $uniqueCourse[$getDup] = true;
                        //                       }


                        //                     } else {
                        //             $getFirstStatusRegFail++;
                        //              $getFirstStatusRegFail++;
                        //             $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                        //                 $myCourseCode = $curCourse;
                        //                 $arrayData = array("$myCourseCode");
                        //                 $getDup = join(",", $arrayData);
                        //                 $uniqueCourse[$getDup] = true;
                        //           }
                                    
                        //           }

                        // }




                  $html.='</td>';




                    $html.='<td width="147">';



                    $check_not_reg = mysqli_query($conn,"SELECT courseCode, curriculumLevel, semester  FROM curriculum  where (curriculumLevel < '$pc_id' || (curriculumLevel = '$pc_id' and semester<='$semester'))  $studentCurr and dpt_ID='$studentDpt' and courseStatus!='Elective' and curriculum.courseCode NOT IN (SELECT DISTINCT courseCode FROM rawscore where matricNo = '$matricNo' AND session <= '$session' and approvalStatus = 'Approved' and HodApproval = 'Approved' and (regdate!=''|| regdate is not null)) order by curriculumLevel asc, courseCode asc");
                        while ($fetchrowout = mysqli_fetch_array($check_not_reg)) {
                          $curCourse = $fetchrowout['courseCode'];
                          $html.='<span>['. $curCourse.'-NR]  </span>';
                          $myCourseCode = $curCourse;
                          $arrayData = array("$myCourseCode");
                          $getDup = join(",", $arrayData);
                          $uniqueCourse[$getDup] = true;
                      }

                      $check_failed_courses = mysqli_query($conn,"SELECT courseCode,courseRemark FROM rawscore where matricNo = '$matricNo' AND (session < '$session' || (session = '$session' and semester<='$semester')) and session>='$DEntryMode'  and approvalStatus = 'Approved' and HodApproval = 'Approved' and (regdate!='' || regdate is not null) and courseRemark!='PASS' and courseCode NOT IN (SELECT DISTINCT courseCode FROM rawscore WHERE matricNo = '$matricNo' and approvalStatus = 'Approved' and HodApproval = 'Approved' AND courseRemark='PASS' and (session < '$session' || (session = '$session' and semester<='$semester')) and session>='$DEntryMode') and rawscore.courseCode IN (SELECT DISTINCT courseCode FROM curriculum WHERE curriculumLevel <= '$pc_id' $studentCurr and dpt_ID='$studentDpt') and rawscore.courseCode NOT IN (". $sr_courses_array_converter .")   group by courseCode order by session asc, semester asc, courseCode asc");
                                while ($fetchrowout = mysqli_fetch_array($check_failed_courses)) {
                                  $curCourse = $fetchrowout['courseCode'];
                                   $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                                                $myCourseCode = $curCourse;
                                                    $arrayData = array("$myCourseCode");
                                                    $getDup = join(",", $arrayData);
                                                    $uniqueCourse[$getDup] = true;
                                  
                                }
                      









                        //  $myCourse = array();
                        // $getFirstStatusNR = 0;
                        //  $fetchRawScore = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' AND session <= '$session' and approvalStatus = 'Approved' and regdate!='' and HodApproval = 'Approved'");
                        //     while ($fet = mysqli_fetch_assoc($fetchRawScore)) {
                        //           $curCourse = $fet['courseCode'];
                        //           $curSess = $fet['session'];
                        //           $curSem = $fet['semester'];
                                  
                        //           $curSessSem = $curSess.$curSem;
                        //           if ($curSessSem<=$SessionSem) {
                        //             $myCourse[] = $fet['courseCode'];
                        //           }
                        //     }

                        // $filterExisting = "'" . implode("', '", $myCourse ) . "'";
                        // $fetchCurr = mysqli_query($conn,"SELECT * FROM curriculum  where curriculumLevel <= '$pc_id' $studentCurr and dpt_ID='$studentDpt' and courseStatus!='Elective' and curriculum.courseCode NOT IN (". $filterExisting .")");
                        // while ($fetchrowout = mysqli_fetch_array($fetchCurr)) {
                        //           $curCourse = $fetchrowout['courseCode'];
                        //           $curLev = $fetchrowout['curriculumLevel'];
                        //           $curSem = $fetchrowout['semester'];
                        //           $curlevelSem = $curLev.$curSem;
                        //   if ($curlevelSem <= $levelSem) {
                        //     $getFirstStatusNR++;

                        //      $html.='<span>['. $curCourse.'-NR]  </span>';
                        //                 $myCourseCode = $curCourse;
                        //                 $arrayData = array("$myCourseCode");
                        //                 $getDup = join(",", $arrayData);
                        //                 $uniqueCourse[$getDup] = true;
                        //   }
                        // }


//REGISTERED BUT FAILED //COURSE IN YOUR CURR AND YOU FAIL


                        //  $fetchRawScore2 = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' AND session <= '$session' and courseRemark!='PASS' and approvalStatus = 'Approved' and HodApproval = 'Approved' and regdate!='' and rawscore.courseCode IN (". $carryOver .") group by courseCode");
                        //  while ($fetchrowout = mysqli_fetch_array($fetchRawScore2)) {
                        //           $curCourse = $fetchrowout['courseCode'];
                        //           $curSess = $fetchrowout['session'];
                        //           $curSem = $fetchrowout['semester'];
                                  
                        //           $curSessSem = $curSess.$curSem;
                        //           if ($curSessSem<$SessionSem) {
                        //             $ftchHigher1 = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' and rawscore.courseCode='$curCourse'  and rawscore.session <= '$session' and regdate!='' and approvalStatus='Approved' and HodApproval = 'Approved' and courseRemark='PASS'");
                        //                     if (mysqli_num_rows($ftchHigher1) >0) {
                        //                       $getSem = mysqli_fetch_assoc($ftchHigher1);
                        //                       $getResultSession = $getSem['session'];
                        //                       $getResultSem = $getSem['semester'];
                        //                       $analyszeSessSem = $getResultSession.$getResultSem;
                        //                       if ($analyszeSessSem<=$SessionSem) {
                        //                         # code...
                        //                       } else {

                        //                         $getFirstStatusRegFail++;
                        //                         $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                        //                         $myCourseCode = $curCourse;
                        //                             $arrayData = array("$myCourseCode");
                        //                             $getDup = join(",", $arrayData);
                        //                             $uniqueCourse[$getDup] = true;
                        //                       }


                        //                     } else {
                        //             $getFirstStatusRegFail++;
                        //              $getFirstStatusRegFail++;
                        //             $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                        //                 $myCourseCode = $curCourse;
                        //                 $arrayData = array("$myCourseCode");
                        //                 $getDup = join(",", $arrayData);
                        //                 $uniqueCourse[$getDup] = true;
                        //           }
                                    
                        //           }

                        // }


 ?>                       
<!-- 
                          //COURSE NOT IN YOUR CURRICULUM AND YOU REG BUT FAILED
                          $myCourseRep = array();
                          $getFirstStatusCurNotRegYesFail=0;
                        $fetchCurr3 = mysqli_query($conn,"SELECT courseCode FROM curriculum  where curriculumLevel <= '$pc_id' $studentCurr and dpt_ID='$studentDpt'");
                        while ($fet2 = mysqli_fetch_assoc($fetchCurr3)) {
                                  $curCourse = $fet2['courseCode'];
                                  $curLev = $fet2['curriculumLevel'];
                                  $curSem = $fet2['semester'];
                                  $curlevelSem = $curLev.$curSem;
                              if ($curlevelSem <= $levelSem) {
                                $myCourseRep[] = $fet2['courseCode'];
                              }

                            }
                        $filterExisting = "'" . implode("', '", $myCourseRep ) . "'";
                         $fetchRawScore3 = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' AND session <= '$session'  and courseRemark!='PASS' and approvalStatus = 'Approved' and regdate!='' and rawscore.courseCode NOT IN (". $filterExisting .") group by courseCode");
                         while ($fetchrowout = mysqli_fetch_array($fetchRawScore3)) {
                                  $curCourse = $fetchrowout['courseCode'];
                                  $curSess = $fetchrowout['session'];
                                  $curSem = $fetchrowout['semester'];

                                  $curSessSem = $curSess.$curSem;
                                  if ($curSessSem<=$SessionSem) {
                                    $ftchHigher1 = mysqli_query($conn,"SELECT * FROM rawscore where matricNo = '$matricNo' and rawscore.courseCode='$curCourse'  and rawscore.session <= '$session' and semester<=$semester and regdate!='' and approvalStatus='Approved' and courseRemark='PASS'");
                                            if (mysqli_num_rows($ftchHigher1) >0) {
                                              $getSem = mysqli_fetch_assoc($ftchHigher1);
                                              $getResultSession = $getSem['session'];
                                              $getResultSem = $getSem['semester'];
                                              $analyszeSessSem = $getResultSession.$getResultSem;
                                              if ($analyszeSessSem<=$SessionSem) {
                                                # code...
                                              } else {
                                                $getFirstStatusCurNotRegYesFail++;
                                                $html.= '<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                                                    $myCourseCode = $curCourse;
                                                    $arrayData = array("$myCourseCode");
                                                    $getDup = join(",", $arrayData);
                                                    $uniqueCourse[$getDup] = true;
                                              }


                                            } else {
                                    $getFirstStatusCurNotRegYesFail++;
                                    $html.= '<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                                        $myCourseCode = $curCourse;
                                        $arrayData = array("$myCourseCode");
                                        $getDup = join(",", $arrayData);
                                        $uniqueCourse[$getDup] = true;
                                      }

                                    
                                  }

                        }

                        -->

                        <?php
                        
                        


                             $html.='</td>
                            


                            <td width="28"> '.$row['currentTCP'].' </td>
                            <td width="28" style="color: '.$print_color.';"> '.$row['currentTLU'].' </td>
                            <td width="28"> '.$row['currentTUP'].' </td>
                            <td width="28"> '.number_format($row['currentGPA'],2).' </td>
                            <td width="28"> '.$row['prevTCP'].' </td>
                            <td width="28"> '.$row['prevTLU'].' </td>
                            <td width="28"> '.$row['prevTUP'].' </td>
                            <td width="28"> '.number_format($row['prevGPA'],2).' </td>
                            <td width="28"> '.$row['totalTCP'].' </td>
                            <td width="28"> '.$row['totalTLU'].' </td>
                            <td width="28"> '.$row['totalTUP'].' </td>
                            <td width="28"> '.number_format($row['totalGPA'],2).' </td>
                            <td width="35">'.$row['curRemark'].'</td>

                        </tr>

                      



';
  
 

                        }
 $html.='</table>

                        <style>
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {background-color: #f2f2f2;}
</style>


';

$pdf->writeHTMLCell(192,0,15,'',$html,0,1);
$pdf->  Ln(5);







$cleave = mysqli_query($conn, "SELECT students.matricNo, requestedType, dpt_ID, EntryYear, sub_dpt_ID, entrymode FROM  students INNER JOIN leave_of_absence ON students.matricNo = leave_of_absence.matricNo where leave_of_absence.absenceSession = '$session' and (leave_of_absence.absenceSemester = '$semester' || leave_of_absence.absenceSemester = '') and leave_of_absence.appliedLevel = '$pc_id' and students.dpt_ID='$dpt_ID' and students.sub_dpt_ID='$sub_dpt_ID' and leave_of_absence.status='Approved'");
if(mysqli_num_rows($cleave)>0){
    $pdf -> SetFont ("helvetica", 'B', 8);
$pdf->Write(0, "LEAVE OF ABSENCE");
$pdf -> SetFont ("helvetica", '', 8);
$pdf->  Ln(5);
$html= '

           <table  cellspacing="0" cellpadding="1" border="1">
                    <thead>
                       <tr >
                            <th width="30"  rowspan="2" ><b>S/N</b></th>
                            <th width="70" rowspan="2" ><b>REG NO</b></th>
                            <th width="234" rowspan="2" ><b>CURRENT SEMESTER</b></th>
                            <th rowspan="2"  width="30"><b>SEM RMK</b></th>
                            <th width="74" rowspan="2" ><b>SEM REPEAT</b></th>
                             <th width="147" rowspan="2" ><b>OUTSTANDING COURSES</b></th>
                            
                            
                            <th colspan="4" width="112" ><b>PRESENT</b></th>
                            <th colspan="4" width="112" ><b>PREVIOUS</b></th>
                            <th colspan="4" width="112" ><b>CUMULATIVE</b></th>
                            <th rowspan="2" width="35"><b>RMK</b></th>
                        </tr>
                        <tr>
                            <th ><div>TCP</div></th>
                            <th ><div>TLU</div></th>
                            <th ><div>TUP</div></th>
                            <th ><div>GPA</div></th>
                            <th ><div>TCP</div></th>
                            <th ><div>TLU</div></th>
                            <th ><div>TUP</div></th>
                            <th ><div>GPA</div></th>
                            <th ><div>TCP</div></th>
                            <th ><div>TLU</div></th>
                            <th ><div>TUP</div></th>
                            <th ><div>GPA</div></th>                            
                        </tr>
                        </thead>';


while ($row = mysqli_fetch_array($cleave)) {


    $matricNo = $row['matricNo'];
                                $studentDpt = $row['dpt_ID'];
                                $studentLev = $pc_id;

                                $levelSem = $studentLev.$semester;
                                $SessionSem = $session.$semester;
                                $i++;

                                $EntryYear =$DEntryMode = $row['EntryYear'];
                                $entrymode = $row['entrymode'];

                                $sub_dpt_ID=$row['sub_dpt_ID'];


                                $entrymode = $row['entrymode'];
                                if (($studentLev==1) and $entrymode=='TRANSFER') {$entrymode = 'UTME';} 
                                if (($studentLev>'1' and empty($row['transferEntryYearStart'])) || ($studentLev>=$row['transferEntryYearStart'] and !empty($row['transferEntryYearStart'])) and !empty($row['transferEntryYear'])) {$EntryYear = $row['transferEntryYear'];}

                                $maxUnit = get_students_max_info('maxUnit', $studentDpt, $sub_dpt_ID, $pc_id,$semester,$entrymode,$conn); //defaultUnit minUnit maxUnit courseDuration
                                //$minUnit = get_students_max_info('minUnit', $studentDpt, $sub_dpt_ID, $pc_id,$semester,$entrymode,$conn); //defaultUnit minUnit maxUnit courseDuration

                                $print_color = "black; background: white;";
                                if (($maxUnit<$row['currentTLU']) || $row['currentTLU']<12) {$print_color= "red; background:yellow; font-style: bold";}

                                if ($entrymode=='UTME') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and putmeCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } elseif ($entrymode=='DIRECT ENTRY') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and deCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } elseif ($entrymode=='TRANSFER') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and transferCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } elseif ($entrymode=='PREDEGREE') {
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and putmeCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                } else{
                                  $studentCurr = "and curriculum.sub_dpt_ID='$sub_dpt_ID' and putmeCurriculum='Yes' and ($EntryYear between startYear and endYear)";
                                }
                       
                        $html.='<tr style="color:">
                            <td width="30" >'.$i.'</td>
                            <td width="70">'.$row['matricNo'].'</td>
                            <td width="234">
                            '.$row['requestedType'].'
                            </td> 
                            <td width="30">NR</td>';

                   
                  $html.='<td width="74"></td>';




                    $html.='<td width="147">';



                    $check_not_reg = mysqli_query($conn,"SELECT courseCode, curriculumLevel, semester  FROM curriculum  where (curriculumLevel < '$pc_id' || (curriculumLevel = '$pc_id' and semester<='$semester'))  $studentCurr and dpt_ID='$studentDpt' and courseStatus!='Elective' and curriculum.courseCode NOT IN (SELECT DISTINCT courseCode FROM rawscore where matricNo = '$matricNo' AND session <= '$session' and approvalStatus = 'Approved' and HodApproval = 'Approved' and (regdate!=''|| regdate is not null)) order by curriculumLevel asc, courseCode asc");
                        while ($fetchrowout = mysqli_fetch_array($check_not_reg)) {
                          $curCourse = $fetchrowout['courseCode'];
                          $html.='<span>['. $curCourse.'-NR]  </span>';
                          $myCourseCode = $curCourse;
                          $arrayData = array("$myCourseCode");
                          $getDup = join(",", $arrayData);
                          $uniqueCourse[$getDup] = true;
                      }

                      $check_failed_courses = mysqli_query($conn,"SELECT courseCode,courseRemark FROM rawscore where matricNo = '$matricNo' AND (session < '$session' || (session = '$session' and semester<='$semester')) and session>='$DEntryMode'  and approvalStatus = 'Approved' and HodApproval = 'Approved' and (regdate!='' || regdate is not null) and courseRemark!='PASS' and courseCode NOT IN (SELECT DISTINCT courseCode FROM rawscore WHERE matricNo = '$matricNo' and approvalStatus = 'Approved' and HodApproval = 'Approved' AND courseRemark='PASS' and (session < '$session' || (session = '$session' and semester<='$semester')) and session>='$DEntryMode') and rawscore.courseCode IN (SELECT DISTINCT courseCode FROM curriculum WHERE curriculumLevel <= '$pc_id' $studentCurr and dpt_ID='$studentDpt') and rawscore.courseCode NOT IN (". $sr_courses_array_converter .")   group by courseCode order by session asc, semester asc, courseCode asc");
                                while ($fetchrowout = mysqli_fetch_array($check_failed_courses)) {
                                  $curCourse = $fetchrowout['courseCode'];
                                   $html.='<span>['. $curCourse.'-'.$fetchrowout['courseRemark'].']  </span>';
                                                $myCourseCode = $curCourse;
                                                    $arrayData = array("$myCourseCode");
                                                    $getDup = join(",", $arrayData);
                                                    $uniqueCourse[$getDup] = true;
                                  
                                }
                      

$rsl = mysqli_fetch_assoc(mysqli_query($conn, "SELECT totalTCP,totalTLU, totalTUP, totalGPA,curRemark FROM studentslevel where matricNo = '$matricNo' and (session < '$session'  || (session='$session' and semester<'$semester')) ORDER BY session DESC, semester DESC limit 1"));




                             $html.='</td>
                            


                            <td width="28"> 0 </td>
                            <td width="28" style="color:"> 0 </td>
                            <td width="28"> 0</td>
                            <td width="28"> 0.00</td>
                            <td width="28"> '.$rsl['totalTCP'].' </td>
                            <td width="28"> '.$rsl['totalTLU'].' </td>
                            <td width="28"> '.$rsl['totalTUP'].' </td>
                            <td width="28"> '.number_format($rsl['totalGPA'],2).' </td>
                            <td width="28"> '.$rsl['totalTCP'].' </td>
                            <td width="28"> '.$rsl['totalTLU'].' </td>
                            <td width="28"> '.$rsl['totalTUP'].' </td>
                            <td width="28"> '.number_format($rsl['totalGPA'],2).' </td>
                            <td width="35">'.$rsl['curRemark'].'</td>

                        </tr>
';
  
 

                        }
 $html.='</table>

                        <style>
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {background-color: #f2f2f2;}
</style>

';


$pdf->writeHTMLCell(192,0,15,'',$html,0,1);
$pdf->  Ln(10);
}



//$pdf->writeHTML($html,true, false, true, false, '');
$getTotal = $pass+$CSO;




$html='<table width="300" cellspacing="0" cellpadding="2" border="1">
            <tr><td colspan="2">RESULT SUMMARY</td></tr>
            <tr><td width="200">NO EXAMINED (PASS & REP)</td><td width="100">'.$getTotal.'</td></tr>
            <tr><td width="200">PASS (PASS):</td><td width="100">'.$pass.'</td></tr>
            <tr><td width="200">REPEAT (REP)</td><td width="100">'.$CSO.'</td></tr>
            <tr><td width="200">NOT REGISTERED (NR)</td><td width="100">'.$NR1.'</td></tr>
            <tr><td width="200">NOT REGISTERED II (NR II)</td><td width="100">'.$NR2.'</td></tr>
            <tr><td width="200">CGPA WARNING (WRN)</td><td width="100">'.$WRN.'</td></tr>
            <tr><td width="200">CGPA WITHDRAWAL (WDR)</td><td width="100">'.$WDR.'</td></tr>
            <tr><td width="200">TRANSFERED (TRF)</td><td width="100">'.$TRF.'</td></tr>
            <tr><td width="200">LEAVE OF ABSENCE</td><td width="100">'.$LOA.'</td></tr>
            <tr><td width="200">PROBATION (PROB)</td><td width="100">'.$PROB.'</td></tr>
            <tr><td width="200">TERMINATION OF STUDENTSHIP (TOS)</td><td width="100">'.$TOS.'</td></tr>
            <tr><td width="200">TOTAL</td><td width="100">'.$numEXamined.'</td></tr>
            ';

//$pdf->writeHTMLCell(180,0,15,'',$html,0,1);


//$pdf->resetColumns();
//$pdf->setEqualColumns(2,84);
//$pdf->selectColumn();

$pdf -> SetFont ("helvetica", B, 11);
$pdf -> Cell(115, 5, "RESULT SUMMARY", 1, 1,C );
$pdf -> SetFont ("helvetica", '', 9);
$pdf -> Cell(80, 5, "NO EXAMINED (PASS & REP)", 1, 0);
$pdf -> Cell(35, 5, "{$getTotal}", 1, 1);

$pdf -> Cell(80, 5, "PASS (PASS):", 1, 0);
$pdf -> Cell(35, 5, "{$pass}", 1, 1);
$pdf -> Cell(80, 5, "REPEAT (REP)", 1, 0);
$pdf -> Cell(35, 5, "{$CSO}", 1, 1);


$pdf -> Cell(80, 5, "NOT REGISTERED (NR)", 1, 0);
$pdf -> Cell(35, 5, "{$NR1}", 1, 1);

$pdf -> Cell(80, 5, "NOT REGISTERED II (NR II)", 1, 0);
$pdf -> Cell(35, 5, "{$NR2}", 1, 1);


$pdf -> Cell(80, 5, "CGPA WARNING (WRN)", 1, 0);
$pdf -> Cell(35, 5, "{$WRN}", 1, 1);
$pdf -> Cell(80, 5, "CGPA WITHDRAWAL (WDR)", 1, 0);
$pdf -> Cell(35, 5, "{$WDR}", 1, 1);


$pdf -> Cell(80, 5, "TRANSFERED (TRF)", 1, 0);
$pdf -> Cell(35, 5, "{$TRF}", 1, 1);
$pdf -> Cell(80, 5, "LEAVE OF ABSENCE", 1, 0);
$pdf -> Cell(35, 5, "{$LOA}", 1, 1);


$pdf -> Cell(80, 5, "PROBATION (PROB)", 1, 0);
$pdf -> Cell(35, 5, "{$PROB}", 1, 1);
$pdf -> Cell(80, 5, "TERMINATION OF STUDENTSHIP (TOS)", 1, 0);
$pdf -> Cell(35, 5, "{$TOS}", 1, 1);
$pdf -> Cell(80, 5, "TOTAL", 1, 0);
$pdf -> Cell(35, 5, "{$numEXamined}", 1, 1);
$pdf->  Ln(1);




$style = array(
    'vpadding' => 'auto',
    'hpadding' => 'auto',
    'fgcolor' => array(0,0,0),
    'bgcolor' => false, //array(255,255,255)
    'module_width' => 1, // width of a single module in points
    'module_height' => 1 // height of a single module in points
);
$pc_id = $_GET['lev'];






//$pdf->resetColumns();
$pdf->  Ln(8);


$pdf->SetFont('Times','B', 9);
        //$pdf -> Cell(55, 5, "_____________________________", 0, 0, C);
        //$pdf -> Cell(55, 5, "_____________________________", 0, 0, C);
      //$pdf -> Cell(55, 5, "_____________________________", 0, 1, C);
      //$pdf -> Cell(100, 5, "H.O.D Signature & Stamp", 0, 0, C);
      //$pdf -> Cell(100, 5, "Accountant Signature & Stamp", 0, 1, C);

       $rowhod = mysqli_fetch_array(mysqli_query($conn,"SELECT * from staffs  where staffID ='$hod'"));
       $hodName = $rowhod['title'].' '.$rowhod['name'];

       $rowDean = mysqli_fetch_array(mysqli_query($conn,"SELECT * from staffs  where staffID ='$dean'"));
       $deanName = $rowDean['title'].' '.$rowDean['name'];

      //$pdf -> Cell(55, 5, "{$hodName}", 0, 0, C);
      //$pdf -> Cell(55, 5, "{$deanName}", 0, 0, C);
      //$pdf -> Cell(55, 5, "MR. O.O. OSO", 0, 1, C);

      //$pdf -> Cell(55, 5, "H.O.D, {$dptName}", 0, 0, C);
      //$pdf -> Cell(55, 5, "DEAN, {$facName}", 0, 0, C);
      //$pdf -> Cell(55, 5, "Director (Academic)", 0, 1, C);
      //$pdf->  Ln(10);

       $html='<table width="500" cellspacing="0" cellpadding="2" border="0">
            <tr><td width="300" align="center">_____________________________<br/>'.$hodName.'<br/>HOD, '.$dptName.'</td><td width="300" align="center">_____________________________<br/>'.$deanName.'<br/>DEAN, '.$facName.'</td> <td width="300" align="center">_____________________________<br/>DR. SOLA OGUNGBENLE<br/>Director (Academic Plannning)</td></tr>';
$pdf->writeHTMLCell(180,0,15,'',$html,0,1);
      $pdf->  Ln(10);
$pdf->write2DBarcode('http://eksuportal.eksu.edu.ng/staff.php#/senate/result_approval?lev='.$pc_id.'&sub_dpt='.$sub_dpt_ID.'&sess='.$session.'&sem='.$semester.'&gD='.$getDate, 'QRCODE,L', 250, 0, 32, 32, $style, '');
      

$pdf->AddPage();

$pdf -> SetFont ("helvetica", 'BU', 12);
$pdf -> Cell(0, 5, "KEY TO COURSES", 0, 1, 'C');
$pdf ->ln(5);
$pdf -> SetFont ("helvetica", 'B', 9);
$pdf -> Cell(50, 8, "", 0, 0);
                          $pdf -> Cell(10, 8, "S/N", 1, 0);
                          $pdf -> Cell(20, 8, "Code", 1, 0);
                          $pdf -> Cell(120, 8, "Course Title", 1, 0);
                          $pdf -> Cell(10, 8, "Unit", 1, 1,C);

$pdf -> SetFont ("helvetica", '', 9);


                        $filterExisting = "'" . implode("', '", array_keys($uniqueCourse) ) . "'";
                        echo $filterExisting;
                        $i=0;
                         $fetchRawScore2 = mysqli_query($conn,"SELECT  * FROM curriculum  where curriculumLevel <= '$pc_id' $studentCurr and dpt_ID='$studentDpt' and curriculum.courseCode IN (". $filterExisting .") group by curriculum.courseCode ORDER BY curriculum.courseCode asc");
                         while ($fetchrowout = mysqli_fetch_array($fetchRawScore2)) {
                          $i++;
                          $pdf -> Cell(50, 8, "", 0, 0);
                          $pdf -> Cell(10, 8, "{$i}", 1, 0);
                          $pdf -> Cell(20, 8, "{$fetchrowout['courseCode']}", 1, 0);
                          $pdf -> Cell(120, 8, "{$fetchrowout['curriculumTitle']}", 1, 0);
                          $pdf -> Cell(10, 8, "{$fetchrowout['curriculumUnit']}", 1, 1,C);
                          
                          // $pdf -> Cell(80, 5, "{$manageCo}", 0, 0, 'C');
                          //echo ;
                         }

// ---------------------------------------------------------
ob_end_clean();
//Close and output PDF document
$pdf->Output('Student Result.pdf', 'I');
 
?>