<?php
	header('Content-type: text/html; charset=UTF-8') ;
	mb_internal_encoding("UTF-8");
	include_once("../inc/header_be.php");
	include_once("../lib/validation.php");
	include_once("../inc/general.php");
	include_once("../inc/language_labels_coach.utf8.php");
	require('fpdf181/fpdf.php');

	if ($_SESSION["coach_id"] == ''){
		header('location:../index.php');
		exit;
	}
	/*if ($_SESSION["language"] == ''){
		$_SESSION["language"] = 'eng';
	}*/
	$path = $_SERVER['SCRIPT_NAME'];
	$fullfile = basename($path);
	$fullfile_arr = explode(".", $fullfile);
	$file_name = $fullfile_arr[0];
	$mailmatter = '';
	$success_msg = '';
	$survey_success_msg = '';

	$obj_config = new class_config();
	$obj_mastersettings = new class_mastersettings();
	$obj_organisation  = new class_organisation();
	$obj_project  = new class_project();
	$obj_coachee  = new class_coachee();
	$obj_coach  = new class_coach();
	$obj_admin_user	= new class_admin_user();
	$obj_survey	= new class_survey();

	$feedback_mailnotification_return_val = 0;

	if ($_SESSION["language"] == ''){
		//$_SESSION["language"] = 'eng';
		
		//$languagesfluent_id=0, $ord='', $ordfield='', $pg = 1, $numrecspg = 10, $pagination = 'N', $default = ''
		$temp_language_arr = $obj_mastersettings->list_languagesfluent(0, '', '', 1, 10, 'N', 'Y');
		$_SESSION["language"] = $temp_language_arr[0][2];
	}

	$timezone_arr = $obj_mastersettings->list_timezone();
	//echo "X" . $_REQUEST['total_schedule'] . "X";
	//print_r($timezone_arr);

	/*if (trim($_REQUEST['assignment_id']) == '399'){
		$obj_project->set_coachee_feedback(trim($_REQUEST['assignment_id']), 'Y', $_SESSION["language"]);
	}*/

	//$_REQUEST['action_todo'] = 'enable_coachee_feedback';
	if (trim($_REQUEST['action_todo']) == 'enable_coachee_feedback'){
		$feedback_mailnotification_return_val = $obj_project->set_coachee_feedback(trim($_REQUEST['assignment_id']), 'Y', $_SESSION["language"]);
		//$obj_project->update_project_coach($new_post);

		//echo "A";
		$pdf_assignment_arr = $obj_project->list_project_assignment(trim($_REQUEST['assignment_id']) );
		//print_r($pdf_assignment_arr);

		$pdf_coach_id = $pdf_assignment_arr[0][2];
		$pdf_coachee_id = $pdf_assignment_arr[0][1];

		//echo "B";
		//$invoice_arr[0][18]: Master Project ID
		$pdf_project_arr = $obj_project->list_project($pdf_assignment_arr[0][30], 0, '' , '', '', 1, 10, 'N', $pdf_coach_id);
		$pdf_coach_arr = $obj_coach->list_coach($pdf_coach_id);
		//$pdf_invoice_arr		= $obj_coach->list_invoice(trim($_REQUEST['invoice_coach_id']));

		//echo "C";
		//$project_id, $coachee_id = 0, $coach_id = 0
		$count_complete_session = $obj_project->number_session_complete($pdf_assignment_arr[0][30], $pdf_coachee_id, $pdf_coach_id);
		$count_waiting_session = $obj_project->number_session_waiting($pdf_assignment_arr[0][30], $pdf_coachee_id, $pdf_coach_id);
		//$coach_id, $project_id 
		$pdf_bank_arr = $obj_coach->list_coach_currency_bankdetail($pdf_coach_id, $pdf_assignment_arr[0][30]);
		//print_r($bank_arr);

	}
	//$obj_project->mail_attachment();
	$completed_sessions = 0;

	$schedule_status_arr = $obj_mastersettings->list_schedule_status(0, 'N');	

	if (trim($_REQUEST['mode']) == 'enablesurvey'){
		//$assignment_id, $project_type, $project_id
		
		$obj_survey->activate_default_template_by_associate(trim($_REQUEST['assignment_id']), 'C', trim($_REQUEST['project_id']));
		
		//$survey_success_msg = 'Survey activated successfully';
	}

?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
	<link rel="shortcut icon" href="<?php echo $obj_config->ssl_site_url?>images/favicon.ico" />

    
    <title>Index</title>
    <!-- Bootstrap core CSS -->
	<script src="<?php echo $obj_config->ssl_site_url?>js/jquery.js"></script>

    <link href="<?php echo $obj_config->ssl_site_url?>css/bootstrap.css" rel="stylesheet">
   
    <link href="<?php echo $obj_config->ssl_site_url?>css/style.css" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,600italic,700italic,800,400italic' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="<?php echo $obj_config->ssl_site_url?>css/jquery.selectBoxIt.css" />

	<link href="<?php echo $obj_config->ssl_site_url?>styles/jquery.datepick.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="<?php echo $obj_config->ssl_site_url?>js/jquery-confirm/css/jquery-confirm.css"/>

	<script src="<?php echo $obj_config->ssl_site_url?>js/jquery.plugin.js"></script>
	<script src="<?php echo $obj_config->ssl_site_url?>js/jquery.datepick.js"></script>
	

	<SCRIPT LANGUAGE="JavaScript">
	<!--
		$(document).ready(function() {
			$('.datepick').datepick(
					{
					dateFormat: 'dd-M-yyyy',
					yearRange: "2013:" +  <?php echo date('Y') + 2?>
				});

			});


		function add_schedule(){
			//if (validate() == true){
				$('#form_data').val('addrows');
				$('#project_schedule').submit();
			//}
		}
		
		function show_agreement(coach_rate_per_session, no_sessions, project_id, coachee_id, coach_id, currency_id, assignment_id){
			window.open("coach_agreement.php?coach_rate_per_session="+coach_rate_per_session+"&no_sessions="+no_sessions+"&project_id="+project_id+"&coachee_id="+coachee_id+"&coach_id="+coach_id+"&currency_id="+currency_id+"&assignment_id="+assignment_id, "agreement", "status=1,width=800,height=480");
		}


		function show_learner(coachee_id){
			window.open("coachee_details.php?coachee_id="+coachee_id, "agreement", "status=1,width=900,height=500");
		}

		function cancel_func(){
			location.href = 'coach_dashboard.php?assignment_id=<?php echo trim($_REQUEST["assignment_id"])?>';
		}

		
		function show_feedback(assignment_id){
			window.open("coachee_feedback.php?assignment_id="+assignment_id, "agreement", "status=1,width=800,height=650");
		}

		function show_nondelivery_assignments(project_id){
			window.open("project_nondelivery_and_assignments.php?&project_id="+project_id, "nondelivery", "status=1,width=1200,height=480");
		}

		function show_survey(project_id){
			window.open("learner_survey_list.php?&project_id="+project_id, "nondelivery", "status=1,width=1200,height=480");
		}
	//-->
	</SCRIPT>
	
</head>
<body>
	<div id="wrap">
		<?php include_once('../inc/coach_header.php'); ?>

		<div class="container">
			<?php include_once('coach_sub_heading.php'); ?>
			
			<?php
				//$show_assigment_id = 15;
				if (trim($_REQUEST['assignment_id']) <> ""){
					$show_assigment_id = trim($_REQUEST['assignment_id']);
				}else{
					$_REQUEST['assignment_id'] = trim($show_assigment_id);
				}
				//echo "X" . $show_assigment_id . "X";

				if (trim($_REQUEST['form_data']) == 'yes' && trim($_REQUEST['action_todo']) == ''){
					array_walk($_POST, 'copy_array');
					array_walk($new_post, 'put_slash');
					//echo "X" . trim($_REQUEST['form_data']) . "X" . trim($_REQUEST['action_todo']) . "X" . trim($_FILES['coachee_feedback_doc']['tmp_name']) . "X";
				
					if (trim($_FILES['coachee_feedback_doc']['tmp_name']) <> ""){
						$target_path = $obj_config->resource_file_dir . '/feedback/coaching/';
						$upload_file_name = time() . basename($_FILES['coachee_feedback_doc']['name']) ;

						$target_path = $target_path . $upload_file_name; 

						move_uploaded_file($_FILES['coachee_feedback_doc']['tmp_name'], $target_path);
						
						//$assignment_id, $coachee_feedback_doc, $from_admin = '', $coachee_feedback_upload_user_id = 0, $user_type_id  = 5
						$obj_project->set_coachee_feedback_doc(trim($_REQUEST['assignment_id']), $upload_file_name,  '', $_SESSION["coach_id"], 4);
						$coachee_feedback_success_msg = 'Y'; //
					}

					if (trim($_FILES['coachee_objective_agreement_doc']['tmp_name']) <> ""){
						$target_path = $obj_config->resource_file_dir;
						$upload_file_name = time() . basename($_FILES['coachee_objective_agreement_doc']['name']) ;

						$target_path = $target_path . $upload_file_name; 

						move_uploaded_file($_FILES['coachee_objective_agreement_doc']['tmp_name'], $target_path);
						
						//$assignment_id, $coachee_objective_agreement_doc, $coachee_objective_upload_user_id = 0, $coachee_objective_upload_user_type_id  = 4
						$obj_project->update_project_coachee_by_coach(trim($_REQUEST['assignment_id']), $upload_file_name,  $_SESSION["coach_id"], 4);
						$coachee_feedback_success_msg = 'Y'; //
					}
				
				}
				//echo "X" . $success_msg . "X";

	
				if ($show_assigment_id <> ''){

					if (trim($_REQUEST['mode']) == "del"){
						$obj_project->delete_schedule(trim($_REQUEST['schedule_id']));
						$success_msg = 'Schedule deleted successfully';
					}

					if (trim($_SESSION['from_popup']) <> ''){
						$_SESSION['from_popup'] = '';
					}else{
						if (trim($_REQUEST['form_data']) == "yes" || trim($_REQUEST['form_data']) == "addrows"){
							array_walk($_POST, 'copy_array');
							array_walk($new_post, 'put_slash');
		
							
							if (trim($_REQUEST['project_status']) == 3){
								$new_post['created_by'] = $_SESSION["coach_id"]; 
								$new_post['update_user_type'] = 'C'; 
								$new_post['language'] = $_SESSION["language"];
								$mailmatter = $obj_project->add_schedule($new_post);
								$success_msg = 'Schedule set successfully';

								for ($ctr = 0; $ctr <= $_REQUEST['total_schedule']; $ctr++){
									$_REQUEST['schedule_no_'.$ctr] = '';
									$_REQUEST['schedule_date_'.$ctr] = '';
									$_REQUEST['schedule_time_start_'.$ctr] = '';
									$_REQUEST['schedule_time_end_'.$ctr] = '';
									$_REQUEST['schedule_status_'.$ctr] = '';
									$_REQUEST['coach_comment_'.$ctr] = '';
									$_REQUEST['timezone_'.$ctr] = '';
								}
							}
							
							if (trim($_REQUEST['form_data']) <> 'addrows'){
				?>
								<SCRIPT LANGUAGE="JavaScript">
								<!--
									location.href = 'coach_dashboard.php?assignment_id=<?php echo $_REQUEST["assignment_id"]?>&coachee_feedback_success_msg=<?php echo $coachee_feedback_success_msg?>';
								//-->
								</SCRIPT>
				<?php
							}
						}
					}


					$project_arr = $obj_project->list_project_assignment($show_assigment_id );

					if (trim($project_arr[0][0]) <> ''){
						$assignment_id				= trim($project_arr[0][0]); 
						$coachee_id					= trim($project_arr[0][1]); 
						$coach_id					= trim($project_arr[0][2]);   
						$project_id					= trim($project_arr[0][3]);  
						$status						= trim($project_arr[0][4]); 
						$coachee_first_name			= html_entity_decode(trim($project_arr[0][5])); 
						$coachee_last_name			= html_entity_decode(trim($project_arr[0][6])); 
						$coachee_email				= html_entity_decode(trim($project_arr[0][7]));  
						$project_name				= html_entity_decode(trim($project_arr[0][8])); 
						$exp_start_date				= trim($project_arr[0][9]);
						$coach_name					= html_entity_decode(trim($project_arr[0][10])); 
						$coach_last_name			= html_entity_decode(trim($project_arr[0][11])); 
						$coach_email				= html_entity_decode(trim($project_arr[0][12]));  
						$project_status						= trim($project_arr[0][15]);  
						$coach_agreement_done				= trim($project_arr[0][16]);   
						$coach_agreement_date				= trim($project_arr[0][17]); 
						$coachee_agreement_done				= trim($project_arr[0][18]); 
						$coachee_agreement_date				= trim($project_arr[0][19]); 
						$coachee_objective_agreement_done	= trim($project_arr[0][20]); 
						$coachee_objective_agreement_date	= trim($project_arr[0][21]); 
						$coachee_objective_agreement_doc	= trim($project_arr[0][22]); 
						$enable_coachee_feedback			= trim($project_arr[0][23]); 
						$coachee_feedback_doc				= trim($project_arr[0][24]); 
						$exp_end_date						= trim($project_arr[0][25]); 
						$coach_trained_charge				= trim($project_arr[0][26]); 
						$coachee_known_as					= trim($project_arr[0][27]); 
						$project_leader_id					= trim($project_arr[0][29]); 
						$pro_bono							= trim($project_arr[0][34]); 
						$enable_coachee_feedback_date		= trim($project_arr[0][36]); 
						$no_sessions						= $project_arr[0][46];
						$date_time_session_completed		= $project_arr[0][54];

						$coachee_arr = $obj_coachee->list_coachee(trim($project_leader_id));
						$learner_coachee_arr = $obj_coachee->list_coachee(trim($coachee_id));
					}
					$master_project_arr = $obj_project->list_project($project_id);
					$coach_trained_charge = $master_project_arr[0][8];
					$survey_name_id_for_feedback = $master_project_arr[0][67]; 
					//$no_sessions = $master_project_arr[0][25];
					$coach_rate_per_session = $master_project_arr[0][30];
					$currency_id = $master_project_arr[0][27]; 
					$org_acronym = $master_project_arr[0][33]; 
					$projecttype_id = $master_project_arr[0][42]; 
					if ($projecttype_id == 1){
						$projecttype = 'coaching';
					}else{
						$projecttype = 'workshop';
					}

					$created_by	= $master_project_arr[0][31]; 
					$project_created_by = '';
					if ($created_by > 0){
						$admin_user_arr = $obj_admin_user->list_admin_user($created_by);
						$project_created_by = $admin_user_arr[0][4];
					}

					//$org_ids, $project_leader_org_id
					$org_arr = $obj_project->list_project_org($master_project_arr[0][3], $coachee_arr[0][1]);
					$primary_org_acroynm = $org_arr[0][4];

					$checked = '';
					if ($coach_agreement_done == 'Y'){
						$checked = ' checked = "checked"';
					}

					$feedback_checked = '';
					if ($enable_coachee_feedback == 'Y'){
						$feedback_checked = ' checked = "checked"';
					}	

					$schedule_arr = $obj_project->list_schdule(0, $assignment_id);
					if (count($schedule_arr) > $session_ctr_indicator){
						$session_ctr_indicator = count($schedule_arr); 
					}

					if (trim($_REQUEST['form_data']) == "addrows"){
						$session_ctr_indicator = $session_ctr_indicator + (trim($_REQUEST['no_additional_rows']));
					}

					$project_document_arr = $obj_project->list_project_document(0, trim($project_id));

					//$assignment_id, $project_type, $project_id, $coachee_id, $template_id = 0, $default_survey_by_associate = 'Y'
					$survey_name_id = $obj_survey->check_default_survey_by_associate(trim($_REQUEST['assignment_id']), 'C', $project_id, $coachee_id, 0, 'Y'); //293 : End of Project Questionnaire 
					//echo "X" . $survey_name_id . "X";
					$survey_participant_id = 0;
					$end_of_project_questionnaire_percent = 0;
					if ($survey_name_id > 0){
						$survey_participant_id = $obj_survey->list_participant_id($survey_name_id, trim($_REQUEST['assignment_id']));
						$survey_arr = $obj_survey->list_survey($survey_name_id, '', 'Y');
						$survey_participant_name_arr = $obj_survey->list_survey_participant_name($survey_participant_id, $survey_name_id, $survey_arr[0][2]);
						$end_of_project_questionnaire_percent = round(($survey_participant_name_arr[0][7] / $survey_participant_name_arr[0][6]) * 100, 2);
					}
					
					//$assignment_id, $project_type, $project_id, $coachee_id, $template_id = 0, $default_survey_by_associate = 'Y'
					$preference_and_objectives_survey_name_id = $obj_survey->check_default_survey_by_associate(trim($_REQUEST['assignment_id']), 'C', $project_id, $coachee_id, 377, 'N'); //377 : Your Coaching Preference and Objectives 
					//echo "X" . $survey_name_id . "X";
					$preference_and_objectives_survey_participant_id = 0;
					if ($preference_and_objectives_survey_name_id > 0){
						$preference_and_objectives_survey_participant_id = $obj_survey->list_participant_id($preference_and_objectives_survey_name_id, trim($_REQUEST['assignment_id']));
						$survey_arr = $obj_survey->list_survey($preference_and_objectives_survey_name_id, '', 'Y');
						$survey_participant_name_arr = $obj_survey->list_survey_participant_name($preference_and_objectives_survey_participant_id, $preference_and_objectives_survey_name_id, $survey_arr[0][2]);
						$preference_and_objectives_percent = round(($survey_participant_name_arr[0][7] / $survey_participant_name_arr[0][6]) * 100, 2);
					}

					$coach_arr = $obj_coach->list_coach(trim($_SESSION['coach_id']));
					$preferred_language_id = $coach_arr[0][28];
					//$coachee_id = 0, $project_id = 0, $language_id = 0, $assignment_id = 0
					$coachee_survey_arr = $obj_survey->list_coachee_survey(trim($coachee_id), $project_id, $preferred_language_id, trim($_REQUEST['assignment_id']));

					if (trim($_REQUEST['mode']) == 'enablesurvey'){
						$survey_success_msg = span_accent($coach_lang[$_SESSION["language"]][$file_name][56]);
						$coachee_name = html_entity_decode($coachee_first_name) . " " . html_entity_decode($coachee_last_name);
						$survey_success_msg = str_replace('{coachee_known_as}', $coachee_name, $survey_success_msg);
					}

					//echo "X" . $project_status . "X";
			?>
					<form name="project_schedule" id="project_schedule" action="<?php echo $obj_config->ssl_site_url?>coach/coach_dashboard.php" method="post" onSubmit="return validate()" enctype="multipart/form-data" accept-charset="utf-8">
						<input type="hidden" name="form_data"  id="form_data" value="yes">
						<input type="hidden" name="project_id" id="project_id" value="<?php echo $project_id?>">
						<input type="hidden" name="assignment_id" id="assignment_id" value="<?php echo $assignment_id?>">
						<input type="hidden" name="coach_id" value="<?php echo $coach_id?>">
						<input type="hidden" name="project_status" value="<?php echo $project_status?>">
						<input type="hidden" name="action_todo" id="action_todo" value="" >

						<div class="greyBox">						
						
						<!-- Paul added a href to participant name -->		 
							<A HREF="javascript:void(0)" onclick="javascript:show_learner(<?php echo $coachee_id?>)" style="text-decoration:underline">
							<?php echo html_entity_decode($coachee_first_name) . " " . html_entity_decode($coachee_last_name)?></A> 
							
							<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][0]); ?> <?php echo $learner_coachee_arr[0][19]; //$master_project_arr[0][18]?> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][1]); ?> <?php echo html_entity_decode($project_name)?> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][2]); ?>
							<?php echo date('d/M/Y', strtotime($exp_start_date))?> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][3]); ?> <?php echo date('d/M/Y', strtotime($exp_end_date))?> 
							<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][4]); ?> <?php echo html_entity_decode($coachee_arr[0][2]) . " " . html_entity_decode($coachee_arr[0][3])?>
							<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][0]); ?> <?php echo $primary_org_acroynm; //$master_project_arr[0][18]?>
						</div>
						<div class="infoArea">
							<?php
								if ($_REQUEST['coachee_feedback_success_msg'] <> ""){
							?>
									<div style="color:#00f;text-align:center;width:100%;">
										<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][48])?>
									</div>
									<br />
							<?php
									//$_SESSION['coachee_feedback_success_msg'] = '';
								}

								if ($survey_success_msg <> ""){
							?>
									<div style="color:#00f;text-align:center;width:100%;">
										<?php echo $survey_success_msg?>
									</div>
									<br />
							<?php
								}
							?>
							<ul>
								<?php
									if ($project_created_by <> ""){
								?>
										<li>
											<?php echo $primary_org_acroynm . "&nbsp;&nbsp; Project: " . $project_name . "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" .  " Reference: Project_" . $project_id . "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" . $coach_lang[$_SESSION["language"]][$file_name][30] . " " . $project_created_by ;?>
											<?php //echo  ?>
										</li>
								<?php
									}
								?>

								<li> <!-- You have read and agree to your contract terms with TKP for this project --> 
									<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][5]); ?> <A HREF="javascript:void(0)" onClick="javascript:show_agreement('<?php echo $coach_rate_per_session?>','<?php echo $no_sessions?>','<?php echo $project_id?>', '<?php echo $coachee_id?>', '<?php echo $coach_id?>', '<?php echo $currency_id?>', '<?php echo $assignment_id?>')"><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][6]); ?></A> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][7]); ?> <?php if ($coach_agreement_done == 'Y') { ?> &nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-tick.gif' style="margin-top:-5px"> <?php }else{ ?> &nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-cross.gif' style="margin-top:-5px"> <?php } ?>
									<?php
										if ($pro_bono == 'Y'){
											echo span_accent($coach_lang[$_SESSION["language"]][$file_name][33]);
										}
									?>
								</li>
								<li><!-- Pierre Le Page status: Objectives -->
									<?php
										$class_bar = '';
										$percent_answered = 0;
										/*
										if ($survey_participant_id > 0){
											//$survey_name_id = '', $language_id = '', $survey_activated = 'N'
											$survey_arr = $obj_survey->list_survey($survey_name_id, '', 'Y');

											//$survey_participant_id = 0, $survey_name_id = '', $survey_source_id = 1
											$survey_participant_name_arr = $obj_survey->list_survey_participant_name($survey_participant_id, $survey_name_id, $survey_arr[0][2]);
											//print_r($survey_participant_name_arr);
											
											$participant_question_arr = $obj_survey->list_survey_participant_question(0, $survey_participant_id);
											//echo "X" . $survey_participant_name_arr[0][7] . "---" . $survey_participant_name_arr[0][6] . "X";
											$percent_answered = round(($survey_participant_name_arr[0][7] / $survey_participant_name_arr[0][6]) * 100, 2);
										}
										*/
										//echo "X" . $survey_participant_id . " - " . $percent_answered . "X";
										if ($coachee_objective_agreement_done == 'Y'){
											$class_bar = ' class="bar"';
									?>
											<?php echo $coachee_first_name;//$coachee_known_as?> <?php echo $coachee_last_name?> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][8]); ?>:  <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][9]); ?>
											&nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-tick.gif' style="margin-top:-5px">
									<?php
										}else{
											//IF THE PARTICIPANT HAS ONE OR MORE SURVEY ACTIVATED THEN DO NOT SHOW THE OLD STYLE "OBJECTIVES X"
											if ($coachee_survey_arr[0][0] <> ''){
									?>
												<!-- &nbsp;<img src='<?php // echo $obj_config->ssl_site_url?>images/icon-tick.gif' style="margin-top:-5px"> -->
									<?php
											}else{
												$class_bar = ' class="bar"';
									?>
												<?php echo $coachee_first_name;//$coachee_known_as?> <?php echo $coachee_last_name?> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][8]); ?>:  <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][9]); ?>
												&nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-cross.gif' style="margin-top:-5px">
									<?php
											}
										}
									?>

									<span <?php echo $class_bar?>>
										<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][10]); ?>
										<?php 
											if ($coachee_agreement_done == 'Y'){
										?>
												&nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-tick.gif' style="margin-top:-5px">
										<?php
											}else{
										?>
												&nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-cross.gif' style="margin-top:-5px">
										<?php
											}
										?>
									</span>

									<?php
										$feedback_exists_in_older_system = 0;
										//echo "X". trim($coachee_feedback_doc) . "X <br />";
										if (trim($coachee_feedback_doc) <> ''){
											$feedback_exists_in_older_system = 1;
									?>
											<span class="bar">
												<?php
													//$coachee_feedback_id = '', $coachee_id = '', $coach_id = '', $assignment_id = ''
													$temp_feedback_arr = $obj_project->list_coachee_feedback('', '', '', $_REQUEST['assignment_id']);
													if (trim($temp_feedback_arr[0][34]) == '1'){ //NEW FEEDBACK SYSTEM
												?>
														<A HREF="javascript:void(0)" onClick='javascript:show_feedback("<?php echo $_REQUEST['assignment_id']?>")'><?php echo $coachee_first_name . "'s " . span_accent($coach_lang[$_SESSION["language"]][$file_name][37]);?></A>
												<?php
													}else{
														if (file_exists($obj_config->ssl_site_url . 'upload/' . $coachee_feedback_doc)){
												?>

															<A HREF="../admin/file_download.php?filename=<?php echo $coachee_feedback_doc;?>" target=_new>															
																<?php echo $coachee_first_name . "'s " . span_accent($coach_lang[$_SESSION["language"]][$file_name][37]);?>
															</A>
												<?php
														}else{
												?>
															<A HREF="../admin/file_download.php?additional_folder=feedback/coaching/&filename=<?php echo $coachee_feedback_doc;?>" target=_new>															
																<?php echo $coachee_first_name . "'s " . span_accent($coach_lang[$_SESSION["language"]][$file_name][37]);?>
															</A>
												<?php
														}	
													}	
												?>												
												&nbsp;<img src='<?php echo $obj_config->ssl_site_url?>images/icon-tick.gif' style="margin-top:-5px">
											</span>
									<?php
										}else{
											$temp_feedback_arr = $obj_project->list_coachee_feedback('', '', '', $_REQUEST['assignment_id']);
											if (trim($temp_feedback_arr[0][34]) == '1'){ //NEW FEEDBACK SYSTEM
												$feedback_exists_in_older_system = 1;
									?>
												<A HREF="javascript:void(0)" onClick='javascript:show_feedback("<?php echo $_REQUEST['assignment_id']?>")'><?php echo $coachee_first_name . "'s " . span_accent($coach_lang[$_SESSION["language"]][$file_name][37]);?></A>
									<?php
											}
										}
									?>
								</li>
								
								<?php
									if ($project_status	<> 4 && $project_status	<> 0){ //4 - Completed, 0 - Cancelled
										if ($enable_coachee_feedback == 'Y'){
											$feedback_exists_in_older_system = 1;
											if ($enable_coachee_feedback_date <> '0000-00-00 00:00:00'){
												$enable_coachee_feedback_date_display = date('d/m/Y, H:i', strtotime($enable_coachee_feedback_date));
											}else{
												$enable_coachee_feedback_date_display = 'N/A';
											}
									?>
											<li>
												<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][35]); ?> <?php echo $enable_coachee_feedback_date_display; ?> <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][36]); ?> <?php echo $coachee_known_as?> <?php echo $coachee_last_name?> 
											</li>
									<?php
										}else{		
									?>
											<!-- <?php //echo span_accent($coach_lang[$_SESSION["language"]][$file_name][11]); ?> 
											<input type="button"  name="enable_coachee_feedback_val"  id="enable_coachee_feedback_val" value='<?php // echo span_accent($coach_lang[$_SESSION["language"]][$file_name][34]) . $coachee_first_name; ?>' onClick='javascript:enable_feedback()'> 
											<?php //echo span_accent($coach_lang[$_SESSION["language"]][$file_name][12]); ?> --> 
											<!--<?php echo $coachee_known_as?> <?php echo $coachee_last_name?>-->
								<?php
										}	
									}	
								?>	

								<?php
									//echo "X" . $feedback_exists_in_older_system  . " " . $survey_name_id . " " . $survey_name_id_for_feedback . "X";
									// echo "X" . $feedback_exists_in_older_system . "  " . $survey_name_id . "  " . $survey_name_id_for_feedback . "X";	
									if ($feedback_exists_in_older_system == 0){
										//$survey_name_id = '', $language_id = '', $survey_activated = 'N', $template = 'N', $template_for = '', $project_id = 0, $assignment_id = 0
										
										if ($survey_name_id == 0){ //SO THAT THE  DEFAULT SURVEY HAS NOT YET BEEN ACTIVATED
											if ($survey_name_id_for_feedback > 0){
								?>
												<li id='enable_coachee_survey_li'>
													<!-- <span class="kairos_red" style="opacity:0.5;">Improvements are being made to the Chronos Feedback system. <br /> Please check back in on Wednesday 1st September to send the feedback form. <br />Or please contact <A HREF="mailto:paul@thekairosproject.com">paul@thekairosproject.com</A> for more information </span> -->
													<input type="button"  name="enable_coachee_survey"  id="enable_coachee_survey" value='<?php echo 'Activate the End of Assignment Questionnaire survey for ' . $coachee_first_name; ?>' onClick='javascript:enable_survey(<?php  echo $assignment_id?>)'> 
												</li>
								<?php
											}
										}else{
								?>
											<!-- <li>
												<input type="button"  name="enable_coachee_feedback_val"  id="enable_coachee_feedback_val" value='<?php //echo 'View the End of Project Questionnaire survey of ' . $coachee_first_name . " (" . $end_of_project_questionnaire_percent . "%)" ; ?>' onClick='javascript:view_survey(<?php //echo $survey_name_id?>, <?php //echo $survey_participant_id?>)'>
											</li> -->
								<?php
										}
									}

									if ($feedback_exists_in_older_system == 0){
										//$survey_name_id = '', $language_id = '', $survey_activated = 'N', $template = 'N', $template_for = '', $project_id = 0, $assignment_id = 0
										if ($preference_and_objectives_survey_name_id > 0){
								?>
											<!-- <li>
												<input type="button"  name="enable_coachee_feedback_val"  id="enable_coachee_feedback_val" value='<?php // echo 'View the Coaching Preference and Objectives survey of ' . $coachee_first_name . " (" . $preference_and_objectives_percent . "%)" ; ?>' onClick='javascript:view_survey(<?php // echo $preference_and_objectives_survey_name_id?>, <?php // echo $preference_and_objectives_survey_participant_id?>)'>
											</li> -->
								<?php
										}
									}
								?>
								
								<li>
									<a href="coach_invoice_list.php?assignment_id=<?php echo trim($assignment_id)?>">
										<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][13]); ?> <?php echo $project_name?> - <?php echo $coachee_known_as?> <?php echo $coachee_last_name?>
									</a>
									<!-- <a href="coach_invoice_list.php" class="link"><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][14]); ?></a> -->
								</li>
								<?php
									//echo "X" . $coachee_agreement_done . "X";
									if (trim($coachee_objective_agreement_doc) <> ''){
								?>
										<li>
											<!-- <A HREF="<?php //echo $obj_config->ssl_site_url?>upload/<?php //echo $coachee_objective_agreement_doc ?>"><?php // echo $coach_lang[$_SESSION["language"]][$file_name][29];?></a> -->
											
											<A HREF="../admin/file_download.php?filename=<?php echo $coachee_objective_agreement_doc;?>" target=_new>															
												<?php echo $coach_lang[$_SESSION["language"]][$file_name][29];?>
											</a>

										</li>
								<?php
									}			
								?>
								<?php
									//echo "X" . $coachee_agreement_done . "X";
									if (trim($project_document_arr[0][3]) <> ''){
								?>
										<li><?php echo $coach_lang[$_SESSION["language"]][$file_name][31] ;?></li>
								<?php
									}			
								?>
								<li>
									<A HREF="javascript:void(0)" onClick='javascript:show_nondelivery_assignments("<?php echo $project_id?>")'><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][51]); ?><!-- View Assignments and Non Delivery Roles --></A>
								</li>
								<li style='background: url(../images/ico1.png) no-repeat 0 top;padding: 0px 0 7px 20px;margin-top:7px'>
									<?php echo $coach_lang[$_SESSION["language"]][$file_name][53];?> <!-- Surveys and their status -->
									<?php
										if ($coachee_survey_arr[0][0] <> ''){
											foreach($coachee_survey_arr as $coachee_survey){
												if ($coachee_survey[7] <> ''){
													$additional_text = ' (Based on template -' . $coachee_survey[7] . ") ";
												}
									?>
												<div style='padding-left:20px;margin-top:10px'>
													<A HREF="javascript:void(0)" onClick='javascript:view_survey(<?php echo $coachee_survey[1]?>, <?php echo $coachee_survey[0]?>)'>
														<?php echo $coachee_survey[13] . ' survey for assignment_' .  $coachee_survey[11] . $additional_text . ' (' . $coachee_survey[4] . '% Complete)';?>
													</A>
													&nbsp;
													<input type="button"  name="resend_survey"  id="resend_survey" value='Resend Survey' onClick='javascript:resend_survey_link(<?php echo $coachee_survey[0]?>, "<?php echo $projecttype?>")'> 
													&nbsp;
													<?php							
														if ($coachee_survey[9] <> '0000-00-00 00:00:00') {
															echo "&nbsp;<i> Resent  ";
															echo chronos_date_time_london($coachee_survey[9]);
															echo " ~ " . ordinal($coachee_survey[10]) . " time </i>";
														}
													?>

												</div>
									<?php
											}
									
										}else{
											echo '<br />&nbsp;&nbsp;&nbsp;&nbsp;' . $coach_lang[$_SESSION["language"]][$file_name][54]; //No active surveys at the moment
										}	
									?>
								</li>
							</ul>
							
							<table width="50%">
								<?php
									for($ctr = 0; $ctr < count($project_document_arr); $ctr++){
								?>
									<tr>
										<td align="left" valign="top" width="40%">&nbsp;</td>
										<td align="left" valign="top" style="font-size:13px">
											<!-- <a href="../upload/<?php // echo trim($project_document_arr[$ctr][3]) ?>" class="style8" target=_new><?php // echo trim($project_document_arr[$ctr][2]) ?></a> -->

											<A HREF="../admin/file_download.php?filename=<?php  echo trim($project_document_arr[$ctr][3]) ?>" class="style8" target=_new>															
												<?php echo trim($project_document_arr[$ctr][2]) ?>
											</a>
										</td>
									</tr>
								<?php
									}
								?>
							</table>		
							
						</div>
						
						<div class="respTable">
							<div class="btnArea baTop">

								<?php
									if ($project_status	<> 4 && $project_status <> 0){ //4 - Completed, 0 - Cancelled
										if ($date_time_session_completed == '0000-00-00 00:00:00'){
								?>								
											<input type="button" class="btnCancel fr" value="<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][17]); ?>" onClick="javascript:cancel_func()">
											<input type="submit" class="btnSave fr" value="<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][16]); ?>">
											<font style="text-decoration:none; font-weight:normal; font-size:85%;float:right"><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][42]) . ' <b>' . $no_sessions . '</b> '. span_accent($coach_lang[$_SESSION["language"]][$file_name][43]); ?></font>
								<?php
										}
									}
								?>								

								<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][15]); ?> - <A HREF="javascript:void(0)" onclick="javascript:show_learner(<?php echo $coachee_id?>)" style="text-decoration:underline; font-weight:normal; font-size:85%"><?php echo $coachee_first_name . " " . $coachee_last_name . span_accent($coach_lang[$_SESSION["language"]][$file_name][32]) ?></A> <!-- Paul added font style to participant name and parameter [32] for instruction-->
								
								<div class="clearfix"></div>
							</div>
							
							<table class="tblDisplay" border=0>
								<tr>
									<th style='width:5%'><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][18]); ?></th>
									<th style='width:10%'><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][19]); ?></th>
									<th style='width:25%'><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][20]); ?></th>
									<th style='width:10%'><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][21]); ?></th>
									<th style='width:50%' colspan="2"><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][22]); ?></th>
								</tr>

								<?php
									$total_schedule = -1;
									$total_completed_schedule = 0;
									//echo "Y" . count($schedule_arr) . "Y";
									if (trim($schedule_arr[0][0]) <> ''){
										$ctr = 0;
										$total_schedule = count($schedule_arr) - 1;
										foreach($schedule_arr as $value){
											if (($ctr % 2) == 0){
												$bgcolor = '#ebebeb';
											}else{
												$bgcolor = '#f8f8f8';
											}
											$ctr++;

											if ($value[11] == 0){
								?>
												<tr>
													<td valign="top">
														<?php
															if ($project_status	== 3){
														?>
																<!-- <A HREF="coach_dashboard.php?mode=del&assignment_id=<?php // echo $_REQUEST['assignment_id']?>&schedule_id=<?php // echo $value[0]?>" onClick="return confirm('Are you sure?')" class="rowdlt"><img src="../images/icon-cross.gif" alt="delete"></a> -->
																<input type="text" class="input1"  name="schedule_no_<?php echo $ctr?>" id="schedule_no_<?php echo $ctr?>"  value='<?php echo $value[2]?>'>
														<?php
															}else{
																echo html_entity_decode($value[2]);
															}
														?>
													</td>
													<td valign="top">
														<?php
															if ($project_status	== 3){
														?>
																<input type="text" name="schedule_date_<?php echo $ctr?>" id="schedule_date_<?php echo $ctr?>" value="<?php echo date('d-M-Y', strtotime($value[3]))?>" class="input2 datepick">
														<?php
															}else{
																echo date('d-M-Y', strtotime($value[3]));
															}
														?>
													</td>
													<td valign="top">
														<?php
															if ($project_status	== 3){
														?>
																<select name="schedule_time_start_<?php echo $ctr?>" id="schedule_time_start_<?php echo $ctr?>" onChange="javascript:change_end_time(<?php echo $ctr?>)">
																	<?php
																		for($tctr = 5; $tctr < 23;$tctr++){
																			if ($tctr < 13){
																				if ($tctr < 12){
																	?>
																					<option value="<?php echo $tctr . " a.m.";?>" <?php if ($value[4] == ($tctr . " a.m.")) {echo 'selected = "selected"';}?>><?php echo $tctr . " a.m.";?></option>
																					<option value="<?php echo $tctr . ".30 a.m.";?>"  <?php if ($value[4] == ($tctr . ".30 a.m.")) {echo 'selected = "selected"';}?>><?php echo $tctr . ".30 a.m.";?></option>
																	<?php
																				}else{
																	?>
																					<option value="<?php echo $tctr . " noon";?>" <?php if ($value[4] == ($tctr . " noon")) {echo 'selected = "selected"';}?>><?php echo $tctr . " noon";?></option>
																					<option value="<?php echo $tctr . ".30 p.m.";?>"  <?php if ($value[4] == ($tctr . ".30 p.m.")) {echo 'selected = "selected"';}?>><?php echo $tctr . ".30 p.m.";?></option>
																	<?php
																				}
																			}else{
																	?>
																				<option value="<?php echo ($tctr - 12) . " p.m.";?>" <?php if ($value[4] == (($tctr - 12) . " p.m.")) {echo 'selected = "selected"';}?>><?php echo ($tctr - 12) . " p.m.";?></option>
																				<?php 
																					if ($tctr < 23){
																				?>
																						<option value="<?php echo ($tctr - 12) . ".30 p.m.";?>" <?php if ($value[4] == (($tctr - 12) . ".30 p.m.")) {echo 'selected = "selected"';}?>><?php echo ($tctr - 12) . ".30 p.m.";?></option>
																	<?php
																					}
																			}
																		}
																	?>
																</select>
																<!-- <input type="text" class="input3" name="schedule_time_start_<?php echo $ctr?>" id="schedule_time_start_<?php echo $ctr?>" value='<?php echo $value[4]?>'>
																<input type="text" class="input3" name="schedule_time_end_<?php echo $ctr?>" id="schedule_time_end_<?php echo $ctr?>" value='<?php echo $value[8]?>'>  -->
																-
																<select name="schedule_time_end_<?php echo $ctr?>" id="schedule_time_end_<?php echo $ctr?>">
																	<?php
																		for($tctr = 6; $tctr < 24;$tctr++){
																			if ($tctr < 13){
																				if ($tctr < 12){
																	?>
																					<option value="<?php echo $tctr . " a.m.";?>" <?php if ($value[8] == ($tctr . " a.m.")) {echo 'selected = "selected"';}?>><?php echo $tctr . " a.m.";?></option>
																					<option value="<?php echo $tctr . ".30 a.m.";?>"  <?php if ($value[8] == ($tctr . ".30 a.m.")) {echo 'selected = "selected"';}?>><?php echo $tctr . ".30 a.m.";?></option>
																	<?php
																				}else{
																	?>
																					<option value="<?php echo $tctr . " noon";?>" <?php if ($value[8] == ($tctr . " noon")) {echo 'selected = "selected"';}?>><?php echo $tctr . " noon";?></option>
																					<option value="<?php echo $tctr . ".30 p.m.";?>"  <?php if ($value[8] == ($tctr . ".30 p.m.")) {echo 'selected = "selected"';}?>><?php echo $tctr . ".30 p.m.";?></option>
																	<?php
																				}
																			}else{
																	?>
																				<option value="<?php echo ($tctr - 12) . " p.m.";?>" <?php if ($value[8] == (($tctr - 12) . " p.m.")) {echo 'selected = "selected"';}?>><?php echo ($tctr - 12) . " p.m.";?></option>
																				<?php 
																					if ($tctr < 24){
																				?>
																						<option value="<?php echo ($tctr - 12) . ".30 p.m.";?>" <?php if ($value[8] == (($tctr - 12) . ".30 p.m.")) {echo 'selected = "selected"';}?>><?php echo ($tctr - 12) . ".30 p.m.";?></option>
																	<?php
																					}
																			}
																		}
																	?>
																</select>

																<select name="timezone_id_<?php echo $ctr?>" id="timezone_id_<?php echo $ctr?>"  class="select">
																	<?php
																		foreach($timezone_arr as $tvalue){
																	?>
																			<option value="<?php echo $tvalue[0]?>" <?php if ($tvalue[0] == $value[9]) {echo "selected = 'selected'";}?>><?php echo $tvalue[1]?></option>
																	<?php
																		}
																	?>
																</select>
														<?php
															}else{
																echo html_entity_decode($value[4]) . " - " . html_entity_decode($value[8]) . "(" . html_entity_decode($value[10]) . ")";
															}
														?>
													</td>
													<td valign="top">
														<?php
															if ($project_status	== 3){
														?>
																<select name="schedule_status_<?php echo $ctr?>" id="schedule_status_<?php echo $ctr?>"  class="select">
																	<?php
																		foreach($schedule_status_arr as $schedule_status){
																	?>
																			<option value='<?php echo $schedule_status[2]?>' <?php if ($value[5] == $schedule_status[2]) echo 'selected';?>><?php echo $schedule_status[1]?></option>
																	<?php
																		}
																	?>
																</select>
														<?php
															}else{
																if ($value[5] == 'W'){
																	echo "Waiting";
																}elseif ($value[5] == 'N'){		
																	echo "Cancelled";
																}elseif ($value[5] == 'R'){		
																	echo "Rescheduled";
																}elseif ($value[5] == 'C'){		
																	echo "Complete";
																	//$total_completed_schedule++;
																}
																if ($value[5] == 'C'){
																	$completed_sessions++;
																}
															}

														?>
													</td>
													<td style='width:35%'  valign="top">
														<!-- <div class="tareaBox"> -->
															<p><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][23]); ?></p>

															<?php
																if ($project_status	== 3){						
															?>
																	<textarea class="tarea1" name="coach_comment_<?php echo $ctr?>" id="coach_comment_<?php echo $ctr?>"  style="width:95%;height:90px"><?php echo $value[7]?></textarea>
																	<input type="hidden" name="schedule_id_<?php echo $ctr?>"  id="schedule_id_<?php echo $ctr?>" value=<?php echo $value[0]?>>
															<?php
																}else{
																	if (trim($value[7]) == ''){
																		echo "N/A";
																	}else{
																		echo $value[7];
																	}
																}
															?>
														<!-- </div> -->
													</td>
													<td style='width:15%'  valign="top">
														<!-- <div class="tareaBox"> -->
															<p><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][24]); ?></p>
															<p>
																<?php 
																	if (trim($value[6]) == ''){
																		echo "N/A";
																	}else{
																		echo substr($value[6], 0, 97) . ' ...' ;
																?>
																		
																		<!-- <a href='javascript:void(0)' onClick="javascript:show_comments('this is very difficult`s to make long so that Subha can test it so I will repeat this data over and over again - and do the same for the Participant Comments this is very difficult to make long so that Subha can test it so I will repeat this data over and over again - <br /> <br /> and do the same for the Participant Comments')">View Comments</a> -->
																		
																		<a href='javascript:void(0)' onClick="javascript:show_comments('<?php echo $value[0];?>')">more</a>
																<?php
																	}
																?>
															</p>
														<!-- </div> -->
													</td>
												</tr>
								<?php
											}else{
								?>
												<tr>
													<td valign="top">
														<?php
															echo html_entity_decode($value[2]);
														?>
													</td>
													<td valign="top">
														<?php
															echo date('d-M-Y', strtotime($value[3]));
														?>
													</td>
													<td valign="top">
														<?php
															echo html_entity_decode($value[4]) . " - " . html_entity_decode($value[8]) . "(" . html_entity_decode($value[10]) . ")";
														?>
													</td>
													<td valign="top">
														
														<?php
															if ($value[5] == 'W'){
																echo "Waiting";
															}elseif ($value[5] == 'N'){		
																echo "Cancelled";
															}elseif ($value[5] == 'R'){		
																echo "Rescheduled";
															}elseif ($value[5] == 'C'){		
																echo "Complete";
																$total_completed_schedule++;
															}elseif ($value[5] == 'D'){		
																echo "Complete by default";
															}

															if ($value[5] == 'C'){
																$completed_sessions++;
															}

															echo "<br /> <i>Invoiced</i>";
														?>
													</td>
													<td style='width:35%'  valign="top">
														<p><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][23]); ?></p>

														<?php
															if (trim($value[7]) == ''){
																echo "N/A";
															}else{
																echo $value[7];
															}
														?>
													</td>
													<td style='width:15%'  valign="top">
														<p><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][24]); ?></p>
														<p>
															<?php 
																if (trim($value[6]) == ''){
																	echo "N/A";
																}else{
																	echo substr($value[6], 0, 97) . ' ...' ;
															?>
																	<a href='javascript:void(0)' onClick="javascript:show_comments('<?php echo $value[0];?>')">more</a>
															<?php
																}
															?>
														</p>
													</td>
												</tr>
								<?php
											}
										}
									}

									if ($project_status	== 3){
										if ($session_ctr_indicator > $total_schedule){
											for($ctr = $total_schedule+1; $ctr < $session_ctr_indicator; ){
												if (($ctr % 2) == 0){
													$bgcolor = '#ebebeb';
												}else{
													$bgcolor = '#f8f8f8';
												}
												$ctr++;

								?>
												<tr>
													<td>
														<input type="text" name="schedule_no_<?php echo $ctr?>" id="schedule_no_<?php echo $ctr?>" class="input1" value='<?php echo $_REQUEST['schedule_no_' . $ctr]?>'>
													</td>
													<td>
														<input name="schedule_date_<?php echo $ctr?>" id="schedule_date_<?php echo $ctr?>" type="text" class="input2 datepick"  value='<?php if (trim($_REQUEST['schedule_date_' . $ctr]) <> '') {echo date('d-M-Y', strtotime($_REQUEST['schedule_date_' . $ctr]));}?>' readonly />
													</td>
													<td>
														<!-- <input type="text" name="schedule_time_start_<?php // echo $ctr?>" id="schedule_time_start_<?php // echo $ctr?>"  class="input3" value='<?php // echo $_REQUEST['schedule_time_start_' . $ctr]?>'> -->

														<select name="schedule_time_start_<?php echo $ctr?>" id="schedule_time_start_<?php echo $ctr?>" onChange="javascript:change_end_time(<?php echo $ctr?>)">
															<?php
																for($tctr = 5; $tctr < 23;$tctr++){
																	if ($tctr < 13){
																		if ($tctr < 12){
															?>
																			<option value="<?php echo $tctr . " a.m.";?>" ><?php echo $tctr . " a.m.";?></option>
																			<option value="<?php echo $tctr . ".30 a.m.";?>" ><?php echo $tctr . ".30 a.m.";?></option>
															<?php
																		}else{
															?>
																			<option value="<?php echo $tctr . " noon";?>" ><?php echo $tctr . " noon";?></option>
																			<option value="<?php echo $tctr . ".30 p.m.";?>" ><?php echo $tctr . ".30 p.m.";?></option>
															<?php
																		}
																	}else{
															?>
																		<option value="<?php echo ($tctr - 12) . " p.m.";?>" ><?php echo ($tctr - 12) . " p.m.";?></option>
																		<?php 
																			if ($tctr < 23){
																		?>
																				<option value="<?php echo ($tctr - 12) . ".30 p.m.";?>"><?php echo ($tctr - 12) . ".30 p.m.";?></option>
															<?php
																			}
																	}
																}
															?>
														</select>

														&nbsp;-&nbsp;
														<!-- <input type="text" name="schedule_time_end_<?php echo $ctr?>" id="schedule_time_end_<?php echo $ctr?>"  class="input3" value='<?php echo $_REQUEST['schedule_time_end_' . $ctr]?>'> -->

														-
														<select name="schedule_time_end_<?php echo $ctr?>" id="schedule_time_end_<?php echo $ctr?>">
															<?php
																for($tctr = 6; $tctr < 24;$tctr++){
																	if ($tctr < 13){
																		if ($tctr < 12){
															?>
																			<option value="<?php echo $tctr . " a.m.";?>" ><?php echo $tctr . " a.m.";?></option>
																			<option value="<?php echo $tctr . ".30 a.m.";?>" ><?php echo $tctr . ".30 a.m.";?></option>
															<?php
																		}else{
															?>
																			<option value="<?php echo $tctr . " noon";?>" ><?php echo $tctr . " noon";?></option>
																			<option value="<?php echo $tctr . ".30 p.m.";?>" ><?php echo $tctr . ".30 p.m.";?></option>
															<?php
																		}
																	}else{
															?>
																		<option value="<?php echo ($tctr - 12) . " p.m.";?>" ><?php echo ($tctr - 12) . " p.m.";?></option>
																		<?php 
																			if ($tctr < 24){
																		?>
																				<option value="<?php echo ($tctr - 12) . ".30 p.m.";?>"><?php echo ($tctr - 12) . ".30 p.m.";?></option>
															<?php
																			}
																	}
																}
															?>
														</select>

														<select name="timezone_id_<?php echo $ctr?>" id="timezone_id_<?php echo $ctr?>"  class="select">
															<?php
																foreach($timezone_arr as $tvalue){
															?>
																	<option value="<?php echo $tvalue[0]?>" <?php if ($tvalue[0] == $_REQUEST['schedule_time_end_' . $ctr]) {echo "selected = 'selected'";}?>><?php echo $tvalue[1]?></option>
															<?php
																}
															?>
														</select>

													</td>
													<td>
														<select name="schedule_status_<?php echo $ctr?>" id="schedule_status_<?php echo $ctr?>"  class="select">
															<?php
																foreach($schedule_status_arr as $schedule_status){
																	$selected = '';
																	if ($_REQUEST['schedule_status_' . $ctr] <> ''){
																		if ($_REQUEST['schedule_status_' . $ctr] == $schedule_status[2]) {
																			$selected = 'selected';
																		}
																	}else{
																		if ($schedule_status[2] == 'W'){
																			$selected = 'selected';
																		}
																	}
															?>
																	<option value='<?php echo $schedule_status[2]?>' <?php echo $selected?>><?php echo $schedule_status[1]?></option>
															<?php
																}
															?>
														</select>
													</td>
													<td>
														<div class="tareaBox">
															<p><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][23]); ?></p>
															<textarea class="tarea1" name="coach_comment_<?php echo $ctr?>"  id="coach_comment_<?php echo $ctr?>"><?php echo $_REQUEST['coach_comment_' . $ctr]?></textarea>
															<input type="hidden" name="schedule_id_<?php echo $ctr?>"  id="schedule_id_<?php echo $ctr?>" value='0'>

														</div>
														<div class="tareaBox">
															<p>N/A</p>
														</div>

													</td>
												</tr>
								<?php
											}					
										} 
									}

									$total_schedule = $ctr
								?>

								<tr>
									<td colspan='6' style='font-weight:700; text-align:center'>
										<p><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][55]); ?></p>
									</td>
								</tr>

							</table>

							<?php
								if ($project_status	== 3){	
									if ($date_time_session_completed == '0000-00-00 00:00:00'){
							?>
										<div class="btnArea">
											<input  type='hidden' name='save_function' id='save_function' value='0'> <!-- 0 - Only Save, 1 - Save & Inform -->

											<input type="button" class="btnCancel fr" value="<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][27]); ?>"  onClick="javascript:cancel_func()"> <!-- CANCEL -->
											<input type="submit" class="btnSave fr" value="<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][26]); ?>"> <!-- Save Schedule -->
											<font style="text-decoration:none; font-weight:normal; font-size:85%;float:right"><?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][42]) . ' <b>' . $no_sessions . '</b> '. span_accent($coach_lang[$_SESSION["language"]][$file_name][43]); ?></font>
											
											
											<!--<input type="button" class="btnSave fr" value="<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][38]); ?>" onClick="javascript:save_inform_func()"> <!-- Save & Inform Learner -->
											
											<input value="<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][25]); ?>" class="submit4" onClick="javascript:add_schedule()" type="button"> <!-- Save Schedule -->
											<select name="no_additional_rows" id="no_additional_rows" class="select select3"> 
												<?php
													for($rowctr = 1;$rowctr < 10;$rowctr++){
												?>
														<option value="<?php echo $rowctr?>"><?php echo $rowctr?></option>
												<?php
													}
												?>
											</select>
											<input type="hidden" name="total_schedule" id="total_schedule" value="<?php echo $total_schedule?>">
				
											<div class="clearfix"></div>
										</div>
							<?php
									}
								}
							?>
							<input type='hidden' name='no_sessions_value' id='no_sessions_value' value='<?php echo $no_sessions?>'>
							<input type='hidden' name='completed_sessions_value' id='completed_sessions_value' value='<?php echo $completed_sessions?>'>
						</div>
					</form>
			<?php
				}else{
			?>
					<div class="greyBox">
						&nbsp;
					</div>
					<div class="infoArea">
						<?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][28]); ?>
					</div>
			<?php
				}
			?>
		</div>
	</div>
	<!--wrap end footer start-->
	
	<div id="footer">
		<?php include_once('../inc/coach_footer.php'); ?>
    </div>
    <!-- Bootstrap core JavaScript
    ================================================== -->

    <!-- <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script> -->

	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script src="https://gregfranko.com/jquery.selectBoxIt.js/js/jquery.selectBoxIt.min.js"></script>
	<script type="text/javascript" src="<?php echo $obj_config->ssl_site_url?>js/jquery-confirm/js/jquery-confirm.js"></script>

	<script>
		$(function() {	
		  var selectBox = $(".select").selectBoxIt();	
		});
		
		$(function() {	
		  var selectBox = $(".select2").selectBoxIt2();	
		});

		function enable_feedback(){
			var total_completed_session;
			total_completed_session = 0;
			total_completed_session = $('#completed_sessions_value').val();

			for(ctr = 0; ctr <= $("#total_schedule").val();ctr++){
				if ($('#schedule_date_'+ctr).val() != ''){
					if ($('#schedule_status_'+ctr).val() == 'C'){
						total_completed_session++;
					}
				}
				//alert($('#schedule_status_'+ctr).val() + " " + total_completed_session);
			}
			//alert('1');
			//alert(total_completed_session + ' ' + $('#no_sessions_value').val());
			
			/*var no_sessions_value;
			var completed_sessions_value;
			
			no_sessions_value = $('#no_sessions_value').val() * 1;
			completed_sessions_value = $('#completed_sessions_value').val() * 1;

			//if ($('#no_sessions_value').val() <= $('#completed_sessions_value').val()){

			if (no_sessions_value <= completed_sessions_value){*/

			//alert(total_completed_session + ' ' + $('#no_sessions_value').val());

			if (total_completed_session < ($('#no_sessions_value').val() * 1)){
				//alert(total_completed_session + " " + ($('#no_sessions_value').val() * 1));
				alert('We cannot send feedback until the number of completed sessions matches or exceeds the ' + $('#no_sessions_value').val() + ' sessions planned for the project. Please update your schedule records accordingly- thank you');
			}else{
				//alert('1');
				$('#action_todo').val('enable_coachee_feedback');
				$('#project_schedule').submit();
			}
		}

		document.getElementById("coachee_feedback_doc").onchange = function() {
			document.getElementById("project_schedule").submit();
		};
		document.getElementById("coachee_objective_agreement_doc").onchange = function() {
			document.getElementById("project_schedule").submit();
		};


		function save_inform_func(){
			$('#save_function').val(1);
			$('#project_schedule').submit();
		}

		function show_comments(id){
			var x;
			x = 'here';
			//alert(comments);
			$.alert({
				title: 'Comments',
				//content: comments,
				content: 'url:coachee_comments.php?id='+id,
				buttons: {
						close: function () {
						}
					}
			});
		}

		function validate(){
			var all_ok
			var msg;
			var total_completed_session;
			
			//alert('1' + $('#form_data').val());
			if ($('#form_data').val() == 'addrows' ){
				all_ok = true;
			}else{
				all_ok = true;
				total_completed_session = 0;
				total_completed_session = $('#completed_sessions_value').val();
				
				//alert('1' + total_completed_session + ' ' + $('#no_sessions_value').val());

				for(ctr = 0; ctr <= $("#total_schedule").val();ctr++){
					if ($('#schedule_date_'+ctr).val() != ''){
						if (($('#schedule_time_'+ctr).val() == '') || ($('#schedule_no_'+ctr).val() == ''))  {
							all_ok = false;
							msg += '\n - Schedule Number and Time both are required';
						}
						if ($('#schedule_status_'+ctr).val() == 'C'){
							total_completed_session++;
						}
					}

					//alert($('#schedule_status_'+ctr).val() + " " + total_completed_session);
				}
				
				//alert(total_completed_session + ' ' + $('#no_sessions_value').val());

				if (total_completed_session > ($('#no_sessions_value').val() * 1)){
					all_ok = false;
					msg += '\n - <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][44]) . ' ' . $no_sessions . ' ' . span_accent($coach_lang[$_SESSION["language"]][$file_name][45]) ; ?> ' + total_completed_session + ' <?php echo span_accent($coach_lang[$_SESSION["language"]][$file_name][46]) ;?>' ;
				}
				//all_ok = false;

				if (all_ok == false){
					alert('The following errors have taken place ' + msg);
				}
			}
			return all_ok;
		}

		function change_end_time(ctr){
			var selected;
			selected = $('#schedule_time_start_' + ctr).prop('selectedIndex');
			//alert(selected);
			if (selected > 33){
				//selected = 33;
			}
			$('#schedule_time_end_' + ctr).prop('selectedIndex', selected);
		}

		function enable_survey(assignment_id){
			$('#enable_coachee_survey_li').hide();

			location.href = 'coach_dashboard.php?assignment_id='+assignment_id+'&project_id='+$('#project_id').val()+'&mode=enablesurvey';
		}

		function view_survey(survey_name_id, survey_participant_id){
			mywindow = window.open("view_suvey_result_pop.php?survey_name_id="+survey_name_id+'&survey_participant_id='+survey_participant_id , "surveyresults", "location=1,status=1,scrollbars=1,  width=900,height=600");
		}

		function resend_survey_link(survey_participant_id, projecttype){
			mywindow = window.open('resend_survey_link_pop.php?projecttype'+projecttype+'&survey_participant_id='+survey_participant_id , "resendsurvey", "location=1,status=1,scrollbars=1,  width=1200,height=700");
		}
	</script>

	<?php
		if (trim($mailmatter) <> ''){
	?>
			<SCRIPT LANGUAGE="JavaScript">
			<!--
				//alert('getting there')
				///mywindow = window.open("mailmatter_for_schedule.php?assignment_id=<?php echo trim($_REQUEST['assignment_id'])?>", "assignmentmail", "location=1,status=1,scrollbars=1,  width=900,height=600");
				///mywindow.moveTo(100, 100);				
			//-->
			</SCRIPT>

	<?php
		}

		if ($survey_success_msg <> ''){
			
	?>
			<SCRIPT LANGUAGE="JavaScript">
			<!--
				alert('<?php echo $survey_success_msg?>');
				///mywindow = window.open("mailmatter_for_feedback_notification.php?assignment_id=<?php echo trim($_REQUEST['assignment_id'])?>&notification_for=<?php echo $feedback_mailnotification_return_val;?>", "assignmentmail", "location=1,status=1,scrollbars=1,  width=900,height=600");
				///mywindow.moveTo(100, 100);				
			//-->
			</SCRIPT>
	<?php
		}
	?>

  </body>
</html>



