<?php include "../includes/common.inc.php"?>
<?php include "includes/links.inc.php"?>


<script language="javascript" type="text/javascript">
	function Validation() {
		if(document.getElementById("txtName").value == "") {
			alert("Please enter: Title");
			document.getElementById("txtName").focus();
			return false;
		}
		if(document.getElementById("ddlMainCategories").value == "0") {
			alert("Please Select Main Category.");
			document.getElementById("ddlMainCategories").focus();
			return false;
		}
	}

</script>
  <?php
  
  
  
$infra_image_id=""; $isdeleted =""; $title=""; $created_date=date('d-M-Y');$isactive="1"; 
$attachment="";$ishome="";$attachment_path=""; $sortby="0"; $catid="";

 
if(isset($_GET['cid'])) {
	$infra_image_id = $converter->decode($_GET['cid']);
	 
}


if (isset($_POST['btnSubmit'])) {
 
	$title = trim(str_replace("'", "", $_POST['txtName']));
	$sortby = trim(str_replace("'", "", $_POST['txtSortBy']));
	
	if(isset($_POST['chkIsActive'])){
		$isactive = trim(str_replace("'", "", $_POST['chkIsActive']));
	}
	$catid = trim(str_replace("'", "", $_POST['ddlMainCategories']));
	 
	
	if(isset($_POST['chkIsDeleted'])){
		$isdeleted = trim(str_replace("'", "", $_POST['chkIsDeleted']));
	}
	
//	Alert ($ishome);
	
		$attachment = $_FILES['fuUpload']['name'];
		$file = str_replace("'", "", $_POST['txtFile']);
		
		
		 $random=rand();
		 
			
			if ($attachment != "") {
			   uploadFile('fuUpload', 'uploads/', '');
				
			} else {
				if ($file == "") {
					$attachment = "";
				} else {
					$attachment = $file;
				}
			}
			
		
		
	if($isdeleted == "on") {
		$isdeleted = 1;
	} else {
		$isdeleted = 0;
	}
	

	
	if($isactive == "on") {
		$isactive = 1;
	} else {
		$isactive = 0;
	}

	 if($ishome=="on") {
		$ishome=1;
	} else {
		$ishome=0;
	}
	 
	///Alert ($ishome); 
	 
	$data = array(
		'title' => $title,
		'catid' => $catid,
		'attachment' => $attachment,
		'isactive' => $isactive,
		'isdeleted' => $isdeleted,
		'sortby' => $sortby,
		'created_date' => $created_date,
	);

	if($infra_image_id == "") {
			$infra_image_id = $db->insert_array(Infra_Images, $data);
			$modeofpage="add";
			if (!$infra_image_id) { 
				$db->print_last_error(false);
			}

	} else {
			$rows = $db->update_array(Infra_Images, $data, "infra_image_id = $infra_image_id");
			$modeofpage="edit";

			if (!$rows) {
				$db->print_last_error(false);
			} 
	}


	
	
	if($modeofpage=="add")
	{
		
		AlertandRedirect('New record details are added successfully',  "add_infra_image.php");			
		return;
	}
	else
	{
		
		AlertandRedirect('Record details are edited successfully', "view_infra_images.php");	
		return;
	}
} 
else 
{
	
	if($infra_image_id != "") {
		$query = "SELECT * FROM ".Infra_Images." WHERE infra_image_id = $infra_image_id";
		$result = mysql_query($query);
		if($result != "") {
			$rowcount = mysql_num_rows($result);
			if($rowcount > 0) {
				while($row = mysql_fetch_assoc($result)) {
					extract($row);
					$title=$row['title'];
					 

				}
			}
		}
		$mode = "edit";
	}
}
?>
</head>
<body>
<!-- div -->
<?php include "includes/header.inc.php"?>
<!-- / div -->
<!-- nav -->
<?php include "includes/left.inc.php"?>
<!-- / nav -->
<section id="content">
  <section class="main padder">
    <div class="clearfix" style="padding:15px 0;">
	 <h4><strong><i class="icon-edit"></i>&nbsp;Infrastructure Gallery Management</strong></h4>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <section class="panel">
          <div class="panel-body">
            <form class="form-horizontal" method="post" enctype="multipart/form-data"  onSubmit="javascript:return Validation()">
              
             <div class="panel-heading" style="background:none; font-weight:bold;">
             	 <div style="float:left; width:50%;">Add / Edit Infrastructure Gallery</div>
                <div style="float:left; width:50%; text-align:right;">
           		 <a href="view_infra_images.php" class="btn btn-info btn-white btn-xs" style="width:200px;">View Infrastructure Gallery</a>
            
            </div>
              </div>
              <div class="form-group" style="padding-top:15px;"> 
                <label class="col-lg-3 control-label">Title</label>
                <div class="col-lg-8">
                  <input type="text" name="txtName" id="txtName" placeholder="Name" data-required="true" class="form-control" value="<?php echo $title; ?>" style="width:400px;">
                </div>
              </div>

			 <div class="form-group" style="padding-top:15px;"> 
                <label class="col-lg-3 control-label">Category</label>
                <div class="col-lg-8">
                    <select name="ddlMainCategories" id="ddlMainCategories" class="form-control" style="width:400px;" >
                   		 <option value="0">Select</option>
                         <option value="1" <?php if($catid=="1") { echo "selected";}?>>Warehousing </option>
                         <option value="2" <?php if($catid=="2") { echo "selected";}?>>R and D </option>
                         <option value="3" <?php if($catid=="3") { echo "selected";}?>>Production </option>
                         <option value="4" <?php if($catid=="4") { echo "selected";}?>>Infra </option>
                         <option value="5" <?php if($catid=="5") { echo "selected";}?>>Finished goods and Raw material QC </option>
                         <option value="6" <?php if($catid=="6") { echo "selected";}?>>Awards </option>
                    </select>
                 
                </div>
              </div>

		   

				 <div class="form-group" style="padding-top:5px;">

			    
                <label class="col-lg-3 control-label">Attachment</label>
                <div class="col-lg-9">
                  <div class="pull-left text-center" style="width:550px;text-align:left;"> 
					<input type="file" id="fuUpload" name="fuUpload" style="float:left;"/>
					<?php if($infra_image_id != "") { ?><?php if($attachment != "") { ?><a target="_blank" href="uploads/<?php echo $attachment?>" style="color: red;">View File</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:RemoveFile('txtFile2');" style="color: red;">Remove File</a><?php } } ?>
					<input type="hidden" id="txtFile" name="txtFile" value="<?php echo $attachment; ?>" readonly="readonly" />  <br>
                    <p>(Width : 800px)</p>
				  </div>
                   
                </div>
              </div>
			   
               <div class="form-group" style="padding-top:15px;"> 
                <label class="col-lg-3 control-label">Sort by</label>
                <div class="col-lg-8">
                  <input type="text" name="txtSortBy" id="txtSortBy" placeholder="" data-required="true" class="form-control" value="<?php echo $sortby; ?>" style="width:400px;">
                </div>
              </div>
              
			  <div class="form-group" style="margin-top:15px;">
                <label class="col-lg-3 control-label">&nbsp;</label>
                
               
                <div class="col-lg-8">
                	<input type="checkbox" id="chkIsActive" name="chkIsActive" <?php if($isactive == 1) { echo "checked"; } ?> style="width:40px;"/>&nbsp;Check here, if want to <strong>"Active"</strong> this record.
                </div>
				 <input  type="checkbox" id="chkIsDeleted" name="chkIsDeleted" <?php if($isdeleted == 1) { echo "checked"; } ?> style="width:40px;display:none"/>
              </div>
              <div class="form-group">
                <div class="col-lg-9 col-lg-offset-3">
                 
                  <input type="submit" name="btnSubmit" value="Submit" class="btn btn-primary" />
                </div>
              </div>
            </form>
          </div>
        </section>
        
      </div>
      
    </div>
  </section>
</section>
</body>
</html>

