<?php
    session_start();
    include("../connect.php")
 ?>


<?php
      
      $password = '';
      $passError = '';

      $update = '';
      $updateClass = '';

     if(!isset($_SESSION['userid'])){
            header("location:../login.php");
            exit();
        }
?>

<?php require_once('../connect.php'); ?>
<?php
//mysql_select_db($database_cn, $cn);


if(isset($_POST['update'])){

$userid = mysqli_escape_string($conn, $_POST['userid']);      
$fname = mysqli_escape_string($conn, $_POST['fname']);
$username = mysqli_escape_string($conn, $_POST['username']);
$email = mysqli_escape_string($conn, $_POST['email']);
$phone = mysqli_escape_string($conn, $_POST['phone']);
$address = mysqli_escape_string($conn, $_POST['address']);
$idnumber = mysqli_escape_string($conn, $_POST['validID']);
$password = mysqli_escape_string($conn, $_POST['password']);
$repass = mysqli_escape_string($conn, $_POST['repass']);



if ($password !== $repass){ 

      $passError = 'The Passwords you entered do not match, please review and try again';
      $passErrorClass = 'alert-danger';

} else{

      //Continue Update



      
      $sql=" UPDATE customers SET fullname='$fname', email='$email', phone='$phone', username='$username', address='$address', validID='$idnumber', password='$password' WHERE userid =".$userid;

     if ($conn->query($sql) === TRUE) {

      $update = 'You have successfully updated your profile.';
      $updateClass = 'alert-success';
}
}
}
$conn->close();
?>
<!DOCTYPE html>
<html lang="en">
<head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <title>eTradematrix - Edit</title>
      <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
      <link rel="icon" href="../assets1/img/ico.png" type="image/x-icon"/>

      <!-- Fonts and icons -->
      <script src="../assets1/js/plugin/webfont/webfont.min.js"></script>
      <script>
            WebFont.load({
                  google: {"families":["Lato:300,400,700,900"]},
                  custom: {"families":["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['../assets1/css/fonts.min.css']},
                  active: function() {
                        sessionStorage.fonts = true;
                  }
            });
      </script>

      <!-- CSS Files -->
      <link rel="stylesheet" href="../assets1/css/bootstrap.min.css">
      <link rel="stylesheet" href="../assets1/css/atlantis.min.css">

      <!-- CSS Just for demo purpose, don't include it in your project -->
      <link rel="stylesheet" href="../assets1/css/demo.css">
      <script src="//code-eu1.jivosite.com/widget/9kvjQH9r3I" async></script>
</head>
      <?php include('header.php') ?>            <!-- End Sidebar -->

<div class="main-panel">
                  <div class="content">
                        <div class="page-inner">
                              <div class="page-header">
                                    <h4 class="page-title">Your Profile</h4>
                                    <ul class="breadcrumbs">
                                          <li class="nav-home">
                                                <a href="index.php">
                                                      <i style="color:#2ed872;" class="fas fa-home"></i>
                                                </a>
                                          </li>
                                          <li class="separator">
                                                <i class="flaticon-right-arrow"></i>
                                          </li>
                                          <li class="nav-item">
                                                <a href="#">Home</a>
                                    </ul>
                              </div>
                              <div class="row">
                                    <div class="col-sm-12">
                                          <div class="card">
                                                <div class="card-body">
                                                      <form method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>" enctype="multipart/form-data">
                                                      <div class="row">
                                                            <div class="col-sm-5">
                                                                  <div class="card-header">
                                                                        <div class="card-title"><strong>Personal Information</strong></div>
                                                                  </div>
                                                                  <div>
                                                                        <?php if ( $passError != '' ) : ?>
                                                                        <div class="alert <?php echo $passErrorClass; ?>">
                                                                              <?php echo $passError; ?>
                                                                        </div>
                                                                              <?php endif; ?>
                                                                  </div>
                                                                  <div>
                                                                        <?php if ( $update != '' ) : ?>
                                                                        <div class="alert <?php echo $updateClass; ?>">
                                                                              <?php echo $update; ?>
                                                                        </div>
                                                                              <?php endif; ?>
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="title">Full Name</label>
                                                                        <input type="text" class="form-control" value="<?php echo $_SESSION['fname'];?>" name="fname" required="fname">
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="email2">Email</label>
                                                                        <input type="text" name="email" class="form-control" required="email" value="<?php echo $_SESSION['email'];?>">
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="email2">Username</label>
                                                                        <input type="text" name="username" class="form-control" required="username" value="<?php echo $_SESSION['uname'];?>">
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="email2">Phone Number</label>
                                                                        <input type="text" name="phone" class="form-control" required="phone" value="<?php echo $_SESSION['phone'];?>">
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="email2">Address</label>
                                                                        <input type="text" name="address" class="form-control" required="address" value="<?php echo $_SESSION['address'];?>">
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="email2">ValidID</label>
                                                                        <input type="text" name="validID" class="form-control" required="validID" value="<?php echo $_SESSION['id'];?>">
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label for="email2">Account Level</label>
                                                                        <input type="text" name="level" class="form-control" required="level" value="<?php echo $_SESSION['level'];?>" disabled>
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label>New Password</label>
                                                                        <div class="input-icon">
                                                                              <span class="input-icon-addon">
                                                                                    <i class="fa fa-lock"></i>
                                                                              </span>
                                                                              <input type="password" class="form-control" name="password" placeholder="Password" required="password">
                                                                        </div>
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <label>Confirm Password</label>
                                                                        <div class="input-icon">
                                                                              <span class="input-icon-addon">
                                                                                    <i class="fa fa-lock"></i>
                                                                              </span>
                                                                              <input type="password" class="form-control" name="repass" placeholder="Confirm Password" required="repass">
                                                                        </div>
                                                                  </div>
                                                                  <div class="form-group">
                                                                        <input type="hidden" class="form-control" name="userid" value="<?php echo $_SESSION['userid']; ?>">
                                                                  </div>
                                                                  <div class="card-action">
                                                                        <button class="btn btn-secondary" type="submit" name="update">
                                                                              <span class="btn-label">
                                                                                    <i class="fas fa-user-edit"></i>
                                                                              </span> Update
                                                                        </button>
                                                                  </div>
                                                            </div>
                                                      </div>
                                                            </form>
                                                         </div>
                                                      </div>
                                                </div>
                                          </div>
                                    </div>
                  <?php include("footer.php"); ?>
            
      </body>
      </html>