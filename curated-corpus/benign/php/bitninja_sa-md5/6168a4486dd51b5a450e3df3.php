<?php if(!function_exists(photoCartIncluded)) { die("Direct file access denied"); } ?>
<div id=pagetitle><a href="manage.php?do=photocart&action=galleries" class=head>Galleries</a> > <span class=head>Batch edit galleries</span>
 [ <?php  print "<a href=\"manage.php?do=photocart&action=galleries&page=".$_REQUEST['page']."\">Cancel</a>"; ?> ]
</div>

<?php 
$xf = array(
	"do" =>"photocart",
	"item_table" => "pics",
	"item_id_array_field" => "pic_id",
	"item_show_field" => "pic_org",
	"item_cat_field" => "entry_cat",
	"item_entry_mini" => "no",
	"item_entry_thumb" => "yes",
	"do" => "entry",
	"action" => "batchEdit",
	"submit_button" => " Save all "
	);



if(!empty($_POST['doit'])) {
	$items = explode(",", $_POST['items']);
	foreach($items AS $item) {
		$thisCount++;
		if($_REQUEST['editType'] == "td") {
			updateSQL("galleries", " gal_title='".addslashes(stripslashes($_REQUEST['gal_title'][$item]))."', gal_descr='".addslashes(stripslashes($_REQUEST['gal_descr'][$item]))."', gal_pg='".addslashes(stripslashes($_REQUEST['gal_pg'][$item]))."', gal_status='".addslashes(stripslashes($_REQUEST['gal_status'][$item]))."',gal_client='".addslashes(stripslashes($_REQUEST['gal_client'][$item]))."', gal_shipping_group='".addslashes(stripslashes($_REQUEST['gal_shipping_group'][$item]))."' ,gal_min_order='".addslashes(stripslashes($_REQUEST['gal_min_order'][$item]))."' , gal_no_ship='".addslashes(stripslashes($_REQUEST['gal_no_ship'][$item]))."' WHERE gal_id='$item' ");
		}
		if($_REQUEST['editType'] == "dates") {
			updateSQL("galleries", " gal_date='".addslashes(stripslashes($_REQUEST['gal_date'][$item]))."', gal_expire='".addslashes(stripslashes($_REQUEST['gal_expire'][$item]))."', gal_discount='".addslashes(stripslashes($_REQUEST['gal_discount'][$item]))."', gal_eb_through='".addslashes(stripslashes($_REQUEST['gal_eb_through'][$item]))."' , gal_eb_through='".addslashes(stripslashes($_REQUEST['gal_eb_through'][$item]))."' , gal_eb_min='".addslashes(stripslashes($_REQUEST['gal_eb_min'][$item]))."' , gal_eb_amount='".addslashes(stripslashes($_REQUEST['gal_eb_amount'][$item]))."' , gal_eb_dis_type='".addslashes(stripslashes($_REQUEST['gal_eb_dis_type'][$item]))."' , gal_eb_use_default='".addslashes(stripslashes($_REQUEST['gal_eb_use_default'][$item]))."'  WHERE gal_id='$item' ");
		}
		if($_REQUEST['editType'] == "download") {
			updateSQL("galleries", " gal_free_image='".addslashes(stripslashes($_REQUEST['gal_free_image'][$item]))."' , gal_search='".addslashes(stripslashes($_REQUEST['gal_search'][$item]))."', gal_allow_invite='".addslashes(stripslashes($_REQUEST['gal_allow_invite'][$item]))."', gal_remove_watermark='".addslashes(stripslashes($_REQUEST['gal_remove_watermark'][$item]))."', gal_free_image_size='".addslashes(stripslashes($_REQUEST['gal_free_image_size'][$item]))."', gal_free_image_watermark='".addslashes(stripslashes($_REQUEST['gal_free_image_watermark'][$item]))."' WHERE gal_id='$item' ");
		}

	}

	$_SESSION['sm'] = "$thisCount selected galleries were saved";
		session_write_close();
	header("location: manage.php?do=photocart&action=galleries&page=".$_REQUEST['page']."");
	exit();
}
?>
<form method="post" name="theForm" action="manage.php">

<?php 
if(empty($_REQUEST['galleries'])) {
	$_SESSION['smerror'] = "You did not select any galleries to edit";
		session_write_close();
	header("location: manage.php?do=photocart&action=galleries&page=".$_REQUEST['page']."");
	exit();
}
foreach($_REQUEST['galleries'] AS $gal => $id) { 
	$entry = doSQL("galleries","*", "WHERE gal_id='$gal' ");
	if($ic<1) {
		$items .= $entry['gal_id'];
	} else {
		$items .= ",".$entry['gal_id'];
	}

	$ic++;
	if($ic%2) {
		$rowclass= "1";
	} else {
		$rowclass = "2";
	}
?>
	<div id="batchEdit<?php print $rowclass;?>">
	<div class="label"><?php print $entry['gal_title'];?></div>
	<div class="pageContent">
		<div style="width:20%;" class="cssCell">
	<?php 
		if(!empty($entry['gal_prev_image'])) {
			$size = @GetImageSize("".$setup['path']."/".$setup['gallery_folder']."/".$entry['gal_folder']."/".$entry['gal_prev_image'].""); 
			print "<img src=\"".$setup['url']."/".$setup['gallery_folder']."/".$entry['gal_folder']."/".$entry['gal_prev_image']."\" height=\"$size[1]\" width=\"$size[0]\" border=\"0\" class=th_image>";
		} else {
			if(!empty($entry['gal_preview'])) {
				$pic = doSQL("pics",  "*", " WHERE pic_id='".$entry['gal_preview']."'");
				$pic_th = $pic['pic_th'];
			} else {
				$pic = doSQL("pics",  "*", "WHERE pic_gal='".$entry['gal_id']."' ORDER BY pic_id ASC");
				$pic_th = $pic['pic_th'];
			}
			$th_folder = $entry['gal_folder'];
			if((empty($pic_th)) AND (countIt("galleries", "WHERE gal_sub_gal='".$listgal['gal_id']."' ") > 0) ==true){
				$subg = doSQL("galleries", "gal_id, gal_sub_gal,gal_folder,gal_preview,gal_order", "WHERE gal_sub_gal='".$entry['gal_id']."' ORDER BY gal_order, gal_title ASC  LIMIT 1");
				if(!empty($subg['gal_preview'])) {
					$pic = doSQL("pics",  "pic_id,pic_th,pic_gal", " WHERE pic_id='".$subg['gal_preview']."'  LIMIT 1");
					$pic_th = $pic['pic_th'];

				} else {
					$pic = doSQL("pics",  "pic_id,pic_th,pic_gal", "WHERE pic_gal='".$subg['gal_id']."' ORDER BY pic_id ASC  LIMIT 1");
					$pic_th = $pic['pic_th'];
				}
				$th_folder = $subg['gal_folder'];
			}
			$size = @GetImageSize("".$setup['path']."/".$setup['gallery_folder']."/".$th_folder."/$pic_th"); 
			if(!empty($pic_th)){
				print "<img src=\"".$setup['url']."/".$setup['gallery_folder']."/".$th_folder."/".$pic['pic_th']."\" height=\"$size[1]\" width=\"$size[0]\" border=\"0\" class=th_image alt=\"".$pic['pic_text']."\">";
			}
		}
?>
&nbsp;

</div>
<div style="width:80%;" class="cssCell">

<?php 

	if($_REQUEST['editType'] == "td") {
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Title</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_title[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_title']))."\" size=\"30\"  style=\"width: 96%;\">";
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Price group</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<select name=\"gal_pg[".$entry['gal_id']."]\">";
		print  "<option value=\"0\">No pricing - not for sale</option>";
		$groups = whileSQL("price_groups", "*", " ");
		while($group = mysql_fetch_array($groups)) {
			print  "<option value=\"".$group['pg_id']."\" "; if($group['pg_id'] == $entry['gal_pg']) { print " selected"; } print ">".$group['pg_name']."</option>";
		}
		print  "</select>";
		print "</div><div class=\"cssClear\"></div></div>";


		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Type of gallery</div><div style=\"width:80%;\" class=\"cssCell\">";
		
		print "<select name=\"gal_client[".$entry['gal_id']."]\">";
			print  "<option value=\"1\" "; if($entry['gal_client']=="1") { print " selected"; } print ">Private</option>";
			print  "<option value=\"2\" "; if($entry['gal_client']=="2") { print " selected"; } print ">Public</option>";
			print  "<option value=\"3\" "; if($entry['gal_client']=="3") { print " selected"; } print ">Public w/ access code</option>";
		print  "</select>";
		print "</div><div class=\"cssClear\"></div></div>";



		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Status</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_status[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_status'] == "0") { print "checked"; } ?>>Not Active &nbsp;  
		<input type="radio" name="gal_status[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_status'] == "1") { print "checked"; } ?>>Active
<?php 
		print "</div><div class=\"cssClear\"></div></div>";

		
		
		
		
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Min. order amount</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_min_order[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_min_order']))."\" size=\"6\"><br>This will set the minimum order amount for orders out of this gallery. This overrides the main minimum order amount setting of ".showPrice($site_setup['min_order'])."";
		print "</div><div class=\"cssClear\"></div></div>";


		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Disable shipping</div><div style=\"width:80%;\" class=\"cssCell\">";
		?>
		<input type="radio" name="gal_no_ship[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_no_ship'] == "0") { print "checked"; } ?>>No &nbsp;  
		<input type="radio" name="gal_no_ship[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_no_ship'] == "1") { print "checked"; } ?>>Yes
		<?php

		print "</div><div class=\"cssClear\"></div></div>";


		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Shipping group</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<select name=\"gal_shipping_group[".$entry['gal_id']."]\">";
		print  "<option value=\"0\">Default shipping settings</option>";
		 $sgs = whileSQL("pc_shipping_groups", "*", "ORDER BY sg_name ASC");
		while($sg = mysql_fetch_array($sgs)) {
			print  "<option value=\"".$sg['sg_id']."\" "; if($sg['sg_id'] == $entry['gal_shipping_group']) { print " selected"; } print ">".$sg['sg_name']."</option>";
		}
		print  "</select>";
		print "</div><div class=\"cssClear\"></div></div>";


		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Description</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<textarea name=\"gal_descr[$gal]\" rows=\"4\" cols=\"60\" style=\"width: 96%;\">".htmlspecialchars(stripslashes($entry['gal_descr']))."</textarea>";
		print "</div><div class=\"cssClear\"></div></div>";






	}


	if($_REQUEST['editType'] == "dates") {
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Date created</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_date[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_date']))."\" size=\"15\"> (YYYY-MM-DD)";
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Expiration date</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_expire[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_expire']))."\" size=\"15\"> (YYYY-MM-DD)";
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Early bird special</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_discount[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_discount'] == "0") { print "checked"; } ?>>Off &nbsp;  
		<input type="radio" name="gal_discount[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_discount'] == "1") { print "checked"; } ?>>On
<?php 
		print "</div><div class=\"cssClear\"></div></div>";
		if($entry['gal_eb_use_default'] == "0") { $entry['gal_eb_use_default'] = "1"; } 
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Use default settings or override below.</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_eb_use_default[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_eb_use_default'] == "1") { print "checked"; } ?>>Use my default settings&nbsp;  
		<input type="radio" name="gal_eb_use_default[<?php  print $entry['gal_id'];?>]" value="2" <?php  if($entry['gal_eb_use_default'] == "2") { print "checked"; } ?>>Override with settings below 
<?php 
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Discount Type</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_eb_dis_type[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_eb_dis_type'] == "0") { print "checked"; } ?>>Percentage&nbsp;  
		<input type="radio" name="gal_eb_dis_type[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_eb_dis_type'] == "1") { print "checked"; } ?>>Flat rate
<?php 
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Discount amount</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_eb_amount[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_eb_amount']))."\" size=\"6\"> )";
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Min. order amount to receive discount</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_eb_min[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_eb_min']))."\" size=\"6\"> ";
		print "</div><div class=\"cssClear\"></div></div>";


		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Early bird special good through</div><div style=\"width:80%;\" class=\"cssCell\">";
		print "<input type=\"text\" name=\"gal_eb_through[$gal]\" value=\"".htmlspecialchars(stripslashes($entry['gal_eb_through']))."\" size=\"15\"> (YYYY-MM-DD)";
		print "</div><div class=\"cssClear\"></div></div>";
	}

	if($_REQUEST['editType'] == "download") {
		print "<div class=\"label\">Free Image Downloads</div>";
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Offer free image downloads</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_free_image[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_free_image'] == "0") { print "checked"; } ?>>No &nbsp;  
		<input type="radio" name="gal_free_image[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_free_image'] == "1") { print "checked"; } ?>>Yes
<?php 
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Free image download size</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_free_image_size[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_free_image_size'] == "0") { print "checked"; } ?>>Display image  &nbsp;<br>  
		<input type="radio" name="gal_free_image_size[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_free_image_size'] == "1") { print "checked"; } ?>>Zoom image <br>
		<input type="radio" name="gal_free_image_size[<?php  print $entry['gal_id'];?>]" value="2" <?php  if($entry['gal_free_image_size'] == "2") { print "checked"; } ?>>Download image
<?php 
		print "</div><div class=\"cssClear\"></div></div>";

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Watermark free image</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_free_image_watermark[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_free_image_watermark'] == "0") { print "checked"; } ?>>No &nbsp;  
		<input type="radio" name="gal_free_image_watermark[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_free_image_watermark'] == "1") { print "checked"; } ?>>Yes
<?php 
		print "</div><div class=\"cssClear\"></div></div>";



		print "<div class=\"label\">Other</div>";
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Allow image search</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_search[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_search'] == "0") { print "checked"; } ?>>No &nbsp;  
		<input type="radio" name="gal_search[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_search'] == "1") { print "checked"; } ?>>Yes
<?php 
		print "</div><div class=\"cssClear\"></div></div>";
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Allow invite to gallery</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_allow_invite[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_allow_invite'] == "0") { print "checked"; } ?>>No &nbsp;  
		<input type="radio" name="gal_allow_invite[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_allow_invite'] == "1") { print "checked"; } ?>>Yes
<?php 
		print "</div><div class=\"cssClear\"></div></div>";
		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\">Remove watermarking</div><div style=\"width:80%;\" class=\"cssCell\">";
	?><input type="radio" name="gal_remove_watermark[<?php  print $entry['gal_id'];?>]" value="0" <?php  if($entry['gal_remove_watermark'] == "0") { print "checked"; } ?>>No &nbsp;  
		<input type="radio" name="gal_remove_watermark[<?php  print $entry['gal_id'];?>]" value="1" <?php  if($entry['gal_remove_watermark'] == "1") { print "checked"; } ?>>Yes
<?php 
		print "</div><div class=\"cssClear\"></div></div>";

	}

	print "</div>";
?>
</div>
	<div class="cssClear"></div>
	</div>
</div>
<div>&nbsp;</div>
<?php } ?>


<div class="pageContent">
<input type="hidden" name="editType" value="<?php  print $_REQUEST['editType'];?>">

<input type="hidden" name="items" value="<?php  print $items;?>">
<input type="hidden" name="doit" value="yes">
<input type="hidden" name="page" value="<?php  print $_REQUEST['page'];?>">
<input type="hidden" name="do" value="photocart">
<input type="hidden" name="action" value="galleries">
<input type="hidden" name="subdo" value="batchEditGalleries">
<center><input type="submit" name="submit" value="<?php  print $xf['submit_button'];?>" class=submit></center>
<br>
<center><?php  print "<a href=\"manage.php?do=photocart&action=galleries&page=".$_REQUEST['page']."\">Cancel</a></center>"; ?>


</div>
</form>