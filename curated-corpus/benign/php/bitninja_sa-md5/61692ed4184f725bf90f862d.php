<?php

$nameErr = $emailErr = $organisationErr = $positionErr = $interestErr = $mobileErr = $countryErr = "";
$name = $email = $organisation = $position = $interest = $mobile = $country = $success = "";
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Name validation
    if (empty($_POST["name"])) {
        $nameErr = "Name is required";
    } else {
        $name = validate_data($_POST["name"]);
        // check if name only contains letters and whitespace
        if (!preg_match("/^[a-zA-Z-' ]*\$/", $name)) {
            $nameErr = "Only letters and white space allowed";
        }
    }
    // Email validation
    // $email = validate_data($_POST["email"]);
    if (empty($_POST["email"])) {
        $emailErr = "Email is required";
    } else {
        $email = validate_data($_POST["email"]);
        // check if e-mail address is well-formed
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            $emailErr = "Invalid email format";
        }
    }
    /* Organisation Validation*/
    // $organisation = validate_data($_POST["org"]);
    if (empty($_POST["org"])) {
        $organisationErr = "Organisation name is required";
    } else {
        $organisation = validate_data($_POST["org"]);
        // check if name only contains letters and whitespace
        if (!preg_match("/^[a-zA-Z-' ]*\$/", $organisation)) {
            $organisationErr = "Only letters and white space allowed";
        }
    }
    /* Position */
    // $position = validate_data($_POST["position"]);
    if (empty($_POST["position"])) {
        $positionErr = "Position name is required";
    } else {
        $position = validate_data($_POST["position"]);
        // check if name only contains letters and whitespace
        if (!preg_match("/^[a-zA-Z-' ]*\$/", $position)) {
            $positionErr = "Only letters and white space allowed";
        }
    }
    /* Interest */
    // $interest = validate_data($_POST["interest"]);
    if (empty($_POST["interest"])) {
        $interestErr = "Position name is required";
    } else {
        $interest = validate_data($_POST["interest"]);
        // check if name only contains letters and whitespace
        if (!preg_match("/^[a-zA-Z-' ]*\$/", $interest)) {
            $interestErr = "Only letters and white space allowed";
        }
    }
    /* Mobile validation */
    //   $mobile = validate_data($_POST["mobile"]);
    if (empty($_POST["mobile"])) {
        $mobileErr = "Please enter valid mobile number";
    } else {
        $mobile = validate_data($_POST["mobile"]);
    }
    /* Country validation */
    // $country = validate_data($_POST["country"]);
    if (empty($_POST["country"])) {
        $countryErr = "Please enter country name";
    } else {
        $country = validate_data($_POST["country"]);
    }
    $headers = 'From: ' . $email . "\n";
    $headers .= 'Reply-To: ' . $email . "\n";
    $headers .= 'Content-Type: text/plain; charset= "iso-8859-1"' . "\n";
    $headers .= 'Content-Transfer-Encoding: 8bit' . "\n";
    $toEmail = "ruvixtel@gmail.com";
    $mailHeaders = "From: {$name} \n Email: {$email}";
    $content = "Name: {$name} \n Email: {$email} \n Organisation: {$organisation} \n Position: {$position} \n Interest: {$interest} \n Mobile: {$mobile} \n Country: {$country}";
    if (empty(mail($toEmail, $mailHeaders, $content))) {
        $failed = "Failed to send email.";
        // header('Location: Conference.html');
    } else {
        $success = "Mail succesuffully sent";
        header('Location: Conference.html');
    }
}
function validate_data($data)
{
    $data = trim($data);
    $data = stripslashes($data);
    $data = htmlspecialchars($data);
    return $data;
}
echo htmlspecialchars($_SERVER["PHP_SELF"]);
echo $nameErr;
echo $emailErr;
echo $organisationErr;
?>" class="form-control" require >
                                
                            </div>

                            <div class="p-2">
                                <input type="text" Placeholder="Position" name="position" value="<?php 
echo $positionErr;
?>" class="form-control">
                                
                            </div>

                            <div class="p-2">
                                <input type="text" Placeholder="Areas of Interest" name="interest" value="<?php 
echo $interestErr;
?>" class="form-control">
                                
                            </div>

                            <div class="p-2">
                                <input type="number" Placeholder="Mobile" name="mobile" value="<?php 
echo $mobileErr;
?>" class="form-control" >
                                
                            </div>

                            <div class="p-2">
                                <input type="text" Placeholder="Country" name="country" value="<?php 
echo $countryErr;
?>" class="form-control">
                                
                            </div>
                            
                            <div class="p-2">
                                <button type="submit" class="btn btn-primary">Submit</button>
                                <?php 
echo $success;
?> 
                            </div>
                            
                        </form>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<div w3-include-html="./common/footer.html"></div>
        <!-- Footer -->

</body>
</html>