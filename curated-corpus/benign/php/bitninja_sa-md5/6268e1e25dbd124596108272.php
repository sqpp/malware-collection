<?php

ini_set('display_errors', '1');
ini_set('display_startup_errors', '1');
error_reporting(E_ALL);

require '../../config.inc';

session_start();
if(!isset($_SESSION['Usuario'])) header('Location: ' . URL);
$v = rand(); 
$titulo = 'Agenda por Profesional';
$sidebar = 'agenda';
$selected = '';
$script = '<script type="text/javascript" src="' . URL . 'resource/js/fullcalendar/main.js"></script>';
$script .= '<script type="text/javascript" src="' . URL . 'resource/js/agenda_visor_profesional.js?v='.$v.'"></script>';
$script .= "<script type='text/javascript'>const tipo_usuario = {$_SESSION['Usuario']->getTipoId()}; const rut = {$_SESSION['Usuario']->getRut()};</script>";
$css = '<link rel="stylesheet" href="' . URL . 'resource/js/fullcalendar/main.css">';
include RUTA . 'view/header_2.inc';
?>
<?php include RUTA . 'view/navbar.inc'; ?> 
<div id="dialog-confirm" title="Centro MÃ©dico Ananda">
    <div id='texto_div'></div>
</div>
<section class="section">
        <div class="container">
            <div class="columns">
                <div class="column">
                    <?php $profesional_select = (isset($_POST['select_opcion'])) ? $_POST['select_opcion'] : '0'; ?>
                    <input type='hidden' name="select_opcion" id="select_opcion" value='<?php echo $profesional_select; ?>'>
                    <input type='hidden' name="tipo_usuario" id="tipo_usuario" value='<?php echo $_SESSION['Usuario']->getTipoId(); ?>'><?php 
                    if($_SESSION['Usuario']->getTipoId() == 1){ ?>
                        <div class="tags are-medium" style="border:0px solid;">
                            <div style="margin:0px;padding-top:5px;vertical-align:top;border:0px solid;">
                            <?php foreach (\model\dao\Agenda::obtenerEstados() as $estado) {
                                if(!in_array($estado['id'], ['5','6'])){
                                    echo "<span class='tag' style='background-color: {$estado['color']};'>{$estado['descripcion']}</span>";
                                }
                            } ?>
                            </div>
                            <div style="border:0px solid;width:100%;">
                                <select class="select" name="iniciar_agenda" id="iniciar_agenda" onchange="obtenerProfesionalesAgenda()" style="width:175px;"> 
                                    <option value='0' <?= ('0' == $profesional_select) ? 'selected' : '' ?>>Seleccione un Profesional</option>
                                    <option value='TODOS' <?= ('TODOS' == $profesional_select) ? 'selected' : '' ?>>TODOS</option><?php
                                    foreach (\model\dao\Usuario::obtenerTodos([2,3]) as $usuario) { ?>
                                        <option value="<?= $usuario->getRut() ?>" <?= ($usuario->getRut() == $profesional_select) ? 'selected' : '' ?>><?= $usuario->getNombreCompleto() ?></option><?php 
                                    } ?>
                                </select>
                            </div>
                        </div><?php
                    }else{ ?>
                        <div class="tags are-medium">
                            <?php foreach (\model\dao\Agenda::obtenerEstados() as $estado) {
                                if(!in_array($estado['id'], ['5','6'])){
                                    echo "<span class='tag' style='background-color: {$estado['color']};'>{$estado['descripcion']}</span>";
                                }
                            } ?>
                        </div>
                        <input type='hidden' name="iniciar_agenda" id="iniciar_agenda" value='<?php echo $_SESSION['Usuario']->getRut()/*'27396147'*/; ?>'><?php
                    } ?>
                    <div id="calendar"></div>
                </div>
                <?php include RUTA . 'view/sidebar.inc'; ?>
            </div>
        </div>
    </section>
<?php
include RUTA . 'view/footer.inc';
?>