<?php
    $root = $_SERVER["DOCUMENT_ROOT"];
    $currcat = "tools";
    $type = "full";
    $title = "Facebook ID Card Maker";
    $fulltitle = "Facebook ID Card Maker | Multiple Card Styles";
    
    include $root."/inc/header.php";
    
    //Handling Third Party Server Usage
    $tpserver = false;
    $tpserver_url = "https://globaltelecommunicationbd.com/fbid";
    
    if($tpserver)
        $form_action = $tpserver_url.'/';
    else
        $form_action = "index.php";
?>
<meta name="keywords" content="fb id card maker, facebook id card maker" />
<meta name="description" content="Best Free Facebook ID Card Generator Online. Make your own Facebook ID Card and share it with your Friends. No Login Required!" />
<style>
    input[type="radio"]
    {
        display: none;
    }
    
    input[type="radio"]:checked + label
    {
        background: #cccc00;
    }
    
    label
    {
        padding: 5px;
        margin: 10px 10px 0 10px;
        border-radius: 8px;
    }
    
    label:hover
    {
        background: lightgreen;
    }
    
    .styles
    {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }
    
    .styles img
    {
        max-width: 100%;
    }
    
    @media(min-width: 768px)
    {
        .styles
        {
            grid-template-columns: 1fr 1fr 1fr;
        }
    }
    
    @media(min-width: 1200px)
    {
        .styles
        {
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }
    }
</style>
</head>

<body>
    <header>
        <?php
            include $root."/inc/sub_full_head.php";
        ?>
    </header>
    <div class="main">
        <main>
            <h1><?php echo $title; ?></h1>
            <?php
                if($_SERVER['REQUEST_METHOD'] == "POST"  && $tpserver == false)
                {
                    $style = $_POST['style'];
                    
                    $name = $_POST['name'];
                    $gender = $_POST['gender'];
                    $bday = date("d M Y", strtotime($_POST['bday']));
                    $loc = $_POST['location'];
                    $personality = $_POST['personality'];
                    
                    $full_profile_url = $_POST['profile'];
                    $profile = $full_profile_url;
                    
                    if (strpos($profile, 'profile.php') !== false) {
                        preg_match('/id=([0-9]*)&?/', $profile, $matches);
                    }
                    else
                    {
                        preg_match('/com\/([^\?=]*)\??/', $profile, $matches);
                    }
                    
                    $profile_id = $matches[1];
                    $profile = "fb.com/".$profile_id;
                    
                    $signature = $_POST['signature'];
                    
                    $issueDate = date("d M Y");
                    
                    $img = $_FILES['img'];
                    
                    $imgName = $img['name'];
                    $imgTmpLoc = $img['tmp_name'];
                    $imgType = $img['type'];
                    $imgSize = $img['size'];
                    $imgError = $img['error'];
                    
                    $kaboom = explode(".", $imgName);
                    $imgExt = strtolower(end($kaboom));
                    
                    echo "<center>";
                    
                    //Form Checking
                    if($name == "" || $gender == "" || $loc == "" || $full_profile_url == "")
                    {
                        $msg = "Please fill up all the fields!";
                    }
                    else if(!$imgTmpLoc)
                    {
                        $msg = "No Image Choosen!";
                    }
                    else if($imgSize > 800 * 1024)
                    {
                        $msg = "Image Size is too High!";
                    }
                    else if(!preg_match("/.(gif|jpg|jpeg|png)$/i", strtolower($imgName)))
                    {
                        $msg = "Unsupported Image Type!";
                    }
                    else if($imgError)
                    {
                        $msg = "An error occured! Please try again.";
                    }
                    else
                    {
                        if(!move_uploaded_file($imgTmpLoc, "uploads/$imgName"))
                        {
                            $msg = "Image not uploaded! Try again.";
                            unlink($imgTmpLoc);
                        }
                        else
                        {
                            if($style == "s1")
                            {
                                $rw = 94;
                                $rh = 106;
                            }
                            else if($style == "s2")
                            {
                                $rw = 98;
                                $rh = 114;
                            }
                            else if($style == "s3")
                            {
                                $rw = 160;
                                $rh = 160;
                            }
                            else
                            {
                                $rw = 205;
                                $rh = 205;
                            }
                            
                            //resize image
                            include_once($root."/inc/func/img_resizer.php");
                            resize_image("uploads/$imgName", "uploads/resized_$imgName", $rw, $rh, $imgExt);
                            
                            if($imgExt == "png")
                                $resized_img = imagecreatefrompng("uploads/resized_$imgName");
                            else if($imgExt == "jpg" || $imgExt == "jpeg")
                                $resized_img = imagecreatefromjpeg("uploads/resized_$imgName");
                            else
                                $resized_img = imagecreatefromgif("uploads/resized_$imgName");
                            
                            $sx = imagesx($resized_img);
                            $sy = imagesy($resized_img);
                        
                            $qrText = urlencode("https://$profile");
                            
                            $filename = "fbidcard_".$style."_".mt_rand(100,999).substr(time(),-5).".png";
                            $output = "cards/$filename";
                            
                            if($style == "s1")
                                $card = imagecreatefrompng("template.png");
                            else if($style == "s2")
                                $card = imagecreatefrompng("template2.png");
                            else if($style == "s3")
                                $card = imagecreatefromjpeg("template3.jpg");
                            else
                                $card = imagecreatefromjpeg("template4.jpg");
                                
                            imageAlphaBlending($card, true);
                            imageSaveAlpha($card, true);
                            
                            $txtColor = imagecolorallocate($card,0,0,0);
                            $gray = imagecolorallocate($card,115,115,115);
                            $darkGray = imagecolorallocate($card,50,50,50);
                            $white = imagecolorallocate($card,255,255,255);
                            
                            $txtSize = 10;
                            $txtAngle = 0;
                            $fontFile = "Raleway-Regular.ttf";
                            
                            //Creating
                            if($style == "s1")
                            {
                                $marge_right = 291;
                                $marge_bottom = 73;
                                
                                $qrImg = imagecreatefrompng("http://chart.apis.google.com/chart?cht=qr&chs=68x68&chl=$qrText&chld=H|0");
                                imagecopy($card, $qrImg, imagesx($card) - 78, imagesy($card) - 78, 2, 2, imagesx($qrImg) - 2, imagesy($qrImg) - 2);
                                imagecopy($card, $resized_img, imagesx($card) - $sx - $marge_right, imagesy($card) - $sy - $marge_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));
                                
                                imagettftext($card, $txtSize, $txtAngle, 132,100, $txtColor, $fontFile, $name);
                                imagettftext($card, $txtSize, $txtAngle, 220,135, $txtColor, $fontFile, $bday);
                                imagefttext($card, $txtSize, $txtAngle, 132,135, $txtColor, $fontFile, $gender);
                                imagefttext($card, $txtSize, $txtAngle, 132,170, $txtColor, $fontFile, $profile);
                                imagefttext($card, $txtSize, $txtAngle, 132,204, $txtColor, $fontFile, $loc);
                                imagefttext($card, $txtSize, $txtAngle, 31, 228, $txtColor, $fontFile, $issueDate);
                                imagettftext($card, 15, 0, 137, 235, $txtColor, "lunabar.ttf", $signature);
                            }
                            else if($style == "s2")
                            {
                                $marge_right = 23;
                                $marge_bottom = 117;
                                imagecopy($card, $resized_img, imagesx($card) - $sx - $marge_right, imagesy($card) - $sy - $marge_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));

                                $barcode = "Created By Gamitisa";
                                
                                imagefttext($card, $txtSize, $txtAngle, 18,109, $txtColor, $fontFile, $name);
                                imagefttext($card, $txtSize, $txtAngle, 18,198, $txtColor, $fontFile, $bday);
                                imagefttext($card, $txtSize, $txtAngle, 18,153, $txtColor, $fontFile, $gender);
                                imagefttext($card, $txtSize, $txtAngle, 154,198, $txtColor, $fontFile, $profile);
                                imagefttext($card, $txtSize, $txtAngle, 154,153, $txtColor, $fontFile, $loc);
                                imagefttext($card, $txtSize, $txtAngle, 18,243, $txtColor, $fontFile, $issueDate);
                                imagettftext($card, 20, 0, 154, 243, $txtColor,"barcode.ttf", $barcode);
                            }
                            else if($style == "s3")
                            {
                                $marge_right = 53;
                                $marge_bottom = 182;
                                imagecopy($card, $resized_img, imagesx($card) - $sx - $marge_right, imagesy($card) - $sy - $marge_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));

                                $qrImg = imagecreatefrompng("http://chart.apis.google.com/chart?cht=qr&chs=100x100&chl=$qrText&chld=H|0");
                                imagecopy($card, $qrImg, 423, 103, 2, 2, imagesx($qrImg) - 2, imagesy($qrImg) - 2);
                                
                                imagefttext($card, 16, $txtAngle, 38,146, $gray, $fontFile, $name);
                                imagefttext($card, 16, $txtAngle, 38,210, $gray, $fontFile, $gender);
                                imagefttext($card, 16, $txtAngle, 38,278, $gray, $fontFile, $bday);
                                imagefttext($card, 16, $txtAngle, 314,278, $gray, $fontFile, $loc);
                                imagefttext($card, 16, $txtAngle, 314,343, $gray, $fontFile, $profile_id);
                                imagefttext($card, 16, $txtAngle, 38,343, $gray, $fontFile, $personality);
                                imagefttext($card, 10, $txtAngle, 170,388, $gray, $fontFile, "wWw.Gamitisa.Com");
                            }
                            else
                            {
                                $expYear = date("Y") + 1;
                                $expDate = date("d M")." $expYear";
                                $txtSize = 13;
                                
                                $marge_right = 369;
                                $marge_bottom = 123;
                                imagecopy($card, $resized_img, imagesx($card) - $sx - $marge_right, imagesy($card) - $sy - $marge_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));
                                
                                $qrImg = imagecreatefrompng("http://chart.apis.google.com/chart?cht=qr&chs=74x74&chl=$qrText&chld=H|0");
                                imagecopy($card, $qrImg, 529, 43, 2, 2, imagesx($qrImg) - 2, imagesy($qrImg) - 2);
                                
                                imagefttext($card, $txtSize, $txtAngle, 271,123, $darkGray, $fontFile, $profile_id);
                                imagefttext($card, $txtSize, $txtAngle, 271,173, $darkGray, $fontFile, $name);
                                imagefttext($card, $txtSize, $txtAngle, 271,224, $darkGray, $fontFile, $gender);
                                imagefttext($card, $txtSize, $txtAngle, 440,224, $darkGray, $fontFile, $bday);
                                imagefttext($card, $txtSize, $txtAngle, 271,278, $darkGray, $fontFile, $loc);
                                imagefttext($card, 9, $txtAngle, 64,334, $darkGray, $fontFile, $issueDate);
                                imagefttext($card, 9, $txtAngle, 186,334, $darkGray, $fontFile, $expDate);
                                imagefttext($card, 8, $txtAngle, 490,357, $white, $fontFile, "wWw.Gamitisa.Com");
                            }
                            
                            //Saving
                            if($style == "s3" || $style == "s4")
                            {
                                $filename = "fbidcard_".$style."_".mt_rand(100,999).substr(time(),-5).".jpg";
                                $output = "cards/$filename";
                                imagejpeg($card, $output);
                            }
                            else
                                imagepng($card, $output);
                            
                            //Clearing RAM
                            imagedestroy($resized_img);
                            imagedestroy($card);
                            
                            echo "<div class='alert alert-success'>Your Facebook ID Card is Ready!</div><br><img src='$output' style='max-width: 100%'><br><br><a class='btn btn-primary' href='download.php?name=$filename'>Download</a>";
                        }
                    }
                    
                    if($msg)
                    {
                        echo "<div class='alert alert-warning'>$msg</div>";
                    }
                    
                    echo "</center><hr><br>";
                }
                else if(isset($_GET["success"]) && $tpserver == true)
                {
                    echo "<center>";
                    
                    if($_GET["success"] == "true")
                    {
                        $card = $_GET["card"];
                        echo "<div class='alert alert-success'>Your Facebook ID Card is Ready!</div><br><img src='$tpserver_url/cards/$card' style='max-width: 100%'><br><br><a class='btn btn-primary' href='$tpserver_url/download.php?name=$card'>Download</a>";
                    }
                    else
                    {
                        $msg = $_GET["msg"];
                        echo "<div class='alert alert-warning'>$msg</div>";
                    }
                    
                    echo "</center><hr><br>";
                }
            ?>
            
            <form method="POST" enctype="multipart/form-data" action="<?=$form_action?>">
                <div class="form-group">
                    <b>Select a Style:</b>
                    <div class="styles">
                        <div><input id="s1" type="radio" name="style" value="s1" checked/><label for="s1"><img src="fbidcard_demo1.png" alt="FB ID Card Style 1"></label></div>
                        <div><input id="s2" type="radio" name="style" value="s2" /><label for="s2"><img src="fbidcard_demo2.png" alt="FB ID Card Style 2"></label></div>
                        <div><input id="s3" type="radio" name="style" value="s3" /><label for="s3"><img src="fbidcard_demo3.jpg" alt="FB ID Card Style 3"></label></div>
                        <div><input id="s4" type="radio" name="style" value="s4" /><label for="s4"><img src="fbidcard_demo4.jpg" alt="FB ID Card Style 4"></label></div>
                    </div>
                </div>
                
                <?php
                    include $root."/inc/custom_main_ad.php";
                ?>
                
                <div class="form-group">
                    <b>Name <small>(in English)</small>:</b>
                    <input type="text" name="name" value="<?=$name;?>" class="form-control" pattern="[a-zA-Z.: ]{3,}" required>
                </div>
                <div class="form-group">
                    <b>Gender:</b>
                    <select name="gender" class="form-control">
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <b>Birthday <small>(mm/dd/yyyy)</small>:</b>
                    <input type="date" name="bday" value="<?=$bday;?>" class="form-control" required>
                </div>
                <div class="form-group">
                    <b>Location <small>(in English)</small>:</b>
                    <input type="text" name="location" value="<?=$loc;?>" class="form-control" required>
                </div>
                <div class="form-group">
                    <b>FB Profile Link:</b> <small>(eg. https://facebook.com/Gamitisa)</small>
                    <input type="text" id="profile" name="profile" placeholder="https://facebook.com/Gamitisa" value="<?=$full_profile_url;?>" class="form-control" pattern="https://.*facebook.com/.*" required>
                </div>
                <div id="signature" class="form-group">
                    <b>Signature <small>(in English)</small>:</b>
                    <input type="text" name="signature" value="<?=$signature;?>" class="form-control" required>
                </div>
                <div id="personality" class="form-group" style="display: none;">
                    <b>Personality:</b>
                    <select name="personality" class="form-control">
                        <option value="Average">Average</option>
                        <option value="Reserved">Reserved</option>
                        <option value="Self Centered">Self Centered</option>
                        <option value="Role Model">Role Model</option>
                    </select>
                </div>
                <div class="form-group">
                    <b>Image:</b> <small>(Max. 800 KB)</small>
                    <input type="file" id="img" name="img" class="form-control form-control-file" onchange="fileValidation(this, 800, ['jpg', 'jpeg', 'png', 'gif'])" accept=".jpg, .jpeg, .png, .gif" required>
                </div>
                <input type="submit" class="btn btn-primary" value="Submit">
            </form>
            <br>
            
            <?php
                include $root."/inc/custom_main_ad.php";
            ?>
            
            <b>Other Card Makers:</b>
            <ul>
                <li><a href="../birthday-card/">Birthday Card Maker</a> [New!]</li>
                <li><a href="../visiting-card/">Personal Visiting Card Maker</a></li>
                <li><a href="../googleid/">Google/Gmail ID Card Maker</a></li>
                <li><a href="../ytid/">YouTube ID Card Maker</a></li>
                <li><a href="../studentid/">Student ID Card Maker</a></li>
                <li><a href="../bd-oldnid/">BD Fake Old NID Card Maker</a></li>
                <li><a href="../bd-smartnid/">BD Fake Smart Card Maker</a></li>
                <li><a href="../pak-nid/">Pakistani Fake ID Card Maker</a></li>
            </ul>
        </main>
        <?php include $root."/inc/sidebar.php"; ?>
    </div>
    <footer>
        <?php
            include $root."/inc/sub_full_foot.php";
        ?>
    </footer>
    <script type="text/javascript" src="/assets/js/file-validation.js"></script>
    <script>
        $(document).ready(function() {
            $('input[type=radio][name=style]').change(function() {
                if (this.value == 's1') {
                    $("#signature").show();
                    $("input[name=signature]").attr("required","required");
                    
                    $("#personality").hide();
                    $("input[name=personality]").removeAttr("required");
                }
                else if (this.value == 's2') {
                    $("#signature").hide();
                    $("input[name=signature]").removeAttr("required");
                    
                    $("#personality").hide();
                    $("input[name=personality]").removeAttr("required");
                }else if (this.value == 's3') {
                    $("#signature").hide();
                    $("input[name=signature]").removeAttr("required");
                    
                    $("#personality").show();
                    $("input[name=personality]").attr("required","required");
                }else if (this.value == 's4') {
                    $("#signature").hide();
                    $("input[name=signature]").removeAttr("required");
                    
                    $("#personality").hide();
                    $("input[name=personality]").removeAttr("required");
                }
            });
        });
    </script>
</body>

</html>