<?php
ob_start();
include('db_config.php');
$Name = $_POST["Name"];
$Grade = $_POST["Grade"];
$Class = $_POST["Class"];
$Subject = $_POST["Subject"];
$Paper = $_POST["Paper"];


$sql_ID = "SELECT `ID` FROM `answers_log` ORDER BY `ID` DESC LIMIT 1";
$result = mysqli_query($conn, $sql_ID);
if (mysqli_num_rows($result) > 0) {while($row = mysqli_fetch_assoc($result)) {$Pre_ID = $row["ID"];}} 
else {$Pre_ID=0;}

$filename = $Pre_ID+1;

$sql = "INSERT INTO `answers_log`(`S_Name`, `Grade`, `Class`, `Subject`, `Paper`, `ip`, `browser`, `date_time`)
VALUES ('".$Name."','".$Grade."','".$Class."','".$Subject."','".$Paper."','".$_SERVER['REMOTE_ADDR']."','".$_SERVER['HTTP_USER_AGENT']."',CURRENT_TIMESTAMP)";

if (mysqli_query($conn, $sql)) {
    echo "uploading...";
} else {
    echo "Error: " . $sql . "<br>" . mysqli_error($conn);
}

//$filename   = uniqid() . "-" . time(); // 5dab1961e93a7-1571494241

if($Grade=="AL"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/AL/" . $basename;
move_uploaded_file( $source, $destination );
}
else if($Grade=="11"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/11/" . $basename;
move_uploaded_file( $source, $destination );
}
else if($Grade=="10"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/10/" . $basename;
move_uploaded_file( $source, $destination );
}
else if($Grade=="09"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/09/" . $basename;
move_uploaded_file( $source, $destination );
}
else if($Grade=="08"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/08/" . $basename;
move_uploaded_file( $source, $destination );
}
else if($Grade=="07"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/07/" . $basename;
move_uploaded_file( $source, $destination );
}

else if($Grade=="06"){
$extension  = pathinfo( $_FILES["file"]["name"], PATHINFO_EXTENSION ); 
$basename   = $filename . '.' . $extension; 
$source       = $_FILES["file"]["tmp_name"];
$destination  = "../Downloads/Answers/06/" . $basename;
move_uploaded_file( $source, $destination );
}

$referer = $_SERVER['HTTP_REFERER'];
header("Location: $referer?msg=1");
ob_end_flush();
?>