<?php
require_once('dbconnection.php');
if(isset($_SESSION['user_id'])=='')
 {
   header("Location:login.php");
 } 
$id = $_GET['id'];
$sql = "SELECT * FROM header_image WHERE id='$id'";
$result_set =$conn->query($sql)->fetch(PDO::FETCH_ASSOC);
if($_SERVER['REQUEST_METHOD'] == 'POST')
{
   
   extract($_POST);
   $title = $_POST['title'];
   $meta_keywords = $_POST['meta_keywords'];
   $meta_description = $_POST['meta_description'];
   $updateddate = date('Y-m-d');
   $file_name = $_FILES['filename']['name'];
   $im='';
   $image_upload='';
   if($file_name !='')
   {
         // print_r($_FILES);
         $filename  = time().basename($_FILES['filename']['name']);
         $file_size = $_FILES['filename']['size'];
         $file_tmp  = $_FILES['filename']['tmp_name'];
         $file_ext= pathinfo($filename, PATHINFO_EXTENSION);
         $extension  = array("jpeg","jpg","png");
        
          if(in_array($file_ext,$extension) === False)
          {
            ?>
            <script>alert('extension not allowed')</script>
            
            <script>window.location.href ="header_update.php?id=<?php echo $result_set['id'];?>"</script>
            <?php
             // echo $result_set['id'];
                die;
             }
         
        
         
         if($file_size >= 20000000)
         {
            ?>
            <script>alert('Please check your file size is large')</script>
            <script>window.location.href ="header_update.php?id=<?php echo $result_set['id'];?>"</script>
            <?php
            
               die;
            }
        $file_name= time()."_".$file_name;
         move_uploaded_file($file_tmp,"uploads/".$file_name);
               
               if(isset($file_name) && $file_name!=='')
               {
                  $im =$file_name;
               }
            
      
   }
   if(empty($im)){
      echo "old_image:$old_image";
      $image_upload = $old_image;
      echo "image_upload:$image_upload";
   }else{
      $image_upload = $im;
      echo "im:$image_upload";
   }
   
   if(isset($image_upload))
         {
               $sql = "UPDATE header_image SET `image`='$image_upload', `title`='$title', `meta_keywords`='$meta_keywords', 
            `meta_description`='$meta_description',
             updated_at='$updatedate' WHERE `id`='$id'";
                  $statement = $conn->prepare($sql);
                  
               if ($statement->execute() === TRUE)
               {
                        $_SESSION['message']= "updated successfully";
                         header("Location:header_table.php");
                        die();
               } 
                     
               $conn->close();
         }
          else
          {
               
            echo "<script>alert('".$error[0]."')</script>";
            
          }

}

?>
<?php include 'includes/header.php'; ?>
<section>
   <div class="container-fluid">
      <!-- <a type="button" style="margin-left:;"class="btn btn-info">ADD</a> -->
      <div class="row justify-content-center">
         <div class="col-md-10">

            <div class="card mb-12">
               <!-- <div class="card-header">Header update
               
                  <a type="button"class="btn btn-outline-secondary" href="header_table.php" style="margin-left:650px;height:30px;width:60px;"><i>Back</i></a>
               </div> -->
               <div><a style="margin-left:900px;margin-top:13px;"class="btn btn-outline-secondary" href="header_table.php"><i class="fal fa-chevron-left mr-1"></i>Back</a>
                  <div class="card-header">Header update</div>
               <div class="card-body">
                  <form action="" method="post" enctype="multipart/form-data">
                     <div class="row">
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Title</label>
                              <input type="hidden" name="old_image" value="<?php echo $result_set['image'];?>">
                              <input type="text" class="form-control" name="title" placeholder="Title comes here"value="<?php echo $result_set["title"] ;?>" readonly >
                           </div>
                        </div>
                         
                  
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>meta_keywords</label>
                              <input type="text" class="form-control" name="meta_keywords" placeholder="meta_keywords" value="<?php echo $result_set["meta_keywords"] ;?>" >
                           </div>
                        </div>
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>meta_description</label>
                              <input type="text" class="form-control" name="meta_description"  value="<?php echo $result_set["meta_description"] ;?>" >
                           </div>
                        </div>
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Image</label>
                              <img style="width:80px;height:80px;" src="uploads/<?php echo $result_set["image"];?>">
                              <input type="file" name="filename" class="form-control" id="filename" onchange="check_image_type_and_size(this.id);" >
                             
                              <label><i>Note: file size should be(1440*530) and 
                                          file Extension should be(jpg,jpeg,png)</i>
                              </label>
                           </div>
                        </div>
              
                        
                       
                        <div class="col-12">
                           
                           <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                     </div>
                  </form>
               </div>
           </div>
      </div>
   </div>
</section>

<?php include 'includes/footer.php'; ?>