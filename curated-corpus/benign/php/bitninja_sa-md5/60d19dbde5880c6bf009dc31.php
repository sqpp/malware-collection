<?php 
include("config.php");

if($_POST['action'] == "save_year_action")
{
    // $thumbnail_image = "";
    // print_r($_POST);
    move_uploaded_file($_FILES['thumb_image']['tmp_name'],'uploads/Thumbnail/'.$_FILES['thumb_image']['name']);
    $thumbnail_image = $_FILES['thumb_image']['name'];   

     $insert_year_event = $database->insert("year_event_gallery",[
        "year_id" => null,
        "year_name" => $_POST['year_value'],
        "year_thumb_text" => $_POST['thumb_text'],
        "year_thumb_image" => $thumbnail_image,
        "year_active" => 1,
        "year_created_at" => null,
        "year_updated_at" => null

    ]);

    // $insert_board_exam = $database->insert("entrance_exam_table",[
    //     "e_exam_id" => null,
    //     "subject_name" => $_POST['subject_value'],
    //     "thumbnail_image" => $thumbnail_image,
    //     "active" => 1,
    //     "created_at" => null,
    //     "updated_at" => null
    // ]);
    // echo $insert_year_event;

    if($insert_year_event != 0)
    {
        echo "1";
    }
    else
    {
        echo "0";
    }

}

if($_POST['action'] == "update_year_action_image")
{
    // form_data.append("action","update_year_action_image");
    if($_FILES['thumb_image']['name'] != '')
    {
        move_uploaded_file($_FILES['thumb_image']['tmp_name'],'uploads/Thumbnail/'.$_FILES['thumb_image']['name']);
        $thumbnail_image = $_FILES['thumb_image']['name'];
        $Update_year_event = $database->query("UPDATE year_event_gallery SET
        year_thumb_image = '" .$thumbnail_image."',year_updated_at = null WHERE year_id = ". $_POST['year_id']." ")->fetchAll();   
        if(empty($Update_year_event))
        {
            echo"1";
        }
        else{
            echo"0";
        }
    }
    else{
        echo"2";
    }

    
}

if($_POST['action'] == "year_delete")
{
    $update_query = $database->query("UPDATE year_event_gallery SET year_active = 0 WHERE year_id = " . $_POST['id'] . "  ")->fetchAll();
    if(empty($update_query))
    {
        echo "1";
    }
    else
    {
        echo "0";
    }
}

if($_POST['action'] == "event_delete")
{
    $update_query = $database->query("UPDATE events_image_table SET event_active = 0 WHERE event_id = " . $_POST['id'] . "  ")->fetchAll();
    if(empty($update_query))
    {
        echo "1";
    }
    else
    {
        echo "0";
    }

}

if($_POST['action'] == 'update_event_name')
{
    $update_query = $database->query("UPDATE events_image_table SET event_name = '" . $_POST['event_name'] . "' WHERE event_id = " . $_POST['id'] . "  ")->fetchAll();
    if(empty($update_query))
    {
        echo "1";
    }
    else
    {
        echo "0";
    }


}
if($_POST['action'] == "update_year_event")
{
    if($_POST['type'] == "year_value")
    {
        $update_query = $database->query("UPDATE year_event_gallery SET year_name = '" . $_POST['value'] . "'  WHERE year_id = " . $_POST['id'] . "  ")->fetchAll();
        if(empty($update_query))
        {
            echo "1";
        }
        else
        {
            echo "0";
        }

    }
    else
    {

        $update_query = $database->query("UPDATE year_event_gallery SET year_thumb_text = '" . $_POST['value'] . "'  WHERE year_id = " . $_POST['id'] . "  ")->fetchAll();
        if(empty($update_query))
        {
            echo "1";
        }
        else
        {
            echo "0";
        }

    }

}


if($_POST['action'] == "save_event_upload")
{
    // print_r($_POST);

    
    $slider_image_name = array();
    $count_sliderfiles = count($_FILES['slider_image']['name']);
        // Uploading slider images
    for($i=0;$i<$count_sliderfiles;$i++)
    {
        $filename = $_FILES['slider_image']['name'][$i];
        array_push($slider_image_name,$filename);
        move_uploaded_file($_FILES['slider_image']['tmp_name'][$i],'uploads/Slider/'.$filename);
    }

    $slider_list =  implode(', ', $slider_image_name);

    move_uploaded_file($_FILES['prod_image']['tmp_name'],'uploads/Thumbnail/'.$_FILES['prod_image']['name']);
    $thumbnail_image = $_FILES['prod_image']['name'];

    $insert_event = $database->insert("events_image_table",[
        "event_id" => null,
        "event_name" => $_POST['event_name'],
        "year_id" => $_POST['year_id'],
        "thumb_image" => $thumbnail_image,
        "slider_image" => $slider_list,
        "event_active" => 1,
        "event_created_at" => NULL,
        "event_updated_at" => NULL



    ]);

    if($insert_event != 0)
    {
        echo "1";
    }
    else
    {
        echo "0";
    }

}

if($_POST['action'] == "update_event_upload")
{

    // print_r(count($_FILES['slider_image']));
    // die();
    
    $slider_image_name = array();
    if((count($_FILES['slider_image']['name']) > 0) && ($_FILES['slider_image']['name'][0] != ''))
    {
                    $count_sliderfiles = count($_FILES['slider_image']['name']);
                    // Uploading slider images
                if($count_sliderfiles > 0)
                {
                        for($i=0;$i<$count_sliderfiles;$i++)
                        {
                            $filename = $_FILES['slider_image']['name'][$i];
                            array_push($slider_image_name,$filename);
                            move_uploaded_file($_FILES['slider_image']['tmp_name'][$i],'uploads/Slider/'.$filename);
                        }

                        $slider_list =  implode(', ',$slider_image_name);
                            $update = $database->query("
                            UPDATE events_image_table SET slider_image = '" . $slider_list . "'
                             WHERE event_id = " . $_POST['event_id'] . " ")->fetchAll();
                      

                }

    }
    if(isset($_FILES['prod_image']['name']) && ($_FILES['prod_image']['name'] != ''))
    {
        move_uploaded_file($_FILES['prod_image']['tmp_name'],'uploads/Thumbnail/'.$_FILES['prod_image']['name']);
        $thumbnail_image = $_FILES['prod_image']['name'];

        $update = $database->query("
        UPDATE events_image_table SET thumb_image = '" . $thumbnail_image . "'
         WHERE event_id = " . $_POST['event_id'] . " ")->fetchAll();
    }
  
    $update_event = $database->query("UPDATE events_image_table set
        event_name = '" . $_POST['event_name'] . "',
        year_id = '" . $_POST['year_id'] ."',
        event_updated_at = NULL WHERE event_id = " . $_POST['event_id'] . " ")->fetchAll();

    if(empty($update_event))
    {
        echo "1";
    }
    else
    {
        echo "0";
    }

}


?>