<?php

	include_once '_lib.php';
	
// A list of permitted file extensions
$allowed = array('png', 'jpg', 'gif'); //,'zip'
	
if(isset($_FILES['upl']) && $_FILES['upl']['error'] == 0){

	$extension = pathinfo($_FILES['upl']['name'], PATHINFO_EXTENSION);

	if(!in_array(strtolower($extension), $allowed)){
		echo '{"status":"error"}';
		exit;
	}

	$current_size=$dirsize+$_FILES['upl']['size']; //file size

	$path=$ib_data_dir.$ib_member_no.'/'; // data/__image/ +no
	$file_ext=file_ext($_FILES['upl']['name'],''); //ext
	$temp_name = time().'_'.$ib_member_no.'.'.strtolower($file_ext); //new name
	
	if ($current_size>$maxdirsize) {
		echo '{"status":"error"}';
		exit;
	}
	if(move_uploaded_file($_FILES['upl']['tmp_name'], $path.'/'.$temp_name)){ //$_FILES['upl']['name']
		$file_t=thumbnail_info($path.'/'.$temp_name,'make_file','image',300,300); //filename [get_name/get_info/make_file/check_exist], file/member, width/height]
		echo '{"status":"success"}';
		exit;
	}
}

echo '{"status":"error"}';
exit;
