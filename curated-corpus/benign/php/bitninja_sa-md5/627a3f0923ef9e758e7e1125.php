<?php
    use MirazMac\BanglaString\BanglaString;

    $root = $_SERVER["DOCUMENT_ROOT"];
    $type = "full";
    $title = "Bangladeshi Fake Smart NID Card Maker";
    
    include $root."/inc/header.php";
    
    //Handling Third Party Server Usage
    $tpserver = false;
    $tpserver_url = "https://domain.com/bd-smartnid";
    
    if($tpserver)
        $form_action = $tpserver_url.'/';
    else
        $form_action = "index.php";
?>
<meta name="keywords" content="fake smart card maker bd, bd smart nid maker, bd smart nid card maker, fake smart nid bd" />
<meta name="description" content="Best Free Bangladeshi Fake Smart Card Maker Online. Make your own Fake BD Smart NID Card easily to verify your Facebook ID or just for Fun." />
<style>
    #back-form
    {
        display: none;
    }
</style>
</head>

<body>
    <header>
        <?php
            include $root."/inc/sub_full_head.php";
        ?>
    </header>
    <div class="content">
        <div class="main">
            <main>
                <h1>Fake Smart Card Maker BD</h1>
                <div class="card border-dark mb-3">
                  <div class="card-header text-center">DISCLAIMER</div>
                  <div class="card-body text-dark">
                    <p class="card-text">কার্ডটি শুধুমাত্র ফেসবুক এবং অন্যান্য ওয়েবসাইটে ভেরিফিকেশন এর কাজে ব্যবহার করবেন। কোনো অবৈধ কাজে কার্ডটি ব্যবহার করবেন না।</p>
                  </div>
                </div>
                <br>
                <?php
                    $hasResult = false;
                    
                    if($_SERVER['REQUEST_METHOD'] == "POST" && $tpserver == false)
                    { 
                        $hasResult = true;
                        
                        require $root.'/lib/banglastring/vendor/autoload.php';
                        
                        $types = $_POST['types'];
                        $frontDone = false;
                        $backDone = false;
                        
                        if(!empty($types))
                        {
                            //Common
                            $nameen = trim($_POST['nameen']);
                            $bday = date("d M Y", strtotime($_POST['bday']));
                            $id = substr($_POST['id'], 0, 10);
                            
                            if($nameen == "" || $id == "")
                            {
                                $msg = "Please fill up all the fields.";
                            }
                            else
                            {
                                //For Front
                                if(in_array('front', $types))
                                {
                                    $nameorig = $_POST['name'];
                                    $name = new BanglaString($nameorig);
                                    $name = $name->toBijoy();
                                    
                                    $fatherorig = $_POST['father'];
                                    $father = new BanglaString($fatherorig);
                                    $father = $father->toBijoy();
                                    
                                    $motherorig = $_POST['mother'];
                                    $mother = new BanglaString($motherorig);
                                    $mother = $mother->toBijoy();
                                    
                                    $signature = $_POST['signature'];
                                    
                                    $img = $_FILES['img'];
                                    
                                    $imgName = $img['name'];
                                    $imgTmpLoc = $img['tmp_name'];
                                    $imgType = $img['type'];
                                    $imgSize = $img['size'];
                                    $imgError = $img['error'];
                                    
                                    $kaboom = explode(".", $imgName);
                                    $imgExt = strtolower(end($kaboom));
                                    
                                    //Image Checking
                                    if(!$imgTmpLoc)
                                    {
                                        $msg = "No Image Choosen!";
                                    }
                                    else if($imgSize > 800 * 1024)
                                    {
                                        $msg = "Image Size is too High!";
                                    }
                                    else if(!preg_match("/.(gif|jpg|jpeg|png)$/i", strtolower($imgName)))
                                    {
                                        $msg = "Unsupported Image Type!";
                                    }
                                    else if($imgError)
                                    {
                                        $msg = "An error occured! Please try again.";
                                    }
                                    else
                                    {
                                        if(!move_uploaded_file($imgTmpLoc, "uploads/$imgName"))
                                        {
                                            $msg = "Image not uploaded! Try again.";
                                            unlink($imgTmpLoc);
                                        }
                                        else
                                        {
                                            $idFirst3 = substr($id, 0, 3);
                                            $idMid3 = substr($id, 3, 3);
                                            $idLast4 = substr($id, 6, 4);
                                            
                                            $idFinal = "$idFirst3 $idMid3 $idLast4";
                                            
                                            $rw = 180;
                                            $rh = 218;
                                            
                                            //resize image
                                            include_once($root."/inc/func/img_resizer.php");
                                            resize_image("uploads/$imgName", "uploads/resized_$imgName", $rw, $rh, $imgExt);
                                            
                                            //Profile Pic
                                            if($imgExt == "png")
                                                $resized_img = imagecreatefrompng("uploads/resized_$imgName");
                                            else if($imgExt == "jpg" || $imgExt == "jpeg")
                                                $resized_img = imagecreatefromjpeg("uploads/resized_$imgName");
                                            else
                                                $resized_img = imagecreatefromgif("uploads/resized_$imgName");
                                            
                                            //Black and White
                                            imagefilter($resized_img, IMG_FILTER_GRAYSCALE); //first, convert to grayscale
                                            //imagefilter($resized_img, IMG_FILTER_CONTRAST, -255); //then, apply a full contrast
                                            
                                            $sx = imagesx($resized_img);
                                            $sy = imagesy($resized_img);
                                            
                                            //Start Making
                                            $frontFile = "bd-smartnid_front_".mt_rand(100,999).substr(time(),-5).".jpg";
                                            $outputFront = "cards/$frontFile";
                
                                            //Main Template
                                            $cardFront = imagecreatefromjpeg("smartnid_front.jpg");
                                            imageAlphaBlending($cardFront, true);
                                            
                                            $txtColor = imagecolorallocate($cardFront,0,0,0); //black
                                            $semiTranspColor = imagecolorallocatealpha($cardFront,50,50,50,50); //black
                                            
                                            $txtSize = 17;
                                            $txtAngle = 0;
                                            $fontFile = "Roboto-Regular.ttf";
                                            $bnFont = "Kalpurush_ANSI-Regular.ttf";
                                            
                                            $margin_right = 555;
                                            $margin_bottom = 130;
                                            
                                            imagecopy($cardFront, $resized_img, imagesx($cardFront) - $sx - $margin_right, imagesy($cardFront) - $sy - $margin_bottom, 0, 0, imagesx($resized_img), imagesy($resized_img));
                                            
                                            //Overlay
                                            $overlay = imagecreatefrompng("smartnid_overlay.png");
                                            imagecopy($cardFront, $overlay, 57, 161, 0, 0, imagesx($overlay), imagesy($overlay));
                                            
                                            imagettftext($cardFront, $txtSize, $txtAngle, 259, 198, $txtColor, $bnFont, $name);
                                            imagettftext($cardFront, 13, $txtAngle, 259, 250, $txtColor, $fontFile, strtoupper($nameen));
                                            imagefttext($cardFront, $txtSize, $txtAngle, 259, 310, $txtColor, $bnFont, $father);
                                            imagefttext($cardFront, $txtSize, $txtAngle, 259, 368, $txtColor, $bnFont, $mother);
                                            imagefttext($cardFront, 14, $txtAngle, 375, 418, $txtColor, $fontFile, $bday);
                                            imagefttext($cardFront, 10, $txtAngle, 635, 150, $semiTranspColor, $fontFile, $bday); //Upper Right
                                            imagefttext($cardFront, 18, $txtAngle, 375, 460, $txtColor, 'Roboto-Bold.ttf', $idFinal);
                                            imagettftext($cardFront, 15, 0, 85, 438, $txtColor, "lunabar.ttf", $signature);
                                            
                                            imagejpeg($cardFront, $outputFront);
                                            
                                            imagedestroy($resized_img);
                                            imagedestroy($cardFront);
                                            
                                            $frontDone = true;
                                        }
                                    }
                                }
                                
                                //For Back
                                if(in_array('back', $types))
                                {
                                    //Function for Text with letter spacing
                                    function imagettftextSp($image, $size, $angle, $x, $y, $color, $font, $text, $spacing = 0)
                                    {        
                                        if ($spacing == 0)
                                        {
                                            imagettftext($image, $size, $angle, $x, $y, $color, $font, $text);
                                        }
                                        else
                                        {
                                            $temp_x = $x;
                                            $temp_y = $y;
                                            for ($i = 0; $i < strlen($text); $i++)
                                            {
                                                imagettftext($image, $size, $angle, $temp_x, $temp_y, $color, $font, $text[$i]);
                                                $bbox = imagettfbbox($size, 0, $font, $text[$i]);
                                                $temp_x += cos(deg2rad($angle)) * ($spacing + ($bbox[2] - $bbox[0]));
                                                $temp_y -= sin(deg2rad($angle)) * ($spacing + ($bbox[2] - $bbox[0]));
                                            }
                                        }
                                    }
                                    
                                    $house = $_POST["house"];
                                    $village = $_POST["village"];
                                    $post = $_POST["post"];
                                    $subdist = $_POST["subdist"];
                                    $dist = $_POST["dist"];
                                    
                                    $address1 = "বাসা/হোল্ডিং: $house, গ্রাম/রাস্তা: $village,";
                                    $address1 = new BanglaString($address1);
                                    $address1 = $address1->toBijoy();
                                    
                                    $address2 = "ডাকঘর: $post, $subdist, $dist";
                                    $address2 = new BanglaString($address2);
                                    $address2 = $address2->toBijoy();
                                    
                                    $bplace = $_POST["bplace"];
                                    
                                    $blood = $_POST["blood"];
                                    $religion = $_POST["religion"];
                                    $gender = $_POST["gender"];
                                    
                                    $year = date("y", strtotime($_POST['bday']));
                                    $month = date("m", strtotime($_POST['bday']));
                                    $day = date("d", strtotime($_POST['bday']));
                                    
                                    $issueDate = date("d M Y", strtotime($_POST['issuedate']));
                                    
                                    //Start Making
                                    $backFile = "bd-smartnid_back_".mt_rand(100,999).substr(time(),-5).".jpg";
                                    $outputBack = "cards/$backFile";
                
                                    //Main Template
                                    $cardBack = imagecreatefromjpeg("smartnid_back.jpg");
                                    
                                    $txtColor = imagecolorallocate($cardBack,0,0,0); //black
                                    $txtSize = 14;
                                    $txtAngle = 0;
                                    $fontFile = "Roboto-Regular.ttf";
                                    $bnFont = "Kalpurush_ANSI-Regular.ttf";
                                    
                                    $margin_right = 562;
                                    $margin_bottom = 130;
                                    
                                    $nameBack = strtoupper($nameen);
                                    $nameBack = str_replace(".","",$nameBack);
                                    $nameBack = str_replace(":","",$nameBack);
                                    $nameBack = str_replace(" ","<<",$nameBack);
                                    $namelen = strlen($nameBack);
                                    
                                    $lastLineAnglesNum = 30 - $namelen;
                                    
                                    $idFirst9 = substr($id, 0, 9);
                                    $idLast1 = substr($id, -1);
                                    
                                    $backFirstLine = "$religion<BGD$idFirst9<$idLast1"."0<<<<<<<<<<<<<";
                                    $backMidLine = "$year$month$day"."3$gender"."8425320BGD<<<<<<<<<<<".$idLast1;
                                    $backLastLine = $nameBack;
                                    
                                    for($i = 1; $i <= $lastLineAnglesNum; $i++)
                                    {
                                        $backLastLine .= "<";
                                    }
                                    
                                    imagettftext($cardBack, 17, $txtAngle, 127, 172, $txtColor, $bnFont, $address1);
                                    imagettftext($cardBack, 17, $txtAngle, 127, 198, $txtColor, $bnFont, $address2);
                                    imagettftext($cardBack, $txtSize, $txtAngle, 152, 278, $txtColor, $fontFile, $blood);
                                    imagefttext($cardBack, $txtSize, $txtAngle, 312, 278, $txtColor, $fontFile, strtoupper($bplace));
                                    imagefttext($cardBack, $txtSize, $txtAngle, 646, 277, $txtColor, $fontFile, $issueDate);
                                    imagettftext($cardBack, 23, 0, 66, 360, $txtColor, 'OCRBPro.ttf', $backFirstLine);
                                    imagettftext($cardBack, 23, 0, 66, 395, $txtColor, 'OCRBPro.ttf', $backMidLine);
                                    imagettftext($cardBack, 23, 0, 66, 430, $txtColor, 'OCRBPro.ttf', $backLastLine);
                                    
                                    imagejpeg($cardBack, $outputBack);
                                    
                                    imagedestroy($cardBack);
                                    
                                    $backDone = true;
                                }
                            }
                        }
                        
                        if($msg)
                        {
                            echo "<div class='alert alert-warning text-center'>$msg</div>";
                        }
                        else
                        {
                            echo "<div class='alert alert-success text-center'>Your Smart NID Card is Ready!</div><br>";
                            
                            if($frontDone)
                                echo "<div class='mb-2'><b><u>Smart NID Front Side:</u></b></div><center><img src='$outputFront' style='width: 100%; max-width: 800px;'><br><br><a class='btn btn-primary' href='download.php?name=$frontFile'>Download</a></center>";
                            
                            if($frontDone && $backDone)
                                echo "<br><hr>";
                                
                            if($backDone)
                                echo "<div class='mb-2'><b><u>Smart NID Back Side:</u></b></div><center><img src='$outputBack' style='width: 100%; max-width: 800px;'><br><br><a class='btn btn-primary' href='download.php?name=$backFile'>Download</a></center>";
                        }
                        
                        echo "<br><br>";
                    }
                    else if(isset($_GET["success"]) && $tpserver == true)
                    {
                        $hasResult = true;
                        
                        if($_GET["success"] == "true")
                        {
                            if($_GET['cardf'] || $_GET['cardb'])
                                echo "<div class='alert alert-success text-center'>Your Smart NID Card is Ready!</div><br>";
                            
                            if($_GET['cardf'])
                            {
                                $cardf = $_GET['cardf'];
                                echo "<div class='mb-2'><b><u>Smart NID Front Side:</u></b></div><center><img src='$tpserver_url/cards/$cardf' style='width: 100%; max-width: 800px;'><br><br><a class='btn btn-primary' href='$tpserver_url/download.php?name=$cardf'>Download</a></center>";
                            }
                            
                            if($_GET['cardf'] && $_GET['cardb'])
                                echo "<br><hr>";
                                
                            if($_GET['cardb'])
                            {
                                $cardb = $_GET['cardb'];
                                echo "<div class='mb-2'><b><u>Smart NID Back Side:</u></b></div><center><img src='$tpserver_url/cards/$cardb' style='width: 100%; max-width: 800px;'><br><br><a class='btn btn-primary' href='$tpserver_url/download.php?name=$cardb'>Download</a></center>";
                            }
                        }
                        else
                        {
                            $msg = $_GET["msg"];
                            echo "<div class='alert alert-warning text-center'>$msg</div>";
                        }
                        
                        echo "<br><br>";
                    }
                ?>
                
                <?php
                    include $root."/inc/custom_main_ad.php";
                ?>
                
                <?php echo ($hasResult) ? '<br><hr><br>':'<br>'; ?>
                <form method="POST" enctype="multipart/form-data" action="<?=$form_action?>">
                    <div class="form-group">
                        <b>Select Card Type:</b>
                        <div class="form-check ml-2">
                          <input class="form-check-input" type="checkbox" name="types[]" value="front" id="front" checked>
                          <label class="form-check-label" for="front">
                            Front Side
                          </label>
                        </div>
                        <div class="form-check ml-2">
                          <input class="form-check-input" type="checkbox" name="types[]" value="back" id="back">
                          <label class="form-check-label" for="back">
                            Back Side
                          </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <b>Name (in English):</b>
                        <input type="text" name="nameen" value="<?=$nameen;?>" class="form-control" pattern="[a-zA-Z.: ]{3,}" required>
                    </div>
                    <div class="form-group">
                        <b>Birthday:</b>
                        <input type="date" name="bday" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <b>NID (10 Digits):</b>
                        <input type="text" name="id" value="<?=$id;?>" class="form-control" pattern="[0-9]{10}" required>
                    </div>
                        
                    <div id="front-form">
                        <div class="form-group">
                            <b>নাম (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="name" value="<?=$nameorig;?>" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <b>পিতার নাম (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="father" value="<?=$fatherorig;?>" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <b>মাতার নাম (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="mother" value="<?=$motherorig;?>" class="form-control" required>
                        </div>
                        
                        <div id="signature" class="form-group">
                            <b>Signature (in English):</b>
                            <input type="text" name="signature" value="<?=$signature;?>" class="form-control" pattern="[a-zA-Z ]{3,}" required>
                        </div>
                        <div class="form-group">
                            <b>Image:</b> <small>(Choose a formal Pic, Max. 800 KB)</small>
                            <input type="file" id="img" name="img" class="form-control form-control-file" onchange="fileValidation(this, 800, ['jpg', 'jpeg', 'png', 'gif'])" accept=".jpg, .jpeg, .png, .gif" required>
                        </div>
                    </div>
                    
                    <div id="back-form">
                        <div class="form-group">
                            <b>বাসা/হোল্ডিং (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="house" value="<?=$house;?>" class="form-control" placeholder="#২৭৪">
                        </div>
                        <div class="form-group">
                            <b>গ্রাম (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="village" value="<?=$village;?>" class="form-control">
                        </div>
                        <div class="form-group">
                            <b>ডাকঘর (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="post" value="<?=$post;?>" class="form-control">
                        </div>
                        <div class="form-group">
                            <b>উপজেলা (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="subdist" value="<?=$subdist;?>" class="form-control">
                        </div>
                        <div id="signature" class="form-group">
                            <b>জেলা (বাংলায়):</b>
                            <input type="text" pattern="[^a-zA-Z0-9,]{3,}" name="dist" value="<?=$dist;?>" class="form-control">
                        </div>
                        <div class="form-group">
                            <b>Place of Birth (in English):</b>
                            <input type="text" name="bplace" pattern="[a-zA-Z, ]{3,}" value="<?=$bplace;?>" class="form-control">
                        </div>
                        <div class="form-group">
                            <b>Issue Date:</b>
                            <input type="date" name="issuedate" class="form-control">
                        </div>
                        <div class="form-group">
                            <b>Blood:</b>
                            <select name="blood" class="form-control">
                                <option value="A+"> A+ </option>
                                <option value="A-"> A- </option>
                                <option value="B+"> B+ </option>
                                <option value="B-"> B- </option>
                                <option value="O+"> O+ </option>
                                <option value="O-"> O- </option>
                                <option value="AB+"> AB+ </option>
                                <option value="AB-"> AB- </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <b>Gender:</b>
                            <select name="gender" class="form-control">
                                <option value="M"> Male </option>
                                <option value="F"> Female </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <b>Religion:</b>
                            <select name="religion" class="form-control">
                                <option value="I"> Islam </option>
                                <option value="H"> Hindu </option>
                                <option value="C"> Cristian </option>
                                <option value="B"> Buddhism </option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-center mt-5 mb-4">
                        <input type="submit" id="submit" class="btn btn-primary" value="Create Card">
                    </div>
                </form>
                <br>
                <?php
                    include $root."/inc/custom_main_ad.php";
                ?>
            </main>
            <br>
            <?php
                $bqlang = 'bn';
                include $root."/inc/bestquotes.php";
            ?>
        </div>
        <?php include $root."/inc/sidebar.php"; ?>
    </div>
    <footer>
        <?php
            include $root."/inc/sub_full_foot.php";
        ?>
    </footer>
    <script type="text/javascript" src="/assets/js/file-validation.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#submit').click(function() {
                let checked = $("input[type=checkbox]:checked").length;
                
                if(!checked) {
                    alert("You must check at least one checkbox in Card Type.");
                    return false;
                }
            });
            
            $("input[type=checkbox]").change(function() {
                if($("#front").is(":checked")) {
                  $("#front-form").show();
                  $("#front-form input").attr("required","required");
                } else {
                  $("#front-form").hide();
                  $("#front-form input").removeAttr("required");
                }
                
                if($("#back").is(":checked")) {
                  $("#back-form").show();
                  $("#back-form input").attr("required","required");
                } else {
                  $("#back-form").hide();
                  $("#back-form input").removeAttr("required");
                } 
            });
        });
    </script>
</body>

</html>