<?php
include "con1.php";

$email=$_GET['email'];

$title=$_POST['title'];
$model=$_POST['model'];
$pics=$_POST['pics'];
$spec=$_POST['spec'];
$descr=$_POST['descr'];
$price=$_POST['price'];
$cat=$_POST['cat'];
$regular=$_POST['regular'];
$user=$_POST['user'];
$country=$_POST['countryv'];
$state=$_POST['state'];
$phone=$_POST['phone'];
$catz=$_POST['catz'];



$joina=$country.$state;



$target_path = "./tredo/";







$target_path = $target_path . basename( $_FILES['uploadedfile0']['name']); 

if(move_uploaded_file($_FILES['uploadedfile0']['tmp_name'], $target_path)) {

    //echo "<font face='Segoe UI' size='4' color='orange'>The file ".  basename( $_FILES['uploadedfile0']['name']).   " has been uploaded</font>";

} else{

    echo "There was an error uploading the file, please try again!";

}


$xx="tredo/". basename( $_FILES['uploadedfile0']['name']);
//echo $xx;


$sql="INSERT INTO tredo(
id ,
userz,
tredo ,
descr,
pinned,
img,
loco,
phone,
catz)
VALUES (
NULL ,  '$user',  '$title', '$descr',  'yes','$xx','$joina','$phone','$catz')";

if ($con1->query($sql) === TRUE) {
  //echo "New record created successfully";
} else {
  //echo "Error: " . $sql . "<br>" . $con1->error;
}


echo "Your Post Has Been Pinned, and will appear after payment is made";

//echo "<img src=$xx width=100 height=100>";
//echo "$name.<br>.$price.<br>.$descr.<br>";

echo "Pay to Pin using <br><a href='https://paystack.com/pay/64uhk0n4xm'><img border='0' src='paystack.png' width='181' height='34'></a>";
?>



<?php

if(isset($_FILES['uploadedfile0']))
{
	$max_size = 800; //max image size in Pixels
	$destination_folder = './tredo/';
	$watermark_png_file = 'hoo.png'; //watermark png file
	
	$image_name = $_FILES['uploadedfile0']['name']; //file name
	$image_size = $_FILES['uploadedfile0']['size']; //file size
	$image_temp = $_FILES['uploadedfile0']['tmp_name']; //file temp
	$image_type = $_FILES['uploadedfile0']['type']; //file type

	switch(strtolower($image_type)){ //determine uploaded image type 
			//Create new image from file
			case 'image/png': 
				$image_resource =  imagecreatefrompng($image_temp);
				break;
			case 'image/gif':
				$image_resource =  imagecreatefromgif($image_temp);
				break;          
			case 'image/jpeg': case 'image/pjpeg':
				$image_resource = imagecreatefromjpeg($image_temp);
				break;
			default:
				$image_resource = false;
		}
	
	if($image_resource){
		//Copy and resize part of an image with resampling
		list($img_width, $img_height) = getimagesize($image_temp);
		
	    //Construct a proportional size of new image
		$image_scale        = min($max_size / $img_width, $max_size / $img_height); 
		$new_image_width    = ceil($image_scale * $img_width);
		$new_image_height   = ceil($image_scale * $img_height);
	
	
		$new_canvas         = imagecreatetruecolor($new_image_width , $new_image_height);

		if(imagecopyresampled($new_canvas, $image_resource , 0, 0, 0, 0, $new_image_width, $new_image_height, $img_width, $img_height))
		{
			
			if(!is_dir($destination_folder)){ 
				mkdir($destination_folder);//create dir if it doesn't exist
			}
			
			//center watermark
			$watermark_left = ($new_image_width/2)-(30); //watermark left
			$watermark_bottom = ($new_image_height/2)-(-200/2); //watermark bottom

			$watermark = imagecreatefrompng($watermark_png_file); //watermark image
			imagecopy($new_canvas, $watermark, $watermark_left, $watermark_bottom, 0, 0, 253, 87); //merge image
			
			//output image direcly on the browser.
			header('Content-Type: image/jpeg');
			imagejpeg($new_canvas, NULL , 90);
			
			//Or Save image to the folder
			imagejpeg($new_canvas, $destination_folder.'/'.$image_name , 90);
			
			//free up memory
			imagedestroy($new_canvas); 
			imagedestroy($image_resource);
			die();
		}
	}
}



?>




