<?php
//(C)2007-2014 RAZOR WEB DESIGN LIMITED
//ZULU SHOPPING SYSTEM v2.1.1
//BUILT ON PHP & MySQL

//SESSION
session_start();

//INCLUDES
include("../../../../includes/dbC.php");
include("../../../../includes/db.php");
include("../../../../includes/define.php");

//CODING

// files storage folder
$dir = dirname(__FILE__).'/../../../../../uploads/listing_assets/';
$_FILES['htmlarea_upload']['type'] = strtolower($_FILES['htmlarea_upload']['type']);
 
	// setting file's mysterious name
	$filename = $_FILES['htmlarea_upload']['name'];
	$file = $dir.$filename;
	 
	// copying
	move_uploaded_file($_FILES['htmlarea_upload']['tmp_name'], $file);
	 
	// displaying file
	$array = array('url' => MAIN_url.'uploads/listing_assets/'.$filename, 'name'=> $filename);
	
	// re-create json file
	foreach(glob(dirname(__FILE__)."/../../../../../uploads/listing_assets/") as $key=>$file) {
		$path_parts = pathinfo($file);
		$size = filesize($file);
		if($size < '1024') {
			$file_size = $size."B";
		} elseif($size < '1048576') {
			$file_size = number_format(($size/1024),2)."KB";
		} else {
			$file_size = number_format((($size/1024)/1024),2)."MB";
		}
		$json_array[] = ['title'=>$path_parts['basename'],'url'=>MAIN_url.'uploads/listing_assets/'.$path_parts['basename'],'id'=>$key,'size'=>$file_size];
	}
	if(count($json_array) > 0) {
		$fp = fopen(dirname(__FILE__).'/files.json', 'w');
		fwrite($fp, json_encode($json_array));
		fclose($fp);
	}
	 
	echo stripslashes(json_encode($array));
 
?>