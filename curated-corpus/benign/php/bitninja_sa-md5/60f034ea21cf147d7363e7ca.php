<?php
include('includes/tlca_world.php');
include_once("/class.phpmailer.php");
$check = $tlca_do->load('class_check');
$class_index = $tlca_do->load('class_index');
$action=addslashes($_REQUEST['action']);
$setting=mysqli_query($conn,"SELECT * FROM index_setting ORDER BY name ASC");
while ($r_s=mysqli_fetch_assoc($setting)) {
	$index_setting[$r_s['name']]=$r_s['value'];	
}
if($action=='mien-bac'){
	$giai=intval($_REQUEST['giai']);
	$lan=intval($_REQUEST['lan']);
	if($lan==1){
		if($giai==1){
			$so=$check->rand_xoso(0,99999);
			unset($_SESSION['list']);
		}else if($giai==2){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==3){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==4){
			$so=$check->rand_xoso(0,9999);
		}else if($giai==5){
			$so=$check->rand_xoso(0,9999);
		}else if($giai==6){
			$so=$check->rand_xoso(0,999);
		}else if($giai==7){
			$so=$check->rand_xoso(0,99);
		}else{
			$so=$check->rand_xoso(0,99999);
		}
		$lan_moi=2;
	}else{
		if($giai==1){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==2){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==3){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==4){
			$so=$check->rand_xoso_num(0,9999);
			$_SESSION['list'][]=$so;
		}else if($giai==5){
			$so=$check->rand_xoso_num(0,9999);
			$_SESSION['list'][]=$so;
		}else if($giai==6){
			$so=$check->rand_xoso_num(0,999);
			$_SESSION['list'][]=$so;
		}else if($giai==7){
			$so=$check->rand_xoso_num(0,99);
			$_SESSION['list'][]=$so;
		}else{
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}
		$lan_moi=1;
	}
	foreach ($_SESSION['list'] as $key => $value) {
		$x.=$value.'-';
	}
	$x=substr($x, 0,-1);
    $dau_0=$check->dau(0,$x,'-');
    $dau_1=$check->dau(1,$x,'-');
    $dau_2=$check->dau(2,$x,'-');
    $dau_3=$check->dau(3,$x,'-');
    $dau_4=$check->dau(4,$x,'-');
    $dau_5=$check->dau(5,$x,'-');
    $dau_6=$check->dau(6,$x,'-');
    $dau_7=$check->dau(7,$x,'-');
    $dau_8=$check->dau(8,$x,'-');
    $dau_9=$check->dau(9,$x,'-');
	$dit_0=$check->chuc_tructiep_mienbac(0,$x,'-');
	$dit_1=$check->chuc_tructiep_mienbac(1,$x,'-');
	$dit_2=$check->chuc_tructiep_mienbac(2,$x,'-');
	$dit_3=$check->chuc_tructiep_mienbac(3,$x,'-');
	$dit_4=$check->chuc_tructiep_mienbac(4,$x,'-');
	$dit_5=$check->chuc_tructiep_mienbac(5,$x,'-');
	$dit_6=$check->chuc_tructiep_mienbac(6,$x,'-');
	$dit_7=$check->chuc_tructiep_mienbac(7,$x,'-');
	$dit_8=$check->chuc_tructiep_mienbac(8,$x,'-');
	$dit_9=$check->chuc_tructiep_mienbac(9,$x,'-');
	$info=array(
		'so'=>$so,
		'lan'=>$lan_moi,
		'dau_0'=>$dau_0,
		'dau_1'=>$dau_1,
		'dau_2'=>$dau_2,
		'dau_3'=>$dau_3,
		'dau_4'=>$dau_4,
		'dau_5'=>$dau_5,
		'dau_6'=>$dau_6,
		'dau_7'=>$dau_7,
		'dau_8'=>$dau_8,
		'dau_9'=>$dau_9,
		'dit_0'=>$dit_0,
		'dit_1'=>$dit_1,
		'dit_2'=>$dit_2,
		'dit_3'=>$dit_3,
		'dit_4'=>$dit_4,
		'dit_5'=>$dit_5,
		'dit_6'=>$dit_6,
		'dit_7'=>$dit_7,
		'dit_8'=>$dit_8,
		'dit_9'=>$dit_9,
	);
	echo json_encode($info);
}else if($action=='tinh'){
	$giai=intval($_REQUEST['giai']);
	$lan=intval($_REQUEST['lan']);
	if($lan==1){
		if($giai==1){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==2){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==3){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==4){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==5){
			$so=$check->rand_xoso(0,9999);
		}else if($giai==6){
			$so=$check->rand_xoso(0,9999);
		}else if($giai==7){
			$so=$check->rand_xoso(0,999);
		}else if($giai==8){
			$so=$check->rand_xoso(0,99);
			unset($_SESSION['list']);
		}else{
			$so=$check->rand_xoso(0,999999);
		}
		$lan_moi=2;
	}else{
		if($giai==1){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==2){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==3){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==4){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][]=$so;
		}else if($giai==5){
			$so=$check->rand_xoso_num(0,9999);
			$_SESSION['list'][]=$so;
		}else if($giai==6){
			$so=$check->rand_xoso_num(0,9999);
			$_SESSION['list'][]=$so;
		}else if($giai==7){
			$so=$check->rand_xoso_num(0,999);
			$_SESSION['list'][]=$so;
		}else if($giai==8){
			$so=$check->rand_xoso_num(0,99);
			$_SESSION['list'][]=$so;
		}else{
			$so=$check->rand_xoso_num(0,999999);
			$_SESSION['list'][]=$so;
		}
		$lan_moi=1;
	}
	foreach ($_SESSION['list'] as $key => $value) {
		$x.=$value.'-';
	}
	$x=substr($x, 0,-1);
    $dau_0=$check->dau(0,$x,'-');
    $dau_1=$check->dau(1,$x,'-');
    $dau_2=$check->dau(2,$x,'-');
    $dau_3=$check->dau(3,$x,'-');
    $dau_4=$check->dau(4,$x,'-');
    $dau_5=$check->dau(5,$x,'-');
    $dau_6=$check->dau(6,$x,'-');
    $dau_7=$check->dau(7,$x,'-');
    $dau_8=$check->dau(8,$x,'-');
    $dau_9=$check->dau(9,$x,'-');
	$dit_0=$check->chuc_tructiep_mienbac(0,$x,'-');
	$dit_1=$check->chuc_tructiep_mienbac(1,$x,'-');
	$dit_2=$check->chuc_tructiep_mienbac(2,$x,'-');
	$dit_3=$check->chuc_tructiep_mienbac(3,$x,'-');
	$dit_4=$check->chuc_tructiep_mienbac(4,$x,'-');
	$dit_5=$check->chuc_tructiep_mienbac(5,$x,'-');
	$dit_6=$check->chuc_tructiep_mienbac(6,$x,'-');
	$dit_7=$check->chuc_tructiep_mienbac(7,$x,'-');
	$dit_8=$check->chuc_tructiep_mienbac(8,$x,'-');
	$dit_9=$check->chuc_tructiep_mienbac(9,$x,'-');
	$info=array(
		'so'=>$so,
		'lan'=>$lan_moi,
		'dau_0'=>$dau_0,
		'dau_1'=>$dau_1,
		'dau_2'=>$dau_2,
		'dau_3'=>$dau_3,
		'dau_4'=>$dau_4,
		'dau_5'=>$dau_5,
		'dau_6'=>$dau_6,
		'dau_7'=>$dau_7,
		'dau_8'=>$dau_8,
		'dau_9'=>$dau_9,
		'dit_0'=>$dit_0,
		'dit_1'=>$dit_1,
		'dit_2'=>$dit_2,
		'dit_3'=>$dit_3,
		'dit_4'=>$dit_4,
		'dit_5'=>$dit_5,
		'dit_6'=>$dit_6,
		'dit_7'=>$dit_7,
		'dit_8'=>$dit_8,
		'dit_9'=>$dit_9,
	);
	echo json_encode($info);
}else if($action=='mien'){
	$giai=intval($_REQUEST['giai']);
	$lan=intval($_REQUEST['lan']);
	$cot=intval($_REQUEST['cot']);
	if($lan==1){
		if($giai==1){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==2){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==3){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==4){
			$so=$check->rand_xoso(0,99999);
		}else if($giai==5){
			$so=$check->rand_xoso(0,9999);
		}else if($giai==6){
			$so=$check->rand_xoso(0,9999);
		}else if($giai==7){
			$so=$check->rand_xoso(0,999);
		}else if($giai==8){
			$so=$check->rand_xoso(0,99);
			if($cot==0){
				unset($_SESSION['list']);
			}
		}else{
			$so=$check->rand_xoso(0,999999);
		}
		$lan_moi=2;
	}else{
		if($giai==1){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==2){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==3){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==4){
			$so=$check->rand_xoso_num(0,99999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==5){
			$so=$check->rand_xoso_num(0,9999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==6){
			$so=$check->rand_xoso_num(0,9999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==7){
			$so=$check->rand_xoso_num(0,999);
			$_SESSION['list'][$cot][]=$so;
		}else if($giai==8){
			$so=$check->rand_xoso_num(0,99);
			$_SESSION['list'][$cot][]=$so;
		}else{
			$so=$check->rand_xoso_num(0,999999);
			$_SESSION['list'][$cot][]=$so;
		}
		$lan_moi=1;
	}
	foreach ($_SESSION['list'][$cot] as $key => $value) {
		$x.=$value.'-';
	}
	$x=substr($x, 0,-1);
    $dau_0=$check->dau(0,$x,'-');
    $dau_1=$check->dau(1,$x,'-');
    $dau_2=$check->dau(2,$x,'-');
    $dau_3=$check->dau(3,$x,'-');
    $dau_4=$check->dau(4,$x,'-');
    $dau_5=$check->dau(5,$x,'-');
    $dau_6=$check->dau(6,$x,'-');
    $dau_7=$check->dau(7,$x,'-');
    $dau_8=$check->dau(8,$x,'-');
    $dau_9=$check->dau(9,$x,'-');
	$dit_0=$check->chuc_tructiep(0,$x,'-');
	$dit_1=$check->chuc_tructiep(1,$x,'-');
	$dit_2=$check->chuc_tructiep(2,$x,'-');
	$dit_3=$check->chuc_tructiep(3,$x,'-');
	$dit_4=$check->chuc_tructiep(4,$x,'-');
	$dit_5=$check->chuc_tructiep(5,$x,'-');
	$dit_6=$check->chuc_tructiep(6,$x,'-');
	$dit_7=$check->chuc_tructiep(7,$x,'-');
	$dit_8=$check->chuc_tructiep(8,$x,'-');
	$dit_9=$check->chuc_tructiep(9,$x,'-');
	$info=array(
		'so'=>$so,
		'lan'=>$lan_moi,
		'dau_0'=>$dau_0,
		'dau_1'=>$dau_1,
		'dau_2'=>$dau_2,
		'dau_3'=>$dau_3,
		'dau_4'=>$dau_4,
		'dau_5'=>$dau_5,
		'dau_6'=>$dau_6,
		'dau_7'=>$dau_7,
		'dau_8'=>$dau_8,
		'dau_9'=>$dau_9,
		'dit_0'=>$dit_0,
		'dit_1'=>$dit_1,
		'dit_2'=>$dit_2,
		'dit_3'=>$dit_3,
		'dit_4'=>$dit_4,
		'dit_5'=>$dit_5,
		'dit_6'=>$dit_6,
		'dit_7'=>$dit_7,
		'dit_8'=>$dit_8,
		'dit_9'=>$dit_9,
	);
	echo json_encode($info);
}
?>