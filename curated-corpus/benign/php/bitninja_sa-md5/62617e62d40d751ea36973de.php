<?php if((!$indexing) || ($logged != 1)) { exit; }

if($funct['galle1'] != 1 && $funct['galle2'] != 1) { fim($LANG[40003], 'ERROR', './'); }

?>

<ul class="breadcrumb">
	<li><a href="./?module=gallery&page=view"><i class='fa fa-image'></i> <?php echo $LANG[40010]; ?></a></li>
</ul>

<h1><?php echo $LANG[40010]; ?></h1>

<div class='pddInner'>
	
	<link rel="stylesheet" type="text/css" href="css/prettyPhoto.css" media="all" />
	
	<?php
	
	$cacheFile = "cache/gallery.xml";
	$genNew = 0;
	
	if(!file_exists($cacheFile)) {
		$genNew = 1;
	} else {
		
		$xml = simplexml_load_file($cacheFile);
		$configs = $xml->configs;
		$updated = intval($configs->updated);
		$delay = 1;
		
		if(($updated+($delay*60)) < time()) {
			$genNew = 1;
		}
		
	}
	
	if($genNew) {
		
		if(!file_exists("cache")) { @mkdir("cache", 0775, true); @chmod("cache", 0775); }
		if(!file_exists("cache/index.html")) { $secIndexFile = fopen("cache/index.html","w+"); @fclose($secIndexFile); }
		if(!file_exists("cache/.htaccess")) { $secHtacsFile = fopen("cache/.htaccess","w+"); @fwrite($secHtacsFile, "Options -Indexes"); @fclose($secHtacsFile); }
		
		$wFile = fopen($cacheFile,"w+");
		
		$updated = time();
		$line = "\n<configs>\n<atualstudio>Cache script by Atualstudio.com</atualstudio>\n<updated>".$updated."</updated>\n</configs>";
		
		require_once('private/classes/classGallery.php');
		
		$gallery = Gallery::listAll();
		if(count($gallery) > 0) {
			
			for($i=0, $c=count($gallery); $i < $c; $i++) {
				
				$line .= "\n<line>\n";
				$line .= "<url>".$gallery[$i]['url']."</url>\n";
				$line .= "<isvideo>".$gallery[$i]['isvideo']."</isvideo>\n";
				$line .= "</line>";
				
			}
			
		} else {
			$deleteCache = 1;
		}
		
		@fwrite($wFile, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<gallery>".$line."\n</gallery>");
		@fclose($wFile);
		
		$xml = simplexml_load_file($cacheFile);
		
		if(isset($deleteCache) && file_exists($cacheFile)) {
			unlink($cacheFile);
		}
		
	}
	
	$line = $xml->line;
	
	?>
	
	<div class='fullGallery'>
		<div>
			
		<?php
		
		$pagin['max_results'] = 35;
		$pagin['link'] = "./?module=gallery&page=view";
		$pagin['atual'] = (!empty($_GET['pg']) && is_numeric($_GET['pg']) ? intval($_GET['pg']) : 1); $pagin['begin'] = ($pagin['atual']-1) * $pagin['max_results'];
		
		$pagin['total_results'] = 0;
		
		if(count($line) > 0) {
			
			$pagin['total_results'] = count($line);
			
			for($i=$pagin['begin'], $c=intval($pagin['begin']+$pagin['max_results']); $i < $c; $i++) {
				
				if(empty($line[$i]->url)) { continue; }
				
				if(intval($line[$i]->isvideo) != '1') {
					echo "
					<a href='".$dir_gallery.$line[$i]->url."' rel='prettyPhoto[fullGallery]'>
						<img src='".$dir_gallery."thumbnail/".$line[$i]->url."' />
						<div></div>
					</a>
					";
				} else {
					echo "
					<a href='//www.youtube.com/watch?v=".$line[$i]->url."&rel=0' class='iframe' rel='prettyPhoto[fullGallery]'>
						<img src='".$dir_gallery."thumbnail/".$line[$i]->url.".jpg' />
						<div></div>
						<span></span>
					</a>
					";
				}
				
			}
			
		} else {
			echo "<b>".$LANG[40036]."</b>";
		}
		
		?>
			
		</div>
	</div>
	
	<br /><br />
	
	<?php include("private/includes/paginate.php"); ?>
	
</div>

<br /><br />

<!-- PrettyPhoto -->
<script type="text/javascript" src="js/jquery.prettyPhoto.js"></script><script type="text/javascript" charset="utf-8">$(document).ready(function(){ $("a[rel^='prettyPhoto']").prettyPhoto({ theme: 'atualstudio', social_tools: '', markup: '<div class="pp_pic_holder"><div class="ppt">&nbsp;</div><div class="pp_top"><div class="pp_left"></div><div class="pp_middle"></div><div class="pp_right"></div></div><div class="pp_content_container"><div class="pp_left"><div class="pp_right"><div class="pp_content"><div class="pp_loaderIcon"></div><div class="pp_fade"><a href="#" class="pp_expand" title="Expand the image">Expand</a><div class="pp_hoverContainer"><a class="pp_next" href="#">next</a><a class="pp_previous" href="#">previous</a></div><div id="pp_full_res"></div><div class="pp_details"></div></div></div></div></div></div><div class="pp_bottom"><div class="pp_left"></div><div class="pp_middle"></div><div class="pp_right"></div></div></div><div class="pp_overlay"></div>' }); });</script>
