<?php

$cat=array(2,7,4,29,8,6,85,81,54,13,84,86,5,87,3,14,10);

$inc_array = fopen("array.php","w");
fputs($inc_array,'<?');

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

function trim_dir($dir){
    $dir = str_replace(" ", "_", $dir);
    $dir = str_replace(".", "_", $dir);
    $dir = str_replace("&", "_", $dir);
    $dir = str_replace(";", "_", $dir);
    return $dir;
}

function max_pageno($index){
  $page=1;
  while ($i = strpos($index,"pageno=",$i+5)){
    $pg = substr($index, $i+7, strpos($index, '"', $i+7)-$i-7);
    if ($pg+1>$page) $page = $pg+1;
  }
  return $page;    
}

function open_read($dir, $get=false){
  if ($get)
    return file_get_contents($dir."?".$get);
  return file_get_contents($dir);
}

function get_url($ID){
  $index = open_read("http://www.hatterkepek.hu/download.php","img=".$ID);
  
  $i = strpos($index, '<a href="getfile.php?path=images1152');
  if (!$i) $i = strpos($index, '<a href="getfile.php?path=images1024');
  else if (!$i) $i = strpos($index, '<a href="getfile.php?path=images800');
  
  $url = substr($index, $i+9, strpos($index, '"', $i+10)-$i-9);
  return "http://www.hatterkepek.hu/".$url;
}



//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////



foreach ($cat as $c){
  $subcatID  = array();
  $subcatnev = array();
  $subcatold = array();
  
  $index = open_read("http://www.hatterkepek.hu/index.php","cat=".$c);
  //$index = open_read("ize2.htm");
  $start = strpos($index, "<title>")+21;
  $catnev = trim_dir(substr($index, $start ,strpos($index, "</title>", $start)-$start));
  $catold = max_pageno($index);
  
  for ($o=0; $o<$catold; $o++){
    $index = open_read("http://www.hatterkepek.hu/index.php","cat=".$c."&pageno=".$o);
    $i = strpos($index, '<td><a href="index.php?subcat=');  
    while ($i){
      $sid   = substr($index, $i+30, strpos($index,'"', $i+30)-$i-30);
      $katk  = strpos($index,">",$i+30);
      $sname = substr($index, $katk+1, strpos($index, "<", $katk+1)-$katk-1);
      $i     = strpos($index, '<td><a href="index.php?subcat=', $i+30);
      
      $subindex = open_read("http://www.hatterkepek.hu/index.php","subcat=".$sid);
      $subcatID[]  = $sid;
      $subcatnev[] = trim_dir($sname);
      $subcatold[] = max_pageno($subindex);
      
    }
  }


  foreach ($subcatID as $sk=>$sid)
    for ($page = 0; $page<$subcatold[$sk]; $page++){
      $index = open_read("http://www.hatterkepek.hu/index.php","subcat=".$sid."&pageno=".$page);
      $i = strpos($index, '<a href="download.php?img=');
      while ($i){
        $ID = substr($index,$i+26,strpos($index,'"',$i+26)-$i-26);
        $url = get_url($ID);
        fputs($inc_array, '$dws[]=array('.$c.', "'.$catnev.'", '.$sid.', "'.$subcatnev[$sk].'", "'.$url.'");'."\n");
        $i = strpos($index, '<a href="download.php?img=', $i+30);    
      }            
    }
    
}

fputs($inc_array,'?>');
fclose($inc_array);
?>