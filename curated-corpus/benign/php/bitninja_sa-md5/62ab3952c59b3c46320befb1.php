<?php

require_once('connect.php');
require 'website.php';



$target_dir = "pictures/";
$target_file = $target_dir . basename($_FILES["fileToUpload"]["name"]);
$uploadOk = 1;
$imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));

  
  $check = getimagesize($_FILES["fileToUpload"]["tmp_name"]);
  if($check !== false) {
    //echo "File is an image - " . $check["mime"] . ".";
    $uploadOk = 1;
  } else {
    //echo "File is not an image.";
    $uploadOk = 0;
  }



if (file_exists($target_file)) {
  //echo "Sorry, file already exists.";
  $uploadOk = 0;
}

if ($_FILES["fileToUpload"]["size"] > 500000) {
  //echo "Sorry, your file is too large.";
  $uploadOk = 0;
}


if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg"
&& $imageFileType != "gif" ) {
  //echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
  $uploadOk = 0;
}


if ($uploadOk == 0) {
  //echo "Sorry, your file was not uploaded.";

} else {
  if (move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {
    //echo "The file ". htmlspecialchars( basename( $_FILES["fileToUpload"]["name"])). " has been uploaded.";
  } else {
    //echo "Sorry, there was an error uploading your file.";
  }
}


 $picture=$website."/".$target_file;










$target_dir2 = "resume/";
$target_file2 = $target_dir2 . basename($_FILES["resume"]["name"]);
$uploadOk2 = 1;
$imageFileType2 = strtolower(pathinfo($target_file2,PATHINFO_EXTENSION));



if(isset($_POST["submit"])) {
  $check2 = getimagesize($_FILES["resume"]["tmp_name"]);
  if($check2 !== false) {
    //echo "File is an image - " . $check2["mime"] . ".";
    $uploadOk2 = 1;
  } else {
    //echo "File is not an image.";
    $uploadOk2 = 0;
  }
}


if (file_exists($target_file2)) {
 // echo "Sorry, file already exists.";
  $uploadOk2 = 0;
}

if ($_FILES["resume"]["size"] > 500000) {
  //echo "Sorry, your file is too large.";
  $uploadOk2 = 0;
}


if($imageFileType2 != "pdf" && $imageFileType2 != "doc" && $imageFileType2 != "docx"
&& $imageFileType2 != "pptx" ) {
  //echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
  $uploadOk2 = 0;
}


if ($uploadOk2 == 0) {
  //echo "Sorry, your file was not uploaded.";

} else {
  if (move_uploaded_file($_FILES["resume"]["tmp_name"], $target_file2)) {
    //echo "The file ". htmlspecialchars( basename( $_FILES["resume"]["name"])). " has been uploaded.";
  } else {
    //echo "Sorry, there was an error uploading your file.";
  }
}


  $resume=$website."/".$target_file2;
 


  $id=$_POST['id'];
  $fullname=$_POST['fullname'];
  $sex=$_POST['sex'];
  $codemelli=$_POST['codemelli'];
  $fathername=$_POST['fathername'];
  $phone=$_POST['phone'];
  $job=$_POST['job'];
  $birthdate=$_POST['birthdate'];
  
  $madrak=$_POST['madrak'];
  $hozeh=$_POST['hozeh'];
  $reshteh=$_POST['reshteh'];
  $university=$_POST['university'];
  $eftekharat=$_POST['eftekharat'];
  $ekhteraat=$_POST['ekhteraat'];
  $faaliat=$_POST['faaliat'];



if($picture=="https://jehatnama.ir/sanat/pictures/" && $resume=="https://jehatnama.ir/sanat/resume/"){
  //without change
  

  
      $sql = "UPDATE motokhasesin SET fullname='$fullname', sex='$sex' , codemelli='$codemelli' , fathername='$fathername' , phone='$phone' , job='$job' , birthdate='$birthdate'  , madrak='$madrak' , hozeh='$hozeh' , reshteh='$reshteh' , university='$university' , eftekharat='$eftekharat' , ekhteraat='$ekhteraat' , faaliat='$faaliat'   WHERE id='$id'";

      if ($conn->query($sql) === TRUE) {
        
        echo '<script>window.location.replace("motokhasesin.php?updated=ok");</script>';
        
      } else {
        echo "Error: " . $sql . "<br>" . $conn->error;
      }


}

else if($picture=="https://jehatnama.ir/sanat/pictures/" ){
  //just resume changed

  $sql = "UPDATE motokhasesin SET fullname='$fullname', sex='$sex', codemelli='$codemelli' , fathername='$fathername' , phone='$phone' , job='$job' , birthdate='$birthdate'  , madrak='$madrak' , hozeh='$hozeh' , reshteh='$reshteh' , university='$university' , eftekharat='$eftekharat' , ekhteraat='$ekhteraat' , faaliat='$faaliat' ,resume='$resume'   WHERE id='$id'";

  if ($conn->query($sql) === TRUE) {
    
    echo '<script>window.location.replace("motokhasesin.php?updated=ok");</script>';
    
  } else {
    echo "Error: " . $sql . "<br>" . $conn->error;
  }
  
}

else if($resume=="https://jehatnama.ir/sanat/resume/"){
  //just picture changed
  $sql = "UPDATE motokhasesin SET fullname='$fullname', sex='$sex', codemelli='$codemelli' , fathername='$fathername' , phone='$phone' , job='$job' , birthdate='$birthdate' ,picture='$picture'  , madrak='$madrak' , hozeh='$hozeh' , reshteh='$reshteh' , university='$university' , eftekharat='$eftekharat' , ekhteraat='$ekhteraat' , faaliat='$faaliat'   WHERE id='$id'";

  if ($conn->query($sql) === TRUE) {
    
    echo '<script>window.location.replace("motokhasesin.php?updated=ok");</script>';
    
  } else {
    echo "Error: " . $sql . "<br>" . $conn->error;
  }

}

else{
  //all changed

  $sql = "UPDATE motokhasesin SET fullname='$fullname', sex='$sex', codemelli='$codemelli' , fathername='$fathername' , phone='$phone' , job='$job' , birthdate='$birthdate' ,picture='$picture'  , madrak='$madrak' , hozeh='$hozeh' , reshteh='$reshteh' , university='$university' , eftekharat='$eftekharat' , ekhteraat='$ekhteraat' , faaliat='$faaliat' ,resume='$resume'   WHERE id='$id'";

  if ($conn->query($sql) === TRUE) {
    
    echo '<script>window.location.replace("motokhasesin.php?updated=ok");</script>';
    
  } else {
    echo "Error: " . $sql . "<br>" . $conn->error;
  }

}








$conn->close();