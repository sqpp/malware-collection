<?php

//
//	TORA'S SHOPPING SYSTEM (TSS) - BACKOFFICE
//
//	VERSION:	4.1
//	FILE:		./backoffice/catalogue_exim_import.php
//	LAST UPDATE:	2005/10/24
//
//	COPYRIGHT:	(c) 2001 - 2005, CZ-ONLINE WEBDESIGN & TORA'S SYSTEMS
//	E-MAIL:		toras@cz-online.com
//	URL:		www.toras-systems.com
//



//	LOADING OF BASIC SETTINGS

    require_once( "./include/application.php" );
	backofficeForEntered();
	checkRights( "admin_priv_catalogue_export_import" );

	$_showMenu	= "catalogue";
	$_showSubMenu	= "catalogue_exim";


//	LOADING OF DATA

	if ( $_REQUEST["action"] == "processFile" ):

		$_includeFile	= "catalogue_exim_import_proccess.php";

	elseif ( $_REQUEST["action"] == "uploadFile" ):

		if (! empty( $_FILES["import_file"]["name"] ) ):
			$_importFile		= "import_" .  time() . ".csv";
            if (isset($_FILES["import_file"]["tmp_name"])){
                if (move_uploaded_file( $_FILES["import_file"]["tmp_name"], sPath . "/media/import/" . $_importFile )){
                    require_once('Czol/CsvImport.php');
                    $importer = new Czol_CsvImport(sPath . "/media/import/" . $_importFile );
                    $importer->import();
                }
            } 
        endif;

		redirect( "catalogue_import.php?action=processFile&fileName=" . $_importFile );

	else:

		$_includeFile	= "catalogue_exim_import.php";

	endif;



//	LOADING OF TEMPLATES

	include_once( "./include/templates/_TMP_TOP.php" );
	include_once( "include/templates/" . $_includeFile );
	include_once( "./include/templates/_TMP_DOWN.php" );



?>
