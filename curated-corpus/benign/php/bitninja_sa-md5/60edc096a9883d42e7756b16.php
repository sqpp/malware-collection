<?php
ob_start();
require("admin_utils.php");
include(FCKPATH."fckeditor.php");


if($_SESSION['member_type']=='')					header('location:index.php');


if(isset($_POST['mode']))
{
if($_POST['mode']=='insert_about') 			insert_about();
if($_POST['mode']=='delete_about')			delete_about();
if($_POST['mode']=='change_status_about')	change_status_about();
if($_POST['mode']=='delete_chk_about')		delete_chk_about();
if($_POST['mode']=='edit_about')				edit_about();
if($_POST['mode']=='edit')						disphtml("edit();");
if($_POST['mode']=='')						disphtml("main();");
}
else												disphtml("main();");


ob_end_flush();
?>
<form name="frm_opts" action="<?php  echo $_SERVER['PHP_SELF']?>" method="post" >
<input type="hidden" name="mode" value="">


<input type="hidden" name="pageNo" value="<?php if(isset($_REQUEST['pageNo'])) { echo  $_REQUEST['pageNo']; }?>">


<input type="hidden" name="url" value="<?php  echo $_SERVER['PHP_SELF']?>">
<input type="hidden" name="id" value="">
<input type="hidden" name="hold_page" value="">
<input type="hidden" name="menu_cat" id="menu_cat" />
<input type="hidden" name="menu_subcat" id="menu_subcat"/>
</form>
<script language="JavaScript">
	
	function isValid()
		{

		if(document.getElementById("Specialization _name").value=="")
		{
		alert("Please enter Specialization same");
		document.getElementById("Specialization _name").focus();
		return false;
		}
		

        
          }

</script>	
  
  

<?php 

function main(){



global $link;

 $sql_list_about = "SELECT * FROM ".DB_WE_OFFER." where  status!='I' ORDER BY id desc limit ".$GLOBALS['start'].",".$GLOBALS['show']." ";
$qry_list_about = mysqli_query($link,$sql_list_about);
$num_list_about = mysqli_num_rows($qry_list_about);


$countShow="SELECT count(*) FROM ".DB_WE_OFFER." where  status!='I' ORDER BY id desc";
$countQry=mysqli_query($link,$countShow);
$rowCount=mysqli_fetch_array($countQry);
$count=$rowCount[0];


if($num_list_about==0)
 	{
	$_SESSION['ERR']='No we-offers found in the data base.';
	$_SESSION['CLASS'] = "notification png_bg";
	$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png";	
	}

?>
       <!--header-->
		
		<!--left-->
		 <!-- End #sidebar -->
		
        <!--top-->
		
	
			<div class="content-box"><!-- Start Content Box -->
				
				<div class="content-box-header">
					
					<h3>Manage We-offer</h3>
					
					<ul class="content-box-tabs">
					  <li><a href="#tab1" class="default-tab" id="table1">We-offer List</a></li> 
				    <!-- href must be unique and match the id of target div -->
						<li><a href="#tab2" id="form1">Add New</a></li>
				  </ul>
					
				  <div class="clear"></div>
					
		    </div> <!-- End .content-box-header -->
				
				<div class="content-box-content">
			   
					<div class="tab-content default-tab" id="tab1"> <!-- This is the target div. id must match the href of this div's tab -->
					<?php  if(isset($_SESSION['ERR']))
						{
						?>
						<div class="<?php  echo $_SESSION['CLASS']?>">
							<a href="#" class="close"><img src="<?php  echo $_SESSION['IMG_PATH']?>" Model="Close this notification" alt="close" /></a>
							<div>
								<?php  echo  $_SESSION['ERR']; 
								
								unset($_SESSION['ERR']); 
								unset($_SESSION['CLASS']); 
								unset($_SESSION['IMG_PATH']); 
								?>
							</div>
				    </div>
						<?php  } ?>
						
						
						<?php  if($num_list_about > 0)
							{
							
							?>
						<form name="frm_chk_about" action="<?php echo $_SERVER['PHP_SELF']?>" method="post">
						<input type="hidden" name="mode" value="delete_chk_about" />
						<table>
							
							<thead>
                            
								<tr>
								   <th width="15" ><input class="check-all" type="checkbox" name='publication_chkbox[]' id='publication_chkbox' /></th>
                                   
								   <th width="35">Sl no.</th>
                                   
                                   <th width="94">Image</th>
                                   
                                   <th width="94">Title</th>
                                   
                                   <th width="94">Description</th>
                                   
                                  <th width="40">Action</th>
                                  
								</tr>
                                
							</thead>
						 
							<tfoot>
								<tr>
									<td colspan="6">
										<div class="bulk-actions align-left">
											<select name="choose_action">
												<option value="0">Choose an action...</option>
												<option value="d">Delete</option>
											</select>
											<a class="button" onclick="return delete_chk_about();">Apply to selected</a>										</div>
										
										<!-- Start .pagination -->
										<?php   
										if($count>0 && $count > $GLOBALS['show'])	
										{
									?>
										<div class="pagination">
										<?php pagination($count,"frm_opts");?>
										</div> <!-- End .pagination -->
										<?php  } ?>
										 <!-- End .pagination -->
										<div class="clear"></div></td>
								</tr>
							</tfoot>
						 
							<tbody>
							<?php  
							$cnt=$GLOBALS['start']+1;
							while($row_list_about=mysqli_fetch_array($qry_list_about))
								{
								?>
								
								<tr>
									<td style="vertical-align:middle;"><input type="checkbox" name='publication_chkbox[]' id='publication_chkbox' value="<?php  echo $row_list_about['id'];?>"/></td>
									<td style="vertical-align:middle;"><?php echo $cnt++?></td>
                                    
                                    <td style="vertical-align:middle;"><img src="../uploads/we-offer/<?php echo $row_list_about['image_name']?>" alt="" width="100px" /></td>
                                    
                                    <td style="vertical-align:middle;"><?php echo $row_list_about['main_title']; ?></td>
                                    
                                    <td style="vertical-align:middle;"><?php echo WordLimiter(stripslashes(ucfirst(strtolower($row_list_about['description']))),10)?></td>
									<td style="vertical-align:middle;">
                                    
										<!-- Icons -->
										 <a href="javascript:Edit('<?php  echo $row_list_about['id']?>','<?php  echo $GLOBALS['start']?>');" make="Edit"><img src="resources/images/icons/pencil.png" alt="Edit" /></a>
										<a href="javascript:Delete('<?php  echo $row_list_about['id']?>','<?php  echo $GLOBALS['start']?>');" make="Delete"><img src="resources/images/icons/cross.png" alt="Delete" /></a>										 </td>
								</tr>
								<?php  } ?>
							</tbody>
						</table>
			      </form>
						<?php  } ?>
						
					</div> <!-- End #tab1 -->

<script language="javascript">
function Delete(ID,record_no)
{

	
	var UserResp = window.confirm("Are you sure to delete this Specialization? ");
	if( UserResp == true )
	{
		document.frm_opts.mode.value='delete_about';
		document.frm_opts.id.value=ID;
		document.frm_opts.hold_page.value = record_no*1;
		document.frm_opts.submit();
	}
	
}


function Edit(ID,record_no,cat,val)
{
	document.frm_opts.mode.value='edit';
	document.frm_opts.id.value=ID;
	document.frm_opts.hold_page.value = record_no*1;	
	document.frm_opts.submit();
}

function delete_chk_about()
	{
	var flag=false;
	for (i = 1; i < document.frm_chk_about.elements['publication_chkbox[]'].length; i++)
	  {
	  
		  if(document.frm_chk_about.elements['publication_chkbox[]'][i].checked==true)
		  {
			  flag=true;
				break;
		  }
	  }
	
		
	if(flag==false)
		{
		alert("Please select at least one row");
		return false;
		}
		
		if(document.frm_chk_about.choose_action.value==0)
			{
			alert("Please select the action");
			document.frm_chk_about.choose_action.focus();
			return false;
			}
	
		document.frm_chk_about.submit();
		
		
	}
</script>	
				
					<div class="tab-content" id="tab2">
					
					<div class="notification attention png_bg" id="err_msg_notification" style="display:none">
						<a href="#" class="close"><img src="resources/images/icons/cross_grey_small.png" make="Close this notification" alt="close" /></a>
						<div id="err_msg"></div>
					</div>
					
						<form action="<?php  echo $_SERVER['PHP_SELF']?>" method="post" name="add_frm" id="add_contact_form"  enctype="multipart/form-data">
						<input type="hidden" name="mode" value="insert_about">
						
							<fieldset> <!-- Set class to "column-left" or "column-right" on fieldsets to divide the form into columns -->
								<table width="100%" border="0" cellspacing="0" cellpadding="0" class="no_format">
								  <tr>
								    <td colspan="3">(<font color="#ff0000">All * mark fields are mandatory</font>)</td>
							      </tr>
                                  
                                  <tr>
								    <td width="21%" style="vertical-align:top;">Image</td>
								    <td width="2%">&nbsp;</td>
								    <td width="77%"><span style="display:flex;">
								      <input class="text-input medium-input" type="file" id="image_name" name="image_name" accept=".png, .jpg, .jpeg" onchange="validateimg_s(this.value)" autocomplete="off" required="required"/>
								    </span></td>
							      </tr>
                                  <tr>
								    <td style="vertical-align:top;">Title</td>
								    <td>&nbsp;</td>
								    <td><input class="text-input large-input" type="text" id="main_title" name="main_title" required/></td>
							      </tr>
                                  <tr>
								    <td style="vertical-align:top;">Description</td>
								    <td>&nbsp;</td>
								    <td width="77%"><?php 

									$oFCKeditor = new FCKeditor('description') ;

									$oFCKeditor->BasePath = FCKPATH;

									$oFCKeditor->Height = 250;  

									$oFCKeditor->Value = "";

									$oFCKeditor->Create() ;

									?></td>
							      </tr>
                                   
                                   <tr>
								    <td style="vertical-align:top;">Hindi Title</td>
								    <td>&nbsp;</td>
								    <td><input class="text-input large-input" type="text" id="main_title_hin" name="main_title" required/></td>
							      </tr>
                                  <tr>
								    <td style="vertical-align:top;">Hindi Description</td>
								    <td>&nbsp;</td>
								    <td width="77%"><?php 

									$oFCKeditor = new FCKeditor('description_hin') ;

									$oFCKeditor->BasePath = FCKPATH;

									$oFCKeditor->Height = 250;  

									$oFCKeditor->Value = "";

									$oFCKeditor->Create() ;

									?></td>
							      </tr>

							    <tr>
								<td>
								
								<input type="hidden" name="id" value="">
								<input type="hidden" name="hold_page" value="">
								<input class="button" type="submit" value="Submit"  onclick="return isValid();"/>&nbsp;<input class="button" value="Cancel" onclick="javascript:document.location.href='manage_weoffers.php'" type="button"></td>
							    <td>&nbsp;</td>
							    <td>&nbsp;</td>
							  </tr>
							</table>
								
						  </fieldset>
							
							<div class="clear"></div><!-- End .clear -->
							
						</form>
						
					</div> <!-- End #tab2 -->        
					
				</div> <!-- End .content-box-content -->
				
			</div> <!-- End .content-box -->
			
			 <!-- End .content-box -->
			
			 <!-- End .content-box -->
			<div class="clear"></div>
			
			
			<!-- Start Notifications -->
			<!-- End Notifications -->
			
<!-- -----------------------footer------------------ -->
<?php  }

	function insert_about()
	{
	
		global $link;
		
				$upload_dir='../uploads/we-offer/';
	
				$file_name=time()."_".str_replace(" ","_",$_FILES['image_name']['name']);
				$tmp_name=$_FILES['image_name']['tmp_name'];
				move_uploaded_file($tmp_name,$upload_dir.$file_name);
				  mysqli_set_charset($link,'utf8');
				 $sql_inset_post="INSERT INTO ".DB_WE_OFFER." 
					SET 
					image_name='".$file_name."',
					description='".addslashes($_REQUEST['description'])."',
					main_title='".addslashes($_REQUEST['main_title'])."',
					description_hin='".addslashes($_REQUEST['description_hin'])."',
					main_title_hin='".addslashes($_REQUEST['main_title_hin'])."'

					";	
					
                				
				$qry_inset_post	=mysqli_query($link,$sql_inset_post);	
				
				
			
	    
		if($qry_inset_post)
		{
		$_SESSION['ERR'] = "Latest we-offers inserted successfully";
		$_SESSION['CLASS'] = "notification success png_bg";
		$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png"; 
		header("location:manage_weoffers.php");
		exit();
		
	}
	else
	{
	    $_SESSION['ERR'] = "Latest we-offers already exist";
		$_SESSION['CLASS'] = "notification error png_bg";
		$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png"; 
		 header("location:manage_weoffers.php");
		exit();
	}
	
			
}

function delete_about()
{

global $link;
		$sql_delete_about= "UPDATE ".DB_WE_OFFER." SET status= 'I' WHERE `id`='".$_REQUEST['id']."'";  
		$qry_delete_about=mysqli_query($link,$sql_delete_about) or die(mysqli_error());
		
			$_SESSION['ERR'] = "Specialization has been successfully deleted.";
			$_SESSION['CLASS'] = "notification success png_bg";
			$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png";
		   header ("location:manage_weoffers.php");
		   exit();
	
}



function delete_chk_about()
{
	global $link;
$count_del=0;
foreach($_REQUEST['publication_chkbox'] as $val)
				{
				if($val!='on')
					{
					
					$sql_deletepublication = "UPDATE ".DB_WE_OFFER." 
                    SET 
					status= 'I' WHERE id='".$val."'";				
							$qry_deletepublication = mysqli_query($link,$sql_deletepublication) or die(mysqli_error());
							$count_del++;
							
					}
				}
				
				if($count_del > 0)
				{
				$_SESSION['ERR'] = "Selected we-offers has been successfully Deleted";
				$_SESSION['CLASS'] = "notification success png_bg";
				$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png"; 
				header("location:manage_weoffers.php");
				exit();
				}
				
}

function edit()
{
	global $link;
 mysqli_set_charset($link,'utf8');
$sql_edit_about = "SELECT * FROM ".DB_WE_OFFER."  where id =".$_REQUEST['id']."";
$qry_edit_about = mysqli_query($link,$sql_edit_about) or die(mysqli_error());
$row_edit_about = mysqli_fetch_array($qry_edit_about);

?>
<script language="javascript">
function isValid_edit()
{
	

		if(document.getElementById("Specialization _name").value=="")
		{
		alert("Please enter Specialization Name");
		document.getElementById("Specialization _name").focus();
		return false;
		}

}
</script>
<div class="content-box"><!-- Start Content Box -->
				
				<div class="content-box-header">
					
					<h3>Edit  We-offer</h3>
					
				
				  <div class="clear"></div>
					
				</div> <!-- End .content-box-header -->
				
				<div class="content-box-content">
				<div class="notification attention png_bg" id="err_msg_notification" style="display:none;">
						<a href="#" class="close"><img src="resources/images/icons/cross_grey_small.png" make="Close this notification" alt="close" /></a>
						<div id="err_msg"></div>
					</div>
			   
					<form action="<?php  echo $_SERVER['PHP_SELF']?>" method="post" name="edit_frm" enctype="multipart/form-data">
						<input type="hidden" name="mode" value="edit_about">
							<input type="hidden" name="id" value="<?php  echo $_REQUEST['id']?>">	
							<fieldset> <!-- Set class to "column-left" or "column-right" on fieldsets to divide the form into columns -->
								<table width="100%" border="0" cellspacing="0" cellpadding="0" class="no_format">
								  <tr>
								    <td colspan="3">(<font color="#ff0000">All * mark fields are mandatory</font>)</td>
							      </tr>
                                  <tr>
                                    <td class="vertical_top">Existing Image</td>
                                    <td><img src="../uploads/we-offer/<?php echo $row_edit_about['image_name']?>" alt="" width="100px" /></td>	
                                  </tr>
                                  <tr>
								    <td width="13%" style="vertical-align:top;">Image</td>
								    <td width="12%"><span style="display:flex;">
								      <input class="text-input medium-input" type="file" id="image_name" name="image_name" accept=".png, .jpg, .jpeg" onchange="validateimg_s(this.value)" autocomplete="off"/>
								    </span></td>
							      </tr>
                                  <tr>	
                                    <td width="13%"><span style="vertical-align:top;">Title</span></td>
								    <td width="12%"><input class="text-input large-input" type="text" id="main_title" name="main_title" value="<?php echo $row_edit_about['main_title'];?>" required/></td>
						          </tr>
                                  <tr>	
                                    <td width="22%" class="vertical_top">Description</td>
                                    <td width="78%"><?php 
    
                                        $oFCKeditor = new FCKeditor('description') ;
    
                                        $oFCKeditor->BasePath = FCKPATH;
    
                                        $oFCKeditor->Height = 250;  
    
                                        $oFCKeditor->Value =stripslashes(br2nl($row_edit_about['description']));
    
                                        $oFCKeditor->Create() ;
    
                                        ?>
                                    </td>
								    
						          </tr>

						          <tr>	
                                    <td width="13%"><span style="vertical-align:top;">Hindi Title</span></td>
								    <td width="12%"><input class="text-input large-input" type="text" id="main_title" name="main_title_hin" value="<?php echo $row_edit_about['main_title_hin'];?>" required/></td>
						          </tr>
                                  <tr>	
                                    <td width="22%" class="vertical_top">Hindi Description</td>
                                    <td width="78%"><?php 
    
                                        $oFCKeditor = new FCKeditor('description_hin') ;
    
                                        $oFCKeditor->BasePath = FCKPATH;
    
                                        $oFCKeditor->Height = 250;  
    
                                        $oFCKeditor->Value =stripslashes(br2nl($row_edit_about['description_hin']));
    
                                        $oFCKeditor->Create() ;
    
                                        ?>
                                    </td>
								    
						          </tr>
							   <tr>
								<td style="white-space:nowrap">
								
								<input type="hidden" name="id" value="<?php  echo $_REQUEST['id']?>">
								<input type="hidden" name="hold_page" value="">
								<input class="button" type="submit" value="Update"  onclick="return isValid_edit();"/> &nbsp; <input class="button" value="Cancel" onclick="javascript:document.location.href='manage_weoffers.php'" type="button"></td>
							    <td>&nbsp;</td>
							    <td width="75%">&nbsp;</td>
							  </tr>
							</table>
								
			    </fieldset>
							
							<div class="clear"></div><!-- End .clear -->
							
				  </form>
				</div> <!-- End .content-box-content -->
				
			</div> <!-- End .content-box -->
			
			 <!-- End .content-box -->
			 <!-- End .content-box -->
<div class="clear"></div>
			
			
			<!-- Start Notifications -->

			
			<!-- End Notifications -->
			
<!-- -----------------------footer------------------ -->
<?php 
}

function edit_about()
	{

	global $link;
		
		$upload_dir='../uploads/we-offer/';
	if($_FILES['image_name']['name']!="")
			{
				$file_name=time()."_".str_replace(" ","_",$_FILES['image_name']['name']);
				$tmp_name=$_FILES['image_name']['tmp_name'];
				move_uploaded_file($tmp_name,$upload_dir.$file_name);
				
				
			  mysqli_set_charset($link,'utf8');
			 $sql_inset_post="UPDATE ".DB_WE_OFFER." 
                    SET 
					image_name= '".$file_name."',
					main_title='".addslashes($_REQUEST['main_title'])."',
					description='".addslashes($_REQUEST['description'])."',
					main_title_hin='".addslashes($_REQUEST['main_title_hin'])."',
					description_hin='".addslashes($_REQUEST['description_hin'])."'
                    	where id='".$_REQUEST['id']."'";
					
					$qry_inset_post	=mysqli_query($link,$sql_inset_post) or die(mysqli_error($link));
					
				}
			
				else
				
				{
				mysqli_set_charset($link,'utf8');
				 $sql_inset_post="UPDATE ".DB_WE_OFFER." 
						SET 
						main_title='".addslashes($_REQUEST['main_title'])."',
						description='".addslashes($_REQUEST['description'])."',
						main_title_hin='".addslashes($_REQUEST['main_title_hin'])."',
					    description_hin='".addslashes($_REQUEST['description_hin'])."' 
							where id='".$_REQUEST['id']."'";
						
						$qry_inset_post	=mysqli_query($link,$sql_inset_post);
						
				}
					
	    
		if($qry_inset_post)
		{
		$_SESSION['ERR'] = "Latest we-offers updated successfully";
		$_SESSION['CLASS'] = "notification success png_bg";
		$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png"; 
		 header("location:manage_weoffers.php");
		exit();
		
	}
	else
	{
	    $_SESSION['ERR'] = "Latest we-offers already exist";
		$_SESSION['CLASS'] = "notification error png_bg";
		$_SESSION['IMG_PATH'] ="resources/images/icons/cross_grey_small.png"; 
		 header("location:manage_weoffers.php");
		exit();
	}
	  
		
		
	}
?>