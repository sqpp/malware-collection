<?php

include './Global/ControladorBaseDatos.php';
include './ClasesAdm/ImagenesCabeceraAdm.php';
include './ClasesObj/ImagenesCabeceraObj.php';

session_start();

$_SESSION["ImagenesCabecera_Mensaje"] = "";

$NombreImagen = $_POST["txtNombreImagen"];
$DirectorioCabeceras = "img/Cabecera/";

if($NombreImagen == "Imagen1") {
    $NombreArchivoNuevo = "Cabecera01";
}// if

else if($NombreImagen == "Imagen2") {
    $NombreArchivoNuevo = "Cabecera02";
}// else if

else if($NombreImagen == "Imagen3") {
    $NombreArchivoNuevo = "Cabecera03";
}// else if

else if($NombreImagen == "Imagen4") {
    $NombreArchivoNuevo = "Cabecera04";
}// else if

else {
    $NombreArchivoNuevo = "Cabecera05";
}// else 

$ArchivoRecibido = $_FILES["fArchivo"]["name"];

$InfoArchivo = new SplFileInfo($ArchivoRecibido);
$Extension = $InfoArchivo->getExtension();

$NuevoArchivo = $DirectorioCabeceras . $NombreArchivoNuevo . "." . $Extension;
    
$ArchivoSubido = move_uploaded_file($_FILES["fArchivo"]["tmp_name"], $NuevoArchivo);
    
if($ArchivoSubido) {
        
    $BaseDatos = new ControladorBaseDatos();
    $AdmIC = new ImagenesCabeceraAdm($BaseDatos);
        
    $BaseDatos->AbrirConexion();
    
    try {
        
        $BaseDatos->IniciarTransacction();
        $AdmIC->ActualizarImagen($NombreImagen, $NuevoArchivo);
        $BaseDatos->AplicarTransaccion();
        
    }// try 
    
    catch (Exception $ex) {
        
        $BaseDatos->ReversarTransaccion();
        $_SESSION["ImagenesCabecera_Mensaje"] = $ex->getMessage();

    }// catch
    
    $BaseDatos->CerrarConexion();
        
}// if
    
else {
    $_SESSION["ImagenesCabecera_Mensaje"] = "No se pudo enviar la imagen al servidor. Por favor intente de nuevo.";
}// if

header("Location: ImagenesCabeceraExlora.php");