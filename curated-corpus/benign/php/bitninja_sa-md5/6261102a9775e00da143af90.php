<?php
	require_once("session.php");
	require_once("../conn.php");
	require_once("../config.php");

	$msg="";

	if(isset($_POST['add'])){
		$cat_id=filter_input(INPUT_POST, "cat_id");
		$name=filter_input(INPUT_POST, "name");
		$photo=$_FILES['photo']['name'];
		
		$photo=time()."_".$photo;
		
		$path="../assets/images/categories/$photo";
		
		$sql="select * from subcategories where name='$name' and cat_id=$cat_id";
		$query=mysqli_query($conn, $sql);
		if(mysqli_num_rows($query)>0){
			$msg="Category Name already exist";
		}else{
			$sql="insert into subcategories (cat_id, name, photo) values ($cat_id, '$name', '$photo')";
			$query=mysqli_query($conn, $sql);
			move_uploaded_file($_FILES['photo']['tmp_name'], $path);
			header("location:subcategories.php");
		}
	}

?>
<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Add Subcategory</title>

  <?php include("links.php"); ?>

</head>

<body id="page-top">

  <?php include("navbar.php"); ?> 

  <div id="wrapper">

    <?php include("sidebar.php"); ?>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="index.php">Dashboard</a>
          </li>
		  <li class="breadcrumb-item">
            <a href="subcategories.php">Subcagegories</a>
          </li>
          <li class="breadcrumb-item active">Add Subcategory</li>
        </ol>

        
<div class="row">
		<div class="col-lg-6 offset-3">
        <!-- DataTables Example -->
        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-table"></i>
            Add Subcategory
			  
		  </div>
          <div class="card-body">
			 <p class="text-danger"><?php echo $msg; ?></p>
			<form action="" method="post" enctype="multipart/form-data">
			  <div class="form-group">
				<label>Category</label>
				<select name="cat_id" class="form-control" required="required">
					<option value="">Select Category...</option>
					<?php 
							$sql="select * from categories";
							$query=mysqli_query($conn, $sql);
							while($result=mysqli_fetch_assoc($query)){	
					
					?>
						<option value="<?php echo $result['id']; ?>"><?php echo $result['name'];  ?></option>
					<?php } ?>
				</select>
			  </div>
				
			  <div class="form-group">
				  <label>Subcategory Name</label>
				<input name="name" type="text" class="form-control" required="required">
			  </div>

			  <div class="form-group">
				  <label>Subcategory Photo</label><strong></strong>
				<input name="photo" type="file" class="form-control" required="required">
			  </div>

			  <button type="submit" name="add" class="btn btn-primary">Submit</button>
			</form>
          </div>
          <div class="card-footer small text-muted"></div>
        </div>
	</div>
</div>

      </div>
      <!-- /.container-fluid -->

      

    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->
<?php include("footer.php"); ?>

</body>

</html>
