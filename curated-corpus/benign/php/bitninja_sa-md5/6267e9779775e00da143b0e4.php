<?php	
	
	$form_vars = array();
	/* VALIDATE AND GET FORM VARIABLES */
	if(!$_POST['name'] == "")
	{
		$form_vars['name'] = process_data($_POST['name']);
	}else{trigger_error("$_POST ERROR:Please enter your name.");}
		
	if(!$_POST['email'] == "")
	{
		$form_vars['email'] = process_data($_POST['email']);
	}else{trigger_error("$_POST ERROR:Please enter your emai address.");}
	
	if(!$_POST['subject'] == "")
	{
		$form_vars['subject'] = process_data($_POST['subject']);
	}else{trigger_error("$_POST ERROR:Please enter the subject.");}
	
	if(!$_POST['message'] == "")
	{
		$form_vars['message'] = process_data($_POST['message']);
	}else{trigger_error("$_POST ERROR:Please enter your message.");}
	
	
	/* SEND THE EMAIL */
	if(sendEmail($form_vars))
	{
		echo "success";
	}
	else
	{
		echo "fail";
	}
	
	
	/* THIS METHOD UN-QUOTES A QUOTED STRING AND CHECKS FOR SQL INJECTIONS
	/* Input:string
	/* Output:processed string
	/* Requesting file:form inputs */
	function process_data($str,$remove_nl=true)
    {
		$ret_str = Strip_Slashes($str);

        if($remove_nl)
        {
            $injections = array('/(\n+)/i',
								'/(\r+)/i',
								'/(\t+)/i',
								'/(%0A+)/i',
								'/(%0D+)/i',
								'/(%08+)/i',
								'/(%09+)/i'
								);
								
            $ret_str = preg_replace($injections,'',$str);
        }

        return $ret_str;
    }
	
	/* THIS METHOD UN-QUOTES A QUOTED STRING
	/* Input:string
	/* Output:striped string
	/* Requesting file:process_data */
	function Strip_Slashes($str)
    {
		$ret_str ="";
        if(get_magic_quotes_gpc())
        {
            $ret_str = stripslashes($str);
        }			
        return $ret_str;
    }
	
	
	/* THIS METHOD SENDS A NORMAL EMAIL
	/* Input:f name,l name,email,subject,message
	/* Output:
	/* Requesting file:contact.php*/
	function sendEmail($form_vars)
	{
		$site_name = "";
		$from = $form_vars['email'];
		$to = 'wherd7@gmail.com';
		$subject = $form_vars['subject']; 
		$message = $form_vars['message'];
		
		$headers = "MIME-Version: 1.0" . "\r\n";
		$headers .= "Content-type:text/html;charset=iso-8859-1" . "\r\n";
		$headers .= "From:".$from;
		$headers .= PHP_EOL;

		if(mail($to,$subject,$message,$headers))
		{
			return true;			
		}
		else
		{
			return false;
		}
		
		/* $site_name = "stayngo.co.nz";
		$from = $form_vars['email'];
		$subject = $form_vars['subject'];  			   
		$message = $form_vars['message'];

		if(mail($to,$subject,$message))
		{
			return true;			
		}
		else
		{
			return false;
		}	
		return false; */
		
	}
	
		
		
?>