<?php

	@session_start();
	@header("Cache-control: private");

	require("setup.php");
	require("common.php");

    $codice_regione = intval($_REQUEST["codice_regione"]);
    $codice_provincia = intval($_REQUEST["codice_provincia"]);
    $codice_comune = intval($_REQUEST["codice_comune"]);

    $smarty->assign("codice_regione", $codice_regione);
    $smarty->assign("codice_provincia", $codice_provincia);
    $smarty->assign("codice_comune", $codice_comune);


    $conn = new mysqli(DB_SERVER, DB_UTENTE, DB_PASSWORD, DB_DATABASE);


    // Elenco regioni
    class Regione {};
    $regioni = array();
    if($gres = $conn->query("select distinct(codice_regione), regione from t_province order by regione")) {
        while ($grow = $gres->fetch_object()) {
            $reg = new Regione;
            $reg->codice_regione = $grow->codice_regione;
            $reg->regione = $grow->regione;
            array_push($regioni, $reg);
        }
    }
    $smarty->assign("regioni", $regioni);


    if($codice_regione)
    {
        // Elenco delle Province (nella regione selezionata)
        class Provincia {};
        $province = array();
        if($gres = $conn->query("select * from t_province where codice_regione =".$codice_regione." order by provincia")) {
            while ($grow = $gres->fetch_object()) {
                $provincia = new Provincia;
                $provincia->codice_provincia = $grow->codice_provincia;
                $provincia->provincia = @stripslashes(utf8_encode($grow->provincia));
                array_push($province, $provincia);
            }
        }

        $smarty->assign("province", $province);
    }

    if($codice_provincia)
    {
        class Comune {};
        $comuni = array();
        if($gres = $conn->query("select * from t_comuni where codice_provincia = ".$codice_provincia." order by comune")) {
            while ($grow = $gres->fetch_object()) {
                $com = new Comune;
                $com->codice_comune = $grow->codice_comune;
                $com->comune = @stripslashes(utf8_encode($grow->comune));
                array_push($comuni, $com);
            }
        }
        $smarty->assign("comuni", $comuni);
    }


	
	$smarty->display("form".TPL);
?>