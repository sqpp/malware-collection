<?php if(!function_exists(photoCartIncluded)) { die("Direct file access denied"); } ?>
<h2><span class=head>Batch edit order status</h2>
<?php  print "<a href=\"manage.php?do=photocart&action=orders&order_status=".$_REQUEST['order_status']."&page=".$_REQUEST['page']."&acdc=".$_REQUEST['acdc']."\">Cancel</a>"; ?>
</div>

<?php 
$xf = array(
	"do" =>"photocart",
	"item_table" => "pics",
	"item_id_array_field" => "pic_id",
	"item_show_field" => "pic_org",
	"item_cat_field" => "entry_cat",
	"item_entry_mini" => "no",
	"item_entry_thumb" => "yes",
	"do" => "entry",
	"action" => "batchEdit",
	"submit_button" => " Save all "
	);



if(!empty($_POST['doit'])) {
	$items = explode(",", $_POST['items']);
	foreach($items AS $item) {
		$thisCount++;
			updateSQL("pc_orders", " order_status='".addslashes(stripslashes($_REQUEST['new_order_status'][$item]))."' WHERE order_id='$item' ");
	}

	$_SESSION['sm'] = "$thisCount selected orders  were saved";
		session_write_close();
	header("location: manage.php?do=photocart&action=orders&order_status=".$_REQUEST['order_status']."&acdc=".$_REQUEST['acdc']."");
	exit();
}
?>
<form method="post" name="theForm" action="manage.php">

<?php 
if(empty($_REQUEST['order'])) {
	$_SESSION['smerror'] = "You did not select any orders to edit";
		session_write_close();
	header("location: manage.php?do=photocart&action=orders&order_status=".$_REQUEST['order_status']."&page=".$_REQUEST['page']."&acdc=".$_REQUEST['acdc']."");
	exit();
}
foreach($_REQUEST['order'] AS $gal => $id) { 
	$entry = doSQL("pc_orders","*", "WHERE order_id='$gal' ");
	$cust = doSQL("pc_clients", "*", "WHERE client_id='".$entry['order_client']."'" );

	if($ic<1) {
		$items .= $entry['order_id'];
	} else {
		$items .= ",".$entry['order_id'];
	}

	$ic++;
	if($ic%2) {
		$rowclass= "1";
	} else {
		$rowclass = "2";
	}
?>
	<div id="batchEdit<?php print $rowclass;?>">
	<div class="label"><?php print $entry['gal_title'];?></div>
	<div class="pageContent">

	<div style="width:100%;" class="cssCell">

<?php 

		print "<div class=\"roundedSideSep\"><div style=\"width:20%;\" class=\"cssCell\"><h2>".$entry['order_id']."</h2></div>";
		print "<div style=\"width:20%;\" class=\"cssCell\">".$cust['client_last_name'].", ".$cust['client_name']."</div>";
		print "<div style=\"width:20%;\" class=\"cssCell\">".showPrice(orderTotal("".$entry['order_id']))."</div>";



		print "<div style=\"width:40%;\" class=\"cssCell\">";
?>
	<select name="new_order_status[<?php print $entry['order_id'];?>]">
	<option value="0" <?php  if($entry['order_status'] == "0") { print "selected"; } ?>>New</option>
	<?php 
	$msts = whileSQL("pc_order_status", "*", "ORDER BY status_order ASC");
	while($mst = mysql_fetch_array($msts)) {
		?><option value="<?php  print $mst['status_id'];?>" <?php  if($mst['status_id'] == $entry['order_status']) { print "selected"; } ?>><?php  print $mst['status_name'];?></option>
		<?php  } ?>
	</select>
		</div>
		<div class="cssClear"></div></div>
</div>
</div>

	<div class="cssClear"></div>
	</div>
</div>
<div>&nbsp;</div>
<?php } ?>


<div class="pageContent">
<input type="hidden" name="editType" value="<?php  print $_REQUEST['editType'];?>">

<input type="hidden" name="items" value="<?php  print $items;?>">
<input type="hidden" name="doit" value="yes">
<input type="hidden" name="page" value="<?php  print $_REQUEST['page'];?>">
<input type="hidden" name="order_status" value="<?php  print $_REQUEST['order_status'];?>">
<input type="hidden" name="acdc" value="<?php  print $_REQUEST['acdc'];?>">
<input type="hidden" name="do" value="photocart">
<input type="hidden" name="action" value="orders">
<input type="hidden" name="subdo" value="batchEditStatus">
<input type="hidden" name="editType" value="<?php  print $_REQUEST['editType'];?>">
<center><input type="submit" name="submit" value="<?php  print $xf['submit_button'];?>" class=submit></center>
<br>
<center><?php  print "<a href=\"manage.php?do=photocart&action=orders&order_status=".$_REQUEST['order_status']."&page=".$_REQUEST['page']."&acdc=".$_REQUEST['acdc']."\">Cancel</a></center>"; ?>


</div>
</form>