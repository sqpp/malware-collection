<?php
################################################################################
##---------------------------1 - Beállítások
################################################################################
   $upload_dir = "tmp/";   //Ahova menteni fogja a feltöltött fájlokat(az attribútomot állítsd 777-re)

   $upload_dir =$kvtnev."thumbnai/"; 

   $size_bytes = 3024000; //max fájl méret
   $extlimit = "yes"; //Ne piszkáld jó így ahogy van
   $limitedext = array(".jpg",".txt",".html"); //megengedett formátumok

echo "<hr align=center size=3 color=red>";

 

################################################################################
##---------------------------2 - Mappa hibakódok
################################################################################
   //Hibakódot ír ha nem létezik a megadott mappa
   if (!is_dir("$upload_dir")) 
     {
     die ("Hiba: a megadott mappa <b>($upload_dir)</b> nem létezik!");
     }
   //Hibakódot ír ha nincs beállítva a 777-es attribútom
   if (!is_writeable("$upload_dir"))
     {
     die ("Hiba: a megadott mappának<b>($upload_dir)</b> állíts be 777-es attribútomot! )");
     }

################################################################################
##---------------------------3 - Általános hibakódok
################################################################################
   if(isset($_POST['uploadform']))
     {
     $file_tmp = $_FILES['filetoupload']['tmp_name'];
     $file_name = $_FILES['filetoupload']['name'];
     $file_size = $_FILES['filetoupload']['size'];

           //Hibakódot ír ha nincs kiválasztott fájl
     if (!is_uploaded_file($file_tmp))
       {
       echo "Hiba: válassza ki a feltöltendő fájlt! <br>»<a href=\"$_SERVER[PHP_SELF]\">Vissza!</a>";
       exit();
       }


           //Hibakódot ír ha a feltöltendő fájl meghaladta a max méretet
     if ($file_size > $size_bytes)
       {
       echo "Hiba: A fájl meghaladta a Max. <b>". $size_bytes / 1024 ."</b> KB méretet! <br>»<a href=\"$_SERVER[PHP_SELF]\">Vissza!</a>";
       exit();
       }
     //Hibakódot ír ha helytelen a fájl kiterjesztés
     $ext = strrchr($file_name,'.');
     if (($extlimit == "yes") && (!in_array(strtolower($ext),$limitedext))) 
       {
       echo("Hiba: helytelen fájl kiterjesztés. ");
       exit();
       }


           // Check if file is Already EXISTS.
if(file_exists($upload_dir.$file_name))
  {
  echo "Hiba: Már van ilyen fájl név<b>($file_name)</b>! <br>»<a href=\"$_SERVER[PHP_SELF]\">Vissza!</a>";
   exit();
  }

$file_name = str_replace(' ', '_', $file_name);
          if (move_uploaded_file($file_tmp,$upload_dir.$file_name)) 
            {
            //Kiírja hogy sikeresen feltöltve a fájl
            echo "Fájl (<a href=\"$upload_dir$file_name\">$file_name</a>) sikeresen feltöltve! <br>&lt;&lt;<a href=\"$_SERVER[PHP_SELF]\">Vissza!</a>";
            exit();
            }
            else
              {
              //Hibakódot ha progléma van a fájl mozgatásában
              echo "Valami progléma van a fájl mozgatásánál. <br>»<a href=\"$_SERVER[PHP_SELF]\">Vissza!</a>";
              exit();
              }

################################################################################
##---------------------------4 - Űrlap
################################################################################

   }
 else
   {
   for($i=0;$i<count($limitedext);$i++)
     {
	   if (($i<>count($limitedext)-1))$commas=", ";else $commas="";
	   
     list($key,$value)=each($limitedext);
	   $all_ext .= $value.$commas;
	   }
   //Az űrlap
   $celkonyvtar= "/$_GET[old]/$_GET[ald]/$_GET[ald2]&lan=$lan&k2=$kepteteje&k3=$k3&menupont=$menupont";
   $celkonyvtar= $kvtnev;


   echo "<br><h3>Tartalom feltöltése</h3>"
        ."- Érvényes kiterjesztések: $all_ext (!!! -0.html)</b><br>"
         ."- Max fájl méret = ". $size_bytes / 1024 ."KB"
         ."<form method=\"post\" enctype=\"multipart/form-data\" action=\"$PHP_SELF\">"
         ."<input type=\"file\" name=\"filetoupload\"  size=65><br>"
         ."<input type=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"$size_bytes\"><br>"
         ."<input type=\"Submit\" name=\"uploadform\" value=\"Feltöltés>>\"> Ide $celkonyvtar"
         ."</form>";
   }//end of else

clearstatcache();      
?>
