<?php
/**
 * Nuova Categoria
 * leggimenu Admin
 *
 * Copyright 2020, WEBSELF S.r.l.
 *
 */

// Config
require_once('inc/config.php');

// Session
session_start();

// Check Access
$access->is_loggedin();

// Init Objects
$item = new Item();

// Insert Data
if( $_POST ){
    $result =  $item->add_categoria( $_POST, $_FILES );
}

// Header Options
$meta_title = 'leggimenu Admin - Nuova Categoria';
$custom_assets = '';
$active_menu = 'categorie';

// Header inclusion
include_once( ROOT_PATH.'/header.php' );
?>

<!-- begin:: Content Head -->
<div class="kt-subheader kt-grid__item" id="kt_subheader">

    <div class="kt-subheader__main">
        <h3 class="kt-subheader__title">Nuova Categoria</h3>
        <span class="kt-subheader__separator kt-subheader__separator--v"></span>
        <div class="kt-subheader__breadcrumbs">
            <a href="/index.php" class="kt-subheader__breadcrumbs-link">Home</a>
            <span class="kt-subheader__breadcrumbs-separator"></span>
            <span class="kt-subheader__breadcrumbs-link">Nuova Categoria</span>
        </div>
    </div>

    <?php include_once( ROOT_PATH.'/parts/quick-actions.php' ); ?>

</div>
<!-- end:: Content Head -->

<!-- begin:: Content -->
<div class="kt-content  kt-grid__item kt-grid__item--fluid" id="kt_content">
    <div class="row">
        <div class="col-lg-12">

            <!--begin::Portlet-->
            <div class="kt-portlet kt-portlet--last kt-portlet--head-lg kt-portlet--responsive-mobile" id="kt_page_portlet">

                <div class="kt-portlet__head kt-portlet__head--lg">
                    <div class="kt-portlet__head-label">
                        <span class="kt-portlet__head-icon">
                            <i class="kt-font-brand fa fa-folder-open"></i>
                        </span>
                        <h3 class="kt-portlet__head-title">Aggiungi una nuova Categoria</h3>
                    </div>
                    <div class="kt-portlet__head-toolbar">
                        <a href="<?php echo ROOT_URL.'/categorie.php'; ?>" class="btn btn-clean kt-margin-r-10">
                            <i class="la la-arrow-left"></i>
                            <span class="kt-hidden-mobile">Torna alla Lista</span>
                        </a>
                        <button type="button" class="btn btn-brand submit-form">
                            <i class="la la-check"></i>
                            <span class="kt-hidden-mobile">Salva</span>
                        </button>
                    </div>
                </div>

                <div class="kt-portlet__body">
                    <form class="kt-form" id="nuova-categoria" method="post" enctype="multipart/form-data" autocomplete="off">
                        <div class="row">
                            <div class="col-xl-8">
                                <div class="kt-section kt-section--first">
                                    <div class="kt-section__body">
                                        <?php if( isset($result) && $result ){
                                            echo
                                            '<div class="alert alert-outline-danger fade show" role="alert">
                                                <div class="alert-icon"><i class="flaticon-danger"></i></div>
                                                <div class="alert-text">
                                                    <h5>Attenzione, si è verificato un errore durante la creazione della nuova Categoria.</h5>
                                                    '.$result.'
                                                </div>
                                                <div class="alert-close">
                                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                        <span aria-hidden="true"><i class="la la-close"></i></span>
                                                    </button>
                                                </div>
                                            </div>';
                                        } ?>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Titolo</label>
                                            <div class="col-10">

                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-folder-open"></i></span></div>
                                                    <input type="text" name="titolo" id="titolo" class="form-control" value="" placeholder="Titolo" aria-describedby="basic-addon1">
                                                </div>

                                                <!-- Multilingua - Estensione #Applicazione -->
                                                <div class="accordion accordion-light accordion-toggle-plus" id="ml-titolo">

                                                        <div class="card">

                                                            <div class="card-header">
                                                                <div class="card-title collapsed " data-toggle="collapse" data-target="#ml-titolo-fields" aria-expanded="false" aria-controls="ml-titolo-fields">
                                                                    <i class="fas fa-globe"></i>
                                                                    Multilingua: traduci il titolo
                                                                </div>
                                                            </div>

                                                            <div id="ml-titolo-fields" class="collapse" data-parent="#ml-titolo">

                                                                <div class="card-body">

                                                                    <?php if( isset($licenza_2['stato']) && $licenza_2['stato'] == 1 ){ ?>

                                                                        <?php $ml_data = $item->get_ml_data( $_SESSION['id'] ); ?>

                                                                        <?php if( isset($ml_data['multilingua']) && $ml_data['multilingua'] == 2 && isset($ml_data['lingue_custom']) && count($ml_data['lingue_custom']) > 0 ){ ?>

                                                                            <?php foreach( $ml_data['lingue_custom'] as $code => $label ){ ?>

                                                                                <div class="input-group mt-2 mb-2">
                                                                                    <div class="input-group-prepend">
                                                                                <span class="input-group-text">
                                                                                    <img src="<?php echo ROOT_URL; ?>/assets/media/app/<?php echo $code; ?>.svg" width="18" alt="Titolo <?php echo $code; ?>">
                                                                                </span>
                                                                                    </div>
                                                                                    <input type="text" name="titolo_<?php echo $code; ?>" id="titolo-<?php echo $code; ?>" class="form-control" value="" placeholder="Titolo in <?php echo $label; ?>" aria-describedby="basic-addon1">
                                                                                </div>

                                                                            <?php } ?>

                                                                        <?php }else{ ?>

                                                                            Accertati di aver attivato il <b>Multilingua Avanzato</b> e di aver selezionato <b>almeno una lingua aggiuntiva</b> su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a>.

                                                                        <?php } ?>

                                                                    <?php }else{ ?>

                                                                        Attiva il Multilingua Avanzato su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a> per tradurre manualmente i tuoi titoli.

                                                                    <?php } ?>

                                                                </div>

                                                            </div>

                                                        </div>

                                                    </div>

                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Descrizione</label>
                                            <div class="col-10">

                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="fas fa-file-alt"></i></span></div>
                                                    <textarea name="descrizione" id="descrizione" class="form-control" placeholder="Descrizione categoria" aria-describedby="basic-addon1"></textarea>
                                                </div>

                                                <!-- Multilingua - Estensione #Applicazione -->
                                                <div class="accordion accordion-light accordion-toggle-plus" id="ml-descrizione">

                                                        <div class="card">

                                                            <div class="card-header">
                                                                <div class="card-title collapsed " data-toggle="collapse" data-target="#ml-descrizione-fields" aria-expanded="false" aria-controls="ml-descrizione-fields">
                                                                    <i class="fas fa-globe"></i>
                                                                    Multilingua: traduci la descrizione
                                                                </div>
                                                            </div>

                                                            <div id="ml-descrizione-fields" class="collapse" data-parent="#ml-descrizione">

                                                                <div class="card-body">

                                                                    <?php if( isset($licenza_2['stato']) && $licenza_2['stato'] == 1 ){ ?>

                                                                        <?php $ml_data = $item->get_ml_data( $_SESSION['id'] ); ?>

                                                                        <?php if( isset($ml_data['multilingua']) && $ml_data['multilingua'] == 2 && isset($ml_data['lingue_custom']) && count($ml_data['lingue_custom']) > 0 ){ ?>

                                                                            <?php foreach( $ml_data['lingue_custom'] as $code => $label ){ ?>

                                                                                <div class="input-group mt-2 mb-2">
                                                                                    <div class="input-group-prepend">
                                                                                    <span class="input-group-text">
                                                                                        <img src="<?php echo ROOT_URL; ?>/assets/media/app/<?php echo $code; ?>.svg" width="18" alt="Descrizione <?php echo $code; ?>">
                                                                                    </span>
                                                                                    </div>
                                                                                    <textarea name="descrizione_<?php echo $code; ?>" id="descrizione-<?php echo $code; ?>" class="form-control" placeholder="Descrizione in <?php echo $label; ?>" aria-describedby="basic-addon1"></textarea>
                                                                                </div>

                                                                            <?php } ?>

                                                                        <?php }else{ ?>

                                                                            Accertati di aver attivato il <b>Multilingua Avanzato</b> e di aver selezionato <b>almeno una lingua aggiuntiva</b> su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a>.

                                                                        <?php } ?>

                                                                    <?php }else{ ?>

                                                                        Attiva il Multilingua Avanzato su <a href="<?php echo ROOT_URL.'/impostazioni.php'; ?>" target="_blank">Impostazioni > Multilingua</a> per tradurre manualmente le tue descrizioni.

                                                                    <?php } ?>

                                                                </div>

                                                            </div>

                                                        </div>

                                                    </div>

                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-2 col-form-label">Immagine</label>
                                            <div class="col-10">
                                                <div class="input-group">
                                                    <div class="input-group-prepend"><span class="input-group-text"><i class="far fa-image"></i></span></div>
                                                    <div class="custom-file">
                                                        <input type="file" class="custom-file-input" id="img" name="img">
                                                        <label class="custom-file-label" id="img-label" for="img">Seleziona Immagine</label>
                                                        <div id="img-container" style="visibility: hidden;"></div>
                                                    </div>
                                                </div>
                                                <span class="form-text text-muted">Si consiglia di inserire un'immagine (jpg, png o gif) <b>orizzontale</b> per una migliore leggibilità del menù.</span>
                                            </div>
                                        </div>

                                        <div class="form-group row">

                                            <label class="col-2 col-form-label">Opzioni</label>

                                            <div class="col-10">

                                                <label class="kt-option">

                                                    <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                        <label>
                                                            <input type="checkbox" value="1" name="testo">
                                                            <span></span>
                                                        </label>
                                                    </span>

                                                    <span class="kt-option__label">
                                                        <span class="kt-option__head">
                                                            <span class="kt-option__title">
                                                                Modalità Testo Semplice
                                                            </span>
                                                            <span class="kt-option__focus">
                                                                <i class="far fa-file-alt kt-font-brand"></i>
                                                            </span>
                                                        </span>
                                                        <span class="kt-option__body">
                                                            Attiva questa opzione per trasformare la categoria in un <b>blocco testo informativo</b>.<br> <b class="kt-font-danger">Attenzione: le voci associate a questa categoria NON saranno visibili sul tuo menù digitale</b>.
                                                        </span>
                                                    </span>

                                                </label>

                                                <!-- PDF Status - #Applicazione -->
                                                <?php if( isset($licenza_2['stato']) && $licenza_2['stato'] == 1 ){ ?>

                                                    <label class="kt-option">

                                                        <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                            <label>
                                                                <input type="checkbox" value="1" name="pdf_status" checked>
                                                                <span class="kt-switch-bg-info"></span>
                                                            </label>
                                                        </span>

                                                        <span class="kt-option__label">
                                                            <span class="kt-option__head">
                                                                <span class="kt-option__title">
                                                                    Includi questa categoria nella versione PDF
                                                                </span>
                                                                <span class="kt-option__focus">
                                                                    <i class="far fa-file-pdf kt-font-info"></i>
                                                                </span>
                                                            </span>
                                                             <span class="kt-option__body">
                                                                Con questa opzione la tua categoria farà parte della versione PDF (stampabile)
                                                             </span>
                                                        </span>

                                                    </label>

                                                <?php }else{ ?>

                                                    <label class="kt-option">

                                                        <span class="kt-switch kt-switch--sm kt-switch--icon">
                                                            <label>
                                                                <input type="checkbox"checked disabled>
                                                                <input type="hidden" value="1" name="pdf_status">
                                                                <span class="kt-switch-bg-info"></span>
                                                            </label>
                                                        </span>

                                                        <span class="kt-option__label">
                                                            <span class="kt-option__head">
                                                                <span class="kt-option__title">
                                                                    Includi questa categoria nella versione PDF
                                                                </span>
                                                                <span class="kt-option__focus">
                                                                    <i class="far fa-file-pdf kt-font-info"></i>
                                                                </span>
                                                            </span>
                                                             <span class="kt-option__body">
                                                                Questa funzione è disponibile con l'<a href="https://www.leggimenu.it/estensioni/applicazione/#tabella-comparativa" target="_blank">Estensione Applicazione ></a>
                                                             </span>
                                                        </span>

                                                    </label>

                                                <?php } ?>

                                            </div>

                                        </div>

                                    </div>
                                </div>

                            </div>
                            <div class="col-xl-4">

                                <div class="alert alert-secondary" role="alert">
                                    <div class="alert-icon"><i class="flaticon-questions-circular-button"></i></div>
                                    <div class="alert-text">
                                        <h4>Suggerimenti</h4>

                                        Stai creando una nuova <strong>Categoria</strong>
                                        <br><br>
                                        <div class="kt-list-timeline">
                                            <div class="kt-list-timeline__items">

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Scegli un titolo che riassuma il gruppo di voci menu che assocerai alla categoria (es. Antipasti)</span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Puoi inserire, opzionalmente, una descrizione per la tua categoria. </span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Arricchisci la tua categoria con una foto accattivante. </span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Modalità Testo Semplice: trasforma la tua categoria in un paragrafo di testo semplice. Puoi utilizzarlo per pubblicare informazioni aggiuntive che riguardano la tua attività. Ricorda che le voci associate a questa categoria non saranno visibili nel tuo menù digitale.</span>
                                                </div>

                                                <div class="kt-list-timeline__item">
                                                    <span class="kt-list-timeline__badge kt-list-timeline__badge--brand"></span>
                                                    <span class="kt-list-timeline__text">Ricorda che nella lista categorie potrai anche impostare l'ordine di visualizzazione delle tue categorie</span>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </form>
                </div>

                <div class="kt-portlet__foot kt-portlet__foot--lg">
                    <div class="kt-portlet__foot-toolbar">
                        <button type="button" class="btn btn-brand submit-form">
                            <i class="la la-check"></i>
                            <span class="kt-hidden-mobile">Salva</span>
                        </button>
                    </div>
                </div>

            </div>

            <!--end::Portlet-->
        </div>
    </div>
</div>
<!-- end:: Content -->

<?php
// Footer Options
$custom_scripts = '';

// Footer inclusion
include_once( ROOT_PATH.'/footer.php' );
