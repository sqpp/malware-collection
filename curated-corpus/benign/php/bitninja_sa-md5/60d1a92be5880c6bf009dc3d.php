<?php
$saisons_div = null;
$worlds = null;
$dash = null;
$source_jw = null;
$tv = null;
$jw = null;
$vjs = null;
$vovf_bouton = null;
$vovf_bouton_mobile = null;
$api = null;
$hls = null;
$hls_ios = null;
$http = null;
$http_sd = null;
$api3 = null;
$api4 = null;
$boutons = null;
$next_bouton = null;
$next_bouton_mobile = null;
$saisons_div_norm = null;
$saisons_div_mobile = null;
$prev_bouton = null;
$prev_bouton_mobile = null;
$genre_label = "Genre :";
/////////////////////////////////////////
$useragent = $_SERVER['HTTP_USER_AGENT'];
$ip = $_SERVER["HTTP_X_REAL_IP"];

if (preg_match('/ipad|iphone|Intel Mac OS/i', $useragent) && $airplay == '1') 
$airplay != '1';
else
$airplay = '0';

if ($_GET['ep'] > 1 && preg_match('/windows|android/i', $useragent))
$autoplay = "autoplay: true,";

$fdc = "off";
$p2p = "off";
$googleproxy = "off";
$sv_down = "";

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

if (preg_match('/(^89\.94|^92\.92|^217.67.15|^185\.55.|^85\.95|^89\.156|^86\.19|^86\.2[0-9]|^86\.[6-8]|^130\.0|^109\.|^81\.64|^81\.249|^81\.250|^81\.251|^92\.1[3-8]|^176\.1[2-8]|^77.19|^77.20|^77.1[4-5]|^83\.2|^83\.1|^31.3|^81\.5[0-8]\.|^82.24[0-9]|^82.23[0-9]|^82.25[0-9]|^90\.|^5\.48.|^78\.[1-2]|^88\.1|^62\.3|^193\.57|^89\.8|^87\.231|^194\.153|^91\.1|^93\.21|^93\.22|^91\.88|^46\.162|^195\.36|^93\.[4-5]\.|^93\.[0-3][0-9]\.|^2\.1[0-5]|^193.250|^80.21[4-5]|^95\.176|^81\.185|^81\.14|^79\.84|^2\.|^80\.1\.|^87\.90)/i',$ip) || $nf_sv == "1") {
    
    $fdc = "on";
    $fdc_http = "on";
    $fdc1 = "on";
    $fdc2 = "on";
}

if (preg_match('/(^86\.243|^90\.65|90\.114|90\.42|^37\.168)/i',$ip)) {
	$fdc = "off";
    $fdc_all_disable = "1";
    $fdc_http = "off";
}

if (preg_match('/(^77\.192|^92\.137|^90\.1\.|^90\.78|109\.8|^90\.125|^2\.3\.|^81\.249|^86\.208|^86\.220|^86\.243|^86\.244|^86\.254|^86\.239|^77\.20[1-5]|^86\.211|^77.1[4-5]|^78\.118|^91\.68|^93\.2|^80\.11|^83\.19|^92\.157|^188\.141|^89\.3\.|^91\.173|^87\.90|^81\.51\.|^92\.171|^77\.84|^176\.15|^91\.16)/i',$ip)) {
    $nfo = "on";
    $nfo_http = "on";
    $fdc = "off";
    $fdc_all_disable = "1";
    $fdc_http = "off";
}


if (preg_match('/worlds/i',$ip) || $nf_sv == "1") 
	$worlds = "on";

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if (file_get_contents("../data/statuscake/fdc3.status") == "off")
    $fdc_http_disable = 1;
if (file_get_contents("../data/statuscake/fdc1.status") == "off")
    $fdc_fdc1_disable = 1;
if (file_get_contents("../data/statuscake/fdc2.status") == "off")
    $fdc_fdc2_disable = 1; 
if (file_get_contents("../data/statuscake/ssv1.status") == "off")
    $sv_down .= 'sv_1'; 
if (file_get_contents("../data/statuscake/ssv2.status") == "off")
    $sv_down .= 'sv_2'; 
if (file_get_contents("../data/statuscake/ssv3.status") == "off")
    $sv_down .= 'sv_3'; 
if (file_get_contents("../data/statuscake/ssv4.status") == "off")
    $sv_down .= 'sv_4'; 
if (file_get_contents("../data/statuscake/ssv5.status") == "off")
    $sv_down .= 'sv_5'; 
if (file_get_contents("../data/statuscake/ssv6.status") == "off")
    $sv_down .= 'sv_6'; 
if (file_get_contents("../data/statuscake/ssvhttp1.status") == "off")
    $sv_down .= 'sv_1_http'; 
if (file_get_contents("../data/statuscake/ssvhttp1.status") == "off")
    $sv_down .= 'sv_2_http'; 
 //$fdc_http_disable = 1;
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

if (preg_match('/fdcenable/i', $useragent)) {    
    $fdc = "on";
    $fdc_http = "on";
    $fdc1 = "on";
    $fdc2 = "on";
}

if ($airplay != '1')
$forehlsjs = "forceHlsJSOnMacOSIpadOSSafari: true,";

date_default_timezone_set('Europe/Paris');
$c_time = time();

//if(date('D', $c_time) === 'Sun') { 
//$start = strtotime('Today 15:00');
//$end = strtotime('Today 21:00');
//if ($c_time > $start && $c_time < $end) 
//    $closed = "2"; 
//}

//if(date('D', $c_time) === 'Sat') { 
//$start = strtotime('Today 20:00');
//$end = strtotime('Today 23:30');
//if ($c_time > $start && $c_time < $end) 
//    $closed = "1"; 
//}

//if(date('D', $c_time) === 'Sat') { 
//$start = strtotime('Today 19:00');
//$end = strtotime('Today 23:30');
//if ($c_time > $start && $c_time < $end) 
//    $closed = "2"; 
//}
 
$start = strtotime('Today 21:30');
$end = strtotime('Today 21:31');
if ($c_time > $start && $c_time < $end) 
    $closed = "1"; 


$serie_id = urlencode($serie_parzed."|1");
///////////////////////////////////////
if (isset($_GET['maj']))
echo $code_saison;
////////////////////////////////

$lines = file("non_sync.txt");
$non_sync = implode("|",$lines);
$non_sync = preg_replace('/\n|\r/', '', $non_sync);
?><!doctype html>
<html class="no-js" lang="en"><head>
   <!-- set the encoding of your site -->
<meta charset="utf-8">
  <!-- set the viewport width and initial-scale on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title><?php echo $titre." Saison ".$saison_actuelle; ?></title>
  <!-- include materialize icon-->
<?php include "head.php"; ?>
</head>
<body>
<noscript><div>Javascript must be enabled for the correct page display</div></noscript>
<!-- main container of all the page elements -->
  <div id="wrapper">
  <!-- header of the page -->
<?php
include "header.php";

//------------------------------------------------------------------------  
function get_totalconn_fdc()
    {
$result = fread_url("http://50.7.244.130/stats");
preg_match('~Writing: (.*?) W~', $result, $output);
return($output[1]);	
    }
//------------------------------------------------------------------------	  
	  

//if ($dd == 4){
$img_reqsql = preg_replace('/(saison-2\.|saison-3\.|saison-4\.|saison-5\.|saison-6\.|saison-7\.|saison-8\.|saison-9\.|saison-10\.|saison-11\.|saison-12\.|saison-13\.|saison-14\.|saison-15\.|saison-16\.|saison-17\.|saison-18\.|saison-19\.|saison-20\.|saison-21\.|saison-22\.|saison-23\.|saison-24\.|saison-25\.|saison-26\.|saison-27\.|saison-28\.|saison-29\.|saison-30\.|saison-31\.|saison-32\.|saison-35\.|saison-33\.|saison-34)/', 'saison-1.', $image);
	//echo $img_reqsql;
$resultats = $pdo->query("SELECT day_hits1,day_hits2,day_hits3,day_hits4,day_hits5,day_hits6,day_hits7,day_hits8,maj_hits_lastday,all_time_hits,no,quality,has_vf,has_vostfr,force_http FROM aflam WHERE id = '" . addslashes($serie_parzed."|1") . "'");
$resultats->setFetchMode(PDO::FETCH_OBJ);
while ($resultat = $resultats->fetch()) {
        $all_time_hits    = $resultat->all_time_hits;
		$day_hits1    = $resultat->day_hits1;
		$day_hits2    = $resultat->day_hits2;
		$day_hits3    = $resultat->day_hits3;
		$day_hits4    = $resultat->day_hits4;
		$day_hits5    = $resultat->day_hits5;
		$day_hits6    = $resultat->day_hits6;
   		$day_hits7    = $resultat->day_hits7;
		$day_hits8    = $resultat->day_hits8;
		$maj_hits_lastday    = $resultat->maj_hits_lastday;
        $no    = $resultat->no;
		$quality_db    = $resultat->quality;
		$has_vf_db    = $resultat->has_vf;
		$has_vostfr_db    = $resultat->has_vostfr;
        $force_http = $resultat->force_http;
        break;
} 
if (empty($_GET['ep']) || ($_GET['ep'] > 0 && $_GET['ep'] < 10)){    
$today_date = date("Y-m-d"); //echo $today_date;
if ($today_date == $maj_hits_lastday && $_GET['ep'] < 3)
{
$all_time_hits = $all_time_hits+1;
$day_hits1 = $day_hits1+1;
$sql = "UPDATE aflam SET all_time_hits = '$all_time_hits', day_hits1 = '$day_hits1' WHERE id = '" . addslashes($serie_parzed."|1") . "'";
$pdo->exec($sql);
}
if ($today_date != $maj_hits_lastday)
{
$all_time_hits = $all_time_hits+1;
$day_hits1 = $day_hits1+1;
$sql = "UPDATE aflam SET day_hits8 = '$day_hits7', day_hits7 = '$day_hits6', day_hits6 = '$day_hits5', day_hits5 = '$day_hits4', day_hits4 = '$day_hits3', day_hits3 = '$day_hits2', day_hits2 = '$day_hits1', day_hits1 = '0', maj_hits_lastday = '$today_date', all_time_hits = '$all_time_hits' WHERE id = '" . addslashes($serie_parzed."|1") . "'";
$pdo->exec($sql);
}
	}
     
//////////////////////////////////////////////////////////////////////////	  

 if (($day_hits2+$day_hits3) > 17 || $day_hits1 > 20)	{
	$fdc = "on";
    $fdc1 = "on";
    $fdc2 = "on";
}
//////////////////////////////////////////////////////////////      
if ($fdc_all_disable == 1) {
    $fdc = "off"; 
    $fdc_http = "off";    
}
if ($fdc_http_disable == 1) {
    $fdc_http = "off";
}   
if ($fdc_fdc1_disable == 1) {
    $fdc1 = "off";
}
if ($fdc_fdc2_disable == 1) {
    $fdc2 = "off";
}      
//////////////////////////////////////////////////////////////      
if (preg_match('/tester/i', $useragent)) {
	$fdc = "off";
	$p2p = "off";
	$googleproxy = "off";
}

//////////////////////////////////////////////////////////////////////////////////////////////
	  
if (((preg_match('/(Win64|x64|Android 5|Android 6|Android 7|Android 8|Android 9|Android 10|Android 11|Android 12)/i', $useragent) && preg_match('/(Chrome\/8|Chrome\/9|firefox\/7|firefox\/8|firefox\/9|Edg\/8|Edg\/9)/i', $useragent)) || (preg_match('/Intel Mac OS X 10/i', $useragent) && preg_match('/(Version\/13|Version\/14|Version\/12)/i', $useragent)) || (preg_match('/iPad\; CPU OS 13/i', $useragent) && preg_match('/(Version\/13|Version\/14|Version\/12)/i', $useragent))) && $airplay != '1' && $worlds != "on" && $p2p == "on")
{ 
$p2pdata1 = '
<script src="../js/p2p-media-loader-core.min.js?eos"></script>
<script src="https://cdn.jsdelivr.net/npm/p2p-media-loader-hlsjs@latest/build/p2p-media-loader-hlsjs.min.js"></script>';     
$p2pdata2 = "
const config = {
  segments:{
    forwardSegmentCount:50,
  },
  loader:{
    cachedSegmentExpiration:6400000,
    cachedSegmentsCount:250,
    requiredSegmentsPriority:3,
    httpDownloadMaxPriority:6,
    httpDownloadProbability:0.05,
    httpDownloadProbabilityInterval: 2000,
    httpDownloadProbabilitySkipIfNoPeers: true,
    p2pDownloadMaxPriority: 20,
    httpFailedSegmentTimeout:1000,
    simultaneousP2PDownloads:20,
    simultaneousHttpDownloads:3,
    httpDownloadInitialTimeout: 0, 
    httpDownloadInitialTimeoutPerSegment: 0,
    httpUseRanges: true,
  }
};
var engine = new p2pml.hlsjs.Engine(config);    
var hlsJSCustomConfig = {
  loader: engine.createLoaderClass()
};";
$p2pdata3 = "hlsJSCustomConfig: hlsJSCustomConfig,";      
$p2pdata4 = "rmpContainer.addEventListener('hlsinstancecreated', function() {
    var hlsJSInstance = rmp.getHlsJSInstance();
    p2pml.hlsjs.initHlsJsPlayer(hlsJSInstance);   
    console.log(hlsJSInstance);
    }); ";     
}
//if ($ip == "---")
//{
//$resultats = $pdo->query("SELECT * FROM aflam WHERE titre = '" . addslashes($titre) . "' AND saison = '1'");
//$resultats->setFetchMode(PDO::FETCH_OBJ);
//while ($resultat = $resultats->fetch()) {
//        $docu_genre    = $resultat->docu_genre;
//        break;
//}
//if (!preg_match('/Reportage/i',$docu_genre))
//$docu_genre = $docu_genre."Reportage;";
//$sql = "UPDATE aflam SET docu_genre = '$docu_genre' WHERE titre = '" . addslashes($titre) . "' AND saison = '1'";
//$pdo->exec($sql);
//}
//
//if ($ip == "138.68.146.74")
//{
//$resultats = $pdo->query("SELECT * FROM aflam WHERE titre = '" . addslashes($titre) . "' AND saison = '1'");
//$resultats->setFetchMode(PDO::FETCH_OBJ);
//while ($resultat = $resultats->fetch()) {
//        $perso_tag    = $resultat->perso_tag;
//        break;
//}
//if (!preg_match('/animation pour adultes/i',$docu_genre)) {
//$perso_tag = $perso_tag."animation pour adultes;";
//$sql = "UPDATE aflam SET perso_tag = '$perso_tag' WHERE titre = '" . addslashes($titre) . "' AND saison = '1'";
//$pdo->exec($sql);
//}
//}
//if ($ip == "138.68.146.74") {
//$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
//$sql = "UPDATE aflam SET ba = '' WHERE id = '" . addslashes($serie_parzed."|1") . "'";
//$pdo->exec($sql);
//}      
?>


    <!-- contain main informative part of the site -->
<main id="main">
      <div class="container">

       <div class="row">
      <div class="col s8">
<?php
require_once 'Mobile_Detect.php';
$detect  = new Mobile_Detect();
$isPhone = $detect->isMobile() && !$detect->isTablet();
$isPC    = !$detect->isMobile() && !$detect->isTablet();
$tags_parsed_sizer = null;

$tags_parsed = null;

function grab_image($url,$saveto){
    $ch = curl_init ($url);
    curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
	curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
	curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0");
    curl_setopt($ch, CURLOPT_HEADER, 0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_BINARYTRANSFER,1);
    $raw=curl_exec($ch);
    curl_close ($ch);
    if(file_exists($saveto)){
        unlink($saveto);
    }
    $fp = fopen($saveto,'x');
    fwrite($fp, $raw);
    fclose($fp);
}

if (isset($_GET['nba']))
{
$nba = $_GET['nba'];
$sql = "UPDATE aflam SET ba = '$nba' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'";
$pdo->exec($sql);
}
          
if (preg_match('/rand_oui/i', $useragent))
{
$sql = "UPDATE aflam SET perso_tag = 'rand_oui' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'"; 
$pdo->exec($sql);	
}
if (preg_match('/rand_no/i', $useragent))
{
$sql = "UPDATE aflam SET perso_tag = 'rand_no' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'"; 
$pdo->exec($sql);	
}          
if (preg_match('/rand_best/i', $useragent))
{
$sql = "UPDATE aflam SET perso_tag = 'rand_oui;rand_best' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'"; 
$pdo->exec($sql);	
}
if ((preg_match('/documentaire/i', $genres_2nd_format) || preg_match('/documentaire/i', $genre_tmdb)) && !isset($docu_genre)){ 
	
$resultats = $pdo->query("SELECT * FROM aflam WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'");
$resultats->setFetchMode(PDO::FETCH_OBJ);
while ($resultat = $resultats->fetch()) {
        $docu_genre    = $resultat->docu_genre;
        break;
}	

$page = '<?php 
$docu_genre = "'.$docu_genre.'";
?>';
$data_initial = file_get_contents(basename($_SERVER["SCRIPT_FILENAME"]));
$data_final = 	$page.$data_initial;
file_put_contents($_SERVER["SCRIPT_FILENAME"], $data_final);	
}		  
		  
		  
if (isset($_GET['nt']))
{
$poster_small  = $image;
include('../SimpleImage.php');
grab_image($_GET['nt'], '../'.$poster_small);
$img   = imagecreatefromjpeg('../'.$poster_small);
$simimage = new SimpleImage();
$simimage->load('../'.$poster_small);
$simimage->resize(465,615);
$simimage->save('../'.$poster_small);
$sql = "UPDATE aflam SET poster_small = '".$poster_small."?new' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "' OR poster_small = '$image?new' LIMIT 1";
$pdo->exec($sql);
}

if (isset($_GET['np']))
{
echo $thumb_grand;
grab_image($_GET['np'], '../'.$thumb_grand);
}
		  
if (isset($_GET['npall1']))
{
echo $thumb_grand;
grab_image($_GET['npall1'], '../'.$thumb_grand);
$tmp_poster = preg_replace('/saison-1/', 'saison-2', $thumb_grand);
grab_image($_GET['npall1'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-3', $thumb_grand);
grab_image($_GET['npall1'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-4', $thumb_grand);
grab_image($_GET['npall1'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-5', $thumb_grand);
grab_image($_GET['npall1'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-6', $thumb_grand);
grab_image($_GET['npall1'], '../'.$tmp_poster);
}
if (isset($_GET['npall2']))
{
echo $thumb_grand;
$tmp_poster = preg_replace('/saison-1/', 'saison-7', $thumb_grand);
grab_image($_GET['npall2'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-8', $thumb_grand);
grab_image($_GET['npall2'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-9', $thumb_grand);
grab_image($_GET['npall2'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-10', $thumb_grand);
grab_image($_GET['npall2'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-11', $thumb_grand);
grab_image($_GET['npall2'], '../'.$tmp_poster);
$tmp_poster = preg_replace('/saison-1/', 'saison-12', $thumb_grand);
grab_image($_GET['npall2'], '../'.$tmp_poster);
}			  

  if (isset($_GET['perso_tag']))
{
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$resultats = $pdo->query("SELECT * FROM aflam WHERE id = '" . addslashes($serie_parzed."|1") . "'");
$resultats->setFetchMode(PDO::FETCH_OBJ);
while ($resultat = $resultats->fetch()) {
$perso_tag = $resultat->perso_tag;
break;
}
$newperso_tag = $_GET['perso_tag'].';'.$perso_tag;
$sql = "UPDATE aflam SET perso_tag = '".$newperso_tag."' WHERE id = '" . addslashes($serie_parzed."|1") . "'  LIMIT 1"; echo $sql;
$pdo->exec($sql);
}

if(empty($format)) $format = "N/A";
if(empty($genre_1)) $genres = "N/A";
if(empty($yearstart_serie)) $yearstart_serie = "N/A";
if(empty($yearstart_saison)) $yearstart_saison = "N/A";
if ($genre_1 == "Animation" && $pays_blank == "Japon"){
$genres_2nd_format = preg_replace('/(series|films)/', 'animes_series', $genres_2nd_format);
$genres = preg_replace('/(series|films)/', 'animes_series', $genres);
}
else{
$genres_2nd_format = preg_replace('/(series|films)/', 'series', $genres_2nd_format);
$genres = preg_replace('/(series|films)/', 'series', $genres);
}
  
	  
		  
		  
if (!empty($actors_blank))
{
$t = 1;	
unset($actors) ; 
if (preg_match('/\|/i',$actors_blank)) 
    $separator = "|"; else
    $separator = ";";      
foreach (explode($separator, $actors_blank) as $val) {
	if (!empty($val))
	{
	$t++;	
	$actors .= "<a href=\"../series.php?p=$val\">$val</a>, ";
	if ($t == 3 && ($isPhone)) break;	
	}
}

}          
$actors_li = '<li>
              <span class="name">Avec :</span>
              <span class="descr truncate">'.$actors.'</span>
             </li>';
if(empty($actors)) $actors_li = "";
if (preg_match('/><\/a>/i', $actors)) $actors_li = "";
/////////////////////////////////////////
if (!empty($genre_tmdb))
{
$genres = null;
$genres_2nd_format = null;
foreach (explode(';', $genre_tmdb) as $val) {
	if (!empty($val))
	{
	$genres .= "<a href=\"../series.php?g=$val\">$val</a>, ";
	$genres_2nd_format .= "<li><a href=\"../series.php?g=$val\" rel=\"nofollow\">$val</a></li>";
	}
}
$genres = substr($genres, 0, -2);
}
			  
/////////////////////////////////////////
if (!empty($tags))
{
if (preg_match('/\|/i',$tags)) 
    $separator = "|"; else
    $separator = ";";    
foreach (explode($separator, $tags) as $val) {
	if (!empty($val))
	{
    $val = preg_replace('/ et /', ' - ', $val);        
	$tags_parsed .= "<a style=\"color:#D3D3D3;font-size:12px;\" href=\"../series.php?t=$val\">#$val</a> - ";
	}
}

}          
if (!empty($tmdb_keywords))
{
foreach (explode(';', $tmdb_keywords) as $val) {
	if (!empty($val))
	{
	$tags_parsed .= "<a style=\"color:#D3D3D3;font-size:12px;\" href=\"../series.php?t=$val\">#$val</a> - ";
	}
}

}
if (!empty($tags_parsed)){       
$tags_parsed = substr($tags_parsed, 0, -3);
$tags_li = '<div align="center" style="text-align:center;color:#CDCDCD;font-size:12px;"> Tags : '.$tags_parsed.'</div>';	
$tags_li = stripslashes($tags_li);  
    }   
/////////////////////////////////////////
if (!empty($genres_anime))
{
$actors_li = null;
$genres = null;
$genres_2nd_format = null;
foreach (explode(';', $genres_anime) as $val) {
	if (!empty($val) && $val != "Animation")
	{
	$genres .= "<a href=\"../animes_series.php?g=$val\">$val</a>, ";
	$genres_2nd_format .= "<li><a href=\"../animes_series.php?g=$val\" rel=\"nofollow\">$val</a></li>";
	}
}
$genres = substr($genres, 0, -2);
}
/////////////////////////////////////////
if (!empty($themes_anime))
{
foreach (explode(';', $themes_anime) as $val) {
	if (!empty($val))
	$themes_tmp .= "<a href=\"../animes_series.php?t=$val\">$val</a>, ";
}
$themes_tmp = substr($themes_tmp, 0, -2);
$theme_li = '<li>
			<span class="name">Thèmes :</span>
            <span class="descr">'.$themes_tmp.'</span>
			</li>';
}
//////////////////////////////////////////
if ((preg_match('/documentaire/i', $genres_2nd_format) || preg_match('/documentaire/i', $genre_tmdb)) && !empty($docu_genre)){
$genres = "";
$genres_2nd_format = "";	
$genre_label = "Thème :";	
foreach (explode(';', $docu_genre) as $val) { 
	if (!empty($val)) 
	{
		$t++; 
		$genres .= "<a href=\"../series_docu.php?l=$val\">$val</a>, "; 
		$genres_2nd_format .= "<li><a href=\"../series_docu.php?l=$val\">$val</a></li> "; 
	} 
	if ($t == 4 && $isPhone) break;
}
$genres = substr($genres, 0, -2);
$genres    = str_replace(array('l=Emission TV et Téléréalité','l=Nature','l=Animaux','l=Crime','l=Mystère','l=Reportage','l=Investigations','l=Sciences et Technologies','l=Guerre','l=Astronomie','l=Politique','l=Histoire','l=Mythologie','l=Archéologie','l=Sport','l=Auto - Moto','l=Santé','l=Cuisine','l=Cinéma et TV'),array('l=110','l=120','l=130','l=140','l=150','l=170','l=180','l=190','l=200','l=210','l=220','l=230','l=240','l=250','l=260','l=270','l=280','l=290','l=380'), $genres);
$genres_2nd_format    = str_replace(array('l=Emission TV et Téléréalité','l=Nature','l=Animaux','l=Crime','l=Mystère','l=Reportage','l=Investigations','l=Sciences et Technologies','l=Guerre','l=Astronomie','l=Politique','l=Histoire','l=Mythologie','l=Archéologie','l=Sport','l=Auto - Moto','l=Santé','l=Cuisine','l=Cinéma et TV'),array('l=110','l=120','l=130','l=140','l=150','l=170','l=180','l=190','l=200','l=210','l=220','l=230','l=240','l=250','l=260','l=270','l=280','l=290','l=380'), $genres_2nd_format);	
	 	
 }		  
/////////////////////////////////////////
if (!empty($studio_animation))
{
$studio_animation_li = '<li>
			<span class="name">Studio :</span>
            <span class="descr"><a href="../animes_series.php?st='.$studio_animation.'">'.$studio_animation.'</a></span>
			</li>';
}
/////////////////////////////////////////
if (!empty($originalTitle_anime))
{
$originalTitle_anime_li = '<li>
			<span class="name">Titre Original :</span>
            <span class="descr">'.$originalTitle_anime.'</span>
			</li>';
}
/////////////////////////////////////////
if (!empty($public_averti_anime))
{
if ($public_averti_anime == "2")
$public_averti_anime_test = "Non (Tout  public)";
if ($public_averti_anime == "3")
$public_averti_anime_test = "Oui (nudité)";
if ($public_averti_anime == "4")
$public_averti_anime_test = "Oui (violence)";
if ($public_averti_anime == "5")
$public_averti_anime_test = "Oui (violence modérée)";
if ($public_averti_anime == "6")
$public_averti_anime_test = "Oui (nudité modérée)";
$public_averti_anime_li = '<li>
			<span class="name">Avertissement  :</span>
            <span class="descr"><a href="../animes_series.php?cl='.$public_averti_anime.'">'.$public_averti_anime_test.'</a></span>
			</li>';
}
/////////////////////////////////////////////////////////////////////
$ext_url = "-streaming";
if ($nomfolder == "game-of-thrones-saison-7")
$ext_url = "";
/////////////////////////////////////////////////////////////////////
$current_page = urlencode('http://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']);
//////////////////////////////// determine ce que utilisateur a le droit de voir
if (!empty($date_last_paid)) {
    $date_expiration = new DateTime($date_last_paid);
    $date_expiration->add(new DateInterval('P31D'));
    $date_expiration = $date_expiration->format('Y-m-d'); 

    $today     = date("Y-m-d");
    $today_dt  = strtotime($today);
    $expire_dt = strtotime($date_expiration);

    if ($expire_dt <= $today_dt)
        $expired = 'oui';
    else if ($expire_dt > $today_dt)
        $expired = 'non';
}

$date_premption = new DateTime($date_last_paid);
$date_premption->add(new DateInterval('P45D'));
$date_premption = $date_premption->format('Y-m-d');   
$premption_dt = strtotime($date_premption);
if ($watched <= 3 && $premption_dt > $today_dt)          
 $expired = 'non';     

//if ($last_code == "")
//$expired = 'non'; 
///////////////////////////////////////////////////////////////////
$conteur = "1";
$stmt = $pdo->prepare("SELECT saison,nompage FROM aflam WHERE type LIKE 'saison' AND titre LIKE :titre AND saison NOT LIKE ".$saison_actuelle." ORDER BY saison ASC LIMIT 0, 20");
$stmt->bindParam(":titre", $titre);
$stmt->execute();
 while($row = $stmt->fetch())  {
	 $conteur++;
	 $saison = $row['saison'];
	  $url = $row['nompage'];
	  $saisons_div .= '<a href="'.$url.'" class="collection-item">Saison '.$saison.'</a>';

     	}

	if ($conteur != "1")
		$saisons_div_norm =  '     <div class="head">
          <h1 style="font-size: 14px;">Les Autres Saisons :</h1>
        </div> <div class="collection">'.$saisons_div.'</div>';
	if ($conteur != "1")
	$saisons_div_mobile =  '     <div class="head hide-on-large-only">
          <h1 style="font-size: 13px;">Les Autres Saisons :</h1>
        </div> <div class="collection hide-on-large-only">'.$saisons_div.'</div>';

////////////////////////////////////////////////////////////////////
if (file_exists('links/'.$nomfolder.'/titres.txt'))
$episodes_titre = file('links/'.$nomfolder.'/titres.txt');
else
$episodes_titre = unserialize(base64_decode($episodes_titre));
$episodes_titre_vo = unserialize(base64_decode($episodes_titre_vo));
$episodes_synop = unserialize(base64_decode($episodes_synop));
/////////////////////////////////////
$file = 'links/'.$nomfolder.'/vo.txt';
if (file_exists($file))
$array_vo_ep = file($file);
else
$array_vo_ep = array();
$total_vo_ep = count($array_vo_ep)-1;
$file = 'links/'.$nomfolder.'/vf.txt';
if (file_exists($file))
$array_vf_ep = file($file);
else
$array_vf_ep = array();
$total_vf_ep = count($array_vf_ep)-1;
$total_ep_links = $total_vo_ep;
if ($total_vf_ep > $total_vo_ep)
$total_ep_links = $total_vf_ep;        
/////////////////////////////////////////////////////////////////
if (isset($_GET['ep']))
$ep = $_GET['ep'];
else
$ep = 1;

if (isset($_GET['ver']))
$ver = $_GET['ver'];
else
{
	if ($array_vf_ep[1] != "")
	$ver = "vf";
	else
	$ver = "vo";
}
/////////////////////////////////////
if (file_exists('links/'.$nomfolder.'/vf.txt'))
$filetime = filemtime('links/'.$nomfolder.'/vf.txt');
else { $filetime = null;}
$timenow = time();
if ((($timenow - $filetime) < 1800) || (!empty($_GET['majadd'])))
{
 for ($i=1 ; $i < $total_vf_ep+1 ; $i++)
 {
$urlapi = trim($array_vf_ep[$i]);
$urlapi = base64url_encode($urlapi);
$api = fread_cached("http://46.166.139.181/check-series.php?id=".$urlapi."&e"); 	 
if (!preg_match('/ok/i',$api))
fread_check('http://188.214.128.67/add-link-vf.php?id='.$urlapi);
 }
}
 /////////////////////////////////////
if (file_exists('links/'.$nomfolder.'/vo.txt'))
$filetime = filemtime('links/'.$nomfolder.'/vo.txt');
else { $filetime = null;}
$timenow = time();
if ((($timenow - $filetime) < 1800) || (!empty($_GET['majadd'])))
{
  for ($i=1 ; $i < $total_vo_ep+1 ; $i++)
 {
$urlapi = trim($array_vo_ep[$i]);
$urlapi = base64url_encode($urlapi);
$api = fread_cached("http://46.166.139.181/check-series.php?id=".$urlapi."&o"); 		 
if (!preg_match('/ok/i',$api)) 
fread_check('http://188.214.128.67/add-link-vo.php?id='.$urlapi);
 }
}
 //////////////////////////////////////
 if ($ver == "vf")
 $link_ep_encours = $array_vf_ep[$ep];
 else
 $link_ep_encours = $array_vo_ep[$ep];
 ////////////////////////////////////////
$urlapi = trim($link_ep_encours);
$urlapi = base64url_encode($urlapi);
$api = fread_cached("http://185.132.178.10/check-series.php?id=".$urlapi."&o"); 			  
$api = fread_cached("http://46.166.139.181/check-series.php?id=".$urlapi."&o"); 		  
$api = fread_cached("http://46.166.142.176/check-series.php?id=".$urlapi);
////////////////////////////////////////////////////////////////////////////////////////		  
$servers = array('sv_1','sv_2','sv_3','sv_4','sv_5','sv_6');
$aleatoire = rand('0', count($servers) - 1);
$sql_requete = "SELECT server FROM sv_series WHERE video LIKE 'layer1-".md5($urlapi)."'";
$stmt = $pdo->prepare($sql_requete);
$stmt->execute();
$row = $stmt->fetch();
$sv_tmp_hls = $row["server"];

if (!empty($sv_tmp_hls)){
$sv = $sv_tmp_hls;
}

else
{
$sv = $servers[$aleatoire];
$video = "layer1-".md5($urlapi);
$sql = "INSERT INTO sv_series(video, server, maj) VALUES('".$video."', '".$sv."', '1')";
$pdo->exec($sql);
}

////////////////////////////////////////////////////////////////////////////////////////
$servers = array('sv_1_','sv_2_');
$aleatoire = rand('0', count($servers) - 1);
$sql_requete = "SELECT server,maj FROM sv_series_http WHERE video LIKE 'http-".md5($urlapi)."'";
$stmt = $pdo->prepare($sql_requete);
$stmt->execute();
$row = $stmt->fetch();
$sv_tmp_http = $row["server"];
$maj = $row["maj"];
		  
if (!empty($sv_tmp_http) && $maj == "2"){
$sv_http = $sv_tmp_http;
}
		  
else if (!empty($sv_tmp_http) && $maj != "2"){
$sv_tmp = $servers[$aleatoire];
if ($sv_tmp_http == "sv_3_") {
$video = "http-".md5($urlapi);
$sql = "UPDATE sv_series_http SET server = '$sv_tmp', maj = '2'  WHERE video = '$video' LIMIT 2";
$pdo->exec($sql);
$sv_http = "sv_3_";	
 }	
else {
$sv_http = $sv_tmp_http;
$video = "http-".md5($urlapi);	
$sql = "UPDATE sv_series_http SET maj = '2'  WHERE video = '$video' LIMIT 2";
$pdo->exec($sql);	
 }	
}	
		  
else
{
$sv_http = $servers[$aleatoire];
$video = "http-".md5($urlapi);
$sql = "INSERT INTO sv_series_http(video, server, maj) VALUES('".$video."', '".$sv_http."', '2')";
$pdo->exec($sql);
}
	  
if (isset($_GET['sv']))
echo md5($urlapi);		  
////////////////////////////////////////////////////////////////////
$ep_padded = sprintf("%02d", $ep);
$saison_padded = sprintf("%02d", $saison_actuelle);
if ($ver == "vf")
$version = "VF";
if ($ver == "vo")
$version = "VOSTFR";
$titre_ep = $episodes_titre[$ep-1];
if (empty($titre_ep))
$titre_ep = $episodes_titre_vo[$ep-1];
$titre_ep = preg_replace('/\"/', '', $titre_ep);
$titre_ep = trim($titre_ep);
if (empty($titre_ep)) {
$twodots = "";
$ep_label = "Épisode ";
$titre_ep = "Épisode $ep_padded";	
}
else{
$twodots = ":";
$ep_label = "Ép. ";
}

//////////////////////////////////////	  
echo "<script>
	function getCookie(cname) {
    var name = cname + \"=\";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return \"\";
}
	
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = \"expires=\"+d.toUTCString();
    document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";
}
function delete_cookie( name ) {
  document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/';
}	
</script>";
		  
if (!empty($_COOKIE[md5($titre.$saison_actuelle)]))	
$lastep = $_COOKIE[md5($titre.$saison_actuelle)];
		  
function bookmark($ep, $lastep)
{
if ($ep == $lastep)
return '<i class="fa fa-bookmark right tooltipped" data-position="top" data-delay="50" data-tooltip="Le dernier épisode que vous avez regardé" aria-hidden="true" style="position:absolute;top:0;right:0;"></i>';
}
//////////////////////////////////////ok-smil-ok-hd-ok-smil-ok-md-
if ($worlds == "on")
$sv_http = "wopard.vodi.to/series";
          
if ($fdc_http == "on")
$sv_http = "colorado.vodi.to/series";    
          
if ($nfo_http == "on")
$sv_http = "texas.vodi.to/series"; 
//////////////////////////////////////////////////////////////////////////////////

if (preg_match("/sv_1/", $sv_down) && $sv == "sv_1") {
$sv_http = "colorado.vodi.to/films";
$down = 1;    
}    
if (preg_match("/sv_2/", $sv_down) && $sv == "sv_2") {
$sv_http = "colorado.vodi.to/films";
$down = 1;    
}    
if (preg_match("/sv_3/", $sv_down) && $sv == "sv_3") {
$sv_http = "colorado.vodi.to/films";
$down = 1;    
}    
if (preg_match("/sv_4/", $sv_down) && $sv == "sv_4") {
$sv_http = "colorado.vodi.to/films";
$down = 1;    
}    
if (preg_match("/sv_5/", $sv_down) && $sv == "sv_5") {
$sv_http = "colorado.vodi.to/films";
$down = 1;    
}    
if (preg_match("/sv_6/", $sv_down) && $sv == "sv_6") {
$sv_http = "colorado.vodi.to/films";
$down = 1;    
} 
if (preg_match("/sv_1_http/", $sv_down) && $sv == "sv_1_") {
$sv_http = "colorado.vodi.to/films";  
if ($fdc_http_disable == 1)
$sv_http = "wopard.vodi.to/series";    
}  
if (preg_match("/sv_2_http/", $sv_down) && $sv == "sv_2_") {
$sv_http = "colorado.vodi.to/films";  
if ($fdc_http_disable == 1)
$sv_http = "wopard.vodi.to/series";        
}       
///////////////////////////////////////////          
if ($fdc_http_disable == 1 && $down == 1) {
$sv_http = "wopard.vodi.to/series";
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////          
          
if (preg_match('/iphone|ipad/i', $useragent) && trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr-fr") 
$exept_f12 = 1;
if (preg_match('/playstation|tizen/i', $useragent) && trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr-FR") 
$exept_f12 = 1;    
if (preg_match('/Netcast/i', $useragent) && trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr-FR,fr;q=0.8,en-US;q=0.6,en;q=0.4") 
$exept_f12 = 1; 
if (preg_match('/Android 10/i', $useragent) && trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7") 
$exept_f12 = 1;     
if (preg_match('/ OMI/4\./i', $useragent) && (trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr-FR,en-US;q=0.8,en;q=0.6" || trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr-FR,en-US;q=0.9,en;q=0.8" || trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr,en;q=0.8" || trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr,en;q=0.9"  || trim($_SERVER['HTTP_ACCEPT_LANGUAGE']) == "fr,en;q=0.6")) 
$exept_f12 = 1;   
          
//if (($viewsrc > 0 || $devtool > 1 || $f12 > 1 || ($devtool > 0 && $f12 > 0) || ($devtool > 0 && $last_code == "") || ($f12 > 0 && $last_code == "")) && $exept_f12 != "1") {
if (($viewsrc > 0 || $devtool > 0 || $f12 > 0) && $exept_f12 != "1") {    
$servers = array('cdn.vodi.to/series','cdn-x.vodi.to/series');
$aleatoire = rand(0, 1);
$sv_http = $servers[$aleatoire];
$force_http = "1"; 
}	
          
if (preg_match('/f12/i', $useragent)) {    
$servers = array('cdn.vodi.to/series','cdn-x.vodi.to/series');
$aleatoire = rand(0, 1);
$sv_http = $servers[$aleatoire];
$force_http = "1";  
}           
  
if ($fdc == "on" || $nfo == "on"){

switch ($sv) {
    case 'sv_1':
        $arg = "?s=s1s1";
        break;
	case 'sv_2':
        $arg = "?s=s2s2";
        break;	
	case 'sv_3':
        $arg = "?s=s3s3";
        break;	
	case 'sv_4':
        $arg = "?s=s4s4";
        break;	
	case 'sv_5':
        $arg = "?s=s5s5";
        break;
	case 'sv_6':
        $arg = "?s=s6s6";
        break;		
}
}
			  
////////////////////////////////////////////////////////////////////////////////////////////		  
if (preg_match('/ok-md-ok-hd/i',$api))
  {
	$hls_nonssl = 'http://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
    $hls = 'https://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
	$http = 'https://'.$sv_http.'/mp4/'.$urlapi.'-hd.mp4';
	$http_sd = 'https://'.$sv_http.'/mp4/'.$urlapi.'-md.mp4';  
  }
else if (preg_match('/ok-md/i',$api))
  {
	$hls_nonssl = 'http://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
    $hls = 'https://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
	$http = 'https://'.$sv_http.'/mp4/'.$urlapi.'-md.mp4';
	$http_sd = 'https://'.$sv_http.'/mp4/'.$urlapi.'-md.mp4'; 
  }
else if (preg_match('/ok-hd/i',$api))
  {
	$hls_nonssl = 'http://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
    $hls = 'https://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
	$http = 'https://'.$sv_http.'/mp4/'.$urlapi.'-hd.mp4';
	$http_sd = 'https://'.$sv_http.'/mp4/'.$urlapi.'-hd.mp4'; 
  }
else if (!preg_match('/dispo/i',$api))
  {
	$hls_nonssl = 'http://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
    $hls = 'https://'.$sv.'/s/smil:'.$urlapi.'.smil/playlist.m3u8';
	$http = 'https://'.$sv_http.'/mp4/'.$urlapi.'-hd.mp4';
	$http_sd = 'https://'.$sv_http.'/mp4/'.$urlapi.'-hd.mp4';   
  }
		  
if (preg_match('/repacked/i',$api))
  {
    
	$http 	 = preg_replace('/\.mp4/', '-repack.mp4', $http); 	 
	$http_sd = preg_replace('/\.mp4/', '-repack.mp4', $http_sd); 
  }
	  		    
if (isset($_GET['sv']))
	echo $http;		  
//////////////////////////////////////////////////////////////////////////////////////////////
          
if (preg_match('/Freebox|Wii|Viera/i', $useragent) ) {
	$hls = $hls_nonssl;
	$http = preg_replace('/https/', 'http', $http);
	$http_sd = preg_replace('/https/', 'http', $http_sd);
}
		  
if ($googleproxy == "on")
	$hls = "https://www.eos.to/red.php?l=".urlencode($hls);	

//////////////////////////////////////////////////////////////////////////////////////////////          
          
$hls    = str_replace(array('sv_1','sv_2','sv_3','sv_4','sv_5','sv_6'),array('ps1582.vodi.to','vf2856.vodi.to','ur3124.vodi.to','nr4496.vodi.to','qp5911.vodi.to','az6774.vodi.to'), $hls);
$http    = str_replace(array('sv_1_','sv_2_',),array('ht1965.vodi.to','ht2879.vodi.to'), $http);
$http_sd  = str_replace(array('sv_1_','sv_2_'),array('ht1965.vodi.to','ht2879.vodi.to'), $http_sd);

if ($fdc == "on" && $fdc1 == "on" && ($sv == "sv_1" || $sv == "sv_2" || $sv == "sv_3"))
	$hls = "https://www.eos.to/flo.php?l=".urlencode($hls.$arg);
else if ($fdc == "on" && $fdc2 == "on" && ($sv == "sv_4" || $sv == "sv_5" || $sv == "sv_6"))
	$hls = "https://www.eos.to/cal.php?l=".urlencode($hls.$arg);    
          
//////////////////////////////////////////////////////////////////////////////////////////////
    
if ($nfo == "on")
	$hls = "https://www.eos.to/nfo.php?l=".urlencode($hls.$arg);    
          
//////////////////////////////////////////////////////////////////////////////////////////////
		  
$rmp_version = "rmplater/rmp-5.8.6.js";
if  (preg_match('/(Android 1[0-4]|Android [7-9]|Edg\/[7-9]|Firefox\/[7-9]|Chrome\/[7-9])/i',$useragent))         
$rmp_version = "../rmp/rmp.min.js?w";          
if  (preg_match('/(CPU OS 9|CPU OS 10|CPU OS 11|CPU OS 12|Viera|netcast|Chrome\/[3-5])/i',$useragent))
$rmp_version = "rmplater/rmp-5.7.0.js";	 			 
	
if (($isPhone)) 
$hidemodule = "hideModule: {
  volume: true,
},";			  

		  
///===============================================================================================================================================
if ($down == "1" || $force_http == "1")  {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
    $rmp        = "oui"; 
	if (preg_match('/ok-hd/i',$api))
	$source_rmp = "var src = { mp4: [  '$http', '$http_sd' ], };";
	else
	$source_rmp = "var src = { mp4: '$http_sd', };";
}		  
///=============================================================================================================================================== 
else if (preg_match('/tizen 3|tizen 4|tizen 5|netcast/i', $useragent) && !preg_match('/Chrome\/2/i', $useragent) && !preg_match('/Chrome\/3/i', $useragent) && $nf_sv != "1") {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
    $rmp        = "oui";
	if (preg_match('/ok-hd/i',$api))
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd', '$http' ], };";
	 		else
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd' ], };";
	//if ($googleproxy == "on")
	//header('Referrer-Policy: no-referrer'); 
	    }	
          
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// echo $sv;
 else if (preg_match('/tizen 3|tizen 4|tizen 5|OMI|SRAF|SMART-TV; X11|Netcast|Viera/i', $useragent) && !preg_match('/Chrome\/2/i', $useragent))  {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
    $rmp        = "oui"; //echo $chromecast_quality;
	if (preg_match('/ok-hd/i',$api) && $chromecast_quality == 'HD')
	$source_rmp = "var src = { mp4: [  '$http', '$http_sd' ], };";
	else
	$source_rmp = "var src = { mp4: '$http_sd', };";
    }	  
///===============================================================================================================================================
else if (preg_match('/(SRAF|SMART-TV|Presto|Large Screen Safari|MSIE 9.0; Windows Phone OS 7\.5|HbbTV|SmartTV|freebox|PLAYSTATION 3|Tizen|SmartTv|NetCast|Wii|ezcast|JZO54K|KOT49H|JDQ39|IMM76D|JRO03H|Viera)/i', $useragent)) {
        $tv        = "oui";
		echo '
	<link rel="stylesheet" type="text/css" href="../css/mediaelementplayer.min.css?s">
	<script src="../js/mediaelement-and-player.min.js"></script>
	';
        }		  
///===============================================================================================================================================
	
else if ($airplay == "1" && preg_match('/Macintosh|iPad|iphone/i', $useragent))  {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
    $rmp        = "oui"; //echo $chromecast_quality;
	if (preg_match('/ok-hd/i',$api) && $chromecast_quality == 'HD')
	$source_rmp = "var src = { mp4: [  '$http', '$http_sd' ], };";
	else
	$source_rmp = "var src = { mp4: '$http_sd', };";

        echo '
    <script>
var seen = "' . $serie_id . '";
setTimeout(function(){
setCookie("'.md5($titre.$saison_actuelle).'", '.$ep.', 30);
$(document).ready(function(){
    $.get("../add_lastseen.php?movie=" + seen,true);
});
}, 360000);
</script>';
}
///===============================================================================================================================================		
else if ((preg_match('/(NT 6\.0|NT 5\.2|NT 5\.1|trident)/i', $useragent)) ||
	(preg_match('/(chrome\/4|Chrome\/3|Chrome\/2)/i', $useragent) && preg_match('/(windows|Macintosh)/i', $useragent)) ||
	(preg_match('/(CPU OS 5_|Android 4)/i', $useragent))) {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
    $rmp        = "oui";
	if (preg_match('/ok-hd/i',$api))
	$source_rmp = "var src = { mp4: [  '$http', '$http_sd' ], };";
	else
	$source_rmp = "var src = { mp4: '$http_sd', };";
    }
///===============================================================================================================================================
else if (preg_match('/iphone|ipad/i', $useragent)) {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
    $rmp        = "oui";
	if (preg_match('/ok-hd/i',$api))
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd', '$http' ], };";
	 		else
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd' ], };";
	//if ($googleproxy == "on")
	//header('Referrer-Policy: no-referrer'); 
	    }	
///===============================================================================================================================================
 else if ((preg_match('/(CrOS|android|chrome|firefox|playstation|Macintosh|edg)/i', $useragent)) || ((preg_match('/rv\:11.0/i', $useragent)) && (preg_match('/(NT 10|NT 6\.2|NT 6\.3)/i', $useragent)))) {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
            $rmp = "oui";
			if (preg_match('/ok-hd/i',$api))
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd', '$http' ], };";
	 		else
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd' ], };";
	//if ($googleproxy == "on")
	//header('Referrer-Policy: no-referrer'); 
        }
///===============================================================================================================================================
 else {
    echo '<script src="'.$rmp_version.'"></script>'.$p2pdata1;
            $rmp = "oui";
			if (preg_match('/ok-hd/i',$api))
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd', '$http' ], };";
	 		else
			$source_rmp = "var src = { hls:'$hls', mp4: [  '$http_sd' ], };";
	//if ($googleproxy == "on")
	//header('Referrer-Policy: no-referrer'); 
        }		  

///===============================================================================================================================================
$source_jw ='playlist: [{
	   		image: "../'.$thumb_grand.'",
			description: "'.$titre_ep.'",
			title: "Saison '.$saison_padded.' Épisode '.$ep_padded.' - '.$version.' ",
            sources: '.$source_jw.'
}],';

if ($source_rmp == "var src = { mp4: [  '$http', '$http_sd' ], };") 


$source_rmp = $source_rmp."
		var labels = {
  bitrates: {
    renditions: ['Qualité HD', 'Qualité SD']
  },
  hint: {
    play: 'Lire',
    pause: 'Pause',
    enterFullscreen: 'Plein écran',
    exitFullscreen: 'Quitter le mode plein écran',
    quickRewind: 'Retour rapide',
    quickForward: 'Avance rapide',
    quality: 'Qualité',
    volume: 'Volume',
    quickUnmute: 'Activer le son',
    captions: 'Sous-titres',
    cast: 'Caster',
    airplay: 'AirPlay',
    off: 'Désactivé'
  },
  captions: {
    off: 'Arrêt'
  },
  error: {
    customErrorMessage: 'Erreur de lecture ! rechargez la page, si le problème persiste, merci de contacter le support, verifiez aussi la vitesse de votre connexion.',
    noSupportMessage: 'No playback support.',
    noSupportDownload: '',
    noSupportInstallChrome: 'Votre navigateur n\'est pas compatible, Utilisez la dernière version du navigateur Google Chrome, ça pourrait régler le problème'
  }
};";

		
	else
$source_rmp = $source_rmp."
		var labels = {
  bitrates: {
    renditions: ['Qualité SD', 'Qualité HD']
  },
  hint: {
    play: 'Lire',
    pause: 'Pause',
    enterFullscreen: 'Plein écran',
    exitFullscreen: 'Quitter le mode plein écran',
    quickRewind: 'Retour rapide',
    quickForward: 'Avance rapide',
    quality: 'Qualité',
    volume: 'Volume',
    quickUnmute: 'Activer le son',
    captions: 'Sous-titres',
    cast: 'Caster',
    airplay: 'AirPlay',
    off: 'Désactivé'
  },
  captions: {
    off: 'Arrêt'
  },
  error: {
    customErrorMessage: 'Erreur de lecture ! rechargez la page, si le problème persiste, merci de contacter le support, verifiez aussi la vitesse de votre connexion.',
	noSupportMessage: 'No playback support.',
    noSupportDownload: '',
    noSupportInstallChrome: 'Votre navigateur n\'est pas compatible, Utilisez la dernière version du navigateur Google Chrome, ça pourrait régler le problème'
  }
};";

 ////////////////////////////////////////////////////////////////////////////////////////////////////////
  if( ((preg_match('/ok/i',$api))  || (!preg_match('/dispo/i',$api))) && !preg_match('/corompu/i', $api))
	 {
		  if (($ver == "vo") && (strlen($array_vf_ep[$ep])) > 5) {
		   $vovf_bouton = '<div class="div-holder hide-on-small-only" style="margin-top: 0">
          <div class="row">
             <div class="col l12 m12 s12">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="Ajouter ce film à votre liste de favoris" href="'.$nomfolder.''.$ext_url.'.php?ep='.$ep.'&ver=vf"><i class="fa fa-arrow-up left" aria-hidden="true"></i><i class="fa fa-arrow-up right" aria-hidden="true"></i>Regarder cet épisode en VF</a>
			  </div>
          </div>
        </div> ';
		   $vovf_bouton_mobile = '<div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.$ep.'&ver=vf" class="btn waves-effect waves-light"><i class="fa fa-arrow-up left" aria-hidden="true"></i><i class="fa fa-arrow-up right" aria-hidden="true"></i>Regarder cet épisode en VF</a>
            </div>';
		  }
		  if (($ver == "vf") && (strlen($array_vo_ep[$ep])) > 5)
		  {
		   $vovf_bouton = '<div class="div-holder hide-on-small-only" style="margin-top: 0">
          <div class="row">
             <div class="col l12 m12 s12">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="Ajouter ce film à votre liste de favoris" href="'.$nomfolder.''.$ext_url.'.php?ep='.$ep.'&ver=vo"><i class="fa fa-arrow-up left" aria-hidden="true"></i><i class="fa fa-arrow-up right" aria-hidden="true"></i>Regarder cet épisode en VOSTFR</a>
			  </div>
          </div>
        </div>
            ';
			$vovf_bouton_mobile = '<div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.$ep.'&ver=vo" class="btn waves-effect waves-light"><i class="fa fa-arrow-up left" aria-hidden="true"></i><i class="fa fa-arrow-up right" aria-hidden="true"></i>Regarder cet épisode en VOSTFR</a>
            </div>';
		  }
////////////////////////////////////
	   if (($ver == "vo") && (strlen($array_vo_ep[($ep-1)]) > 5)) {
		   $prev_bouton = '<div class="col l6 m6 s12">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="épisode précédent" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep-1).'&ver=vo"><i class="fa fa-fast-backward left" aria-hidden="true"></i>épisode précédent</a>
			  </div>';
		   $prev_bouton_mobile = ' <div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep-1).'&ver=vo" class="btn waves-effect waves-light"><i class="fa fa-fast-backward right" aria-hidden="true"></i>épisode précédent</a>
            </div>';
		  }
	   if (($ver == "vf") && (strlen($array_vf_ep[($ep-1)]) > 5)) {
		   $prev_bouton = '<div class="col l6 m6 s12">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="épisode précédent" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep-1).'&ver=vf"><i class="fa fa-fast-backward left" aria-hidden="true"></i>épisode précédent</a>
			  </div>';
		   $prev_bouton_mobile = ' <div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep-1).'&ver=vf" class="btn waves-effect waves-light"><i class="fa fa-fast-backward right" aria-hidden="true"></i>épisode précédent</a>
            </div>';
		  }
////////////////////////////////////////////////////////////
		////////////////////////////////////
	   if (($ver == "vo") && (strlen($array_vo_ep[($ep+1)]) > 5)) {
		   $next_bouton = '<div class="col l6 m6 s12" style="position:absolute;right:-20px;">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="épisode suivant" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vo"><i class="fa fa-fast-forward right" aria-hidden="true"></i> épisode suivant</a>
			  </div>';
		   $next_bouton_mobile = '  <div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vo" class="btn waves-effect waves-light"><i class="fa fa-fast-forward right" aria-hidden="true"></i>épisode suivant</a>
            </div>';

		  }
		 ///////////////////////////////////////////////////////////////////////// si vo suivant indispo
		 	   if (($ver == "vo") && (strlen($array_vo_ep[($ep+1)]) < 5) && (strlen($array_vf_ep[($ep+1)]) > 5)) {
		   $next_bouton = '<div class="col l6 m6 s12" style="position:absolute;right:-20px;">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="épisode suivant" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vf"><i class="fa fa-fast-forward right" aria-hidden="true"></i> épisode suivant</a>
			  </div>';
		   $next_bouton_mobile = '  <div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vf" class="btn waves-effect waves-light"><i class="fa fa-fast-forward right" aria-hidden="true"></i>épisode suivant</a>
            </div>';
		  }
		 ////////////////////////////////////////////////////////////////////////////////////////////////////
	   if (($ver == "vf") && (strlen($array_vf_ep[($ep+1)]) > 5)) {
		   $next_bouton = '<div class="col l6 m6 s12" style="position:absolute;right:-20px;">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="épisode suivant" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vf"><i class="fa fa-fast-forward right" aria-hidden="true"></i> épisode suivant</a>
			  </div>';
		   $next_bouton_mobile = '  <div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vf" class="btn waves-effect waves-light"><i class="fa fa-fast-forward right" aria-hidden="true"></i>épisode suivant</a>
            </div>';
		  }
		 ///////////////////////////////////////////////////////////////////////// si vf suivant indispo
		 	   if (($ver == "vf") && (strlen($array_vf_ep[($ep+1)]) < 5) && (strlen($array_vo_ep[($ep+1)]) > 5)) {
		   $next_bouton = '<div class="col l6 m6 s12" style="position:absolute;right:-20px;">
                 <a class="btn" style="width:100%;text-align:center;height:40px;font-size: 13px; line-height: 40px;" title="épisode suivant" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vo"><i class="fa fa-fast-forward right" aria-hidden="true"></i> épisode suivant</a>
			  </div>';
		   $next_bouton_mobile = '  <div class="col l4 m4 s12" style="padding: 5px 0;">
                <a style="width:100%; border-radius:0px;" href="'.$nomfolder.''.$ext_url.'.php?ep='.($ep+1).'&ver=vo" class="btn waves-effect waves-light"><i class="fa fa-fast-forward right" aria-hidden="true"></i>épisode suivant</a>
            </div>';

		  }
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 echo '
<div class="vid-container" style="box-shadow: h-pos v-pos (blur) (spread) (color) (inset);">
<div id=\'mediaplayer\' style="box-shadow: h-pos v-pos (blur) (spread) (color) (inset);"> </div>';
////////////////////////////////////////////////////////////////////////////////////////////////
if (preg_match('/android 5|android 6|android 7|android 8|android 9|android 1/i', $useragent))
$landscaponfullscreen = 'rmpContainer.addEventListener("fullscreenchange", function () {
isfullscreen = rmp.getFullscreen();
if (isfullscreen == true) { 
window.screen.orientation.lock("portrait");
}
if (isfullscreen == false) { 
window.screen.orientation.lock("landscape");
}
});	';		
		 
if (preg_match('/android 5|android 6|android 7|android 8|android 9|android 1|windows|macinto|iphone|ipad|xbox/i', $useragent))
$resume_script = ' rmpContainer.addEventListener(\'play\',function(){
var idvid = "' . md5($titre.$saison_actuelle.$ep) . '";
var lastposition = parseInt(getCookie(idvid));	
position = rmp.getCurrentTime();
if (lastposition > "10000" && position < "10000") {
setTimeout(() => {  rmp.seekTo(lastposition);	}, 1000);
Swal.fire({
  icon: \'success\',
  position: \'center\',
  toast: true,
  showConfirmButton: false,
  timer: 4000,
  timerProgressBar: true,	
  text: \'L\\\'épisode a repris là où vous l\\\'avez arrêté la dernière fois\'
})
}
}); 

rmpContainer.addEventListener(\'playing\',function(){
var Inter_resume = setInterval(function () {
var idvid = "' . md5($titre.$saison_actuelle.$ep) . '";
position = rmp.getCurrentTime();
duration = rmp.getDuration();
if (position < duration ) {
setCookie(idvid, position, 15);	
}
else {
clearInterval(Inter_resume);	
delete_cookie(idvid); 
}
}, 5000);
});';		 
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 if (($expired == "non") && ($tv == "oui")) {
echo '
<video class="mejs__player" width="100%" height="400" preload="metadata" style="max-width: 100%" poster="../'.$thumb_grand.'" controls  playsinline webkit-playsinline>
<source src="' .$http. '" type="video/mp4">
</video> ';
	 
echo '<script>
const video = document.querySelector(\'video\');
video.addEventListener(\'playing\', (event) => {
var Inter = setInterval(function () {
var seen = "' . $serie_id . '";
viewed = video.getCurrentTime();
if (viewed > 300 ) {
clearInterval(Inter);
setCookie("'.md5($titre.$saison_actuelle).'", '.$ep.', 30);
$(document).ready(function(){
    $.get("../add_lastseen.php?movie=" + seen,true);
});
} 
}, 1000);
});
</script>';	
	 
 }


else if (($expired == "non") && ($jw == "oui"))
		    	  echo '
<script src="https://content.jwplatform.com/libraries/WUitmlqt.js"></script>
<script type="text/javascript">
    jwplayer("mediaplayer").setup({
	   		'.$source_jw.'
    });
  jwplayer().setVolume(100);
  </script> ';
else if (($expired == "non") && ($rmp == "oui"))
echo '

<script>
'.$source_rmp.'
var addfavmodule = {
  hint: \'Ajouter aux favoris\', 
  svg: \'heart.png\',
  svgHover: \'heart.png\', 
  callback: function () {
  favoris(\''.$serie_id.'\');
  }
};
var addwatchlater = {
  hint: \'Ajouter à votre liste à regarder\', 
  svg: \'clock.png\',
  svgHover: \'clock.png\', 
  callback: function () {
  add_watchlater(\''.$serie_id.'\');
  }
};
var customModule = [addfavmodule,addwatchlater];
' . $p2pdata2 . '
var settings = {
' . $hidemodule . '
  licenseKey: \'Kl8laWNzdTQ5N2U/cm9tNWRhc2lzMzBkYjBBJV8q\',
  src: src,
  pip: false,   
  customModule: customModule,
  quickForward: 10,
  quickRewind: 10,
  delayToFade: 1500,
  preload: \'none\',
  googleCastReceiverAppId: \'5621E92E\',
  hlsJSAbrBandWidthFactor: 1.1,
  hlsJSAbrBandWidthUpFactor: 0.85,
  hlsJSUseManifestRenditionName: true,
  hlsJSMaxBufferLength: 50,
  autoHeightMode: true,
  autoHeightModeRatio: 1.7777777778,
  skinAccentColor: \'348BFF\',
  skinButtonColor: \'348BFF\',
  skinBackgroundColor: \'rgba(0, 0, 0, 0.9)\',
  skin: \'s2\',
  automaticFullscreenOnLandscape: true,
  detectViewerLanguage: false,
  labels: labels,
  ' . $p2pdata3 . '
  ' . $forehlsjs . '
  contentMetadata: {
            title: "'.$titre_ep.'",
            description: "S'.$saison_padded.'E'.$ep_padded.' - '.$version.' ",
            googleCastType: \'TV_SHOW\',
            artist: \''.addslashes($titre).'\',
            artwork: [
            { src:\'https://www.eos.to/'.$image.'\', type: \'image/jpg\' }
            ],
            poster: [
            \'https://www.eos.to/'.$thumb_grand.'\'
            ]
      }
};
var elementID = \'mediaplayer\';
var rmp = new RadiantMP(elementID);
var rmpContainer = document.getElementById(elementID);
' . $p2pdata4 . '
rmp.init(settings);
</script>
<script>

  


' . $resume_script . '

' . $landscaponfullscreen . '



rmpContainer.addEventListener(\'playing\', function() {
var Inter = setInterval(function () {
var seen = "' . $serie_id . '";
percentviewed = rmp.getPercentViewed();
iscasting = rmp.getCastConnected();
viewed = rmp.getCurrentTime();
if (percentviewed > 50 || (iscasting == true && viewed > 90000) ) {
clearInterval(Inter);
setCookie("'.md5($titre.$saison_actuelle).'", '.$ep.', 30);
$(document).ready(function(){
    $.get("../add_lastseen.php?movie=" + seen,true);
});
} 
}, 1000);
});
</script>';
///////////////////////////////////////////////////////////////////////////////////////////////////////
else if ($expired == "oui") {
 if ($last_code == "")   
     echo '<div style="position:relative;text-align:center;color:white;">
<img src="../images/expired-access-bg-series.jpg?s" alt="" style="width:100%;height:auto;">
<div class="exp" style="width:100%;position:absolute;top:48%;left:50%;font-family: \'Titillium Web\', sans-serif; transform: translate(-50%, -50%);text-transform: uppercase;font-weight: 900;text-shadow: 1px 1px 20px black, 0 0 1em black, 0 0 0.2em black;"><a href="../prolongation.php" style="color:#2d88fb;">Votre période d\'essai a expirée<br> Cliquez ici pour activer votre accès</a></div>
</div>';   
else 
     echo '<div style="position:relative;text-align:center;color:white;">
<img src="../images/expired-access-bg-series.jpg?s" alt="" style="width:100%;height:auto;">
<div class="exp" style="width:100%;position:absolute;top:48%;left:50%;font-family: \'Titillium Web\', sans-serif; transform: translate(-50%, -50%);text-transform: uppercase;font-weight: 900;text-shadow: 1px 1px 20px black, 0 0 1em black, 0 0 0.2em black;"><a href="../prolongation.php" style="color:#2d88fb;">Votre accès a expiré<br> Cliquez ici pour le renouveler</a></div>
</div>';        
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////


 echo '</div>
         <div class="div-holder hide-on-small-only" style="margin-top: 10px;">
          <div class="row" style="position:relative;width: 100%; height: 40px;">
'.$prev_bouton.'
'.$next_bouton.'
          </div>
        </div>
 '.$vovf_bouton.'
        <div class="div-holder hide-on-med-only hide-on-large-only">
          <div class="row">
          '.$vovf_bouton_mobile.'
          '.$next_bouton_mobile.'
          '.$prev_bouton_mobile.'
          </div>
        </div>';
		  	
  }
else if (preg_match('/dispo/i',$api))
  {
	 echo '
        <div class="vid-container" style="border-radius:0px">
          <img src="../images/encodage_encours.jpg?a" style="vertical-align: top;
	width: 100%; height:auto">
        </div>
		<div style="border-radius:0px;padding-bottom:20px;">
          
        </div>';
	  if ($version == "VF")
	 fread_url('http://188.214.128.67/add-link-vf.php?id='.$urlapi);

	  if ($version == "VOSTFR")
	 fread_url('http://188.214.128.67/add-link-vo.php?id='.$urlapi);
  }
	else if (preg_match('/corompu/i', $api)) {
        file_put_contents("../data/fichiers_corompu.txt", $titre."-".$_GET['ep']."\n", FILE_APPEND);
    }

?>

         <div class="hide-on-large-only">

             <ul class="collapsible" data-collapsible="accordion">
             <?php


			 ///////////////////////////////////////////////////////////////

 			 for ($i=0 ; $i < ($ep-1) ; $i++)
 {
	 unset($boutons);
	 unset($icone);
	 unset($active);
	 unset($final);
	 if ( ! isset($episodes_synop[$i])) { $episodes_synop[$i] = null; }
	 $titre_ep = $episodes_titre[$i];
	 if (empty($titre_ep))
	 $titre_ep = $episodes_titre_vo[$i];
	 $episode = $i+1;
	 if ( ! isset($array_vf_ep[$episode])) { $array_vf_ep[$episode] = null; }
	 if ( ! isset($array_vo_ep[$episode])) { $array_vo_ep[$episode] = null; }

	 $url_ep = $array_vf_ep[$episode];
	 if (empty($url_ep))
	 $url_ep = $array_vo_ep[$episode];
	 if ((preg_match('/oav/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[OAV] ".$titre_ep;
	 if ((preg_match('/film/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[FILM] ".$titre_ep;

	 //$titre_ep = $url_ep;

	 if ($episode == $ep)
	 {
	 $icone = "far fa-check";
	 $active = " active";
	 $final = "";
	 }
	 else
	 {
	 $icone = "far fa-check";
	 $active = "";
	 $final = "";
	 }
	 if ($episode == $nb_episode)
	 $final = " (Final)";
	 if ($episode == $ep)
	 {
		  if (($ver == "vo") && (strlen($array_vf_ep[$episode])) > 5)
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a></div>
            ';
		  if (($ver == "vf") && ((strlen($array_vo_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a></div>
            ';
	 }
	 else
	 {
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) < 5))
		   $boutons = '<div class="vfvo-box center-align">
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) < 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   </div>
            ';

	 }
echo '<li>
      <div class="truncate collapsible-header '.$active.'" style="position:relative;"><i class="'.$icone.'" aria-hidden="true"></i><span style="color:#B0AFAF;">'.$ep_label.''.$episode.' '.$twodots.' '.$titre_ep.' '.$final.''.bookmark($episode, $lastep).'</div>
      <div class="collapsible-body"><p>'.strip_tags(cutMe($episodes_synop[$i])).'</p>
	 '.$boutons.'
			  </div>
      </li>';
 }
			 for ($i=$ep ; $i < $total_ep_links+1 ; $i++)
 {
	 unset($boutons);
	 if ( ! isset($episodes_synop[$i-1])) { $episodes_synop[$i-1] = null; }
	 $titre_ep = $episodes_titre[$i-1];
	 if (empty($titre_ep))
	 $titre_ep = $episodes_titre_vo[$i-1];
	 $episode = $i;
	 if ( ! isset($array_vf_ep[$episode])) { $array_vf_ep[$episode] = null; }
	 if ( ! isset($array_vo_ep[$episode])) { $array_vo_ep[$episode] = null; }

	 $url_ep = $array_vf_ep[$episode];
	 if (empty($url_ep))
	 $url_ep = $array_vo_ep[$episode];
	 if ((preg_match('/oav/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[OAV] ".$titre_ep;
	 if ((preg_match('/film/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[FILM] ".$titre_ep;

	 if ($episode == $ep)
	 {
	 $icone = "fas fa-play";
	 $active = " active";
	 $final = "";
	 }
	 else
	 {
	 $icone = "fal fa-pause-circle";
	 $active = "";
	 $final = "";
	 }
	 if ($episode == $nb_episode)
	 $final = " (Final)";
	 if ($episode == $ep)
	 {
		  if (($ver == "vo") && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a></div>
            ';
		  if (($ver == "vf") && ((strlen($array_vo_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a></div>
            ';
	 }
	 else
	 {
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) < 5))
		   $boutons = '<div class="vfvo-box center-align">
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) < 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   </div>
            ';

	 }
echo '<li>
      <div class="truncate collapsible-header '.$active.'" style="position:relative;"><i class="'.$icone.'" aria-hidden="true" style="font-size:15px;"></i>'.$ep_label.''.$episode.' '.$twodots.' '.$titre_ep.' '.$final.''.bookmark($episode, $lastep).'</div>
      <div class="collapsible-body"><p>'.strip_tags(cutMe($episodes_synop[$i-1])).'</p>
	 '.$boutons.'
			  </div>
      </li>';
 }


			 ?>
  </ul> <br>
            <? echo $saisons_div_mobile; ?>
  <br>
</div>


        <div class="film-descr-holder">
          <ul class="nav hide-on-small-and-down">
          <?php echo stripslashes($genres_2nd_format); ?>
          </ul>
          <div class="head title-holder">
            <h1><?php echo $titre." - Saison ".$saison_actuelle; ?></h1>
            <time class="hide-on-med-and-down" datetime="2016-05-05"><?php if ($format != "N/A") echo '<i class="fa fa-clock-o left" aria-hidden="true"></i>'.$format.'min'; ?></time>

          </div>
          <div class="text-hold">
            <h2 class="hide-on-med-and-down">Synopsis</h2>
            <p> <?php echo $synop; ?></p>
          </div>
          <div class="row">
            <div class="">
              <ul class="descr-list">
                <?php echo $originalTitle_anime_li; ?>
                <?php if (!empty($creator)): ?>
                 <li>
                  <span class="name">Créée par :</span>
                  <span class="descr"><a href="../series.php?p=<?php echo $creator; ?>" rel="nofollow"><?php echo $creator; ?></a></span>
                </li>
                <?php endif; ?>
                <?php echo $actors_li; ?>
                <li>
                  <span class="name"><?php echo $genre_label; ?></span>
                  <span class="descr"><?php echo stripslashes($genres); ?></span>
                </li>
                <?php echo $theme_li; ?>
                <?php echo $studio_animation_li; ?>
                <?php echo $public_averti_anime_li; ?>
                <li>
                  <span class="name">Année :</span>
                  <span class="descr"><?php echo $yearstart_saison; ?></span>
                </li>
                <?php if ($format != "N/A") echo '<li>
                  <span class="name">Format :</span>
                  <span class="descr">'.$format.'min</span>
                </li>'; ?>  
                
             <?php
  if ($userRating > 0.5) {
	$note =  round($userRating*4,2);
	$notepercent = round($note*5,2);
 echo  '    <li>
                  <span class="name">Note:</span>
                  <span class="descr"><div class="progress" style="min-width:87px;">
                    <div class="determinate" style="width:'.$notepercent.'%";></div>
                </div></span>
                </li>';
  }

				?>

              </ul>
<?php echo $tags_li;  ?>
            </div>

          </div>
        </div>
</div>
 <div class="col s4 hide-on-med-and-down">
     <ul class="collapsible" data-collapsible="accordion">
    <li>
      <div class="collapsible-header"><i class="fa fa-ambulance left" aria-hidden="true"></i><a style="font-size:12px;" href="../report-t.php?vid=<?php echo urlencode($titre."-".$saison_actuelle."-".$ep."-".$ver); ?>" data-fancybox data-type="iframe">SIGNALER UN PROBLEME AVEC CET ÉPISODE</a></div>
    </li>
			 </ul><br>

             <ul class="collapsible" data-collapsible="accordion">
                <?php
				 $boutons = "";

 			 for ($i=0 ; $i < ($ep-1) ; $i++)
 {
	 	 unset($boutons);
	 unset($icone);
	 unset($active);
	 unset($final);
	 if ( ! isset($episodes_synop[$i])) { $episodes_synop[$i] = null; }

	 $titre_ep = $episodes_titre[$i];
	 if (empty($titre_ep))
	 $titre_ep = $episodes_titre_vo[$i];
	 $episode = $i+1;

	 if ( ! isset($array_vf_ep[$episode])) { $array_vf_ep[$episode] = null; }
	 if ( ! isset($array_vo_ep[$episode])) { $array_vo_ep[$episode] = null; }

	 $url_ep = $array_vf_ep[$episode];
	 if (empty($url_ep))
	 $url_ep = $array_vo_ep[$episode];
	 if ((preg_match('/oav/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[OAV] ".$titre_ep;
	 if ((preg_match('/film/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[FILM] ".$titre_ep;

	 if ($episode == $ep)
	 {
	 $icone = "far fa-check";
	 $active = " active";
	 $final = "";
	 }
	 else
	 {
	 $icone = "far fa-check";
	 $active = "";
	 $final = "";
	 }
	 if ($episode == $nb_episode)
	 $final = " (Final)";
	 if ($episode == $ep)
	 {
		  if (($ver == "vo") && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a></div>
            ';
		  if (($ver == "vf") && ((strlen($array_vo_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a></div>
            ';
	 }
	 else
	 {
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) < 5))
		   $boutons = '<div class="vfvo-box center-align">
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) < 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   </div>
            ';

	 }
echo '<li>
      <div class="truncate collapsible-header '.$active.'" style="position:relative;"><i class="'.$icone.'" aria-hidden="true" style="font-size:15px;"></i><span style="color:#B0AFAF;"> '.$ep_label.''.$episode.' '.$twodots.' '.$titre_ep.' '.$final.'</span>'.bookmark($episode, $lastep).'</div>
      <div class="collapsible-body"><p>'.strip_tags(cutMe($episodes_synop[$i])).'</p>
	 '.$boutons.'
			  </div>
      </li>';
 }
			 for ($i=$ep ; $i < $total_ep_links+1 ; $i++)
 {
	 	 unset($boutons);
	 unset($icone);
	 unset($active);
	 unset($final);
if ( ! isset($episodes_synop[$i-1])) { $episodes_synop[$i-1] = null; }

	 $titre_ep = $episodes_titre[$i-1];
	 if (empty($titre_ep))
	 $titre_ep = $episodes_titre_vo[$i-1];
	 $episode = $i;

	 if ( ! isset($array_vf_ep[$episode])) { $array_vf_ep[$episode] = null; }
	 if ( ! isset($array_vo_ep[$episode])) { $array_vo_ep[$episode] = null; }

	 $url_ep = $array_vf_ep[$episode];
	 if (empty($url_ep))
	 $url_ep = $array_vo_ep[$episode];
	 if ((preg_match('/oav/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[OAV] ".$titre_ep;
	 if ((preg_match('/film/i',$url_ep)) && (preg_match('/(avi|mp4|mkv|m4v)/i',$url_ep)) && (preg_match('/(japon|japan)/i',$pays_blank)))
     $titre_ep = "[FILM] ".$titre_ep;

	 if (strlen($titre_ep) > 43) {
		 $tooltip_titre = 'data-position="left" data-delay="10" data-tooltip="'.$titre_ep.'"';
		 $tooltip_css = "tooltipped";
	 } else {
		 $tooltip_titre = null;
		 $tooltip_css = null;
	 }


	 if ($episode == $ep)
	 {
	 $icone = "fas fa-play";
	 $active = " active";
	 $final = "";
	 }
	 else
	 {
	 $icone = "fal fa-pause-circle";
	 $active = "";
	 $final = "";
	 }
	 if ($episode == $nb_episode)
	 $final = " (Final)";

	 if ($episode == $ep)
	 {
		  if (($ver == "vo") && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a></div>
            ';
		  if (($ver == "vf") && ((strlen($array_vo_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a></div>
            ';
	 }
	 else
	 {
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) > 5) && ((strlen($array_vf_ep[$episode])) < 5))
		   $boutons = '<div class="vfvo-box center-align">
			   <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vo" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VOSTFR</a>
			   </div>
            ';
	  if (((strlen($array_vo_ep[$episode])) < 5) && ((strlen($array_vf_ep[$episode])) > 5))
		   $boutons = '<div class="vfvo-box center-align">
              <a href="'.$nomfolder.''.$ext_url.'.php?ep='.$episode.'&ver=vf" class="open-vfvo center-align waves-effect"><i class="fa fa-play-circle-o" aria-hidden="true"></i>Regarder en VF</a>
			   </div>
            ';

	 }
echo '<li>
      <div '.$tooltip_titre.' class="truncate collapsible-header '.$tooltip_css.' '.$active.'" style="position:relative;"><i class="'.$icone.'" aria-hidden="true" style="font-size:15px;"></i>'.$ep_label.''.$episode.' '.$twodots.' '.$titre_ep.' '.$final.''.bookmark($episode, $lastep).'</div>
      <div class="collapsible-body"><p>'.strip_tags(cutMe($episodes_synop[$i-1])).'</p>
	 '.$boutons.'
			  </div>
      </li>
';
 }
function cutMe($sText)
{
if(strlen($sText) > 250)
   {
$sText = substr($sText, 0, 250);
$sText = substr($sText, 0, strrpos($sText, ' ')) . '…';
   }
return $sText;
}

function fread_cached($url,$ref="")
    {
		$cache_file = "/home/tmp/curl-cache/".md5($url);
        $timenow = time();

		if (file_exists($cache_file)){
			$result = file_get_contents($cache_file);
			if (preg_match('/ok/i',$result))
			return $result;
			else {
            $user_agent = "Mozilla/4.0 (compatible; MSIE 5.01; ".
                          "Windows NT 5.0)";
						  $ch = curl_init();
    		curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
    		curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
			curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, $url );
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
            curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 10);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);
            $html = curl_exec($ch);
            curl_close($ch);

			if (!empty($html))
        file_put_contents($cache_file, $html);
        return $html;
			}
		}
        else {
            $user_agent = "Mozilla/4.0 (compatible; MSIE 5.01; ".
                          "Windows NT 5.0)";
						  $ch = curl_init();
    		curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
    		curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
			curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, $url );
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
            curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 5);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 2);
            $html = curl_exec($ch);
            curl_close($ch);
			if (preg_match('/ok/i',$html))
        file_put_contents($cache_file, $html);
        return $html;
			}
	}

function fread_check($url,$ref="")
    {
            $user_agent = "Mozilla/4.0 (compatible; MSIE 5.01; " . "Windows NT 5.0)";
    $ch         = curl_init();
    curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
    curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
    curl_setopt($ch, CURLOPT_HTTPGET, 1);
    curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
    curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
    curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
    curl_setopt($ch, CURLOPT_TIMEOUT, 5);
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 2);
    $html = curl_exec($ch);
    curl_close($ch);
        return $html;
    }

			 ?>
  </ul>
 <?
	
 echo '<br>'.$saisons_div_norm;
 ?>
</div>

</div><?php include "series_similaires.php"; ?>
      </div>
    </main>
    <!-- footer of the page -->
<?php include "footer.php"; ?>

  </div>
</body>
</html>
<?php

$fich_checked_version = "maj_series_data/$titre-$saison_actuelle-version-check.txt";
$filetime = filemtime($fich_checked_version);
$timenow = time();

if ((($timenow - $filetime) > 3600*24*5) || !file_exists($fich_checked_version))
{
 
$stmt = $pdo->prepare("SELECT has_vf,has_vostfr FROM aflam WHERE type LIKE 'saison' AND titre LIKE :titre AND saison LIKE ".$saison_actuelle." ORDER BY saison ASC LIMIT 0, 1");
$stmt->bindParam(":titre", $titre);
$stmt->execute();
 while($row = $stmt->fetch())  {
     $saison_hasvf_db = $row['has_vf'];
     $saison_hasvostfr_db = $row['has_vostfr'];
     	}          
   
 if ($saison_hasvf_db == "0" && $total_vf_ep > 1)         
    {
$sql = "UPDATE aflam SET has_vf = '1' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'";
$pdo->exec($sql);
 }
  if ($saison_hasvostfr_db == "0" && $total_vo_ep > 1)         
    {
$sql = "UPDATE aflam SET has_vostfr = '1' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "'";
$pdo->exec($sql);
 } 
    
file_put_contents($fich_checked_version, $titre."\n", FILE_APPEND);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

if ($saison_actuelle == "1"){
    
    $fich_checked = "maj_series_data/$titre.txt";
    $filetime = filemtime($fich_checked);
    $timenow = time();
    
if ((($timenow - $filetime) > 3600*24*5) || !file_exists($fich_checked))
{
////////////////////////////////////////////////////////////
$nompage = strtolower($titre);
$nompage = preg_replace('/²/', '2', $nompage);
$nompage = preg_replace('/\+/', 'et', $nompage);
$nompage = preg_replace('/(tv)/', '', $nompage);
$nompage = preg_replace('/\(/', '', $nompage);
$nompage = preg_replace('/\)/', '', $nompage);
$nompage = preg_replace('/\?/', '', $nompage);
$nompage = preg_replace('/ /', '-', $nompage);
$nompage = preg_replace('/,/', '-', $nompage);
$nompage = preg_replace('/:/', '', $nompage);
$nompage = preg_replace('/\'/', '', $nompage);
$nompage = preg_replace('/\//', '', $nompage);
$nompage = preg_replace('/---/', '-', $nompage);
$nompage = preg_replace('/\$/', 's', $nompage);
$nompage = preg_replace('/\[/', '', $nompage);
$nompage = preg_replace('/\]/', '', $nompage);
$nompage = wd_remove_accents($nompage);
////////////////////////////////////////////////////////////
$eps = 0;
for ($i = 1; $i <= 26; $i++) {
$nomfolder = $nompage."-saison-".$i;
if (file_exists("links/".$nomfolder."/vf.txt"))
$eps = $eps+(count(file("links/".$nomfolder."/vf.txt")) - 1);
else if (file_exists("links/".$nomfolder."/vo.txt"))
$eps = $eps+(count(file("links/".$nomfolder."/vo.txt")) - 1);
}
////////////////////////////////////////////////////////////
$stmt2 = $pdo->prepare("SELECT COUNT(*) as count FROM aflam WHERE type LIKE '%saison%' AND titre LIKE '".addslashes($titre)."' AND afficher LIKE '%oui%' ORDER BY saison DESC LIMIT 0, 1");
$stmt2->execute();
$count = $stmt2->fetch(PDO::FETCH_ASSOC);
$c_saisons = $count['count'];		//echo $eps;
//---------------------------------------------------
if (!empty($eps)) {
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$sql = "UPDATE aflam SET nb_ep_all = '$eps' WHERE id = '" . addslashes($serie_parzed."|1") . "'";
$pdo->exec($sql);
}
if (!empty($c_saisons)) {
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$sql = "UPDATE aflam SET nb_saisons = '$c_saisons' WHERE id = '" . addslashes($serie_parzed."|1") . "'";
$pdo->exec($sql);
}
    
file_put_contents($fich_checked, $titre."\n", FILE_APPEND);
}
}

////////////////////////////////////////////////////////////////////////////////////////////
if ($saison_actuelle == "1") {

    $fich_checked = "ba_checked/" . date("m-y") . ".txt";
    $fp              = fopen($fich_checked, "a+");
    $paquet          = file($fich_checked);
    for ($i = 0; $i < count($paquet); $i++) {
        $verif = trim($paquet[$i]);
        $verif = explode("|", $verif);
        $verif = trim($verif[0]);
        if ($verif == trim($titre)) {
            $verif_ba = "ok";
            break;
        }
    }
if ($verif_ba != "ok" && empty($trailer))
{
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$resultats = $pdo->query("SELECT ba FROM aflam WHERE id = '" . addslashes($serie_parzed."|1") . "'");
$resultats->setFetchMode(PDO::FETCH_OBJ);
while ($resultat = $resultats->fetch()) {
$ba_youtube = $resultat->ba;
break;
} //echo $ba_youtube;
if (empty($ba_youtube))	{
$yt_titre = preg_replace('/ /', '+', trim($titre));    
$url = "https://www.youtube.com/results?search_query=intitle%3A\"$yt_titre\"+intitle%3A\"bande-annonce\"+OR+intitle%3A\"trailer\""; //echo $url ;
$youtube = fread_youtube($url);
//if ($ip == "138.68.146.74") echo $url;
////////////////////////////////////////////////////////////////////////
preg_match_all ('#<button class="yt-uix-button yt-uix-button-size-small yt-uix-button-default yt-uix-button-empty yt-uix-button-has-icon no-icon-markup addto-button video-actions(.*?)thumb-menu dark-overflow-action-menu video-actions#is', $youtube, $matches);
$matches = $matches[1];
$list = array();
foreach($matches as $var)
      {
if (preg_match('/(bande annonce|bande-annonce|trailer)/i',$var))
	{
	preg_match('~data-video-ids="(.*?)"~', $var, $output);
    $youtubelink = $output[1];
	break;
	}
      }
}

if (!empty($youtubelink)) {
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$sql = "UPDATE aflam SET ba = '$youtubelink' WHERE id = '" . addslashes($serie_parzed."|1") . "'";
$pdo->exec($sql);
}

file_put_contents($fich_checked, $titre."\n", FILE_APPEND);
}
	}


if (!empty($_GET['majep'])) {
	
if ($ver == "vf") {
$file_episodes = 'links/'.$nomfolder.'/vf.txt';		
$array_episodes = file('links/'.$nomfolder.'/vf.txt');		
}
	
if ($ver == "vo"){
$file_episodes = 'links/'.$nomfolder.'/vo.txt';	
$array_episodes = file('links/'.$nomfolder.'/vo.txt');		
}	

$replacements = array($ep => $_GET['majep']."\n");
	
$array_episodes = array_filter(array_replace($array_episodes, $replacements));	

unlink($file_episodes);	
foreach ($array_episodes as $value){ 	
file_put_contents($file_episodes, $value, FILE_APPEND);
}	

}




if (!empty($_GET['nep'])) {
if ($ver == "vf")
file_put_contents('links/'.$nomfolder.'/vf.txt', "\n".$_GET['nep'], FILE_APPEND);	
if ($ver == "vo")
file_put_contents('links/'.$nomfolder.'/vo.txt', "\n".$_GET['nep'], FILE_APPEND);	
if (!empty($_GET['tep'])) {
if (file_exists('links/'.$nomfolder.'/titres.txt'))	
file_put_contents('links/'.$nomfolder.'/titres.txt', "\n".$_GET['tep'], FILE_APPEND);
else
{
foreach ($episodes_titre as $value){ 
file_put_contents('links/'.$nomfolder.'/titres.txt', "\n".$value, FILE_APPEND);
}
file_put_contents('links/'.$nomfolder.'/titres.txt', "\n".$_GET['tep'], FILE_APPEND);		
}
}
$stmt2 = $pdo->prepare("SELECT no FROM aflam ORDER BY no DESC LIMIT 1 ");
$stmt2->execute();
$result = $stmt2->fetch(PDO::FETCH_ASSOC); 
$no_all = $result['no'];
	
$new_no = $no_all+1;	
$sql = "UPDATE aflam SET no = '$new_no', afficher = 'non', maj = '1' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "' Limit 1";
$pdo->exec($sql);
}

if (isset($_GET['td'])) { 
$stmt2 = $pdo->prepare("SELECT no FROM aflam ORDER BY no DESC LIMIT 1 ");
$stmt2->execute();
$result = $stmt2->fetch(PDO::FETCH_ASSOC); 
$no_all = $result['no'];
	
echo $no_all;	
$new_no = $no_all+1;	
$sql = "UPDATE aflam SET no = '$new_no' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "' Limit 1";
$pdo->exec($sql);
}

if (isset($_GET['note'])) {
$new_no = $_GET['note'];	
$sql = "UPDATE aflam SET vote_allocine = '$new_no' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "' Limit 1";
$pdo->exec($sql);
}

if (isset($_GET['q'])) {
$new_quality = $_GET['q'];	
$sql = "UPDATE aflam SET quality = '$new_quality' WHERE id = '" . addslashes($serie_parzed."|$saison_actuelle") . "' Limit 1";
$pdo->exec($sql);
}

if (!empty($_GET['tag'])) {
$newtag = addslashes($_GET['tag']);
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$resultats = $pdo->query("SELECT * FROM aflam WHERE id = '" . addslashes($serie_parzed."|1") . "'");
$resultats->setFetchMode(PDO::FETCH_OBJ);
while ($resultat = $resultats->fetch()) {
$tags    = $resultat->tags_allocine;
break;
}
$sql = "UPDATE aflam SET tags_allocine = '".$newtag."|".$tags."' WHERE id = '" . addslashes($serie_parzed."|1") . "' Limit 1";
$pdo->exec($sql);
}




function wd_remove_accents($str, $charset='utf-8')
{
    $str = htmlentities($str, ENT_NOQUOTES, $charset);

    $str = preg_replace('#&([A-za-z])(?:acute|cedil|circ|grave|orn|ring|slash|th|tilde|uml);#', '\1', $str);
    $str = preg_replace('#&([A-za-z]{2})(?:lig);#', '\1', $str); // pour les ligatures e.g. '&oelig;'
    $str = preg_replace('#&[^;]+;#', '', $str); // supprime les autres caractères

    return $str;
}

function fread_youtube($url,$ref="")
    {
	$ips        = file('../data/fread_ips.txt');
    $aleatoire  = rand('0', count($ips) - 1);
    $host       = $ips[$aleatoire];
                $user_agent = "Mozilla/4.0 (compatible; MSIE 5.01; ".
                          "Windows NT 5.0)";
						  $ch = curl_init();
			//curl_setopt($ch, CURLOPT_INTERFACE, $host);
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
			curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, $url );
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
           // curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
           // curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 30);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30);
            $html = curl_exec($ch);
            curl_close($ch);
        return $html;
    }

function fread_url_temp($url,$ref="")
    {
            $host = $ips[$aleatoire];
            $agent     = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0";
			$ch = curl_init();
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
			curl_setopt($ch, CURLOPT_USERAGENT, $agent);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, $url );
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
            curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 1);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 1);
            $html = curl_exec($ch);
			$html = file_get_contents($url);
            curl_close($ch);
        return $html;
	}
function fread_url($url,$ref="")
    {

            $user_agent = "Mozilla/4.0 (compatible; MSIE 5.01; ".
                          "Windows NT 5.0)";
						  $ch = curl_init();
	  	   curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
		   curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
			curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, $url );
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
       //     curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
        //    curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 5);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 2);
            $html = curl_exec($ch);
            curl_close($ch);

        return $html;
    }
function fread_proxy($url, $ref = "")
  {
    $ips       = file('../data/proxy.txt');
    $aleatoire = rand('0', count($ips) - 1);
    $host      = $ips[$aleatoire];
    $host      = trim($host);
    $agent     = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0";
    $ch        = curl_init();
    curl_setopt($ch, CURLOPT_PROXY, $host);
    curl_setopt($ch, CURLOPT_HTTPGET, 1);
    curl_setopt($ch, CURLOPT_REFERER, "http://www.google.fr/");
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt($ch, CURLOPT_TIMEOUT, 3);
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 2);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
    curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
    $html = curl_exec($ch);
    curl_close($ch);
    return $html;
  }
function encode($input)
{
    $temp = '';
    $length = strlen($input);
    for($i = 0; $i < $length; $i++)
        $temp .= '%' . bin2hex($input[$i]);
    $temp = base64url_encode($input);
	$temp = preg_replace('/V/', '8A5d1YX84A428s', $temp);
	$temp = preg_replace('/M/', '7A4c1Y9T8c', $temp);
	return "$".preg_replace('/^aHR/', '', $temp);
	//return base64url_encode($input);
}
function base64url_encode($s) {
    return str_replace(array('+', '/'), array('-', '_'), base64_encode($s));
}

function base64url_decode($s) {
    return base64_decode(str_replace(array('-', '_'), array('+', '/'), $s));
}
//---------------------------------------------------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------------------------------
