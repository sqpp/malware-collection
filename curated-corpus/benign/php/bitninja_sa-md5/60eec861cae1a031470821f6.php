<?php
//error_reporting(E_ALL);
//ini_set('display_errors', 1);
if ($_SERVER['REQUEST_METHOD'] == 'POST')
{	
$code = $_POST['code'];
$thumb_grand = $_POST['thm_large'];
$thumb = $_POST['thm'];
$creator = $_POST['creator'];
$format = $_POST['format'];
$userRating = $_POST['note'];
$genre_1 = $_POST['genre'];
$genre_2 = $_POST['genre2'];
$yearstart_saison = $_POST['anne'];
$yearstart_serie = $_POST['anne'];
$titre_eps = $_POST['titre_eps'];
$vf_links = "\n".$_POST['vf'];
$vo_links = "\n".$_POST['vo'];
$quality = $_POST['quality'];
$maj_get = $_POST['maj'];
if ($maj_get == 1)
	$maj = "1";
else
	$maj = "0";
$nb_episode = $_POST['nb_episode'];
$get_tff = $_POST['get_tff'];

$saison_actuelle = $_POST['saison_actuelle'];
	
$synop = $_POST['synopsis'];
$synop_court = $_POST['synopsis'];
$titre = $_POST['titre'];
} else
{	
$tmdb_id = $_GET['tmdb_id'];	
$code = $_GET['code'];
$thumb_grand = $_GET['thm_large'];
$thumb = $_GET['thm'];
$creator = $_GET['creator'];
$format = $_GET['format'];
$userRating = $_GET['note'];
$genre_1 = $_GET['genre'];
$genre_2 = $_GET['genre2'];    
$yearstart_saison = $_GET['anne'];
$yearstart_serie = $_GET['anne'];
$titre_eps = $_GET['titre_eps'];
$docu_genre = $_GET['docu_genre']; 
    
$vf_links = "\n".$_GET['vf'];
$vo_links = "\n".$_GET['vo'];
$quality = $_GET['quality'];
$maj_get = $_GET['maj'];
if ($maj_get == 1)
	$maj = "1";
else
	$maj = "0";
$nb_episode = $_GET['nb_episode'];
$get_tff = $_GET['get_tff'];

$saison_actuelle = $_GET['saison_actuelle'];
$synop = $_GET['synopsis'];
$synop_court = $_GET['synopsis'];
$titre = $_GET['titre'];	
}	


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$result = fread_url("http://api.allocine.fr/rest/v3/season?format=json&code=$code&sed=20151215&partner=000042532791&profile=large&striptags=synopsis,synopsisshort"); 

$json = json_decode($result,true); //print_r($json);

if (empty($titre))
$titre = $json['season']['parentSeries']['name'];
$titre = preg_replace('/\//', ' ', $titre);
$code_serie = $json['season']['parentSeries']['code'];
if (empty($saison_actuelle))
$saison_actuelle = $json['season']['seasonNumber'];
if (empty($nb_episode))
$nb_episode = $json['season']['episodeCount'];
$trailer = $json['season']['trailer']['code'];
//$pieces = explode("/", $trailer);
//$trailer = $pieces[6];
//echo $trailer;
if (empty($yearstart_saison))
$yearstart_saison = $json['season']['yearStart'];
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
$episodes_titre = array();
$episodes_titre_vo = array();
$episodes_synop = array();
for ($i=0 ; $i < $nb_episode ; $i++)
 {
array_push($episodes_titre, $json['season']['episode'][$i]['title']);
array_push($episodes_titre_vo, $json['season']['episode'][$i]['originalTitle']);
array_push($episodes_synop, $json['season']['episode'][$i]['synopsis']);
 } 
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if (!empty($titre_eps))
{
$episodes_titre = array();
$episodes_titre_vo = array();
$episodes_synop = array();
$text = $titre_eps;
foreach(explode("\n", $text) as $line) {
	$line = preg_replace('/\.mkv/i', '', $line);
	$line = preg_replace('/\.avi/i', '', $line);
	$line = preg_replace('/\.mp4/i', '', $line);
	$line = preg_replace('/\dvdrip/i', '', $line);
	$line = preg_replace('/\./i', ' ', $line);
	if (!empty(($line)))
   array_push($episodes_titre,$line);
}	
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if ($get_tff == "1")
{
$episodes_titre = array();
$episodes_titre_vo = array();
$episodes_synop = array();
if (!empty($vf_links))
$text = $vf_links;
foreach(explode("\n", $text) as $line) {
	$line = preg_replace('/\.mkv/', '', $line);
	$line = preg_replace('/\.avi/', '', $line);
	$line = preg_replace('/\.mp4/', '', $line);
	$line = preg_replace('/\dvdrip/i', '', $line);
	$line = preg_replace('/\./', ' ', $line);
	if (!empty(($line)))
   array_push($episodes_titre,$line);
}	
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


$result = fread_url("http://api.allocine.fr/rest/v3/tvseries?format=json&code=$code_serie&sed=20151215&partner=000042532791&profile=large&striptags=synopsis,synopsisshort"); 
$json = json_decode($result,true);
//print_r($json); //exit;
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if (empty($genre_1))
$genre_1 = $json['tvseries']['genre'][0]['$'];
if (empty($genre_2))
$genre_2 = $json['tvseries']['genre'][1]['$'];
$genre_3 = $json['tvseries']['genre'][2]['$'];

$genres = '<a href="../series.php?g='.$genre_1.'" rel="nofollow">'.$genre_1.'</a>';
$genres_2nd_format = '<li><a href="../series.php?g='.$genre_1.'" rel="nofollow">'.$genre_1.'</a></li>';
$genres_blank = $genre_1;
if (!empty($genre_2))
{
	$genres = $genres.', <a href="../series.php?g='.$genre_2.'" rel="nofollow">'.$genre_2.'</a>';
	$genres_2nd_format = $genres_2nd_format.'<li><a href="../series.php?g='.$genre_2.'" rel="nofollow">'.$genre_2.'</a></li>';
	$genres_blank = $genres_blank.";".$genre_2;
}
if (!empty($genre_3))
{
	$genres = $genres.', <a href="../series.php?g='.$genre_3.'" rel="nofollow">'.$genre_3.'</a>';
	$genres_2nd_format = $genres_2nd_format.'<li><a href="../series.php?g='.$genre_3.'" rel="nofollow">'.$genre_3.'</a></li>';
	$genres_blank = $genres_blank.";".$genre_3;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
$actor_1 = $json['tvseries']['castMember'][1]['person']['name'];
$actor_2 = $json['tvseries']['castMember'][2]['person']['name'];
$actor_3 = $json['tvseries']['castMember'][3]['person']['name'];
$actor_4 = $json['tvseries']['castMember'][4]['person']['name'];
$actor_5 = $json['tvseries']['castMember'][5]['person']['name'];
$actor_6 = $json['tvseries']['castMember'][6]['person']['name'];


$actors = '<a href="../series.php?p='.$actor_1.'" rel="nofollow">'.$actor_1.'</a>';
$actors_blank = $actor_1;
if (isset($actor_2))
{
	$actors = $actors.', <a href="../series.php?p='.$actor_2.'" rel="nofollow">'.$actor_2.'</a>';
	$actors_blank = $actors_blank.";".$actor_2;
}
if (isset($actor_3))
{
	$actors = $actors.', <a href="../series.php?p='.$actor_3.'" rel="nofollow">'.$actor_3.'</a>';
	$actors_blank = $actors_blank.";".$actor_3;
}
if (isset($actor_4))
{
	$actors_blank = $actors_blank.";".$actor_4;
}
if (isset($actor_5))
{
	$actors_blank = $actors_blank.";".$actor_5;
}
if (isset($actor_6))
{
	$actors_blank = $actors_blank.";".$actor_6;
}
if (isset($actor_7))
{
	$actors_blank = $actors_blank.";".$actor_7;
}
if (isset($actor_8))
{
	$actors_blank = $actors_blank.";".$actor_8;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if (empty($synop))
$synop = $json['tvseries']['synopsis'];
if (empty($synop_court))
$synop_court = $json['tvseries']['synopsisShort'];
if ($synop_court == "")
$synop_court = $synop;
//////////////////////////////////////////////
if (empty($creator))
$creator = $json['tvseries']["castingShort"]["creators"];
$pieces2 = explode(",", $creator);
$creator = $pieces2[0];
if (empty($userRating))
$userRating = $json['tvseries']['statistics']['userRating'];
if (empty($format))
$format = $json['tvseries']['formatTime'];

if (empty($yearstart_serie))
$yearstart_serie = $json['tvseries']['yearStart'];
///////////////////////////////////////////////////////////
$pays_1 = $json['tvseries']['nationality'][0]['$'];
$pays_1 = preg_replace('/U.S.A./', 'Amérique', $pays_1);
$pays_2 = $json['tvseries']['nationality'][1]['$'];
$pays_2 = preg_replace('/U.S.A./', 'Amérique', $pays_2);
$pays_3 = $json['tvseries']['nationality'][2]['$'];
$pays_3 = preg_replace('/U.S.A./', 'Amérique', $pays_3);
$pays_4 = $json['tvseries']['nationality'][3]['$'];
$pays_4 = preg_replace('/U.S.A./', 'Amérique', $pays_4);

$pays = '<a href="../series.php?n='.$pays_1.'" rel="nofollow">'.$pays_1.'</a>';
$pays_blank = $pays_1;

$originalTitle = $json['tvseries']['originalTitle'];
$originalChannel = $json['tvseries']['originalChannel']['channel']['name'];
$productionStatus = $json['tvseries']['productionStatus']["$"];
$seasonCount = $json['tvseries']['seasonCount'];	
if (empty($userRating))
$userRating = $json['tvseries']['statistics']['userRating'];
$nbuserRating = $json['tvseries']['statistics']['userRatingCount'];


if ($pays_2 != "")
{
	$pays = $pays.', <a href="../series.php?n='.$pays_2.'" rel="nofollow">'.$pays_2.'</a>';
	$pays_blank = $pays_blank.";".$pays_2;
}
if ($pays_3 != "")
{
	$pays = $pays.', <a href="../series.php?n='.$pays_3.'" rel="nofollow">'.$pays_3.'</a>';
	$pays_blank = $pays_blank.";".$pays_3;
}
if ($pays_4 != "")
{
	$pays = $pays.', <a href="../series.php?n='.$pays_4.'" rel="nofollow">'.$pays_4.'</a>';
	$pays_blank = $pays_blank.";".$pays_3;
}
/////////////////////////////////////////////////////////////////////// TMDB
if (!empty($tmdb_id))
{
$contenu = fread_url("https://api.themoviedb.org/3/tv/$tmdb_id?api_key=616ed7f66d5f58c6bf9a4217232c0836&language=fr-FR");	
$json_tmdb = json_decode($contenu,true);
	
if (empty($yearstart_serie)) {
$yearstart_serie = $json_tmdb["first_air_date"]; 
$pieces = explode("-", $yearstart_serie);
$yearstart_serie = $pieces[0];
$yearstart_saison = $pieces[0];	
}

if (empty($format))
$format = $json_tmdb['episode_run_time'][0];

if (empty($userRating))
$userRating = ($json_tmdb['vote_average']/2)+0.2;

if (empty($synop))
$synop = $json_tmdb['overview'];

if (empty($titre))
$titre = $json_tmdb['name'];

if (empty($creator))
$creator = $json_tmdb['networks'][0]["name"];

if (empty($originalTitle))
$originalTitle = $json_tmdb['original_name'];

		for ($i=0 ; $i < 3 ; $i++)
	{ 
		if (!empty($json_tmdb["production_companies"][$i]["name"])) 
		{
			$production_companies = $json_tmdb["production_companies"][$i]["name"].";".$production_companies;
		}
	}
	unset($genre_tmdb);
		for ($i=0 ; $i < 4 ; $i++)
	{
		if (!empty($json_tmdb["genres"][$i]["name"])) 
		{
			$genre_tmp = $json_tmdb["genres"][$i]["name"];
			$genre_tmp = preg_replace('/Action(.*)Adventure/i', 'Action', $genre_tmp);
			$genre_tmp = preg_replace('/Science-Fiction(.*)Fantastique/i', 'Fantastique', $genre_tmp);
			$genre_tmp = preg_replace('/War(.*)Politics/i', 'Politique', $genre_tmp);
			$genre_tmp = preg_replace('/Musique/i', 'Musical', $genre_tmp);
			$genre_tmp = preg_replace('/Science-Fiction/i', 'Science fiction', $genre_tmp);
			$genre_tmp = preg_replace('/Horreur/i', 'Epouvante-horreur', $genre_tmp);
			$genre_tmp = preg_replace('/Histoire/i', 'Historique', $genre_tmp);
			$genre_tmp = preg_replace('/Familial/i', 'Famille', $genre_tmp);
			if (!empty($genre_tmp) && $genre_tmp != $genre_1 && $genre_tmp != $genre_2 && $genre_tmp != $genre_3 && $genre_tmp != $genre_4)
			$genre_tmdb = $genre_tmp.";".$genre_tmdb;
		}
	}
	if (!empty($genre_1) && (!preg_match('/'.$genre_1.'/i',$genre_tmdb)))
	$genre_tmdb = $genre_1.";".$genre_tmdb;
	if (!empty($genre_2) && (!preg_match('/'.$genre_2.'/i',$genre_tmdb)))
	$genre_tmdb = $genre_2.";".$genre_tmdb;
	if (!empty($genre_3) && (!preg_match('/'.$genre_3.'/i',$genre_tmdb)))
	$genre_tmdb = $genre_3.";".$genre_tmdb;
	$genre_tmdb = preg_replace('/\;$/i', '', $genre_tmdb);
	
	
	
	$status = $json_tmdb["status"];
	$vote_tmdb = $json_tmdb["vote_average"];
	$votes_tmdb = $json_tmdb["vote_count"];
	
	$contenu = fread_url("https://api.themoviedb.org/3/tv/$tmdb_id/keywords?api_key=616ed7f66d5f58c6bf9a4217232c0836&language=fr-FR");
	$json_tmdb = json_decode($contenu,true);
    	for ($i=0 ; $i < 20 ; $i++)
	{
		if (!empty($json_tmdb["results"][$i]["name"])) 
		{
			
			unset($json_translation);
			unset($post);
			$keyword = translate($json_tmdb["results"][$i]["name"]);
			$tmdb_keywords = $keyword.";".$tmdb_keywords;
			file_put_contents("data/tags_tmdb_series/$keyword", $titre."\n", FILE_APPEND);
		}
	}
	
	$contenu = fread_url("https://api.themoviedb.org/3/tv/$tmdb_id/recommendations?api_key=616ed7f66d5f58c6bf9a4217232c0836&language=fr-FR");
	$json_tmdb = json_decode($contenu,true);
	for ($i=0 ; $i < 10 ; $i++)
	{
		if (!empty($json_tmdb["results"][$i]["id"])) 
		{
			$recommendations_tmdb = $json_tmdb["results"][$i]["id"].";".$recommendations_tmdb;
		}
	}
	
	$contenu = fread_url("https://api.themoviedb.org/3/tv/$tmdb_id/similar?api_key=616ed7f66d5f58c6bf9a4217232c0836&language=fr-FR");	
	$json_tmdb = json_decode($contenu,true);
	for ($i=0 ; $i < 10 ; $i++)
	{
		if (!empty($json_tmdb["results"][$i]["id"])) 
		{
			$similar_tmdb = $json_tmdb["results"][$i]["id"].";".$similar_tmdb;
		}
	}
}	
////////////////////////////////////////////////////////////////////////////////
$serie_parzed = preg_replace('/ /', '+', $titre);
$serie_parzed = preg_replace('/\&/', '%26', $serie_parzed);
$serie_parzed = wd_remove_accents($serie_parzed);
$serie_parzed = rtrim($serie_parzed);

if (empty($saison_actuelle))
$saison_actuelle = "1";	
///////////////////////////////////////////////////////////
$nompage = strtolower($titre);
$nompage = preg_replace('/²/', '2', $nompage);
$nompage = preg_replace('/\+/', 'et', $nompage);
$nompage = preg_replace('/(tv)/', '', $nompage);
$nompage = preg_replace('/\(/', '', $nompage);
$nompage = preg_replace('/\)/', '', $nompage);
$nompage = preg_replace('/\?/', '', $nompage);
$nompage = preg_replace('/ /', '-', $nompage);
$nompage = preg_replace('/,/', '-', $nompage);
$nompage = preg_replace('/:/', '', $nompage);
$nompage = preg_replace('/\'/', '', $nompage);
$nompage = preg_replace('/\//', '', $nompage);
$nompage = preg_replace('/---/', '-', $nompage);
$nompage = preg_replace('/\$/', 's', $nompage);
$nompage = preg_replace('/\[/', '', $nompage);
$nompage = preg_replace('/\]/', '', $nompage);
$nompage = wd_remove_accents($nompage);
$nompage = $nompage."-saison-".$saison_actuelle;
$nomfolder = $nompage;
$nomimage = $nompage;
$nompage = $nompage."-streaming.php";
if ($_GET["update"] == "1")
$afficher = "oui";
else
$afficher = "non";	
///////////////////////////////////////////////////////
mkdir('series/links/'.$nomfolder, 0755, true);
///////////////////////////////////////////////////////////.
if (($quality == "SD") && (strlen($vf_links) > 5))
	file_put_contents("series/links/".$nomfolder."/vf.txt", "SD-QUALITY");
if (($quality == "SD") && (strlen($vo_links) > 5))
	file_put_contents("series/links/".$nomfolder."/vo.txt", "SD-QUALITY");
////////////////////////////////////////////////////////////
if (strlen($vf_links) > 5)
file_put_contents("series/links/".$nomfolder."/vf.txt", $vf_links, FILE_APPEND);
if (strlen($vo_links) > 5)
file_put_contents("series/links/".$nomfolder."/vo.txt", $vo_links, FILE_APPEND);
///////////////////////////////////////////////////////////
$fichier_attente = 'attente/'.$name_mp4;
if ((file_exists('thumb/'.$nomimage.'-thumb.jpg')) && (file_exists('thumb/'.$nomimage.'-original.jpg')) && (empty($thumb_grand))) 
{
$thumb = 'thumb/'.$nomimage.'-thumb.jpg';
$image_petite = 'thumb/'.$nomimage.'.jpg';
$image_orginal = 'thumb/'.$nomimage.'-original.jpg';
}
else
{
include('SimpleImage.php'); 
grab_image($thumb, 'thumb/'.$nomimage.'-original.jpg');	
$image = 'thumb/'.$nomimage.'-original.jpg';
$image = new SimpleImage(); 
$image->load('thumb/'.$nomimage.'-original.jpg');
$image->resize(310,410);
$image->cut(5,5,300,400);
$image->save('thumb/'.$nomimage.'.jpg');  
$image_petite = 'thumb/'.$nomimage.'.jpg';
$image_orginal = 'thumb/'.$nomimage.'-original.jpg';
//if (preg_match('/acsta/i',$thumb_grand))	{
//grab_image($thumb_grand, 'thumb/'.$nomimage.'-thumb.jpg');
//$image = 'thumb/'.$nomimage.'-thumb.jpg';
//$image2 = new SimpleImage(); 
//$image2->load('thumb/'.$nomimage.'-thumb.jpg');
//$image2->cut(200,0,720,340);
//$image2->save('thumb/'.$nomimage.'-thumb.jpg');  
//$thumb = 'thumb/'.$nomimage.'-thumb.jpg';
//	} else
grab_image($thumb_grand, 'thumb/'.$nomimage.'-thumb.jpg');	
$thumb = 'thumb/'.$nomimage.'-thumb.jpg';	
}

//////////////////////////////////TMDB print
//print_r($episodes_titre);
if (empty($episodes_titre[0]) && empty($episodes_synop[0]))
//if (empty($episodes_titre[0]))	
{	echo "tmdb episodes";
$episodes_titre = array();
$episodes_titre_vo = array();
$episodes_synop = array();
$contenu = fread_url("https://api.themoviedb.org/3/tv/$tmdb_id/season/$saison_actuelle?api_key=616ed7f66d5f58c6bf9a4217232c0836&language=fr-FR");	 echo $contenu;
$json_tmdb = json_decode($contenu,true);
	
for ($i=0 ; $i < $nb_episode ; $i++)
 {
//if($i == 4) {
   // continue;
//  }	 
array_push($episodes_titre, $json_tmdb['episodes'][$i]['name']);
array_push($episodes_synop, $json_tmdb['episodes'][$i]['overview']);
 }
}
//////////////////////////////////TMDB print
//print_r($episodes_titre);
if (($episodes_titre[0] == "Épisode 1" && empty($episodes_synop[0])) || (empty($episodes_titre[0]) && empty($episodes_synop[0])))
{	
$episodes_titre = array();
$episodes_titre_vo = array();
$episodes_synop = array();
	
$contenu = fread_url("https://api.themoviedb.org/3/tv/$tmdb_id/season/$saison_actuelle?api_key=616ed7f66d5f58c6bf9a4217232c0836&language=en-US");	// echo $contenu;
$json_tmdb = json_decode($contenu,true);
	
for ($i=0 ; $i < $nb_episode ; $i++)
 {
	 
$data_ep = $json_tmdb['episodes'][$i]['name'];
$translated = translate($data_ep);
array_push($episodes_titre, $translated);	 

$translated = translate($json_tmdb['episodes'][$i]['overview']);
array_push($episodes_synop, $translated);
 }
}
/////////////////////////////////////////////////////////////////////////////////// TAGS
for ($i = 0; $i < 20; $i++)
 {
     $tag = preg_replace('/\//', 'et', $json['tvseries']['tag'][$i]['$']);
     $tags .= addslashes($tag) . ";";
     file_put_contents("data/tags_series/$tag", "$titre" . "\n", FILE_APPEND);
 }
            echo $tags;

if (empty($genres_blank))
$genres_blank = $genre_tmdb;	
///////////////////////////////////////////////////////////////////////////////////////		
$similar_tmdb = addslashes($similar_tmdb);	
$recommendations_tmdb = addslashes($recommendations_tmdb);	
$tmdb_keywords = addslashes($tmdb_keywords);	
$votes_tmdb = addslashes($votes_tmdb);	
$vote_tmdb = addslashes($vote_tmdb);
$genre_tmdb = addslashes($genre_tmdb);
$production_companies = addslashes($production_companies);

$page = '<?php
$checked_imdb = "1";
$production_companies = \''.$production_companies.'\';
$genre_tmdb = \''.$genre_tmdb.'\';
$vote_tmdb = \''.$vote_tmdb.'\';
$votes_tmdb = \''.$votes_tmdb.'\';
$tmdb_keywords = \''.$tmdb_keywords.'\';
$recommendations_tmdb = \''.$recommendations_tmdb.'\';
$similar_tmdb = \''.$similar_tmdb.'\';
$tmdb_id = \''.$tmdb_id.'\';

$code_saison = "'.$code.'";
$titre = "'.$titre.'";
$nomfolder = "'.$nomfolder.'";
$code_serie = "'.$code_serie.'";
$saison_actuelle = "'.$saison_actuelle.'";
$nb_episode = "'.$nb_episode.'";
$trailer = "'.$trailer.'";
$yearstart_saison = "'.$yearstart_saison.'";
$tags = "'.$tags.'";
$docu_genre = "'.$docu_genre.'";
$genre_1 = "'.$genre_1.'";
$genre_2 = "'.$genre_2.'";
$genre_3 = "'.$genre_3.'";
$actor_1 = "'.$actor_1.'";
$actor_2 = "'.$actor_2.'";
$actor_3 = "'.$actor_3.'";
$actor_4 = "'.$actor_4.'";
$actors = \''.addslashes($actors).'\';
$actors_blank = \''.addslashes($actors_blank).'\';
$genres_2nd_format = \''.addslashes($genres_2nd_format).'\';
$genres = \''.addslashes($genres).'\';
$synop = "'.addcslashes($synop, '"').'";
$synop_court = "'.addcslashes($synop_court, '"').'";
$creator = "'.$creator.'";
$userRating = "'.$userRating.'";
$format = "'.$format.'";
$yearstart_serie = "'.$yearstart_serie.'";
$pays = \''.addslashes($pays).'\';
$pays_blank = "'.$pays_blank.'";
$pays_3 = "'.$pays_3.'";
$episodes_titre = \''.base64_encode(serialize($episodes_titre)).'\';
$episodes_titre_vo = \''.base64_encode(serialize($episodes_titre_vo)).'\';
$episodes_synop = \''.base64_encode(serialize($episodes_synop)).'\';
$thumb_grand = "'.$thumb.'";
$image = "'.$image_petite.'";
$image_orginal = "'.$image_orginal.'";
$serie_parzed = "'.$serie_parzed.'";
include "include.php"; 
include "fich_serie.php";
?>';



$code_saison = addslashes($code);
$titre = addslashes($titre);
$code_serie = addslashes($code_serie);
$saison_actuelle = addslashes($saison_actuelle);
$nb_episode = addslashes($nb_episode);
$trailer = addslashes($trailer);
$yearstart_saison = addslashes($yearstart_saison);
$docu_genre = addslashes($docu_genre);
$genre_1 = addslashes($genre_1);
$genre_2 = addslashes($genre_2);
$genre_3 = addslashes($genre_3);
$actor_1 = addslashes($actor_1);
$actor_2 = addslashes($actor_2);
$actor_3 = addslashes($actor_3);
$actor_4 = addslashes($actor_4);
//$tags = addslashes($tags);
$actors = addslashes($actors);
$actors_blank = addslashes($actors_blank);
$synop = addslashes($synop);
$synop_court = addslashes($synop_court);
$creator = addslashes($creator);
$userRating = addslashes($userRating);
$format = addslashes($format);
$yearstart_serie = addslashes($yearstart_serie);
$pays = addslashes($pays);
$pays_blank = addslashes($pays_blank);
$pays_1 = addslashes($pays_1);
$pays_2 = addslashes($pays_2);
$pays_3 = addslashes($pays_3);
$pays_4 = addslashes($pays_4);
$episodes_titre = addslashes(base64_encode(serialize($episodes_titre)));
$episodes_titre_vo = addslashes(base64_encode(serialize($episodes_titre_vo)));
$episodes_synop = addslashes(base64_encode(serialize($episodes_synop)));
$thumb_grand = addslashes($thumb);
$image = addslashes($image_petite);
$image_orginal = addslashes($image_orginal);
$serie_parzed = addslashes($serie_parzed)."|".$saison_actuelle;
$originalTitle = addslashes($originalTitle);
$productionStatus = addslashes($productionStatus); 
$originalChannel = addslashes($originalChannel);

$fich = $nompage;
$fp = fopen("series/".$fich,"w+");
fseek($fp,0,SEEK_SET);
fwrite($fp,$page);  
fclose($fp); 
$page = $nompage; echo '<a href="http://www.eos.to/series/'.$fich.'">lien</a>';
/////////////////////////////////////////////////////////////////////
$username = 'filmstr0_admin'; // MySQL username
$password = 'KwL4r19WBwV8';// MySQL password
/////////////////////////////////////////////////////////////////
if ($_GET["update"] == "1")
{
require_once 'inc/db.php';
	
$sql = "UPDATE aflam SET note = '".$userRating."' WHERE id='".$serie_parzed."'";
$pdo->exec($sql); 	
	
$sql = "UPDATE aflam SET tags = '".$tags."' WHERE id='".$serie_parzed."'";
$pdo->exec($sql); 	
	
$sql = "UPDATE aflam SET ba = '".$trailer."' WHERE id='".$serie_parzed."'";
$pdo->exec($sql); 		
}
else
{	
require_once 'inc/db.php';
$sql = "DELETE FROM aflam WHERE id='".$serie_parzed."'";
$pdo->exec($sql); 
unset($check);


	
require_once 'inc/db.php';
$sql = "INSERT INTO aflam(id, titre, titre_original,  genres_blank, actors_blank, director, anneprod, runtime, pays_blank, vote_allocine, synop, poster_small, nompage, afficher, votes_allocine, ba, type, nb_episodes, saison, maj, productionStatus, originalChannel, tags_allocine, docu_genre) VALUES('".$serie_parzed."', '".$titre."', '".$originalTitle."', '".$genres_blank."', '".$actors_blank."', '".$creator."', '".$yearstart_saison."', '".$format."', '".$pays_blank."', '".$userRating."', '".$synop."', '".$image_petite."', '".$nompage."', '".$afficher."', '".$nbuserRating."', '".$trailer."', 'saison', '".$nb_episode."', '".$saison_actuelle."', '$maj', '$productionStatus', '$originalChannel', '$tags-$tmdb_keywords', '$docu_genre' )";
$pdo->exec($sql); 	
}
////////////////////////////////////////////////////////////////////////////
function fread_url($url,$ref="")
    {
	        $theme = array('46.166.188.97', '46.166.188.98', '46.166.188.99', '46.166.188.101', '46.166.188.102', '46.166.188.103', '46.166.188.104', '46.166.188.105', '46.166.188.106', '46.166.188.107', '46.166.188.108', '46.166.188.109', '46.166.188.110', '46.166.188.111', '46.166.188.112', '46.166.188.113', '46.166.188.114', '46.166.188.115', '46.166.188.116', '46.166.188.117', '46.166.188.118', '46.166.188.119', '46.166.188.120', '46.166.188.121', '46.166.188.122', '46.166.188.123');
            $aleatoire = rand('0', count($theme)-1);
            $host = $theme[$aleatoire];
            $user_agent = "Mozilla/4.0 (compatible; MSIE 5.01; ".
                          "Windows NT 5.0)";            
						  $ch = curl_init();
			curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
		    curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
			curl_setopt($ch, CURLOPT_USERAGENT, $user_agent);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, $url );
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
            curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 5);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 2);
            $html = curl_exec($ch);
            curl_close($ch);
   
        return $html;
    }
function wd_remove_accents($str, $charset='utf-8')
{
    $str = htmlentities($str, ENT_NOQUOTES, $charset);
    
    $str = preg_replace('#&([A-za-z])(?:acute|cedil|circ|grave|orn|ring|slash|th|tilde|uml);#', '\1', $str);
    $str = preg_replace('#&([A-za-z]{2})(?:lig);#', '\1', $str); // pour les ligatures e.g. '&oelig;'
    $str = preg_replace('#&[^;]+;#', '', $str); // supprime les autres caractères
    
    return $str;
}
function trom($fiche)
{
$fiche=str_replace(CHR(10),"",$fiche);
$fiche=str_replace(CHR(13),"",$fiche);
$fiche=str_replace("\n","",$fiche);
$fiche = trim($fiche);

 return $fiche;
}	
function grab_image($url,$saveto){
    $ch = curl_init ($url);
    curl_setopt($ch, CURLOPT_PROXY, "138.68.146.74:3128");
	curl_setopt($ch, CURLOPT_PROXYUSERPWD, "adlalo:c89c89c89c89");
	curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0");
    curl_setopt($ch, CURLOPT_HEADER, 0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_BINARYTRANSFER,1);
    $raw=curl_exec($ch);
    curl_close ($ch);
    if(file_exists($saveto)){
        unlink($saveto);
    }
    $fp = fopen($saveto,'x');
    fwrite($fp, $raw);
    fclose($fp);
}

function translate($data)
    {
            
            $ips = array("104.237.211.35:53697", 
"172.93.239.238:53697", 
"108.62.95.248:53697", 
"173.208.9.25:53697", 
"64.120.85.100:53697", 
"172.241.144.42:53697", 
"172.241.145.199:53697", 
"45.59.21.151:53697", 
"45.59.25.187:53697", 
"23.19.4.196:53697", 
"108.62.169.220:53697", 
"142.91.235.54:53697", 
"108.62.142.83:53697", 
"108.62.232.63:53697", 
"108.62.53.6:53697", 
"216.107.136.70:53697", 
"216.107.139.76:53697", 
"216.107.141.47:53697", 
"45.59.16.194:53697", 
"45.59.31.22:53697", 
"23.81.128.172:53697", 
"23.81.129.185:53697", 
"23.81.132.190:53697", 
"23.106.163.103:53697", 
"23.106.164.1:53697", 
"144.217.132.235:53697", 
"54.39.65.103:53697", 
"144.168.171.19:53697", 
"144.168.172.133:53697", 
"45.67.62.191:53697", 
"45.67.63.12:53697", 
"104.227.224.93:53697", 
"104.227.225.249:53697", 
"92.222.226.92:53697", 
"5.196.245.196:53697", 
"79.137.58.37:53697", 
"31.186.36.72:53697", 
"31.186.37.79:53697", 
"31.186.38.85:53697", 
"31.186.39.81:53697", 
"185.4.168.64:53697", 
"185.4.169.75:53697", 
"31.186.33.124:53697", 
"78.157.203.108:53697", 
"78.157.204.194:53697");
            $aleatoire = rand('0', count($ips)-1);
            $host = $ips[$aleatoire];
    
            $ch = curl_init();
			curl_setopt($ch, CURLOPT_HTTPGET, 1 );
            curl_setopt($ch, CURLOPT_PROXY, $host);
			curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36");
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1 );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION , 1 );
            curl_setopt($ch, CURLOPT_URL, "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=fr&hl=fr&dt=t&dt=bd&dj=1&source=icon&tk=159684.159684&q=".urlencode($data));
			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt");
            curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt");
			curl_setopt($ch, CURLOPT_TIMEOUT, 5);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);
            $html = curl_exec($ch);
            curl_close($ch); echo $html.$host;
            sleep(0.25);
            $json_data = json_decode($html,true);
            $result = $json_data["sentences"][0]["trans"];
    
            if (!empty($result)) {
            return $result;
			 }
            else 
                return "";
    
}