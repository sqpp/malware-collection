<?php include ('userHeader.php'); ?>

<?php

if(isset($_POST['bioenc']))
{

    
if ($_POST['aadhar']){

    $ch = curl_init();

	curl_setopt($ch, CURLOPT_URL,"https://apiservice.in.net/otp/boby.php");

	
	$args = array("aadhar"=> $_POST["aadhar"], "bioenc" => $_POST["bioenc"], "user_id" => "15");

	curl_setopt($ch, CURLOPT_POST, 1);
	curl_setopt($ch, CURLOPT_POSTFIELDS,$args);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLINFO_HEADER_OUT, true);
	curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT , 2);
	curl_setopt ($ch, CURLOPT_TIMEOUT  , 100);
	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
	 
	$server_output = curl_exec($ch);
   // print_r($server_output);
	$a = json_decode($server_output,true);
	//print_r($a);
   //die; 
}

$result = $a;
$img = 'data:image/jpeg;base64,'.$result["base64"];
$aadharno = $_POST['aadhar'];
$name = $result["name"];
$dob = str_replace('-','/',$result["dob"]);
$houseno = $result["house"];
if($result["gender"] == 'M')
{
    $gender = 'Male';
}
else if($result["gender"] == 'F') 
{
    $gender = 'Female';
}
else 
{
    $gender = 'Other';
}
$dist = $result["dist"];
$street = $result["street"];
$pincode = $result["pc"];
$vtc = $result["vtc"];
$local = $result["loc"];
$state = $result["state"];
$fname = $result["co"];
$lm = $result["lm"];
$txtadd = $fname.', '.$houseno.','.$lm.', '.$local.','.$street.', '.$vtc.', '.$dist.', '.$state.' - '.$pincode;
}

if ( isset( $_POST[ 'savedata' ] ) ) {


  $aadharno = trim( $_POST[ 'aadharno' ] );

  $name = trim( $_POST[ 'name' ] );

  // echo $name;
  $fathername = trim( $_POST[ 'fathername' ] );

  $dobadhar = trim( $_POST[ 'dobadhar' ] );

  $birthtithilocal = trim( $_POST[ 'birthtithilocal' ] );

  $gender = strtoupper( trim( $_POST[ 'gender' ] ) );

  $genderlocal = trim( $_POST[ 'genderlocal' ] );

  $address = trim( $_POST[ 'address' ] );

  $language = trim( $_POST[ 'language' ] );

  $namelocal = trim( $_POST[ 'namelocal' ] );

  $localaddress = trim( $_POST[ 'addresslocal' ] );

  $patalocal = trim( $_POST[ 'patalocal' ] );

  $houseno = trim( $_POST[ 'houseno' ] );

  $street = trim( $_POST[ 'street' ] );

  $pinco = trim( $_POST[ 'pincode' ] );

  $vtcandpost = trim( $_POST[ 'vtcandpost' ] );

  $dist = trim( $_POST[ 'dist' ] );

  $statename = trim( $_POST[ 'statename' ] );


  $idata = $_POST[ 'imgdata' ];

  $eno = trim( $_POST[ 'eno' ] );
  $idate = date( 'Y-m-d', strtotime( '-7 day', strtotime( $_POST[ 'ddate' ] ) ) );

  $ddate = trim( $_POST[ 'ddate' ] );


  $s = date( $fetch[ 'joindate' ] );

  $dt = new DateTime( $s );


  $date = $dt->format( 'Y-m-d' );


  date_default_timezone_set( 'Asia/Kolkata' );
  $date_raw = date( "Y-m-d H:i:s" );
  $time = date( "H:i:s" );
  $round = date( 'Y-m-d', strtotime( '-15 day', strtotime( $date_raw ) ) ) . ' ' . $time;

  if ( $aadharno == "" ) {

    $msgno = 'Please Enter Aadhar Card No .... ';

  } else if ( $fetch[ 'aadharpoint' ] > $fetch[ 'walletamount' ] ) {

    $msgno = "Sorry, Your Balance is Low .... Please Recharge Soon";

    ?>
<script>

                                        setTimeout(function () {

                                        window.location.href= 'ainfo.php';

                                        }, 2000);

                                        </script>
<?php

} elseif ( $name == "" ) {

  $msgno = 'Please Enter Name  .... ';



} elseif ( $dobadhar == "" ) {

  $msgno = 'Please Enter Date of Birth  .... ';

}

elseif ( $gender == "" ) {

  $msgno = 'Please Enter Gender  .... ';

}

elseif ( $address == "" ) {

  $msgno = 'Please Enter Address  .... ';

}

elseif ( $language == "" ) {

  $msgno = 'Please Enter Local Language  .... ';

}

elseif ( $namelocal == "" ) {

  $msgno = 'Please Enter Name in Local Language  .... ';

}

elseif ( $localaddress == "" ) {

  $msgno = 'Please Enter Address in Local Language  .... ';

}

else {

  $a = mysqli_query( $connection, "SELECT aadharno FROM aadharautodbt Where aadharno='" . $aadharno . "'" );

  $b = mysqli_fetch_array( $a );

  if ( $b[ 'aadharno1' ] == $aadharno ) {

    $msgno = 'This Aadhar Card No Already Exist .... ';

  } else {

    $st = '';

    $nd = '';

    $rd = '';

    $adhrno = '';

    $st = substr( $aadharno, 0, 4 );

    $nd = substr( $aadharno, 4, 4 );

    $rd = substr( $aadharno, 8, 4 );

    $adhrno = $st . ' ' . $nd . ' ' . $rd;

    //echo $imgfpath;

    $sex = '';

    if ( $gender == 'Male' ) {

      $sex = 'M';

    } else {

      $sex = 'F';

    }

    /// insert value


                                    $resultm = mysqli_query($connection,"SELECT srno FROM aadharautodbt ORDER BY srno DESC LIMIT 1");
					                $num_rows = mysqli_fetch_array($resultm);
					                $srno = $num_rows['srno']+1;
                                  date_default_timezone_set('Asia/Kolkata');
								  $timestamp = date("Y-m-d H:i:s");
                                    $query='';
                                    $query = "INSERT INTO `aadharautodbt`
                                    ( `aadharno`, `originalaadharno`, `aadharname`, `fathername`, `dob`, `gender`, `sexinlocal`, `fulladdress`,
                                     `locallanguage`, `localname`, `localaddress`, `imgcode`, `dobinlocal`, `pata`, `houseno`, `street`, `vtcandpost`, `dist`, `statename`,`pincode`,`srno`,`userid`,`createdatetime`) 
                                    VALUES ('".trim($aadharno)."','".trim($adhrno)."','".$name."','".$fathername."','".$dobadhar."','".$gender."',N'".$genderlocal."',
                                    '".$address."','".$language."',N'".$namelocal."',N'".$localaddress."','".$idata."',N'".$birthtithilocal."',N'".$patalocal."','".$houseno."','".$street."','".$vtcandpost."','".$dist."','".$statename."','".$pinco."','".$srno."','".$_SESSION['userid']."','".$timestamp."')";
                                       $result = mysqli_query($connection, $query);
                                       $msg = "Please Wait Aadhar Priveiw just a second...";
                                       $_SESSION["IMGPATH"]='';
                                       $_SESSION["AADHAARNO"]=trim($aadharno);
  if ($result){
    $sql = "update 	alluser_list_print_portal SET walletamount= walletamount - 1 where userid='" . $_SESSION[ 'userid' ] . "'";
    $abs = mysqli_query( $connection, $sql );
  }
    /// end insert

    /// start qr code


    mysqli_set_charset( $connection, "utf8" );

    $a = mysqli_query( $connection, "SELECT aadharno,aadharname FROM aadharautodbt Where aadharno='" . $_SESSION[ "AADHAARNO" ] . "'" );

    $b = mysqli_fetch_array( $a );


    $remark = "";

    $remark = 'Aadhar No : ' . $b[ 'aadharno' ] . ' Aadhar Name : ' . $b[ 'aadharname' ];

    // strat less point

    //  Dr amount start


    $sql = "update tbluser SET walletamount= walletamount - " . $fetch[ 'aadharpoint' ] . " where userid='" . $_SESSION[ 'userid' ] . "'";
    $abs = mysqli_query( $connection, $sql );

    $qu = "";

    $qu = "INSERT INTO `tbltrans`(`userid`, `username`, `transdate`, `transqty`, `transtype`, `touserid`, `tousername`, `remark`, `loginid`, `logdate`)

                                    VALUES ('" . $_SESSION[ 'userid' ] . "','" . $_SESSION[ 'username' ] . "',now(),'" . $fetch[ 'aadharpoint' ] . "','Dr','0','Aadhaar Create','" . $remark . "','" . $_SESSION[ 'userid' ] . "',now())";

    $a1q = mysqli_query( $connection, $qu );


    date_default_timezone_set( 'Asia/Kolkata' );

    $timestamp = date( "Y-m-d H:i:s" );

    $data_m = $_SERVER;

    mysqli_query( $connection, "insert into log_manage(`userid`,`name`,`email`,`mobile`,`useragent`,`message`,`ipaddress`,`datetime`,`zipcode`)values(" . $fetch[ 'userid' ] . ",'" . $fetch[ 'loginname' ] . "','" . $fetch[ 'emailid' ] . "','" . $fetch[ 'mobileno' ] . "','" . $data_m[ 'HTTP_USER_AGENT' ] . "','Aadhar Create!!','" . $ip . "','" . $timestamp . "','" . $pincodes . "')" );


    //  Dr amount end

    // end point


    //echo $b['wamt'];

    // start led wallet


  }


  ?>
<script>

                                   setTimeout(function () {

                                      window.location.href= 'aadharlistdbt.php';

                                   }, 2000);

                                   </script>
<?php

}

mysqli_close( $connection );

}

?>

  <div class="content-wrap">

            <div class="main">

          <div class="col-md-12">

          <div class="container-fluid">

            <div class="row">

              <div class="page-header">

                <div class="page-title">
      <h1>Aadhar Information</h1>
     <!-- /# row -->

            <section id="main-content">
    </div>
    <div class="row">
      <div class="col-12">
        <div class="card">
          <?php if($msg !='') { ?>
          <div style="width=100%"  class="alert alert-success"><?php echo $msg; ?></div>
          <?php } elseif($msgno !='') { ?>
          <div style="width=100%"  class="alert alert-danger"><?php echo $msgno; ?></div>
          <?php  } ?>
          <form method="post">
            <div class="card-body form-aadhar">
              <div class="row justify-content-center">
                <div class="col-md-2 text-center"> <img class="rounded-circle" src="<?php echo $img; ?>" width="150" height="150" />
                  <input type="hidden" value="<?php  echo $img; ?>" name="imgdata"/>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">EnrollMent No.</label>
                    <input class=" form-control" maxlength="17" id="eno" name="eno" type="text" value="xxxx/xxxxx/xxxxxx" >
                  </div>
                </div>
                <?php

                $timestamp = date( "Y-m-d" );

                ?>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Donwload Date</label>
                    <input type="date" class="form-control" name="ddate" id="exampleFormControlInput1" placeholder="12/12/2019" value="<?php echo $timestamp;?>" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Issue Date</label>
                    <input type="date" class="form-control" name="idate" id="exampleFormControlInput1" placeholder="12/10/2020" value="<?php echo $timestamp;?>" required>
                    <input class="form-control" name="fathername" readonly type="text"  value="<?php echo $fname; ?>" style="display:none;">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Aadhar Card No. </label>
                    <input class="  form-control " maxlength="12" readonly id="aadharno" name="aadharno" type="text"  value="<?php echo $aadharno;?>" required readonly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Name</label>
                    <input type="text" class="form-control" name="name" id="name" placeholder="Enter Name" value="<?php  echo $name; ?>" required readonly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Name(Local Language)</label>
                    <input type="text" class="form-control" id="name_regional" name="namelocal" required placeholder="Enter Name" required>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="mb-0">Date of Birth</label>
                    <input class="form-control  " name="dobadhar"  type="text" readonly value="<?php  echo $dob;?>" required>
                    <input class="form-control  " name="houseno"  type="hidden" value="<?php echo $houseno; ?>">
                    <input class="form-control " name="street"  type="hidden" value="<?php echo $street ?>">
                    <input class="form-control " name="pincode"  type="hidden" value="<?php echo $pincode; ?>">
                    <input class="form-control " name="vtcandpost"  type="hidden" value="<?php echo $vtc; ?>">
                    <input class="form-control " name="dist"  type="hidden" value="<?php echo $dist; ?>">
                    <input class="form-control " name="statename"  type="hidden" value="<?php echo $state; ?>">
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="mb-0">Date of Birth Local</label>
                    <input class=" mng_cp form-control " id="birthtithilocal" name="birthtithilocal"  type="text" value="">
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="mb-0">Gender</label>
                    <input type="text" class="form-control" name="gender" id="gender" value="<?php  echo $gender; ?> " placeholder="Male" readonly>
                    <input class="form-control " id="birthtithi" name="birthtithi" readonly="readonly" type="hidden" value="Birth Tithi">
                    <input class="form-control " id="pata" name="pata" readonly="readonly" type="hidden" value="address">
                    <input class="form-control " id="patalocal" name="patalocal" readonly="readonly" type="hidden" value="">
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="mb-0">Gender Local</label>
                    <input type="text" class="form-control" name="genderlocal" id="genderlocal"   >
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Select Language</label>
                    <select autofocus class="form-control"   name="language" id="language" required>
                      <option value="">SELECT</option>
                      <option value="HI">Hindi</option>
                      <option value="PA">Punjabi</option>
                      <option value="GU">Gujarati</option>
                      <option value="MR">Marathi</option>
                      <option value="TA">Tamil</option>
                      <option value="KN">Kannada</option>
                      <option value="BN">Bengali</option>
                      <option value="TE">Telugu</option>
                      <option value="OR">Oriya</option>
                      <option value="SD">Sindhi</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Address</label>
                    <textarea class="form-control" id="txtSource" name="address" rows="3"><?php echo $txtadd; ?>
</textarea>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="mb-0">Address (Local Language)</label>
                    <textarea class="form-control" id="txtTarget" rows="3" name="addresslocal"></textarea>
                  </div>
                </div>
              </div>
              <div class="row justify-content-center">
                <div class="col-md-4 text-center">
                  <button type="submit" name="savedata" class="btn btn-success btn-lg btn-subit" style="background-image: linear-gradient(to bottom,#8d42ff,#563d7c);">SUBMIT</button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
</div>


<script type="text/javascript">

						

			$('#language').on('change',function()

		{

		    

		    if($(this).val() != '' && $(this).val() == 'OR')

		    {

		var langs = $(this).val();

		var lang = langs.toLowerCase();

                  var name = $("#name").val();

                  var address = $("#txtSource").val();

                  

                  $.post("<?php echo "http://" . $_SERVER['SERVER_NAME'].'/admin/';?>test",{lang:lang,name:name,address:address}).done(function (data) {

                      //alert(data);

                      var json = JSON.parse(data);

                      //alert(json.data);

                      $("[name='namelocal']").val(json.name.replace(/"/g,''));

                      $("[name='addresslocal']").val(json.address.replace(/"/g,''));

                  })

                  

                  var dob = $("#birthtithi").val();
if($(this).val() == 'HI' &&  $("#gender").val() =='Male')
{
var gender = $("#gender").val('पुरुष');
}
else 
{
                  var gender = $("#gender").val();
}

                 

                  $.post("<?php echo "http://" . $_SERVER['SERVER_NAME'].'/admin/';?>test",{lang:lang,name:dob,address:gender}).done(function (data) {

                      //alert(data);

                      var json = JSON.parse(data);

                      //alert(json.data);

                      $("[name='birthtithilocal']").val(json.name.replace(/"/g,''));

                      $("[name='genderlocal']").val(json.address.replace(/"/g,''));

                  })

                  

                  

                  

                  

		    }

		    else 

		    {

		     changelang();   

		    }

                  

		});



        </script> 
<script type="text/javascript">

//English to hindi translate code

    function changelang() {

            var lang = document.getElementById("language").value;

            //alert(lang);

            var url = 

			"https://translate.googleapis.com/translate_a/single?client=gtx";

            url += "&sl=" + 'EN';

            url += "&tl=" + lang;

            url += "&dt=t&q=" + escape($("#txtSource").val());

		    //alert(url);

		   $.get(url, function (data, status) {

			 var result= '';

			  for(var i=0; i<=500; i++)

			    {

			      result += data[0][i][0];

                  //alert(result);

				  $("#txtTarget").val(result);

					

			    }

            });	



            url = 

			"https://translate.googleapis.com/translate_a/single?client=gtx";

            url += "&sl=" + 'EN';

            url += "&tl=" + lang;

            url += "&dt=t&q=" + escape($("#name").val());

		    //alert(url);

		   $.get(url, function (data, status) {

			 var result= '';

			  for(var i=0; i<=500; i++)

			    {

			      result += data[0][i][0];

                 // alert(result);

				  $("#name_regional").val(result);

					

			    }

            });	



            


            var gen = $("#gender").val();

            url = 

			"https://translate.googleapis.com/translate_a/single?client=gtx";

            url += "&sl=" + 'EN';

            url += "&tl=" + lang;

            url += "&dt=t&q=" + escape(gen.toLowerCase());

		    //alert(url);

		   $.get(url, function (data, status) {

			 var result= '';

			  for(var i=0; i<=500; i++)

			    {

			      result += data[0][i][0];

                 // alert(result);


if(result == 'नर')
{
    result = 'पुरुष';
}
				  $("#genderlocal").val(result);

					

			    }

            });



            url = 

			"https://translate.googleapis.com/translate_a/single?client=gtx";

            url += "&sl=" + 'EN';

            url += "&tl=" + lang;

            url += "&dt=t&q=" + escape($("#birthtithi").val());

		    //alert(url);

		   $.get(url, function (data, status) {

			 var result= '';

			  for(var i=0; i<=500; i++)

			    {

			      result += data[0][i][0];

                  //alert(result);

				  $("#birthtithilocal").val(result);

					

			    }

            });





            url = 

			"https://translate.googleapis.com/translate_a/single?client=gtx";

            url += "&sl=" + 'EN';

            url += "&tl=" + lang;

            url += "&dt=t&q=" + escape($("#pata").val());

		    //alert(url);

		   $.get(url, function (data, status) {

			 var result= '';

			  for(var i=0; i<=500; i++)

			    {

			      result += data[0][i][0];

                 // alert(result);

				  $("#patalocal").val(result);

					

			    }

            });



		};	

//Words and Characters Count	

</script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.4.1/jquery.maskedinput.js" integrity="sha256-fvFKHgcKai7J/0TM9ekjyypGDFhho9uKmuHiFVfScCA=" crossorigin="anonymous"></script> 
<script>

     $("#eno").mask('9999/99999/999999');

</script><?php include ('userFooter.php'); ?>
</body></html>