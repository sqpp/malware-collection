<?php
	require_once('../database/connect.php');
	require_once('../database/getInfo.php');
	require_once('session-participant.php');
	
	if (!isset($_POST['email'])) {
        header('Location: ../');
		exit;
    }
	
	$firstname = htmlspecialchars(ucwords(strtolower($_POST['firstname'])), ENT_QUOTES);
	$lastname = htmlspecialchars(ucwords(strtolower($_POST['lastname'])), ENT_QUOTES);
	$displayname = $firstname." ".$lastname;
	$dob = $_POST['dob'];
	$nric = strtoupper($_POST['nric']);
	$mobile = $_POST['mobile'];
	$gender = $_POST['gender'];
	$jerseysize = $_POST['jerseysize'];
	
	$address = htmlspecialchars($_POST['address'], ENT_QUOTES);
	$country = $_POST['country'];
	$postalcode = $_POST['postalcode'];
	
	$sql = "UPDATE participant SET displayname='$displayname', firstname=AES_ENCRYPT('$firstname', '$mykeystring'), lastname=AES_ENCRYPT('$lastname', '$mykeystring'), dob=AES_ENCRYPT('$dob', '$mykeystring'), nric=AES_ENCRYPT('$nric', '$mykeystring'), mobile=AES_ENCRYPT('$mobile', '$mykeystring'), gender=AES_ENCRYPT('$gender', '$mykeystring'), address=AES_ENCRYPT('$address', '$mykeystring'), country=AES_ENCRYPT('$country', '$mykeystring'), postalcode=AES_ENCRYPT('$postalcode', '$mykeystring'), jerseysize='$jerseysize' WHERE pid='".$_SESSION['pid']."'";
	$conn->query($sql);
	
	$response = 'Your profile has been updated.';
	
	$conn->close();
	
	echo $response;
?>