<?php
	header('Content-Type: application/json');
	require('config.php');

	$docID = (int)$_POST['docid'];
	$status = $_POST['status'];
	$date = $_POST['appointmentdate'];

// 	$file = fopen("debug.txt", "w") or die("Unable to open file!");
// 	fwrite($file, "select afd.id as ID, afd.docID as doctorID, afd.clinicID, afd.puid as patientID, afd.status, afd.cancel_reason as cancelMessage, afd.appointmentdate as appoinntmentDate, afd.appointmenttime as appointmentTime, afd.appointmentfor as appointmentFor, dd.pd_full_name as doctorName, pd.pd_full_name as patientName, pd.pd_cell_no as patientCellNumber, pd.pd_gender as patientGender, c.name as clinicName, cod.appoitmentfee as appointmentFee, cod.appoitmentduration as appointmentDuration From tbl_appointmentfordoctor afd Inner join tbl_Personal_Data dd on afd.docID = dd.pd_uID Inner join tbl_Personal_Data pd on afd.puid = pd.pd_uID Inner join tbl_clinic c on afd.clinicID = c.id inner JOIN tbl_clinicofdoctors cod on afd.docID = cod.docid AND afd.clinicID = cod.clinicID where afd.docID = $docID AND afd.appointmentdate = '$date' and afd.status = '$status' order by afd.id");
// 	fclose($file);
	
	
//select afd.id as ID, afd.docID as doctorID, afd.clinicID, afd.puid as patientID, afd.status, afd.cancel_reason as cancelMessage, afd.appointmentdate as appoinntmentDate, afd.appointmenttime as appointmentTime, afd.appointmentfor as appointmentFor, dd.pd_full_name as doctorName, pd.pd_full_name as patientName, pd.pd_email as patientEmail, pd.pd_cell_no as patientCellNumber, pd.pd_gender as patientGender, c.name as clinicName, cod.appoitmentfee as appointmentFee, cod.appoitmentduration as appointmentDuration From tbl_appointmentfordoctor afd Inner join tbl_Personal_Data dd on afd.docID = dd.pd_uID Inner join tbl_Personal_Data pd on afd.puid = pd.pd_uID Inner join tbl_clinic c on afd.clinicID = c.id inner JOIN tbl_clinicofdoctors cod on afd.docID = cod.docid AND afd.clinicID = cod.clinicID where afd.docID = 1 AND afd.appointmentdate = '2021-09-09' and afd.status = 'pending';

	$result = $conn->query("select afd.id as ID, afd.docID as doctorID, afd.clinicID, afd.puid as patientID, afd.status, afd.cancel_reason as cancelMessage, afd.appointmentdate as appoinntmentDate, afd.appointmenttime as appointmentTime, afd.appointmentfor as appointmentFor, dd.pd_full_name as doctorName, pd.pd_full_name as patientName, pd.pd_cell_no as patientCellNumber, pd.pd_gender as patientGender, c.name as clinicName, cod.appoitmentfee as appointmentFee, cod.appoitmentduration as appointmentDuration From tbl_appointmentfordoctor afd Inner join tbl_Personal_Data dd on afd.docID = dd.pd_uID Inner join tbl_Personal_Data pd on afd.puid = pd.pd_uID Inner join tbl_clinic c on afd.clinicID = c.id inner JOIN tbl_clinicofdoctors cod on afd.docID = cod.docid AND afd.clinicID = cod.clinicID where afd.docID = $docID AND afd.appointmentdate = '$date' and afd.status = '$status' order by afd.id");
	


	$data = array();
	while($row = $result->fetch_assoc()) {
		$data[] = $row;
	}

	echo json_encode($data);
	$conn->close();
	return;

	//INSERT INTO `tbl_appointmentfordoctor` (`id`, `docid`, `docname`, `clinic`, `fee`, `status`, `message`, `appointmentdate`, `appointmenttime`, `appointmentduration`, `appointmentfor`, `patientemail`, `patientname`, `patientphone`, `patientgender`) VALUES (NULL, '1', 'Umer Saddiq', 'Alshifa', '1000', 'pending', '', '2021-05-04', '08:00 p.m.', '30 mins', 'Self', 'umairsiddiq', 'Umair Siddiq', '03123456789', 'Male');