<?php
$page_id=400;$page_slug='dashboard';
include("connect.php");
$_REQUEST['dispatch_id'] - implode(",", $_REQUEST['dispatch_id']);
?>
<table class="table table-borderd" border="1">
	<tr>
		<th colspan="3" class="text-center"><b>Dispatch Item Details</b></th>
	</tr>
	<tr>
		<th style="width: 15%;">Sr. No.</th>
		<th>Product Name</th>
		<th style="width: 25%;" class="text-right">	Requested Qty</th>
		<th class="text-right">	Remaining Qty</th>
		<th class="text-right">	Current Stock</th>
	</tr>
	<?php
		$items = $db->rp_getData("dispatch_item","pro_id,weight_id,pro_name,SUM(qty) AS qty","dispatch_id IN(".$_REQUEST['dispatch_id'].") GROUP BY pro_id,weight_id","",0);
		if($items){
			$count=0;
			while ($item=mysql_fetch_assoc($items)) {
				$PackingR = $db->rp_getData("packing_slip","id","dispatch_id IN(".$_REQUEST['dispatch_id'].")","",0);
				$PackingIds = array();
				while($PackingD = mysql_fetch_array($PackingR))
				{
					$PackingIds[] = $PackingD['id'];
				}
				$PackingIds = implode(",",$PackingIds);
				$packing_qty = $db->rp_getValue("packing_slip_item","SUM(pro_qty)","packing_slip_id IN (".$PackingIds.") AND pro_id='".$item['pro_id']."' AND weight_id='".$item['weight_id']."'",0);
				$remainingQty  = $item['qty'] - $packing_qty;
				$current_Stock = $db->rp_getValue("product_weight_price","stock_qty","product_id='".$item['pro_id']."' AND weight_id='".$item['weight_id']."'",0);
				?>
			<tr>
				<td><?= ++$count; ?></td>
				<td><?= $item['pro_name']; ?></td>
				<td class="text-right qty-class" data-final-poduct-weight-id="<?=$item['pro_id'];?>##<?=$item['weight_id'];?>" data-pro-id="<?=$item['pro_id'];?>" data-pro-weight="<?=$item['weight_id'];?>" data-pro-qty="<?=$item['qty']?>"><?=$db->rp_number_format($item['qty']);?></td>
				<td class="text-right qty-class"><?= $remainingQty; ?></td>
				<td class="text-right qty-class"><?= $current_Stock; ?></td>

			</tr>
	<?php
			}
		}
	?>
</table>