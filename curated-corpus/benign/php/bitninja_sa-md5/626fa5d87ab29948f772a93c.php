<?php 
include("includes/connection.php");
if(!isset($_SESSION['id']) && $_SESSION['id']==''){ 
 @header("Location:login.php");
}

include("includes/functions.php");

$id = '';

if(isset($_POST['submit']) && $_POST['submit']=='Submit'){
	
	if(isset($_FILES["banner_image"]["name"]) && $_FILES["banner_image"]["name"]!=''){
		@move_uploaded_file($_FILES["banner_image"]["tmp_name"],"../banners/" . $_FILES["banner_image"]["name"]);
		$banner_image=$_FILES["banner_image"]["name"];
		if(isset($_POST['banner_image_old']) && $_POST['banner_image_old']!=''){
			@unlink("../banners/" . $_POST['banner_image_old']);
		}
	}else{
		$banner_image= $_POST['banner_image_old'];
	}
	
	if(isset($_POST['mode']) && $_POST['mode']=='add'){
		// insert record
		$insert_sql = "INSERT INTO home_page_banners (banner_title, banner_link, banner_image, banner_desription, display_order, status, modify_date) VALUES ('".addslashes($_POST['banner_title'])."','".addslashes($_POST['banner_link'])."', '".addslashes($banner_image)."','".addslashes($_POST['banner_desription'])."','".addslashes($_POST['display_order'])."','".addslashes($_POST['status'])."', NOW());";
		mysql_query($insert_sql) or die(mysql_error());
	}else{
		// update record
		$update_sql = "UPDATE home_page_banners SET banner_title='".addslashes($_POST['banner_title'])."',banner_link='".addslashes($_POST['banner_link'])."',banner_image='".addslashes($banner_image)."',status='".addslashes($_POST['status'])."', banner_desription='".addslashes($_POST['banner_desription'])."', display_order = '".addslashes($_POST['display_order'])."', modify_date=NOW() WHERE id = '".$_POST['id']."'";
		mysql_query($update_sql);
	}
	@header("Location:show_banners.php");
}
if((isset($_GET['id']) && $_GET['id']!='') && (isset($_GET['value']) && $_GET['value']=='edit')){
	$value = $_GET['value'];
	$id = $_GET['id'];
	$select_sql = "select * from home_page_banners where id = '".$_GET['id']."'";
	$result = mysql_query($select_sql);
	$row=mysql_fetch_assoc($result);
}else{
	$value = 'add';
}?>
<!DOCTYPE html>
<html class="no-js before-run" lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description" content="bootstrap admin template">
  <meta name="author" content="">
  <title>Create New Banner | Admin Panel</title>
  <?php include("includes/header.php"); ?>
  <style type="text/css">
.fileupload-buttonbar .btn, .fileupload-buttonbar .toggle {
	margin-bottom: 5px;
}
.fileinput-button {
	position: relative;
	overflow: hidden;
	display: inline-block;
}
.fileinput-button input {
	position: absolute;
	top: 0px;
	right: 0px;
	margin: 0px;
	opacity: 0;
	font-size: 200px;
	direction: ltr;
	cursor: pointer;
}
</style>
  <script src="assets/js/ckeditor/ckeditor.js"></script>
  </head>
  <body>
<!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

<?php include("includes/navigation_top.php"); ?>
    <?php include("includes/navigation.php"); ?>
    
    <!-- Page -->
    <div class="page animsition">
    <div class="page-header">
        <h1 class="page-title"> Create New Banner </h1>
      </div>
    <div class="page-content">
        <div class="panel">
        <div class="panel-body container-fluid">
            <div class="row row-lg">
            <form class="form-horizontal" name="add_banner" id="add_banner" action="add_banner.php" method="post" enctype="multipart/form-data">
            <div class="col-sm-12 col-md-6"> 
                <!-- Example Horizontal Form -->
                <div class="example-wrap">
                <div class="example">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Banner Title: <span class="error">*</span></label>
                        <div class="col-sm-6 input-group">
                            <input type="text" name="banner_title" class="form-control" value="<?php if(isset($row['banner_title']) && $row['banner_title']!=''){ echo $row['banner_title']; } ?>"/>
                      	</div>
                  	</div>
                    
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Company Banner: <span class="error">*</span></label>
                        <div class="col-sm-6 input-group"> <span class="btn btn-success fileinput-button" ng-class="{disabled: disabled}"> <i class="icon fa-plus"></i>
                        <span>Add files...</span>
                    		<input name="banner_image" id="banner_image" ng-disabled="disabled" type="file">
                    	</span> 
                            <div><b>Note:</b> File size 1110 X 530</div>
                    	</div>
                  	</div>
                    <?php if(isset($row['banner_image']) && $row['banner_image']!=''){ ?>
                    <img src="../banners/<?php echo $row['banner_image']; ?>" height="100" />
                    <?php } ?>
                    <input type="hidden" value="<?php if(isset($row['banner_image'])){ echo $row['banner_image']; } ?>" name="banner_image_old">
                    
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Display Order: <span class="error">*</span></label>
                        <div class="col-sm-6 input-group">
                            <input type="text" name="display_order" class="form-control" value="<?php if(isset($row['display_order']) && $row['display_order']!=''){ echo $row['display_order']; } ?>" />
                     	</div>
                  
                  	</div>
                  
                  <div class="form-group">
                    <label class="col-sm-4 control-label">Banner Desription: </label>
                  </div>
                  
                  <div class="form-group">
                  	<div class="col-sm-6 input-group" style="width:100% !important;">
                        <textarea name="banner_desription" class="ckeditor" rows="25" style="width:100% !important;" ><?php if(isset($row['banner_desription']) && $row['banner_desription']!=''){ echo $row['banner_desription']; } ?>
</textarea>
                      </div>
                  </div>
                    <div class="form-group">
                    <label class="col-sm-4 control-label">Status: </label>
                    <div class="col-sm-8">
                        <div class="radio-custom radio-default radio-inline">
                        <input type="radio" <?php if(isset($row['status']) && $row['status']==1 && $value=='edit'){ ?> checked="" <?php }else{ ?> checked <?php } ?> value="1" name="status" id="status" >
                        <label for="inputLabelMale">Active</label>
                      </div>
                        <div class="radio-custom radio-default radio-inline">
                        <input type="radio" <?php if(isset($row['status']) && $row['status']==0 && $value=='edit'){ ?> checked="" <?php } ?> value="0" name="status" id="status">
                        <label for="inputLabelFemale">Inactive</label>
                      </div>
                      </div>
                  </div>
                    <div class="form-group">
                    <div class="col-sm-9 col-sm-offset-3">
                        <input type="hidden" name="mode" id="mode" value="<?php echo $value; ?>"/>
                        <input type="hidden" name="id" id="id" value="<?php echo $id; ?>"/>
                        <button type="submit" name="submit" id="submit_client_form" value="Submit" class="btn btn-primary">Submit </button>
                        <button type="button" onClick="window.location.href='show_banners.php';" class="btn btn-default btn-outline">Cancel</button>
                      </div>
                  </div>
                  </div>
              </div>
                <!-- End Example Horizontal Form --> 
              </div>
            
            <!-- End Example Horizontal Form -->
            </div>
          </form>
          </div>
      </div>
      </div>
  </div>
  </div>
<!-- End Page -->

<?php include("includes/footer.php"); ?>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script> 
<script src="http://jqueryvalidation.org/files/dist/additional-methods.min.js"></script> 
<script type="text/javascript">
  (function(document, window, $) {
      'use strict';
      var Site = window.Site;
      $(document).ready(function($) {
        Site.run();
      });
  });
  function isNumber(evt) {
		var charCode = (evt.which) ? evt.which : event.keyCode
         if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;

         return true;
  }
  $(document).ready(function() {
	$("#add_banner").validate({
			rules: {
				banner_title:{
					required:true,
				},
				banner_link:{
					required:true,
				},
				<?php 
			    if(!isset($_GET['id'])){
			    ?>
				banner_image:{
					required:true,
					extension:"jpg|png|bmp|jpeg|gif",
				},
				<?php } ?>
				status:{
					required:true,
					
				},
			},
			messages:{
			    <?php 
			    if(!isset($_GET['id'])){
			    ?>
				banner_image:{
					required: "<br/>Please upload any files",
					extension:'<br/>Please upload only file <br/>with png,bmp,gif,jpg,jpeg extension only'
				}
				<?php } ?>
			},
			onkeyup: false,
			
			onfocusout: function (element) {
				$(element).valid();
			},
			onclick: false,
			
		});
	});
  </script>
</body>
</html>