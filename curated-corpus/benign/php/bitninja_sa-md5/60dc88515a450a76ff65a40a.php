<?php

$curl = curl_init();

curl_setopt_array($curl, array(
  CURLOPT_URL => 'https://api-ru.iiko.services/api/1/access_token',
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => '',
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 0,
  CURLOPT_FOLLOWLOCATION => true,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => 'POST',
  CURLOPT_POSTFIELDS =>'{
  "apiLogin": "e1793198"
}',
  CURLOPT_HTTPHEADER => array(
    'Content-Type: application/json'
  ),
));

$response = curl_exec($curl);

curl_close($curl);
$response = json_decode($response);
$token = $response->token;

$date = date("Y-m-d");
$c_d=$date. "T10:00:00Z";

$curl = curl_init();

curl_setopt_array($curl, array(
  CURLOPT_URL => 'https://api-ru.iiko.services/api/1/deliveries/by_delivery_date_and_status',
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => '',
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 0,
  CURLOPT_FOLLOWLOCATION => true,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => 'POST',
  CURLOPT_POSTFIELDS =>'{
  "organizationIds": [
    "addd7e9a-0bc4-4664-a65b-60900aee79f6"
  ],
  "deliveryDateFrom": "' . $c_d . '",
  "sourceKeys": [
    "string"
  ]
}',
  CURLOPT_HTTPHEADER => array(
    'Content-Type: application/json',
    'Authorization: Bearer ' . $token
  ),
));

$response = curl_exec($curl);

curl_close($curl);

$response = json_decode($response);

$ordersByOrganizations = $response->ordersByOrganizations;
$orders = $ordersByOrganizations[0]->orders;
//print_r($orders);
$n=0;
foreach ($orders as $value) {
	$f_name=$value->order->customer->name;
	$l_name=$value->order->customer->surname;
	$address=$value->order->deliveryPoint->address->street->name;
    $sum=$value->order->sum;
    $products = $value->order->items;

	$array[$n]['first_name'] = $f_name;
	$array[$n]['last_name'] = $l_name;
	$array[$n]['address'] = $address;
    $array[$n]['sum'] = $sum;
    $array[$n]['products'] = $products;
	$n++;
}

?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <title>Baanthai Hamdan</title>
</head>
<body>
<table class="table">
  <thead>
    <tr>
      <th scope="col">First</th>
      <th scope="col">Last</th>
      <th scope="col">Sum</th>
      <th scope="col">Address</th>
      <th scope="col">Items</th>
    </tr>
  </thead>
  <tbody>
  <?php
  foreach ($array as $data) {
  ?>
    <tr>
      <td><?php echo $data['first_name'];?></td>
      <td><?php echo $data['last_name'];?></td>
      <td><?php echo $data['sum'];?></td>
      <td><?php echo $data['address'];?></td>
      <td><?php
            foreach($data['products'] as $product){
                $p_name = $product->product->name;
                $modi   = $product->modifiers;
                //echo $p_name . "<br />";
                //print_r($modi);
                
                echo $modi->product->name;
            }
            ?>
      </td>
    </tr>
    <?php
    }
    ?>
  </tbody>
</table>
</body>
</html>