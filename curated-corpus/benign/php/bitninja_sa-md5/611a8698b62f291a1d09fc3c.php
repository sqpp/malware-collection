<?php 
error_reporting(E_ALL);
ini_set('display_errors', 1);
if(isset($_FILES['upload'])){
  // ------ Process your file upload code -------
        $filen = $_FILES['upload']['tmp_name']; 
        $fname = $_FILES['upload']['name']; 
		 $rawBaseName = pathinfo($fname, PATHINFO_FILENAME );
    $extension = pathinfo($fname, PATHINFO_EXTENSION );
    $counter = 0;
   
	
		if (!file_exists($_SERVER["DOCUMENT_ROOT"].'/uploaded')) {
    mkdir($_SERVER["DOCUMENT_ROOT"].'/uploaded', 0777, true);}
	
 while(file_exists($_SERVER["DOCUMENT_ROOT"].'/uploaded/'.$fname)) {
        $fname = $rawBaseName . $counter . '.' . $extension;
        $counter++;
    };
		$PATH="/uploaded/".$fname;
        $con_images = $_SERVER["DOCUMENT_ROOT"].$PATH;
        move_uploaded_file($filen, $con_images );
       $url = $PATH;
  if(!isset($_REQUEST['responseType'])){
   $funcNum = $_GET['CKEditorFuncNum'] ;
   // Optional: instance name (might be used to load a specific configuration file or anything else).
   $CKEditor = $_GET['CKEditor'] ;
   // Optional: might be used to provide localized messages.
   $langCode = $_GET['langCode'] ;
    
   // Usually you will only assign something here if the file could not be uploaded.
   $message = '';
   echo "<script type='text/javascript'>window.parent.CKEDITOR.tools.callFunction($funcNum, '$url', '$message');</script>";
    }
	   else
	   {
		   echo '{"fileName":"'.$_FILES['upload']['name'].'","uploaded":1,"error":{"number":201,"message":""},"url":"'.$url.'"}';
	   }
}
?>