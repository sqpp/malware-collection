<?php
error_reporting(0);
include('connect-db.php');

$super_client=$_COOKIE["super_client"];
$company_id=$_COOKIE["company_id"];
$branch=$_COOKIE["branch"];
$branch_code=$_COOKIE["branch_code"];
$dp=$_COOKIE["dp"];
if ($dp==0) {$dp=2;}
$party_name = $_POST['party_name'];
$rs1 = mysql_query("SELECT * FROM party  where company_name='$super_client' and party_name='$party_name'") ;  
while($rw1 = mysql_fetch_array( $rs1 )) 
{
$cr1 = $rw1['cr'];
$dr1 = $rw1['dr'];
}

// If Amt <0 then CR, If Amt >=0 then DR  
$dr_cr=' DR';
$amt1 = $dr1-$cr1;
//if ($amt<0) {$dr_cr=' CR';}
//if ($amt>0) {$dr_cr=' DR';}


$rs2 = mysql_query("SELECT sum(dicount) as dicount,sum(payment_charge*qty) as payment_charge,sum(typing_charge*qty) as typing_charge,sum(amt) as amt,sum(vat) as vat FROM trx where tr_type='Typing' and  company_name='$super_client' and branch='$branch' and party_name = '$party_name' group by party_name");
while($rw2 = mysql_fetch_array( $rs2 )) 
{
$payment_charge = $rw2['payment_charge'];
$typing_charge = $rw2['typing_charge'];
$amt = $rw2['amt'];
$vat = $rw2['vat'];
$dicount = $rw2['dicount'];
}


//$rs3 = mysql_query("SELECT sum(dr) as dr FROM mrt where tr_type='RECEIPT' and from_account='$party_name'  ");
$rs3 = mysql_query("SELECT sum(dr) as dr FROM mrt where  from_account='$party_name' and (tr_type='RECEIPT' or tr_type='ADVANCE' ) ");
while($rw3 = mysql_fetch_array( $rs3 )) 
{
$paid = $rw3['dr'];	
}

$rs4 = mysql_query("SELECT sum(dr) as dr FROM mrt where tr_type='VOUCHER' and to_account='$party_name'  ");
while($rw4 = mysql_fetch_array( $rs4 )) 
{
$refund = $rw4['dr'];	
}

$amt2 = $amt+$vat-$dicount;
$amount = $amt1+$amt2-$paid+$refund;
if ($amount<0) {$dr_cr=' CR';}
if ($amount>0) {$dr_cr=' DR';}
echo number_format((float)$amount,$dp,'.','')  . $dr_cr;








?>