<html>
    <head>
        
    </head>
    <body>
        <h1>Krishann</h1>
        <form method="post" action="<?php echo $_SERVER["SELF"]; ?>">
            <input type="submit" name="submit" value="submit">    
        </form>
       
        
    </body>
</html>
<?php
//ob_start();
// echo phpinfo();
//https://data.gov.in/catalogs?search_api_views_fulltext=mandi&sort_by=search_api_relevance&sort_order=DESC&items_per_page=9
ini_set("allow_url_fopen", 1);
$district=array('Agra','Aligarh','Allahabad','Ambedkar Nagar','Amethi','Auraiya','Amroha','Firozabad','Mainpuri','Mathura','Etah','Hathras','Kasganj','Fatehpur','Kaushambi','Pratapgarh','Azamgarh','Ballia','Mau','Budaun','Bareilly','Pilibhit','Shahjahanpur','Basti','Sant Kabir Nagar','Siddharthnagar','Banda','Chitrakoot','Hamirpur','Mahoba','Bahraich', 
'Balarampur','Gonda','Shravasti','Barabanki','Faizabad','Sultanpur','Deoria','Gorakhpur','Kushinagar','Maharajganj','Deoria','Gorakhpur','Kushinagar','Maharajganj','Jalaun','Jhansi','Lalitpur','Etawah','Farrukhabad','Kannauj','Kanpur Dehat','Kanpur Nagar','Hardoi','Lakhimpur Kheri','Lucknow','Raebareli','Sitapur','Unnao','Bagpat','Bulandshahr','Gautam Buddha Nagar','Ghaziabad','Hapur','Meerut','Mirzapur','Sant Ravidas Nagar','Sonbhadra','Bijnor','Moradabad','Rampur','Sambhal','Muzaffarnagar','Saharanpur','Shamli','Chandauli','Ghazipur','Jaunpur','Varanasi','Bhopal','Raisen','Rajgarh','Sehore','Vidisha','Morena','Sheopur','Bhind','Gwalior','Ashoknagar','Shivpuri','Datia','Guna','Alirajpur','Barwani','Burhanpur','Indore','Dhar','Jhabua','Khandwa','Khargone','Balaghat','Chhindwara','Jabalpur','Katni','Mandla','Narsinghpur','Seoni','Dindori','Betul','Harda','Hoshangabad','Rewa','Satna','Sidhi','Singrauli','Chhatarpur','Damoh','Panna','Sagar','Tikamgarh','Niwari','Anuppur','Shahdol','Umaria','Agar Malwa','Dewas','Mandsaur','Neemuch','Ratlam','Shajapur','Ujjain','Garhwa','Palamu','Latehar','Chatra','Hazaribagh','Koderma','Giridih','Ramgarh','Bokaro','Dhanbad','Lohardaga','Gumla','Simdega','Ranchi','Khunti','West Singhbhum','Saraikela Kharsawan','East Singhbhum','Jamtara','Deoghar','Dumka','Pakur','Godda','Sahebganj','Ahmednagar','Akola','Amarawati','Aurangabad','Bandra(E)','Beed','Bhandara','Buldhana','Chandrapur','Dharashiv(Usmanabad)','Dhule','Gadchiroli','Gondiya','Hingoli','Jalana','Jalgaon','Kolhapur','Latur','Mumbai','Nagpur','Wardha25','Sindhudurg13','Osmanabad','Parbhani','Pune','Raigad','Ratnagiri','Nandurbar','Satara','Sholapur','Thane','Vashim','Yavatmal');

//if($_SERVER['REQUEST_METHOD']=='POST'){
    foreach ($district as $value) {
		echo "<br>";
    $api = "https://api.data.gov.in/resource/9ef84268-d588-465a-a308-a864a43d0070?api-key=579b464db66ec23bdd00000137be62ad1ad543a3731ee7c96e38f88f&format=json&filters[district]=".$value."";
	
    //var_dump($api);        //exit();
    //&fields=id,timestamp,district 
    //$api = 'https://data.gov.in/api/datastore/resource.json?resource_id=9ef84268-d588-465a-a308-a864a43d0070&api-key=7dbc4787db762706c7ec4cb3ec0fafba&filters[state]=Maharashtra';
//     $ch = curl_init();
// curl_setopt ($ch, CURLOPT_URL, $api);
// curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
// $contents = curl_exec($ch);
// curl_close($ch);
//     $result = $contents;
    $result = file_get_contents($api);
    $jsonData = json_decode($result,true);
   //var_dump($jsonData);        exit(); 
    //$conn=mysql_connect('localhost','shrimmco_krrish','krrish987@');
   // $conn=mysqli_connect('localhost', 'shrimmco_krrish', 'krrish987@', 'shrimmco_mandi');
//$conn = mysqli_connect("localhost","shrimmco_mandiap","@123mandiap","shrimmco_mandi");
//$conn = mysqli_connect("localhost","doctorg","Server2","Krishann");
$conn = mysqli_connect("localhost","agrowayc_krishi","?JCJv==;lhVY","agrowayc_krishi");
    //mysql_select_db("shrimmco_mandi");
    
    if (!$conn) {
    echo "Error: Unable to connect to MySQL." . PHP_EOL;
    echo "Debugging errno: " . mysqli_connect_errno() . PHP_EOL;
    echo "Debugging error: " . mysqli_connect_error() . PHP_EOL;
    exit;
}else{
    $state = $jsonData['records'][0]['state'];
    $count = COUNT($jsonData['records']);
    //var_dump($result);        
    // exit(); 
    $i=1;
    
   foreach($jsonData['records'] AS $row){
	   echo "<br>";
        //$i=
        $ID = $row['id'];
        $timestamp = $row['timestamp'];
        $state = $row['state'];
        $district = $row['district'];
        $market = $row['market'];
        $commodity = $row['commodity'];
        $variety = $row['variety'];
        $arrival_date = $row['arrival_date'];
        $min_price = $row['min_price'];
        $max_price = $row['max_price'];
        $modal_price = $row['modal_price'];
        $date = new DateTime("@$timestamp");
        $date_time = $date->format('Y-m-d H:i:s');
        
        $sqlstatement="INSERT INTO krishann_commodity (timestamp,state,district,market,commodity,variety,arrival_date,min_price,max_price,modal_price) VALUES ('$date_time','$state','$district','$market','$commodity','$variety','$arrival_date','$min_price','$max_price','$modal_price')";
        mysqli_query($conn,$sqlstatement)or die (mysqli_error($conn)); echo "Hi";
        $affected=mysqli_affected_rows($conn);
        if($affected===TRUE){
  echo"The query ran successfully";
        echo $affected;}
        
    }
   mysqli_close($conn);
   } 
   
   
}

?>


<?php 
?>

