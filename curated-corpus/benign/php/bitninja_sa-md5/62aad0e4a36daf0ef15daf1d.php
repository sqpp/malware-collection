<?php
if (isset($_POST['self']))
{
	require("config.php");
	switch ($_POST['self'])
	{
	case '1' :
	//echo '<link href="css/main.css" rel="stylesheet" type="text/css" />'; 
	if (!isset($_SESSION['lunaCalendar'])) $_SESSION['lunaCalendar']=0;
	if (isset($_POST['l'])) $_SESSION['lunaCalendar']+=$_POST['l'];
		$time=time();
		$zi1=date("d",$time);	// zi azi
		$luna1=date("m",$time);	// luna azi
		$anul1=date("Y",$time);	// an azi
		$time1=mktime(0,0,0,$luna1+$_SESSION['lunaCalendar'],1,$anul1);
		$prima_zi=getdate($time1);  					// 0 ->duminica
		$nr_zile=date("t",$time1);						// numarul de zile din luna
		$luna=date("m",$time1);
		$anul=date("Y",$time1);
		$prima_zi['wday'];
		if ($prima_zi['wday']==0) $prima_zi=7;			// se schimba prima zi in 1->luni 2->marti etc
			else $prima_zi=$prima_zi['wday'];
		echo '
		<table class="calendar"><tr>
		<tr><td class="titlu" colspan="7">Calendar Evenimente</td></tr>
		<tr>
			<td colspan="7" class="header">
			<button value="calendar.php#calendar#l=-1&self=1" style="float:left;background-color:transparent" onclick="loadPage(this.value,400,0,1,0,0)"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></button>
			'.mod_luna($luna).' '.$anul.'
			<button value="calendar.php#calendar#l=1&self=1" style="float:right;background-color:transparent" onclick="loadPage(this.value,400,0,1,0,0);"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button>
		</tr><tr>
			<td class="wday" width="14%">L</td>
			<td class="wday" width="14%">M</td>
			<td class="wday" width="14%">M</td>
			<td class="wday" width="14%">J</td>
			<td class="wday" width="14%">V</td>
			<td class="weekend wday" width="15%">S</td>
			<td class="weekend wday" width="15%">D</td>
		</tr><tr>';
		for ($i=1;$i<=($nr_zile+$prima_zi-1);$i++)
			{
			$azi='';
			$zi=$i-$prima_zi+1;
			if ((($i-1)%7)==0) echo'</tr><tr>';
			if (($i<$prima_zi)) echo '<td></td>';
				else 
					{
					$class='';$tooltip='';$existaEveniment=0;
					if (($zi1==$zi)&&($luna1==$luna)&&($anul1==$anul)) 
						{
						$class.=' azi';
						$tooltip.='<tooltipTitlu>AZI</tooltipTitlu>';
						}
					else $tooltip.='<tooltipTitlu>'.$zi.' '.mod_luna($luna).' '.$anul.'</tooltipTitlu>';
					$interval1=mktime(0,0,0,$luna,$zi,$anul);
					$interval2=mktime(23,59,59,$luna,$zi,$anul);
					$sql=$mysqli->query("SELECT * FROM articole WHERE articolActiv = '1' AND evenimentTime >= '".$interval1."' AND  evenimentTime <= '".$interval2."' ORDER BY evenimentTime");
					if ($sql->num_rows) $existaEveniment=1;
					while ($ev=$sql->fetch_assoc())
						$tooltip.="<event>".date("H:i",$ev['evenimentTime'])." - ". $ev['denumireArticol_'.$_SESSION['amgd']['lg']]."</event>";
					$data=date("Y-m-d",mktime(0,0,0,$luna,$zi,$anul));
					if ($sql->num_rows)
						$class.=' eveniment';
					if ((($i-1)%7)>=5)	$class.=' weekend';
					if ($existaEveniment)
						echo '<td><a href="page.php?tip=10&zi='.$zi.'" class="tooltip1 '.$class.'"  data-toggle="tooltip" title="'.$tooltip.'" data-html="true" data-placement="left" style="white-space: nowrap;">'.$zi.'</a></td>';
						else echo '<td><a class="tooltip1 '.$class.'" >'.$zi.'</a></td>';
					}
			}
		echo'</tr>
		</table>';
		break;
		}
}
else
{
}
	
?>
