<?php include("includes/functions.php"); 
if (isset($_GET['logout']) && ($_GET['logout']=='true'))
{
    unset($_SESSION['memberlogin']);
    unset($_SESSION['memberpasswd']);
    header("location:login.php?logout=true");
}

function totalwd_tahun($user,$tahun)
{
	$wd_sp=0;
	$ck_sp=mysql_query("SELECT sum(transfer_value) FROM withdrawalsp WHERE transfer_username='$user' AND transfer_crypto='0' AND year(transfer_request)='$tahun'");
	if (mysql_num_rows($ck_sp)>0)
	{
		$rwd=mysql_fetch_array($ck_sp);
		if ($rwd[0]!=NULL)
		{
			$wd_sp=$rwd[0];
		}
	}
	
	$wd_crypto=0;
	$ck_crypto=mysql_query("SELECT sum(transfer_value) FROM withdrawalsp WHERE transfer_username='$user' AND transfer_crypto='1' AND year(transfer_request)='$tahun'");
	if (mysql_num_rows($ck_crypto)>0)
	{
		$rc=mysql_fetch_array($ck_crypto);
		if ($rc[0]!=NULL)
		{
			$wd_crypto=$rc[0]*15000;
		}
	}
	$totalwd=$wd_sp+$wd_crypto;
	return $totalwd;
	
}

function pphnya($total_wd,$status_npwp)
{
	$o['potongan']=0;
	$o['level']=0;
	$o['batas_bawah']=0;
	$potongan=0;
	if (($total_wd>=0) && ($total_wd<=100000000)) {  $level=1; if ($status_npwp==1) { $potongan=2.5; } else { $potongan=3; } }
	if (($total_wd>100000000) && ($total_wd<=500000000)) { $o['batas_bawah']=100000000; $level=2; if ($status_npwp==1) { $potongan=7.5; } else { $potongan=9; } }
	if (($total_wd>500000000) && ($total_wd<=1000000000)) { $o['batas_bawah']=500000000; $level=3;  if ($status_npwp==1) { $potongan=12.5; } else { $potongan=15; } }
	if ($total_wd>1000000000)  {  if ($status_npwp==1) { $o['batas_bawah']=1000000000; $level=4; $potongan=15; } else { $potongan=18; } }
	$o['potongan']=$potongan;
	return $o;
}
function hitung_pajak($total_wd,$current_wd,$status_npwp)
{
	$d['pot1']=$d['pot2']=$d['val1']=$d['val2']=0;
	$d['skenario']=0;
	$akumulasi_wd=$total_wd+$current_wd;
	if (($total_wd>=0) && ($total_wd<=100000000)) { $level=1;  if ($status_npwp==1) { $potongan=2.5; } else { $potongan=3; } }
	if (($total_wd>100000000) && ($total_wd<=500000000)) { $level=2; if ($status_npwp==1) { $potongan=7.5; } else { $potongan=9; } }
	if (($total_wd>500000000) && ($total_wd<=1000000000)) { $level=3; if ($status_npwp==1) { $potongan=12.5; } else { $potongan=15; } }
	if ($total_wd>1000000000)  {  if ($status_npwp==1) { $level=4; $potongan=15; } else { $potongan=18; } }
	//echo "Potongan sebelumnya : $potongan % <br>";
	//echo "Akumulasi WD : $akumulasi_wd<br>";
	$aa=pphnya($akumulasi_wd,$status_npwp);
	$pphnya=$aa['potongan'];
	$batas_bawah=$aa['batas_bawah'];
	//echo "$pphnya -> $batas_bawah<br>";
	if ($pphnya>$potongan)
	{
		$selisih=$akumulasi_wd-$batas_bawah;
		$value_old=$batas_bawah-$total_wd;
		$d['pot1']=$potongan;
		$d['pot2']=$pphnya;
		$d['val1']=$value_old;
		$d['val2']=$selisih;
		//echo "Value Old : $value_old x $potongan %<br>";
		//echo "Selisih : $selisih x $pphnya %<br>";
		$d['skenario']=2;
	}
	else
	{
		$d['skenario']=1;
		$d['pot1']=$potongan;
		$d['val1']=$current_wd;
		//echo "$current_wd x $potongan %<br>";
	}
	return $d;
}
function totalbonus($user)
{
	$totalbonus=0;
	$ck=mysql_query("SELECT sum(bonus_value) FROM bonus WHERE bonus_username='$user' AND bonus_special='1'");
	if (mysql_num_rows($ck)>0)
	{
		$rb=mysql_fetch_array($ck);
		if ($rb[0]!=NULL)
		{
			$totalbonus=$rb[0];
		}
	}
	return $totalbonus;
}
function totalwd($user)
{
	$wd_sp=0;
	$ck_sp=mysql_query("SELECT sum(transfer_value) FROM withdrawalsp WHERE transfer_username='$user' AND transfer_crypto='0'");
	if (mysql_num_rows($ck_sp)>0)
	{
		$rwd=mysql_fetch_array($ck_sp);
		if ($rwd[0]!=NULL)
		{
			$wd_sp=$rwd[0];
		}
	}
	
	$wd_crypto=0;
	$ck_crypto=mysql_query("SELECT sum(transfer_value) FROM withdrawalsp WHERE transfer_username='$user' AND transfer_crypto='1'");
	if (mysql_num_rows($ck_crypto)>0)
	{
		$rc=mysql_fetch_array($ck_crypto);
		if ($rc[0]!=NULL)
		{
			$wd_crypto=$rc[0]*15000;
		}
	}
	$totalwd=$wd_sp+$wd_crypto;
	return $totalwd;
	
}
function mysaldo($user)
{
	
	$totbonus=totalbonus($user);
	$totwd=totalwd($user);
	$wallet_sp=$totbonus-$totwd;
	if ($wallet_sp<0)
	{
		$wallet_sp=0;
	}
	return $wallet_sp;
}

function cek_all($user)
{
	$total_wd_sp=0;
	$chk_wd_sp=mysql_query("SELECT sum(transfer_value) FROM withdrawalsp WHERE transfer_username='$user' AND transfer_cryto='0'");
	if (mysql_num_rows($chk_wd_sp)>0)
	{
		$row=mysql_fetch_array($chk_wd_sp);
		if ($row[0]!=NULL)
		{
			$total_wd_sp=$row[0];
		}
	}
	$total_wd_crypto=0;
	$chk_wd_crypto=mysql_query("SELECT sum(transfer_value) FROM withdrawalsp WHERE transfer_username='$user' AND transfer_cryto='1'");
	if (mysql_num_rows($chk_wd_crypto)>0)
	{
		$rc=mysql_fetch_array($chk_wd_crypto);
		if ($rc[0]!=NULL)
		{
			$total_wd_crypto=$rc[0]*15000;
		}
	}
	
	$total_wd=$total_wd_sp+$total_wd_crypto;
	
	$total_bonus=0;
	$chk_bonus=mysql_query("SELECT sum(bonus_value) FROM bonus WHERE bonus_username='$user' AND bonus_special='1'");
	if (mysql_num_rows($chk_bonus)>0)
	{
		$rb=mysql_fetch_array($chk_bonus);
		if ($rb[0]!=NULL)
		{
			$total_bonus=$rb[0];
		}
	}
	$total_wallet=0;
	if ($total_bonus>0)
	{
		$total_wallet=$total_bonus-$total_wd;
	}
	if ($total_wallet<0)
	{
		return false;
	}
	
	$akumulasi=$total_wd+$total_wallet;
	if ($akumulasi>$total_bonus)
	{
		return false;
	}
	else
	{
		return true;
	}
}

$session_user=mysql_real_escape_string($__member['username']);
$maintenance=false;
$list_allowed=array('admin');

if ((date('H:i:s')>='00:00:00') && (date('H:i:s')<'03:30:00'))
{
	$maintenance=true;
}

//$maintenance=true;
if (in_array($session_user,$list_allowed)) {  $maintenance=false; }
if ($maintenance)
{
	header("location:index.php?maintenance=true&page=transfer-bonus-sp");
}

function convert_currency($value,$lang='en')
{
	if ($lang=='en')
	{
		$val=$value/15000;
	}
	if ($lang=='id')
	{
		$val=$value;
	}
	return $val;
}

if ($__member['username']=='')
{
	header("location: login.php");
}
else
{
$wni=true;
	$show_transfer_form=false;
	$show_form_crypto=true;
	$show_crypto_tbl=false;
	$show_widget_kuota=$show_report=false;
	$session_user=mysql_real_escape_string($__member['username']);
	$date1=$date2=$today;
	$total_withdrawal=0;
	$filter="";
	$currency="IDR";
	$show_form_npwp=false;
	$wajib_pajak=false;
	$punyanpwp=0;
	$warning_npwp="";
	$data_npwp_tidak_lengkap=false;
	if (isset($_POST['submitnpwp']))
	{
		$npwp_number=mysql_real_escape_string($_POST['npwp']);
		$status_npwp=mysql_real_escape_string($_POST['punyanpwp']);
		$npwp_number= preg_replace('/[^0-9]+/', '', $npwp_number);
		if (($status_npwp=='1') && ($npwp_number==''))
		{
			$data_npwp_tidak_lengkap=true;
		}
		if (!$data_npwp_tidak_lengkap)
		{
			$updatenpwp=mysql_query("UPDATE profiles SET npwp_submit='$status_npwp', npwp_number='$npwp_number', npwp_submit_date='$tgl' WHERE profiles_username='$session_user'");
			if ($updatenpwp)
			{
				header("location:transfer-bonus-sp.php?npwp=submit&status=success");
			}
		}
		else
		{
			$warning_npwp="<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style='color:red;'>Nomor NPWP Belum diisi</div>";
		}
		
	}
	if (isset($_GET['npwp']) && ($_GET['npwp']=='submit') && isset($_GET['status']) && ($_GET['status']=='success'))
	{
		$warning_npwp="<div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\" style='color:green;'>Nomor NPWP berhasil dikirim</div>";
	}
	$status_npwp=2;
	$nomornpwp="";
	$npwp_submit_date="";
	$chkprofiles=mysql_query("SELECT * FROM profiles WHERE profiles_username='$session_user'");
	if (mysql_num_rows($chkprofiles)>0)
	{
		$row=mysql_fetch_array($chkprofiles);
		$show_widget_kuota=true;
		$tahun=date('Y');
		$total_withdrawal=totalwd_tahun($session_user,$tahun);
		if ($row['profiles_country']=='ID')
		{
			$show_form_crypto=false;
			$show_transfer_form=true;
			$lang='id';
			$currency="IDR";
			$txt_bank="Data Bank";
			$min_wd=100000;
			$wd_crypto_status=0;
			$wni=true;
			$status_npwp=$row['npwp_submit'];
			$nomornpwp=$row['npwp_number'];
			$npwp_submit_date=$row['npwp_submit_date'];
			if ($row['npwp_submit']=='0')
			{
				$show_form_npwp=true;
			}
			if ($row['npwp_submit']>0)
			{
				if ($row['npwp_submit']=='1')
				{
					$wajib_pajak=true;
				}
				if ($row['npwp_submit']=='2')
				{
					$wajib_pajak=false;
					$punyanpwp=2;
				}
			}
			
		}
		else
		{
			$lang='en';
			$currency="USD";
			$min_wd=10;
			$txt_bank="Data Crypto";
			$wd_crypto_status=1;
			$wni=false;
		}
		
		$ck_crypto=mysql_query("SELECT * FROM crypto_member WHERE crypto_userid='$session_user'");
		if (mysql_num_rows($ck_crypto)>0)
		{
			$show_transfer_form=true;
			$show_form_crypto=false;
			if (!$wni)
			{
				$show_crypto_tbl=true;
			}
			$rc=mysql_fetch_array($ck_crypto);
		}
	}
	
function cek_wd_today($user)
{
	global $today;
	$chk=mysql_query("SELECT * FROM withdrawalsp WHERE transfer_username='$user' AND date(transfer_request)='$today'");
	if (mysql_num_rows($chk)>0)
	{
		return true;
	}
	return false;
}
function status_wd($status)
{
	if ($status=='0') { $status_orders='<span class="label label-danger">Pending</span>'; }
	if ($status=='1') { $status_orders='<span class="label label-success">Transfered</span>'; }
	if ($status=='5') { $status_orders='<span class="label label-warning">Canceled</span>'; }
	if ($status=='20') { $status_orders='<span class="label label-danger">Pending - Nama tidak sesuai</span>'; }	
	if ($status=='21') { $status_orders='<span class="label label-danger">Pending - Nomor Rekening tidak sesuai</span>'; }									
	
	echo $status_orders;
}	
	$warning="";
	$get_transaction="SELECT * FROM withdrawalsp WHERE transfer_username='$session_user' ORDER BY transfer_id DESC";
	$query_get_transaction=mysql_query($get_transaction);
	$num_transaction=mysql_num_rows($query_get_transaction);
	
	if ($num_transaction>0)
	{
		$show_report=true;
	}
	
	$ewallet_balance=0;
	$ewallet_paid=0;
	$ewallet_balance_pairing=0;
	$ewallet_balance_pairing_500=0;
	$ewallet_plus=0;
	$check_ewallet=mysql_query("SELECT * FROM profiles WHERE profiles_username='$session_user'");
	if (mysql_num_rows($check_ewallet)>0)	
	{
		$row_ewallet=mysql_fetch_array($check_ewallet);
		
		if ($currency=='USD')
		{
		$min_wd=10;
		}
		if ($currency=='IDR')
		{
		$min_wd=100000;
		}
		
		
		$ewallet_balance=mysaldo($session_user);
		
		$ewallet_balance_usd=convert_currency($ewallet_balance,$lang);
		
		
		$bank=$row_ewallet['profiles_bank'];
		$norek=$row_ewallet['profiles_acc'];
		
		$cryptoname=mysql_real_escape_string($rc['crypto_name']);
		$cryptoaddress=mysql_real_escape_string($rc['crypto_address']);
		
		if ($lang=='id')
		{
			$data_bank=mysql_real_escape_string($bank);
			$data_norek=$norek;
			
		}
		else
		{
			$data_bank=$cryptoname;
			$data_norek=$cryptoaddress;
		
		}
		
       $acc_name=mysql_real_escape_string($row_ewallet['profiles_holder']);
       $cabang=mysql_real_escape_string($row_ewallet['profiles_branch']);
		
		if (isset($_POST['withdraw']) && ($_POST['wallet']))
		{
			$cek_all=cek_all($session_user);
			if ($cek_all)
			{	
				$wd_wallet=mysql_real_escape_string($_POST['wallet']);
				$chk_wd_today=cek_wd_today($session_user);
				if (!$chk_wd_today)
				{
					if ($wd_wallet>=$min_wd)
					{

						if ($wd_wallet<=$ewallet_balance_usd)
						{
						$nilai_transfer=$wd_wallet;
						$telp=$row_ewallet['profiles_phone'];
						$am=0;
						$admin_fee=0;
						if ($wni) { $admin_fee=15000; if ($bank=='BNI') { $admin_fee=10000; }  } 


						$transfer_after_am=$nilai_transfer-$am;
						$tax_value1=$tax_value2=0;
						if ($wni)
						{
							//$pajak=($transfer_after_am*5)/100;

							//$pajak=ceil($pajak);
							$pjk=hitung_pajak($total_withdrawal,$transfer_after_am,$status_npwp);
							$skenario=0;
							if ($pjk['skenario']>0)
							{
								if ($pjk['skenario']==2)
								{
									$skenario=$pjk['skenario'];
									$pot1=$pjk['pot1'];
									$val1=$pjk['val1'];
									$tax_value1=($val1*$pot1)/100;
									$pot2=$pjk['pot2'];
									$val2=$pjk['val2'];
									$tax_value2=($val2*$pot2)/100;
									//echo "Pajak 1 : $val1 x $pot1 %<br>";
									//echo "Pajak 2 : $val2 x $pot2 %<br>";
								}
								if ($pjk['skenario']==1)
								{
									$skenario=$pjk['skenario'];
									$pot1=$pjk['pot1'];
									$val1=$pjk['val1'];
									$tax_value1=($val1*$pot1)/100;

									//echo "Pajak 1 : $val1 x $pot1 %<br>";
								}
								$total_pajak=$tax_value1+$tax_value2;
								$pajak=ceil($total_pajak);
							}
						}
						else
						{
							$pajak=0;
						}

						$transfer_after_pajak=$transfer_after_am-$pajak;

						$transfer_after_adm=$transfer_after_pajak-$admin_fee;



							 $transfer_sql="INSERT INTO `withdrawalsp` (`transfer_username`, `transfer_value`, `transfer_after_fee`, `transfer_request`, `transfer_date`, `transfer_status`, `transfer_by`, `transfer_fee`, `transfer_name`, `transfer_bank`, `transfer_acc`, `transfer_cabang`, `transfer_no_hp`, `transfer_update_date`, `transfer_sms`, `transfer_keterangan`, `wd_wallet`, `wd_pairing`, `wd_share_klik`, `wd_pairing_500`, `wd_automenten`, `wd_periode`, `wd_ket2`, `wd_ket_error`, `wd_info`, `wd_am`, `wd_pajak`,`transfer_crypto`,`tax_scenario`,`tax1`,`tax_val1`,`tax2`,`tax_val2`) VALUES
				('$row_ewallet[profiles_username]', '$nilai_transfer', '$transfer_after_adm', '$tgl', '$tgl', 0, '', '$admin_fee', '$acc_name', '$data_bank', '$data_norek', '', '$telp', '0000-00-00 00:00:00', 0, '', 0.00, 0.00, 0.00, 0.00, 0.00, 0, '', '', '', '$am', '$pajak','$wd_crypto_status','$skenario','$pot1','$tax_value1','$pot2','$tax_value2');
				";
							$newwd=mysql_query($transfer_sql);
							if ($newwd)
							{
								if ($currency=='USD')
								{
									$nilai_transfer=$nilai_transfer*15000;

								}
								
								$update=mysql_query("UPDATE special_wallet SET ewallet_balance=ewallet_balance-$nilai_transfer, date_wd='$tgl' WHERE ewallet_username='$session_user'");
								$new_history=mysql_query("INSERT INTO history_wd_sp (hws_username,hws_value,hws_tgl,hws_currency,hws_balance_before) VALUES ('$row_ewallet[profiles_username]','$nilai_transfer','$tgl','$currency','$ewallet_balance')");
								if ($update)
								{
									header("location:transfer-bonus-sp.php?proses=sukses");
								}
								
								
							}
						}
						else
						{
							$warning="<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style='color:red;'>Ewallet Balance is not Enough</div>";
						}
					}
					else
					{
						$warning="<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style='color:red;'>Min. Withdrawal $currency ".number_format($min_wd,0,",",".").",-</div>";
					}
				}
				else
				{

					$warning="<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style='color:red;'>Max. Withdrawal Request = 1 per Day</div>";
				}
			}
			else
			{
				$warning="<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style='color:red;'>Account is under review, you cannot withdraw for temporary </div>";
			}
		}
	}
	else
	{
		$warning="<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\" style='color:red;'>Ewallet Not Found</div>";
	}
}

if (isset($_POST['saveaccount']))
{
	$crypto_name=mysql_real_escape_string($_POST['crypto_name']);
	$crypto_address=mysql_real_escape_string($_POST['crypto_address']);
	$chkcrypto=mysql_query("SELECT * FROM crypto_member WHERE crypto_userid='$session_user'");
	if (mysql_num_rows($chkcrypto)==0)
	{
		$newcrypto=mysql_query("INSERT INTO crypto_member (crypto_userid,crypto_name,crypto_address,crypto_date,crypto_status) VALUES ('$session_user','$crypto_name','$crypto_address','$tgl','1')");
		if ($newcrypto)
		{
			header("location:transfer-bonus-sp.php?addnewcrypto=true");
		}
	}
}

if (isset($_GET['addnewcrypto']) && ($_GET['addnewcrypto']=='true'))
{
	$warning="<div style='padding:10px;'><div class=\"alert alert-success\">New Account Crypto has been successfully added</div></div>";
}


if (isset($_GET['proses']) && ($_GET['proses']=='sukses'))
{
	$warning="<div style='padding:10px;'><div class=\"alert alert-success\">Withdrawal Process has been Successfully Sent</div></div>";
}

?>
<?php include("header.php"); ?>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-withdrawal">
                            
                            <div class="card-body">
							<h4 class="card-title"><?php echo sp_e_wallet_balance_txt; ?> : <?php echo $currency; ?> <strong><?php $ewallet_balance=convert_currency($ewallet_balance,$lang); echo number_format($ewallet_balance,2); ?></strong></h4>
							
							<?php if ($show_crypto_tbl) { ?>
								<div style="padding: 10px 0; margin: 10px 0;">
									<h5>Your Crypto Address</h5>
								<p>Crypto Name : <strong><?php echo $rc['crypto_name']; ?></strong><br>
									Crypto Address : <strong><?php echo $rc['crypto_address']; ?></strong></p>
								
								</div>
							<?php } ?>	
								
							
                            
                            <div class="row">
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <div class="card">
                                        <div class="card-body">
										<?php echo $warning; ?>
										<!--<div class="alert alert-danger d-flex align-items-center" role="alert">
											<p style=" margin-bottom: 0; "><?php //echo panding_wd_txt; ?></p>
										</div>-->
										<!--<div class="alert alert-danger d-flex align-items-center" role="alert">Hari ini (11 Januari 2022), Manajemen Pansaka belum bisa memproses withdrawal dikarenakan masalah teknis</div>-->
											<h4 class="card-title" style=" color: red; font-weight: 300; text-decoration: underline; "><?php echo pengumuman_txt; ?>!</h4>
											<ol style=" padding: 0 0 0 20px; ">
                                                                
                                         <li><?php echo Withdrawal1_txt; ?><a href="https://pansaka.co.id/panel/bank.php"><?php echo call_center_disini_txt; ?></a></li>
                                                                <li><?php echo Withdrawal2_txt; ?></li>
																<li><?php echo Withdrawal3_txt; ?></li>
                                                            </ol>
                                           <?php echo $warning_npwp; ?>
											<?php if ($show_transfer_form) { ?>
											<?php if ($show_form_npwp) { ?>
											<h4 class="card-title">Form Submit NPWP</h4>
											
                                            <form method="post" name="wd" action="transfer-bonus-sp.php" enctype="application/x-www-form-urlencoded">
												<div class="form-group">
													
                                                    <select name="punyanpwp" class="form-select" required>
													  <option value="" <?php if (isset($punyanpwp) && ($punyanpwp=='0')) { echo "selected"; } ?>>-- Sudah Ada  NPWP Pribadi?</option>
													  <option value="1" <?php if (isset($punyanpwp) && ($punyanpwp=='1')) { echo "selected"; } ?> >Ada</option>
													  <option value="2" <?php if (isset($punyanpwp) && ($punyanpwp=='2')) { echo "selected"; } ?>>Tidak Ada</option>
													  
													</select>
													
                                                </div>
                                                <div class="form-group">
													
                                                    <input name="npwp" type="text" class="form-control" id="npwp" placeholder="Nomor NPWP" aria-label="">
                                                   
													
                                              </div>
												 <div class="form-group">
												<button name="submitnpwp" class="btn btn-success">SUBMIT NPWP</button></div>
                                            </form>
											<?php } else { ?>
											 <h4 class="card-title"><?php echo sp_withdrawal_komisi_txt; ?></h4>
                                            <h6 class="card-subtitle"><?php echo sp_form_withdrawal_komisi_special_program_txt; ?></h6>
                                           <form method="post" name="wd" action="transfer-bonus-sp.php" enctype="application/x-www-form-urlencoded">
                                                <div class="form-group">
													
                                                    <input name="rupiah" type="text" required class="form-control" id="rupiah" placeholder="0" aria-label="">
                                                    <input type="hidden" name="wallet" id="wallet" value="0">
                                                    <label style="color:red; font-size:11px;display: block;">Minimum Withdrawal <?php echo "$currency $min_wd"; ?></label>
													
                                                <button name="withdraw" class="btn btn-success"><?php echo sp_withdraw_txt; ?></button></div>
                                            </form>
											<?php } ?>
											<?php } ?>
											
											<?php if ($show_form_crypto) { ?>
											<h3>Add New Crypto Address</h3>
                                            <form class="m-t-25" method="post" action="transfer-bonus-sp.php" enctype="application/x-www-form-urlencoded">
                                                <div class="form-group">
													<label for="crypto_name">Crypto Name</label>
                                                    <select class="form-control" id="cryptoname" name="crypto_name" required>
													  <option value="">-- Select Crypto Name</option>
														<option value="BTC">BTC</option>
													  <option value= "LTC">LTC</option>
														<option value="ETH">ETH</option>
														<option value="USDT.ERC20">USDT.ERC20</option>
													</select>
                                                    
												</div>
												<div class="form-group">
												<label for="crypto_address">Crypto Address</label>
													<input type="text" class="form-control" id="crypto_address" name="crypto_address" placeholder="Your Crypto Address" required>
												</div>
												<div class="form-group">
                                                	<button type="submit" name="saveaccount" class="btn btn-success">Save Account</button>
												</div>
                                            </form>
											<?php } ?>
                                        </div>
                                    </div>
                                </div>
                            
                            </div>
                            
                                		 <?php if ($show_report) { $ii=0; ?>
                                <?php if (($wni) && ($status_npwp>0)) {  ?>
								<div class="card">
									
									<div class="card-body">
										<h5 class="card-title">Status Wajib Pajak</h5>
										<p align="left">Status NPWP : <?php if ($status_npwp==1) { echo "<span class='text-success'>Ada</span>"; } else { echo "<span class='text-danger'>Tidak Ada</span>"; } ?></p>
										<?php if ($status_npwp==1) { ?>
										<p align="left">Nomor NPWP : <?php echo "<span class='text-info'>$nomornpwp</span>"; ?></p>
										<?php } ?>
										<p align="left">Submit Tgl : <?php echo $npwp_submit_date; ?></p>
									</div>
								</div>
								<?php } ?>
										<div class="table-responsive">
											<table class="table table-hover">
												<thead>
													<tr>
														<th>#</th>

														<th><?php echo $txt_bank; ?></th>
														

														<th>Wallet</th>
														<th><?php echo sp_duty_tax_txt; ?></th>
														<th><?php echo sp_adm_fee_txt; ?></th>
														
														<th><?php echo sp_transfer_value_txt; ?></th>
														<th><?php echo sp_tanggal_txt; ?></th>
														
													   <th><?php echo sp_tanggal_konfirmasi_txt; ?></th>
														<th><?php echo sp_status_txt; ?></th>

													</tr>
												</thead>
												<tbody>
												<?php $total_transfer_val=0; while($rw=mysql_fetch_array($query_get_transaction)) { 
												$status_orders="";
												if ($rw['transfer_status']=='0') { $status_orders='<span class="label label-danger">Pending</span>'; }
												if ($rw['transfer_status']=='1') { $status_orders='<span class="label label-success">Transfered</span>'; }
												$trx_crypto_id="";
												if ($rw['trx_crypto_id']!='')
												{
													$trx_crypto_id="<br> Trx ID : $rw[trx_crypto_id]";
													
												}
												$ketwd_crypto="";
												if ($rw['transfer_keterangan']!='')
												{
													$ketwd_crypto="<br>$rw[transfer_keterangan]";
												}
												$total_transfer_val+=$rw['transfer_value'];

												?>
													<tr <?php if ($rw['wd_ket_error']!='') { echo "bgcolor=\"#ffe8f1\""; } if ($rw['transfer_keterangan']=='fee') { echo "bgcolor=\"#f0fbfc\""; } ?>>
														<td><?php echo ++$ii; ?></td>

														<!--<td><?php //echo "$rw[transfer_bank] , $rw[transfer_name], $rw[transfer_acc]"; if ($rw['transfer_update_date']!='0000-00-00 00:00:00') { echo '<h6 class="color-green">Updated data on  <small class="text-muted">'.$rw['transfer_update_date'].'</small></h6>'; } ?></td>-->
														<td><?php echo "$rw[transfer_bank]<br> $rw[transfer_acc]<br> $rw[transfer_name] "; if ($rw['transfer_update_date']!='0000-00-00 00:00:00') { echo '<h6 class="color-green">Updated data on  <small class="text-muted">'.$rw['transfer_update_date'].'</small></h6>'; } ?></td>
														<td><?php echo "$currency ".number_format($rw['transfer_value'],2,",","."); ?></td>
														<td><?php $fee_admin=$rw['wd_pajak']; echo "$currency ".number_format($fee_admin,2,",","."); ?></td>
													   <td><?php $fee_admin=$rw['transfer_fee']; echo "$currency ".number_format($fee_admin,2,",","."); ?></td>
													   
													   <td><?php echo "$currency ".number_format($rw['transfer_after_fee'],2,",","."); ?></td>

														<td><?php echo date('d F Y',strtotime($rw['transfer_request'])); ?></td>
														
														<td><?php echo $rw['transfer_date']; ?></td>
														<td><?php status_wd($rw['transfer_status']); if ($rw['transfer_crypto']=='1') { echo "$ketwd_crypto $trx_crypto_id"; } ?></td>
													</tr>
											   <?php } ?>     

													<tr>
														<td>&nbsp;</td>
														<td>TOTAL</td>
														<td><?php echo "$currency ".number_format($total_transfer_val,0,",","."); ?></td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
													</tr>
												</tbody>
											</table>
										</div>

										<?php } else { ?>
										<div class="alert alert-warning"><?php echo rp_ltr_transaksi_withdrawal_tidak_ditemukan_txt; ?></div>
										<?php } ?>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                
<?php include("footer.php"); ?>
<script>
var rupiah = document.getElementById('rupiah');

		rupiah.addEventListener('keyup', function(e){
			// tambahkan 'Rp.' pada saat form di ketik
			// gunakan fungsi formatRupiah() untuk mengubah angka yang di ketik menjadi format angka
			
			rupiah.value = formatRupiah(this.value, '<?php echo $currency; ?> ');
		});
 
		/* Fungsi formatRupiah */
		function formatRupiah(angka, prefix){
			var wallet = document.getElementById('wallet');
			
			var number_string = angka.replace(/[^,\d]/g, '').toString(),
			split   		= number_string.split(','),
			sisa     		= split[0].length % 3,
			rupiah     		= split[0].substr(0, sisa),
			ribuan     		= split[0].substr(sisa).match(/\d{3}/gi);
 
 
 wallet.value=number_string;
			// tambahkan titik jika yang di input sudah menjadi angka ribuan
			if(ribuan){
				separator = sisa ? '.' : '';
				rupiah += separator + ribuan.join('.');
			}
 
			rupiah = split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
			return prefix == undefined ? rupiah : (rupiah ? '<?php echo $currency; ?> ' + rupiah : '');
		}
</script>