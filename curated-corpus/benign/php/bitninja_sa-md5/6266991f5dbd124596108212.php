<?php
require "application.php";
$users=Checkuser::checkLogin();
$upload_dir="../upload/gallaryImages/";

$post=Getpost::getPostdata('post');
$objGlobalFunction=new GlobalFunction();

if(isset($post['action'])) : 
$action=$post['action']; 
endif;

switch($action)
{	
	case 'insert':
	
	  if($_FILES['data']['name']['file_name']!=""):
			$file_name=time()."_".$_FILES['data']['name']['file_name'];
			$tmp_name=$_FILES['data']['tmp_name']['file_name'];
			$file_size=$_FILES['data']['file_name']['size'];
			move_uploaded_file($tmp_name,$upload_dir.$file_name);
			/**************************** Thumbnail Creation *********************************/
			GlobalFunction::MakeThumbnailNew($upload_dir,$file_name,180,120,'');
			/**************************** Thumbnail Creation *********************************/
		else :
			$file_name = $_REQUEST['backup_image'];
		endif;	
	
		
		$sql_data_array['title']=$post['data']['title'];
		$sql_data_array['album_id']=$post['data']['album_id'];
		$sql_data_array['description']=$post['data']['description'];
		$sql_data_array['file_name']=$file_name;
		$sql_data_array['listingPosition']=$post['data']['listingPosition'];
		$sql_data_array['is_active']=$post['data']['is_active'];
		$sql_data_array['date']='now()';		
		
		$error=$objGlobalFunction->tep_db_insert(TABLE_GALLARY, $sql_data_array);
		$action='views';
		break;

	case 'update':	
			$param="imageID=".$post['data']['imageID'];
			$sql_data_array['album_id']=$post['data']['album_id'];
			if($_FILES['data']['name']['file_name']!=""):
			/******************************************* Unlink the Previous One ***************************/
			if(file_exists($upload_dir.$_REQUEST['backup_image'])):
				if(unlink($upload_dir.$_REQUEST['backup_image'])):
				unlink($upload_dir."thumbnail/thumb_".$_REQUEST['backup_image']);
				endif;
			endif;
			/******************************************* Unlink the Previous One ***************************/
			$file_name=time()."_".$_FILES['data']['name']['file_name'];
			$tmp_name=$_FILES['data']['tmp_name']['file_name'];
			$file_size=$_FILES['data']['file_name']['size'];
			move_uploaded_file($tmp_name,$upload_dir.$file_name);
			/**************************** Thumbnail Creation *********************************/
			  GlobalFunction::MakeThumbnailNew($upload_dir,$file_name,180,120,'');
		   /**************************** Thumbnail Creation  *********************************/
		else :
			$file_name = $_REQUEST['backup_image'];
		endif;	
			$post['data']['file_name']=$file_name;
			
			$post['data']['date']='now()';
			$error=$objGlobalFunction->tep_db_update(TABLE_GALLARY,$post['data'],$param);
			$action='views';
			break;


	case 'edit' || "add":
		$cmsCont=Gallary::getGALLARY($getquerys['id']);


	case 'delete':
		if(isset($_POST['chk'])) :
			$del_all=$_POST['chk'];	
			foreach($del_all as $value)
			{
				$error=$objGlobalFunction->tep_db_delete($value, TABLE_GALLARY, "imageID", $show_mode='');
				$action='views';
			}
		endif;
		break;
}
	$test = new MyPagina;
    $rowData=array();
	$test->sql = "SELECT * FROM ".TABLE_GALLARY." ORDER BY date DESC"  ; // the (basic) sql statement (use the SQL whatever you like)
	$result = $test->get_page_result(); // result set
	if($objGlobalFunction->tep_db_num_rows($result)>0) :
	while($rows1=$objGlobalFunction->tep_db_fetch_array($result))
				{
					array_push($rowData,$rows1);
					echo "<pre>";
					print_r(isset($ReservedTab));
					echo "</pre>";
				}
				endif;
	$num_rows = $test->get_page_num_rows(); // number of records in result set 	
	$nav_links = $test->navigation(" | "); // the navigation links (define a CSS class selector for the current link)
	$nav_info = $test->page_info("to"); // information about the number of records on page ("to" is the text between the number)
	$simple_nav_links = $test->back_forward_link(); // the navigation with only the back and forward links
	$total_recs = $test->get_total_rows(); // the total number of records					
 //======================================================================================

 	
require_once(ROOT."themes/gallary.php");
?>