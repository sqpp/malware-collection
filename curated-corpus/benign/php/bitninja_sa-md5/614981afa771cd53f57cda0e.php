<?php
//connect the database
$conn = mysqli_connect("localhost", "increase_superadmin", "yU3pwN*2awvjzNDi", "increase_main_db");
if(!$conn){
  die("Failed to connect: ".mysqli_connect_error());
}

//check if the button has been clicked
    if (isset($_POST['btn_add_new_deposit_arrangment'])) {
      $propertyid= mysqli_real_escape_string($conn, $_POST['propertyid']);
      $tenantid= mysqli_real_escape_string($conn, $_POST['tenantid']);
      $total_rent= mysqli_real_escape_string($conn, $_POST['total_rent']);
      $deposit= mysqli_real_escape_string($conn, $_POST['deposit']);
      $amount_payable= mysqli_real_escape_string($conn, $_POST['amount_payable']);
      $deposit= mysqli_real_escape_string($conn, $_POST['deposit']);
      $payment_month= mysqli_real_escape_string($conn, $_POST['payment_month']);
      $contract_fee= mysqli_real_escape_string($conn, $_POST['contract_fee']);
      $total_once_off= mysqli_real_escape_string($conn, $_POST['total_once_off']);

      //calculate the end date of the arrangement
      $cc = mysqli_real_escape_string($conn, $_POST['start_date']);
      $start_date = strtotime("$cc");
      //$arrangement_period = 3;
      $end_date = date("Y-m-d", strtotime("+3 month", $start_date));

      //calculate the rental totals
      //$totals = ($rent + $deposit + $contract_fee);
      $status= $_POST['status'];
  
      $sql = "INSERT INTO payments_rentals_deposit_arrangements (propertyid, tenantid, total_rent, deposit, amount_payable, start_date, status, end_date, contract_fee, total_once_off, payment_month) 
        VALUES ('$propertyid', '$tenantid', '$total_rent', '$amount_payable', '$deposit', '$cc', '$status', '$end_date', '$contract_fee', '$total_once_off', '$payment_month')";
                                   
        if(mysqli_query($conn,$sql)){

          header("Location: client-details.php?clientid=".$tenantid);

        }else{
        echo "Error: ".mysqli."<br>".mysqli_error($conn);

        }
    }