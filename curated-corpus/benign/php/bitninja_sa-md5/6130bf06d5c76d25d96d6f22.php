<?php include("header.php");?>
				<div class="page-content">
					<div class="page-header position-relative">
						<h1>
							Add Blog Here
							<small>
								<i class="icon-double-angle-right"></i>
								 
							</small>
							
							
							
						</h1>
					</div><!--/.page-header-->

					<div class="row-fluid">
						<div class="span12">
							<!--PAGE CONTENT BEGINS-->

							<form class="form-horizontal" action="" method="post" enctype="multipart/form-data" >
							<br/><br/>

							
						
							
							
							
								<div class="control-group">
									<label class="control-label" for="form-field-2">Blog Name</label>

									<div class="controls">
										<input type="text"   name="blog_name" id="form-field-2" placeholder="Blog Name" />
									</div>
								</div>
								
								
								
								<div class="control-group">
									<label class="control-label" for="form-field-2">Blog Image</label>

									<div class="controls">
<input type="file" name="files[]" id="id-input-file-2" placeholder="Add Image Link" />
									</div>
								</div>
								
							
								
									

	 							<div class="control-group">
									<label  class="control-label" for="form-field-2">Blog Detail</label>

									<div class="controls" >
										<script src="ckeditor.js"></script>
	<script src="editor_js/sample.js"></script>
	<link rel="stylesheet" href="editor_css/samples.css">
	<link rel="stylesheet" href="toolbarconfigurator/lib/codemirror/neo.css">

				<textarea id="editor" name="editor">
				 
				</textarea>		  
<script>
	initSample();
</script>
									</div>
									  
								</div>


								<div class="form-actions">
									<button class="btn btn-info" name="submit" type="submit">
										<i class="icon-ok bigger-110"></i>
										Submit
									</button>

									&nbsp; &nbsp; &nbsp;
									 
								
				</form>					 
	
								</div>
 				 
	
								</div>
								
				
								
								
								
								
							<?php
							 include("config.php");
							if(isset($_POST['submit'])) 
 {
	 $blog_name = $_POST['blog_name'];
	 
  $editor = $_POST['editor'];

 	if(isset($_FILES['files'])){
		//This function reads the extension of the file. It is used to determine if the file  is an image by checking the extension.
 function getExtension($str) {
         $i = strrpos($str,".");
         if (!$i) { return ""; }
         $l = strlen($str) - $i;
         $ext = substr($str,$i+1,$l);
         return $ext;
 }
//$fn = $_POST['fn'];
    $errors= array();
	foreach($_FILES['files']['tmp_name'] as $key => $tmp_name ){
		$file_name = $key.$_FILES['files']['name'][$key];
		$file_size =$_FILES['files']['size'][$key];
		$file_tmp =$_FILES['files']['tmp_name'][$key];
		$file_type=$_FILES['files']['type'][$key];	
		if($file_size > 2222097152){
			$errors[]='File size must be less than 2 MB';
			
        }	
			//get the extension of the file in a lower case format
  		 $extension = getExtension($file_name);
 		$extension = strtolower($extension);
 	//if it is not a known extension, we will suppose it is an error and will not  upload the file,  
	//otherwise we will do more tests
 if (($extension != "jpg") && ($extension != "jpeg") && ($extension != "png") && ($extension != "PNG") && ($extension != "JPEG") && ($extension != "PNG") && ($extension != "jfif") && ($extension != "JFIF")) 
 		{
		//print error message
 			
 		 $errors=1;
 		}
		
		else
		{
        $desired_dir="blog/";
        if(empty($errors)==true){
            if(is_dir($desired_dir)==false){
                mkdir("$desired_dir", 0700);		// Create directory if it does not exist
            }
            if(is_dir("$desired_dir/".$file_name)==false){
                move_uploaded_file($file_tmp,"blog/".$file_name);
            }else{									//rename the file if another one exist
                $new_dir="blog/".$file_name.time();
                 rename($file_tmp,$new_dir) ;				
            }
            
        }
        
        $path="blog/".$file_name;
        
	echo 	$query="INSERT INTO tbl_blog (blog_name,blog,editor) VALUES ( '$blog_name','$file_name','$editor');";
if (!mysqli_query($con,$query)) 
{
  echo "Error Inserting Data";
  }	
		
		else{
                //print_r($errors);
        }
        
 
        
    }
	}
	if(!$errors){
		echo "<script language='javascript'>
{
  alert('Added Successfully.');	
    window.location.href = 'add-blog.php';
}
</script>";
	}
	else
	{
	echo "<script language='javascript'>
{
  alert(' Choose only image files.');	
    window.location.href = 'add-blog.php';
}
</script>";
	}
}
 }

 
 

 ?>
 
				 
						</div><!--/.span-->
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->

				<?php include("footer.php");?>