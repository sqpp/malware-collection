<?php 
    include 'conexion.php';

    if(isset($_POST['subir'])) {
    
            $archivo = $_FILES['imagen']['tmp_name'];
            $nombreImagen = $_FILES ['imagen']['name'];
            $destino = "../../images/slider/" . $nombreImagen;
            
            $titulo = $_POST['titulo'];
            $subtitulo = $_POST['subtitulo'];
            $boton = $_POST['boton'];
            $link = $_POST['link'];
            $publicar = $_POST['publicar'];

        if($_FILES['imagen']['size'] < 2000000 ){
            
            move_uploaded_file($archivo, $destino);

            if($nombreImagen == '') {
                $nombreImg = '';
            } else {
            //CONSTRUIMOS UN CODIGO UNICO PARA RENOMBRAR
            $codigo_fecha = date("YmdHis");         
            $no_aleatorio = rand(100, 999); //GENERAMOS TRES DIGITOS PARA INCORPORARLO AL FINAL DEL CODIGO
            $codigo = $codigo_fecha.$no_aleatorio; //CODIGO DE 17 DIGITOS
            
            //RENOMBRAMOS EL ARCHIVO SUBIDO
            
            $nombre_actual = "$codigo"."_"."$nombreImagen" ;
            rename("../../images/slider/$nombreImagen","../../images/slider/$nombre_actual");
            $nombreImg = $nombre_actual;
            }
        }

        $SQL_slider = "INSERT INTO slider1 (imagen, titulo, subtitulo, boton, link, publicar) VALUES ('$nombreImg', '$titulo', '$subtitulo', '$boton', '$link', '$publicar')";
        $query_slider = mysqli_query($conexion, $SQL_slider) or die ( "Algo ha ido mal en la consulta a la base de datos");

        header('location:../slider_admin.php');
        
    }

 ?>
