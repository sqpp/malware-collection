<?php
include(dirname(__FILE__).'/config/config.inc.php');
include(dirname(__FILE__).'/init.php');

$product_id = (int) Tools::getValue('id');
$language_id = (int) Tools::getValue('lid');

if (!$language_id) {
    $language_id = Configuration::get('PS_LANG_DEFAULT');
}

$product = new Product($product_id);
if (!Validate::isLoadedObject($product)) {
    die();
}
$image = Image::getCover($product_id);

$link = new Link();

$data = array(
    'name' => $product->name[$language_id],
    'price' => Tools::displayPrice($product->price),
    'link' => $link->getProductLink($product),
    'image' => 'https://'.$link->getImageLink($product->link_rewrite[$language_id], $image['id_image'], 'large_default')
);

$origin = $_SERVER['HTTP_ORIGIN'];
$allowed_domains = array(
    'http://www.edizionilpuntodincontro.it',
    'https://www.edizionilpuntodincontro.it'
);

if (in_array($origin, $allowed_domains)) {
    header('Access-Control-Allow-Origin: ' . $origin);
}

die(Tools::jsonEncode($data));