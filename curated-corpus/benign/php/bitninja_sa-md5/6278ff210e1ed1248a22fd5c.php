<?php
error_reporting (E_ALL ^ E_NOTICE);
include_once 'assets/libs/class.database.php';
include_once 'assets/libs/class.session.php';
include_once 'assets/libs/class.commen.php';
include_once 'assets/libs/functions.php';
include_once 'assets/libs/tables.config.php';
session_start();
$session= new Session();
global $database, $db;

if (isset($_POST['login'])) {
	
	$useradd="SELECT * FROM `".USER."` WHERE `user_name`='".$_POST['name']."' AND `password`='".md5($_POST['password'])."'";
	$create=$database->query($useradd);
	$loginsuccess=$database->num_rows($create);
	$row=$database->fetch_array($create);
	if ($loginsuccess==1) {
		$_SESSION['toast']="Login Success";
		$_SESSION['isLogin']=1;
		$_SESSION['id']=$row['hospital_id'];
		$_SESSION['user_id']=$row['user_id'];
		$_SESSION['user_type']=$row['user_type_id'];
		$_SESSION['User']=$row['user_name'];
		if ($_SESSION['user_type']==1) {
			header('LOcation:patient_register.php');
		}elseif ($_SESSION['user_type']==2) {
			header('LOcation:allocation.php');
		}elseif ($_SESSION['user_type']==3) {
			header('LOcation:allocations.php');
		}elseif ($_SESSION['user_type']==4) {
			header('LOcation:doctor.php');
		}elseif ($_SESSION['user_type']==5) {
			header('LOcation:nurse.php');
		}elseif ($_SESSION['user_type']==6) {
			header('LOcation:patient_register.php');
		}elseif ($_SESSION['user_type']==7) {
			header('LOcation:patient_register.php');
		}elseif($_SESSION['user_type']==8){
		    	header('LOcation:pcr_update.php');
		    
		}
		

	}
	else{
		$_SESSION['toast']="Login Failed";
		header('LOcation:index.php');
	}
}

if (isset($_POST['typecreate'])) {
	
	$useradd="INSERT INTO `".USER_TYPE."`(`role_name`) VALUES('".$_POST['user_type']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="User Type Created Successfully";
		header('LOcation:user_type.php');
	}
}

if (isset($_POST['typeupdate'])) {
	
	$type_update="UPDATE `".USER_TYPE."` SET `role_name`='".$_POST['user_type']."' WHERE `user_type_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="User Type Updated Successfully";
		header('LOcation:user_type.php');
	}
}

if (isset($_GET['typedelete'])) {
	
	$type_update="DELETE FROM `".USER_TYPE."` WHERE `user_type_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="User Type Deleted Successfully";
		header('LOcation:user_type.php');
	}
}

if (isset($_POST['usercreate'])) {
	
	$useradd="INSERT INTO `".USER."`(`user_name`,`user_type_id`,`password`,`created_by`,`hospital_id`) VALUES('".$_POST['user_name']."','".$_POST['user_type']."','".md5('admin@123')."','".$_SESSION['user_id']."','".$_POST['hospital']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="User Created Successfully";
		header('LOcation:user_create.php');
	}
}

if (isset($_POST['userupdate'])) {
	
	$type_update="UPDATE `".USER."` SET `user_name`='".$_POST['user_name']."',`user_type_id`='".$_POST['user_type']."',`hospital_id`='".$_POST['hospital']."',`updated_by`='".$_SESSION['user_id']."',`updated_dt`='".date('Y-m-d h:i:s')."' WHERE `user_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="User Updated Successfully";
		header('LOcation:user_create.php');
	}
}

if (isset($_GET['userdelete'])) {
	
	$type_update="DELETE FROM `".USER."` WHERE `user_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="User Deleted Successfully";
		header('LOcation:user_create.php');
	}
}

if (isset($_GET['resetpass'])) {
	
	$type_update="UPDATE `".USER."` SET `password`='".md5('admin@123')."' WHERE `user_id`='".$_GET['resetpass']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Password Reset Successfully";
		header('LOcation:user_create.php');
	}
}

if (isset($_POST['resetpassword'])) {

$newpassword=$_POST['newpassword'];
$cnfmpassword=$_POST['confirmpassword'];
$setpass=md5($newpassword);
$oldpass=md5($_POST['oldpassword']);
if($newpassword==$cnfmpassword)
{
    $change="UPDATE `".USER."` SET `password`='".$setpass."' WHERE `user_id`='".$_SESSION['user_id']."' AND `password`='".$oldpass."'";
	$changeqry=$database->query($change);
	$_SESSION['toast']="Your password has been reset!";
	header('Location:index.php');

}

}

if (isset($_POST['hospitalcreate'])) {
	
	$useradd="INSERT INTO `".HOSPITAL."`(`hospital_name`,`created_by`) VALUES('".$_POST['hospital_name']."','".$_SESSION['user_id']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Hospital Added Successfully";
		header('LOcation:hospital_add.php');
	}
}

if (isset($_POST['hospitalupdate'])) {
	
	$type_update="UPDATE `".HOSPITAL."` SET `hospital_name`='".$_POST['hospital_name']."',`updated_by`='".$_SESSION['user_id']."',`updated_dt`='".date('Y-m-d h:i:s')."' WHERE `hospital_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Hospital Updated Successfully";
		header('LOcation:hospital_add.php');
	}
}

if (isset($_GET['hospitaldelete'])) {
	
	$type_update="DELETE FROM `".HOSPITAL."` WHERE `hospital_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Hospital Deleted Successfully";
		header('LOcation:hospital_add.php');
	}
}

if (isset($_POST['nursestatuscreate'])) {
	
	$useradd="INSERT INTO `".NURSE_VISITED."`(`nurse_call_status`,`created_by`) VALUES('".$_POST['nurse_visited']."','".$_SESSION['user_id']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Nurse Status Added Successfully";
		header('LOcation:nurse_status.php');
	}
}

if (isset($_POST['nursestatusupdate'])) {
	
	$type_update="UPDATE `".NURSE_VISITED."` SET `nurse_call_status`='".$_POST['nurse_visited']."',`updated_by`='".$_SESSION['user_id']."',`updated_dt`='".date('Y-m-d h:i:s')."' WHERE `nurse_call_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Nurse Status Updated Successfully";
		header('LOcation:nurse_status.php');
	}
}

if (isset($_GET['nursestatusdelete'])) {
	
	$type_update="DELETE FROM `".NURSE_VISITED."` WHERE `nurse_call_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Nurse Status Deleted Successfully";
		header('LOcation:nurse_status.php');
	}
}
if (isset($_POST['doctorstatuscreate'])) {
	
	$useradd="INSERT INTO `".DOCTOR_VISITED."`(`doctor_call_status`,`created_by`) VALUES('".$_POST['doctor_visited']."','".$_SESSION['user_id']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="doctor Status Added Successfully";
		header('LOcation:doctor_status.php');
	}
}

if (isset($_POST['doctorstatusupdate'])) {
	
	$type_update="UPDATE `".DOCTOR_VISITED."` SET `doctor_call_status`='".$_POST['doctor_visited']."',`updated_by`='".$_SESSION['user_id']."',`updated_dt`='".date('Y-m-d h:i:s')."' WHERE `doctor_call_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="doctor Status Updated Successfully";
		header('LOcation:doctor_status.php');
	}
}

if (isset($_GET['doctorstatusdelete'])) {
	
	$type_update="DELETE FROM `".DOCTOR_VISITED."` WHERE `doctor_call_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="doctor Status Deleted Successfully";
		header('LOcation:doctor_status.php');
	}
}
if (isset($_POST['teamstatuscreate'])) {
	
	$useradd="INSERT INTO `".TEAM_VISITED."`(`team_visited_status`) VALUES('".$_POST['team_visited']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Team Status Added Successfully";
		header('LOcation:team_status.php');
	}
}

if (isset($_POST['teamstatusupdate'])) {
	
	$type_update="UPDATE `".TEAM_VISITED."` SET `team_visited_status`='".$_POST['team_visited']."' WHERE `team_visited_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Team Status Updated Successfully";
		header('LOcation:team_status.php');
	}
}

if (isset($_GET['teamstatusdelete'])) {
	
	$type_update="DELETE FROM `".TEAM_VISITED."` WHERE `team_visited_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Team Status Deleted Successfully";
		header('LOcation:team_status.php');
	}
}
if (isset($_POST['stickerappcreate'])) {
	
	$useradd="INSERT INTO `".STICKER_APPLICATION."`(`sticker_app`) VALUES('".$_POST['sticker_app']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="sticker App Added Successfully";
		header('LOcation:sticker_app.php');
	}
}

if (isset($_POST['stickerappupdate'])) {
	
	$type_update="UPDATE `".STICKER_APPLICATION."` SET `sticker_app`='".$_POST['sticker_app']."' WHERE `sticker_app_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="sticker App Updated Successfully";
		header('LOcation:sticker_app.php');
	}
}

if (isset($_GET['stickerappdelete'])) {
	
	$type_update="DELETE FROM `".STICKER_APPLICATION."` WHERE `sticker_app_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="sticker App Deleted Successfully";
		header('LOcation:sticker_app.php');
	}
}
if (isset($_POST['trackerappcreate'])) {
	
	$useradd="INSERT INTO `".TRACKER_APPLICATION."`(`tracker_app`) VALUES('".$_POST['tracker_app']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Tracker App Added Successfully";
		header('LOcation:tracker_app.php');
	}
}

if (isset($_POST['trackerappupdate'])) {
	
	$type_update="UPDATE `".TRACKER_APPLICATION."` SET `tracker_app`='".$_POST['tracker_app']."' WHERE `tracker_app_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Tracker App Updated Successfully";
		header('LOcation:tracker_app.php');
	}
}

if (isset($_GET['trackerappdelete'])) {
	
	$type_update="DELETE FROM `".TRACKER_APPLICATION."` WHERE `tracker_app_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Tracker App Deleted Successfully";
		header('LOcation:tracker_app.php');
	}
}
if (isset($_POST['requesttypecreate'])) {
	
	$useradd="INSERT INTO `".REQUEST_TYPE."`(`request_type`) VALUES('".$_POST['request_type']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Request Type Added Successfully";
		header('LOcation:request_type.php');
	}
}

if (isset($_POST['requesttypeupdate'])) {
	
	$type_update="UPDATE `".REQUEST_TYPE."` SET `request_type`='".$_POST['request_type']."' WHERE `request_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Request Type Updated Successfully";
		header('LOcation:request_type.php');
	}
}

if (isset($_GET['requesttypedelete'])) {
	
	$type_update="DELETE FROM `".REQUEST_TYPE."` WHERE `request_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Request Type Deleted Successfully";
		header('LOcation:request_type.php');
	}
}
if (isset($_POST['regioncreate'])) {
	
	$useradd="INSERT INTO `".REGION."`(`region_name`,`created_by`) VALUES('".$_POST['region']."','".$_SESSION['user_id']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Region Added Successfully";
		header('LOcation:region.php');
	}
}

if (isset($_POST['regionupdate'])) {
	
	$type_update="UPDATE `".REGION."` SET `region_name`='".$_POST['region']."',`updated_by`='".$_SESSION['user_id']."',`updated_dt`='".date('Y-m-d h:i:s')."' WHERE `region_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Region Updated Successfully";
		header('LOcation:region.php');
	}
}

if (isset($_GET['regiondelete'])) {
	
	$type_update="DELETE FROM `".REGION."` WHERE `region_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Region Deleted Successfully";
		header('LOcation:region.php');
	}
}
if (isset($_POST['areacreate'])) {
	
	$useradd="INSERT INTO `".AREA."`(`area_name`,`created_by`) VALUES('".$_POST['area']."','".$_SESSION['user_id']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Area Added Successfully";
		header('LOcation:area.php');
	}
}

if (isset($_POST['areaupdate'])) {
	
	$type_update="UPDATE `".AREA."` SET `area_name`='".$_POST['area']."',`updated_by`='".$_SESSION['user_id']."',`updated_dt`='".date('Y-m-d h:i:s')."' WHERE `area_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Area Updated Successfully";
		header('LOcation:area.php');
	}
}

if (isset($_GET['areadelete'])) {
	
	$type_update="DELETE FROM `".AREA."` WHERE `area_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Area Deleted Successfully";
		header('LOcation:area.php');
	}
}
if (isset($_POST['addressstatuscreate'])) {
	
	$useradd="INSERT INTO `".ADDRESS_STATUS."`(`address_status`) VALUES('".$_POST['address_status']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Address Status Added Successfully";
		header('LOcation:address_status.php');
	}
}

if (isset($_POST['addressstatusupdate'])) {
	
	$type_update="UPDATE `".ADDRESS_STATUS."` SET `address_status`='".$_POST['address_status']."' WHERE `address_status_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Address Status Updated Successfully";
		header('LOcation:address_status.php');
	}
}

if (isset($_GET['addressstatusdelete'])) {
	
	$type_update="DELETE FROM `".ADDRESS_STATUS."` WHERE `address_status_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Address Status Deleted Successfully";
		header('LOcation:address_status.php');
	}
}
if (isset($_POST['pcrcreate'])) {
	
	$useradd="INSERT INTO `".PCR."`(`pcr`) VALUES('".$_POST['pcr']."')";
	$create=$database->query($useradd);
	if ($create) {
		$_SESSION['toast']="Pcr Status Added Successfully";
		header('LOcation:pcr.php');
	}
}

if (isset($_POST['pcrupdate'])) {
	
	$type_update="UPDATE `".PCR."` SET `pcr`='".$_POST['pcr']."' WHERE `pcr_id`='".$_POST['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Pcr Status Updated Successfully";
		header('LOcation:pcr.php');
	}
}

if (isset($_GET['pcrdelete'])) {
	
	$type_update="DELETE FROM `".PCR."` WHERE `pcr_id`='".$_GET['id']."'";
	$type_updated=$database->query($type_update);
	if ($type_updated) {
		$_SESSION['toast']="Pcr Status Deleted Successfully";
		header('LOcation:pcr.php');
	}
}
?>