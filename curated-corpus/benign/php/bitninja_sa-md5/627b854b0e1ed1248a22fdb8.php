<?php
require('config.php');
session_start();
$id =  $_SESSION['id']+1;

//UPLOAD Foto
$target_dirfoto = "uploads/";
$target_filefoto = $target_dirfoto .$id. basename($_FILES["foto"]["name"]);
$uploadOkfoto = 1;
$imageFileTypefoto = strtolower(pathinfo($target_filefoto,PATHINFO_EXTENSION));

// Check if image file is a actual image or fake image
if(isset($_POST["submit"])) {
  $checkfoto = getimagesize($_FILES["foto"]["tmp_name"]);
  if($checkfoto !== false) {
    //echo "File is an image - " . $checkfoto["mime"] . ".</br>";
    $uploadOkfoto = 1;
  } else {
    echo "File is not an image.</br>";
    $uploadOkfoto = 0;
  }
}

// Check if file already exists
if (file_exists($target_filefoto)) {
  echo "Sorry, file already exists.</br>";
  $uploadOkfoto = 0;
}

// Check file size
if ($_FILES["foto"]["size"] > 5000000) {
  echo "Sorry, your file is too large.</br>";
  $uploadOkfoto = 0;
}

// Allow certain file formats
if($imageFileTypefoto != "jpg" && $imageFileTypefoto != "png" && $imageFileTypefoto != "jpeg"
&& $imageFileTypefoto != "gif" ) {
  echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.</br>";
  $uploadOkfoto = 0;
}

// Check if $uploadOk is set to 0 by an error
if ($uploadOkfoto == 0) {
  echo "Sorry, your file was not uploaded.</br></br>";
// if everything is ok, try to upload file
} else {
  if (move_uploaded_file($_FILES["foto"]["tmp_name"], $target_filefoto)) {
    //echo "The file ". htmlspecialchars( basename( $_FILES["foto"]["name"])). " has been uploaded.</br></br>";
  } else {
    echo "Sorry, there was an error uploading your file.</br></br>";
  }
}

// UPLOAD KTP
$target_dirktp = "uploads/";
$target_filektp = $target_dirktp .$id. basename($_FILES["ktp"]["name"]);
$uploadOkktp = 1;
$imageFileTypektp = strtolower(pathinfo($target_filektp,PATHINFO_EXTENSION));

// Check if image file is a actual image or fake image
if(isset($_POST["submit"])) {
  $checkktp = getimagesize($_FILES["ktp"]["tmp_name"]);
  if($checkktp !== false) {
    //echo "File is an image - " . $checkktp["mime"] . ".</br>";
    $uploadOkktp = 1;
  } else {
    echo "File is not an image.</br>";
    $uploadOkktp = 0;
  }
}

// Check if file already exists
if (file_exists($target_filektp)) {
  echo "Sorry, file already exists.</br>";
  $uploadOkktp = 0;
}

// Check file size
if ($_FILES["ktp"]["size"] > 5000000) {
  echo "Sorry, your file is too large.</br>";
  $uploadOkktp = 0;
}

// Allow certain file formats
if($imageFileTypektp != "jpg" && $imageFileTypektp != "png" && $imageFileTypektp != "jpeg"
&& $imageFileTypektp != "gif" ) {
  echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.</br>";
  $uploadOkktp = 0;
}

// Check if $uploadOk is set to 0 by an error
if ($uploadOkktp == 0) {
  echo "Sorry, your file was not uploaded.</br></br>";
// if everything is ok, try to upload file
} else {
  if (move_uploaded_file($_FILES["ktp"]["tmp_name"], $target_filektp)) {
    //echo "The file ". htmlspecialchars( basename( $_FILES["ktp"]["name"])). " has been uploaded.</br></br>";
  } else {
    echo "Sorry, there was an error uploading your file.</br></br>";
  }
}


// UPLOAD NPWP
$target_dirnpwp = "uploads/";
$target_filenpwp = $target_dirnpwp .$id. basename($_FILES["npwp"]["name"]);
$uploadOknpwp = 1;
$imageFileTypenpwp = strtolower(pathinfo($target_filenpwp,PATHINFO_EXTENSION));

// Check if image file is a actual image or fake image
if(isset($_POST["submit"])) {
  $checknpwp = getimagesize($_FILES["npwp"]["tmp_name"]);
  if($checknpwp !== false) {
    //echo "File is an image - " . $checknpwp["mime"] . ".</br>";
    $uploadOknpwp = 1;
  } else {
    echo "File is not an image.</br>";
    $uploadOknpwp = 0;
  }
}

// Check if file already exists
if (file_exists($target_filenpwp)) {
  echo "Sorry, file already exists.</br>";
  $uploadOknpwp = 0;
}

// Check file size
if ($_FILES["npwp"]["size"] > 5000000) {
  echo "Sorry, your file is too large.</br>";
  $uploadOknpwp = 0;
}

// Allow certain file formats
if($imageFileTypenpwp != "jpg" && $imageFileTypenpwp != "png" && $imageFileTypenpwp != "jpeg"
&& $imageFileTypenpwp != "gif" ) {
  echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.</br>";
  $uploadOknpwp = 0;
}

// Check if $uploadOk is set to 0 by an error
if ($uploadOknpwp == 0) {
  echo "Sorry, your file was not uploaded.</br></br>";
// if everything is ok, try to upload file
} else {
  if (move_uploaded_file($_FILES["npwp"]["tmp_name"], $target_filenpwp)) {
  	$filenpwp = htmlspecialchars( basename( $_FILES["npwp"]["name"]));
    //echo "The file ". htmlspecialchars( basename( $_FILES["npwp"]["name"])). " has been uploaded.</br></br>";
  } else {
    echo "Sorry, there was an error uploading your file.</br></br>";
  }
}




// UPLOAD kk
$target_dirkk = "uploads/";
$target_filekk = $target_dirkk .$id. basename($_FILES["kk"]["name"]);
$uploadOkkk = 1;
$imageFileTypekk = strtolower(pathinfo($target_filekk,PATHINFO_EXTENSION));

// Check if image file is a actual image or fake image
if(isset($_POST["submit"])) {
  $checkkk = getimagesize($_FILES["kk"]["tmp_name"]);
  if($checkkk !== false) {
    //echo "File is an image - " . $checkkk["mime"] . ".</br>";
    $uploadOkkk = 1;
  } else {
    echo "File is not an image.</br>";
    $uploadOkkk = 0;
  }
}

// Check if file already exists
if (file_exists($target_filekk)) {
  echo "Sorry, file already exists.</br>";
  $uploadOkkk = 0;
}

// Check file size
if ($_FILES["kk"]["size"] > 5000000) {
  echo "Sorry, your file is too large.</br>";
  $uploadOkkk = 0;
}

// Allow certain file formats
if($imageFileTypekk != "jpg" && $imageFileTypenpwp != "png" && $imageFileTypenpwp != "jpeg"
&& $imageFileTypenpwp != "gif" ) {
  echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.</br>";
  $uploadOkkk = 0;
}

// Check if $uploadOk is set to 0 by an error
if ($uploadOkkk == 0) {
  echo "Sorry, your file was not uploaded.</br></br>";
// if everything is ok, try to upload file
} else {
  if (move_uploaded_file($_FILES["kk"]["tmp_name"], $target_filekk)) {
  	$filekk = htmlspecialchars( basename( $_FILES["kk"]["name"]));
    //echo "The file ". htmlspecialchars( basename( $_FILES["kk"]["name"])). " has been uploaded.</br></br>";
  } else {
    echo "Sorry, there was an error uploading your file.</br></br>";
  }
}




// UPLOAD CV
$target_dircv = "uploads/";
$target_filecv = $target_dircv .$id. basename($_FILES["cv"]["name"]);
$uploadOkcv = 1;
$imageFileTypecv = strtolower(pathinfo($target_filecv,PATHINFO_EXTENSION));

// Check if file already exists
if (file_exists($target_filecv)) {
  echo "Sorry, file already exists.</br>";
  $uploadOkcv = 0;
}

// Check file size
if ($_FILES["cv"]["size"] > 5000000) {
  echo "Sorry, your file is too large.</br>";
  $uploadOkcv = 0;
}

// Allow certain file formats
if($imageFileTypecv != "pdf") {
  echo "Sorry, only PDF files are allowed.</br>";
  $uploadOkcv = 0;
}

// Check if $uploadOk is set to 0 by an error
if ($uploadOkcv == 0) {
  echo "Sorry, your file was not uploaded.</br></br>";
// if everything is ok, try to upload file
} else {
  if (move_uploaded_file($_FILES["cv"]["tmp_name"], $target_filecv)) {
  	$filecv = htmlspecialchars( basename( $_FILES["cv"]["name"]));
    //echo "The file ". htmlspecialchars( basename( $_FILES["cv"]["name"])). " has been uploaded.</br></br>";
  } else {
    echo "Sorry, there was an error uploading your file.</br></br>";
  }
}





// UPLOAD CL
$target_dircl = "uploads/";
$target_filecl = $target_dircl .$id. basename($_FILES["cl"]["name"]);
$uploadOkcl = 1;
$imageFileTypecl = strtolower(pathinfo($target_filecl,PATHINFO_EXTENSION));
// Check if file already exists
if (file_exists($target_filecl)) {
  echo "Sorry, file already exists.</br>";
  $uploadOkcl = 0;
}

// Check file size
if ($_FILES["cl"]["size"] > 5000000) {
  echo "Sorry, your file is too large.</br>";
  $uploadOkcl = 0;
}

// Allow certain file formats
if($imageFileTypecl != "pdf"){
  echo "Sorry, only PDF files are allowed.</br>";
  $uploadOkcl = 0;
}

// Check if $uploadOk is set to 0 by an error
if ($uploadOkcl == 0) {
  echo "Sorry, your file was not uploaded.</br></br>";
// if everything is ok, try to upload file
} else {
  if (move_uploaded_file($_FILES["cl"]["tmp_name"], $target_filecl)) {
  	$filecl = htmlspecialchars( basename( $_FILES["cl"]["name"]));
    //echo "The file ". htmlspecialchars( basename( $_FILES["cl"]["name"])). " has been uploaded.</br></br>";
  } else {
    echo "Sorry, there was an error uploading your file.</br></br>";
  }
}



$motivasi=$_POST['motivasi'];
$rencana=$_POST['rencana'];
$kasus=$_POST['kasus'];
$penyakit=$_POST['penyakit'];
$kekurangan=$_POST['kekurangan'];
$kelebihan=$_POST['kelebihan'];
$alamat=$_POST['alamat'];
//$pekerjaan=$_POST['pekerjaan'];
$jeniskelamin=$_POST['jeniskelamin'];
$pekerjaanibu=$_POST['pekerjaanibu'];
$pekerjaanayah=$_POST['pekerjaanayah'];
$telportu=$_POST['telportu'];
$alamatortu=$_POST['alamatortu'];
$ibu=$_POST['ibu'];
$ayah=$_POST['ayah'];



$agama=$_POST['agama'];
$sim=$_POST['sim'];
$sim2 = implode(", ",$sim);
$kawin=$_POST['kawin'];
$telp=$_POST['telp'];
$email=$_POST['email'];
$ttl=$_POST['ttl'];
$posisi=$_POST['posisi'];
//$npwp=$_POST['npwp'];
//$nktp=$_POST['nktp'];
$fname=$_POST['fname'];
$rowsbahasa=$_POST['rowsbahasa']; 
//$rowssaudara=$_POST['rowssaudara'];
$rowspendidikan=$_POST['rowspendidikan'];
$rowspekerjaan=$_POST['rowspekerjaan'];


//bahasa
$i=0;
while ($i<=$rowsbahasa) {
	$bahasa=$_POST['bahasa'.$i.''];
	$bahasaap=$_POST['bahasaap'.$i.''];
	$sql2 = "INSERT INTO detail_karyawan_bahasa(
	id,
	bahasa,
	ap
	)
	VALUES 
	(
	'$id',
	'$bahasa',
	'$bahasaap'
	)";

	if (mysqli_query($link, $sql2)) {
	  //echo "New record created successfully";
	} else {
	  //echo "Please check again your data !";
	  echo "Error: " . $sql2 . "<br>" . mysqli_error($link);
	};


	$i++;
}

//pendidikan
$i2=0;
while ($i2<=$rowspendidikan) {
	$pendidikan=$_POST['pendidikan'.$i2.''];
	$thnmsk=$_POST['thnmsk'.$i2.''];
	$thnlls=$_POST['thnlls'.$i2.''];
	$sklh=$_POST['sklh'.$i2.''];
	$jurusan=$_POST['jurusan'.$i2.''];
	$ipk=$_POST['ipk'.$i2.''];
	
	$sql2 = "INSERT INTO detail_karyawan_pendidikan(
	id,
	strata,
	masuk,
	lulus,
	namasklh,
	jurusan,
	ipk
	)
	VALUES 
	(
	'$id',
	'$pendidikan',
	'$thnmsk',
	'$thnlls',
	'$sklh',
	'$jurusan',
	'$ipk'
	)";

	if (mysqli_query($link, $sql2)) {
	  //echo "New record created successfully";
	} else {
	  //echo "Please check again your data !";
	  echo "Error: " . $sql2 . "<br>" . mysqli_error($link);
	};


	$i2++;
}


//pekerjaan
$i3=0;
while ($i3<=$rowspekerjaan) {
	$masa=$_POST['masa'.$i3.''];
	$prshterakhir=$_POST['prshterakhir'.$i3.''];
	$descpekerjaan=$_POST['descpekerjaan'.$i3.''];
	$jbtterakhir=$_POST['jbtterakhir'.$i3.''];
	
	$sql3 = "INSERT INTO detail_karyawan_pekerjaan(
	id,
	masa,
	prshterakhir,
	descpekerjaan,
	jbtnterakhir
	)
	VALUES 
	(
	'$id',
	'$masa',
	'$prshterakhir',
	'$descpekerjaan',
	'$jbtterakhir'
	)";

	if (mysqli_query($link, $sql3)) {
	  //echo "New record created successfully";
	} else {
	  //echo "Please check again your data !";
	  echo "Error: " . $sql3 . "<br>" . mysqli_error($link);
	};


	$i3++;
}




$sql = "INSERT INTO karyawan(
id,
cv,
cl,
kk,
foto,
nktp,
npwp,
sim,
motivasi,
rencana,
kasus,
penyakit,
kekurangan,
kelebihan,
alamat,
pekerjaanibu,
pekerjaanayah,
telportu,
alamatortu,
ibu,
ayah,
agama,
kawin,
telp,
email,
ttl,
posisi,
nama,
jeniskelamin
)
VALUES 
(
'$id',
'$target_filecv',
'$target_filecl',
'$target_filekk',
'$target_filefoto',
'$target_filektp',
'$target_filenpwp',
'$sim2',
'$motivasi',
'$rencana',
'$kasus',
'$penyakit',
'$kekurangan',
'$kelebihan',
'$alamat',
'$pekerjaanibu',
'$pekerjaanayah',
'$telportu',
'$alamatortu',
'$ibu',
'$ayah',
'$agama',
'$kawin',
'$telp',
'$email',
'$ttl',
'$posisi',
'$fname',
'$jeniskelamin'
)";

if (mysqli_query($link, $sql)) {
  //echo "New record created successfully";
} else {
  //echo "Please check again your data !";
  echo "Error: " . $sql . "<br>" . mysqli_error($link);
};



?>