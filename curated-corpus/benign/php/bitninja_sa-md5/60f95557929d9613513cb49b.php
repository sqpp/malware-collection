<?php require '../includes/database.php';
 require '../includes/url.php';

 if($_SERVER["REQUEST_METHOD"] == "POST"){
  $conn = getDB();

  $pageTitle=$conn -> real_escape_string($_POST['pagetitle']);
  $metaData=$conn -> real_escape_string($_POST['metadata']);
  $title=$conn -> real_escape_string($_POST['title']);
  $time=$_POST['time'];
  $article=$conn -> real_escape_string($_POST['article']);
  if(isset($_FILES['image'])){
    $allowed = array('gif', 'png', 'jpg');
    $file_name=$_FILES['image']['name'];
    $ext = pathinfo($file_name, PATHINFO_EXTENSION);
    if ($ext !== 'gif' || $ext !== 'png' || $ext !== 'jpg') {
      echo 'error';
    }
    $file_tmp=$_FILES['image']['tmp_name'];
    $file_size=$_FILES['image']['size'];
    if($file_size > 2097152 ){
      echo " File is too large";
    }
    move_uploaded_file($file_tmp,"images/".$file_name);
  }
 
  $sql = "INSERT INTO blogs (page_title,meta,title,time,article,image)
  VALUES ('$pageTitle','$metaData','$title', '$time', '$article','$file_name')";

  if ($conn->query($sql) === TRUE) {
    // echo "New record created successfully <br/>";
    redirect("/SGJBackEnd/Forms/event_message.php");
  } else {
    echo "Error: " . $sql . "<br/>" . $conn->error;
  }

}