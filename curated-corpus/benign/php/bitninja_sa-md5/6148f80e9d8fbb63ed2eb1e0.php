<?php
include_once('import.class/util.class.php');
include_once('import.class/db.class.php');
// ----- Initialize Utility class
	$init = new ADM_UTIL();
// --- Initialize Database class
	$db = new DB($util);
	$raw = '';
	foreach($init->REQUEST_path(0) as $k => $v){
		$$k = $v;
		//echo $k." = ".$v."<br>";
		$raw .= $k." = ".$v."<br>";
	}
	$raw .= $_SERVER['REMOTE_ADDR'];
	$raw .= "<br>Passwd =".md5($api_pass);
	@mysql_query("INSERT INTO `rwc_payment_raw`(`raw_data`, `date_time`) VALUES ('$raw',now())");
	//parameters
	/*
	$paymentRefNo
	$amountPaid
	$datePaid
	$vehCate
	$vehPurpose
	$vehPymntCate
	*/
	//$api_pass = 'SOWF2UVD66';
	$access = '0e375ac31f20e96901405944328184b1';
    $IP_address = array('72.3.212.78','72.32.159.192','72.32.159.193');
    //&& $vehCate != '' 
	if($access === md5($api_pass) && $paymentRefNo != ''&& $amountPaid != '' && $datePaid != '' && $vehPurpose!= '' && $vehPymntCate != '' && in_array($_SERVER['REMOTE_ADDR'],$IP_address)){
	//echo "inseide";
		$resultStatus = strtoupper($resultStatus);
		$sql = "INSERT INTO `rwc_payment_record`(`paymentRefNo`, `amountPaid`, `datePaid`, `vehCate`, `vehPurpose`, `vehPymntCate`)
	 VALUES ('$paymentRefNo', '$amountPaid', '$datePaid', '$vehCate', '$vehPurpose', '$vehPymntCate')";
	 	//echo $sql;
		@mysql_query($sql);
		if(mysql_affected_rows() > 0){
			echo 1;
		}else{
			//check if the PIN on the system
			@mysql_query("SELECT * FROM `rwc_payment_record` WHERE `paymentRefNo` = '$paymentRefNo'");
			if(mysql_affected_rows() > 0){
				echo 2;
			}else{
				echo 0;	
			}
		}
	}else{
		echo 0;	
	}
	$db->Close();
	?>