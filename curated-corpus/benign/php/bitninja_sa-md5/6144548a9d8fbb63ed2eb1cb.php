<?php
if($_SERVER['REQUEST_METHOD']!='POST' || empty($_POST)){echo "404.php";exit;}
require_once("db/conn.php");

$username=$connection->real_escape_string($_POST['username']);
$password=md5($connection->real_escape_string(trim($_POST['password'])));

if(empty($username) || empty($password)){echo "Invalid Username or Password";exit;}
else{
	$loginq="SELECT * FROM npg_mst_users WHERE username='".$username."' AND password='".$password."'";
	$loginr=$connection->query($loginq);
	$loginrow=$loginr->fetch_assoc();
	$count=$loginr->num_rows;
	$loginr->free();
	if($count==1){
		if($loginrow['active']=='y'){
			session_start();
			$_SESSION['id']=$loginrow['usersrno'];
			$_SESSION['user']=$loginrow['username'];
			$_SESSION['name']=$loginrow['name'];
			$_SESSION['login_role']=$loginrow['login_role'];
			$_SESSION['role']=explode(',',$loginrow['role']);

			echo "success";
		}
		else echo "User Account Disabled. Contact <strong>Admin</strong>.";
	}
	else echo "Invalid Username or Password";
}
$connection->close();
?>