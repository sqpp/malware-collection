<?php 
include 'header.php';
require_once('connect.php');

if(!isset($_SESSION['username'])){
	echo "<script>window.location.href='login.php';</script>"; 
}

if(isset($_POST) & !empty($_POST)){

	$extarray=array();
		
	$temp = explode(".", $_FILES["protfolio_image"]["name"]);
	$protfolio_img = 'Portfolio-'.mt_rand(1000,9000). '.' . end($temp);
	array_push($extarray,end($temp));
	
	$target_dir = "Portfolio/";
	
	$protfolio_name = $_POST['protfolio_name'];
	$protfolio_link = $_POST['protfolio_link'];
	$protfolio_freamwork = implode(', ', $_POST['protfolio_freamwork']);
	$protfolio_date = $_POST['protfolio_date'];
	$protfolio_image = $_FILES["protfolio_image"]["name"];

	 
	move_uploaded_file($_FILES["protfolio_image"]["tmp_name"], $target_dir.$protfolio_img); 
	
	$sql = "INSERT INTO portfolio (protfolio_name, protfolio_link, protfolio_freamwork, protfolio_date, protfolio_image) VALUES ('$protfolio_name', '$protfolio_link', '$protfolio_freamwork', '$protfolio_date', '$protfolio_img')";
	$result = mysqli_query($connection, $sql); 
	if($result){ 
		$smsg = "Portfolio Add successfull";
	}else{
		$fmsg = "Portfolio Add failed";
	}
}

?>	
                <!-- Page Sidebar Ends-->
                <div class="page-body">
                    <div class="container-fluid">
                        <div class="page-header">
                            <div class="row">
                                <div class="col">
                                    <div class="page-header-left">
                                        <h3>Add Protfolio</h3>
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item">
                                                <a href="index.php"><i data-feather="home"></i></a>
                                            </li>
                                            <li class="breadcrumb-item">Dashboard</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Container-fluid starts-->
                    <div class="container-fluid">
                        <div class="row">
							<div class="card col-md-12">
								  <div class="card-body">
										<?php if(isset($smsg)){ ?><div class="alert alert-success" role="alert"> <?php echo $smsg; ?> </div><?php } ?>
										<?php if(isset($fmsg)){ ?><div class="alert alert-danger" role="alert"> <?php echo $fmsg; ?> </div><?php } ?>
										<form method="POST" enctype="multipart/form-data">
										  <div class="form-row">
											<div class="col-md-12 mb-3">
												<label>Protfolio Name</label>
												<input class="form-control" id="protfolioname" name="protfolio_name" type="text" placeholder="Protfolio name" required="">
											</div>
											<div class="col-md-12 mb-3">
												<label for="validationDefault02">Protfolio Link</label>
												<input class="form-control" id="protfoliolink" name="protfolio_link" type="text" placeholder="Protfolio Link" required="">
											</div>
											<div class="col-md-12 mb-3">
												<label for="validationDefault02">Protfolio Freamwork</label>
												<div class="form-group">
													<select class="mul-select" multiple id="protfoliofreamwork" name="protfolio_freamwork[]" required="">
														<option value="" disabled selected>Choose your Freamwork</option>
														
														<?php 
															$qry = "SELECT * FROM portfolio_category order by category_id";

															$res = mysqli_query($connection,$qry);  

															if(mysqli_num_rows($res) > 0){

																while($row = mysqli_fetch_array($res)){	
																
																?>
																	<option value="<?php echo $row['category_slug'] ?>"><?php echo $row['category_name'] ?></option>
																<?php
																
																}

															}	
														?>
													</select>
												</div>
											</div>
											<div class="col-md-12 mb-3">
												<label for="validationDefault02">Protfolio Date</label>
												<div class="custom-file">
													 <input class="form-control digits" type="date" name="protfolio_date" value="<?php date('dmY')?>" required="">
												</div>
											</div>
											<div class="col-md-3 mb-3">
												<label for="validationDefault02">Protfolio Image</label>
												<div class="custom-file">
													<input hidden class="custom-file-input" id="protfolioimage" name="protfolio_image" type="file" required="" onchange="previewFile(this);"> 
													<label class="custom-btn-1" for="protfolioimage">Choose your file...</label>
												</div>
											</div>
											<div class="col-md-3 mb-3">
												<img style="width: 125px;" id="previewImg" src="Portfolio/Portfolio-1077.png" alt="Profile Image">
											</div>
											<div class="col-md-12 mb-3">
												<button class="btn btn-primary" type="submit">Submit Protfolio</button>
											</div>
										</form>
								  </div>
							</div>
                        </div>
                    </div>
                    <!-- Container-fluid Ends-->
                </div>
                
<?php include 'footer.php';?>
<script>
 
$(document).ready(function() {
	$('.mdb-select').materialSelect();
});

function previewFile(input){
	var file = $("#protfolioimage").get(0).files[0];

	if(file){
		var reader = new FileReader();

		reader.onload = function(){
			$("#previewImg").attr("src", reader.result);
		}

		reader.readAsDataURL(file);
	}
}
function previewFile(input){
	var file = $("#protfolioimage").get(0).files[0];

	if(file){
		var reader = new FileReader();

		reader.onload = function(){
			$("#previewImg").attr("src", reader.result);
		}

		reader.readAsDataURL(file);
	}
}
</script>