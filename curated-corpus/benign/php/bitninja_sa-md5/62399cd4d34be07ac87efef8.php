<?php
require_once ('db.php');
if (isset($_POST['Submit'])) {
move_uploaded_file($_FILES["image"]["tmp_name"],"uploads/" . $_FILES["image"]["name"]);			
$location=$_FILES["image"]["name"];
$conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$sql = "INSERT INTO gallery( image_location)
VALUES ('$location')";
$conn->exec($sql);
echo "<script>alert('Successfully Added!!!'); window.location='gallery.php'</script>";// }
}

	if (isset($_POST['update'])) {
$get_id=$_REQUEST['tbl_image_id'];
move_uploaded_file($_FILES["image"]["tmp_name"],"uploads/" . $_FILES["image"]["name"]);     
$location1=$_FILES["image"]["name"];
$title =$_POST['title'];
$conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

if(!empty($_FILES['image']['name']))
{
$sql = "UPDATE gallery SET  image_location ='$location1' WHERE tbl_image_id = '$get_id' ";
}
else
{
  $sql = "UPDATE gallery SET title ='$title' WHERE tbl_image_id = '$get_id' ";
}
$conn->exec($sql);
echo "<script>alert('Successfully Updated!!!'); window.location='gallery.php'</script>";
}


if (isset($_GET['del']))  {
 $get_id=$_GET['del'];
 $stmt_select=$conn->prepare('SELECT * FROM gallery WHERE tbl_image_id=:uid');
        $stmt_select->execute(array(':uid'=>$_GET['del']));
        $imgRow=$stmt_select->fetch(PDO::FETCH_ASSOC);
        unlink("uploads/".$imgRow['image_location']);
        $stmt_delete=$conn->prepare('DELETE FROM gallery WHERE tbl_image_id =:uid');
        $stmt_delete->bindParam(':uid', $_GET['del']);
        $stmt_delete->execute();
echo "<script>alert('Successfully deleted!!!'); window.location='gallery.php'</script>";
}
?>