<?php
date_default_timezone_set('UTC');
header('Access-Control-Allow-Origin: *');
//USDCHF,H1: USDJPY,45.3,57.2:GBPJPY,66.7,47.9:EURJPY,66.4,47.4:EURUSD,64.9,42.5:GBPUSD,68.8,41.8:EURGBP,48.9,50.0:CHFJPY,65.2,55.7:CADJPY,50.7,45.0:AUDJPY,57.5,46.7:NZDJPY,48.0,39.2:USDCHF,33.2,50.0:USDCAD,44.1,57.9:AUDUSD,59.0,43.2:NZDUSD,50.8,36.2:GBPCHF,52.1,40.4:GBPCAD,64.3,50.8:GBPAUD,55.8,51.4:GBPNZD,67.8,58.4:EURCHF,52.4,42.1:EURCAD,63.1,51.3:EURAUD,55.8,52.6:EURNZD,68.1,60.7:AUDCHF,46.3,41.4:AUDCAD,57.4,48.6:AUDNZD,69.8,57.9:

header('Cache-Control: no-cache, must-revalidate');
header('Expires: Mon, 26 Jul 1997 05:00:00 GMT');
header('Content-type: application/json');
use Wruczek\PhpFileCache\PhpFileCache;
require_once __DIR__ . "/vendor/autoload.php";


$param = $_POST["param"];

//$param="USDJPY,45.3,57.2,63.2,56.1,49.1,37.4,28.0:GBPJPY,66.7,47.9,44.1,47.6,48.1,34.8,29.4:EURJPY,66.4,47.4,44.3,46.7,47.9,38.1,24.9:EURUSD,64.9,42.5,37.4,40.5,43.7,40.3,22.9:GBPUSD,68.8,41.8,36.3,41.1,44.9,34.9,25.4:EURGBP,48.9,50.0,50.2,50.8,52.2,60.9,57.9:CHFJPY,65.2,55.7,57.6,58.7,58.1,49.6,33.9:CADJPY,50.7,45.0,42.4,43.6,41.8,29.9,25.1:AUDJPY,57.5,46.7,37.9,37.7,42.2,45.1,27.3:NZDJPY,48.0,39.2,29.2,31.3,38.2,37.8,30.5:USDCHF,33.2,50.0,49.2,43.3,36.4,26.6,18.6:USDCAD,44.1,57.9,60.7,52.9,46";

//$param="USDJPY,45.3,57.2:GBPJPY,66.7,47.9:EURJPY,66.4,47.4:EURUSD,64.9,42.5:GBPUSD,68.8,41.8:EURGBP,48.9,50.0:CHFJPY,65.2,55.7:CADJPY,50.7,45.0:AUDJPY,57.5,46.7:NZDJPY,48.0,39.2:USDCHF,33.2,50.0:USDCAD,44.1,57.9:AUDUSD,59.0,43.2:NZDUSD,50.8,36.2:GBPCHF,52.1,40.4:GBPCAD,64.3,50.8:GBPAUD,55.8,51.4:GBPNZD,67.8,58.4:EURCHF,52.4,42.1:EURCAD,63.1,51.3:EURAUD,55.8,52.6:EURNZD,68.1,60.7:AUDCHF,46.3,41.4:AUDCAD,57.4,48.6:AUDNZD,69.8,57.9:";
main($param);

function main($param){
  $cache = new PhpFileCache();
  $returnArr=[];
  $paramArr= explode(":",$param);
  array_pop($paramArr);
  foreach ( $paramArr as $index => $value ) {
    $pair= explode(",",$value);
    $pairName= $pair[0];
    $d1 = $pair[1];
    $h4 = $pair[2];
    $h1 = $pair[3];
    $m30 = $pair[4];
    $m15 = $pair[5];
    $m5 = $pair[6];
    $m1 = $pair[7];
    $pairArr = array(
      "symbol" => $pairName,
      "value" =>50,
      "d1" => $d1,
      "h4" => $h4,
      "h1" => $h1,
      "m30" => $m30,
      "m15" => $m15,
      "m5" => $m5,
      "m1" => $m1,
    );
    array_push($returnArr,$pairArr);
  }
  $returnObj=array("symbols" => $returnArr, "timestamp" => time(),"status"=>'OK');
  $returnJson= json_encode($returnObj);

  $data = $cache->store("rsiData", $returnJson, $expiration = 60*60*24*2);

  echo "OK";
}//main



?>
