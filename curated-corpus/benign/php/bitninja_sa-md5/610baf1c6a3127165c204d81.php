<?php
require_once('dbconnection.php');
if(isset($_SESSION['user_id'])=='')
 {
   header("Location:login.php");
 } 
$villa_title = $_GET['villa_title'];

if($_SERVER['REQUEST_METHOD'] == 'POST')
{
   
   $title = $_POST['title'];
   $file_name = $_FILES['filename']['name'];
   $filename  = basename($_FILES['filename']['name']);
   $file_size = $_FILES['filename']['size'];
   $file_tmp  = $_FILES['filename']['tmp_name'];
   $file_ext= pathinfo($filename, PATHINFO_EXTENSION);
   $extension  = array("jpeg","jpg","png");
   $file_name= time()."_".$file_name;  
   move_uploaded_file($file_tmp,"uploads/".$file_name);

   $createddate = date('Y-m-d');
   
    $sql = "INSERT INTO villa_gallery (villa_title,title,image,created_at) VALUES('$villa_title','$title','$file_name','$createddate')";

   $statement = $conn->prepare($sql);
                  
   if ($statement->execute() === TRUE)
   {
      header("Location:villa_gallery_table.php?villa_title=$villa_title");
      die();
   }           
   else
   {
                     
       echo "message";
   } 

   

}

?>

<?php include 'includes/header.php'; ?>
<section>
   <div class="container-fluid">
      
      <div class="row justify-content-center">
         <div class="col-md-10">

            <div class="card mb-12">
                <div><a class="btn btn-outline-secondary" style="background-color:#132151;color: white;border-radius: 15px  15px;margin-left:90%;margin-top:13px;"  href="villa_gallery_table.php?villa_title=<?=$villa_title?>"><i class="fal fa-chevron-left mr-1"></i>Back</a>
                  <div class="card-header">Add Gallery Details</div>
               <div class="card-body">
                  <form action="" method="post" enctype="multipart/form-data">
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Title</label>
                              <input type="hidden" class="form-control" name="project_id">
                              <input type="text" class="form-control" name="title" placeholder="Title comes here" required="">
                           </div>
                        </div>
                        
                        
                        <div class="col-md-12">
                           <div class="form-group">
                              <label>Image</label>
                              <input type="file" name="filename" class="form-control" id="filename" onchange="check_image_type_and_size(this.id);" required>
                              <label><i>Note: file size should be(220*147) and 
                                          file Extension should be(jpg,jpeg,png)</i>
                              </label>
                           </div>
                        </div>
                        <div class="col-12">
                           <button type="reset" class="btn btn-secondary">Reset</button>
                           <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                     </div>
                  </form>
               </div>
           </div>
      </div>
   </div>
</section>

<?php include 'includes/footer.php'; ?>
