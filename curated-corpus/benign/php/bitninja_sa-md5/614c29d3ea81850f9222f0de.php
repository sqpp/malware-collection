<?php session_start();
if(isset($_POST['check_login'])) {
	include('includes/model.php');
	include('includes/library.php');
	$db = new Model();
		$mobile = $db->realTrim($_POST['mobile']);
		$password = $db->realTrim($_POST['password']);
		$today = date('d-m-Y');
if(!empty($mobile) && !empty($password)) {
	if (strlen($mobile)==10 AND is_numeric($mobile)) {
		$get_user = "SELECT * FROM users where mobile_no = '$mobile'";
		$res_user = $db->getSelect($get_user);
			$db_hash_pass = $res_user[0]['pass'];
	if(password_verify($password, $db_hash_pass)) {
			$_SESSION['login_mem'] = $res_user[0]['mem_uid'];
			$_SESSION['login_mem_role'] = $res_user[0]['user_role'];
					$_SESSION['err_msg'] = "<div class='alert alert-success'>Welcome to Shree Ram Sena.</div>";
	        		header("Location: home.php");
				} else {
					$_SESSION['err_msg'] = "<div class='alert alert-danger'>Incorrect Password! Please Try again.</div>";
	        		header("Location: ".$_SERVER['HTTP_REFERER']);
				}
		} else {
			header('Location: login.php');
			$_SESSION['err_msg'] = "<div class='alert alert-danger'>Mobile No. should be 10 digit numeric.</div>";
		}
	} else {
		header('Location: login.php');
		$_SESSION['err_msg'] = "<div class='alert alert-danger'>Mobile No. and Password cannot be empty.</div>";
	}
} ?>