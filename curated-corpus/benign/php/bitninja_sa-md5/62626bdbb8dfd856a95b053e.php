<?php

//fill_sub_category.php
session_start();
include('../config.php');
   
   if(isset($_POST['action'])){
    $action=$_POST['action'];
   }   
   
   $id_admin=$_SESSION['admin_id_para_'];
   
   if($action=="editer"){
    $lu=1;
    $con->query("update notification_para set lu='$lu' where(id_admin='".$id_admin."')");
   
}
  
 $req_=$con->query("select * from notification_para where(id_admin='".$id_admin."' and lu=0)");
 $nbr=$req_->num_rows;
 if($nbr==0){
     $nbr="";
    	echo $nbr;
   ?>
    <script>
    $(".notifDropdown").removeClass('beep');
    </script>
   
   <?php
   
 }
 else{
 	echo '<span class="badge badge-info ">'.$nbr.'</span>';
    ?>
    <script>
    $(".notifDropdown").addClass('beep');
    </script>
    <?php
 
}
 $req_notif_=$con->query("select * from notification_para where(id_admin='".$id_admin."') order by date_creation DESC");
 $nbr_notif=$req_notif_->num_rows;
if($action=="notification"){
    echo $nbr_notif;
    
}

if($action=="infos"){
    $nbr=0;
    while($dn_notification=$req_notif_->fetch_array(MYSQLI_ASSOC)){
        $nbr++;
        $id_admin_notification=$dn_notification['id_admin_notification'];
        $req_admin=$con->query("select * from admin_para_ where (id_admin='".$id_admin_notification."')" );
        $dn_admin=$req_admin->fetch_array(MYSQLI_ASSOC);
    ?>
    
    
                                                     <a  class="dropdown-item dropdown-item-unread" id="notification<?php echo $nbr; ?>" style="cursor: pointer;"> 
                                                     <div class="dropdown-item-icon bg-primary text-white"> 
                    <?php
                                if($dn_admin['image']!=""){
                                    ?>
                                	<img src="https://www.parajihen.tn/Dashboard_admin/compte/images_profile/<?php echo $dn_admin['image']; ?>" class="rounded-circle" alt="Img Profile" style="width: 50px; height: 50px;"/>
                                    <?php
                                }
                                else{
                                ?>
                                 <i class="fal fa-user text-white"></i>
									
                                    <?php
                                    }
                                    ?>
                  </div> <div class="dropdown-item-desc"> 
         
								<span style="font-weight: 700;"><?php echo $dn_admin['prenom']; ?>&nbsp;<?php echo $dn_admin['nom'].' '.$dn_notification['notification']; ?></span>
                                <input type="hidden" id="type_notification<?php echo $nbr; ?>" value="<?php echo $dn_notification['type_notification']; ?>"/>
                                
                               <script>
                               $(document).ready(function(){
                                var type_notification=$('#type_notification' + <?php echo $nbr; ?>).val();
                                
                                   $('#notification' + <?php echo $nbr; ?> ).click(function(){
                                  
                                    window.location.href='https://www.parajihen.tn/Dashboard/commandes_para/<?php echo $dn_notification['notification_para'].'.php?'.$dn_notification['type_notification']; ?> ';
                                  
                                   }) 
                                
                               
                               });
                               </script>                     
						
												
                  <div class="time">
                                                    <?php 
                                                    

$date_debut=$dn_notification['date_creation'];
$date_fin=date('Y/m/d H:s:i');
$datetimeCreation = new DateTime($date_debut);
$datetimeTraitement = new DateTime($date_fin);
$tempsPrisEnCharge = $datetimeTraitement->diff($datetimeCreation);

 $jour = ($tempsPrisEnCharge->d <= 9)? '0'.$tempsPrisEnCharge->d : $tempsPrisEnCharge->d;
$heure = ($tempsPrisEnCharge->h <= 9)? '0'.$tempsPrisEnCharge->h : $tempsPrisEnCharge->h;
$minute = ($tempsPrisEnCharge->i <= 9)? '0'.$tempsPrisEnCharge->i : $tempsPrisEnCharge->i;
$seconde = ($tempsPrisEnCharge->s <= 9)? '0'.$tempsPrisEnCharge->s : $tempsPrisEnCharge->s;
 if($jour>0){
echo 'Il y a '.$jour.' jour(s)';
}
else if($heure>0)
{
    echo 'Il y a '.$heure.' heure(s)';
}
else if($minute>0)
{
    echo 'Il y a '.$minute.' minute(s)';
}

?>
                                                 
                                                    
                                                    </div> 
												</div>
											</a>
    
    <?php
    }
}

?>