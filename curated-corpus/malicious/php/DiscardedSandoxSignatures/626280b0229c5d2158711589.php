<?php
include '../application/config.php';

if(isset($_POST['id']) && isset($_FILES['file1']['name'])){
    $id=$_POST['id'];
   /* function cwUpload($field_name = '', $target_folder = '', $file_name = '', $thumb = FALSE, $thumb_folder = '', $thumb_width = '', $thumb_height = '')
    {
        $target_path = $target_folder;
        $thumb_path = $thumb_folder;
        $filename_err = explode(".", $_FILES[$field_name]['name']);
        $filename_err_count = count($filename_err);
        $file_ext = $filename_err[$filename_err_count - 1];
        $r1 = chr(rand(ord('a'), ord('z')));
        $r2 = chr(rand(ord('a'), ord('z')));
        $r3 = chr(rand(ord('a'), ord('z')));
        $id = $r1 . $r2 . $r3;
        $fileName = $id . $_FILES[$field_name]['name'];
        $upload_image = $target_path . basename($fileName);
        if (move_uploaded_file($_FILES[$field_name]['tmp_name'], $upload_image)) {
            if ($thumb == TRUE) {
                $thumbnail = $thumb_path . $fileName;
                list($width, $height) = getimagesize($upload_image);
                $thumb_create = imagecreatetruecolor($thumb_width, $thumb_height);
                switch ($file_ext) {
                    case 'jpg':
                        $source = imagecreatefromjpeg($upload_image);
                        break;
                    case 'jpeg':
                        $source = imagecreatefromjpeg($upload_image);
                        break;
                    case 'png':
                        $source = imagecreatefrompng($upload_image);
                        break;
                    case 'gif':
                        $source = imagecreatefromgif($upload_image);
                        break;
                    default:
                        $source = imagecreatefromjpeg($upload_image);
                }
                imagecopyresized($thumb_create, $source, 0, 0, 0, 0, $thumb_width, $thumb_height, $width, $height);
                switch ($file_ext) {
                    case 'jpg' || 'jpeg':
                        imagejpeg($thumb_create, $thumbnail, 100);
                        break;
                    case 'png':
                        imagepng($thumb_create, $thumbnail, 100);
                        break;
                    case 'gif':
                        imagegif($thumb_create, $thumbnail, 100);
                        break;
                    default:
                        imagejpeg($thumb_create, $thumbnail, 100);
                }
            }
            return $fileName;
        } else {
            return false;
        }
    }
    $upload_img = cwUpload('file1', '../uploads/store/full/', '', TRUE, '../uploads/store/thumb/', '200', '97');
    $thumb_src = '../uploads/store/thumb/' . $upload_img;
    $imagepath12 = $upload_img;*/

    $tmpFilePath = $_FILES['file1']['tmp_name'];

        $r1 = chr(rand(ord('a'), ord('z')));
        $r2 = chr(rand(ord('a'), ord('z')));
        $r3 = chr(rand(ord('a'), ord('z')));
        $rno = $r1 . $r2 . $r3;
        $newFilePath = "../uploads/store/full/" . $rno . $_FILES['file1']['name'].".png";
        $imagepath = $rno . $_FILES['file1']['name'].".png";
        //Upload the file into the temp dir
        move_uploaded_file($tmpFilePath, $newFilePath);
    $date = time();
    $qry = mysqli_query($con, "insert into shop9tbl_storefinder_photos (photo_url,store_id,created_at,updated_at,is_deleted)
    VALUES ('$imagepath','$id','$date','$date',0)");
    if($qry)
    {
        $ar[] = array("id" => "True");
        $arr['mutiimage'] = $ar;
        echo json_encode($arr);
    }
    else
    {
        $ar[] = array("id" => "false");
        $arr['mutiimage'] = $ar;
        echo json_encode($arr);
    }
}
else
{
    $ar[] = array("id" => "false");
    $arr['mutiimage'] = $ar;
    echo json_encode($arr);
}
?>