<?php
    require_once('inc/dbdat.inc');
	include('global.php'); 

   // Configuration - Your Options
      $max_filesize = 2097152; // Maximum filesize in BYTES (currently 2MB).
      $upload_path = './mediaitems/'; // The place the files will be uploaded to (currently a 'files' directory).
 
   $filename = $_FILES['userfile']['name']; // Get the name of the file (including file extension).
   $ext = substr($filename, strpos($filename,'.'), strlen($filename)-1); // Get the extension from the filename.
 
   // Now check the filesize, if it is too large then DIE and inform the user.
   if(filesize($_FILES['userfile']['tmp_name']) > $max_filesize)
      die('The file you attempted to upload is too large.');
 
   // Check if we can upload to the specified path, if not DIE and inform the user.
   if(!is_writable($upload_path))
      die('You cannot upload to the specified directory, please CHMOD it to 777.');
 
   // Upload the file to your specified path.
   if(move_uploaded_file($_FILES['userfile']['tmp_name'],$upload_path . $filename))
         echo 'Your file upload was successful, '; // It worked.
    else
         echo 'There was an error during the file upload.  Please try again.'; // It failed :(.
		 
	$la_date = split('/', $_POST['pd_mediadate']);
	$mediadate = (count($la_date) == 3)? implode('-', array_reverse($la_date)): '';
		 
	$schoolid=$_POST['schoolid'];
	$medianote=$_POST['medianote'];
	$medialink = $upload_path.$filename;
	
	mysql_query("INSERT INTO mediaitems (schoolid, mediadate, medianote, medialink) 
					VALUES ('$schoolid', '$mediadate', '$medianote', '$medialink')") or trigger_error(mysql_error(), E_USER_ERROR);
					
	phpAddNote('school', $schoolid, 'A media item was added');
		
	?>
		<script language="javascript" type="text/javascript">
			document.location.href="index.php?subpage=school&ps_action=edit&pi_schoolid=<?= $schoolid ?>"; 
		</script>
 
	?>
	