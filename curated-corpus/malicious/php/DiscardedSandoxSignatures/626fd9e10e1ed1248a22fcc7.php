<?php 
$servername = "localhost";
$username = "roomrent_dbuser";
$password = "ql%K,ou2vj(]";
$dbname = "roomrent_mcx";

// Create connection
$con = mysqli_connect($servername,$username,$password,$dbname);
// Check connection
if (mysqli_connect_errno()) {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
  die;
}

$host    = "api.datakick.in";
$port    = 6666;


// create socket
$socket = socket_create(AF_INET, SOCK_STREAM, 0) or die("Could not create socket\n");

// connect to server
$result = socket_connect($socket, $host, $port) or die("Could not connect to server\n"); 

socket_write($socket, $result, strlen($result)) or die("Could not send data to server\n");

$x = 1;

while($x <= 5) {
	//$array=array();
  $result = socket_read ($socket, 2048) or die("Could not read server response\n");
  echo $out1 = substr($result,2); 			
  $out2 = json_decode($out1,true);
  if($out2)
  {
    $sql = "UPDATE tbl_metal_data SET symbol = '".$out2['InsSymbol']."', low = '".$out2['Low']."', high = '".$out2['High']."', open = '".$out2['Open']."', close = '".$out2['Close']."', ltp = '".$out2['LTP']."', changeData = '".$out2['Change']."', buy = '".$out2['Buy']."', sell = '".$out2['Sell']."', ticktime = '".$out2['TickTime']."' WHERE token = '".$out2['InsToken']."'";
    mysqli_query($con,$sql);
  }
    $file = fopen("/home/roomrents/public_html/mcxresponse.txt","w");
    fwrite($file,$out1);
    fclose($file);
}
mysqli_close($con);
// Close socket
socket_close($socket);
?>