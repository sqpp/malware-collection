<?php

require_once("../backend/functions.php");
dbconn();

$user = $CURUSER['username'];

require '../backend/SimpleImage.php';
if ($_FILES["image"]["name"] != "") {

    $tempfile = safehtml($filedata['tmp_name']);
    $namafile = safehtml($filedata['name']);

    $temp = explode(".", $_FILES["image"]["name"]);
    $newfilename = round(microtime(true)) . '.' . end($temp);
    $destfile = "../images/buku/".$newfilename."";

    move_uploaded_file($_FILES['image']['tmp_name'], $destfile);

    try {
        // Create a new SimpleImage object
        $image = new \claviska\SimpleImage();

        // Magic!
        $image
        ->fromFile($destfile)                     // load image.jpg
        ->autoOrient()                              // adjust orientation based on exif data
        ->resize(800,null)                          // resize to 320x200 pixels
        ->toFile($destfile);      // convert to PNG and save a copy to new-image.png

        // And much more!
    } catch(Exception $err) {
        // Handle errors
        //echo $err->getMessage();
    }  
}

$sr = "".$site_config['SITEURL']."/images/buku/".$newfilename."";

echo "<div style=\"padding:10px 4px 10px 4px; position:relative; margin:4px; background-color:#EFFCC2; border:1px dashed #84A809\"><a style=\"background-image:url(images/icons/addo.png); background-repeat:no-repeat; background-position:left center; font-size:20px; letter-spacing:-1px; padding:15px 15px 15px 35px\" onclick=\"pindahImg('$sr')\"><b>TAMBAH!</b></a><img onclick=\"pindahImg('$sr')\" width=\"50\" style=\"position:absolute; right:0px; top:0px\" src=\"thumb.php?src=$sr&w=50&h=50\"></div>";

?>