<?php 
/*
*Template Name: Rep Registration-1
*/

ob_start();

if(isset($_REQUEST["hdnSubmit_frm"]))
{

    if($_REQUEST['hdnSubmit_frm']=="insert")
    {
        $username     = $_POST['email'];
        /*$pass         = md5($_POST['pwd']);
        $password     = $_POST['pwd'];*/
        $password     = "";
        $uname        = $_POST['uname']; 
        $fname        = $_POST['fname'];
        $lname        = $_POST['lname'];
        $email        = $_POST['email'];
        $password     = md5($_POST['password']);  
        $phone        = $_POST['phone'];
        $StreetAddress=$_POST['streetaddress'];
        $yim        = $_POST['yim'];
        $web       = $_POST['web'];
        $jabber        = $_POST['jabber'];
        $upload       = $_POST['upload']; 
    	$url= "/";

    	if (email_exists($email)) {
            echo "<script>window.location='".get_option('home')."/rep-sign-up-1/?email=already'</script>";
        } else {
            
            $user_registered = gmdate('Y-m-d H:i:s');
            
            $sql="INSERT INTO wp_users(id,user_login,user_email,user_registered,user_pass,user_nicename,display_name) VALUES('','$email','$email','$user_registered','$password','$fname','$fname')";
            $res = mysql_query($sql);
            $user_id=mysql_insert_id();
            $user = new WP_User($user_id);
            $user->set_role('repteam');
            
             add_user_meta( $user_id, 'User_name', $uname );  
            add_user_meta( $user_id, 'first_name', $fname );
            add_user_meta( $user_id, 'last_name', $lname );
            add_user_meta( $user_id, 'phone', $phone );
            add_user_meta( $user_id, 'Profilesubarb', $StreetAddress );
            add_user_meta( $user_id, 'yim', $yim );
            add_user_meta( $user_id, 'web', $web );
            add_user_meta( $user_id, 'jabber', $jabber );


            $image=$_FILES["upload"]["name"];

				if($_POST['link']==''){
					$link=get_option('siteurl');
				}
				else{
					$link=$_POST['link'];
				}
			$test= move_uploaded_file($_FILES["upload"]["tmp_name"],
			"wp-content/themes/specialagent/upload/" . $_FILES["upload"]["name"]);
			$path1="wp-content/themes/specialagent/upload/" . $_FILES["upload"]["name"];
			$upload_doc=add_user_meta( $user_id,upload, $path1 ) ;
				if($upload_doc){
				//header("location:http://saffronsoft.com/wordpress/siabappare/rep-sign-up-1/");
				}


            echo "<!--script>window.location='".get_option('home')."/?page_id=81&lg=".base64_encode($user_id) ."&uname=$uname'</script-->";
        }
       
    }
}
get_header(); ?>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
<script>
js = jQuery.noConflict() ;
js(document).ready(function(){
js( "#opener1" ).click(function() {
js( "#dialog" ).dialog({ width: 550, height: 400 });
return false;
});
});

function validate()
{
var Username=js("#uname").val();
var Firstname=js("#fname").val();
var lastname=js("#lname").val();
var email=js("#email").val();
var confirmmail=js("#C_email").val();
var password=js("#password").val();
var cpassword=js("#cpassword").val();
var phone=js("#phone").val();
var streetaddress=js("#streetaddress").val();
var upload=js("#upload").val();


var msg='';
if(name =='')
var msg=false;
var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
js('span.error').remove();
if(Username=='')
{ 
msg = true;
js('<span class="error">Please enter the User Name</span>').insertAfter('#uname');

}

if(Firstname=='')
{ 
msg = true;
js('<span class="error">Please enter the First Name</span>').insertAfter('#fname');

}
 if( lastname=='')
 { 

msg = true;
js('<span class="error">Please enter the last name</span>').insertAfter('#lname');
}
 if(!filter.test(email))
{
msg =true;
js('<span class="error">Please enter the Valid email</span>').insertAfter('#email');
}
 if(confirmmail=='')
{
msg =true;
js('<span class="error">Please enter correct email</span>').insertAfter('#C_email');
}
 if(email != confirmmail)
{
msg =true;
js('<span class="error">Email does not match</span>').insertAfter('#C_email');
}
if(password=='')
{
msg =true;
js('<span class="error">Please enter the password</span>').insertAfter('#password');
}
if(cpassword=='')
{
msg =true;
js('<span class="error">Please enter the conform password</span>').insertAfter('#cpassword');
}
if(password != cpassword)
{
msg =true;
js('<span class="error">Password does not match</span>').insertAfter('#cpassword');
}
 if(phone =='')
{ 
msg =true;
js('<span class="error">Please enter the Phone No</span>').insertAfter('#phone');
}
if(isNaN(phone))
{ 
msg =true;
js('<span class="error">Please enter the Phone No in Numeric</span>').insertAfter('#phone');
}
if(streetaddress =='')
{ 
msg =true;
js('<span class="error">Please enter the Profile suburb</span>').insertAfter('#streetaddress');
}

if(upload =='')
{ 
msg =true;
js('<span class="error">Please upload a photo</span>').insertAfter('#upload1');
}

if(!js('input[type="checkbox1"]').is(':checked')){
    msg=true;
    js('<span class="error">Please check terms & condition</span>').insertAfter('#opener');
}
 
if(msg)
{
return false;
}
else 
{
return true;
}

}
</script>

<section class="body_sec" style="padding-top:23px; padding-bottom:0;">
<header class="entry-header"> </header>
	<div class="wppb_holder" id="wppb_register">
<div class="selling_sec">
      <h1>Get started now</h1>
      <p>It only takes a few minutes to create your Full Feature Profile, and start attracting interest from homeowners in your suburb who are looking to list their properties.</p>
 </div>

<div class="selling_sec">
 <aside class="contact_form">
 
 <div class="account_head">
<h3>Personal information</h3></div>


    
 
   
			<div id="msg" style="color:red;"><?php if(isset($_REQUEST['email']) && $_REQUEST['email'] == 'already'){
			 echo "this email address already exist";
			}?></div>
          <form name="reg1" method="post" id="reg1" action="#" enctype="multipart/form-data">
          <input type="hidden" name="hdnSubmit_frm" value="insert" />
              <p class="registerNameHeading">
               <strong></strong>
              </p>
            <p class="form-username">
            <label for="user_name">User Name : <span class="red">*</span></label>
             <input name="uname" type="text" class="fild_e" id="uname"/>
            </p>
            <p class="first_name">
            <label for="first_name">First Name : <span class="red">*</span></label>
             <input name="fname" type="text" class="fild_e" id="fname"/>
            </p>
            <p class="last_name">
            <label for="last_name">Last Name : <span class="red">*</span></label>
             <input name="lname" type="text" class="fild_e" id="lname"/>
            </p>
         
            
            <p class="form-email">
               <label for="email">Email :
                 <span class="red">*</span>&nbsp;</label>
             <input name="email" type="text" class="fild_e" id="email"/>
            </p>
           <span style="font-size:11px; clear:both; float:right;  color:#000;margin-right: 111px;">(Each full feature profile must have its own unique<br>email address)
          </span>
         

            <p class="form-password">
             <label for="pass1">Password :
                 <span class="red">*</span>&nbsp;</label>
             <input name="password" type="password" class="fild_e" id="password"/>
            </p>
            <span style="font-size:11px; clear:both; float:right; color:#000;margin-right: 269px;">(At least 8 characters)</span>

            <p class="form-password">
            <label for="pass2">Confirm Password:
                 <span class="red">*</span>&nbsp;</label>
             <input name="cpassword" type="password" class="fild_e" id="cpassword"/>
            </p>  
            <span style="font-size:11px; clear:both; float:right; color:#000;margin-right: 269px;">(At least 8 characters)</span>

           <div class="selling_sec">
<h1>Agency information</h1>
<p>Choose the two suburbs or areas you want your personal profile to be featured in. When a seller searches by either of those suburbs, your profile will be included as one of the specialists in that area.</p>
</div>
          
            <p class="Phone">
             <label for="Phone">Phone :
                 <span class="red">*</span>&nbsp;</label>
              <input name="phone" type="text" class="fild_e" id="phone"/>
            </p>
            

             <p class="form-aim">
             <label for="aim">Profile area 1: :
             <span class="red">*</span>&nbsp;</label>
             <input name="streetaddress" type="text" class="fild_e" id="streetaddress"/>
            </p>
  
             <p class="form-yim">
             <label for="yim">Profile area 2:</label>
              <input name="yim" type="text" class="fild_e" id="yim"/>
            </p>

              <p class="form-web">
             <label for="web">Web address:</label>
              <input name="web" type="text" class="fild_e" id="web"/>
            </p>
 
             <p class="form-jabber">
             <label for="jabber">Which agency are you with ?</label>
             <input name="jabber" type="text" class="fild_e" id="jabber"/>
            </p> 

            <span style="font-size:11px; clear:both;margin-right: 60px; float:right; color:#000;">
            (If your agency brand is not listed, we are sorry we missed it.<br>Please
<a href="#">email us</a>your business name, real estate license<br>number and a copy of your logo and we will add it to our<br>agency list and let you know when it is done.)
</span>   
               
                <p class="upload">
             <label for="upload">Upload Photo :
                 <span class="red">*</span>&nbsp;</label>
             <input name="upload" type="file" class="fild_e1" id="upload"/>
            </p>         


         <p class="send-confirmation-email" style="float:right; margin-left:-29px; ">
<label style="margin: 0 174px;width: 43%;" for="send_credentials_via_email">
<input id="send_credentials_via_email" type="checkbox" value="sending" name="send_credentials_via_email"> Send these credentials via email. </label>
</p>


<p class="form-submit" style="float: left; margin: 15px 148px;">
<input id="submit" class="sub_reg" type="image" onclick="return validate();" alt="image" src="http://saffronsoft.com/wordpress/agent/wp-content/themes/specialagent/images/submit.png" name="submit"></p>
			
          </form>
   </aside>
</div>
</div>
</section>
<?php get_footer(); ?>