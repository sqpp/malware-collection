<style type="text/css">
.alert-success {
  background-color: #ccddbb;
  border-color: #c6d4aa;
  color: #669533;
}
.alert-error {
  color: #b94a48;
  background-color: #f2dede;
  border-color: #eed3d7;
}
</style>
<?php
include 'mysql.php'; 
	if ($nick=="" and !$nick) {
	echo "<p>Hack mi yapacan çakal !</p>";
	die;
} 
function resimYukle($klasor,$resim,$tipi,$genislik,$yukseklik,$yeniisim){
	
$dosya="".$klasor."".$resim;
if(($tipi=='image/jpg') || ($tipi=='image/jpeg') || ($tipi=='image/pjpeg') ){
$resim=@imagecreatefromjpeg($dosya); // Yklenen resimden oluacak yeni bir JPEG resmi oluturuyoruz..
}elseif($tipi=='image/gif'){
$resim=imagecreatefromgif($dosya); // Yklenen resimden oluacak yeni bir JPEG resmi oluturuyoruz..
}elseif($tipi=='image/png' || $tipi=='image/x-png'){
$resim=@imagecreatefromPNG($dosya); // Yklenen resimden oluacak yeni bir JPEG resmi oluturuyoruz..
} else {
$resim=@imagecreatefromstring($dosya); // Yklenen resimden oluacak yeni bir JPEG resmi oluturuyoruz..

}

$boyutlar=@getimagesize($dosya); // Resmimizin boyutlarn reniyoruz.

if($boyutlar[0]<$genislik){
	$genislik=$boyutlar[0];
}
if($boyutlar[1]<$yukseklik){
	$yukseklik=$boyutlar[1];
}

$yeniresim=@imagecreatetruecolor($genislik,$yukseklik); // Oluturulan bo resmi istediimiz boyutlara getiriyoruz..
@imagecopyresampled($yeniresim, $resim, 0, 0, 0, 0, $genislik, $yukseklik, $boyutlar[0], $boyutlar[1]);
$hedefdosya="".$klasor."".$yeniisim.""; // Yeni resimin kaydedilecei konumu belirtiyoruz..
if(($tipi=='image/jpg') || ($tipi=='image/jpeg') || ($tipi=='image/pjpeg') ){
@imagejpeg($yeniresim,$hedefdosya,100); // Ve resmi istediimiz konuma kaydediyoruz..
}elseif($tipi=='image/gif'){
@imagegif($yeniresim,$hedefdosya,100); // Ve resmi istediimiz konuma kaydediyoruz..
}elseif($tipi=='image/x-png' || $tipi=='image/png'){
@imagegif($yeniresim,$hedefdosya,100); // Ve resmi istediimiz konuma kaydediyoruz..
} else {
@imagegif($yeniresim,$hedefdosya,100); // Ve resmi istediimiz konuma kaydediyoruz..
}
return $yeniisim;
}


    $baslik=strip_tags(addslashes(trim($_POST["baslik"])));
    $haber_id=intval(strip_tags(addslashes(trim($_POST["id"]))));
	$klasor="../../galeri/";
	$dosya_isim_sayi=count($_FILES['resim']['name']); 
	for($i=0;$i<$dosya_isim_sayi;$i++){
		if(!empty($_FILES['resim']['name'][$i])){
		$resim=$_FILES['resim']['name'][$i];
		$tipi=$_FILES['resim']['type'][$i];
		$kaynak=$_FILES["resim"]["tmp_name"][$i]; 		
		$uzanti=substr($resim,-4); 
		$yad=substr(md5(rand(0,9999999999)),-6);
		$resim="$yad$uzanti";
		$yeniisim	="$yad$uzanti";
		$yukle=$klasor.basename($resim);
if ($tipi !="image/jpeg" and $tipi !="image/pjpeg" and  $tipi !="image/png" and  $tipi !="image/gif") {
} else {
	if(move_uploaded_file($kaynak,$yukle)){
	$resimx	="$yad$uzanti";
	resimYukle($klasor,$resim,$tipi,800,600,"-".$yeniisim);
	} else {
	}
}
		if ($resimx) {
		$ekle=mysql_query("insert into galeri values ('0','$haber_id','$baslik','$resim')");
		echo "<p class='alert-success'>Foto Ekleme Başarılı</p>";
		}
		else {
		echo "<p class='alert-error'>Geçersiz dosya uzantısı</p><br>";
		}
		} 
	}

?>