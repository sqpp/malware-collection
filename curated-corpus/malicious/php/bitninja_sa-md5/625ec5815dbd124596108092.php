<?php 
/******** START OF CONFIG SECTION *******/
  //$sendto  = "test@myth.co.nz";
  $sendto  = "info@grassland.org.nz";
  $subject = "NZ Grasslands Contact Us";
// Select if you want to check form for standard spam text
  $SpamCheck = "Y"; // Y or N
  $SpamReplaceText = "*content removed*";
// Error message prited if spam form attack found
$SpamErrorMessage = "<p>No website URLs permitted</p><br>
<a href=\"javascript:history.back();\">Back</a>";
/******** END OF CONFIG SECTION *******/


  $name = $_POST['name']; 
  $email = $_POST['email']; 
  $message = $_POST['message'];
  $phone = $_POST['phone']; 
  $headers = "From: $email\n";
  $headers . "MIME-Version: 1.0\n"
		   . "Content-Transfer-Encoding: 7bit\n"
		   . "Content-type: text/html;  charset = \"iso-8859-1\";\n\n";
if ($SpamCheck == "Y") {		   
// Check for Website URL's in the form input boxes as if we block website URLs from the form,
// then this will stop the spammers wastignt ime sending emails
if (preg_match("/http/i", "$name")) {echo "$SpamErrorMessage"; exit();} 
if (preg_match("/http/i", "$email")) {echo "$SpamErrorMessage"; exit();} 
if (preg_match("/http/i", "$message")) {echo "$SpamErrorMessage"; exit();} 
if (preg_match("/http/i", "$phone")) {echo "$SpamErrorMessage"; exit();} 

// Patterm match search to strip out the invalid charcaters, this prevents the mail injection spammer 
  $pattern = '/(;|\||`|>|<|&|^|"|'."\n|\r|'".'|{|}|[|]|\)|\()/i'; // build the pattern match string 
                            
  $name = preg_replace($pattern, "", $name); 
  $email = preg_replace($pattern, "", $email); 
  $message = preg_replace($pattern, "", $message); 
  $phone = preg_replace($pattern, "", $phone); 

// Check for the injected headers from the spammer attempt 
// This will replace the injection attempt text with the string you have set in the above config section
  $find = array("/bcc\:/i","/Content\-Type\:/i","/cc\:/i","/to\:/i"); 
  $email = preg_replace($find, "$SpamReplaceText", $email); 
  $name = preg_replace($find, "$SpamReplaceText", $name); 
  $message = preg_replace($find, "$SpamReplaceText", $message); 
  $phone = preg_replace($find, "$SpamReplaceText", $phone); 
// Check to see if the fields contain any content we want to ban
 if(stristr($name, $SpamReplaceText) !== FALSE) {echo "$SpamErrorMessage"; exit();} 
 if(stristr($message, $SpamReplaceText) !== FALSE) {echo "$SpamErrorMessage"; exit();} 
 else {$message = $_POST['message'];}
 if(stristr($phone, $SpamReplaceText) !== FALSE) {echo "$SpamErrorMessage"; exit();}
 // Do a check on the send email and subject text
 if(stristr($sendto, $SpamReplaceText) !== FALSE) {echo "$SpamErrorMessage"; exit();} 
 if(stristr($subject, $SpamReplaceText) !== FALSE) {echo "$SpamErrorMessage"; exit();} 
}
// Build the email body text
  $emailcontent = "Name: $name 
Email: $email 
Phone: $phone
Message: $message"; 
// Check the email address enmtered matches the standard email address format

// Sends out the email or will output the error message 
 mail($sendto, $subject, $emailcontent, $headers);
  echo "<p>&nbsp;</p><p><em>Thank You $name</em></p><p>We will be in touch as soon as possible.</p><p>&nbsp;</p><p>&nbsp;</p>"; 
  ?>
