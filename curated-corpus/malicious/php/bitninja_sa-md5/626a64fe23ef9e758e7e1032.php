<?php    $keywords = $this->get_option('keywords_' . $this->generate_type);    $default_keywords = isset($this->option['default_keywords_' . $this->generate_type]) ? $this->option['default_keywords_' . $this->generate_type] : "";   	$next_post = $this->get_next_scheduled_post($this->generate_type); 	$time_left = $next_post_id = $next_post_website_id = 0;		// if (is_array($next_post) && isset($next_post['time_left']) && $next_post['time_left']) {		// $time_left = isset($next_post['time_left']) ? $next_post['time_left'] : 0;		// $next_post_id = isset($next_post['next_post']) ? $next_post['next_post']['next_post_id'] : 0;		// $next_post_website_id = isset($next_post['next_post']) ? $next_post['next_post']['next_post_website_id'] : 0;	// }		// get current local server time to display on Web UI	$current_time = current_time('timestamp');   	// $kws = $this->get_keywords();	// print_r($kws);	// $tm = $this->get_option('end_day_timestamp_last_posting');		// echo date('Y-m-d H:i:s', $tm);                    ?><div class="contentgen_keyword-bulk"><input type="hidden" id="post_type" value="<?php echo $this->generate_type;?>"><h3><?php _e("Master Schedule Setting") ?></h3><p>Master Post Scheduler sets the overall schedule for all keywords unless they are changed individually below</p><?php	$this->create_option_field('default_schedule', __("Default"), 'schedule', array(			'timestamp' => $current_time,			'times' => 1,			'recurring' => 'week',			 'times_before' => 1,			 'before' =>  date('G')		), array(			 'hour' => 'hour',			'day' => 'day',			'week' => 'week',			'month' => 'month',			'year' => 'year'		));		$spinner = apply_filters('mainwp-spinner-is-enabled', false);		if ($spinner) 		{ ?>                   				<div class="contentgen_option-list">				   <label><?php _e('Auto Spinning') ?>:</label>					<div class="contentgen_option-field">						<input type="checkbox" name="default_schedule_auto_spin" value="yes" <?php if ( isset($default_keywords['default_schedule_auto_spin']) && $default_keywords['default_schedule_auto_spin']  == 'yes' ) echo 'checked="checked"' ?> /> 				<?php _e('Enable auto spin?') ?>                            					</div>                        				</div>	   <?php		 }  ?><input type="hidden" id="cex_generate_type" value="<?php echo $this->generate_type; ?>"><input type="hidden" id="contentgen_counter" value="<?php echo $time_left; ?>"><p><?php _e("Time to next post countdown: ") ?>	<span id="contentgen_nextcountdown" class="hidden"></span>&nbsp;     	<span class="mainwp_loading" id="cex_loading"><img src="<?php echo plugins_url('css/images/loader.gif', dirname(__FILE__)); ?>"/>&nbsp;running..</span>&nbsp;  	<span><a href="#" id="contentgen_cancel_next_scheduled_post" class="hidden" next_post_id = "<?php echo $next_post_id;?>" next_post_website_id = "<?php echo $next_post_website_id;?>" title="Cancel next scheduled <?php echo $this->generate_type; ?>">Cancel Next Scheduled</a></span>&nbsp;		<span><a href="#" id="contentgen_cancel_all_scheduled_posts" class="hidden" title="Cancel all scheduled <?php echo $this->generate_type; ?>">Cancel All Scheduled</a></span></p> <script type="text/javascript">		jQuery(document).ready(function(){			run_countdown(false);		}); </script> <div class="contentgen_option-list"><label for="bulk_keyword"><?php _e('Keyword'); ?></label>    <div class="contentgen_option-field">        <textarea id="bulk_keyword" name="bulk_keyword" cols="50" rows="5" class="text"><?php echo $default_keywords['bulk_keyword']; ?></textarea>        <br><small><?php _e('Separate each word with comma') ?></small>    </div></div><?php      $bulk_keyword_cats  =  $default_keywords['bulk_keyword_cats'];            $bulk_selected_by  =  $default_keywords['bulk_selected_by']; ?> <div class="contentgen_option-list">    <label><?php _e("Post to Categories") ?>:</label>      <div class="contentgen_option-field">            <?php                $params = array();                $params['title'] = __("Select Categories");                                $params['selected_cats']  = unserialize(base64_decode($bulk_keyword_cats));                $params['selected_by']  = $bulk_selected_by;                 $params['prefix']  ='bulk';                                                                                                                                                                              echo MainWPUI::select_categories_box($params);                           ?>                    <div class="clearfix"></div>       </div>     </div></div><h3 class="separator"><?php _e("Schedules") ?></h3><?php	             $test_text =($this->generate_type == 'page') ? __("Test Create Page") : __("Test Post");                ?><div class="contentgen_option-list">	<div class="keyword keyword-add">		<input type="hidden" name="keyword_code[]" value="" disabled="disabled">		<h4><a href="#" title="<?php _e("Click to open/close") ?>"><?php _e("Select Source") ?></a></h4>		<div class="detail">			<a href="#" class="remove_keyword"><?php _e("Remove") ?></a>			<span class="test_keyword"><a href="#" class="test_link"><?php echo $test_text; ?></a></span>			<label><?php _e("Article Source") ?>:</label>			<div class="keyword-field">				<select name="keyword_module[]" class="keyword_module" disabled="disabled">					<option value="">Select Source</option>					<?php foreach ( $this->modules as $key => $module ): ?>					<option value="<?php echo $key ?>"><?php echo $module->name ?></option>					<?php endforeach ?>				</select>			</div>                                                               			<div class="keyword-select keyword-rssfeed">				<label><?php _e("Feed URL") ?>:</label>				<div class="keyword-field">					<input type="text" class="text" name="keyword_url[]" disabled="disabled" />				</div>			</div>			<div class="keyword-select keyword-droppost">				<label><?php _e("Article Folder") ?>:</label>				<div class="keyword-field">					<select name="keyword_folder[]" disabled="disabled">						<option value=""><?php _e("Select Folder") ?></option>						<?php foreach ( scandir($this->modules['droppost']->post_dir) as $file ): ?>							<?php if ( ! is_dir($this->modules['droppost']->post_dir.'/'.$file) || $file == '.' || $file == '..' ) continue; ?>							<option value="<?php echo $file ?>"><?php echo $file ?></option>						<?php endforeach ?>					</select>				</div>			</div>			<div class="keyword-select keyword-csv">				<label><?php _e("CSV File") ?>:</label>				<div class="keyword-field">					<select name="keyword_file[]" disabled="disabled">						<option value=""><?php _e("Select File") ?></option>						<?php 							$files = array();							foreach ( scandir($this->modules['csv']->post_dir) as $file ): 								if ( ! preg_match('/\.csv$/i', $file) ) 									continue;								$files[] = $file;						?>							<option value="<?php echo $file ?>"><?php echo $file ?></option>						<?php endforeach ?>					</select>				</div>				<label><?php _e("CSV Delimiter") ?>:</label>				<div class="keyword-field">					<input type="text" class="text" name="keyword_csv_delimiter[]" value="," disabled="disabled" />				</div>				<label><?php _e("Post Title") ?>:</label>				<div class="keyword-field">					<input type="text" class="text" name="keyword_csv_title[]" value="" disabled="disabled" />				</div>				<label><?php _e("Post Content") ?>:</label>				<div class="keyword-field">					<textarea class="text" name="keyword_csv_content[]" cols="40" rows="4" disabled="disabled"></textarea>				</div>				<div class="keyword-field">					<div class="available-column">						Available column: 						<span></span>					</div>				</div>			</div>			<div class="keyword-select keyword-other">				<label><?php _e("Keyword") ?>:</label>				<div class="keyword-field">					<input type="text" class="text" name="keyword[]" disabled="disabled" />				</div>			</div>                                                             <label><?php _e("Post to Categories") ?>:</label>                                  <div class="keyword-field">                                      <?php                                                $params = array();                                                $params['title'] = __("Select Categories");                                                                $params['selected_cats']  =array();                                                 $params['prefix']  = 'add_new';   // do not change add_new                                                                                                                                                                                          echo MainWPUI::select_categories_box($params);                                           ?>                                                    <div class="clearfix"></div>                                  </div>			<label><?php _e("Template") ?>:</label>			<div class="keyword-field">				<select name="keyword_template[]" disabled="disabled">					<option value=""><?php _e("Default template") ?></option>				</select>			</div>			<label><?php _e("Schedule") ?>:</label>			<div class="keyword-field">				<label>					<input type="checkbox" name="keyword_override_schedule[]" value="yes" /> 					<?php _e('Override Default Schedule?') ?>				</label>				<br />				<div class="contentgen_schedule-once">					<input type="radio" name="keyword_type[]" value="once" disabled="disabled" />					<input type="text" name="keyword_date[]" class="datepick" value="<?php echo date('d/m/Y', $current_time) ?>" disabled="disabled" />					<select name="keyword_time_h[]" disabled="disabled">						<?php for ( $t = 0; $t < 24; $t++ ): ?>						<option value="<?php echo $t ?>" <?php if ( date('G', $current_time) == $t ) echo 'selected="selected"' ?>><?php echo zeroise($t, 2) ?></option>						<?php endfor ?>					</select> hours					<select name="keyword_time_m[]" disabled="disabled">						<?php for ( $t = 0; $t < 60; $t++ ): ?>						<option value="<?php echo $t ?>" <?php if ( date('i', $current_time) == zeroise($t, 2) ) echo 'selected="selected"' ?>><?php echo zeroise($t, 2) ?></option>						<?php endfor ?>					</select> minutes				</div>				<br />				<div class="contentgen_schedule-recurring">					<input type="radio" name="keyword_type[]" value="recurring" checked="checked" disabled="disabled" />					<input type="text" class="text text-small" name="keyword_times[]" value="1" disabled="disabled" />					 <?php _e("times a") ?> 					<select name="keyword_rec[]" disabled="disabled">						<?php foreach ( array("hour","day", "week", "month", "year") as $sel ): ?>						<option value="<?php echo $sel ?>"><?php echo $sel ?></option>						<?php endforeach ?>					</select>				</div>                                            <br />                                            <div class="contentgen_schedule-recurring">                                                         <input type="radio" name="keyword_type[]"  value="before" disabled="disabled" >                                                         <input type="text"  class="text-small"  name="keyword_times_before[]"  value="1" disabled="disabled">                                                                                                                   <?php _e("times before") ?>                                                            <select name="keyword_time_before_h[]" disabled="disabled">                                                        <?php for ( $t = 0; $t < 24; $t++ ): ?>						<option value="<?php echo $t ?>" <?php if ( date('G', $current_time) == $t ) echo 'selected="selected"' ?>><?php echo zeroise($t, 2) ?></option>						<?php endfor ?>                                                         </select> h                                            </div>			</div>            <?php              if ($spinner)                         { ?>                             <label><?php _e('Auto Spinning') ?>:</label>                             <div class="keyword-field">                                    <label>                                                                           <input type="checkbox" name="keyword_auto_spin[]"   value="yes" />                                 <?php _e('Enable auto spin?') ?>                                                               </label>                                          </div>                       <?php                         }            ?>              		</div>	</div>                	<?php foreach ( (array)$keywords as $i => $keyword ): ?>		<?php if ( ! is_array($keyword) ) continue; ?>		<input type="hidden" name="keyword_code[<?php echo $i ?>]" value="<?php echo !empty($keyword['keyword_code']) ? $keyword['keyword_code'] : $i; ?>">		<div class="keyword">			<h4>				<a href="#" title="<?php _e("Click to open/close") ?>">					<?php 						echo ( $keyword['module'] ) ? $this->modules[$keyword['module']]->name : __("Select Source");						if ( $keyword['module'] == 'rssfeed' )							echo ' - '. $keyword['keyword_url'];						else if ( $keyword['module'] == 'droppost' )							echo ' - '. $keyword['keyword_folder'];						else if ( $keyword['module'] == 'csv' )							echo ' - '. $keyword['keyword_file'];						else							echo ' - '. $keyword['keyword'];						if ( $keyword['module'] == 'ezine' )							echo ' - '. $keyword['keyword_sub'];					?>				</a>			</h4>			<div class="detail">				<a href="#" class="remove_keyword"><?php _e("Remove") ?></a>				<span class="test_keyword"><a href="#" class="test_link"><?php echo $test_text; ?></a></span>				<label><?php _e("Article Source") ?>:</label>				<div class="keyword-field">					<select name="keyword_module[<?php echo $i ?>]" class="keyword_module">						<option value="">Select Source</option>						<?php foreach ( $this->modules as $key => $module ): ?>						<option value="<?php echo $key ?>" <?php if ( $keyword['module'] == $key ) echo 'selected="selected"' ?>><?php echo $module->name ?></option>						<?php endforeach ?>					</select>				</div>				<div class="keyword-select keyword-rssfeed" <?php if ( $keyword['module'] == 'rssfeed' ) echo 'style="display: block;"' ?>>					<label><?php _e("Feed URL") ?>:</label>					<div class="keyword-field">						<input type="text" class="text" name="keyword_url[<?php echo $i ?>]" value="<?php echo $keyword['keyword_url'] ?>" <?php if ( $keyword['module'] != 'rssfeed' ) echo 'disabled="disabled"' ?> />					</div>				</div>				<div class="keyword-select keyword-droppost" <?php if ( $keyword['module'] == 'droppost' ) echo 'style="display: block;"' ?>>					<label><?php _e("Article Folder") ?>:</label>					<div class="keyword-field">						<select name="keyword_folder[<?php echo $i ?>]" <?php if ( $keyword['module'] != 'droppost' ) echo 'disabled="disabled"' ?>>							<option value=""><?php _e("Select Folder") ?></option>							<?php foreach ( scandir($this->modules['droppost']->post_dir) as $file ): ?>								<?php if ( ! is_dir($this->modules['droppost']->post_dir.'/'.$file) || $file == '.' || $file == '..' ) continue; ?>								<option value="<?php echo $file ?>" <?php if ( $keyword['keyword_folder'] == $file ) echo 'selected="selected"' ?>><?php echo $file ?></option>							<?php endforeach ?>						</select>					</div>				</div>				<div class="keyword-select keyword-csv" <?php if ( $keyword['module'] == 'csv' ) echo 'style="display: block;"' ?>>					<label><?php _e("CSV File") ?>:</label>					<div class="keyword-field">						<select name="keyword_file[<?php echo $i ?>]">							<option value=""><?php _e("Select File") ?></option>							<?php 								$files = array();								foreach ( scandir($this->modules['csv']->post_dir) as $file ): 									if ( ! preg_match('/\.csv$/i', $file) ) 										continue;									$files[] = $file;							?>								<option value="<?php echo $file ?>" <?php if ( $keyword['keyword_file'] == $file ) echo 'selected="selected"' ?>><?php echo $file ?></option>							<?php endforeach ?>						</select>					</div>					<?php						$csv_template = $this->modules['csv']->get_template($keyword['keyword_file']);					?>					<label><?php _e("CSV Delimiter") ?>:</label>					<div class="keyword-field">						<input type="text" class="text" name="keyword_csv_delimiter[<?php echo $i ?>]" value="<?php echo $csv_template['delimiter'] ?>" />					</div>					<?php                                                if (isset($files[0]))                                                    $data = $this->modules['csv']->get_data($files[0]);                                                					?>					<label><?php _e("Post Title") ?>:</label>					<div class="keyword-field">						<input type="text" class="text" name="keyword_csv_title[<?php echo $i ?>]" value="<?php echo $csv_template['title'] ?>" />					</div>					<label><?php _e("Post Content") ?>:</label>					<div class="keyword-field">						<textarea class="text" name="keyword_csv_content[<?php echo $i ?>]" cols="40" rows="4"><?php echo $csv_template['template'] ?></textarea>					</div>					<div class="keyword-field">						<div class="available-column">							Available column: 							<span><?php 								if ( isset($data) && is_array($data))								{									/* echo '<strong>%'.implode('%</strong>, <strong>%', $data['column']).'%</strong>';*/									echo '<strong>%'.implode('%</strong>, <strong>%', $data['data']).'%</strong>';																	}							?></span>						</div>					</div>				</div>				<div class="keyword-select keyword-other" <?php if ( ! preg_match('/^(ezine|rssfeed|droppost|csv)$/i', $keyword['module']) && ! empty($keyword['module']) ) echo 'style="display: block;"' ?>>					<label><?php _e("Keyword") ?>:</label>					<div class="keyword-field">						<input type="text" class="text" name="keyword[<?php echo $i ?>]" value="<?php echo $keyword['keyword'] ?>"  <?php if ( $keyword['module'] == 'ezine' || $keyword['module'] == 'rssfeed' ) echo 'disabled="disabled"' ?> />					</div>				</div>                                            <label><?php _e("Post to Categories") ?>:</label>                                             <div class="keyword-field">                                                                                                  <?php                                                        $params = array();                                                        $params['title'] = __("Select Categories");                                                                        $params['selected_cats']  = unserialize(base64_decode($keyword['selected_cats']));                                                          $params['selected_by']  = $keyword['selected_by'];                                                         $params['prefix']  = $i;                                                                                                                                                                                                      echo MainWPUI::select_categories_box($params);                                                   ?>                                                            <div class="clearfix"></div>                                                           </div>                                                                                        				<label><?php _e("Template") ?>:</label>				<div class="keyword-field">					<select name="keyword_template[]">						<option value=""><?php _e("Default template") ?></option>						<?php foreach ( $this->get_templates($keyword['module']) as $template ): ?>							<option value="<?php echo $template->id ?>" <?php if ( $template->id == $keyword['template'] ) echo 'selected="selected"' ?>><?php echo $template->name ?></option>						<?php endforeach ?>					</select>				</div>				<label><?php _e("Schedule") ?>:</label>				<div class="keyword-field">					<label>						<input type="checkbox" name="keyword_override_schedule[<?php echo $i ?>]" value="yes" <?php if ( $keyword['override'] == 'yes' ) echo 'checked="checked"' ?> /> 						<?php _e('Override Default Schedule?') ?>					</label>					<br />					<div class="contentgen_schedule-once">						<input type="radio" name="keyword_type[<?php echo $i ?>]" value="once" <?php if ( $keyword['type'] == 'once' ) echo 'checked="checked"' ?> />						<input type="text" name="keyword_date[<?php echo $i ?>]" class="datepick" value="<?php echo date('d/m/Y', ($keyword['timestamp'] ? $keyword['timestamp'] : time())) ?>" />						<select name="keyword_time_h[<?php echo $i ?>]">							<?php for ( $t = 0; $t < 24; $t++ ): ?>							<option value="<?php echo $t ?>" <?php if ( date('G', $keyword['timestamp']) == $t ) echo 'selected="selected"' ?>><?php echo zeroise($t, 2) ?></option>							<?php endfor ?>						</select> hours						<select name="keyword_time_m[<?php echo $i ?>]">							<?php for ( $t = 0; $t < 60; $t++ ): ?>							<option value="<?php echo $t ?>" <?php if ( date('i', $keyword['timestamp']) == zeroise($t, 2) ) echo 'selected="selected"' ?>><?php echo zeroise($t, 2) ?></option>							<?php endfor ?>						</select> minutes					</div>					<br />					<div class="contentgen_schedule-recurring">						<input type="radio" name="keyword_type[<?php echo $i ?>]" value="recurring" <?php if ( $keyword['type'] == 'recurring' ) echo 'checked="checked"' ?> />						<input type="text" class="text text-small" name="keyword_times[<?php echo $i ?>]" value="<?php echo $keyword['times'] ?>" />						 <?php _e("times a") ?> 						<select name="keyword_rec[<?php echo $i ?>]">							<?php foreach ( array("hour","day", "week", "month", "year") as $sel ): ?>							<option value="<?php echo $sel ?>" <?php if ( $keyword['recurring'] == $sel) echo 'selected="selected"' ?>><?php echo $sel ?></option>							<?php endforeach ?>						</select>					</div>                                                       <br />                                                       <div class="contentgen_schedule-recurring">                                                                    <input type="radio" name="keyword_type[<?php echo $i ?>]"  value="before" <?php if ( $keyword['type'] == 'before' ) echo 'checked="checked"' ?> >                                                                    <input type="text"  class="text-small"  name="keyword_times_before[<?php echo $i ?>]"  value="<?php echo $keyword['times_before'] ?>">                                                                                                                                                                                                           <?php _e("times before") ?>                                                                       <select name="keyword_time_before_h[<?php echo $i ?>]">                                                                    <?php for ( $t = 0; $t < 24; $t++ ): ?>							<option value="<?php echo $t ?>" <?php if ( $keyword['before'] == $t ) echo 'selected="selected"' ?>><?php echo zeroise($t, 2) ?></option>						<?php endfor ?>                                                                    </select> h                                                                                                                   </div>   				</div>                                            <?php                                            if ($spinner)                                             { ?>                                                    <label><?php _e('Auto Spinning') ?>:</label>                                                    <div class="keyword-field">                                                            <label>                                                                <input type="checkbox" name="keyword_auto_spin[<?php echo $i ?>]"  value="yes" <?php if ( $keyword['auto_spin'] == 'yes' ) echo 'checked="checked"' ?> />                                                                             <?php _e('Enable auto spin?') ?>                                                                                                                                 </label>                                                                                                                                </div>                                                               <?php                                             }                                          ?>                                                                  			</div>		</div>	<?php endforeach ?>		<button class="button" id="add_keyword"><?php _e("Add Schedule") ?></button></div>