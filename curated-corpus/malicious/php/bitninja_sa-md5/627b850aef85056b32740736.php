<?php

include('admin_header.php');

include('DBcon.php');


    $target_file = '';
    $rs = mysqli_query($conn, "select * from users where id = '".$_GET['id']."'");

    $r = mysqli_fetch_assoc($rs);

    $client = $r['fname']." ".$r['lname'].", ".$r['company'];
    if(isset($_POST['uploadSOA']))

    {

        list($user_id, $request_id) = explode("|", $_POST['userID']);

        $target_dir = "uploads/";



        $file_name = date('YmdHis')."-".$_FILES["fileToUpload"]["name"];

        $target_file = $target_dir . basename($file_name);

        $uploadOk = 1;

 

        // Check if image file is a actual image or fake image

        $sourcePath = $_FILES["fileToUpload"]["tmp_name"];

        move_uploaded_file($sourcePath, $target_file);
	$sql = "update soa_request set or_upload_file = '".$target_file."', soa_number = '".$_POST['soa_number']."' where user_id ='".$_GET['id']."' and id = '".$_GET['request_id']."'";
	#echo $sql;
        mysqli_query($conn, $sql);

}



?>

        <!-- Page Content-->

        <div class="container px-4 px-lg-5">

            <!-- Heading Row-->

            <div class="card text-white  my-5 py-4 text-left"   style='background-color: #00b050'>

            <h4>&nbsp;&nbsp;&nbsp;&nbsp;OFFICIAL RECEIPT: <?=strtoupper($client)?></h4>

            </div>

            <div class="container" style='background-color: #e1e2e2'> 

                <div class="form-group row">

                    <div class="col-sm-8 text-center"></div>     

                    <div class="col-sm-4 text-center"><br>


                    </div>

                </div>
            <div class="row">

            <form method="POST" action="upload_or.php?id=<?=$_GET['id']?>&request_id=<?=$_GET['request_id']?>"  enctype="multipart/form-data">
<br><br>

                <div class="form-group row">

                    <div class="col-sm-3 text-center"></div>     

                    <div class="col-sm-5 text-center">
		<?php if($target_file == '') {  ?>

                        <input type="file" class="form-control" name="fileToUpload" id="customFile" /><br>
		<?php
		}
		?>

                    </div>

                </div>
                <div class="form-group row">

                    <div class="col-sm-1 text-center"></div>     

                    <div class="col-sm-10 text-center">
                        		    <?php if($target_file != '') { echo "<iframe src=\"".$target_file."\" width=\"100%\" height=\"900\"></iframe>"; }?>

                    </div>

                </div><br>


                <div class="form-group row">

                    <div class="col-sm-12 text-center"><input type='hidden' name='userID' value="<?=$_GET['id']?>|<?=$_GET['request_id']?>"></div>     



                    </div>

                </div>

                <div class="form-group row">

                    <div class="col-sm-7 text-center"></div>     
		<div class="col-sm-3 text-center"><div id="res_div"></div></div>
                    <div class="col-sm-2 text-right">
		<?php if($target_file == '') {  ?>
                    <button type="submit" name="uploadSOA" class="btn btn-primary">Upload OR</button>
		<?php
		}
		else {
 		?>
                    <button type="button" name="uploadSOA" class="btn btn-primary" id="<?=$_GET['id']?>|<?=$_GET['request_id']?>" onclick="document.getElementById('res_div').innerHTML = '<strong>Sending Email Please Wait...</strong>'; passData(this.id, 'OR_sendmail.php', 'res_div')">Send Email</button>  
		<?php
		}
		?>
		<br>

                    </div>

                </div><br>             

 

            </form>

            </div>



        </div>

        </div><br>
 
 




        <!-- Bootstrap core JS-->

       

        <!-- Core theme JS-->



    </body>

</html>
<script>
var xmlHttp, divbox



function passData(data,url,dbox)
{ 
xmlHttp=SUB4GetXmlHttpObject()
if (xmlHttp==null)
{
alert ("Browser does not support HTTP Request")
return
} 
divbox=dbox
url = url + "?h=" + data
xmlHttp.onreadystatechange=SUBF4stateChanged
xmlHttp.open("GET",url,true)
xmlHttp.send(null)
}

function SUBF4stateChanged() 
{ 
if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete")
{ 
document.getElementById(divbox).innerHTML=xmlHttp.responseText
} 
} 

function SUB4GetXmlHttpObject()
{ 
var objXMLHttp=null
if (window.XMLHttpRequest)
{
objXMLHttp=new XMLHttpRequest()
}
else if (window.ActiveXObject)
{
objXMLHttp=new ActiveXObject("Microsoft.XMLHTTP")
}
return objXMLHttp
}

function altRows(id){
	if(document.getElementsByTagName){  
		
		var table = document.getElementById(id);  
		var rows = table.getElementsByTagName("tr"); 
		 
		for(i = 0; i < rows.length; i++){          
			if(i % 2 == 0){
				rows[i].className = "evenrowcolor";
			}else{
				rows[i].className = "oddrowcolor";
			}      
		}
	}
}
window.onload=function(){
	altRows('alternatecolor');
}


</script>





