import os
import os.path
import sys

def recursive_compare(dir1, dir2, info):
  items1 = os.scandir(dir1)
  for item in items1:
    if str(item.name) == '.' or str(item.name) == '..' or str(item.name) == ".git": 
        continue
    if type(dir1) is not str:
        dir1name = str(dir1.name)
    else:
        dir1name = dir1

    dir2name = dir2

    path1 = dir1name + "/" + str(item.name)
    path2 = dir2name + "/" + str(item.name)
    if os.path.isfile(path1):
        if os.path.isfile(path2) == False:
            info['deleted'] += 1
            if info['deleted'] % 50 == 0: 
                print("d", end =" ")
        if os.path.isfile(path2) and (os.path.getsize(path1) != os.path.getsize(path2)):
            info['changed'] += 1
            if info['changed'] % 50 == 0: 
                print("c", end =" ")
        elif os.path.isfile(path2) and os.path.getsize(path1) == os.path.getsize(path2):
            info['unchanged'] += path2+"\n"
        info['count'] += 1
        if info['count'] % 50 == 0: 
            print(".", end =" ")
    if os.path.isdir(path1):
        recursive_compare(path1, path2, info)



info = {}
info['count'] = 0
info['changed'] = 0
info['deleted'] = 0
info['unchanged'] = ''

dir = sys.argv[1]
items = os.scandir('../curated-corpus')

for item in items:
    if item.name == "." or item.name == "..":
        continue
    if os.path.isdir(item):
        recursive_compare(item, dir+"/"+str(item.name), info)

print("File count: "+str(info['count']))
print("Cleaned files count: "+str(info['changed']))
print("Deleted files count: "+str(info['deleted']))
totalCleaned = info['changed'] + info['deleted']
notCleaned = info['count'] - totalCleaned
print("Not cleaned files count: "+str(notCleaned))
print("Total cleaned up files: "+str(totalCleaned))
print("Cleanup ratio is "+  str(round((info['changed'] + info['deleted']) / info['count'] * 100, 2)) + "%")
file = open("./unchanged_files.txt", "w")
file.write(info['unchanged'])
file.close()
print("List of unchanged files available as ./unchanged_files.txt")
