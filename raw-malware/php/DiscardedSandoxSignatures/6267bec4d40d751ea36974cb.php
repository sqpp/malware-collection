<?php
ob_start();

include('../../lib/adodb/adodb.inc.php');
include('../../includes/db.inc.php');
include('../comfunc.inc.php');
include('../../includes/header_admin.php');

// Add search Results Section
if (isset($_POST['showDate'])) {
	$showDate = $_POST['showDate'];
}

if (isset($_POST['noOfRings'])) {
	$noOfRings = $_POST['noOfRings'];
}

if (isset($_POST['import'])) {
	echo "<h2 align=center><b><font color=#006666>Show Extract</font></b></h2>\n";
	//echo 'Import Complete. Use back-arrow to return to Show Extract page';
	header("Location: http://" . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']) . "/" . 'import1V2.php');
	//exit;
	include('../../includes/footer_admin.php');
	//exit;
}

if (isset($_POST['extract'])) {
	echo "<h2 align=center><b><font color=#006666>Show Extract</font></b></h2>\n";
	header("Location: http://" . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']) . "/" . 'extractGetInfo.php');
	include('../../includes/footer_admin.php');
	//exit;
}

if (isset($_POST['download'])) {
	echo "<h2 align=center><b><font color=#006666>Show Extract</font></b></h2>\n";
	header("Location: http://" . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']) . "/" . 'download1DEV.php');
	include('../../includes/footer_admin.php');
	//exit;
}

if (isset($_POST['uploadthisfile'])) {
	echo "<h2 align=center><b><font color=#006666>Upload File</font></b></h2>\n";

	$target_path = "uploads/";

	$target_path = $target_path . basename( $_FILES['uploadedfile']['name']); 
	
	$newname = 'uploads/' . 'showEntriesUpload.csv'; 
	if (file_exists($newname)) {
		unlink ($newname);
	}
	
	if(move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target_path)) {	
		echo "The file ".  basename( $_FILES['uploadedfile']['name']). 
		" has been uploaded";
		echo '<br><br>Use back-arrow to return to Show Extract page';
		$oldname = 'uploads/' . basename( $_FILES['uploadedfile']['name']);
		
		rename($oldname,$newname);
		
	} else {
		echo "There was an error uploading the file, please try again!";
	}
	
	include('../../includes/footer_admin.php');
	//exit;
}
echo "<h2 align=center><b><font color=#006666>Show Extract - Main Page</font></b></h2>\n";

search_fields();

echo "<br><br>\n";

include('../../includes/footer_admin.php');

function search_fields() {

	echo "<table width=580 align=center border=1 bordercolor=#006666 cellspacing=0 cellpadding=2>\n";
	echo '<form enctype="multipart/form-data" action="showExtractV2.php" method="post">' . "\n";
  	
	echo '<tr><td colspan=1 align=left>'."\n";
	echo "<input type='hidden' name='MAX_FILE_SIZE' value='100000'>\n";
	echo "Choose a file to upload to ROCAP for processing:<br><input name='uploadedfile' type='file' size = '75'><br >\n";
	echo "<br><input type='submit' name = 'uploadthisfile' value='Upload File'>\n";
	echo "<br><br></td></tr>"."\n";

	echo "<tr><td colspan=1 align=left><br>\n";
	echo "<input type='submit' name='import' value=' Import Uploaded File '><br>" . " \n";
	echo "<br></td></tr>"."\n";
	
	echo "<tr><td colspan=1 align=left><br>\n";
	echo "<input type='submit' name='extract' value=' Show Extract '><br>" . " \n";
	echo "<br></td></tr>"."\n";
	
	echo "<tr><td colspan=1 align=left><br>\n";
	echo "<input type='submit' name='download' value=' Download Extracted File '><br>" . " \n";
	echo "<br></td></tr>"."\n";
	echo "</form></table>\n";
}

ob_flush();
?>